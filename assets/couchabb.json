{"_attachments": {"test/qunit/index.html": {"data": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9ZWRnZSxjaHJvbWU9MSI+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiPgoKICA8dGl0bGU+QmFja2JvbmUgQm9pbGVycGxhdGUgUVVuaXQgVGVzdCBTdWl0ZTwvdGl0bGU+CgogIDwhLS0gUVVuaXQgc3R5bGVzIC0tPgogIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0idmVuZG9yL3F1bml0LmNzcyI+CjwvaGVhZD4KCjxib2R5PgogIDwhLS0gUVVuaXQgc3R1Y3R1cmUgLS0+CiAgPGRpdiBjbGFzcz0iZGF0YXNldC10ZXN0Ij4KICAgIDxoMSBpZD0icXVuaXQtaGVhZGVyIj5CYWNrYm9uZSBCb2lsZXJwbGF0ZSBRVW5pdCBUZXN0IFN1aXRlPC9oMT4KICAgIDxoMiBpZD0icXVuaXQtYmFubmVyIj48L2gyPgogICAgPGgyIGlkPSJxdW5pdC11c2VyQWdlbnQiPjwvaDI+CiAgICA8b2wgaWQ9InF1bml0LXRlc3RzIj48L29sPgogIDwvZGl2PgoKICA8IS0tIFRlc3RpbmcgbGlicyAtLT4KICA8c2NyaXB0IHNyYz0idmVuZG9yL3F1bml0LmpzIj48L3NjcmlwdD4KCiAgPCEtLSBBcHBsaWNhdGlvbiBsaWJzIC0tPgogIDxzY3JpcHQgc3JjPSIuLi8uLi9hc3NldHMvanMvbGlicy9qcXVlcnkuanMiPjwvc2NyaXB0PgogIDxzY3JpcHQgc3JjPSIuLi8uLi9hc3NldHMvanMvbGlicy91bmRlcnNjb3JlLmpzIj48L3NjcmlwdD4KICA8c2NyaXB0IHNyYz0iLi4vLi4vYXNzZXRzL2pzL2xpYnMvYmFja2JvbmUuanMiPjwvc2NyaXB0PgogIAogIDwhLS0gTG9hZCBhcHBsaWNhdGlvbiAtLT4KICA8c2NyaXB0IGRhdGEtbWFpbj0iLi4vLi4vYXBwL2NvbmZpZyIKICAgIHNyYz0iLi4vLi4vYXNzZXRzL2pzL2xpYnMvcmVxdWlyZS5qcyI+PC9zY3JpcHQ+CgogIDwhLS0gRGVjbGFyZSB5b3VyIHRlc3QgZmlsZXMgdG8gYmUgcnVuIGhlcmUgLS0+CiAgPHNjcmlwdD4KICAgIC8vIEVuc3VyZSB5b3UgcG9pbnQgdG8gd2hlcmUgeW91ciB0ZXN0cyBhcmUsIGJhc2UgZGlyZWN0b3J5IGlzIGFwcC8sIHdoaWNoCiAgICAvLyBpcyB3aHkgLi4vdGVzdCBpcyBuZWNlc3NhcnkKICAgIHJlcXVpcmUoeyBwYXRoczogeyB0ZXN0czogIi4uL3Rlc3QvcXVuaXQvdGVzdHMiIH0gfSwgWwoKICAgICAgLy8gTG9hZCB0aGUgZXhhbXBsZSB0ZXN0cywgcmVwbGFjZSB0aGlzIGFuZCBhZGQgeW91ciBvd24gdGVzdHMKICAgICAgInRlc3RzL2V4YW1wbGUiCgogICAgXSk7CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=", "content_type": "text/html"}, "assets/css/style.css": {"data": "LyoKICogSFRNTDUg4pywIEJvaWxlcnBsYXRlCiAqCiAqIFdoYXQgZm9sbG93cyBpcyB0aGUgcmVzdWx0IG9mIG11Y2ggcmVzZWFyY2ggb24gY3Jvc3MtYnJvd3NlciBzdHlsaW5nLgogKiBDcmVkaXQgbGVmdCBpbmxpbmUgYW5kIGJpZyB0aGFua3MgdG8gTmljb2xhcyBHYWxsYWdoZXIsIEpvbmF0aGFuIE5lYWwsCiAqIEtyb2MgQ2FtZW4sIGFuZCB0aGUgSDVCUCBkZXYgY29tbXVuaXR5IGFuZCB0ZWFtLgogKgogKiBEZXRhaWxlZCBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIENTUzogaDVicC5jb20vY3NzCiAqCiAqID09fD09IG5vcm1hbGl6ZSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqLwoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEhUTUw1IGRpc3BsYXkgZGVmaW5pdGlvbnMKICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCmFydGljbGUsIGFzaWRlLCBkZXRhaWxzLCBmaWdjYXB0aW9uLCBmaWd1cmUsIGZvb3RlciwgaGVhZGVyLCBoZ3JvdXAsIG5hdiwgc2VjdGlvbiB7IGRpc3BsYXk6IGJsb2NrOyB9CmF1ZGlvLCBjYW52YXMsIHZpZGVvIHsgZGlzcGxheTogaW5saW5lLWJsb2NrOyAqZGlzcGxheTogaW5saW5lOyAqem9vbTogMTsgfQphdWRpbzpub3QoW2NvbnRyb2xzXSkgeyBkaXNwbGF5OiBub25lOyB9CltoaWRkZW5dIHsgZGlzcGxheTogbm9uZTsgfQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEJhc2UKICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCi8qCiAqIDEuIENvcnJlY3QgdGV4dCByZXNpemluZyBvZGRseSBpbiBJRTYvNyB3aGVuIGJvZHkgZm9udC1zaXplIGlzIHNldCB1c2luZyBlbSB1bml0cwogKiAyLiBGb3JjZSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaW4gbm9uLUlFCiAqIDMuIFByZXZlbnQgaU9TIHRleHQgc2l6ZSBhZGp1c3Qgb24gZGV2aWNlIG9yaWVudGF0aW9uIGNoYW5nZSwgd2l0aG91dCBkaXNhYmxpbmcgdXNlciB6b29tOiBoNWJwLmNvbS9nCiAqLwoKaHRtbCB7IGZvbnQtc2l6ZTogMTAwJTsgb3ZlcmZsb3cteTogc2Nyb2xsOyAtd2Via2l0LXRleHQtc2l6ZS1hZGp1c3Q6IDEwMCU7IC1tcy10ZXh0LXNpemUtYWRqdXN0OiAxMDAlOyB9Cgpib2R5IHsgbWFyZ2luOiAwOyBmb250LXNpemU6IDFlbTsgbGluZS1oZWlnaHQ6IDEuNDsgfQoKYm9keSwgYnV0dG9uLCBpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSB7IGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOyBjb2xvcjogIzIyMjsgfQoKLyoKICogUmVtb3ZlIHRleHQtc2hhZG93IGluIHNlbGVjdGlvbiBoaWdobGlnaHQ6IGg1YnAuY29tL2kKICogVGhlc2Ugc2VsZWN0aW9uIGRlY2xhcmF0aW9ucyBoYXZlIHRvIGJlIHNlcGFyYXRlCiAqIEFsc286IGhvdCBwaW5rISAob3IgY3VzdG9taXplIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIHRvIG1hdGNoIHlvdXIgZGVzaWduKQogKi8KCjo6LW1vei1zZWxlY3Rpb24geyBiYWNrZ3JvdW5kOiAjZmU1N2ExOyBjb2xvcjogI2ZmZjsgdGV4dC1zaGFkb3c6IG5vbmU7IH0KOjpzZWxlY3Rpb24geyBiYWNrZ3JvdW5kOiAjZmU1N2ExOyBjb2xvcjogI2ZmZjsgdGV4dC1zaGFkb3c6IG5vbmU7IH0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBMaW5rcwogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKYSB7IGNvbG9yOiAjMDBlOyB9CmE6dmlzaXRlZCB7IGNvbG9yOiAjNTUxYThiOyB9CmE6aG92ZXIgeyBjb2xvcjogIzA2ZTsgfQphOmZvY3VzIHsgb3V0bGluZTogdGhpbiBkb3R0ZWQ7IH0KCi8qIEltcHJvdmUgcmVhZGFiaWxpdHkgd2hlbiBmb2N1c2VkIGFuZCBob3ZlcmVkIGluIGFsbCBicm93c2VyczogaDVicC5jb20vaCAqLwphOmhvdmVyLCBhOmFjdGl2ZSB7IG91dGxpbmU6IDA7IH0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBUeXBvZ3JhcGh5CiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgphYmJyW3RpdGxlXSB7IGJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQ7IH0KCmIsIHN0cm9uZyB7IGZvbnQtd2VpZ2h0OiBib2xkOyB9CgpibG9ja3F1b3RlIHsgbWFyZ2luOiAxZW0gNDBweDsgfQoKZGZuIHsgZm9udC1zdHlsZTogaXRhbGljOyB9CgpociB7IGRpc3BsYXk6IGJsb2NrOyBoZWlnaHQ6IDFweDsgYm9yZGVyOiAwOyBib3JkZXItdG9wOiAxcHggc29saWQgI2NjYzsgbWFyZ2luOiAxZW0gMDsgcGFkZGluZzogMDsgfQoKaW5zIHsgYmFja2dyb3VuZDogI2ZmOTsgY29sb3I6ICMwMDA7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgfQoKbWFyayB7IGJhY2tncm91bmQ6ICNmZjA7IGNvbG9yOiAjMDAwOyBmb250LXN0eWxlOiBpdGFsaWM7IGZvbnQtd2VpZ2h0OiBib2xkOyB9CgovKiBSZWRlY2xhcmUgbW9ub3NwYWNlIGZvbnQgZmFtaWx5OiBoNWJwLmNvbS9qICovCnByZSwgY29kZSwga2JkLCBzYW1wIHsgZm9udC1mYW1pbHk6IG1vbm9zcGFjZSwgc2VyaWY7IF9mb250LWZhbWlseTogJ2NvdXJpZXIgbmV3JywgbW9ub3NwYWNlOyBmb250LXNpemU6IDFlbTsgfQoKLyogSW1wcm92ZSByZWFkYWJpbGl0eSBvZiBwcmUtZm9ybWF0dGVkIHRleHQgaW4gYWxsIGJyb3dzZXJzICovCnByZSB7IHdoaXRlLXNwYWNlOiBwcmU7IHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsgd29yZC13cmFwOiBicmVhay13b3JkOyB9CgpxIHsgcXVvdGVzOiBub25lOyB9CnE6YmVmb3JlLCBxOmFmdGVyIHsgY29udGVudDogIiI7IGNvbnRlbnQ6IG5vbmU7IH0KCnNtYWxsIHsgZm9udC1zaXplOiA4NSU7IH0KCi8qIFBvc2l0aW9uIHN1YnNjcmlwdCBhbmQgc3VwZXJzY3JpcHQgY29udGVudCB3aXRob3V0IGFmZmVjdGluZyBsaW5lLWhlaWdodDogaDVicC5jb20vayAqLwpzdWIsIHN1cCB7IGZvbnQtc2l6ZTogNzUlOyBsaW5lLWhlaWdodDogMDsgcG9zaXRpb246IHJlbGF0aXZlOyB2ZXJ0aWNhbC1hbGlnbjogYmFzZWxpbmU7IH0Kc3VwIHsgdG9wOiAtMC41ZW07IH0Kc3ViIHsgYm90dG9tOiAtMC4yNWVtOyB9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgTGlzdHMKICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCnVsLCBvbCB7IG1hcmdpbjogMWVtIDA7IHBhZGRpbmc6IDAgMCAwIDQwcHg7IH0KZGQgeyBtYXJnaW46IDAgMCAwIDQwcHg7IH0KbmF2IHVsLCBuYXYgb2wgeyBsaXN0LXN0eWxlOiBub25lOyBsaXN0LXN0eWxlLWltYWdlOiBub25lOyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IH0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBFbWJlZGRlZCBjb250ZW50CiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgovKgogKiAxLiBJbXByb3ZlIGltYWdlIHF1YWxpdHkgd2hlbiBzY2FsZWQgaW4gSUU3OiBoNWJwLmNvbS9kCiAqIDIuIFJlbW92ZSB0aGUgZ2FwIGJldHdlZW4gaW1hZ2VzIGFuZCBib3JkZXJzIG9uIGltYWdlIGNvbnRhaW5lcnM6IGg1YnAuY29tL2UKICovCgppbWcgeyBib3JkZXI6IDA7IC1tcy1pbnRlcnBvbGF0aW9uLW1vZGU6IGJpY3ViaWM7IHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IH0KCi8qCiAqIENvcnJlY3Qgb3ZlcmZsb3cgbm90IGhpZGRlbiBpbiBJRTkKICovCgpzdmc6bm90KDpyb290KSB7IG92ZXJmbG93OiBoaWRkZW47IH0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBGaWd1cmVzCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgpmaWd1cmUgeyBtYXJnaW46IDA7IH0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBGb3JtcwogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKZm9ybSB7IG1hcmdpbjogMDsgfQpmaWVsZHNldCB7IGJvcmRlcjogMDsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyB9CgovKiBJbmRpY2F0ZSB0aGF0ICdsYWJlbCcgd2lsbCBzaGlmdCBmb2N1cyB0byB0aGUgYXNzb2NpYXRlZCBmb3JtIGVsZW1lbnQgKi8KbGFiZWwgeyBjdXJzb3I6IHBvaW50ZXI7IH0KCi8qCiAqIDEuIENvcnJlY3QgY29sb3Igbm90IGluaGVyaXRpbmcgaW4gSUU2LzcvOC85CiAqIDIuIENvcnJlY3QgYWxpZ25tZW50IGRpc3BsYXllZCBvZGRseSBpbiBJRTYvNwogKi8KCmxlZ2VuZCB7IGJvcmRlcjogMDsgKm1hcmdpbi1sZWZ0OiAtN3B4OyBwYWRkaW5nOiAwOyB9CgovKgogKiAxLiBDb3JyZWN0IGZvbnQtc2l6ZSBub3QgaW5oZXJpdGluZyBpbiBhbGwgYnJvd3NlcnMKICogMi4gUmVtb3ZlIG1hcmdpbnMgaW4gRkYzLzQgUzUgQ2hyb21lCiAqIDMuIERlZmluZSBjb25zaXN0ZW50IHZlcnRpY2FsIGFsaWdubWVudCBkaXNwbGF5IGluIGFsbCBicm93c2VycwogKi8KCmJ1dHRvbiwgaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEgeyBmb250LXNpemU6IDEwMCU7IG1hcmdpbjogMDsgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOyAqdmVydGljYWwtYWxpZ246IG1pZGRsZTsgfQoKLyoKICogMS4gRGVmaW5lIGxpbmUtaGVpZ2h0IGFzIG5vcm1hbCB0byBtYXRjaCBGRjMvNCAoc2V0IHVzaW5nICFpbXBvcnRhbnQgaW4gdGhlIFVBIHN0eWxlc2hlZXQpCiAqLwoKYnV0dG9uLCBpbnB1dCB7IGxpbmUtaGVpZ2h0OiBub3JtYWw7IH0KCi8qCiAqIDEuIERpc3BsYXkgaGFuZCBjdXJzb3IgZm9yIGNsaWNrYWJsZSBmb3JtIGVsZW1lbnRzCiAqIDIuIEFsbG93IHN0eWxpbmcgb2YgY2xpY2thYmxlIGZvcm0gZWxlbWVudHMgaW4gaU9TCiAqIDMuIENvcnJlY3QgaW5uZXIgc3BhY2luZyBkaXNwbGF5ZWQgb2RkbHkgaW4gSUU3IChkb2Vzbid0IGVmZmVjdCBJRTYpCiAqLwoKYnV0dG9uLCBpbnB1dFt0eXBlPSJidXR0b24iXSwgaW5wdXRbdHlwZT0icmVzZXQiXSwgaW5wdXRbdHlwZT0ic3VibWl0Il0geyBjdXJzb3I6IHBvaW50ZXI7IC13ZWJraXQtYXBwZWFyYW5jZTogYnV0dG9uOyAqb3ZlcmZsb3c6IHZpc2libGU7IH0KCi8qCiAqIENvbnNpc3RlbnQgYm94IHNpemluZyBhbmQgYXBwZWFyYW5jZQogKi8KCmlucHV0W3R5cGU9ImNoZWNrYm94Il0sIGlucHV0W3R5cGU9InJhZGlvIl0geyBib3gtc2l6aW5nOiBib3JkZXItYm94OyBwYWRkaW5nOiAwOyB9CmlucHV0W3R5cGU9InNlYXJjaCJdIHsgLXdlYmtpdC1hcHBlYXJhbmNlOiB0ZXh0ZmllbGQ7IC1tb3otYm94LXNpemluZzogY29udGVudC1ib3g7IC13ZWJraXQtYm94LXNpemluZzogY29udGVudC1ib3g7IGJveC1zaXppbmc6IGNvbnRlbnQtYm94OyB9CmlucHV0W3R5cGU9InNlYXJjaCJdOjotd2Via2l0LXNlYXJjaC1kZWNvcmF0aW9uIHsgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOyB9CgovKgogKiBSZW1vdmUgaW5uZXIgcGFkZGluZyBhbmQgYm9yZGVyIGluIEZGMy80OiBoNWJwLmNvbS9sCiAqLwoKYnV0dG9uOjotbW96LWZvY3VzLWlubmVyLCBpbnB1dDo6LW1vei1mb2N1cy1pbm5lciB7IGJvcmRlcjogMDsgcGFkZGluZzogMDsgfQoKLyoKICogMS4gUmVtb3ZlIGRlZmF1bHQgdmVydGljYWwgc2Nyb2xsYmFyIGluIElFNi83LzgvOQogKiAyLiBBbGxvdyBvbmx5IHZlcnRpY2FsIHJlc2l6aW5nCiAqLwoKdGV4dGFyZWEgeyBvdmVyZmxvdzogYXV0bzsgdmVydGljYWwtYWxpZ246IHRvcDsgcmVzaXplOiB2ZXJ0aWNhbDsgfQoKLyogQ29sb3JzIGZvciBmb3JtIHZhbGlkaXR5ICovCmlucHV0OnZhbGlkLCB0ZXh0YXJlYTp2YWxpZCB7ICB9CmlucHV0OmludmFsaWQsIHRleHRhcmVhOmludmFsaWQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBkZGRkOyB9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgVGFibGVzCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgp0YWJsZSB7IGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7IGJvcmRlci1zcGFjaW5nOiAwOyB9CnRkIHsgdmVydGljYWwtYWxpZ246IHRvcDsgfQoKCi8qID09fD09IHByaW1hcnkgc3R5bGVzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEF1dGhvcjogQmFja2JvbmUgQm9pbGVycGxhdGUgPENoYW5nZSB0byB5b3VyIE5hbWU+CiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgojbWFpbiB7Ci8qICAgbWFyZ2luOiA0MHB4OyAqLwogIGZvbnQtc2l6ZTogMTRweDsKfQoKI21haW4gcHJlIHsKICBtaW4td2lkdGg6IDMyMHB4OwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgY29sb3I6ICMzMzM7CiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICBmb250LXNpemU6IDEycHg7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmctcmlnaHQ6IDQwcHg7CiAgYmFja2dyb3VuZDogI0Y4RkFGQzsKfQoKI21haW4gYSB7CiAgY29sb3I6ICMwMENDRkY7Cn0KCiNtYWluIGE6aG92ZXIgewogIGNvbG9yOiAjRkU1N0ExOwp9CgojbWFpbiBpbWcgewogIHdpZHRoOiAzMjBweDsKICBoZWlnaHQ6IGF1dG87Cn0KCiNtYWluIHAgewogIGxpbmUtaGVpZ2h0OiAyOHB4Owp9CgojbWFpbiB1bC5uZXN0ZWQgewogIG1hcmdpbi10b3A6IDA7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQoKI21haW4gdWwgbGkgewogIGxpbmUtaGVpZ2h0OiAyOHB4Owp9CgojbWFpbiBoZWFkZXIgaDEgewogIG1hcmdpbjogMTVweDsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgY29sb3I6ICMzMzM7Cn0KCiNtYWluIGhlYWRlciBoMjpub3QoLmNvbmdyYXRzKSB7CiAgY29sb3I6ICM2NjY7CiAgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOwp9CgojbWFpbiBoZWFkZXIgLmNvbmdyYXRzIHsKICBwYWRkaW5nLWJvdHRvbTogMDsKICBtYXJnaW4tYm90dG9tOiAwOwogIGNvbG9yOiAjMDBDQ0ZGOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBmb250LXNpemU6IDI4cHg7Cn0KCiNtYWluIC50b3BpYyB7CiAgY29sb3I6ICNDQ0M7Cn0KCiNtYWluIC5jbHVlcyB7CiAgY29sb3I6ICNGRTU3QTE7Cn0KCgovKiA9PXw9PSBtZWRpYSBxdWVyaWVzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBQTEFDRUhPTERFUiBNZWRpYSBRdWVyaWVzIGZvciBSZXNwb25zaXZlIERlc2lnbi4KICAgVGhlc2Ugb3ZlcnJpZGUgdGhlIHByaW1hcnkgKCdtb2JpbGUgZmlyc3QnKSBzdHlsZXMKICAgTW9kaWZ5IGFzIGNvbnRlbnQgcmVxdWlyZXMuCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgpAbWVkaWEgb25seSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDQ4MHB4KSB7CiAgLyogU3R5bGUgYWRqdXN0bWVudHMgZm9yIHZpZXdwb3J0cyA0ODBweCBhbmQgb3ZlciBnbyBoZXJlICovCgp9CgpAbWVkaWEgb25seSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLyogU3R5bGUgYWRqdXN0bWVudHMgZm9yIHZpZXdwb3J0cyA3NjhweCBhbmQgb3ZlciBnbyBoZXJlICovCgp9CgovKiB0b2RvbXZjIGJlZ2luICovCgpodG1sLCBib2R5LCBkaXYsIHNwYW4sIGFwcGxldCwgb2JqZWN0LCBpZnJhbWUsCmgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIHAsIGJsb2NrcXVvdGUsIHByZSwKYSwgYWJiciwgYWNyb255bSwgYWRkcmVzcywgYmlnLCBjaXRlLCBjb2RlLApkZWwsIGRmbiwgZW0sIGZvbnQsIGltZywgaW5zLCBrYmQsIHEsIHMsIHNhbXAsCnNtYWxsLCBzdHJpa2UsIHN0cm9uZywgc3ViLCBzdXAsIHR0LCB2YXIsCmRsLCBkdCwgZGQsIG9sLCB1bCwgbGksCmZpZWxkc2V0LCBmb3JtLCBsYWJlbCwgbGVnZW5kLAp0YWJsZSwgY2FwdGlvbiwgdGJvZHksIHRmb290LCB0aGVhZCwgdHIsIHRoLCB0ZCB7CgltYXJnaW46IDA7CglwYWRkaW5nOiAwOwoJYm9yZGVyOiAwOwoJb3V0bGluZTogMDsKCWZvbnQtd2VpZ2h0OiBpbmhlcml0OwoJZm9udC1zdHlsZTogaW5oZXJpdDsKCWZvbnQtc2l6ZTogMTAwJTsKCWZvbnQtZmFtaWx5OiBpbmhlcml0OwoJdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwp9CmJvZHkgewoJbGluZS1oZWlnaHQ6IDE7Cgljb2xvcjogYmxhY2s7CgliYWNrZ3JvdW5kOiB3aGl0ZTsKfQpvbCwgdWwgewoJbGlzdC1zdHlsZTogbm9uZTsKfQphIGltZyB7Cglib3JkZXI6IG5vbmU7Cn0KCmh0bWwgewoJYmFja2dyb3VuZDogI2VlZWVlZTsKfQpib2R5IHsKCWZvbnQtZmFtaWx5OiAiSGVsdmV0aWNhIE5ldWUiLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwoJZm9udC1zaXplOiAxNHB4OwoJbGluZS1oZWlnaHQ6IDEuNGVtOwoJYmFja2dyb3VuZDogI2VlZWVlZTsKCWNvbG9yOiAjMzMzMzMzOwp9CgojdG9kb2FwcCB7Ci8qIAl3aWR0aDogNDAwcHg7ICovCgltYXJnaW46IDAgYXV0byA0MHB4OwoJYmFja2dyb3VuZDogd2hpdGU7CglwYWRkaW5nOiA1cHg7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDVweCA2cHggMDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgNXB4IDZweCAwOwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgNXB4IDZweCAwOwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgNXB4IDZweCAwOwp9CiN0b2RvYXBwIGgxIHsKCWZvbnQtc2l6ZTogMzZweDsKCWZvbnQtd2VpZ2h0OiBib2xkOwoJdGV4dC1hbGlnbjogY2VudGVyOwoJcGFkZGluZzogMjBweCAwIDMwcHggMDsKCWxpbmUtaGVpZ2h0OiAxOwp9CgojY3JlYXRlLXRvZG8gewoJcG9zaXRpb246IHJlbGF0aXZlOwp9CiNjcmVhdGUtdG9kbyBpbnB1dCB7Cgl3aWR0aDogOTUlOwoJZm9udC1zaXplOiAyNHB4OwoJZm9udC1mYW1pbHk6IGluaGVyaXQ7CglsaW5lLWhlaWdodDogMS40ZW07Cglib3JkZXI6IDA7CglvdXRsaW5lOiBub25lOwoJcGFkZGluZzogNnB4OwoJYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cn0KCiNjcmVhdGUtdG9kbyBzcGFuIHsKCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCXotaW5kZXg6IDk5OTsKCXdpZHRoOiAxNzBweDsKCWxlZnQ6IDUwJTsKCW1hcmdpbi1sZWZ0OiAtODVweDsKfQoKI3RvZG8tbGlzdCB7CgltYXJnaW4tdG9wOiAxMHB4Owp9CiN0b2RvLWxpc3QgbGkgewoJcGFkZGluZzogMTJweCAyMHB4IDExcHggMDsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCWZvbnQtc2l6ZTogMjRweDsKCWxpbmUtaGVpZ2h0OiAxLjFlbTsKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjY2NjOwp9CiN0b2RvLWxpc3QgbGk6YWZ0ZXIgewoJY29udGVudDogIlwwMDIwIjsKCWRpc3BsYXk6IGJsb2NrOwoJaGVpZ2h0OiAwOwoJY2xlYXI6IGJvdGg7CglvdmVyZmxvdzogaGlkZGVuOwoJdmlzaWJpbGl0eTogaGlkZGVuOwp9CiN0b2RvLWxpc3QgbGkuZWRpdGluZyB7CglwYWRkaW5nOiAwOwoJYm9yZGVyLWJvdHRvbTogMDsKfQojdG9kby1saXN0IC5lZGl0aW5nIC5kaXNwbGF5LAojdG9kby1saXN0IC5lZGl0IHsKCWRpc3BsYXk6IG5vbmU7Cn0KI3RvZG8tbGlzdCAuZWRpdGluZyAuZWRpdCB7CglkaXNwbGF5OiBibG9jazsKfQojdG9kby1saXN0IC5lZGl0aW5nIGlucHV0IHsKCXdpZHRoOiA5NSU7Cglmb250LXNpemU6IDI0cHg7Cglmb250LWZhbWlseTogaW5oZXJpdDsKCW1hcmdpbjogMDsKCWxpbmUtaGVpZ2h0OiAxLjZlbTsKCWJvcmRlcjogMDsKCW91dGxpbmU6IG5vbmU7CglwYWRkaW5nOiAxMHB4IDdweCAwcHggMjdweDsKCWJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0Owp9CiN0b2RvLWxpc3QgLmNoZWNrIHsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCXRvcDogOXB4OwoJbWFyZ2luOiAwIDEwcHggMCA3cHg7CglmbG9hdDogbGVmdDsKfQojdG9kby1saXN0IC5kb25lIC50b2RvLWNvbnRlbnQgewoJdGV4dC1kZWNvcmF0aW9uOiBsaW5lLXRocm91Z2g7Cgljb2xvcjogIzc3Nzc3NzsKfQojdG9kby1saXN0IC50b2RvLWRlc3Ryb3kgewoJcG9zaXRpb246IGFic29sdXRlOwoJcmlnaHQ6IDVweDsKCXRvcDogMTRweDsKCWRpc3BsYXk6IG5vbmU7CgljdXJzb3I6IHBvaW50ZXI7Cgl3aWR0aDogMjBweDsKCWhlaWdodDogMjBweDsKCWJhY2tncm91bmQ6IHVybChkZXN0cm95LnBuZykgbm8tcmVwZWF0IDAgMDsKfQojdG9kby1saXN0IGxpOmhvdmVyIC50b2RvLWRlc3Ryb3kgewoJZGlzcGxheTogYmxvY2s7Cn0KI3RvZG8tbGlzdCAudG9kby1kZXN0cm95OmhvdmVyIHsKCWJhY2tncm91bmQtcG9zaXRpb246IDAgLTIwcHg7Cn0KCiN0b2RvLXN0YXRzIHsKCSp6b29tOiAxOwoJbWFyZ2luLXRvcDogMTBweDsKCWNvbG9yOiAjNzc3Nzc3Owp9CiN0b2RvLXN0YXRzOmFmdGVyIHsKCWNvbnRlbnQ6ICJcMDAyMCI7CglkaXNwbGF5OiBibG9jazsKCWhlaWdodDogMDsKCWNsZWFyOiBib3RoOwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXZpc2liaWxpdHk6IGhpZGRlbjsKfQojdG9kby1zdGF0cyAudG9kby1jb3VudCB7CglmbG9hdDogbGVmdDsKfQojdG9kby1zdGF0cyAudG9kby1jb3VudCAubnVtYmVyIHsKCWZvbnQtd2VpZ2h0OiBib2xkOwoJY29sb3I6ICMzMzMzMzM7Cn0KI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgewoJZmxvYXQ6IHJpZ2h0Owp9CiN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGEgewoJY29sb3I6ICM3Nzc3Nzc7Cglmb250LXNpemU6IDEycHg7Cn0KI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgYTp2aXNpdGVkIHsKCWNvbG9yOiAjNzc3Nzc3Owp9CiN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGE6aG92ZXIgewoJY29sb3I6ICMzMzY2OTk7Cn0KCiNpbnN0cnVjdGlvbnMgewoJd2lkdGg6IDUyMHB4OwoJbWFyZ2luOiAxMHB4IGF1dG87Cgljb2xvcjogIzc3Nzc3NzsKCXRleHQtc2hhZG93OiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCkgMCAxcHggMDsKCXRleHQtYWxpZ246IGNlbnRlcjsKfQojaW5zdHJ1Y3Rpb25zIGEgewoJY29sb3I6ICMzMzY2OTk7Cn0KCiNjcmVkaXRzIHsKLyogCXdpZHRoOiA1MjBweDsgKi8KCW1hcmdpbjogMzBweCBhdXRvOwoJY29sb3I6ICM5OTk7Cgl0ZXh0LXNoYWRvdzogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIDAgMXB4IDA7Cgl0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KI2NyZWRpdHMgYSB7Cgljb2xvcjogIzg4ODsKfQoKCi8qCiogIEZyYW7Dp29pcyAnY2Fobm9yeScgR2VybWFpbgoqLwoudWktdG9vbHRpcCwgLnVpLXRvb2x0aXAtdG9wLCAudWktdG9vbHRpcC1yaWdodCwgLnVpLXRvb2x0aXAtYm90dG9tLCAudWktdG9vbHRpcC1sZWZ0IHsKCWNvbG9yOiNmZmZmZmY7CgljdXJzb3I6bm9ybWFsOwoJZGlzcGxheTotbW96LWlubGluZS1zdGFjazsKCWRpc3BsYXk6aW5saW5lLWJsb2NrOwoJZm9udC1zaXplOjEycHg7Cglmb250LWZhbWlseTphcmlhbDsKCXBhZGRpbmc6LjVlbSAxZW07Cglwb3NpdGlvbjpyZWxhdGl2ZTsKCXRleHQtYWxpZ246Y2VudGVyOwoJdGV4dC1zaGFkb3c6MCAtMXB4IDFweCAjMTExMTExOwoJLXdlYmtpdC1ib3JkZXItdG9wLWxlZnQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6NHB4IDsKCS1raHRtbC1ib3JkZXItdG9wLWxlZnQtcmFkaXVzOjRweCA7Cgkta2h0bWwtYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6NHB4IDsKCS1raHRtbC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czo0cHggOwoJLWtodG1sLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6NHB4IDsKCS1tb3otYm9yZGVyLXJhZGl1cy10b3BsZWZ0OjRweCA7CgktbW96LWJvcmRlci1yYWRpdXMtdG9wcmlnaHQ6NHB4IDsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDo0cHggOwoJLW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6NHB4IDsKCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6NHB4IDsKCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOjRweCA7Cglib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czo0cHggOwoJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czo0cHggOwoJLW8tYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCS1tb3otYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCS1raHRtbC1ib3gtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwLCBpbnNldCAwIDAgMCAxcHggIzIyMjIyMiwgaW5zZXQgMCAycHggIzY2NjY2NiwgaW5zZXQgMCAtMnB4IDJweCAjNDQ0NDQ0OwoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwLCBpbnNldCAwIDAgMCAxcHggIzIyMjIyMiwgaW5zZXQgMCAycHggIzY2NjY2NiwgaW5zZXQgMCAtMnB4IDJweCAjNDQ0NDQ0OwoJYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCWJhY2tncm91bmQtY29sb3I6IzNiM2IzYjsKCWJhY2tncm91bmQtaW1hZ2U6LW1vei1saW5lYXItZ3JhZGllbnQodG9wLCM1NTU1NTUsIzIyMjIyMik7CgliYWNrZ3JvdW5kLWltYWdlOi13ZWJraXQtZ3JhZGllbnQobGluZWFyLGxlZnQgdG9wLGxlZnQgYm90dG9tLGNvbG9yLXN0b3AoMCwjNTU1NTU1KSxjb2xvci1zdG9wKDEsIzIyMjIyMikpOwoJZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yU3RyPSM1NTU1NTUsRW5kQ29sb3JTdHI9IzIyMjIyMik7CgktbXMtZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yU3RyPSM1NTU1NTUsRW5kQ29sb3JTdHI9IzIyMjIyMik7Cn0KLnVpLXRvb2x0aXA6YWZ0ZXIsIC51aS10b29sdGlwLXRvcDphZnRlciwgLnVpLXRvb2x0aXAtcmlnaHQ6YWZ0ZXIsIC51aS10b29sdGlwLWJvdHRvbTphZnRlciwgLnVpLXRvb2x0aXAtbGVmdDphZnRlciB7Cgljb250ZW50OiJcMjVCOCI7CglkaXNwbGF5OmJsb2NrOwoJZm9udC1zaXplOjJlbTsKCWhlaWdodDowOwoJbGluZS1oZWlnaHQ6MDsKCXBvc2l0aW9uOmFic29sdXRlOwp9Ci51aS10b29sdGlwOmFmdGVyLCAudWktdG9vbHRpcC1ib3R0b206YWZ0ZXIgewoJY29sb3I6IzJhMmEyYTsKCWJvdHRvbTowOwoJbGVmdDoxcHg7Cgl0ZXh0LWFsaWduOmNlbnRlcjsKCXRleHQtc2hhZG93OjFweCAwIDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSg5MGRlZyk7CgktbW96LXRyYW5zZm9ybTpyb3RhdGUoOTBkZWcpOwoJLWtodG1sLXRyYW5zZm9ybTpyb3RhdGUoOTBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDkwZGVnKTsKCXdpZHRoOjEwMCU7Cn0KLnVpLXRvb2x0aXAtdG9wOmFmdGVyIHsKCWJvdHRvbTphdXRvOwoJY29sb3I6IzRmNGY0ZjsKCWxlZnQ6LTJweDsKCXRvcDowOwoJdGV4dC1hbGlnbjpjZW50ZXI7Cgl0ZXh0LXNoYWRvdzpub25lOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgtOTBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKC05MGRlZyk7Cgkta2h0bWwtdHJhbnNmb3JtOnJvdGF0ZSgtOTBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKC05MGRlZyk7Cgl3aWR0aDoxMDAlOwp9Ci51aS10b29sdGlwLXJpZ2h0OmFmdGVyIHsKCWNvbG9yOiMyMjIyMjI7CglyaWdodDotMC4zNzVlbTsKCXRvcDo1MCU7CgltYXJnaW4tdG9wOi0uMDVlbTsKCXRleHQtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgwKTsKCS1tb3otdHJhbnNmb3JtOnJvdGF0ZSgwKTsKCS1raHRtbC10cmFuc2Zvcm06cm90YXRlKDApOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDApOwp9Ci51aS10b29sdGlwLWxlZnQ6YWZ0ZXIgewoJY29sb3I6IzIyMjIyMjsKCWxlZnQ6LTAuMzc1ZW07Cgl0b3A6NTAlOwoJbWFyZ2luLXRvcDouMWVtOwoJdGV4dC1zaGFkb3c6MCAtMXB4IDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKDE4MGRlZyk7Cgkta2h0bWwtdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDE4MGRlZyk7Cn0KCgoKLyp0aGUgZm9sbG93aW5nIGNoYW5nZXMgcmVxdWlyZSBzb21lIGNsZWFudXAgYW5kIGludGVncmF0aW9uIHdpdGggdGhlIGFib3ZlLioqLwoKLyogbGluZSA5ICovCgoKLyogbGluZSAxNyAqLwojdG9kb2FwcCB7CgliYWNrZ3JvdW5kOiB3aGl0ZTsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMnB4IDZweCAwOwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7CgktbW96LWJvcmRlci1yYWRpdXMtYm90dG9tbGVmdDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7Cgktby1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7CgktbXMtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLW8tYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDVweDsKCS1tcy1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7Cglib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4Owp9Ci8qIGxpbmUgMjQgKi8KCgovKiBsaW5lIDMyICovCiN0b2RvYXBwIC5jb250ZW50ICNjcmVhdGUtdG9kbyB7Cglwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLyogbGluZSAzNCAqLwojdG9kb2FwcCAuY29udGVudCAjY3JlYXRlLXRvZG8gaW5wdXQgewoJZm9udC1zaXplOiAyNHB4OwoJZm9udC1mYW1pbHk6IGluaGVyaXQ7CglsaW5lLWhlaWdodDogMS40ZW07Cglib3JkZXI6IDA7CglvdXRsaW5lOiBub25lOwoJcGFkZGluZzogNnB4OwoJYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cn0KCi8qIGxpbmUgNDcgKi8KI3RvZG9hcHAgLmNvbnRlbnQgI2NyZWF0ZS10b2RvIHNwYW4gewoJcG9zaXRpb246IGFic29sdXRlOwoJei1pbmRleDogOTk5OwoJd2lkdGg6IDE3MHB4OwoJbGVmdDogNTAlOwoJbWFyZ2luLWxlZnQ6IC04NXB4Owp9Ci8qIGxpbmUgNTUgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IHsKCW1hcmdpbi10b3A6IDEwcHg7Cn0KLyogbGluZSA1NyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkgewoJcGFkZGluZzogMTVweCAyMHB4IDE1cHggMDsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCWZvbnQtc2l6ZTogMjRweDsKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjY2NjOwoJKnpvb206IDE7CgljdXJzb3I6IG1vdmU7Cn0KLyogbGluZSAyMiwgL29wdC9yZWUvbGliL3J1YnkvZ2Vtcy8xLjgvZ2Vtcy9jb21wYXNzLTAuMTAuNS9mcmFtZXdvcmtzL2NvbXBhc3Mvc3R5bGVzaGVldHMvY29tcGFzcy91dGlsaXRpZXMvZ2VuZXJhbC9fY2xlYXJmaXguc2NzcyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGk6YWZ0ZXIgewoJY29udGVudDogIlwwMDIwIjsKCWRpc3BsYXk6IGJsb2NrOwoJaGVpZ2h0OiAwOwoJY2xlYXI6IGJvdGg7CglvdmVyZmxvdzogaGlkZGVuOwoJdmlzaWJpbGl0eTogaGlkZGVuOwp9Ci8qIGxpbmUgNjQgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpLmVkaXRpbmcgewoJcGFkZGluZzogMDsKCWJvcmRlci1ib3R0b206IDA7Cn0KLyogbGluZSA2NyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkuZWRpdGluZyAudG9kby1pbnB1dCB7CglkaXNwbGF5OiBibG9jazsKCXdpZHRoOiA5NSU7Cglmb250LXNpemU6IDI0cHg7Cglmb250LWZhbWlseTogaW5oZXJpdDsKCWxpbmUtaGVpZ2h0OiAxLjRlbTsKCWJvcmRlcjogMDsKCW91dGxpbmU6IG5vbmU7CglwYWRkaW5nOiA2cHg7Cglib3JkZXI6IDFweCBzb2xpZCAjOTk5OTk5OwoJLW1vei1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cgktd2Via2l0LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCS1vLWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKfQovKiBsaW5lIDc5ICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaS5lZGl0aW5nIC50b2RvLWNvbnRlbnQgewoJZGlzcGxheTogbm9uZTsKfQovKiBsaW5lIDgxICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaS5lZGl0aW5nIC50b2RvLWNoZWNrIHsKCWRpc3BsYXk6IG5vbmU7Cn0KLyogbGluZSA4MyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkuZWRpdGluZyAudG9kby1kZXN0cm95IHsKCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQovKiBsaW5lIDg1ICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaSAudG9kby1pbnB1dCB7CglkaXNwbGF5OiBub25lOwp9Ci8qIGxpbmUgODcgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpIC50b2RvLWNoZWNrIHsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCXRvcDogNnB4OwoJbWFyZ2luOiAwIDEwcHggMCA3cHg7CglmbG9hdDogbGVmdDsKfQovKiBsaW5lIDkzICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaS5kb25lIC50b2RvLWNvbnRlbnQgewoJdGV4dC1kZWNvcmF0aW9uOiBsaW5lLXRocm91Z2g7Cgljb2xvcjogIzc3Nzc3NzsKfQovKiBsaW5lIDk2ICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaSAudG9kby1kZXN0cm95IHsKCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCXJpZ2h0OiAwcHg7Cgl0b3A6IDE2cHg7CglkaXNwbGF5OiBub25lOwoJY3Vyc29yOiBwb2ludGVyOwoJd2lkdGg6IDIwcHg7CgloZWlnaHQ6IDIwcHg7Cn0KLyogbGluZSAxMDYgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpOmhvdmVyIC50b2RvLWRlc3Ryb3kgewoJZGlzcGxheTogYmxvY2s7Cn0KLyogbGluZSAxMDkgKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgewoJKnpvb206IDE7CgltYXJnaW4tdG9wOiAxMHB4OwoJY29sb3I6ICM1NTU1NTU7CgktbW96LWJvcmRlci1yYWRpdXMtYm90dG9tbGVmdDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7Cgktby1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7CgktbXMtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLW8tYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDVweDsKCS1tcy1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7Cglib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJYmFja2dyb3VuZDogI2Y0ZmNlODsKCWJvcmRlci10b3A6IDFweCBzb2xpZCAjZWRlZGVkOwoJcGFkZGluZzogMCAyMHB4OwoJbGluZS1oZWlnaHQ6IDM2cHg7Cn0KLyogbGluZSAyMiwgL29wdC9yZWUvbGliL3J1YnkvZ2Vtcy8xLjgvZ2Vtcy9jb21wYXNzLTAuMTAuNS9mcmFtZXdvcmtzL2NvbXBhc3Mvc3R5bGVzaGVldHMvY29tcGFzcy91dGlsaXRpZXMvZ2VuZXJhbC9fY2xlYXJmaXguc2NzcyAqLwojdG9kb2FwcCAjdG9kby1zdGF0czphZnRlciB7Cgljb250ZW50OiAiXDAwMjAiOwoJZGlzcGxheTogYmxvY2s7CgloZWlnaHQ6IDA7CgljbGVhcjogYm90aDsKCW92ZXJmbG93OiBoaWRkZW47Cgl2aXNpYmlsaXR5OiBoaWRkZW47Cn0KLyogbGluZSAxMTggKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgLnRvZG8tY291bnQgewoJZmxvYXQ6IGxlZnQ7Cn0KLyogbGluZSAxMjAgKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgLnRvZG8tY291bnQgLm51bWJlciB7Cglmb250LXdlaWdodDogYm9sZDsKCWNvbG9yOiAjNTU1NTU1Owp9Ci8qIGxpbmUgMTIzICovCiN0b2RvYXBwICN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIHsKCWZsb2F0OiByaWdodDsKfQovKiBsaW5lIDEyNSAqLwojdG9kb2FwcCAjdG9kby1zdGF0cyAudG9kby1jbGVhciBhIHsKCWRpc3BsYXk6IGJsb2NrOwoJbGluZS1oZWlnaHQ6IDIwcHg7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgktbW96LWJvcmRlci1yYWRpdXM6IDEycHg7Cgktd2Via2l0LWJvcmRlci1yYWRpdXM6IDEycHg7Cgktby1ib3JkZXItcmFkaXVzOiAxMnB4OwoJLW1zLWJvcmRlci1yYWRpdXM6IDEycHg7Cgkta2h0bWwtYm9yZGVyLXJhZGl1czogMTJweDsKCWJvcmRlci1yYWRpdXM6IDEycHg7CgliYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMSk7Cgljb2xvcjogIzU1NTU1NTsKCWZvbnQtc2l6ZTogMTFweDsKCW1hcmdpbi10b3A6IDhweDsKCXBhZGRpbmc6IDAgMTBweCAxcHg7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIC0xcHggMCAwOwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAtMXB4IDAgMDsKCS1vLWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIC0xcHggMCAwOwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgLTFweCAwIDA7Cn0KLyogbGluZSAxMzYgKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgYTpob3ZlciB7CgliYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMTUpOwoJLW1vei1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMykgMCAtMXB4IDAgMDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjMpIDAgLTFweCAwIDA7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMykgMCAtMXB4IDAgMDsKCWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4zKSAwIC0xcHggMCAwOwp9Ci8qIGxpbmUgMTM5ICovCiN0b2RvYXBwICN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGE6YWN0aXZlIHsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCXRvcDogMXB4Owp9CgoKLyogdG9kb212YyBlbmQgKi8KCgoKLyogPT18PT0gbm9uLXNlbWFudGljIGhlbHBlciBjbGFzc2VzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgUGxlYXNlIGRlZmluZSB5b3VyIHN0eWxlcyBiZWZvcmUgdGhpcyBzZWN0aW9uLgogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKLyogRm9yIGltYWdlIHJlcGxhY2VtZW50ICovCi5pciB7IGRpc3BsYXk6IGJsb2NrOyBib3JkZXI6IDA7IHRleHQtaW5kZW50OiAtOTk5ZW07IG92ZXJmbG93OiBoaWRkZW47IGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OyBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OyB0ZXh0LWFsaWduOiBsZWZ0OyBkaXJlY3Rpb246IGx0cjsgKmxpbmUtaGVpZ2h0OiAwOyB9Ci5pciBiciB7IGRpc3BsYXk6IG5vbmU7IH0KCi8qIEhpZGUgZnJvbSBib3RoIHNjcmVlbnJlYWRlcnMgYW5kIGJyb3dzZXJzOiBoNWJwLmNvbS91ICovCi5oaWRkZW4geyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IHZpc2liaWxpdHk6IGhpZGRlbjsgfQoKLyogSGlkZSBvbmx5IHZpc3VhbGx5LCBidXQgaGF2ZSBpdCBhdmFpbGFibGUgZm9yIHNjcmVlbnJlYWRlcnM6IGg1YnAuY29tL3YgKi8KLnZpc3VhbGx5aGlkZGVuIHsgYm9yZGVyOiAwOyBjbGlwOiByZWN0KDAgMCAwIDApOyBoZWlnaHQ6IDFweDsgbWFyZ2luOiAtMXB4OyBvdmVyZmxvdzogaGlkZGVuOyBwYWRkaW5nOiAwOyBwb3NpdGlvbjogYWJzb2x1dGU7IHdpZHRoOiAxcHg7IH0KCi8qIEV4dGVuZHMgdGhlIC52aXN1YWxseWhpZGRlbiBjbGFzcyB0byBhbGxvdyB0aGUgZWxlbWVudCB0byBiZSBmb2N1c2FibGUgd2hlbiBuYXZpZ2F0ZWQgdG8gdmlhIHRoZSBrZXlib2FyZDogaDVicC5jb20vcCAqLwoudmlzdWFsbHloaWRkZW4uZm9jdXNhYmxlOmFjdGl2ZSwgLnZpc3VhbGx5aGlkZGVuLmZvY3VzYWJsZTpmb2N1cyB7IGNsaXA6IGF1dG87IGhlaWdodDogYXV0bzsgbWFyZ2luOiAwOyBvdmVyZmxvdzogdmlzaWJsZTsgcG9zaXRpb246IHN0YXRpYzsgd2lkdGg6IGF1dG87IH0KCi8qIEhpZGUgdmlzdWFsbHkgYW5kIGZyb20gc2NyZWVucmVhZGVycywgYnV0IG1haW50YWluIGxheW91dCAqLwouaW52aXNpYmxlIHsgdmlzaWJpbGl0eTogaGlkZGVuOyB9CgovKiBDb250YWluIGZsb2F0czogaDVicC5jb20vcSAqLwouY2xlYXJmaXg6YmVmb3JlLCAuY2xlYXJmaXg6YWZ0ZXIgeyBjb250ZW50OiAiIjsgZGlzcGxheTogdGFibGU7IH0KLmNsZWFyZml4OmFmdGVyIHsgY2xlYXI6IGJvdGg7IH0KLmNsZWFyZml4IHsgKnpvb206IDE7IH0KCgoKLyogPT18PT0gcHJpbnQgc3R5bGVzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgUHJpbnQgc3R5bGVzLgogICBJbmxpbmVkIHRvIGF2b2lkIHJlcXVpcmVkIEhUVFAgY29ubmVjdGlvbjogaDVicC5jb20vcgogICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKQG1lZGlhIHByaW50IHsKICAqIHsgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQgIWltcG9ydGFudDsgY29sb3I6IGJsYWNrICFpbXBvcnRhbnQ7IGJveC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50OyB0ZXh0LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50OyBmaWx0ZXI6bm9uZSAhaW1wb3J0YW50OyAtbXMtZmlsdGVyOiBub25lICFpbXBvcnRhbnQ7IH0gLyogQmxhY2sgcHJpbnRzIGZhc3RlcjogaDVicC5jb20vcyAqLwogIGEsIGE6dmlzaXRlZCB7IHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOyB9CiAgYVtocmVmXTphZnRlciB7IGNvbnRlbnQ6ICIgKCIgYXR0cihocmVmKSAiKSI7IH0KICBhYmJyW3RpdGxlXTphZnRlciB7IGNvbnRlbnQ6ICIgKCIgYXR0cih0aXRsZSkgIikiOyB9CiAgLmlyIGE6YWZ0ZXIsIGFbaHJlZl49ImphdmFzY3JpcHQ6Il06YWZ0ZXIsIGFbaHJlZl49IiMiXTphZnRlciB7IGNvbnRlbnQ6ICIiOyB9ICAvKiBEb24ndCBzaG93IGxpbmtzIGZvciBpbWFnZXMsIG9yIGphdmFzY3JpcHQvaW50ZXJuYWwgbGlua3MgKi8KICBwcmUsIGJsb2NrcXVvdGUgeyBib3JkZXI6IDFweCBzb2xpZCAjOTk5OyBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7IH0KICB0aGVhZCB7IGRpc3BsYXk6IHRhYmxlLWhlYWRlci1ncm91cDsgfSAvKiBoNWJwLmNvbS90ICovCiAgdHIsIGltZyB7IHBhZ2UtYnJlYWstaW5zaWRlOiBhdm9pZDsgfQogIGltZyB7IG1heC13aWR0aDogMTAwJSAhaW1wb3J0YW50OyB9CiAgQHBhZ2UgeyBtYXJnaW46IDAuNWNtOyB9CiAgcCwgaDIsIGgzIHsgb3JwaGFuczogMzsgd2lkb3dzOiAzOyB9CiAgaDIsIGgzIHsgcGFnZS1icmVhay1hZnRlcjogYXZvaWQ7IH0KfQo=", "content_type": "text/css"}, "test/jasmine/vendor/jasmine-html.js": {"data": "amFzbWluZS5Ucml2aWFsUmVwb3J0ZXIgPSBmdW5jdGlvbihkb2MpIHsKICB0aGlzLmRvY3VtZW50ID0gZG9jIHx8IGRvY3VtZW50OwogIHRoaXMuc3VpdGVEaXZzID0ge307CiAgdGhpcy5sb2dSdW5uaW5nU3BlY3MgPSBmYWxzZTsKfTsKCmphc21pbmUuVHJpdmlhbFJlcG9ydGVyLnByb3RvdHlwZS5jcmVhdGVEb20gPSBmdW5jdGlvbih0eXBlLCBhdHRycywgY2hpbGRyZW5WYXJBcmdzKSB7CiAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTsKCiAgZm9yICh2YXIgaSA9IDI7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBjaGlsZCA9IGFyZ3VtZW50c1tpXTsKCiAgICBpZiAodHlwZW9mIGNoaWxkID09PSAnc3RyaW5nJykgewogICAgICBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjaGlsZCkpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGNoaWxkKSB7IGVsLmFwcGVuZENoaWxkKGNoaWxkKTsgfQogICAgfQogIH0KCiAgZm9yICh2YXIgYXR0ciBpbiBhdHRycykgewogICAgaWYgKGF0dHIgPT0gImNsYXNzTmFtZSIpIHsKICAgICAgZWxbYXR0cl0gPSBhdHRyc1thdHRyXTsKICAgIH0gZWxzZSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZShhdHRyLCBhdHRyc1thdHRyXSk7CiAgICB9CiAgfQoKICByZXR1cm4gZWw7Cn07CgpqYXNtaW5lLlRyaXZpYWxSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0UnVubmVyU3RhcnRpbmcgPSBmdW5jdGlvbihydW5uZXIpIHsKICB2YXIgc2hvd1Bhc3NlZCwgc2hvd1NraXBwZWQ7CgogIHRoaXMub3V0ZXJEaXYgPSB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdqYXNtaW5lX3JlcG9ydGVyJyB9LAogICAgICB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdiYW5uZXInIH0sCiAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAnbG9nbycgfSwKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ3RpdGxlJyB9LCAiSmFzbWluZSIpLAogICAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHsgY2xhc3NOYW1lOiAndmVyc2lvbicgfSwgcnVubmVyLmVudi52ZXJzaW9uU3RyaW5nKCkpKSwKICAgICAgICB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdvcHRpb25zJyB9LAogICAgICAgICAgICAiU2hvdyAiLAogICAgICAgICAgICBzaG93UGFzc2VkID0gdGhpcy5jcmVhdGVEb20oJ2lucHV0JywgeyBpZDogIl9famFzbWluZV9Ucml2aWFsUmVwb3J0ZXJfc2hvd1Bhc3NlZF9fIiwgdHlwZTogJ2NoZWNrYm94JyB9KSwKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2xhYmVsJywgeyAiZm9yIjogIl9famFzbWluZV9Ucml2aWFsUmVwb3J0ZXJfc2hvd1Bhc3NlZF9fIiB9LCAiIHBhc3NlZCAiKSwKICAgICAgICAgICAgc2hvd1NraXBwZWQgPSB0aGlzLmNyZWF0ZURvbSgnaW5wdXQnLCB7IGlkOiAiX19qYXNtaW5lX1RyaXZpYWxSZXBvcnRlcl9zaG93U2tpcHBlZF9fIiwgdHlwZTogJ2NoZWNrYm94JyB9KSwKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2xhYmVsJywgeyAiZm9yIjogIl9famFzbWluZV9Ucml2aWFsUmVwb3J0ZXJfc2hvd1NraXBwZWRfXyIgfSwgIiBza2lwcGVkIikKICAgICAgICAgICAgKQogICAgICAgICAgKSwKCiAgICAgIHRoaXMucnVubmVyRGl2ID0gdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAncnVubmVyIHJ1bm5pbmcnIH0sCiAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnYScsIHsgY2xhc3NOYW1lOiAncnVuX3NwZWMnLCBocmVmOiAnPycgfSwgInJ1biBhbGwiKSwKICAgICAgICAgIHRoaXMucnVubmVyTWVzc2FnZVNwYW4gPSB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHt9LCAiUnVubmluZy4uLiIpLAogICAgICAgICAgdGhpcy5maW5pc2hlZEF0U3BhbiA9IHRoaXMuY3JlYXRlRG9tKCdzcGFuJywgeyBjbGFzc05hbWU6ICdmaW5pc2hlZC1hdCcgfSwgIiIpKQogICAgICApOwoKICB0aGlzLmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5vdXRlckRpdik7CgogIHZhciBzdWl0ZXMgPSBydW5uZXIuc3VpdGVzKCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWl0ZXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzdWl0ZSA9IHN1aXRlc1tpXTsKICAgIHZhciBzdWl0ZURpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ3N1aXRlJyB9LAogICAgICAgIHRoaXMuY3JlYXRlRG9tKCdhJywgeyBjbGFzc05hbWU6ICdydW5fc3BlYycsIGhyZWY6ICc/c3BlYz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHN1aXRlLmdldEZ1bGxOYW1lKCkpIH0sICJydW4iKSwKICAgICAgICB0aGlzLmNyZWF0ZURvbSgnYScsIHsgY2xhc3NOYW1lOiAnZGVzY3JpcHRpb24nLCBocmVmOiAnP3NwZWM9JyArIGVuY29kZVVSSUNvbXBvbmVudChzdWl0ZS5nZXRGdWxsTmFtZSgpKSB9LCBzdWl0ZS5kZXNjcmlwdGlvbikpOwogICAgdGhpcy5zdWl0ZURpdnNbc3VpdGUuaWRdID0gc3VpdGVEaXY7CiAgICB2YXIgcGFyZW50RGl2ID0gdGhpcy5vdXRlckRpdjsKICAgIGlmIChzdWl0ZS5wYXJlbnRTdWl0ZSkgewogICAgICBwYXJlbnREaXYgPSB0aGlzLnN1aXRlRGl2c1tzdWl0ZS5wYXJlbnRTdWl0ZS5pZF07CiAgICB9CiAgICBwYXJlbnREaXYuYXBwZW5kQ2hpbGQoc3VpdGVEaXYpOwogIH0KCiAgdGhpcy5zdGFydGVkQXQgPSBuZXcgRGF0ZSgpOwoKICB2YXIgc2VsZiA9IHRoaXM7CiAgc2hvd1Bhc3NlZC5vbmNsaWNrID0gZnVuY3Rpb24oZXZ0KSB7CiAgICBpZiAoc2hvd1Bhc3NlZC5jaGVja2VkKSB7CiAgICAgIHNlbGYub3V0ZXJEaXYuY2xhc3NOYW1lICs9ICcgc2hvdy1wYXNzZWQnOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi5vdXRlckRpdi5jbGFzc05hbWUgPSBzZWxmLm91dGVyRGl2LmNsYXNzTmFtZS5yZXBsYWNlKC8gc2hvdy1wYXNzZWQvLCAnJyk7CiAgICB9CiAgfTsKCiAgc2hvd1NraXBwZWQub25jbGljayA9IGZ1bmN0aW9uKGV2dCkgewogICAgaWYgKHNob3dTa2lwcGVkLmNoZWNrZWQpIHsKICAgICAgc2VsZi5vdXRlckRpdi5jbGFzc05hbWUgKz0gJyBzaG93LXNraXBwZWQnOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi5vdXRlckRpdi5jbGFzc05hbWUgPSBzZWxmLm91dGVyRGl2LmNsYXNzTmFtZS5yZXBsYWNlKC8gc2hvdy1za2lwcGVkLywgJycpOwogICAgfQogIH07Cn07CgpqYXNtaW5lLlRyaXZpYWxSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0UnVubmVyUmVzdWx0cyA9IGZ1bmN0aW9uKHJ1bm5lcikgewogIHZhciByZXN1bHRzID0gcnVubmVyLnJlc3VsdHMoKTsKICB2YXIgY2xhc3NOYW1lID0gKHJlc3VsdHMuZmFpbGVkQ291bnQgPiAwKSA/ICJydW5uZXIgZmFpbGVkIiA6ICJydW5uZXIgcGFzc2VkIjsKICB0aGlzLnJ1bm5lckRpdi5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgY2xhc3NOYW1lKTsKICAvL2RvIGl0IHR3aWNlIGZvciBJRQogIHRoaXMucnVubmVyRGl2LnNldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIiwgY2xhc3NOYW1lKTsKICB2YXIgc3BlY3MgPSBydW5uZXIuc3BlY3MoKTsKICB2YXIgc3BlY0NvdW50ID0gMDsKICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWNzLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAodGhpcy5zcGVjRmlsdGVyKHNwZWNzW2ldKSkgewogICAgICBzcGVjQ291bnQrKzsKICAgIH0KICB9CiAgdmFyIG1lc3NhZ2UgPSAiIiArIHNwZWNDb3VudCArICIgc3BlYyIgKyAoc3BlY0NvdW50ID09IDEgPyAiIiA6ICJzIiApICsgIiwgIiArIHJlc3VsdHMuZmFpbGVkQ291bnQgKyAiIGZhaWx1cmUiICsgKChyZXN1bHRzLmZhaWxlZENvdW50ID09IDEpID8gIiIgOiAicyIpOwogIG1lc3NhZ2UgKz0gIiBpbiAiICsgKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuc3RhcnRlZEF0LmdldFRpbWUoKSkgLyAxMDAwKSArICJzIjsKICB0aGlzLnJ1bm5lck1lc3NhZ2VTcGFuLnJlcGxhY2VDaGlsZCh0aGlzLmNyZWF0ZURvbSgnYScsIHsgY2xhc3NOYW1lOiAnZGVzY3JpcHRpb24nLCBocmVmOiAnPyd9LCBtZXNzYWdlKSwgdGhpcy5ydW5uZXJNZXNzYWdlU3Bhbi5maXJzdENoaWxkKTsKCiAgdGhpcy5maW5pc2hlZEF0U3Bhbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiRmluaXNoZWQgYXQgIiArIG5ldyBEYXRlKCkudG9TdHJpbmcoKSkpOwp9OwoKamFzbWluZS5Ucml2aWFsUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFN1aXRlUmVzdWx0cyA9IGZ1bmN0aW9uKHN1aXRlKSB7CiAgdmFyIHJlc3VsdHMgPSBzdWl0ZS5yZXN1bHRzKCk7CiAgdmFyIHN0YXR1cyA9IHJlc3VsdHMucGFzc2VkKCkgPyAncGFzc2VkJyA6ICdmYWlsZWQnOwogIGlmIChyZXN1bHRzLnRvdGFsQ291bnQgPT09IDApIHsgLy8gdG9kbzogY2hhbmdlIHRoaXMgdG8gY2hlY2sgcmVzdWx0cy5za2lwcGVkCiAgICBzdGF0dXMgPSAnc2tpcHBlZCc7CiAgfQogIHRoaXMuc3VpdGVEaXZzW3N1aXRlLmlkXS5jbGFzc05hbWUgKz0gIiAiICsgc3RhdHVzOwp9OwoKamFzbWluZS5Ucml2aWFsUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFNwZWNTdGFydGluZyA9IGZ1bmN0aW9uKHNwZWMpIHsKICBpZiAodGhpcy5sb2dSdW5uaW5nU3BlY3MpIHsKICAgIHRoaXMubG9nKCc+PiBKYXNtaW5lIFJ1bm5pbmcgJyArIHNwZWMuc3VpdGUuZGVzY3JpcHRpb24gKyAnICcgKyBzcGVjLmRlc2NyaXB0aW9uICsgJy4uLicpOwogIH0KfTsKCmphc21pbmUuVHJpdmlhbFJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRTcGVjUmVzdWx0cyA9IGZ1bmN0aW9uKHNwZWMpIHsKICB2YXIgcmVzdWx0cyA9IHNwZWMucmVzdWx0cygpOwogIHZhciBzdGF0dXMgPSByZXN1bHRzLnBhc3NlZCgpID8gJ3Bhc3NlZCcgOiAnZmFpbGVkJzsKICBpZiAocmVzdWx0cy5za2lwcGVkKSB7CiAgICBzdGF0dXMgPSAnc2tpcHBlZCc7CiAgfQogIHZhciBzcGVjRGl2ID0gdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAnc3BlYyAnICArIHN0YXR1cyB9LAogICAgICB0aGlzLmNyZWF0ZURvbSgnYScsIHsgY2xhc3NOYW1lOiAncnVuX3NwZWMnLCBocmVmOiAnP3NwZWM9JyArIGVuY29kZVVSSUNvbXBvbmVudChzcGVjLmdldEZ1bGxOYW1lKCkpIH0sICJydW4iKSwKICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7CiAgICAgICAgY2xhc3NOYW1lOiAnZGVzY3JpcHRpb24nLAogICAgICAgIGhyZWY6ICc/c3BlYz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHNwZWMuZ2V0RnVsbE5hbWUoKSksCiAgICAgICAgdGl0bGU6IHNwZWMuZ2V0RnVsbE5hbWUoKQogICAgICB9LCBzcGVjLmRlc2NyaXB0aW9uKSk7CgoKICB2YXIgcmVzdWx0SXRlbXMgPSByZXN1bHRzLmdldEl0ZW1zKCk7CiAgdmFyIG1lc3NhZ2VzRGl2ID0gdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAnbWVzc2FnZXMnIH0pOwogIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0SXRlbXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciByZXN1bHQgPSByZXN1bHRJdGVtc1tpXTsKCiAgICBpZiAocmVzdWx0LnR5cGUgPT0gJ2xvZycpIHsKICAgICAgbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVEb20oJ2RpdicsIHtjbGFzc05hbWU6ICdyZXN1bHRNZXNzYWdlIGxvZyd9LCByZXN1bHQudG9TdHJpbmcoKSkpOwogICAgfSBlbHNlIGlmIChyZXN1bHQudHlwZSA9PSAnZXhwZWN0JyAmJiByZXN1bHQucGFzc2VkICYmICFyZXN1bHQucGFzc2VkKCkpIHsKICAgICAgbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVEb20oJ2RpdicsIHtjbGFzc05hbWU6ICdyZXN1bHRNZXNzYWdlIGZhaWwnfSwgcmVzdWx0Lm1lc3NhZ2UpKTsKCiAgICAgIGlmIChyZXN1bHQudHJhY2Uuc3RhY2spIHsKICAgICAgICBtZXNzYWdlc0Rpdi5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZURvbSgnZGl2Jywge2NsYXNzTmFtZTogJ3N0YWNrVHJhY2UnfSwgcmVzdWx0LnRyYWNlLnN0YWNrKSk7CiAgICAgIH0KICAgIH0KICB9CgogIGlmIChtZXNzYWdlc0Rpdi5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgIHNwZWNEaXYuYXBwZW5kQ2hpbGQobWVzc2FnZXNEaXYpOwogIH0KCiAgdGhpcy5zdWl0ZURpdnNbc3BlYy5zdWl0ZS5pZF0uYXBwZW5kQ2hpbGQoc3BlY0Rpdik7Cn07CgpqYXNtaW5lLlRyaXZpYWxSZXBvcnRlci5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNvbnNvbGUgPSBqYXNtaW5lLmdldEdsb2JhbCgpLmNvbnNvbGU7CiAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHsKICAgIGlmIChjb25zb2xlLmxvZy5hcHBseSkgewogICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzKTsgLy8gaWUgZml4OiBjb25zb2xlLmxvZy5hcHBseSBkb2Vzbid0IGV4aXN0IG9uIGllCiAgICB9CiAgfQp9OwoKamFzbWluZS5Ucml2aWFsUmVwb3J0ZXIucHJvdG90eXBlLmdldExvY2F0aW9uID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuZG9jdW1lbnQubG9jYXRpb247Cn07CgpqYXNtaW5lLlRyaXZpYWxSZXBvcnRlci5wcm90b3R5cGUuc3BlY0ZpbHRlciA9IGZ1bmN0aW9uKHNwZWMpIHsKICB2YXIgcGFyYW1NYXAgPSB7fTsKICB2YXIgcGFyYW1zID0gdGhpcy5nZXRMb2NhdGlvbigpLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgdmFyIHAgPSBwYXJhbXNbaV0uc3BsaXQoJz0nKTsKICAgIHBhcmFtTWFwW2RlY29kZVVSSUNvbXBvbmVudChwWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocFsxXSk7CiAgfQoKICBpZiAoIXBhcmFtTWFwLnNwZWMpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gc3BlYy5nZXRGdWxsTmFtZSgpLmluZGV4T2YocGFyYW1NYXAuc3BlYykgPT09IDA7Cn07Cg==", "content_type": "application/javascript"}, "app/modules/item.js": {"data": "ZGVmaW5lKFsKICAibmFtZXNwYWNlIiwKCiAgLy8gTGlicwogICJ1c2UhYmFja2JvbmUiLAogICJ1c2UhYmFja2JvbmVfY291Y2hkYiIKCiAgLy8gTW9kdWxlcwoKICAvLyBQbHVnaW5zCl0sCgpmdW5jdGlvbihuYW1lc3BhY2UsIEJhY2tib25lKSB7CgogIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUKICB2YXIgSXRlbSA9IG5hbWVzcGFjZS5tb2R1bGUoKTsKCiAgLy8gSXRlbSBleHRlbmRpbmdzCiAgSXRlbS5Nb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7IC8qIC4uLiAqLyB9KTsKICBJdGVtLkNvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CgkJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CgkJCXRoaXMucGFnZSA9IDE7CgkJfSwKCQlkYiA6IHsKCQkJdmlldzogImJ5SWQiLAoJCX0sCgkJdXJsIDogIi9pdGVtIiwKCQltb2RlbCA6IEl0ZW0KCX0pOwogIEl0ZW0uUm91dGVyID0gQmFja2JvbmUuUm91dGVyLmV4dGVuZCh7IC8qIC4uLiAqLyB9KTsKCiAgLy8gVGhpcyB3aWxsIGZldGNoIHRoZSB0dXRvcmlhbCB0ZW1wbGF0ZSBhbmQgcmVuZGVyIGl0LgogIEl0ZW0uVmlld3MuVHV0b3JpYWwgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICB0ZW1wbGF0ZTogImFwcC90ZW1wbGF0ZXMvaXRlbS5odG1sIiwKCiAgICByZW5kZXI6IGZ1bmN0aW9uKGRvbmUpIHsKICAgICAgdmFyIHZpZXcgPSB0aGlzOwoKICAgICAgLy8gRmV0Y2ggdGhlIHRlbXBsYXRlLCByZW5kZXIgaXQgdG8gdGhlIFZpZXcgZWxlbWVudCBhbmQgY2FsbCBkb25lLgogICAgICBuYW1lc3BhY2UuZmV0Y2hUZW1wbGF0ZSh0aGlzLnRlbXBsYXRlLCBmdW5jdGlvbih0bXBsKSB7CiAgICAgICAgdmlldy5lbC5pbm5lckhUTUwgPSB0bXBsKCk7CgogICAgICAgIC8vIElmIGEgZG9uZSBmdW5jdGlvbiBpcyBwYXNzZWQsIGNhbGwgaXQgd2l0aCB0aGUgZWxlbWVudAogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oZG9uZSkpIHsKICAgICAgICAgIGRvbmUodmlldy5lbCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gUmVxdWlyZWQsIHJldHVybiB0aGUgbW9kdWxlIGZvciBBTUQgY29tcGxpYW5jZQogIHJldHVybiBJdGVtOwoKfSk7Cg==", "content_type": "application/javascript"}, "assets/js/plugins/text.js": {"data": "LyoKIFJlcXVpcmVKUyB0ZXh0IDEuMC42IENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBUaGUgRG9qbyBGb3VuZGF0aW9uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogc2VlOiBodHRwOi8vZ2l0aHViLmNvbS9qcmJ1cmtlL3JlcXVpcmVqcyBmb3IgZGV0YWlscwoqLwooZnVuY3Rpb24oKXt2YXIgaz1bIk1zeG1sMi5YTUxIVFRQIiwiTWljcm9zb2Z0LlhNTEhUVFAiLCJNc3htbDIuWE1MSFRUUC40LjAiXSxuPS9eXHMqPFw/eG1sKFxzKSt2ZXJzaW9uPVtcJ1wiXShcZCkqLihcZCkqW1wnXCJdKFxzKSpcPz4vaW0sbz0vPGJvZHlbXj5dKj5ccyooW1xzXFNdKylccyo8XC9ib2R5Pi9pbSxpPXR5cGVvZiBsb2NhdGlvbiE9PSJ1bmRlZmluZWQiJiZsb2NhdGlvbi5ocmVmLHA9aSYmbG9jYXRpb24ucHJvdG9jb2wmJmxvY2F0aW9uLnByb3RvY29sLnJlcGxhY2UoL1w6LywiIikscT1pJiZsb2NhdGlvbi5ob3N0bmFtZSxyPWkmJihsb2NhdGlvbi5wb3J0fHx2b2lkIDApLGo9W107ZGVmaW5lKGZ1bmN0aW9uKCl7dmFyIGcsaCxsO3R5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIiYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93LmRvY3VtZW50P2g9ZnVuY3Rpb24oYSxjKXt2YXIgYj1nLmNyZWF0ZVhocigpO2Iub3BlbigiR0VUIixhLCEwKTtiLm9ucmVhZHlzdGF0ZWNoYW5nZT0KZnVuY3Rpb24oKXtiLnJlYWR5U3RhdGU9PT00JiZjKGIucmVzcG9uc2VUZXh0KX07Yi5zZW5kKG51bGwpfTp0eXBlb2YgcHJvY2VzcyE9PSJ1bmRlZmluZWQiJiZwcm9jZXNzLnZlcnNpb25zJiZwcm9jZXNzLnZlcnNpb25zLm5vZGU/KGw9cmVxdWlyZS5ub2RlUmVxdWlyZSgiZnMiKSxoPWZ1bmN0aW9uKGEsYyl7dmFyIGI9bC5yZWFkRmlsZVN5bmMoYSwidXRmOCIpO2IuaW5kZXhPZigiXHVmZWZmIik9PT0wJiYoYj1iLnN1YnN0cmluZygxKSk7YyhiKX0pOnR5cGVvZiBQYWNrYWdlcyE9PSJ1bmRlZmluZWQiJiYoaD1mdW5jdGlvbihhLGMpe3ZhciBiPW5ldyBqYXZhLmlvLkZpbGUoYSksZT1qYXZhLmxhbmcuU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNlcGFyYXRvciIpLGI9bmV3IGphdmEuaW8uQnVmZmVyZWRSZWFkZXIobmV3IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFkZXIobmV3IGphdmEuaW8uRmlsZUlucHV0U3RyZWFtKGIpLCJ1dGYtOCIpKSxkLGYsZz0iIjt0cnl7ZD1uZXcgamF2YS5sYW5nLlN0cmluZ0J1ZmZlcjsKKGY9Yi5yZWFkTGluZSgpKSYmZi5sZW5ndGgoKSYmZi5jaGFyQXQoMCk9PT02NTI3OSYmKGY9Zi5zdWJzdHJpbmcoMSkpO2ZvcihkLmFwcGVuZChmKTsoZj1iLnJlYWRMaW5lKCkpIT09bnVsbDspZC5hcHBlbmQoZSksZC5hcHBlbmQoZik7Zz1TdHJpbmcoZC50b1N0cmluZygpKX1maW5hbGx5e2IuY2xvc2UoKX1jKGcpfSk7cmV0dXJuIGc9e3ZlcnNpb246IjEuMC42IixzdHJpcDpmdW5jdGlvbihhKXtpZihhKXt2YXIgYT1hLnJlcGxhY2UobiwiIiksYz1hLm1hdGNoKG8pO2MmJihhPWNbMV0pfWVsc2UgYT0iIjtyZXR1cm4gYX0sanNFc2NhcGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFsnXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvW1xmXS9nLCJcXGYiKS5yZXBsYWNlKC9bXGJdL2csIlxcYiIpLnJlcGxhY2UoL1tcbl0vZywiXFxuIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXHJdL2csIlxcciIpfSxjcmVhdGVYaHI6ZnVuY3Rpb24oKXt2YXIgYSxjLApiO2lmKHR5cGVvZiBYTUxIdHRwUmVxdWVzdCE9PSJ1bmRlZmluZWQiKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7ZWxzZSBmb3IoYz0wO2M8MztjKyspe2I9a1tjXTt0cnl7YT1uZXcgQWN0aXZlWE9iamVjdChiKX1jYXRjaChlKXt9aWYoYSl7az1bYl07YnJlYWt9fWlmKCFhKXRocm93IEVycm9yKCJjcmVhdGVYaHIoKTogWE1MSHR0cFJlcXVlc3Qgbm90IGF2YWlsYWJsZSIpO3JldHVybiBhfSxnZXQ6aCxwYXJzZU5hbWU6ZnVuY3Rpb24oYSl7dmFyIGM9ITEsYj1hLmluZGV4T2YoIi4iKSxlPWEuc3Vic3RyaW5nKDAsYiksYT1hLnN1YnN0cmluZyhiKzEsYS5sZW5ndGgpLGI9YS5pbmRleE9mKCIhIik7YiE9PS0xJiYoYz1hLnN1YnN0cmluZyhiKzEsYS5sZW5ndGgpLGM9Yz09PSJzdHJpcCIsYT1hLnN1YnN0cmluZygwLGIpKTtyZXR1cm57bW9kdWxlTmFtZTplLGV4dDphLHN0cmlwOmN9fSx4ZFJlZ0V4cDovXigoXHcrKVw6KT9cL1wvKFteXC9cXF0rKS8sdXNlWGhyOmZ1bmN0aW9uKGEsCmMsYixlKXt2YXIgZD1nLnhkUmVnRXhwLmV4ZWMoYSksZjtpZighZClyZXR1cm4hMDthPWRbMl07ZD1kWzNdO2Q9ZC5zcGxpdCgiOiIpO2Y9ZFsxXTtkPWRbMF07cmV0dXJuKCFhfHxhPT09YykmJighZHx8ZD09PWIpJiYoIWYmJiFkfHxmPT09ZSl9LGZpbmlzaExvYWQ6ZnVuY3Rpb24oYSxjLGIsZSxkKXtiPWM/Zy5zdHJpcChiKTpiO2QuaXNCdWlsZCYmKGpbYV09Yik7ZShiKX0sbG9hZDpmdW5jdGlvbihhLGMsYixlKXtpZihlLmlzQnVpbGQmJiFlLmlubGluZVRleHQpYigpO2Vsc2V7dmFyIGQ9Zy5wYXJzZU5hbWUoYSksZj1kLm1vZHVsZU5hbWUrIi4iK2QuZXh0LG09Yy50b1VybChmKSxoPWUmJmUudGV4dCYmZS50ZXh0LnVzZVhocnx8Zy51c2VYaHI7IWl8fGgobSxwLHEscik/Zy5nZXQobSxmdW5jdGlvbihjKXtnLmZpbmlzaExvYWQoYSxkLnN0cmlwLGMsYixlKX0pOmMoW2ZdLGZ1bmN0aW9uKGEpe2cuZmluaXNoTG9hZChkLm1vZHVsZU5hbWUrIi4iK2QuZXh0LGQuc3RyaXAsYSwKYixlKX0pfX0sd3JpdGU6ZnVuY3Rpb24oYSxjLGIpe2lmKGMgaW4gail7dmFyIGU9Zy5qc0VzY2FwZShqW2NdKTtiLmFzTW9kdWxlKGErIiEiK2MsImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIitlKyInO30pO1xuIil9fSx3cml0ZUZpbGU6ZnVuY3Rpb24oYSxjLGIsZSxkKXt2YXIgYz1nLnBhcnNlTmFtZShjKSxmPWMubW9kdWxlTmFtZSsiLiIrYy5leHQsaD1iLnRvVXJsKGMubW9kdWxlTmFtZSsiLiIrYy5leHQpKyIuanMiO2cubG9hZChmLGIsZnVuY3Rpb24oKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm4gZShoLGEpfTtiLmFzTW9kdWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuYXNNb2R1bGUoYSxoLGIpfTtnLndyaXRlKGEsZixiLGQpfSxkKX19fSl9KSgpOwo=", "content_type": "application/javascript"}, "app/config.js": {"data": "CgkvLyBTZXQgdGhlIHJlcXVpcmUuanMgY29uZmlndXJhdGlvbiBmb3IgeW91ciBhcHBsaWNhdGlvbi4KcmVxdWlyZS5jb25maWcoewogIC8vIEluaXRpYWxpemUgdGhlIGFwcGxpY2F0aW9uIHdpdGggdGhlIG1haW4gYXBwbGljYXRpb24gZmlsZQogIGRlcHM6IFsibWFpbiJdLAoKICBwYXRoczogewogICAgLy8gSmF2YVNjcmlwdCBmb2xkZXJzCiAgICBsaWJzOiAiLi4vYXNzZXRzL2pzL2xpYnMiLAogICAgcGx1Z2luczogIi4uL2Fzc2V0cy9qcy9wbHVnaW5zIiwKCiAgICAvLyBMaWJyYXJpZXMKICAgIGpxdWVyeTogIi4uL2Fzc2V0cy9qcy9saWJzL2pxdWVyeSIsCiAgICB1bmRlcnNjb3JlOiAiLi4vYXNzZXRzL2pzL2xpYnMvdW5kZXJzY29yZSIsCiAgICBiYWNrYm9uZTogIi4uL2Fzc2V0cy9qcy9saWJzL2JhY2tib25lLWZ1bGwiLAogICAgYmFja2JvbmVfY291Y2hkYjogIi4uL2Fzc2V0cy9qcy9saWJzL2JhY2tib25lLWNvdWNoZGIiLCAvLyBodHRwczovL2dpdGh1Yi5jb20vamFubW9uc2Noa2UvYmFja2JvbmUtY291Y2hkYgogICAganF1ZXJ5X2NvdWNoOiAiLi4vYXNzZXRzL2pzL2xpYnMvanF1ZXJ5LmNvdWNoIiwKICAgIC8vIFNoaW0gUGx1Z2luCiAgICB1c2U6ICIuLi9hc3NldHMvanMvcGx1Z2lucy91c2UiLAogICAgLy8gdG9kb212YwogICAgdGV4dDogIi4uL2Fzc2V0cy9qcy9wbHVnaW5zL3RleHQiLAogICAgLy9sb2NhbHN0b3JhZ2U6ICAiLi4vYXNzZXRzL2pzL3BsdWdpbnMvYmFja2JvbmUtbG9jYWxzdG9yYWdlIgogICAgc3luY3BvaW50OiAiLi4vYXNzZXRzL2pzL2xpYnMvc3luY3BvaW50LXV0aWxzIiwKICAgIENvcmRvdmE6ICIuLi9hc3NldHMvanMvbGlicy9jb3Jkb3ZhLTIuMC4wIgogIH0sCgogIHVzZTogewogICAgYmFja2JvbmU6IHsKICAgICAgZGVwczogWyJ1c2UhdW5kZXJzY29yZSIsICJqcXVlcnkiXSwKICAgICAgYXR0YWNoOiAiQmFja2JvbmUiCiAgICB9LAoKICAgIHVuZGVyc2NvcmU6IHsKICAgICAgYXR0YWNoOiAiXyIKICAgIH0sCiAgICBiYWNrYm9uZV9jb3VjaGRiOiB7CiAgICAJZGVwczogWyJ1c2UhdW5kZXJzY29yZSIsICJqcXVlcnkiLCJ1c2UhYmFja2JvbmUiLCAidXNlIWpxdWVyeV9jb3VjaCJdCiAgICB9LAogICAganF1ZXJ5X2NvdWNoOiB7CiAgICAJZGVwczogWyJqcXVlcnkiXQogICAgCS8vJC5jb3VjaAogICAgfQogICAgLypsb2NhbHN0b3JhZ2U6IHsKICAgIAlkZXBzOiBbInVzZSF1bmRlcnNjb3JlIiwidXNlIWJhY2tib25lIl0KICAgIH0qLwogIH0KfSk7", "content_type": "application/javascript"}, "app/templates/todomvc.html": {"data": "PGRpdiBpZD0idG9kb2FwcCI+CgogICAgICA8ZGl2IGNsYXNzPSJ0aXRsZSI+CiAgICAgICAgPGgxIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2luZGV4Lmh0bWwnIj5Ub2RvczwvaDE+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCiAgICAgICAgPGRpdiBpZD0iY3JlYXRlLXRvZG8iPgogICAgICAgICAgPGlucHV0IGlkPSJuZXctdG9kbyIgcGxhY2Vob2xkZXI9IldoYXQgbmVlZHMgdG8gYmUgZG9uZT8iIHR5cGU9InRleHQiIC8+CiAgICAgICAgICA8c3BhbiBjbGFzcz0idWktdG9vbHRpcC10b3AiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij5QcmVzcyBFbnRlciB0byBzYXZlIHRoaXMgdGFzazwvc3Bhbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBpZD0idG9kb3MiPgogICAgICAgICAgPGlucHV0IGNsYXNzPSJjaGVjayBtYXJrLWFsbC1kb25lIiB0eXBlPSJjaGVja2JveCIvPgogICAgICAgICAgPGxhYmVsIGZvcj0iY2hlY2stYWxsIj5NYXJrIGFsbCBhcyBjb21wbGV0ZTwvbGFiZWw+CiAgICAgICAgICA8dWwgaWQ9InRvZG8tbGlzdCI+PC91bD4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBpZD0idG9kby1zdGF0cyI+PC9kaXY+CgogICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJjcmVkaXRzIj4KICAgICAgICA8cD5Nb2R1bGFyaXplZCBieQogICAgICAgIDxhIGhyZWY9Imh0dHA6Ly9iYWNrYm9uZXR1dG9yaWFscy5jb20iPlRob21hcyBEYXZpczwvYT4uPGJyLz4KICAgICAgICBPcmlnaW5hbGx5IGJ5IAogICAgICA8YSBocmVmPSJodHRwOi8vamduLm1lLyI+SiZlYWN1dGU7ciZvY2lyYzttZSBHcmF2ZWwtTmlxdWV0PC9hPi4KICAgICAgPC9wPgogICAgPC9kaXY+", "content_type": "text/html"}, "assets/js/libs/backbone-full.js": {"data": "Ly8gICAgIEJhY2tib25lLmpzIDAuOS4yCgovLyAgICAgKGMpIDIwMTAtMjAxMiBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgSW5jLgovLyAgICAgQmFja2JvbmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246Ci8vICAgICBodHRwOi8vYmFja2JvbmVqcy5vcmcKCihmdW5jdGlvbigpewoKICAvLyBJbml0aWFsIFNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0IChgd2luZG93YCBpbiB0aGUgYnJvd3NlciwgYGdsb2JhbGAKICAvLyBvbiB0aGUgc2VydmVyKS4KICB2YXIgcm9vdCA9IHRoaXM7CgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBhIGxvY2FsIHJlZmVyZW5jZSB0byBzbGljZS9zcGxpY2UuCiAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogIHZhciBzcGxpY2UgPSBBcnJheS5wcm90b3R5cGUuc3BsaWNlOwoKICAvLyBUaGUgdG9wLWxldmVsIG5hbWVzcGFjZS4gQWxsIHB1YmxpYyBCYWNrYm9uZSBjbGFzc2VzIGFuZCBtb2R1bGVzIHdpbGwKICAvLyBiZSBhdHRhY2hlZCB0byB0aGlzLiBFeHBvcnRlZCBmb3IgYm90aCBDb21tb25KUyBhbmQgdGhlIGJyb3dzZXIuCiAgdmFyIEJhY2tib25lOwogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIEJhY2tib25lID0gZXhwb3J0czsKICB9IGVsc2UgewogICAgQmFja2JvbmUgPSByb290LkJhY2tib25lID0ge307CiAgfQoKICAvLyBDdXJyZW50IHZlcnNpb24gb2YgdGhlIGxpYnJhcnkuIEtlZXAgaW4gc3luYyB3aXRoIGBwYWNrYWdlLmpzb25gLgogIEJhY2tib25lLlZFUlNJT04gPSAnMC45LjInOwoKICAvLyBSZXF1aXJlIFVuZGVyc2NvcmUsIGlmIHdlJ3JlIG9uIHRoZSBzZXJ2ZXIsIGFuZCBpdCdzIG5vdCBhbHJlYWR5IHByZXNlbnQuCiAgdmFyIF8gPSByb290Ll87CiAgaWYgKCFfICYmICh0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcpKSBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwoKICAvLyBGb3IgQmFja2JvbmUncyBwdXJwb3NlcywgalF1ZXJ5LCBaZXB0bywgb3IgRW5kZXIgb3ducyB0aGUgYCRgIHZhcmlhYmxlLgogIHZhciAkID0gcm9vdC5qUXVlcnkgfHwgcm9vdC5aZXB0byB8fCByb290LmVuZGVyOwoKICAvLyBTZXQgdGhlIEphdmFTY3JpcHQgbGlicmFyeSB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgRE9NIG1hbmlwdWxhdGlvbiBhbmQKICAvLyBBamF4IGNhbGxzIChhLmsuYS4gdGhlIGAkYCB2YXJpYWJsZSkuIEJ5IGRlZmF1bHQgQmFja2JvbmUgd2lsbCB1c2U6IGpRdWVyeSwKICAvLyBaZXB0bywgb3IgRW5kZXI7IGJ1dCB0aGUgYHNldERvbUxpYnJhcnkoKWAgbWV0aG9kIGxldHMgeW91IGluamVjdCBhbgogIC8vIGFsdGVybmF0ZSBKYXZhU2NyaXB0IGxpYnJhcnkgKG9yIGEgbW9jayBsaWJyYXJ5IGZvciB0ZXN0aW5nIHlvdXIgdmlld3MKICAvLyBvdXRzaWRlIG9mIGEgYnJvd3NlcikuCiAgQmFja2JvbmUuc2V0RG9tTGlicmFyeSA9IGZ1bmN0aW9uKGxpYikgewogICAgJCA9IGxpYjsKICB9OwoKICAvLyBSdW5zIEJhY2tib25lLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUKICAvLyB0byBpdHMgcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhpcyBCYWNrYm9uZSBvYmplY3QuCiAgQmFja2JvbmUubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5CYWNrYm9uZSA9IHByZXZpb3VzQmFja2JvbmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBUdXJuIG9uIGBlbXVsYXRlSFRUUGAgdG8gc3VwcG9ydCBsZWdhY3kgSFRUUCBzZXJ2ZXJzLiBTZXR0aW5nIHRoaXMgb3B0aW9uCiAgLy8gd2lsbCBmYWtlIGAiUFVUImAgYW5kIGAiREVMRVRFImAgcmVxdWVzdHMgdmlhIHRoZSBgX21ldGhvZGAgcGFyYW1ldGVyIGFuZAogIC8vIHNldCBhIGBYLUh0dHAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCiAgQmFja2JvbmUuZW11bGF0ZUhUVFAgPSBmYWxzZTsKCiAgLy8gVHVybiBvbiBgZW11bGF0ZUpTT05gIHRvIHN1cHBvcnQgbGVnYWN5IHNlcnZlcnMgdGhhdCBjYW4ndCBkZWFsIHdpdGggZGlyZWN0CiAgLy8gYGFwcGxpY2F0aW9uL2pzb25gIHJlcXVlc3RzIC4uLiB3aWxsIGVuY29kZSB0aGUgYm9keSBhcwogIC8vIGBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRgIGluc3RlYWQgYW5kIHdpbGwgc2VuZCB0aGUgbW9kZWwgaW4gYQogIC8vIGZvcm0gcGFyYW0gbmFtZWQgYG1vZGVsYC4KICBCYWNrYm9uZS5lbXVsYXRlSlNPTiA9IGZhbHNlOwoKICAvLyBCYWNrYm9uZS5FdmVudHMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZWd1bGFyIGV4cHJlc3Npb24gdXNlZCB0byBzcGxpdCBldmVudCBzdHJpbmdzCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gQSBtb2R1bGUgdGhhdCBjYW4gYmUgbWl4ZWQgaW4gdG8gKmFueSBvYmplY3QqIGluIG9yZGVyIHRvIHByb3ZpZGUgaXQgd2l0aAogIC8vIGN1c3RvbSBldmVudHMuIFlvdSBtYXkgYmluZCB3aXRoIGBvbmAgb3IgcmVtb3ZlIHdpdGggYG9mZmAgY2FsbGJhY2sgZnVuY3Rpb25zCiAgLy8gdG8gYW4gZXZlbnQ7IHRyaWdnZXJgLWluZyBhbiBldmVudCBmaXJlcyBhbGwgY2FsbGJhY2tzIGluIHN1Y2Nlc3Npb24uCiAgLy8KICAvLyAgICAgdmFyIG9iamVjdCA9IHt9OwogIC8vICAgICBfLmV4dGVuZChvYmplY3QsIEJhY2tib25lLkV2ZW50cyk7CiAgLy8gICAgIG9iamVjdC5vbignZXhwYW5kJywgZnVuY3Rpb24oKXsgYWxlcnQoJ2V4cGFuZGVkJyk7IH0pOwogIC8vICAgICBvYmplY3QudHJpZ2dlcignZXhwYW5kJyk7CiAgLy8KICB2YXIgRXZlbnRzID0gQmFja2JvbmUuRXZlbnRzID0gewoKICAgIC8vIEJpbmQgb25lIG9yIG1vcmUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50cywgYGV2ZW50c2AsIHRvIGEgYGNhbGxiYWNrYAogICAgLy8gZnVuY3Rpb24uIFBhc3NpbmcgYCJhbGwiYCB3aWxsIGJpbmQgdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24oZXZlbnRzLCBjYWxsYmFjaywgY29udGV4dCkgewoKICAgICAgdmFyIGNhbGxzLCBldmVudCwgbm9kZSwgdGFpbCwgbGlzdDsKICAgICAgaWYgKCFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MgfHwgKHRoaXMuX2NhbGxiYWNrcyA9IHt9KTsKCiAgICAgIC8vIENyZWF0ZSBhbiBpbW11dGFibGUgY2FsbGJhY2sgbGlzdCwgYWxsb3dpbmcgdHJhdmVyc2FsIGR1cmluZwogICAgICAvLyBtb2RpZmljYXRpb24uICBUaGUgdGFpbCBpcyBhbiBlbXB0eSBvYmplY3QgdGhhdCB3aWxsIGFsd2F5cyBiZSB1c2VkCiAgICAgIC8vIGFzIHRoZSBuZXh0IG5vZGUuCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbGlzdCA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBub2RlID0gbGlzdCA/IGxpc3QudGFpbCA6IHt9OwogICAgICAgIG5vZGUubmV4dCA9IHRhaWwgPSB7fTsKICAgICAgICBub2RlLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIG5vZGUuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICBjYWxsc1tldmVudF0gPSB7dGFpbDogdGFpbCwgbmV4dDogbGlzdCA/IGxpc3QubmV4dCA6IG5vZGV9OwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIG9uZSBvciBtYW55IGNhbGxiYWNrcy4gSWYgYGNvbnRleHRgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGNhbGxiYWNrcwogICAgLy8gd2l0aCB0aGF0IGZ1bmN0aW9uLiBJZiBgY2FsbGJhY2tgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGNhbGxiYWNrcyBmb3IgdGhlCiAgICAvLyBldmVudC4gSWYgYGV2ZW50c2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQgY2FsbGJhY2tzIGZvciBhbGwgZXZlbnRzLgogICAgb2ZmOiBmdW5jdGlvbihldmVudHMsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIHZhciBldmVudCwgY2FsbHMsIG5vZGUsIHRhaWwsIGNiLCBjdHg7CgogICAgICAvLyBObyBldmVudHMsIG9yIHJlbW92aW5nICphbGwqIGV2ZW50cy4KICAgICAgaWYgKCEoY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MpKSByZXR1cm47CiAgICAgIGlmICghKGV2ZW50cyB8fCBjYWxsYmFjayB8fCBjb250ZXh0KSkgewogICAgICAgIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3M7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgbGlzdGVkIGV2ZW50cyBhbmQgY29udGV4dHMsIHNwbGljaW5nIHRoZW0gb3V0IG9mIHRoZQogICAgICAvLyBsaW5rZWQgbGlzdCBvZiBjYWxsYmFja3MgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGV2ZW50cyA9IGV2ZW50cyA/IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKSA6IF8ua2V5cyhjYWxscyk7CiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbm9kZSA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBkZWxldGUgY2FsbHNbZXZlbnRdOwogICAgICAgIGlmICghbm9kZSB8fCAhKGNhbGxiYWNrIHx8IGNvbnRleHQpKSBjb250aW51ZTsKICAgICAgICAvLyBDcmVhdGUgYSBuZXcgbGlzdCwgb21pdHRpbmcgdGhlIGluZGljYXRlZCBjYWxsYmFja3MuCiAgICAgICAgdGFpbCA9IG5vZGUudGFpbDsKICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpICE9PSB0YWlsKSB7CiAgICAgICAgICBjYiA9IG5vZGUuY2FsbGJhY2s7CiAgICAgICAgICBjdHggPSBub2RlLmNvbnRleHQ7CiAgICAgICAgICBpZiAoKGNhbGxiYWNrICYmIGNiICE9PSBjYWxsYmFjaykgfHwgKGNvbnRleHQgJiYgY3R4ICE9PSBjb250ZXh0KSkgewogICAgICAgICAgICB0aGlzLm9uKGV2ZW50LCBjYiwgY3R4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihldmVudHMpIHsKICAgICAgdmFyIGV2ZW50LCBub2RlLCBjYWxscywgdGFpbCwgYXJncywgYWxsLCByZXN0OwogICAgICBpZiAoIShjYWxscyA9IHRoaXMuX2NhbGxiYWNrcykpIHJldHVybiB0aGlzOwogICAgICBhbGwgPSBjYWxscy5hbGw7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICAgIC8vIEZvciBlYWNoIGV2ZW50LCB3YWxrIHRocm91Z2ggdGhlIGxpbmtlZCBsaXN0IG9mIGNhbGxiYWNrcyB0d2ljZSwKICAgICAgLy8gZmlyc3QgdG8gdHJpZ2dlciB0aGUgZXZlbnQsIHRoZW4gdG8gdHJpZ2dlciBhbnkgYCJhbGwiYCBjYWxsYmFja3MuCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgaWYgKG5vZGUgPSBjYWxsc1tldmVudF0pIHsKICAgICAgICAgIHRhaWwgPSBub2RlLnRhaWw7CiAgICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpICE9PSB0YWlsKSB7CiAgICAgICAgICAgIG5vZGUuY2FsbGJhY2suYXBwbHkobm9kZS5jb250ZXh0IHx8IHRoaXMsIHJlc3QpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobm9kZSA9IGFsbCkgewogICAgICAgICAgdGFpbCA9IG5vZGUudGFpbDsKICAgICAgICAgIGFyZ3MgPSBbZXZlbnRdLmNvbmNhdChyZXN0KTsKICAgICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dCkgIT09IHRhaWwpIHsKICAgICAgICAgICAgbm9kZS5jYWxsYmFjay5hcHBseShub2RlLmNvbnRleHQgfHwgdGhpcywgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwsIHdpdGggZGVmaW5lZCBhdHRyaWJ1dGVzLiBBIGNsaWVudCBpZCAoYGNpZGApCiAgLy8gaXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIGFzc2lnbmVkIGZvciB5b3UuCiAgdmFyIE1vZGVsID0gQmFja2JvbmUuTW9kZWwgPSBmdW5jdGlvbihhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICB2YXIgZGVmYXVsdHM7CiAgICBhdHRyaWJ1dGVzIHx8IChhdHRyaWJ1dGVzID0ge30pOwogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJzZSkgYXR0cmlidXRlcyA9IHRoaXMucGFyc2UoYXR0cmlidXRlcyk7CiAgICBpZiAoZGVmYXVsdHMgPSBnZXRWYWx1ZSh0aGlzLCAnZGVmYXVsdHMnKSkgewogICAgICBhdHRyaWJ1dGVzID0gXy5leHRlbmQoe30sIGRlZmF1bHRzLCBhdHRyaWJ1dGVzKTsKICAgIH0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgdGhpcy5hdHRyaWJ1dGVzID0ge307CiAgICB0aGlzLl9lc2NhcGVkQXR0cmlidXRlcyA9IHt9OwogICAgdGhpcy5jaWQgPSBfLnVuaXF1ZUlkKCdjJyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuX3NpbGVudCA9IHt9OwogICAgdGhpcy5fcGVuZGluZyA9IHt9OwogICAgdGhpcy5zZXQoYXR0cmlidXRlcywge3NpbGVudDogdHJ1ZX0pOwogICAgLy8gUmVzZXQgY2hhbmdlIHRyYWNraW5nLgogICAgdGhpcy5jaGFuZ2VkID0ge307CiAgICB0aGlzLl9zaWxlbnQgPSB7fTsKICAgIHRoaXMuX3BlbmRpbmcgPSB7fTsKICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBBIGhhc2ggb2YgYXR0cmlidXRlcyB0aGF0IGhhdmUgc2lsZW50bHkgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCB0aW1lCiAgICAvLyBgY2hhbmdlYCB3YXMgY2FsbGVkLiAgV2lsbCBiZWNvbWUgcGVuZGluZyBhdHRyaWJ1dGVzIG9uIHRoZSBuZXh0IGNhbGwuCiAgICBfc2lsZW50OiBudWxsLAoKICAgIC8vIEEgaGFzaCBvZiBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAnY2hhbmdlJ2AgZXZlbnQKICAgIC8vIGJlZ2FuLgogICAgX3BlbmRpbmc6IG51bGwsCgogICAgLy8gVGhlIGRlZmF1bHQgbmFtZSBmb3IgdGhlIEpTT04gYGlkYCBhdHRyaWJ1dGUgaXMgYCJpZCJgLiBNb25nb0RCIGFuZAogICAgLy8gQ291Y2hEQiB1c2VycyBtYXkgd2FudCB0byBzZXQgdGhpcyB0byBgIl9pZCJgLgogICAgaWRBdHRyaWJ1dGU6ICdpZCcsCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBtb2RlbCdzIGBhdHRyaWJ1dGVzYCBvYmplY3QuCiAgICB0b0pTT046IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuCiAgICBnZXQ6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyXTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBIVE1MLWVzY2FwZWQgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZXNjYXBlOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHZhciBodG1sOwogICAgICBpZiAoaHRtbCA9IHRoaXMuX2VzY2FwZWRBdHRyaWJ1dGVzW2F0dHJdKSByZXR1cm4gaHRtbDsKICAgICAgdmFyIHZhbCA9IHRoaXMuZ2V0KGF0dHIpOwogICAgICByZXR1cm4gdGhpcy5fZXNjYXBlZEF0dHJpYnV0ZXNbYXR0cl0gPSBfLmVzY2FwZSh2YWwgPT0gbnVsbCA/ICcnIDogJycgKyB2YWwpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAgdW5sZXNzCiAgICAvLyB5b3UgY2hvb3NlIHRvIHNpbGVuY2UgaXQuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzLCBhdHRyLCB2YWw7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKF8uaXNPYmplY3Qoa2V5KSB8fCBrZXkgPT0gbnVsbCkgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdHRycyA9IHt9OwogICAgICAgIGF0dHJzW2tleV0gPSB2YWx1ZTsKICAgICAgfQoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBpZiAoIWF0dHJzKSByZXR1cm4gdGhpczsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIGF0dHJzID0gYXR0cnMuYXR0cmlidXRlczsKICAgICAgaWYgKG9wdGlvbnMudW5zZXQpIGZvciAoYXR0ciBpbiBhdHRycykgYXR0cnNbYXR0cl0gPSB2b2lkIDA7CgogICAgICAvLyBSdW4gdmFsaWRhdGlvbi4KICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKCiAgICAgIC8vIENoZWNrIGZvciBjaGFuZ2VzIG9mIGBpZGAuCiAgICAgIGlmICh0aGlzLmlkQXR0cmlidXRlIGluIGF0dHJzKSB0aGlzLmlkID0gYXR0cnNbdGhpcy5pZEF0dHJpYnV0ZV07CgogICAgICB2YXIgY2hhbmdlcyA9IG9wdGlvbnMuY2hhbmdlcyA9IHt9OwogICAgICB2YXIgbm93ID0gdGhpcy5hdHRyaWJ1dGVzOwogICAgICB2YXIgZXNjYXBlZCA9IHRoaXMuX2VzY2FwZWRBdHRyaWJ1dGVzOwogICAgICB2YXIgcHJldiA9IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyB8fCB7fTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZS4uLgogICAgICBmb3IgKGF0dHIgaW4gYXR0cnMpIHsKICAgICAgICB2YWwgPSBhdHRyc1thdHRyXTsKCiAgICAgICAgLy8gSWYgdGhlIG5ldyBhbmQgY3VycmVudCB2YWx1ZSBkaWZmZXIsIHJlY29yZCB0aGUgY2hhbmdlLgogICAgICAgIGlmICghXy5pc0VxdWFsKG5vd1thdHRyXSwgdmFsKSB8fCAob3B0aW9ucy51bnNldCAmJiBfLmhhcyhub3csIGF0dHIpKSkgewogICAgICAgICAgZGVsZXRlIGVzY2FwZWRbYXR0cl07CiAgICAgICAgICAob3B0aW9ucy5zaWxlbnQgPyB0aGlzLl9zaWxlbnQgOiBjaGFuZ2VzKVthdHRyXSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgb3IgZGVsZXRlIHRoZSBjdXJyZW50IHZhbHVlLgogICAgICAgIG9wdGlvbnMudW5zZXQgPyBkZWxldGUgbm93W2F0dHJdIDogbm93W2F0dHJdID0gdmFsOwoKICAgICAgICAvLyBJZiB0aGUgbmV3IGFuZCBwcmV2aW91cyB2YWx1ZSBkaWZmZXIsIHJlY29yZCB0aGUgY2hhbmdlLiAgSWYgbm90LAogICAgICAgIC8vIHRoZW4gcmVtb3ZlIGNoYW5nZXMgZm9yIHRoaXMgYXR0cmlidXRlLgogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkgfHwgKF8uaGFzKG5vdywgYXR0cikgIT0gXy5oYXMocHJldiwgYXR0cikpKSB7CiAgICAgICAgICB0aGlzLmNoYW5nZWRbYXR0cl0gPSB2YWw7CiAgICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLl9wZW5kaW5nW2F0dHJdID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICAgIGRlbGV0ZSB0aGlzLl9wZW5kaW5nW2F0dHJdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gRmlyZSB0aGUgYCJjaGFuZ2UiYCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMuY2hhbmdlKG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGFuIGF0dHJpYnV0ZSBmcm9tIHRoZSBtb2RlbCwgZmlyaW5nIGAiY2hhbmdlImAgdW5sZXNzIHlvdSBjaG9vc2UKICAgIC8vIHRvIHNpbGVuY2UgaXQuIGB1bnNldGAgaXMgYSBub29wIGlmIHRoZSBhdHRyaWJ1dGUgZG9lc24ndCBleGlzdC4KICAgIHVuc2V0OiBmdW5jdGlvbihhdHRyLCBvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChhdHRyLCBudWxsLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYCB1bmxlc3MgeW91IGNob29zZQogICAgLy8gdG8gc2lsZW5jZSBpdC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChfLmNsb25lKHRoaXMuYXR0cmlidXRlcyksIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgbW9kZWwgZnJvbSB0aGUgc2VydmVyLiBJZiB0aGUgc2VydmVyJ3MgcmVwcmVzZW50YXRpb24gb2YgdGhlCiAgICAvLyBtb2RlbCBkaWZmZXJzIGZyb20gaXRzIGN1cnJlbnQgYXR0cmlidXRlcywgdGhleSB3aWxsIGJlIG92ZXJyaWRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwLCBzdGF0dXMsIHhocikgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIHhociksIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3ApOwogICAgICB9OwogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMsIGFuZCBzeW5jIHRoZSBtb2RlbCB0byB0aGUgc2VydmVyLgogICAgLy8gSWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGF0dHJpYnV0ZXMgaGFzaCB0aGF0IGRpZmZlcnMsIHRoZSBtb2RlbCdzCiAgICAvLyBzdGF0ZSB3aWxsIGJlIGBzZXRgIGFnYWluLgogICAgc2F2ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICB2YXIgYXR0cnMsIGN1cnJlbnQ7CgogICAgICAvLyBIYW5kbGUgYm90aCBgKCJrZXkiLCB2YWx1ZSlgIGFuZCBgKHtrZXk6IHZhbHVlfSlgIC1zdHlsZSBjYWxscy4KICAgICAgaWYgKF8uaXNPYmplY3Qoa2V5KSB8fCBrZXkgPT0gbnVsbCkgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdHRycyA9IHt9OwogICAgICAgIGF0dHJzW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKCiAgICAgIC8vIElmIHdlJ3JlICJ3YWl0Ii1pbmcgdG8gc2V0IGNoYW5nZWQgYXR0cmlidXRlcywgdmFsaWRhdGUgZWFybHkuCiAgICAgIGlmIChvcHRpb25zLndhaXQpIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGN1cnJlbnQgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICAgIH0KCiAgICAgIC8vIFJlZ3VsYXIgc2F2ZXMgYHNldGAgYXR0cmlidXRlcyBiZWZvcmUgcGVyc2lzdGluZyB0byB0aGUgc2VydmVyLgogICAgICB2YXIgc2lsZW50T3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7c2lsZW50OiB0cnVlfSk7CiAgICAgIGlmIChhdHRycyAmJiAhdGhpcy5zZXQoYXR0cnMsIG9wdGlvbnMud2FpdCA/IHNpbGVudE9wdGlvbnMgOiBvcHRpb25zKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gQWZ0ZXIgYSBzdWNjZXNzZnVsIHNlcnZlci1zaWRlIHNhdmUsIHRoZSBjbGllbnQgaXMgKG9wdGlvbmFsbHkpCiAgICAgIC8vIHVwZGF0ZWQgd2l0aCB0aGUgc2VydmVyLXNpZGUgc3RhdGUuCiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwLCBzdGF0dXMsIHhocikgewogICAgICAgIHZhciBzZXJ2ZXJBdHRycyA9IG1vZGVsLnBhcnNlKHJlc3AsIHhocik7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgewogICAgICAgICAgZGVsZXRlIG9wdGlvbnMud2FpdDsKICAgICAgICAgIHNlcnZlckF0dHJzID0gXy5leHRlbmQoYXR0cnMgfHwge30sIHNlcnZlckF0dHJzKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgIHN1Y2Nlc3MobW9kZWwsIHJlc3ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8vIEZpbmlzaCBjb25maWd1cmluZyBhbmQgc2VuZGluZyB0aGUgQWpheCByZXF1ZXN0LgogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuaXNOZXcoKSA/ICdjcmVhdGUnIDogJ3VwZGF0ZSc7CiAgICAgIHZhciB4aHIgPSAodGhpcy5zeW5jIHx8IEJhY2tib25lLnN5bmMpLmNhbGwodGhpcywgbWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMud2FpdCkgdGhpcy5zZXQoY3VycmVudCwgc2lsZW50T3B0aW9ucyk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgdHJpZ2dlckRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdkZXN0cm95JywgbW9kZWwsIG1vZGVsLmNvbGxlY3Rpb24sIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgewogICAgICAgIHRyaWdnZXJEZXN0cm95KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgdHJpZ2dlckRlc3Ryb3koKTsKICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgc3VjY2Vzcyhtb2RlbCwgcmVzcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgb3B0aW9ucy5lcnJvciA9IEJhY2tib25lLndyYXBFcnJvcihvcHRpb25zLmVycm9yLCBtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciB4aHIgPSAodGhpcy5zeW5jIHx8IEJhY2tib25lLnN5bmMpLmNhbGwodGhpcywgJ2RlbGV0ZScsIHRoaXMsIG9wdGlvbnMpOwogICAgICBpZiAoIW9wdGlvbnMud2FpdCkgdHJpZ2dlckRlc3Ryb3koKTsKICAgICAgcmV0dXJuIHhocjsKICAgIH0sCgogICAgLy8gRGVmYXVsdCBVUkwgZm9yIHRoZSBtb2RlbCdzIHJlcHJlc2VudGF0aW9uIG9uIHRoZSBzZXJ2ZXIgLS0gaWYgeW91J3JlCiAgICAvLyB1c2luZyBCYWNrYm9uZSdzIHJlc3RmdWwgbWV0aG9kcywgb3ZlcnJpZGUgdGhpcyB0byBjaGFuZ2UgdGhlIGVuZHBvaW50CiAgICAvLyB0aGF0IHdpbGwgYmUgY2FsbGVkLgogICAgdXJsOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJhc2UgPSBnZXRWYWx1ZSh0aGlzLCAndXJsUm9vdCcpIHx8IGdldFZhbHVlKHRoaXMuY29sbGVjdGlvbiwgJ3VybCcpIHx8IHVybEVycm9yKCk7CiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHJldHVybiBiYXNlOwogICAgICByZXR1cm4gYmFzZSArIChiYXNlLmNoYXJBdChiYXNlLmxlbmd0aCAtIDEpID09ICcvJyA/ICcnIDogJy8nKSArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmlkKTsKICAgIH0sCgogICAgLy8gKipwYXJzZSoqIGNvbnZlcnRzIGEgcmVzcG9uc2UgaW50byB0aGUgaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIGJlIGBzZXRgIG9uCiAgICAvLyB0aGUgbW9kZWwuIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyB0aGUgcmVzcG9uc2UgYWxvbmcuCiAgICBwYXJzZTogZnVuY3Rpb24ocmVzcCwgeGhyKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwgd2l0aCBpZGVudGljYWwgYXR0cmlidXRlcyB0byB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEEgbW9kZWwgaXMgbmV3IGlmIGl0IGhhcyBuZXZlciBiZWVuIHNhdmVkIHRvIHRoZSBzZXJ2ZXIsIGFuZCBsYWNrcyBhbiBpZC4KICAgIGlzTmV3OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICh0aGlzLmlkID09IG51bGwpOwogICAgfSwKCiAgICAvLyBDYWxsIHRoaXMgbWV0aG9kIHRvIG1hbnVhbGx5IGZpcmUgYSBgImNoYW5nZSJgIGV2ZW50IGZvciB0aGlzIG1vZGVsIGFuZAogICAgLy8gYSBgImNoYW5nZTphdHRyaWJ1dGUiYCBldmVudCBmb3IgZWFjaCBjaGFuZ2VkIGF0dHJpYnV0ZS4KICAgIC8vIENhbGxpbmcgdGhpcyB3aWxsIGNhdXNlIGFsbCBvYmplY3RzIG9ic2VydmluZyB0aGUgbW9kZWwgdG8gdXBkYXRlLgogICAgY2hhbmdlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIHZhciBjaGFuZ2luZyA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyA9IHRydWU7CgogICAgICAvLyBTaWxlbnQgY2hhbmdlcyBiZWNvbWUgcGVuZGluZyBjaGFuZ2VzLgogICAgICBmb3IgKHZhciBhdHRyIGluIHRoaXMuX3NpbGVudCkgdGhpcy5fcGVuZGluZ1thdHRyXSA9IHRydWU7CgogICAgICAvLyBTaWxlbnQgY2hhbmdlcyBhcmUgdHJpZ2dlcmVkLgogICAgICB2YXIgY2hhbmdlcyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zLmNoYW5nZXMsIHRoaXMuX3NpbGVudCk7CiAgICAgIHRoaXMuX3NpbGVudCA9IHt9OwogICAgICBmb3IgKHZhciBhdHRyIGluIGNoYW5nZXMpIHsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTonICsgYXR0ciwgdGhpcywgdGhpcy5nZXQoYXR0ciksIG9wdGlvbnMpOwogICAgICB9CiAgICAgIGlmIChjaGFuZ2luZykgcmV0dXJuIHRoaXM7CgogICAgICAvLyBDb250aW51ZSBmaXJpbmcgYCJjaGFuZ2UiYCBldmVudHMgd2hpbGUgdGhlcmUgYXJlIHBlbmRpbmcgY2hhbmdlcy4KICAgICAgd2hpbGUgKCFfLmlzRW1wdHkodGhpcy5fcGVuZGluZykpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nID0ge307CiAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2UnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgICAvLyBQZW5kaW5nIGFuZCBzaWxlbnQgY2hhbmdlcyBzdGlsbCByZW1haW4uCiAgICAgICAgZm9yICh2YXIgYXR0ciBpbiB0aGlzLmNoYW5nZWQpIHsKICAgICAgICAgIGlmICh0aGlzLl9wZW5kaW5nW2F0dHJdIHx8IHRoaXMuX3NpbGVudFthdHRyXSkgY29udGludWU7CiAgICAgICAgICBkZWxldGUgdGhpcy5jaGFuZ2VkW2F0dHJdOwogICAgICAgIH0KICAgICAgICB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2NoYW5naW5nID0gZmFsc2U7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBEZXRlcm1pbmUgaWYgdGhlIG1vZGVsIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAiY2hhbmdlImAgZXZlbnQuCiAgICAvLyBJZiB5b3Ugc3BlY2lmeSBhbiBhdHRyaWJ1dGUgbmFtZSwgZGV0ZXJtaW5lIGlmIHRoYXQgYXR0cmlidXRlIGhhcyBjaGFuZ2VkLgogICAgaGFzQ2hhbmdlZDogZnVuY3Rpb24oYXR0cikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuY2hhbmdlZCk7CiAgICAgIHJldHVybiBfLmhhcyh0aGlzLmNoYW5nZWQsIGF0dHIpOwogICAgfSwKCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24oZGlmZikgewogICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlOwogICAgICB2YXIgdmFsLCBjaGFuZ2VkID0gZmFsc2UsIG9sZCA9IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlczsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBkaWZmKSB7CiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sICh2YWwgPSBkaWZmW2F0dHJdKSkpIGNvbnRpbnVlOwogICAgICAgIChjaGFuZ2VkIHx8IChjaGFuZ2VkID0ge30pKVthdHRyXSA9IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0CiAgICAvLyBgImNoYW5nZSJgIGV2ZW50IHdhcyBmaXJlZC4KICAgIHByZXZpb3VzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCB8fCAhdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKSByZXR1cm4gbnVsbDsKICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlc1thdHRyXTsKICAgIH0sCgogICAgLy8gR2V0IGFsbCBvZiB0aGUgYXR0cmlidXRlcyBvZiB0aGUgbW9kZWwgYXQgdGhlIHRpbWUgb2YgdGhlIHByZXZpb3VzCiAgICAvLyBgImNoYW5nZSJgIGV2ZW50LgogICAgcHJldmlvdXNBdHRyaWJ1dGVzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gQ2hlY2sgaWYgdGhlIG1vZGVsIGlzIGN1cnJlbnRseSBpbiBhIHZhbGlkIHN0YXRlLiBJdCdzIG9ubHkgcG9zc2libGUgdG8KICAgIC8vIGdldCBpbnRvIGFuICppbnZhbGlkKiBzdGF0ZSBpZiB5b3UncmUgdXNpbmcgc2lsZW50IGNoYW5nZXMuCiAgICBpc1ZhbGlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICF0aGlzLnZhbGlkYXRlKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsCiAgICAvLyByZXR1cm5pbmcgYHRydWVgIGlmIGFsbCBpcyB3ZWxsLiBJZiBhIHNwZWNpZmljIGBlcnJvcmAgY2FsbGJhY2sgaGFzCiAgICAvLyBiZWVuIHBhc3NlZCwgY2FsbCB0aGF0IGluc3RlYWQgb2YgZmlyaW5nIHRoZSBnZW5lcmFsIGAiZXJyb3IiYCBldmVudC4KICAgIF92YWxpZGF0ZTogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMuc2lsZW50IHx8ICF0aGlzLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTsKICAgICAgYXR0cnMgPSBfLmV4dGVuZCh7fSwgdGhpcy5hdHRyaWJ1dGVzLCBhdHRycyk7CiAgICAgIHZhciBlcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpOwogICAgICBpZiAoIWVycm9yKSByZXR1cm4gdHJ1ZTsKICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lcnJvcikgewogICAgICAgIG9wdGlvbnMuZXJyb3IodGhpcywgZXJyb3IsIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudHJpZ2dlcignZXJyb3InLCB0aGlzLCBlcnJvciwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvbgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gUHJvdmlkZXMgYSBzdGFuZGFyZCBjb2xsZWN0aW9uIGNsYXNzIGZvciBvdXIgc2V0cyBvZiBtb2RlbHMsIG9yZGVyZWQKICAvLyBvciB1bm9yZGVyZWQuIElmIGEgYGNvbXBhcmF0b3JgIGlzIHNwZWNpZmllZCwgdGhlIENvbGxlY3Rpb24gd2lsbCBtYWludGFpbgogIC8vIGl0cyBtb2RlbHMgaW4gc29ydCBvcmRlciwgYXMgdGhleSdyZSBhZGRlZCBhbmQgcmVtb3ZlZC4KICB2YXIgQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24gPSBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBpZiAob3B0aW9ucy5tb2RlbCkgdGhpcy5tb2RlbCA9IG9wdGlvbnMubW9kZWw7CiAgICBpZiAob3B0aW9ucy5jb21wYXJhdG9yKSB0aGlzLmNvbXBhcmF0b3IgPSBvcHRpb25zLmNvbXBhcmF0b3I7CiAgICB0aGlzLl9yZXNldCgpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAobW9kZWxzKSB0aGlzLnJlc2V0KG1vZGVscywge3NpbGVudDogdHJ1ZSwgcGFyc2U6IG9wdGlvbnMucGFyc2V9KTsKICB9OwoKICAvLyBEZWZpbmUgdGhlIENvbGxlY3Rpb24ncyBpbmhlcml0YWJsZSBtZXRob2RzLgogIF8uZXh0ZW5kKENvbGxlY3Rpb24ucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBtb2RlbCBmb3IgYSBjb2xsZWN0aW9uIGlzIGp1c3QgYSAqKkJhY2tib25lLk1vZGVsKiouCiAgICAvLyBUaGlzIHNob3VsZCBiZSBvdmVycmlkZGVuIGluIG1vc3QgY2FzZXMuCiAgICBtb2RlbDogTW9kZWwsCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBUaGUgSlNPTiByZXByZXNlbnRhdGlvbiBvZiBhIENvbGxlY3Rpb24gaXMgYW4gYXJyYXkgb2YgdGhlCiAgICAvLyBtb2RlbHMnIGF0dHJpYnV0ZXMuCiAgICB0b0pTT046IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKG1vZGVsKXsgcmV0dXJuIG1vZGVsLnRvSlNPTihvcHRpb25zKTsgfSk7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsLCBvciBsaXN0IG9mIG1vZGVscyB0byB0aGUgc2V0LiBQYXNzICoqc2lsZW50KiogdG8gYXZvaWQKICAgIC8vIGZpcmluZyB0aGUgYGFkZGAgZXZlbnQgZm9yIGV2ZXJ5IG5ldyBtb2RlbC4KICAgIGFkZDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBpLCBpbmRleCwgbGVuZ3RoLCBtb2RlbCwgY2lkLCBpZCwgY2lkcyA9IHt9LCBpZHMgPSB7fSwgZHVwcyA9IFtdOwogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBtb2RlbHMgPSBfLmlzQXJyYXkobW9kZWxzKSA/IG1vZGVscy5zbGljZSgpIDogW21vZGVsc107CgogICAgICAvLyBCZWdpbiBieSB0dXJuaW5nIGJhcmUgb2JqZWN0cyBpbnRvIG1vZGVsIHJlZmVyZW5jZXMsIGFuZCBwcmV2ZW50aW5nCiAgICAgIC8vIGludmFsaWQgbW9kZWxzIG9yIGR1cGxpY2F0ZSBtb2RlbHMgZnJvbSBiZWluZyBhZGRlZC4KICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gbW9kZWxzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCEobW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWxzW2ldLCBvcHRpb25zKSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuJ3QgYWRkIGFuIGludmFsaWQgbW9kZWwgdG8gYSBjb2xsZWN0aW9uIik7CiAgICAgICAgfQogICAgICAgIGNpZCA9IG1vZGVsLmNpZDsKICAgICAgICBpZCA9IG1vZGVsLmlkOwogICAgICAgIGlmIChjaWRzW2NpZF0gfHwgdGhpcy5fYnlDaWRbY2lkXSB8fCAoKGlkICE9IG51bGwpICYmIChpZHNbaWRdIHx8IHRoaXMuX2J5SWRbaWRdKSkpIHsKICAgICAgICAgIGR1cHMucHVzaChpKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjaWRzW2NpZF0gPSBpZHNbaWRdID0gbW9kZWw7CiAgICAgIH0KCiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzLgogICAgICBpID0gZHVwcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBtb2RlbHMuc3BsaWNlKGR1cHNbaV0sIDEpOwogICAgICB9CgogICAgICAvLyBMaXN0ZW4gdG8gYWRkZWQgbW9kZWxzJyBldmVudHMsIGFuZCBpbmRleCBtb2RlbHMgZm9yIGxvb2t1cCBieQogICAgICAvLyBgaWRgIGFuZCBieSBgY2lkYC4KICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gbW9kZWxzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgKG1vZGVsID0gbW9kZWxzW2ldKS5vbignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgICAgICB0aGlzLl9ieUNpZFttb2RlbC5jaWRdID0gbW9kZWw7CiAgICAgICAgaWYgKG1vZGVsLmlkICE9IG51bGwpIHRoaXMuX2J5SWRbbW9kZWwuaWRdID0gbW9kZWw7CiAgICAgIH0KCiAgICAgIC8vIEluc2VydCBtb2RlbHMgaW50byB0aGUgY29sbGVjdGlvbiwgcmUtc29ydGluZyBpZiBuZWVkZWQsIGFuZCB0cmlnZ2VyaW5nCiAgICAgIC8vIGBhZGRgIGV2ZW50cyB1bmxlc3Mgc2lsZW5jZWQuCiAgICAgIHRoaXMubGVuZ3RoICs9IGxlbmd0aDsKICAgICAgaW5kZXggPSBvcHRpb25zLmF0ICE9IG51bGwgPyBvcHRpb25zLmF0IDogdGhpcy5tb2RlbHMubGVuZ3RoOwogICAgICBzcGxpY2UuYXBwbHkodGhpcy5tb2RlbHMsIFtpbmRleCwgMF0uY29uY2F0KG1vZGVscykpOwogICAgICBpZiAodGhpcy5jb21wYXJhdG9yKSB0aGlzLnNvcnQoe3NpbGVudDogdHJ1ZX0pOwogICAgICBpZiAob3B0aW9ucy5zaWxlbnQpIHJldHVybiB0aGlzOwogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmICghY2lkc1sobW9kZWwgPSB0aGlzLm1vZGVsc1tpXSkuY2lkXSkgY29udGludWU7CiAgICAgICAgb3B0aW9ucy5pbmRleCA9IGk7CiAgICAgICAgbW9kZWwudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBSZW1vdmUgYSBtb2RlbCwgb3IgYSBsaXN0IG9mIG1vZGVscyBmcm9tIHRoZSBzZXQuIFBhc3Mgc2lsZW50IHRvIGF2b2lkCiAgICAvLyBmaXJpbmcgdGhlIGByZW1vdmVgIGV2ZW50IGZvciBldmVyeSBtb2RlbCByZW1vdmVkLgogICAgcmVtb3ZlOiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgdmFyIGksIGwsIGluZGV4LCBtb2RlbDsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgbW9kZWxzID0gXy5pc0FycmF5KG1vZGVscykgPyBtb2RlbHMuc2xpY2UoKSA6IFttb2RlbHNdOwogICAgICBmb3IgKGkgPSAwLCBsID0gbW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG1vZGVsID0gdGhpcy5nZXRCeUNpZChtb2RlbHNbaV0pIHx8IHRoaXMuZ2V0KG1vZGVsc1tpXSk7CiAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuaWRdOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUNpZFttb2RlbC5jaWRdOwogICAgICAgIGluZGV4ID0gdGhpcy5pbmRleE9mKG1vZGVsKTsKICAgICAgICB0aGlzLm1vZGVscy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIHRoaXMubGVuZ3RoLS07CiAgICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgewogICAgICAgICAgb3B0aW9ucy5pbmRleCA9IGluZGV4OwogICAgICAgICAgbW9kZWwudHJpZ2dlcigncmVtb3ZlJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UobW9kZWwpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgcHVzaDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgbW9kZWwgPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWwsIG9wdGlvbnMpOwogICAgICB0aGlzLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwgZnJvbSB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgcG9wOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQodGhpcy5sZW5ndGggLSAxKTsKICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICB1bnNoaWZ0OiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwgZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgc2hpZnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCgwKTsKICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIEdldCBhIG1vZGVsIGZyb20gdGhlIHNldCBieSBpZC4KICAgIGdldDogZnVuY3Rpb24oaWQpIHsKICAgICAgaWYgKGlkID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICAgIHJldHVybiB0aGlzLl9ieUlkW2lkLmlkICE9IG51bGwgPyBpZC5pZCA6IGlkXTsKICAgIH0sCgogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGNsaWVudCBpZC4KICAgIGdldEJ5Q2lkOiBmdW5jdGlvbihjaWQpIHsKICAgICAgcmV0dXJuIGNpZCAmJiB0aGlzLl9ieUNpZFtjaWQuY2lkIHx8IGNpZF07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgbW9kZWwgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgYXQ6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsc1tpbmRleF07CiAgICB9LAoKICAgIC8vIFJldHVybiBtb2RlbHMgd2l0aCBtYXRjaGluZyBhdHRyaWJ1dGVzLiBVc2VmdWwgZm9yIHNpbXBsZSBjYXNlcyBvZiBgZmlsdGVyYC4KICAgIHdoZXJlOiBmdW5jdGlvbihhdHRycykgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIFtdOwogICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cnMpIHsKICAgICAgICAgIGlmIChhdHRyc1trZXldICE9PSBtb2RlbC5nZXQoa2V5KSkgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIEZvcmNlIHRoZSBjb2xsZWN0aW9uIHRvIHJlLXNvcnQgaXRzZWxmLiBZb3UgZG9uJ3QgbmVlZCB0byBjYWxsIHRoaXMgdW5kZXIKICAgIC8vIG5vcm1hbCBjaXJjdW1zdGFuY2VzLCBhcyB0aGUgc2V0IHdpbGwgbWFpbnRhaW4gc29ydCBvcmRlciBhcyBlYWNoIGl0ZW0KICAgIC8vIGlzIGFkZGVkLgogICAgc29ydDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBpZiAoIXRoaXMuY29tcGFyYXRvcikgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc29ydCBhIHNldCB3aXRob3V0IGEgY29tcGFyYXRvcicpOwogICAgICB2YXIgYm91bmRDb21wYXJhdG9yID0gXy5iaW5kKHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CiAgICAgIGlmICh0aGlzLmNvbXBhcmF0b3IubGVuZ3RoID09IDEpIHsKICAgICAgICB0aGlzLm1vZGVscyA9IHRoaXMuc29ydEJ5KGJvdW5kQ29tcGFyYXRvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tb2RlbHMuc29ydChib3VuZENvbXBhcmF0b3IpOwogICAgICB9CiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcigncmVzZXQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFBsdWNrIGFuIGF0dHJpYnV0ZSBmcm9tIGVhY2ggbW9kZWwgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICBwbHVjazogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5tYXAodGhpcy5tb2RlbHMsIGZ1bmN0aW9uKG1vZGVsKXsgcmV0dXJuIG1vZGVsLmdldChhdHRyKTsgfSk7CiAgICB9LAoKICAgIC8vIFdoZW4geW91IGhhdmUgbW9yZSBpdGVtcyB0aGFuIHlvdSB3YW50IHRvIGFkZCBvciByZW1vdmUgaW5kaXZpZHVhbGx5LAogICAgLy8geW91IGNhbiByZXNldCB0aGUgZW50aXJlIHNldCB3aXRoIGEgbmV3IGxpc3Qgb2YgbW9kZWxzLCB3aXRob3V0IGZpcmluZwogICAgLy8gYW55IGBhZGRgIG9yIGByZW1vdmVgIGV2ZW50cy4gRmlyZXMgYHJlc2V0YCB3aGVuIGZpbmlzaGVkLgogICAgcmVzZXQ6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICBtb2RlbHMgIHx8IChtb2RlbHMgPSBbXSk7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5tb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKHRoaXMubW9kZWxzW2ldKTsKICAgICAgfQogICAgICB0aGlzLl9yZXNldCgpOwogICAgICB0aGlzLmFkZChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcigncmVzZXQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBkZWZhdWx0IHNldCBvZiBtb2RlbHMgZm9yIHRoaXMgY29sbGVjdGlvbiwgcmVzZXR0aW5nIHRoZQogICAgLy8gY29sbGVjdGlvbiB3aGVuIHRoZXkgYXJyaXZlLiBJZiBgYWRkOiB0cnVlYCBpcyBwYXNzZWQsIGFwcGVuZHMgdGhlCiAgICAvLyBtb2RlbHMgdG8gdGhlIGNvbGxlY3Rpb24gaW5zdGVhZCBvZiByZXNldHRpbmcuCiAgICBmZXRjaDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHVuZGVmaW5lZCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3AsIHN0YXR1cywgeGhyKSB7CiAgICAgICAgY29sbGVjdGlvbltvcHRpb25zLmFkZCA/ICdhZGQnIDogJ3Jlc2V0J10oY29sbGVjdGlvbi5wYXJzZShyZXNwLCB4aHIpLCBvcHRpb25zKTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhjb2xsZWN0aW9uLCByZXNwKTsKICAgICAgfTsKICAgICAgb3B0aW9ucy5lcnJvciA9IEJhY2tib25lLndyYXBFcnJvcihvcHRpb25zLmVycm9yLCBjb2xsZWN0aW9uLCBvcHRpb25zKTsKICAgICAgcmV0dXJuICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgYSBtb2RlbCBpbiB0aGlzIGNvbGxlY3Rpb24uIEFkZCB0aGUgbW9kZWwgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uIGltbWVkaWF0ZWx5LCB1bmxlc3MgYHdhaXQ6IHRydWVgIGlzIHBhc3NlZCwgaW4gd2hpY2ggY2FzZSB3ZQogICAgLy8gd2FpdCBmb3IgdGhlIHNlcnZlciB0byBhZ3JlZS4KICAgIGNyZWF0ZTogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgdmFyIGNvbGwgPSB0aGlzOwogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgbW9kZWwgPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWwsIG9wdGlvbnMpOwogICAgICBpZiAoIW1vZGVsKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBjb2xsLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihuZXh0TW9kZWwsIHJlc3AsIHhocikgewogICAgICAgIGlmIChvcHRpb25zLndhaXQpIGNvbGwuYWRkKG5leHRNb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgIHN1Y2Nlc3MobmV4dE1vZGVsLCByZXNwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dE1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9OwogICAgICBtb2RlbC5zYXZlKG51bGwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gYSBsaXN0IG9mIG1vZGVscyB0byBiZSBhZGRlZCB0byB0aGUKICAgIC8vIGNvbGxlY3Rpb24uIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyBpdCB0aHJvdWdoLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIHhocikgewogICAgICByZXR1cm4gcmVzcDsKICAgIH0sCgogICAgLy8gUHJveHkgdG8gXydzIGNoYWluLiBDYW4ndCBiZSBwcm94aWVkIHRoZSBzYW1lIHdheSB0aGUgcmVzdCBvZiB0aGUKICAgIC8vIHVuZGVyc2NvcmUgbWV0aG9kcyBhcmUgcHJveGllZCBiZWNhdXNlIGl0IHJlbGllcyBvbiB0aGUgdW5kZXJzY29yZQogICAgLy8gY29uc3RydWN0b3IuCiAgICBjaGFpbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gXyh0aGlzLm1vZGVscykuY2hhaW4oKTsKICAgIH0sCgogICAgLy8gUmVzZXQgYWxsIGludGVybmFsIHN0YXRlLiBDYWxsZWQgd2hlbiB0aGUgY29sbGVjdGlvbiBpcyByZXNldC4KICAgIF9yZXNldDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgID0ge307CiAgICAgIHRoaXMuX2J5Q2lkID0ge307CiAgICB9LAoKICAgIC8vIFByZXBhcmUgYSBtb2RlbCBvciBoYXNoIG9mIGF0dHJpYnV0ZXMgdG8gYmUgYWRkZWQgdG8gdGhpcyBjb2xsZWN0aW9uLgogICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgaWYgKCEobW9kZWwgaW5zdGFuY2VvZiBNb2RlbCkpIHsKICAgICAgICB2YXIgYXR0cnMgPSBtb2RlbDsKICAgICAgICBvcHRpb25zLmNvbGxlY3Rpb24gPSB0aGlzOwogICAgICAgIG1vZGVsID0gbmV3IHRoaXMubW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuX3ZhbGlkYXRlKG1vZGVsLmF0dHJpYnV0ZXMsIG9wdGlvbnMpKSBtb2RlbCA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSB7CiAgICAgICAgbW9kZWwuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gcmVtb3ZlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9yZW1vdmVSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgIGlmICh0aGlzID09IG1vZGVsLmNvbGxlY3Rpb24pIHsKICAgICAgICBkZWxldGUgbW9kZWwuY29sbGVjdGlvbjsKICAgICAgfQogICAgICBtb2RlbC5vZmYoJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCBjYWxsZWQgZXZlcnkgdGltZSBhIG1vZGVsIGluIHRoZSBzZXQgZmlyZXMgYW4gZXZlbnQuCiAgICAvLyBTZXRzIG5lZWQgdG8gdXBkYXRlIHRoZWlyIGluZGV4ZXMgd2hlbiBtb2RlbHMgY2hhbmdlIGlkcy4gQWxsIG90aGVyCiAgICAvLyBldmVudHMgc2ltcGx5IHByb3h5IHRocm91Z2guICJhZGQiIGFuZCAicmVtb3ZlIiBldmVudHMgdGhhdCBvcmlnaW5hdGUKICAgIC8vIGluIG90aGVyIGNvbGxlY3Rpb25zIGFyZSBpZ25vcmVkLgogICAgX29uTW9kZWxFdmVudDogZnVuY3Rpb24oZXZlbnQsIG1vZGVsLCBjb2xsZWN0aW9uLCBvcHRpb25zKSB7CiAgICAgIGlmICgoZXZlbnQgPT0gJ2FkZCcgfHwgZXZlbnQgPT0gJ3JlbW92ZScpICYmIGNvbGxlY3Rpb24gIT0gdGhpcykgcmV0dXJuOwogICAgICBpZiAoZXZlbnQgPT0gJ2Rlc3Ryb3knKSB7CiAgICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIGlmIChtb2RlbCAmJiBldmVudCA9PT0gJ2NoYW5nZTonICsgbW9kZWwuaWRBdHRyaWJ1dGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5wcmV2aW91cyhtb2RlbC5pZEF0dHJpYnV0ZSldOwogICAgICAgIHRoaXMuX2J5SWRbbW9kZWwuaWRdID0gbW9kZWw7CiAgICAgIH0KICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB3ZSB3YW50IHRvIGltcGxlbWVudCBvbiB0aGUgQ29sbGVjdGlvbi4KICB2YXIgbWV0aG9kcyA9IFsnZm9yRWFjaCcsICdlYWNoJywgJ21hcCcsICdyZWR1Y2UnLCAncmVkdWNlUmlnaHQnLCAnZmluZCcsCiAgICAnZGV0ZWN0JywgJ2ZpbHRlcicsICdzZWxlY3QnLCAncmVqZWN0JywgJ2V2ZXJ5JywgJ2FsbCcsICdzb21lJywgJ2FueScsCiAgICAnaW5jbHVkZScsICdjb250YWlucycsICdpbnZva2UnLCAnbWF4JywgJ21pbicsICdzb3J0QnknLCAnc29ydGVkSW5kZXgnLAogICAgJ3RvQXJyYXknLCAnc2l6ZScsICdmaXJzdCcsICdpbml0aWFsJywgJ3Jlc3QnLCAnbGFzdCcsICd3aXRob3V0JywgJ2luZGV4T2YnLAogICAgJ3NodWZmbGUnLCAnbGFzdEluZGV4T2YnLCAnaXNFbXB0eScsICdncm91cEJ5J107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYENvbGxlY3Rpb24jbW9kZWxzYC4KICBfLmVhY2gobWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgW3RoaXMubW9kZWxzXS5jb25jYXQoXy50b0FycmF5KGFyZ3VtZW50cykpKTsKICAgIH07CiAgfSk7CgogIC8vIEJhY2tib25lLlJvdXRlcgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gUm91dGVycyBtYXAgZmF1eC1VUkxzIHRvIGFjdGlvbnMsIGFuZCBmaXJlIGV2ZW50cyB3aGVuIHJvdXRlcyBhcmUKICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgdGhpcy5fYmluZFJvdXRlcygpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCiAgdmFyIG5hbWVkUGFyYW0gICAgPSAvOlx3Ky9nOwogIHZhciBzcGxhdFBhcmFtICAgID0gL1wqXHcrL2c7CiAgdmFyIGVzY2FwZVJlZ0V4cCAgPSAvWy1bXF17fSgpKz8uLFxcXiR8I1xzXS9nOwoKICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuUm91dGVyKiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KICBfLmV4dGVuZChSb3V0ZXIucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vIE1hbnVhbGx5IGJpbmQgYSBzaW5nbGUgbmFtZWQgcm91dGUgdG8gYSBjYWxsYmFjay4gRm9yIGV4YW1wbGU6CiAgICAvLwogICAgLy8gICAgIHRoaXMucm91dGUoJ3NlYXJjaC86cXVlcnkvcDpudW0nLCAnc2VhcmNoJywgZnVuY3Rpb24ocXVlcnksIG51bSkgewogICAgLy8gICAgICAgLi4uCiAgICAvLyAgICAgfSk7CiAgICAvLwogICAgcm91dGU6IGZ1bmN0aW9uKHJvdXRlLCBuYW1lLCBjYWxsYmFjaykgewogICAgICBCYWNrYm9uZS5oaXN0b3J5IHx8IChCYWNrYm9uZS5oaXN0b3J5ID0gbmV3IEhpc3RvcnkpOwogICAgICBpZiAoIV8uaXNSZWdFeHAocm91dGUpKSByb3V0ZSA9IHRoaXMuX3JvdXRlVG9SZWdFeHAocm91dGUpOwogICAgICBpZiAoIWNhbGxiYWNrKSBjYWxsYmFjayA9IHRoaXNbbmFtZV07CiAgICAgIEJhY2tib25lLmhpc3Rvcnkucm91dGUocm91dGUsIF8uYmluZChmdW5jdGlvbihmcmFnbWVudCkgewogICAgICAgIHZhciBhcmdzID0gdGhpcy5fZXh0cmFjdFBhcmFtZXRlcnMocm91dGUsIGZyYWdtZW50KTsKICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICB0aGlzLnRyaWdnZXIuYXBwbHkodGhpcywgWydyb3V0ZTonICsgbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnRyaWdnZXIoJ3JvdXRlJywgdGhpcywgbmFtZSwgYXJncyk7CiAgICAgIH0sIHRoaXMpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFNpbXBsZSBwcm94eSB0byBgQmFja2JvbmUuaGlzdG9yeWAgdG8gc2F2ZSBhIGZyYWdtZW50IGludG8gdGhlIGhpc3RvcnkuCiAgICBuYXZpZ2F0ZTogZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgICAgQmFja2JvbmUuaGlzdG9yeS5uYXZpZ2F0ZShmcmFnbWVudCwgb3B0aW9ucyk7CiAgICB9LAoKICAgIC8vIEJpbmQgYWxsIGRlZmluZWQgcm91dGVzIHRvIGBCYWNrYm9uZS5oaXN0b3J5YC4gV2UgaGF2ZSB0byByZXZlcnNlIHRoZQogICAgLy8gb3JkZXIgb2YgdGhlIHJvdXRlcyBoZXJlIHRvIHN1cHBvcnQgYmVoYXZpb3Igd2hlcmUgdGhlIG1vc3QgZ2VuZXJhbAogICAgLy8gcm91dGVzIGNhbiBiZSBkZWZpbmVkIGF0IHRoZSBib3R0b20gb2YgdGhlIHJvdXRlIG1hcC4KICAgIF9iaW5kUm91dGVzOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCF0aGlzLnJvdXRlcykgcmV0dXJuOwogICAgICB2YXIgcm91dGVzID0gW107CiAgICAgIGZvciAodmFyIHJvdXRlIGluIHRoaXMucm91dGVzKSB7CiAgICAgICAgcm91dGVzLnVuc2hpZnQoW3JvdXRlLCB0aGlzLnJvdXRlc1tyb3V0ZV1dKTsKICAgICAgfQogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvdXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlc1tpXVswXSwgcm91dGVzW2ldWzFdLCB0aGlzW3JvdXRlc1tpXVsxXV0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nCiAgICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2guCiAgICBfcm91dGVUb1JlZ0V4cDogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgJyhbXlwvXSspJykKICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKHNwbGF0UGFyYW0sICcoLio/KScpOwogICAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyByb3V0ZSArICckJyk7CiAgICB9LAoKICAgIC8vIEdpdmVuIGEgcm91dGUsIGFuZCBhIFVSTCBmcmFnbWVudCB0aGF0IGl0IG1hdGNoZXMsIHJldHVybiB0aGUgYXJyYXkgb2YKICAgIC8vIGV4dHJhY3RlZCBwYXJhbWV0ZXJzLgogICAgX2V4dHJhY3RQYXJhbWV0ZXJzOiBmdW5jdGlvbihyb3V0ZSwgZnJhZ21lbnQpIHsKICAgICAgcmV0dXJuIHJvdXRlLmV4ZWMoZnJhZ21lbnQpLnNsaWNlKDEpOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuSGlzdG9yeQogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gVVJMIGZyYWdtZW50cy4gSWYgdGhlCiAgLy8gYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IGBvbmhhc2hjaGFuZ2VgLCBmYWxscyBiYWNrIHRvIHBvbGxpbmcuCiAgdmFyIEhpc3RvcnkgPSBCYWNrYm9uZS5IaXN0b3J5ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmhhbmRsZXJzID0gW107CiAgICBfLmJpbmRBbGwodGhpcywgJ2NoZWNrVXJsJyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBjbGVhbmluZyBsZWFkaW5nIGhhc2hlcyBhbmQgc2xhc2hlcyAuCiAgdmFyIHJvdXRlU3RyaXBwZXIgPSAvXlsjXC9dLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBkZXRlY3RpbmcgTVNJRS4KICB2YXIgaXNFeHBsb3JlciA9IC9tc2llIFtcdy5dKy87CgogIC8vIEhhcyB0aGUgaGlzdG9yeSBoYW5kbGluZyBhbHJlYWR5IGJlZW4gc3RhcnRlZD8KICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLkhpc3RvcnkqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBpbnRlcnZhbCB0byBwb2xsIGZvciBoYXNoIGNoYW5nZXMsIGlmIG5lY2Vzc2FyeSwgaXMKICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC4KICAgIGludGVydmFsOiA1MCwKCiAgICAvLyBHZXRzIHRoZSB0cnVlIGhhc2ggdmFsdWUuIENhbm5vdCB1c2UgbG9jYXRpb24uaGFzaCBkaXJlY3RseSBkdWUgdG8gYnVnCiAgICAvLyBpbiBGaXJlZm94IHdoZXJlIGxvY2F0aW9uLmhhc2ggd2lsbCBhbHdheXMgYmUgZGVjb2RlZC4KICAgIGdldEhhc2g6IGZ1bmN0aW9uKHdpbmRvd092ZXJyaWRlKSB7CiAgICAgIHZhciBsb2MgPSB3aW5kb3dPdmVycmlkZSA/IHdpbmRvd092ZXJyaWRlLmxvY2F0aW9uIDogd2luZG93LmxvY2F0aW9uOwogICAgICB2YXIgbWF0Y2ggPSBsb2MuaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgY3Jvc3MtYnJvd3NlciBub3JtYWxpemVkIFVSTCBmcmFnbWVudCwgZWl0aGVyIGZyb20gdGhlIFVSTCwKICAgIC8vIHRoZSBoYXNoLCBvciB0aGUgb3ZlcnJpZGUuCiAgICBnZXRGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQsIGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgIGlmIChmcmFnbWVudCA9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCBmb3JjZVB1c2hTdGF0ZSkgewogICAgICAgICAgZnJhZ21lbnQgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICB2YXIgc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaDsKICAgICAgICAgIGlmIChzZWFyY2gpIGZyYWdtZW50ICs9IHNlYXJjaDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdldEhhc2goKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFmcmFnbWVudC5pbmRleE9mKHRoaXMub3B0aW9ucy5yb290KSkgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIodGhpcy5vcHRpb25zLnJvb3QubGVuZ3RoKTsKICAgICAgcmV0dXJuIGZyYWdtZW50LnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgfSwKCiAgICAvLyBTdGFydCB0aGUgaGFzaCBjaGFuZ2UgaGFuZGxpbmcsIHJldHVybmluZyBgdHJ1ZWAgaWYgdGhlIGN1cnJlbnQgVVJMIG1hdGNoZXMKICAgIC8vIGFuIGV4aXN0aW5nIHJvdXRlLCBhbmQgYGZhbHNlYCBvdGhlcndpc2UuCiAgICBzdGFydDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBpZiAoSGlzdG9yeS5zdGFydGVkKSB0aHJvdyBuZXcgRXJyb3IoIkJhY2tib25lLmhpc3RvcnkgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIik7CiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IHRydWU7CgogICAgICAvLyBGaWd1cmUgb3V0IHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24uIERvIHdlIG5lZWQgYW4gaWZyYW1lPwogICAgICAvLyBJcyBwdXNoU3RhdGUgZGVzaXJlZCAuLi4gaXMgaXQgYXZhaWxhYmxlPwogICAgICB0aGlzLm9wdGlvbnMgICAgICAgICAgPSBfLmV4dGVuZCh7fSwge3Jvb3Q6ICcvJ30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICAgIHRoaXMuX3dhbnRzSGFzaENoYW5nZSA9IHRoaXMub3B0aW9ucy5oYXNoQ2hhbmdlICE9PSBmYWxzZTsKICAgICAgdGhpcy5fd2FudHNQdXNoU3RhdGUgID0gISF0aGlzLm9wdGlvbnMucHVzaFN0YXRlOwogICAgICB0aGlzLl9oYXNQdXNoU3RhdGUgICAgPSAhISh0aGlzLm9wdGlvbnMucHVzaFN0YXRlICYmIHdpbmRvdy5oaXN0b3J5ICYmIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSk7CiAgICAgIHZhciBmcmFnbWVudCAgICAgICAgICA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgICAgdmFyIGRvY01vZGUgICAgICAgICAgID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlOwogICAgICB2YXIgb2xkSUUgICAgICAgICAgICAgPSAoaXNFeHBsb3Jlci5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSkgJiYgKCFkb2NNb2RlIHx8IGRvY01vZGUgPD0gNykpOwoKICAgICAgaWYgKG9sZElFKSB7CiAgICAgICAgdGhpcy5pZnJhbWUgPSAkKCc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDowIiB0YWJpbmRleD0iLTEiIC8+JykuaGlkZSgpLmFwcGVuZFRvKCdib2R5JylbMF0uY29udGVudFdpbmRvdzsKICAgICAgICB0aGlzLm5hdmlnYXRlKGZyYWdtZW50KTsKICAgICAgfQoKICAgICAgLy8gRGVwZW5kaW5nIG9uIHdoZXRoZXIgd2UncmUgdXNpbmcgcHVzaFN0YXRlIG9yIGhhc2hlcywgYW5kIHdoZXRoZXIKICAgICAgLy8gJ29uaGFzaGNoYW5nZScgaXMgc3VwcG9ydGVkLCBkZXRlcm1pbmUgaG93IHdlIGNoZWNrIHRoZSBVUkwgc3RhdGUuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICAkKHdpbmRvdykuYmluZCgncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgIW9sZElFKSB7CiAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ2hhc2hjaGFuZ2UnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl9jaGVja1VybEludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5jaGVja1VybCwgdGhpcy5pbnRlcnZhbCk7CiAgICAgIH0KCiAgICAgIC8vIERldGVybWluZSBpZiB3ZSBuZWVkIHRvIGNoYW5nZSB0aGUgYmFzZSB1cmwsIGZvciBhIHB1c2hTdGF0ZSBsaW5rCiAgICAgIC8vIG9wZW5lZCBieSBhIG5vbi1wdXNoU3RhdGUgYnJvd3Nlci4KICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50OwogICAgICB2YXIgbG9jID0gd2luZG93LmxvY2F0aW9uOwogICAgICB2YXIgYXRSb290ICA9IGxvYy5wYXRobmFtZSA9PSB0aGlzLm9wdGlvbnMucm9vdDsKCiAgICAgIC8vIElmIHdlJ3ZlIHN0YXJ0ZWQgb2ZmIHdpdGggYSByb3V0ZSBmcm9tIGEgYHB1c2hTdGF0ZWAtZW5hYmxlZCBicm93c2VyLAogICAgICAvLyBidXQgd2UncmUgY3VycmVudGx5IGluIGEgYnJvd3NlciB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBpdC4uLgogICAgICBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlICYmIHRoaXMuX3dhbnRzUHVzaFN0YXRlICYmICF0aGlzLl9oYXNQdXNoU3RhdGUgJiYgIWF0Um9vdCkgewogICAgICAgIHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KG51bGwsIHRydWUpOwogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHRoaXMub3B0aW9ucy5yb290ICsgJyMnICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgLy8gUmV0dXJuIGltbWVkaWF0ZWx5IGFzIGJyb3dzZXIgd2lsbCBkbyByZWRpcmVjdCB0byBuZXcgdXJsCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAvLyBpbiBhIGJyb3dzZXIgd2hlcmUgaXQgY291bGQgYmUgYHB1c2hTdGF0ZWAtYmFzZWQgaW5zdGVhZC4uLgogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzUHVzaFN0YXRlICYmIHRoaXMuX2hhc1B1c2hTdGF0ZSAmJiBhdFJvb3QgJiYgbG9jLmhhc2gpIHsKICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCkucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgbG9jLnByb3RvY29sICsgJy8vJyArIGxvYy5ob3N0ICsgdGhpcy5vcHRpb25zLnJvb3QgKyB0aGlzLmZyYWdtZW50KTsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMubG9hZFVybCgpOwogICAgICB9CiAgICB9LAoKICAgIC8vIERpc2FibGUgQmFja2JvbmUuaGlzdG9yeSwgcGVyaGFwcyB0ZW1wb3JhcmlseS4gTm90IHVzZWZ1bCBpbiBhIHJlYWwgYXBwLAogICAgLy8gYnV0IHBvc3NpYmx5IHVzZWZ1bCBmb3IgdW5pdCB0ZXN0aW5nIFJvdXRlcnMuCiAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgJCh3aW5kb3cpLnVuYmluZCgncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKS51bmJpbmQoJ2hhc2hjaGFuZ2UnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9jaGVja1VybEludGVydmFsKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gZmFsc2U7CiAgICB9LAoKICAgIC8vIEFkZCBhIHJvdXRlIHRvIGJlIHRlc3RlZCB3aGVuIHRoZSBmcmFnbWVudCBjaGFuZ2VzLiBSb3V0ZXMgYWRkZWQgbGF0ZXIKICAgIC8vIG1heSBvdmVycmlkZSBwcmV2aW91cyByb3V0ZXMuCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuaGFuZGxlcnMudW5zaGlmdCh7cm91dGU6IHJvdXRlLCBjYWxsYmFjazogY2FsbGJhY2t9KTsKICAgIH0sCgogICAgLy8gQ2hlY2tzIHRoZSBjdXJyZW50IFVSTCB0byBzZWUgaWYgaXQgaGFzIGNoYW5nZWQsIGFuZCBpZiBpdCBoYXMsCiAgICAvLyBjYWxscyBgbG9hZFVybGAsIG5vcm1hbGl6aW5nIGFjcm9zcyB0aGUgaGlkZGVuIGlmcmFtZS4KICAgIGNoZWNrVXJsOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgICBpZiAoY3VycmVudCA9PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCh0aGlzLmdldEhhc2godGhpcy5pZnJhbWUpKTsKICAgICAgaWYgKGN1cnJlbnQgPT0gdGhpcy5mcmFnbWVudCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAodGhpcy5pZnJhbWUpIHRoaXMubmF2aWdhdGUoY3VycmVudCk7CiAgICAgIHRoaXMubG9hZFVybCgpIHx8IHRoaXMubG9hZFVybCh0aGlzLmdldEhhc2goKSk7CiAgICB9LAoKICAgIC8vIEF0dGVtcHQgdG8gbG9hZCB0aGUgY3VycmVudCBVUkwgZnJhZ21lbnQuIElmIGEgcm91dGUgc3VjY2VlZHMgd2l0aCBhCiAgICAvLyBtYXRjaCwgcmV0dXJucyBgdHJ1ZWAuIElmIG5vIGRlZmluZWQgcm91dGVzIG1hdGNoZXMgdGhlIGZyYWdtZW50LAogICAgLy8gcmV0dXJucyBgZmFsc2VgLgogICAgbG9hZFVybDogZnVuY3Rpb24oZnJhZ21lbnRPdmVycmlkZSkgewogICAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChmcmFnbWVudE92ZXJyaWRlKTsKICAgICAgdmFyIG1hdGNoZWQgPSBfLmFueSh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbihoYW5kbGVyKSB7CiAgICAgICAgaWYgKGhhbmRsZXIucm91dGUudGVzdChmcmFnbWVudCkpIHsKICAgICAgICAgIGhhbmRsZXIuY2FsbGJhY2soZnJhZ21lbnQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIG1hdGNoZWQ7CiAgICB9LAoKICAgIC8vIFNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoYXNoIGhpc3RvcnksIG9yIHJlcGxhY2UgdGhlIFVSTCBzdGF0ZSBpZiB0aGUKICAgIC8vICdyZXBsYWNlJyBvcHRpb24gaXMgcGFzc2VkLiBZb3UgYXJlIHJlc3BvbnNpYmxlIGZvciBwcm9wZXJseSBVUkwtZW5jb2RpbmcKICAgIC8vIHRoZSBmcmFnbWVudCBpbiBhZHZhbmNlLgogICAgLy8KICAgIC8vIFRoZSBvcHRpb25zIG9iamVjdCBjYW4gY29udGFpbiBgdHJpZ2dlcjogdHJ1ZWAgaWYgeW91IHdpc2ggdG8gaGF2ZSB0aGUKICAgIC8vIHJvdXRlIGNhbGxiYWNrIGJlIGZpcmVkIChub3QgdXN1YWxseSBkZXNpcmFibGUpLCBvciBgcmVwbGFjZTogdHJ1ZWAsIGlmCiAgICAvLyB5b3Ugd2lzaCB0byBtb2RpZnkgdGhlIGN1cnJlbnQgVVJMIHdpdGhvdXQgYWRkaW5nIGFuIGVudHJ5IHRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIGlmICghSGlzdG9yeS5zdGFydGVkKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucyB8fCBvcHRpb25zID09PSB0cnVlKSBvcHRpb25zID0ge3RyaWdnZXI6IG9wdGlvbnN9OwogICAgICB2YXIgZnJhZyA9IChmcmFnbWVudCB8fCAnJykucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgIGlmICh0aGlzLmZyYWdtZW50ID09IGZyYWcpIHJldHVybjsKCiAgICAgIC8vIElmIHB1c2hTdGF0ZSBpcyBhdmFpbGFibGUsIHdlIHVzZSBpdCB0byBzZXQgdGhlIGZyYWdtZW50IGFzIGEgcmVhbCBVUkwuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICBpZiAoZnJhZy5pbmRleE9mKHRoaXMub3B0aW9ucy5yb290KSAhPSAwKSBmcmFnID0gdGhpcy5vcHRpb25zLnJvb3QgKyBmcmFnOwogICAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnOwogICAgICAgIHdpbmRvdy5oaXN0b3J5W29wdGlvbnMucmVwbGFjZSA/ICdyZXBsYWNlU3RhdGUnIDogJ3B1c2hTdGF0ZSddKHt9LCBkb2N1bWVudC50aXRsZSwgZnJhZyk7CgogICAgICAvLyBJZiBoYXNoIGNoYW5nZXMgaGF2ZW4ndCBiZWVuIGV4cGxpY2l0bHkgZGlzYWJsZWQsIHVwZGF0ZSB0aGUgaGFzaAogICAgICAvLyBmcmFnbWVudCB0byBzdG9yZSBoaXN0b3J5LgogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnOwogICAgICAgIHRoaXMuX3VwZGF0ZUhhc2god2luZG93LmxvY2F0aW9uLCBmcmFnLCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZyAhPSB0aGlzLmdldEZyYWdtZW50KHRoaXMuZ2V0SGFzaCh0aGlzLmlmcmFtZSkpKSkgewogICAgICAgICAgLy8gT3BlbmluZyBhbmQgY2xvc2luZyB0aGUgaWZyYW1lIHRyaWNrcyBJRTcgYW5kIGVhcmxpZXIgdG8gcHVzaCBhIGhpc3RvcnkgZW50cnkgb24gaGFzaC10YWcgY2hhbmdlLgogICAgICAgICAgLy8gV2hlbiByZXBsYWNlIGlzIHRydWUsIHdlIGRvbid0IHdhbnQgdGhpcy4KICAgICAgICAgIGlmKCFvcHRpb25zLnJlcGxhY2UpIHRoaXMuaWZyYW1lLmRvY3VtZW50Lm9wZW4oKS5jbG9zZSgpOwogICAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh0aGlzLmlmcmFtZS5sb2NhdGlvbiwgZnJhZywgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICB9CgogICAgICAvLyBJZiB5b3UndmUgdG9sZCB1cyB0aGF0IHlvdSBleHBsaWNpdGx5IGRvbid0IHdhbnQgZmFsbGJhY2sgaGFzaGNoYW5nZS0KICAgICAgLy8gYmFzZWQgaGlzdG9yeSwgdGhlbiBgbmF2aWdhdGVgIGJlY29tZXMgYSBwYWdlIHJlZnJlc2guCiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih0aGlzLm9wdGlvbnMucm9vdCArIGZyYWdtZW50KTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSB0aGlzLmxvYWRVcmwoZnJhZ21lbnQpOwogICAgfSwKCiAgICAvLyBVcGRhdGUgdGhlIGhhc2ggbG9jYXRpb24sIGVpdGhlciByZXBsYWNpbmcgdGhlIGN1cnJlbnQgZW50cnksIG9yIGFkZGluZwogICAgLy8gYSBuZXcgb25lIHRvIHRoZSBicm93c2VyIGhpc3RvcnkuCiAgICBfdXBkYXRlSGFzaDogZnVuY3Rpb24obG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7CiAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShsb2NhdGlvbi50b1N0cmluZygpLnJlcGxhY2UoLyhqYXZhc2NyaXB0OnwjKS4qJC8sICcnKSArICcjJyArIGZyYWdtZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2NhdGlvbi5oYXNoID0gZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sCiAgLy8gaWYgYW4gZXhpc3RpbmcgZWxlbWVudCBpcyBub3QgcHJvdmlkZWQuLi4KICB2YXIgVmlldyA9IEJhY2tib25lLlZpZXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTsKICAgIHRoaXMuX2NvbmZpZ3VyZShvcHRpb25zIHx8IHt9KTsKICAgIHRoaXMuX2Vuc3VyZUVsZW1lbnQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogIH07CgogIC8vIENhY2hlZCByZWdleCB0byBzcGxpdCBrZXlzIGZvciBgZGVsZWdhdGVgLgogIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcUyspXHMqKC4qKSQvOwoKICAvLyBMaXN0IG9mIHZpZXcgb3B0aW9ucyB0byBiZSBtZXJnZWQgYXMgcHJvcGVydGllcy4KICB2YXIgdmlld09wdGlvbnMgPSBbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAnZWwnLCAnaWQnLCAnYXR0cmlidXRlcycsICdjbGFzc05hbWUnLCAndGFnTmFtZSddOwoKICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuVmlldyoqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAgXy5leHRlbmQoVmlldy5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIFRoZSBkZWZhdWx0IGB0YWdOYW1lYCBvZiBhIFZpZXcncyBlbGVtZW50IGlzIGAiZGl2ImAuCiAgICB0YWdOYW1lOiAnZGl2JywKCiAgICAvLyBqUXVlcnkgZGVsZWdhdGUgZm9yIGVsZW1lbnQgbG9va3VwLCBzY29wZWQgdG8gRE9NIGVsZW1lbnRzIHdpdGhpbiB0aGUKICAgIC8vIGN1cnJlbnQgdmlldy4gVGhpcyBzaG91bGQgYmUgcHJlZmVyZWQgdG8gZ2xvYmFsIGxvb2t1cHMgd2hlcmUgcG9zc2libGUuCiAgICAkOiBmdW5jdGlvbihzZWxlY3RvcikgewogICAgICByZXR1cm4gdGhpcy4kZWwuZmluZChzZWxlY3Rvcik7CiAgICB9LAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gKipyZW5kZXIqKiBpcyB0aGUgY29yZSBmdW5jdGlvbiB0aGF0IHlvdXIgdmlldyBzaG91bGQgb3ZlcnJpZGUsIGluIG9yZGVyCiAgICAvLyB0byBwb3B1bGF0ZSBpdHMgZWxlbWVudCAoYHRoaXMuZWxgKSwgd2l0aCB0aGUgYXBwcm9wcmlhdGUgSFRNTC4gVGhlCiAgICAvLyBjb252ZW50aW9uIGlzIGZvciAqKnJlbmRlcioqIHRvIGFsd2F5cyByZXR1cm4gYHRoaXNgLgogICAgcmVuZGVyOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSB0aGlzIHZpZXcgZnJvbSB0aGUgRE9NLiBOb3RlIHRoYXQgdGhlIHZpZXcgaXNuJ3QgcHJlc2VudCBpbiB0aGUKICAgIC8vIERPTSBieSBkZWZhdWx0LCBzbyBjYWxsaW5nIHRoaXMgbWV0aG9kIG1heSBiZSBhIG5vLW9wLgogICAgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwucmVtb3ZlKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBGb3Igc21hbGwgYW1vdW50cyBvZiBET00gRWxlbWVudHMsIHdoZXJlIGEgZnVsbC1ibG93biB0ZW1wbGF0ZSBpc24ndAogICAgLy8gbmVlZGVkLCB1c2UgKiptYWtlKiogdG8gbWFudWZhY3R1cmUgZWxlbWVudHMsIG9uZSBhdCBhIHRpbWUuCiAgICAvLwogICAgLy8gICAgIHZhciBlbCA9IHRoaXMubWFrZSgnbGknLCB7J2NsYXNzJzogJ3Jvdyd9LCB0aGlzLm1vZGVsLmVzY2FwZSgndGl0bGUnKSk7CiAgICAvLwogICAgbWFrZTogZnVuY3Rpb24odGFnTmFtZSwgYXR0cmlidXRlcywgY29udGVudCkgewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwogICAgICBpZiAoYXR0cmlidXRlcykgJChlbCkuYXR0cihhdHRyaWJ1dGVzKTsKICAgICAgaWYgKGNvbnRlbnQpICQoZWwpLmh0bWwoY29udGVudCk7CiAgICAgIHJldHVybiBlbDsKICAgIH0sCgogICAgLy8gQ2hhbmdlIHRoZSB2aWV3J3MgZWxlbWVudCAoYHRoaXMuZWxgIHByb3BlcnR5KSwgaW5jbHVkaW5nIGV2ZW50CiAgICAvLyByZS1kZWxlZ2F0aW9uLgogICAgc2V0RWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCwgZGVsZWdhdGUpIHsKICAgICAgaWYgKHRoaXMuJGVsKSB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgdGhpcy4kZWwgPSAoZWxlbWVudCBpbnN0YW5jZW9mICQpID8gZWxlbWVudCA6ICQoZWxlbWVudCk7CiAgICAgIHRoaXMuZWwgPSB0aGlzLiRlbFswXTsKICAgICAgaWYgKGRlbGVnYXRlICE9PSBmYWxzZSkgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gU2V0IGNhbGxiYWNrcywgd2hlcmUgYHRoaXMuZXZlbnRzYCBpcyBhIGhhc2ggb2YKICAgIC8vCiAgICAvLyAqeyJldmVudCBzZWxlY3RvciI6ICJjYWxsYmFjayJ9KgogICAgLy8KICAgIC8vICAgICB7CiAgICAvLyAgICAgICAnbW91c2Vkb3duIC50aXRsZSc6ICAnZWRpdCcsCiAgICAvLyAgICAgICAnY2xpY2sgLmJ1dHRvbic6ICAgICAnc2F2ZScKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oZXZlbnRzKSB7CiAgICAgIGlmICghKGV2ZW50cyB8fCAoZXZlbnRzID0gZ2V0VmFsdWUodGhpcywgJ2V2ZW50cycpKSkpIHJldHVybjsKICAgICAgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIGZvciAodmFyIGtleSBpbiBldmVudHMpIHsKICAgICAgICB2YXIgbWV0aG9kID0gZXZlbnRzW2tleV07CiAgICAgICAgaWYgKCFfLmlzRnVuY3Rpb24obWV0aG9kKSkgbWV0aG9kID0gdGhpc1tldmVudHNba2V5XV07CiAgICAgICAgaWYgKCFtZXRob2QpIHRocm93IG5ldyBFcnJvcignTWV0aG9kICInICsgZXZlbnRzW2tleV0gKyAnIiBkb2VzIG5vdCBleGlzdCcpOwogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBtYXRjaFsxXSwgc2VsZWN0b3IgPSBtYXRjaFsyXTsKICAgICAgICBtZXRob2QgPSBfLmJpbmQobWV0aG9kLCB0aGlzKTsKICAgICAgICBldmVudE5hbWUgKz0gJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZDsKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5iaW5kKGV2ZW50TmFtZSwgbWV0aG9kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZWwuZGVsZWdhdGUoc2VsZWN0b3IsIGV2ZW50TmFtZSwgbWV0aG9kKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLy8gQ2xlYXJzIGFsbCBjYWxsYmFja3MgcHJldmlvdXNseSBib3VuZCB0byB0aGUgdmlldyB3aXRoIGBkZWxlZ2F0ZUV2ZW50c2AuCiAgICAvLyBZb3UgdXN1YWxseSBkb24ndCBuZWVkIHRvIHVzZSB0aGlzLCBidXQgbWF5IHdpc2ggdG8gaWYgeW91IGhhdmUgbXVsdGlwbGUKICAgIC8vIEJhY2tib25lIHZpZXdzIGF0dGFjaGVkIHRvIHRoZSBzYW1lIERPTSBlbGVtZW50LgogICAgdW5kZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnVuYmluZCgnLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkKTsKICAgIH0sCgogICAgLy8gUGVyZm9ybXMgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbiBvZiBhIFZpZXcgd2l0aCBhIHNldCBvZiBvcHRpb25zLgogICAgLy8gS2V5cyB3aXRoIHNwZWNpYWwgbWVhbmluZyAqKG1vZGVsLCBjb2xsZWN0aW9uLCBpZCwgY2xhc3NOYW1lKSosIGFyZQogICAgLy8gYXR0YWNoZWQgZGlyZWN0bHkgdG8gdGhlIHZpZXcuCiAgICBfY29uZmlndXJlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMpIG9wdGlvbnMgPSBfLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2aWV3T3B0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgYXR0ciA9IHZpZXdPcHRpb25zW2ldOwogICAgICAgIGlmIChvcHRpb25zW2F0dHJdKSB0aGlzW2F0dHJdID0gb3B0aW9uc1thdHRyXTsKICAgICAgfQogICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgfSwKCiAgICAvLyBFbnN1cmUgdGhhdCB0aGUgVmlldyBoYXMgYSBET00gZWxlbWVudCB0byByZW5kZXIgaW50by4KICAgIC8vIElmIGB0aGlzLmVsYCBpcyBhIHN0cmluZywgcGFzcyBpdCB0aHJvdWdoIGAkKClgLCB0YWtlIHRoZSBmaXJzdAogICAgLy8gbWF0Y2hpbmcgZWxlbWVudCwgYW5kIHJlLWFzc2lnbiBpdCB0byBgZWxgLiBPdGhlcndpc2UsIGNyZWF0ZQogICAgLy8gYW4gZWxlbWVudCBmcm9tIHRoZSBgaWRgLCBgY2xhc3NOYW1lYCBhbmQgYHRhZ05hbWVgIHByb3BlcnRpZXMuCiAgICBfZW5zdXJlRWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICghdGhpcy5lbCkgewogICAgICAgIHZhciBhdHRycyA9IGdldFZhbHVlKHRoaXMsICdhdHRyaWJ1dGVzJykgfHwge307CiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gdGhpcy5pZDsKICAgICAgICBpZiAodGhpcy5jbGFzc05hbWUpIGF0dHJzWydjbGFzcyddID0gdGhpcy5jbGFzc05hbWU7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KHRoaXMubWFrZSh0aGlzLnRhZ05hbWUsIGF0dHJzKSwgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0RWxlbWVudCh0aGlzLmVsLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIFRoZSBzZWxmLXByb3BhZ2F0aW5nIGV4dGVuZCBmdW5jdGlvbiB0aGF0IEJhY2tib25lIGNsYXNzZXMgdXNlLgogIHZhciBleHRlbmQgPSBmdW5jdGlvbiAocHJvdG9Qcm9wcywgY2xhc3NQcm9wcykgewogICAgdmFyIGNoaWxkID0gaW5oZXJpdHModGhpcywgcHJvdG9Qcm9wcywgY2xhc3NQcm9wcyk7CiAgICBjaGlsZC5leHRlbmQgPSB0aGlzLmV4dGVuZDsKICAgIHJldHVybiBjaGlsZDsKICB9OwoKICAvLyBTZXQgdXAgaW5oZXJpdGFuY2UgZm9yIHRoZSBtb2RlbCwgY29sbGVjdGlvbiwgYW5kIHZpZXcuCiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBleHRlbmQ7CgogIC8vIEJhY2tib25lLnN5bmMKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIE1hcCBmcm9tIENSVUQgdG8gSFRUUCBmb3Igb3VyIGRlZmF1bHQgYEJhY2tib25lLnN5bmNgIGltcGxlbWVudGF0aW9uLgogIHZhciBtZXRob2RNYXAgPSB7CiAgICAnY3JlYXRlJzogJ1BPU1QnLAogICAgJ3VwZGF0ZSc6ICdQVVQnLAogICAgJ2RlbGV0ZSc6ICdERUxFVEUnLAogICAgJ3JlYWQnOiAgICdHRVQnCiAgfTsKCiAgLy8gT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byBjaGFuZ2UgdGhlIG1hbm5lciBpbiB3aGljaCBCYWNrYm9uZSBwZXJzaXN0cwogIC8vIG1vZGVscyB0byB0aGUgc2VydmVyLiBZb3Ugd2lsbCBiZSBwYXNzZWQgdGhlIHR5cGUgb2YgcmVxdWVzdCwgYW5kIHRoZQogIC8vIG1vZGVsIGluIHF1ZXN0aW9uLiBCeSBkZWZhdWx0LCBtYWtlcyBhIFJFU1RmdWwgQWpheCByZXF1ZXN0CiAgLy8gdG8gdGhlIG1vZGVsJ3MgYHVybCgpYC4gU29tZSBwb3NzaWJsZSBjdXN0b21pemF0aW9ucyBjb3VsZCBiZToKICAvLwogIC8vICogVXNlIGBzZXRUaW1lb3V0YCB0byBiYXRjaCByYXBpZC1maXJlIHVwZGF0ZXMgaW50byBhIHNpbmdsZSByZXF1ZXN0LgogIC8vICogU2VuZCB1cCB0aGUgbW9kZWxzIGFzIFhNTCBpbnN0ZWFkIG9mIEpTT04uCiAgLy8gKiBQZXJzaXN0IG1vZGVscyB2aWEgV2ViU29ja2V0cyBpbnN0ZWFkIG9mIEFqYXguCiAgLy8KICAvLyBUdXJuIG9uIGBCYWNrYm9uZS5lbXVsYXRlSFRUUGAgaW4gb3JkZXIgdG8gc2VuZCBgUFVUYCBhbmQgYERFTEVURWAgcmVxdWVzdHMKICAvLyBhcyBgUE9TVGAsIHdpdGggYSBgX21ldGhvZGAgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIHRydWUgSFRUUCBtZXRob2QsCiAgLy8gYXMgd2VsbCBhcyBhbGwgcmVxdWVzdHMgd2l0aCB0aGUgYm9keSBhcyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYAogIC8vIGluc3RlYWQgb2YgYGFwcGxpY2F0aW9uL2pzb25gIHdpdGggdGhlIG1vZGVsIGluIGEgcGFyYW0gbmFtZWQgYG1vZGVsYC4KICAvLyBVc2VmdWwgd2hlbiBpbnRlcmZhY2luZyB3aXRoIHNlcnZlci1zaWRlIGxhbmd1YWdlcyBsaWtlICoqUEhQKiogdGhhdCBtYWtlCiAgLy8gaXQgZGlmZmljdWx0IHRvIHJlYWQgdGhlIGJvZHkgb2YgYFBVVGAgcmVxdWVzdHMuCiAgQmFja2JvbmUuc3luYyA9IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdGlvbnMpIHsKICAgIHZhciB0eXBlID0gbWV0aG9kTWFwW21ldGhvZF07CgogICAgLy8gRGVmYXVsdCBvcHRpb25zLCB1bmxlc3Mgc3BlY2lmaWVkLgogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAvLyBEZWZhdWx0IEpTT04tcmVxdWVzdCBvcHRpb25zLgogICAgdmFyIHBhcmFtcyA9IHt0eXBlOiB0eXBlLCBkYXRhVHlwZTogJ2pzb24nfTsKCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIGEgVVJMLgogICAgaWYgKCFvcHRpb25zLnVybCkgewogICAgICBwYXJhbXMudXJsID0gZ2V0VmFsdWUobW9kZWwsICd1cmwnKSB8fCB1cmxFcnJvcigpOwogICAgfQoKICAgIC8vIEVuc3VyZSB0aGF0IHdlIGhhdmUgdGhlIGFwcHJvcHJpYXRlIHJlcXVlc3QgZGF0YS4KICAgIGlmICghb3B0aW9ucy5kYXRhICYmIG1vZGVsICYmIChtZXRob2QgPT0gJ2NyZWF0ZScgfHwgbWV0aG9kID09ICd1cGRhdGUnKSkgewogICAgICBwYXJhbXMuY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24vanNvbic7CiAgICAgIHBhcmFtcy5kYXRhID0gSlNPTi5zdHJpbmdpZnkobW9kZWwudG9KU09OKCkpOwogICAgfQoKICAgIC8vIEZvciBvbGRlciBzZXJ2ZXJzLCBlbXVsYXRlIEpTT04gYnkgZW5jb2RpbmcgdGhlIHJlcXVlc3QgaW50byBhbiBIVE1MLWZvcm0uCiAgICBpZiAoQmFja2JvbmUuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7CiAgICAgIHBhcmFtcy5kYXRhID0gcGFyYW1zLmRhdGEgPyB7bW9kZWw6IHBhcmFtcy5kYXRhfSA6IHt9OwogICAgfQoKICAgIC8vIEZvciBvbGRlciBzZXJ2ZXJzLCBlbXVsYXRlIEhUVFAgYnkgbWltaWNraW5nIHRoZSBIVFRQIG1ldGhvZCB3aXRoIGBfbWV0aG9kYAogICAgLy8gQW5kIGFuIGBYLUhUVFAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCiAgICBpZiAoQmFja2JvbmUuZW11bGF0ZUhUVFApIHsKICAgICAgaWYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnKSB7CiAgICAgICAgaWYgKEJhY2tib25lLmVtdWxhdGVKU09OKSBwYXJhbXMuZGF0YS5fbWV0aG9kID0gdHlwZTsKICAgICAgICBwYXJhbXMudHlwZSA9ICdQT1NUJzsKICAgICAgICBwYXJhbXMuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtSFRUUC1NZXRob2QtT3ZlcnJpZGUnLCB0eXBlKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CgogICAgLy8gRG9uJ3QgcHJvY2VzcyBkYXRhIG9uIGEgbm9uLUdFVCByZXF1ZXN0LgogICAgaWYgKHBhcmFtcy50eXBlICE9PSAnR0VUJyAmJiAhQmFja2JvbmUuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLnByb2Nlc3NEYXRhID0gZmFsc2U7CiAgICB9CgogICAgLy8gTWFrZSB0aGUgcmVxdWVzdCwgYWxsb3dpbmcgdGhlIHVzZXIgdG8gb3ZlcnJpZGUgYW55IEFqYXggb3B0aW9ucy4KICAgIHJldHVybiAkLmFqYXgoXy5leHRlbmQocGFyYW1zLCBvcHRpb25zKSk7CiAgfTsKCiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuCiAgQmFja2JvbmUud3JhcEVycm9yID0gZnVuY3Rpb24ob25FcnJvciwgb3JpZ2luYWxNb2RlbCwgb3B0aW9ucykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG1vZGVsLCByZXNwKSB7CiAgICAgIHJlc3AgPSBtb2RlbCA9PT0gb3JpZ2luYWxNb2RlbCA/IHJlc3AgOiBtb2RlbDsKICAgICAgaWYgKG9uRXJyb3IpIHsKICAgICAgICBvbkVycm9yKG9yaWdpbmFsTW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIG9yaWdpbmFsTW9kZWwudHJpZ2dlcignZXJyb3InLCBvcmlnaW5hbE1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBIZWxwZXJzCiAgLy8gLS0tLS0tLQoKICAvLyBTaGFyZWQgZW1wdHkgY29uc3RydWN0b3IgZnVuY3Rpb24gdG8gYWlkIGluIHByb3RvdHlwZS1jaGFpbiBjcmVhdGlvbi4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiwgZm9yIHN1YmNsYXNzZXMuCiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmQKICAvLyBjbGFzcyBwcm9wZXJ0aWVzIHRvIGJlIGV4dGVuZGVkLgogIHZhciBpbmhlcml0cyA9IGZ1bmN0aW9uKHBhcmVudCwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIHZhciBjaGlsZDsKCiAgICAvLyBUaGUgY29uc3RydWN0b3IgZnVuY3Rpb24gZm9yIHRoZSBuZXcgc3ViY2xhc3MgaXMgZWl0aGVyIGRlZmluZWQgYnkgeW91CiAgICAvLyAodGhlICJjb25zdHJ1Y3RvciIgcHJvcGVydHkgaW4geW91ciBgZXh0ZW5kYCBkZWZpbml0aW9uKSwgb3IgZGVmYXVsdGVkCiAgICAvLyBieSB1cyB0byBzaW1wbHkgY2FsbCB0aGUgcGFyZW50J3MgY29uc3RydWN0b3IuCiAgICBpZiAocHJvdG9Qcm9wcyAmJiBwcm90b1Byb3BzLmhhc093blByb3BlcnR5KCdjb25zdHJ1Y3RvcicpKSB7CiAgICAgIGNoaWxkID0gcHJvdG9Qcm9wcy5jb25zdHJ1Y3RvcjsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkID0gZnVuY3Rpb24oKXsgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07CiAgICB9CgogICAgLy8gSW5oZXJpdCBjbGFzcyAoc3RhdGljKSBwcm9wZXJ0aWVzIGZyb20gcGFyZW50LgogICAgXy5leHRlbmQoY2hpbGQsIHBhcmVudCk7CgogICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKICAgIC8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCiAgICBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOwoKICAgIC8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAogICAgLy8gaWYgc3VwcGxpZWQuCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCiAgICAvLyBBZGQgc3RhdGljIHByb3BlcnRpZXMgdG8gdGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uLCBpZiBzdXBwbGllZC4KICAgIGlmIChzdGF0aWNQcm9wcykgXy5leHRlbmQoY2hpbGQsIHN0YXRpY1Byb3BzKTsKCiAgICAvLyBDb3JyZWN0bHkgc2V0IGNoaWxkJ3MgYHByb3RvdHlwZS5jb25zdHJ1Y3RvcmAuCiAgICBjaGlsZC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBjaGlsZDsKCiAgICAvLyBTZXQgYSBjb252ZW5pZW5jZSBwcm9wZXJ0eSBpbiBjYXNlIHRoZSBwYXJlbnQncyBwcm90b3R5cGUgaXMgbmVlZGVkIGxhdGVyLgogICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKCiAgICByZXR1cm4gY2hpbGQ7CiAgfTsKCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhIHZhbHVlIGZyb20gYSBCYWNrYm9uZSBvYmplY3QgYXMgYSBwcm9wZXJ0eQogIC8vIG9yIGFzIGEgZnVuY3Rpb24uCiAgdmFyIGdldFZhbHVlID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wKSB7CiAgICBpZiAoIShvYmplY3QgJiYgb2JqZWN0W3Byb3BdKSkgcmV0dXJuIG51bGw7CiAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKG9iamVjdFtwcm9wXSkgPyBvYmplY3RbcHJvcF0oKSA6IG9iamVjdFtwcm9wXTsKICB9OwoKICAvLyBUaHJvdyBhbiBlcnJvciB3aGVuIGEgVVJMIGlzIG5lZWRlZCwgYW5kIG5vbmUgaXMgc3VwcGxpZWQuCiAgdmFyIHVybEVycm9yID0gZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgInVybCIgcHJvcGVydHkgb3IgZnVuY3Rpb24gbXVzdCBiZSBzcGVjaWZpZWQnKTsKICB9OwoKfSkuY2FsbCh0aGlzKTsK", "content_type": "application/javascript"}, "test/jasmine/vendor/jasmine.js": {"data": "dmFyIGlzQ29tbW9uSlMgPSB0eXBlb2Ygd2luZG93ID09ICJ1bmRlZmluZWQiOwoKLyoqCiAqIFRvcCBsZXZlbCBuYW1lc3BhY2UgZm9yIEphc21pbmUsIGEgbGlnaHR3ZWlnaHQgSmF2YVNjcmlwdCBCREQvc3BlYy90ZXN0aW5nIGZyYW1ld29yay4KICoKICogQG5hbWVzcGFjZQogKi8KdmFyIGphc21pbmUgPSB7fTsKaWYgKGlzQ29tbW9uSlMpIGV4cG9ydHMuamFzbWluZSA9IGphc21pbmU7Ci8qKgogKiBAcHJpdmF0ZQogKi8KamFzbWluZS51bmltcGxlbWVudGVkTWV0aG9kXyA9IGZ1bmN0aW9uKCkgewogIHRocm93IG5ldyBFcnJvcigidW5pbXBsZW1lbnRlZCBtZXRob2QiKTsKfTsKCi8qKgogKiBVc2UgPGNvZGU+amFzbWluZS51bmRlZmluZWQ8L2NvZGU+IGluc3RlYWQgb2YgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiwgc2luY2UgPGNvZGU+dW5kZWZpbmVkPC9jb2RlPiBpcyBqdXN0CiAqIGEgcGxhaW4gb2xkIHZhcmlhYmxlIGFuZCBtYXkgYmUgcmVkZWZpbmVkIGJ5IHNvbWVib2R5IGVsc2UuCiAqCiAqIEBwcml2YXRlCiAqLwpqYXNtaW5lLnVuZGVmaW5lZCA9IGphc21pbmUuX19fdW5kZWZpbmVkX19fOwoKLyoqCiAqIFNob3cgZGlhZ25vc3RpYyBtZXNzYWdlcyBpbiB0aGUgY29uc29sZSBpZiBzZXQgdG8gdHJ1ZQogKgogKi8KamFzbWluZS5WRVJCT1NFID0gZmFsc2U7CgovKioKICogRGVmYXVsdCBpbnRlcnZhbCBpbiBtaWxsaXNlY29uZHMgZm9yIGV2ZW50IGxvb3AgeWllbGRzIChlLmcuIHRvIGFsbG93IG5ldHdvcmsgYWN0aXZpdHkgb3IgdG8gcmVmcmVzaCB0aGUgc2NyZWVuIHdpdGggdGhlIEhUTUwtYmFzZWQgcnVubmVyKS4gU21hbGwgdmFsdWVzIGhlcmUgbWF5IHJlc3VsdCBpbiBzbG93IHRlc3QgcnVubmluZy4gWmVybyBtZWFucyBubyB1cGRhdGVzIHVudGlsIGFsbCB0ZXN0cyBoYXZlIGNvbXBsZXRlZC4KICoKICovCmphc21pbmUuREVGQVVMVF9VUERBVEVfSU5URVJWQUwgPSAyNTA7CgovKioKICogRGVmYXVsdCB0aW1lb3V0IGludGVydmFsIGluIG1pbGxpc2Vjb25kcyBmb3Igd2FpdHNGb3IoKSBibG9ja3MuCiAqLwpqYXNtaW5lLkRFRkFVTFRfVElNRU9VVF9JTlRFUlZBTCA9IDUwMDA7CgpqYXNtaW5lLmdldEdsb2JhbCA9IGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIGdldEdsb2JhbCgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgcmV0dXJuIGdldEdsb2JhbCgpOwp9OwoKLyoqCiAqIEFsbG93cyBmb3IgYm91bmQgZnVuY3Rpb25zIHRvIGJlIGNvbXBhcmVkLiAgSW50ZXJuYWwgdXNlIG9ubHkuCiAqCiAqIEBpZ25vcmUKICogQHByaXZhdGUKICogQHBhcmFtIGJhc2Uge09iamVjdH0gYm91bmQgJ3RoaXMnIGZvciB0aGUgZnVuY3Rpb24KICogQHBhcmFtIG5hbWUge0Z1bmN0aW9ufSBmdW5jdGlvbiB0byBmaW5kCiAqLwpqYXNtaW5lLmJpbmRPcmlnaW5hbF8gPSBmdW5jdGlvbihiYXNlLCBuYW1lKSB7CiAgdmFyIG9yaWdpbmFsID0gYmFzZVtuYW1lXTsKICBpZiAob3JpZ2luYWwuYXBwbHkpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KGJhc2UsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBJRSBzdXBwb3J0CiAgICByZXR1cm4gamFzbWluZS5nZXRHbG9iYWwoKVtuYW1lXTsKICB9Cn07CgpqYXNtaW5lLnNldFRpbWVvdXQgPSBqYXNtaW5lLmJpbmRPcmlnaW5hbF8oamFzbWluZS5nZXRHbG9iYWwoKSwgJ3NldFRpbWVvdXQnKTsKamFzbWluZS5jbGVhclRpbWVvdXQgPSBqYXNtaW5lLmJpbmRPcmlnaW5hbF8oamFzbWluZS5nZXRHbG9iYWwoKSwgJ2NsZWFyVGltZW91dCcpOwpqYXNtaW5lLnNldEludGVydmFsID0gamFzbWluZS5iaW5kT3JpZ2luYWxfKGphc21pbmUuZ2V0R2xvYmFsKCksICdzZXRJbnRlcnZhbCcpOwpqYXNtaW5lLmNsZWFySW50ZXJ2YWwgPSBqYXNtaW5lLmJpbmRPcmlnaW5hbF8oamFzbWluZS5nZXRHbG9iYWwoKSwgJ2NsZWFySW50ZXJ2YWwnKTsKCmphc21pbmUuTWVzc2FnZVJlc3VsdCA9IGZ1bmN0aW9uKHZhbHVlcykgewogIHRoaXMudHlwZSA9ICdsb2cnOwogIHRoaXMudmFsdWVzID0gdmFsdWVzOwogIHRoaXMudHJhY2UgPSBuZXcgRXJyb3IoKTsgLy8gdG9kbzogdGVzdCBiZXR0ZXIKfTsKCmphc21pbmUuTWVzc2FnZVJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICB2YXIgdGV4dCA9ICIiOwogIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgIGlmIChpID4gMCkgdGV4dCArPSAiICI7CiAgICBpZiAoamFzbWluZS5pc1N0cmluZ18odGhpcy52YWx1ZXNbaV0pKSB7CiAgICAgIHRleHQgKz0gdGhpcy52YWx1ZXNbaV07CiAgICB9IGVsc2UgewogICAgICB0ZXh0ICs9IGphc21pbmUucHAodGhpcy52YWx1ZXNbaV0pOwogICAgfQogIH0KICByZXR1cm4gdGV4dDsKfTsKCmphc21pbmUuRXhwZWN0YXRpb25SZXN1bHQgPSBmdW5jdGlvbihwYXJhbXMpIHsKICB0aGlzLnR5cGUgPSAnZXhwZWN0JzsKICB0aGlzLm1hdGNoZXJOYW1lID0gcGFyYW1zLm1hdGNoZXJOYW1lOwogIHRoaXMucGFzc2VkXyA9IHBhcmFtcy5wYXNzZWQ7CiAgdGhpcy5leHBlY3RlZCA9IHBhcmFtcy5leHBlY3RlZDsKICB0aGlzLmFjdHVhbCA9IHBhcmFtcy5hY3R1YWw7CiAgdGhpcy5tZXNzYWdlID0gdGhpcy5wYXNzZWRfID8gJ1Bhc3NlZC4nIDogcGFyYW1zLm1lc3NhZ2U7CgogIHZhciB0cmFjZSA9IChwYXJhbXMudHJhY2UgfHwgbmV3IEVycm9yKHRoaXMubWVzc2FnZSkpOwogIHRoaXMudHJhY2UgPSB0aGlzLnBhc3NlZF8gPyAnJyA6IHRyYWNlOwp9OwoKamFzbWluZS5FeHBlY3RhdGlvblJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMubWVzc2FnZTsKfTsKCmphc21pbmUuRXhwZWN0YXRpb25SZXN1bHQucHJvdG90eXBlLnBhc3NlZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5wYXNzZWRfOwp9OwoKLyoqCiAqIEdldHRlciBmb3IgdGhlIEphc21pbmUgZW52aXJvbm1lbnQuIEVuc3VyZXMgb25lIGdldHMgY3JlYXRlZAogKi8KamFzbWluZS5nZXRFbnYgPSBmdW5jdGlvbigpIHsKICB2YXIgZW52ID0gamFzbWluZS5jdXJyZW50RW52XyA9IGphc21pbmUuY3VycmVudEVudl8gfHwgbmV3IGphc21pbmUuRW52KCk7CiAgcmV0dXJuIGVudjsKfTsKCi8qKgogKiBAaWdub3JlCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB2YWx1ZQogKiBAcmV0dXJucyB7Qm9vbGVhbn0KICovCmphc21pbmUuaXNBcnJheV8gPSBmdW5jdGlvbih2YWx1ZSkgewogIHJldHVybiBqYXNtaW5lLmlzQV8oIkFycmF5IiwgdmFsdWUpOwp9OwoKLyoqCiAqIEBpZ25vcmUKICogQHByaXZhdGUKICogQHBhcmFtIHZhbHVlCiAqIEByZXR1cm5zIHtCb29sZWFufQogKi8KamFzbWluZS5pc1N0cmluZ18gPSBmdW5jdGlvbih2YWx1ZSkgewogIHJldHVybiBqYXNtaW5lLmlzQV8oIlN0cmluZyIsIHZhbHVlKTsKfTsKCi8qKgogKiBAaWdub3JlCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB2YWx1ZQogKiBAcmV0dXJucyB7Qm9vbGVhbn0KICovCmphc21pbmUuaXNOdW1iZXJfID0gZnVuY3Rpb24odmFsdWUpIHsKICByZXR1cm4gamFzbWluZS5pc0FfKCJOdW1iZXIiLCB2YWx1ZSk7Cn07CgovKioKICogQGlnbm9yZQogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge1N0cmluZ30gdHlwZU5hbWUKICogQHBhcmFtIHZhbHVlCiAqIEByZXR1cm5zIHtCb29sZWFufQogKi8KamFzbWluZS5pc0FfID0gZnVuY3Rpb24odHlwZU5hbWUsIHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkodmFsdWUpID09PSAnW29iamVjdCAnICsgdHlwZU5hbWUgKyAnXSc7Cn07CgovKioKICogUHJldHR5IHByaW50ZXIgZm9yIGV4cGVjYXRpb25zLiAgVGFrZXMgYW55IG9iamVjdCBhbmQgdHVybnMgaXQgaW50byBhIGh1bWFuLXJlYWRhYmxlIHN0cmluZy4KICoKICogQHBhcmFtIHZhbHVlIHtPYmplY3R9IGFuIG9iamVjdCB0byBiZSBvdXRwdXR0ZWQKICogQHJldHVybnMge1N0cmluZ30KICovCmphc21pbmUucHAgPSBmdW5jdGlvbih2YWx1ZSkgewogIHZhciBzdHJpbmdQcmV0dHlQcmludGVyID0gbmV3IGphc21pbmUuU3RyaW5nUHJldHR5UHJpbnRlcigpOwogIHN0cmluZ1ByZXR0eVByaW50ZXIuZm9ybWF0KHZhbHVlKTsKICByZXR1cm4gc3RyaW5nUHJldHR5UHJpbnRlci5zdHJpbmc7Cn07CgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSBvYmplY3QgaXMgYSBET00gTm9kZS4KICoKICogQHBhcmFtIHtPYmplY3R9IG9iaiBvYmplY3QgdG8gY2hlY2sKICogQHJldHVybnMge0Jvb2xlYW59CiAqLwpqYXNtaW5lLmlzRG9tTm9kZSA9IGZ1bmN0aW9uKG9iaikgewogIHJldHVybiBvYmoubm9kZVR5cGUgPiAwOwp9OwoKLyoqCiAqIFJldHVybnMgYSBtYXRjaGFibGUgJ2dlbmVyaWMnIG9iamVjdCBvZiB0aGUgY2xhc3MgdHlwZS4gIEZvciB1c2UgaW4gZXhwZWNhdGlvbnMgb2YgdHlwZSB3aGVuIHZhbHVlcyBkb24ndCBtYXR0ZXIuCiAqCiAqIEBleGFtcGxlCiAqIC8vIGRvbid0IGNhcmUgYWJvdXQgd2hpY2ggZnVuY3Rpb24gaXMgcGFzc2VkIGluLCBhcyBsb25nIGFzIGl0J3MgYSBmdW5jdGlvbgogKiBleHBlY3QobXlTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGphc21pbmUuYW55KEZ1bmN0aW9uKSk7CiAqCiAqIEBwYXJhbSB7Q2xhc3N9IGNsYXp6CiAqIEByZXR1cm5zIG1hdGNoYWJsZSBvYmplY3Qgb2YgdGhlIHR5cGUgY2xhenoKICovCmphc21pbmUuYW55ID0gZnVuY3Rpb24oY2xhenopIHsKICByZXR1cm4gbmV3IGphc21pbmUuTWF0Y2hlcnMuQW55KGNsYXp6KTsKfTsKCi8qKgogKiBKYXNtaW5lIFNwaWVzIGFyZSB0ZXN0IGRvdWJsZXMgdGhhdCBjYW4gYWN0IGFzIHN0dWJzLCBzcGllcywgZmFrZXMgb3Igd2hlbiB1c2VkIGluIGFuIGV4cGVjYXRpb24sIG1vY2tzLgogKgogKiBTcGllcyBzaG91bGQgYmUgY3JlYXRlZCBpbiB0ZXN0IHNldHVwLCBiZWZvcmUgZXhwZWN0YXRpb25zLiAgVGhleSBjYW4gdGhlbiBiZSBjaGVja2VkLCB1c2luZyB0aGUgc3RhbmRhcmQgSmFzbWluZQogKiBleHBlY3RhdGlvbiBzeW50YXguIFNwaWVzIGNhbiBiZSBjaGVja2VkIGlmIHRoZXkgd2VyZSBjYWxsZWQgb3Igbm90IGFuZCB3aGF0IHRoZSBjYWxsaW5nIHBhcmFtcyB3ZXJlLgogKgogKiBBIFNweSBoYXMgdGhlIGZvbGxvd2luZyBmaWVsZHM6IHdhc0NhbGxlZCwgY2FsbENvdW50LCBtb3N0UmVjZW50Q2FsbCwgYW5kIGFyZ3NGb3JDYWxsIChzZWUgZG9jcykuCiAqCiAqIFNwaWVzIGFyZSB0b3JuIGRvd24gYXQgdGhlIGVuZCBvZiBldmVyeSBzcGVjLgogKgogKiBOb3RlOiBEbyA8Yj5ub3Q8L2I+IGNhbGwgbmV3IGphc21pbmUuU3B5KCkgZGlyZWN0bHkgLSBhIHNweSBtdXN0IGJlIGNyZWF0ZWQgdXNpbmcgc3B5T24sIGphc21pbmUuY3JlYXRlU3B5IG9yIGphc21pbmUuY3JlYXRlU3B5T2JqLgogKgogKiBAZXhhbXBsZQogKiAvLyBhIHN0dWIKICogdmFyIG15U3R1YiA9IGphc21pbmUuY3JlYXRlU3B5KCdteVN0dWInKTsgIC8vIGNhbiBiZSB1c2VkIGFueXdoZXJlCiAqCiAqIC8vIHNweSBleGFtcGxlCiAqIHZhciBmb28gPSB7CiAqICAgbm90OiBmdW5jdGlvbihib29sKSB7IHJldHVybiAhYm9vbDsgfQogKiB9CiAqCiAqIC8vIGFjdHVhbCBmb28ubm90IHdpbGwgbm90IGJlIGNhbGxlZCwgZXhlY3V0aW9uIHN0b3BzCiAqIHNweU9uKGZvbywgJ25vdCcpOwoKIC8vIGZvby5ub3Qgc3BpZWQgdXBvbiwgZXhlY3V0aW9uIHdpbGwgY29udGludWUgdG8gaW1wbGVtZW50YXRpb24KICogc3B5T24oZm9vLCAnbm90JykuYW5kQ2FsbFRocm91Z2goKTsKICoKICogLy8gZmFrZSBleGFtcGxlCiAqIHZhciBmb28gPSB7CiAqICAgbm90OiBmdW5jdGlvbihib29sKSB7IHJldHVybiAhYm9vbDsgfQogKiB9CiAqCiAqIC8vIGZvby5ub3QodmFsKSB3aWxsIHJldHVybiB2YWwKICogc3B5T24oZm9vLCAnbm90JykuYW5kQ2FsbEZha2UoZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gdmFsdWU7fSk7CiAqCiAqIC8vIG1vY2sgZXhhbXBsZQogKiBmb28ubm90KDcgPT0gNyk7CiAqIGV4cGVjdChmb28ubm90KS50b0hhdmVCZWVuQ2FsbGVkKCk7CiAqIGV4cGVjdChmb28ubm90KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0cnVlKTsKICoKICogQGNvbnN0cnVjdG9yCiAqIEBzZWUgc3B5T24sIGphc21pbmUuY3JlYXRlU3B5LCBqYXNtaW5lLmNyZWF0ZVNweU9iagogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKi8KamFzbWluZS5TcHkgPSBmdW5jdGlvbihuYW1lKSB7CiAgLyoqCiAgICogVGhlIG5hbWUgb2YgdGhlIHNweSwgaWYgcHJvdmlkZWQuCiAgICovCiAgdGhpcy5pZGVudGl0eSA9IG5hbWUgfHwgJ3Vua25vd24nOwogIC8qKgogICAqICBJcyB0aGlzIE9iamVjdCBhIHNweT8KICAgKi8KICB0aGlzLmlzU3B5ID0gdHJ1ZTsKICAvKioKICAgKiBUaGUgYWN0dWFsIGZ1bmN0aW9uIHRoaXMgc3B5IHN0dWJzLgogICAqLwogIHRoaXMucGxhbiA9IGZ1bmN0aW9uKCkgewogIH07CiAgLyoqCiAgICogVHJhY2tpbmcgb2YgdGhlIG1vc3QgcmVjZW50IGNhbGwgdG8gdGhlIHNweS4KICAgKiBAZXhhbXBsZQogICAqIHZhciBteVNweSA9IGphc21pbmUuY3JlYXRlU3B5KCdmb28nKTsKICAgKiBteVNweSgxLCAyKTsKICAgKiBteVNweS5tb3N0UmVjZW50Q2FsbC5hcmdzID0gWzEsIDJdOwogICAqLwogIHRoaXMubW9zdFJlY2VudENhbGwgPSB7fTsKCiAgLyoqCiAgICogSG9sZHMgYXJndW1lbnRzIGZvciBlYWNoIGNhbGwgdG8gdGhlIHNweSwgaW5kZXhlZCBieSBjYWxsIGNvdW50CiAgICogQGV4YW1wbGUKICAgKiB2YXIgbXlTcHkgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZm9vJyk7CiAgICogbXlTcHkoMSwgMik7CiAgICogbXlTcHkoNywgOCk7CiAgICogbXlTcHkubW9zdFJlY2VudENhbGwuYXJncyA9IFs3LCA4XTsKICAgKiBteVNweS5hcmdzRm9yQ2FsbFswXSA9IFsxLCAyXTsKICAgKiBteVNweS5hcmdzRm9yQ2FsbFsxXSA9IFs3LCA4XTsKICAgKi8KICB0aGlzLmFyZ3NGb3JDYWxsID0gW107CiAgdGhpcy5jYWxscyA9IFtdOwp9OwoKLyoqCiAqIFRlbGxzIGEgc3B5IHRvIGNhbGwgdGhyb3VnaCB0byB0aGUgYWN0dWFsIGltcGxlbWVuYXRhdGlvbi4KICoKICogQGV4YW1wbGUKICogdmFyIGZvbyA9IHsKICogICBiYXI6IGZ1bmN0aW9uKCkgeyAvLyBkbyBzb21lIHN0dWZmIH0KICogfQogKgogKiAvLyBkZWZpbmluZyBhIHNweSBvbiBhbiBleGlzdGluZyBwcm9wZXJ0eTogZm9vLmJhcgogKiBzcHlPbihmb28sICdiYXInKS5hbmRDYWxsVGhyb3VnaCgpOwogKi8KamFzbWluZS5TcHkucHJvdG90eXBlLmFuZENhbGxUaHJvdWdoID0gZnVuY3Rpb24oKSB7CiAgdGhpcy5wbGFuID0gdGhpcy5vcmlnaW5hbFZhbHVlOwogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIEZvciBzZXR0aW5nIHRoZSByZXR1cm4gdmFsdWUgb2YgYSBzcHkuCiAqCiAqIEBleGFtcGxlCiAqIC8vIGRlZmluaW5nIGEgc3B5IGZyb20gc2NyYXRjaDogZm9vKCkgcmV0dXJucyAnYmF6JwogKiB2YXIgZm9vID0gamFzbWluZS5jcmVhdGVTcHkoJ3NweSBvbiBmb28nKS5hbmRSZXR1cm4oJ2JheicpOwogKgogKiAvLyBkZWZpbmluZyBhIHNweSBvbiBhbiBleGlzdGluZyBwcm9wZXJ0eTogZm9vLmJhcigpIHJldHVybnMgJ2JheicKICogc3B5T24oZm9vLCAnYmFyJykuYW5kUmV0dXJuKCdiYXonKTsKICoKICogQHBhcmFtIHtPYmplY3R9IHZhbHVlCiAqLwpqYXNtaW5lLlNweS5wcm90b3R5cGUuYW5kUmV0dXJuID0gZnVuY3Rpb24odmFsdWUpIHsKICB0aGlzLnBsYW4gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIEZvciB0aHJvd2luZyBhbiBleGNlcHRpb24gd2hlbiBhIHNweSBpcyBjYWxsZWQuCiAqCiAqIEBleGFtcGxlCiAqIC8vIGRlZmluaW5nIGEgc3B5IGZyb20gc2NyYXRjaDogZm9vKCkgdGhyb3dzIGFuIGV4Y2VwdGlvbiB3LyBtZXNzYWdlICdvdWNoJwogKiB2YXIgZm9vID0gamFzbWluZS5jcmVhdGVTcHkoJ3NweSBvbiBmb28nKS5hbmRUaHJvdygnYmF6Jyk7CiAqCiAqIC8vIGRlZmluaW5nIGEgc3B5IG9uIGFuIGV4aXN0aW5nIHByb3BlcnR5OiBmb28uYmFyKCkgdGhyb3dzIGFuIGV4Y2VwdGlvbiB3LyBtZXNzYWdlICdvdWNoJwogKiBzcHlPbihmb28sICdiYXInKS5hbmRUaHJvdygnYmF6Jyk7CiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBleGNlcHRpb25Nc2cKICovCmphc21pbmUuU3B5LnByb3RvdHlwZS5hbmRUaHJvdyA9IGZ1bmN0aW9uKGV4Y2VwdGlvbk1zZykgewogIHRoaXMucGxhbiA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgZXhjZXB0aW9uTXNnOwogIH07CiAgcmV0dXJuIHRoaXM7Cn07CgovKioKICogQ2FsbHMgYW4gYWx0ZXJuYXRlIGltcGxlbWVudGF0aW9uIHdoZW4gYSBzcHkgaXMgY2FsbGVkLgogKgogKiBAZXhhbXBsZQogKiB2YXIgYmF6ID0gZnVuY3Rpb24oKSB7CiAqICAgLy8gZG8gc29tZSBzdHVmZiwgcmV0dXJuIHNvbWV0aGluZwogKiB9CiAqIC8vIGRlZmluaW5nIGEgc3B5IGZyb20gc2NyYXRjaDogZm9vKCkgY2FsbHMgdGhlIGZ1bmN0aW9uIGJhegogKiB2YXIgZm9vID0gamFzbWluZS5jcmVhdGVTcHkoJ3NweSBvbiBmb28nKS5hbmRDYWxsKGJheik7CiAqCiAqIC8vIGRlZmluaW5nIGEgc3B5IG9uIGFuIGV4aXN0aW5nIHByb3BlcnR5OiBmb28uYmFyKCkgY2FsbHMgYW4gYW5vbnltbm91cyBmdW5jdGlvbgogKiBzcHlPbihmb28sICdiYXInKS5hbmRDYWxsKGZ1bmN0aW9uKCkgeyByZXR1cm4gJ2Jheic7fSApOwogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmYWtlRnVuYwogKi8KamFzbWluZS5TcHkucHJvdG90eXBlLmFuZENhbGxGYWtlID0gZnVuY3Rpb24oZmFrZUZ1bmMpIHsKICB0aGlzLnBsYW4gPSBmYWtlRnVuYzsKICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBSZXNldHMgYWxsIG9mIGEgc3B5J3MgdGhlIHRyYWNraW5nIHZhcmlhYmxlcyBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGFnYWluLgogKgogKiBAZXhhbXBsZQogKiBzcHlPbihmb28sICdiYXInKTsKICoKICogZm9vLmJhcigpOwogKgogKiBleHBlY3QoZm9vLmJhci5jYWxsQ291bnQpLnRvRXF1YWwoMSk7CiAqCiAqIGZvby5iYXIucmVzZXQoKTsKICoKICogZXhwZWN0KGZvby5iYXIuY2FsbENvdW50KS50b0VxdWFsKDApOwogKi8KamFzbWluZS5TcHkucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7CiAgdGhpcy53YXNDYWxsZWQgPSBmYWxzZTsKICB0aGlzLmNhbGxDb3VudCA9IDA7CiAgdGhpcy5hcmdzRm9yQ2FsbCA9IFtdOwogIHRoaXMuY2FsbHMgPSBbXTsKICB0aGlzLm1vc3RSZWNlbnRDYWxsID0ge307Cn07CgpqYXNtaW5lLmNyZWF0ZVNweSA9IGZ1bmN0aW9uKG5hbWUpIHsKCiAgdmFyIHNweU9iaiA9IGZ1bmN0aW9uKCkgewogICAgc3B5T2JqLndhc0NhbGxlZCA9IHRydWU7CiAgICBzcHlPYmouY2FsbENvdW50Kys7CiAgICB2YXIgYXJncyA9IGphc21pbmUudXRpbC5hcmdzVG9BcnJheShhcmd1bWVudHMpOwogICAgc3B5T2JqLm1vc3RSZWNlbnRDYWxsLm9iamVjdCA9IHRoaXM7CiAgICBzcHlPYmoubW9zdFJlY2VudENhbGwuYXJncyA9IGFyZ3M7CiAgICBzcHlPYmouYXJnc0ZvckNhbGwucHVzaChhcmdzKTsKICAgIHNweU9iai5jYWxscy5wdXNoKHtvYmplY3Q6IHRoaXMsIGFyZ3M6IGFyZ3N9KTsKICAgIHJldHVybiBzcHlPYmoucGxhbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIHZhciBzcHkgPSBuZXcgamFzbWluZS5TcHkobmFtZSk7CgogIGZvciAodmFyIHByb3AgaW4gc3B5KSB7CiAgICBzcHlPYmpbcHJvcF0gPSBzcHlbcHJvcF07CiAgfQoKICBzcHlPYmoucmVzZXQoKTsKCiAgcmV0dXJuIHNweU9iajsKfTsKCi8qKgogKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gb2JqZWN0IGlzIGEgc3B5LgogKgogKiBAcGFyYW0ge2phc21pbmUuU3B5fE9iamVjdH0gcHV0YXRpdmVTcHkKICogQHJldHVybnMge0Jvb2xlYW59CiAqLwpqYXNtaW5lLmlzU3B5ID0gZnVuY3Rpb24ocHV0YXRpdmVTcHkpIHsKICByZXR1cm4gcHV0YXRpdmVTcHkgJiYgcHV0YXRpdmVTcHkuaXNTcHk7Cn07CgovKioKICogQ3JlYXRlcyBhIG1vcmUgY29tcGxpY2F0ZWQgc3B5OiBhbiBPYmplY3QgdGhhdCBoYXMgZXZlcnkgcHJvcGVydHkgYSBmdW5jdGlvbiB0aGF0IGlzIGEgc3B5LiAgVXNlZCBmb3Igc3R1YmJpbmcgc29tZXRoaW5nCiAqIGxhcmdlIGluIG9uZSBjYWxsLgogKgogKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgbmFtZSBvZiBzcHkgY2xhc3MKICogQHBhcmFtIHtBcnJheX0gbWV0aG9kTmFtZXMgYXJyYXkgb2YgbmFtZXMgb2YgbWV0aG9kcyB0byBtYWtlIHNwaWVzCiAqLwpqYXNtaW5lLmNyZWF0ZVNweU9iaiA9IGZ1bmN0aW9uKGJhc2VOYW1lLCBtZXRob2ROYW1lcykgewogIGlmICghamFzbWluZS5pc0FycmF5XyhtZXRob2ROYW1lcykgfHwgbWV0aG9kTmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyZWF0ZVNweU9iaiByZXF1aXJlcyBhIG5vbi1lbXB0eSBhcnJheSBvZiBtZXRob2QgbmFtZXMgdG8gY3JlYXRlIHNwaWVzIGZvcicpOwogIH0KICB2YXIgb2JqID0ge307CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXRob2ROYW1lcy5sZW5ndGg7IGkrKykgewogICAgb2JqW21ldGhvZE5hbWVzW2ldXSA9IGphc21pbmUuY3JlYXRlU3B5KGJhc2VOYW1lICsgJy4nICsgbWV0aG9kTmFtZXNbaV0pOwogIH0KICByZXR1cm4gb2JqOwp9OwoKLyoqCiAqIEFsbCBwYXJhbWV0ZXJzIGFyZSBwcmV0dHktcHJpbnRlZCBhbmQgY29uY2F0ZW5hdGVkIHRvZ2V0aGVyLCB0aGVuIHdyaXR0ZW4gdG8gdGhlIGN1cnJlbnQgc3BlYydzIG91dHB1dC4KICoKICogQmUgY2FyZWZ1bCBub3QgdG8gbGVhdmUgY2FsbHMgdG8gPGNvZGU+amFzbWluZS5sb2c8L2NvZGU+IGluIHByb2R1Y3Rpb24gY29kZS4KICovCmphc21pbmUubG9nID0gZnVuY3Rpb24oKSB7CiAgdmFyIHNwZWMgPSBqYXNtaW5lLmdldEVudigpLmN1cnJlbnRTcGVjOwogIHNwZWMubG9nLmFwcGx5KHNwZWMsIGFyZ3VtZW50cyk7Cn07CgovKioKICogRnVuY3Rpb24gdGhhdCBpbnN0YWxscyBhIHNweSBvbiBhbiBleGlzdGluZyBvYmplY3QncyBtZXRob2QgbmFtZS4gIFVzZWQgd2l0aGluIGEgU3BlYyB0byBjcmVhdGUgYSBzcHkuCiAqCiAqIEBleGFtcGxlCiAqIC8vIHNweSBleGFtcGxlCiAqIHZhciBmb28gPSB7CiAqICAgbm90OiBmdW5jdGlvbihib29sKSB7IHJldHVybiAhYm9vbDsgfQogKiB9CiAqIHNweU9uKGZvbywgJ25vdCcpOyAvLyBhY3R1YWwgZm9vLm5vdCB3aWxsIG5vdCBiZSBjYWxsZWQsIGV4ZWN1dGlvbiBzdG9wcwogKgogKiBAc2VlIGphc21pbmUuY3JlYXRlU3B5CiAqIEBwYXJhbSBvYmoKICogQHBhcmFtIG1ldGhvZE5hbWUKICogQHJldHVybnMgYSBKYXNtaW5lIHNweSB0aGF0IGNhbiBiZSBjaGFpbmVkIHdpdGggYWxsIHNweSBtZXRob2RzCiAqLwp2YXIgc3B5T24gPSBmdW5jdGlvbihvYmosIG1ldGhvZE5hbWUpIHsKICByZXR1cm4gamFzbWluZS5nZXRFbnYoKS5jdXJyZW50U3BlYy5zcHlPbihvYmosIG1ldGhvZE5hbWUpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy5zcHlPbiA9IHNweU9uOwoKLyoqCiAqIENyZWF0ZXMgYSBKYXNtaW5lIHNwZWMgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBjdXJyZW50IHN1aXRlLgogKgogKiAvLyBUT0RPOiBwZW5kaW5nIHRlc3RzCiAqCiAqIEBleGFtcGxlCiAqIGl0KCdzaG91bGQgYmUgdHJ1ZScsIGZ1bmN0aW9uKCkgewogKiAgIGV4cGVjdCh0cnVlKS50b0VxdWFsKHRydWUpOwogKiB9KTsKICoKICogQHBhcmFtIHtTdHJpbmd9IGRlc2MgZGVzY3JpcHRpb24gb2YgdGhpcyBzcGVjaWZpY2F0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgZGVmaW5lcyB0aGUgcHJlY29uZGl0aW9ucyBhbmQgZXhwZWN0YXRpb25zIG9mIHRoZSBzcGVjCiAqLwp2YXIgaXQgPSBmdW5jdGlvbihkZXNjLCBmdW5jKSB7CiAgcmV0dXJuIGphc21pbmUuZ2V0RW52KCkuaXQoZGVzYywgZnVuYyk7Cn07CmlmIChpc0NvbW1vbkpTKSBleHBvcnRzLml0ID0gaXQ7CgovKioKICogQ3JlYXRlcyBhIDxlbT5kaXNhYmxlZDwvZW0+IEphc21pbmUgc3BlYy4KICoKICogQSBjb252ZW5pZW5jZSBtZXRob2QgdGhhdCBhbGxvd3MgZXhpc3Rpbmcgc3BlY3MgdG8gYmUgZGlzYWJsZWQgdGVtcG9yYXJpbHkgZHVyaW5nIGRldmVsb3BtZW50LgogKgogKiBAcGFyYW0ge1N0cmluZ30gZGVzYyBkZXNjcmlwdGlvbiBvZiB0aGlzIHNwZWNpZmljYXRpb24KICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBkZWZpbmVzIHRoZSBwcmVjb25kaXRpb25zIGFuZCBleHBlY3RhdGlvbnMgb2YgdGhlIHNwZWMKICovCnZhciB4aXQgPSBmdW5jdGlvbihkZXNjLCBmdW5jKSB7CiAgcmV0dXJuIGphc21pbmUuZ2V0RW52KCkueGl0KGRlc2MsIGZ1bmMpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy54aXQgPSB4aXQ7CgovKioKICogU3RhcnRzIGEgY2hhaW4gZm9yIGEgSmFzbWluZSBleHBlY3RhdGlvbi4KICoKICogSXQgaXMgcGFzc2VkIGFuIE9iamVjdCB0aGF0IGlzIHRoZSBhY3R1YWwgdmFsdWUgYW5kIHNob3VsZCBjaGFpbiB0byBvbmUgb2YgdGhlIG1hbnkKICogamFzbWluZS5NYXRjaGVycyBmdW5jdGlvbnMuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBhY3R1YWwgQWN0dWFsIHZhbHVlIHRvIHRlc3QgYWdhaW5zdCBhbmQgZXhwZWN0ZWQgdmFsdWUKICovCnZhciBleHBlY3QgPSBmdW5jdGlvbihhY3R1YWwpIHsKICByZXR1cm4gamFzbWluZS5nZXRFbnYoKS5jdXJyZW50U3BlYy5leHBlY3QoYWN0dWFsKTsKfTsKaWYgKGlzQ29tbW9uSlMpIGV4cG9ydHMuZXhwZWN0ID0gZXhwZWN0OwoKLyoqCiAqIERlZmluZXMgcGFydCBvZiBhIGphc21pbmUgc3BlYy4gIFVzZWQgaW4gY29taW5iaW5hdGlvbiB3aXRoIHdhaXRzIG9yIHdhaXRzRm9yIGluIGFzeW5jaHJub3VzIHNwZWNzLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIEZ1bmN0aW9uIHRoYXQgZGVmaW5lcyBwYXJ0IG9mIGEgamFzbWluZSBzcGVjLgogKi8KdmFyIHJ1bnMgPSBmdW5jdGlvbihmdW5jKSB7CiAgamFzbWluZS5nZXRFbnYoKS5jdXJyZW50U3BlYy5ydW5zKGZ1bmMpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy5ydW5zID0gcnVuczsKCi8qKgogKiBXYWl0cyBhIGZpeGVkIHRpbWUgcGVyaW9kIGJlZm9yZSBtb3ZpbmcgdG8gdGhlIG5leHQgYmxvY2suCiAqCiAqIEBkZXByZWNhdGVkIFVzZSB3YWl0c0ZvcigpIGluc3RlYWQKICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgbWlsbGlzZWNvbmRzIHRvIHdhaXQKICovCnZhciB3YWl0cyA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsKICBqYXNtaW5lLmdldEVudigpLmN1cnJlbnRTcGVjLndhaXRzKHRpbWVvdXQpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy53YWl0cyA9IHdhaXRzOwoKLyoqCiAqIFdhaXRzIGZvciB0aGUgbGF0Y2hGdW5jdGlvbiB0byByZXR1cm4gdHJ1ZSBiZWZvcmUgcHJvY2VlZGluZyB0byB0aGUgbmV4dCBibG9jay4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gbGF0Y2hGdW5jdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gb3B0aW9uYWxfdGltZW91dE1lc3NhZ2UKICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbmFsX3RpbWVvdXQKICovCnZhciB3YWl0c0ZvciA9IGZ1bmN0aW9uKGxhdGNoRnVuY3Rpb24sIG9wdGlvbmFsX3RpbWVvdXRNZXNzYWdlLCBvcHRpb25hbF90aW1lb3V0KSB7CiAgamFzbWluZS5nZXRFbnYoKS5jdXJyZW50U3BlYy53YWl0c0Zvci5hcHBseShqYXNtaW5lLmdldEVudigpLmN1cnJlbnRTcGVjLCBhcmd1bWVudHMpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy53YWl0c0ZvciA9IHdhaXRzRm9yOwoKLyoqCiAqIEEgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgYmVmb3JlIGVhY2ggc3BlYyBpbiBhIHN1aXRlLgogKgogKiBVc2VkIGZvciBzcGVjIHNldHVwLCBpbmNsdWRpbmcgdmFsaWRhdGluZyBhc3N1bXB0aW9ucy4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gYmVmb3JlRWFjaEZ1bmN0aW9uCiAqLwp2YXIgYmVmb3JlRWFjaCA9IGZ1bmN0aW9uKGJlZm9yZUVhY2hGdW5jdGlvbikgewogIGphc21pbmUuZ2V0RW52KCkuYmVmb3JlRWFjaChiZWZvcmVFYWNoRnVuY3Rpb24pOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy5iZWZvcmVFYWNoID0gYmVmb3JlRWFjaDsKCi8qKgogKiBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGFmdGVyIGVhY2ggc3BlYyBpbiBhIHN1aXRlLgogKgogKiBVc2VkIGZvciByZXN0b3JpbmcgYW55IHN0YXRlIHRoYXQgaXMgaGlqYWNrZWQgZHVyaW5nIHNwZWMgZXhlY3V0aW9uLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBhZnRlckVhY2hGdW5jdGlvbgogKi8KdmFyIGFmdGVyRWFjaCA9IGZ1bmN0aW9uKGFmdGVyRWFjaEZ1bmN0aW9uKSB7CiAgamFzbWluZS5nZXRFbnYoKS5hZnRlckVhY2goYWZ0ZXJFYWNoRnVuY3Rpb24pOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy5hZnRlckVhY2ggPSBhZnRlckVhY2g7CgovKioKICogRGVmaW5lcyBhIHN1aXRlIG9mIHNwZWNpZmljYXRpb25zLgogKgogKiBTdG9yZXMgdGhlIGRlc2NyaXB0aW9uIGFuZCBhbGwgZGVmaW5lZCBzcGVjcyBpbiB0aGUgSmFzbWluZSBlbnZpcm9ubWVudCBhcyBvbmUgc3VpdGUgb2Ygc3BlY3MuIFZhcmlhYmxlcyBkZWNsYXJlZAogKiBhcmUgYWNjZXNzaWJsZSBieSBjYWxscyB0byBiZWZvcmVFYWNoLCBpdCwgYW5kIGFmdGVyRWFjaC4gRGVzY3JpYmUgYmxvY2tzIGNhbiBiZSBuZXN0ZWQsIGFsbG93aW5nIGZvciBzcGVjaWFsaXphdGlvbgogKiBvZiBzZXR1cCBpbiBzb21lIHRlc3RzLgogKgogKiBAZXhhbXBsZQogKiAvLyBUT0RPOiBhIHNpbXBsZSBzdWl0ZQogKgogKiAvLyBUT0RPOiBhIHNpbXBsZSBzdWl0ZSB3aXRoIGEgbmVzdGVkIGRlc2NyaWJlIGJsb2NrCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBkZXNjcmlwdGlvbiBBIHN0cmluZywgdXN1YWxseSB0aGUgY2xhc3MgdW5kZXIgdGVzdC4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3BlY0RlZmluaXRpb25zIGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyBzZXZlcmFsIHNwZWNzLgogKi8KdmFyIGRlc2NyaWJlID0gZnVuY3Rpb24oZGVzY3JpcHRpb24sIHNwZWNEZWZpbml0aW9ucykgewogIHJldHVybiBqYXNtaW5lLmdldEVudigpLmRlc2NyaWJlKGRlc2NyaXB0aW9uLCBzcGVjRGVmaW5pdGlvbnMpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy5kZXNjcmliZSA9IGRlc2NyaWJlOwoKLyoqCiAqIERpc2FibGVzIGEgc3VpdGUgb2Ygc3BlY2lmaWNhdGlvbnMuICBVc2VkIHRvIGRpc2FibGUgc29tZSBzdWl0ZXMgaW4gYSBmaWxlLCBvciBmaWxlcywgdGVtcG9yYXJpbHkgZHVyaW5nIGRldmVsb3BtZW50LgogKgogKiBAcGFyYW0ge1N0cmluZ30gZGVzY3JpcHRpb24gQSBzdHJpbmcsIHVzdWFsbHkgdGhlIGNsYXNzIHVuZGVyIHRlc3QuCiAqIEBwYXJhbSB7RnVuY3Rpb259IHNwZWNEZWZpbml0aW9ucyBmdW5jdGlvbiB0aGF0IGRlZmluZXMgc2V2ZXJhbCBzcGVjcy4KICovCnZhciB4ZGVzY3JpYmUgPSBmdW5jdGlvbihkZXNjcmlwdGlvbiwgc3BlY0RlZmluaXRpb25zKSB7CiAgcmV0dXJuIGphc21pbmUuZ2V0RW52KCkueGRlc2NyaWJlKGRlc2NyaXB0aW9uLCBzcGVjRGVmaW5pdGlvbnMpOwp9OwppZiAoaXNDb21tb25KUykgZXhwb3J0cy54ZGVzY3JpYmUgPSB4ZGVzY3JpYmU7CgoKLy8gUHJvdmlkZSB0aGUgWE1MSHR0cFJlcXVlc3QgY2xhc3MgZm9yIElFIDUueC02Lng6Cmphc21pbmUuWG1sSHR0cFJlcXVlc3QgPSAodHlwZW9mIFhNTEh0dHBSZXF1ZXN0ID09ICJ1bmRlZmluZWQiKSA/IGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIHRyeUl0KGYpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBmKCk7CiAgICB9IGNhdGNoKGUpIHsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgdmFyIHhociA9IHRyeUl0KGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNc3htbDIuWE1MSFRUUC42LjAiKTsKICB9KSB8fAogICAgdHJ5SXQoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAuMy4wIik7CiAgICB9KSB8fAogICAgdHJ5SXQoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAiKTsKICAgIH0pIHx8CiAgICB0cnlJdChmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOwogICAgfSk7CgogIGlmICgheGhyKSB0aHJvdyBuZXcgRXJyb3IoIlRoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFhNTEh0dHBSZXF1ZXN0LiIpOwoKICByZXR1cm4geGhyOwp9IDogWE1MSHR0cFJlcXVlc3Q7Ci8qKgogKiBAbmFtZXNwYWNlCiAqLwpqYXNtaW5lLnV0aWwgPSB7fTsKCi8qKgogKiBEZWNsYXJlIHRoYXQgYSBjaGlsZCBjbGFzcyBpbmhlcml0IGl0J3MgcHJvdG90eXBlIGZyb20gdGhlIHBhcmVudCBjbGFzcy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtGdW5jdGlvbn0gY2hpbGRDbGFzcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBwYXJlbnRDbGFzcwogKi8KamFzbWluZS51dGlsLmluaGVyaXQgPSBmdW5jdGlvbihjaGlsZENsYXNzLCBwYXJlbnRDbGFzcykgewogIC8qKgogICAqIEBwcml2YXRlCiAgICovCiAgdmFyIHN1YmNsYXNzID0gZnVuY3Rpb24oKSB7CiAgfTsKICBzdWJjbGFzcy5wcm90b3R5cGUgPSBwYXJlbnRDbGFzcy5wcm90b3R5cGU7CiAgY2hpbGRDbGFzcy5wcm90b3R5cGUgPSBuZXcgc3ViY2xhc3MoKTsKfTsKCmphc21pbmUudXRpbC5mb3JtYXRFeGNlcHRpb24gPSBmdW5jdGlvbihlKSB7CiAgdmFyIGxpbmVOdW1iZXI7CiAgaWYgKGUubGluZSkgewogICAgbGluZU51bWJlciA9IGUubGluZTsKICB9CiAgZWxzZSBpZiAoZS5saW5lTnVtYmVyKSB7CiAgICBsaW5lTnVtYmVyID0gZS5saW5lTnVtYmVyOwogIH0KCiAgdmFyIGZpbGU7CgogIGlmIChlLnNvdXJjZVVSTCkgewogICAgZmlsZSA9IGUuc291cmNlVVJMOwogIH0KICBlbHNlIGlmIChlLmZpbGVOYW1lKSB7CiAgICBmaWxlID0gZS5maWxlTmFtZTsKICB9CgogIHZhciBtZXNzYWdlID0gKGUubmFtZSAmJiBlLm1lc3NhZ2UpID8gKGUubmFtZSArICc6ICcgKyBlLm1lc3NhZ2UpIDogZS50b1N0cmluZygpOwoKICBpZiAoZmlsZSAmJiBsaW5lTnVtYmVyKSB7CiAgICBtZXNzYWdlICs9ICcgaW4gJyArIGZpbGUgKyAnIChsaW5lICcgKyBsaW5lTnVtYmVyICsgJyknOwogIH0KCiAgcmV0dXJuIG1lc3NhZ2U7Cn07CgpqYXNtaW5lLnV0aWwuaHRtbEVzY2FwZSA9IGZ1bmN0aW9uKHN0cikgewogIGlmICghc3RyKSByZXR1cm4gc3RyOwogIHJldHVybiBzdHIucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKTsKfTsKCmphc21pbmUudXRpbC5hcmdzVG9BcnJheSA9IGZ1bmN0aW9uKGFyZ3MpIHsKICB2YXIgYXJyYXlPZkFyZ3MgPSBbXTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIGFycmF5T2ZBcmdzLnB1c2goYXJnc1tpXSk7CiAgcmV0dXJuIGFycmF5T2ZBcmdzOwp9OwoKamFzbWluZS51dGlsLmV4dGVuZCA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHsKICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07CiAgcmV0dXJuIGRlc3RpbmF0aW9uOwp9OwoKLyoqCiAqIEVudmlyb25tZW50IGZvciBKYXNtaW5lCiAqCiAqIEBjb25zdHJ1Y3RvcgogKi8KamFzbWluZS5FbnYgPSBmdW5jdGlvbigpIHsKICB0aGlzLmN1cnJlbnRTcGVjID0gbnVsbDsKICB0aGlzLmN1cnJlbnRTdWl0ZSA9IG51bGw7CiAgdGhpcy5jdXJyZW50UnVubmVyXyA9IG5ldyBqYXNtaW5lLlJ1bm5lcih0aGlzKTsKCiAgdGhpcy5yZXBvcnRlciA9IG5ldyBqYXNtaW5lLk11bHRpUmVwb3J0ZXIoKTsKCiAgdGhpcy51cGRhdGVJbnRlcnZhbCA9IGphc21pbmUuREVGQVVMVF9VUERBVEVfSU5URVJWQUw7CiAgdGhpcy5kZWZhdWx0VGltZW91dEludGVydmFsID0gamFzbWluZS5ERUZBVUxUX1RJTUVPVVRfSU5URVJWQUw7CiAgdGhpcy5sYXN0VXBkYXRlID0gMDsKICB0aGlzLnNwZWNGaWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0cnVlOwogIH07CgogIHRoaXMubmV4dFNwZWNJZF8gPSAwOwogIHRoaXMubmV4dFN1aXRlSWRfID0gMDsKICB0aGlzLmVxdWFsaXR5VGVzdGVyc18gPSBbXTsKCiAgLy8gd3JhcCBtYXRjaGVycwogIHRoaXMubWF0Y2hlcnNDbGFzcyA9IGZ1bmN0aW9uKCkgewogICAgamFzbWluZS5NYXRjaGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CiAgamFzbWluZS51dGlsLmluaGVyaXQodGhpcy5tYXRjaGVyc0NsYXNzLCBqYXNtaW5lLk1hdGNoZXJzKTsKCiAgamFzbWluZS5NYXRjaGVycy53cmFwSW50b18oamFzbWluZS5NYXRjaGVycy5wcm90b3R5cGUsIHRoaXMubWF0Y2hlcnNDbGFzcyk7Cn07CgoKamFzbWluZS5FbnYucHJvdG90eXBlLnNldFRpbWVvdXQgPSBqYXNtaW5lLnNldFRpbWVvdXQ7Cmphc21pbmUuRW52LnByb3RvdHlwZS5jbGVhclRpbWVvdXQgPSBqYXNtaW5lLmNsZWFyVGltZW91dDsKamFzbWluZS5FbnYucHJvdG90eXBlLnNldEludGVydmFsID0gamFzbWluZS5zZXRJbnRlcnZhbDsKamFzbWluZS5FbnYucHJvdG90eXBlLmNsZWFySW50ZXJ2YWwgPSBqYXNtaW5lLmNsZWFySW50ZXJ2YWw7CgovKioKICogQHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgamFzbWluZSB2ZXJzaW9uIGJ1aWxkIGluZm8sIGlmIHNldC4KICovCmphc21pbmUuRW52LnByb3RvdHlwZS52ZXJzaW9uID0gZnVuY3Rpb24gKCkgewogIGlmIChqYXNtaW5lLnZlcnNpb25fKSB7CiAgICByZXR1cm4gamFzbWluZS52ZXJzaW9uXzsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IEVycm9yKCdWZXJzaW9uIG5vdCBzZXQnKTsKICB9Cn07CgovKioKICogQHJldHVybnMgc3RyaW5nIGNvbnRhaW5pbmcgamFzbWluZSB2ZXJzaW9uIGJ1aWxkIGluZm8sIGlmIHNldC4KICovCmphc21pbmUuRW52LnByb3RvdHlwZS52ZXJzaW9uU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgaWYgKCFqYXNtaW5lLnZlcnNpb25fKSB7CiAgICByZXR1cm4gInZlcnNpb24gdW5rbm93biI7CiAgfQoKICB2YXIgdmVyc2lvbiA9IHRoaXMudmVyc2lvbigpOwogIHZhciB2ZXJzaW9uU3RyaW5nID0gdmVyc2lvbi5tYWpvciArICIuIiArIHZlcnNpb24ubWlub3IgKyAiLiIgKyB2ZXJzaW9uLmJ1aWxkOwogIGlmICh2ZXJzaW9uLnJlbGVhc2VfY2FuZGlkYXRlKSB7CiAgICB2ZXJzaW9uU3RyaW5nICs9ICIucmMiICsgdmVyc2lvbi5yZWxlYXNlX2NhbmRpZGF0ZTsKICB9CiAgdmVyc2lvblN0cmluZyArPSAiIHJldmlzaW9uICIgKyB2ZXJzaW9uLnJldmlzaW9uOwogIHJldHVybiB2ZXJzaW9uU3RyaW5nOwp9OwoKLyoqCiAqIEByZXR1cm5zIGEgc2VxdWVudGlhbCBpbnRlZ2VyIHN0YXJ0aW5nIGF0IDAKICovCmphc21pbmUuRW52LnByb3RvdHlwZS5uZXh0U3BlY0lkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLm5leHRTcGVjSWRfKys7Cn07CgovKioKICogQHJldHVybnMgYSBzZXF1ZW50aWFsIGludGVnZXIgc3RhcnRpbmcgYXQgMAogKi8KamFzbWluZS5FbnYucHJvdG90eXBlLm5leHRTdWl0ZUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLm5leHRTdWl0ZUlkXysrOwp9OwoKLyoqCiAqIFJlZ2lzdGVyIGEgcmVwb3J0ZXIgdG8gcmVjZWl2ZSBzdGF0dXMgdXBkYXRlcyBmcm9tIEphc21pbmUuCiAqIEBwYXJhbSB7amFzbWluZS5SZXBvcnRlcn0gcmVwb3J0ZXIgQW4gb2JqZWN0IHdoaWNoIHdpbGwgcmVjZWl2ZSBzdGF0dXMgdXBkYXRlcy4KICovCmphc21pbmUuRW52LnByb3RvdHlwZS5hZGRSZXBvcnRlciA9IGZ1bmN0aW9uKHJlcG9ydGVyKSB7CiAgdGhpcy5yZXBvcnRlci5hZGRSZXBvcnRlcihyZXBvcnRlcik7Cn07CgpqYXNtaW5lLkVudi5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMuY3VycmVudFJ1bm5lcl8uZXhlY3V0ZSgpOwp9OwoKamFzbWluZS5FbnYucHJvdG90eXBlLmRlc2NyaWJlID0gZnVuY3Rpb24oZGVzY3JpcHRpb24sIHNwZWNEZWZpbml0aW9ucykgewogIHZhciBzdWl0ZSA9IG5ldyBqYXNtaW5lLlN1aXRlKHRoaXMsIGRlc2NyaXB0aW9uLCBzcGVjRGVmaW5pdGlvbnMsIHRoaXMuY3VycmVudFN1aXRlKTsKCiAgdmFyIHBhcmVudFN1aXRlID0gdGhpcy5jdXJyZW50U3VpdGU7CiAgaWYgKHBhcmVudFN1aXRlKSB7CiAgICBwYXJlbnRTdWl0ZS5hZGQoc3VpdGUpOwogIH0gZWxzZSB7CiAgICB0aGlzLmN1cnJlbnRSdW5uZXJfLmFkZChzdWl0ZSk7CiAgfQoKICB0aGlzLmN1cnJlbnRTdWl0ZSA9IHN1aXRlOwoKICB2YXIgZGVjbGFyYXRpb25FcnJvciA9IG51bGw7CiAgdHJ5IHsKICAgIHNwZWNEZWZpbml0aW9ucy5jYWxsKHN1aXRlKTsKICB9IGNhdGNoKGUpIHsKICAgIGRlY2xhcmF0aW9uRXJyb3IgPSBlOwogIH0KCiAgaWYgKGRlY2xhcmF0aW9uRXJyb3IpIHsKICAgIHRoaXMuaXQoImVuY291bnRlcmVkIGEgZGVjbGFyYXRpb24gZXhjZXB0aW9uIiwgZnVuY3Rpb24oKSB7CiAgICAgIHRocm93IGRlY2xhcmF0aW9uRXJyb3I7CiAgICB9KTsKICB9CgogIHRoaXMuY3VycmVudFN1aXRlID0gcGFyZW50U3VpdGU7CgogIHJldHVybiBzdWl0ZTsKfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS5iZWZvcmVFYWNoID0gZnVuY3Rpb24oYmVmb3JlRWFjaEZ1bmN0aW9uKSB7CiAgaWYgKHRoaXMuY3VycmVudFN1aXRlKSB7CiAgICB0aGlzLmN1cnJlbnRTdWl0ZS5iZWZvcmVFYWNoKGJlZm9yZUVhY2hGdW5jdGlvbik7CiAgfSBlbHNlIHsKICAgIHRoaXMuY3VycmVudFJ1bm5lcl8uYmVmb3JlRWFjaChiZWZvcmVFYWNoRnVuY3Rpb24pOwogIH0KfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS5jdXJyZW50UnVubmVyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLmN1cnJlbnRSdW5uZXJfOwp9OwoKamFzbWluZS5FbnYucHJvdG90eXBlLmFmdGVyRWFjaCA9IGZ1bmN0aW9uKGFmdGVyRWFjaEZ1bmN0aW9uKSB7CiAgaWYgKHRoaXMuY3VycmVudFN1aXRlKSB7CiAgICB0aGlzLmN1cnJlbnRTdWl0ZS5hZnRlckVhY2goYWZ0ZXJFYWNoRnVuY3Rpb24pOwogIH0gZWxzZSB7CiAgICB0aGlzLmN1cnJlbnRSdW5uZXJfLmFmdGVyRWFjaChhZnRlckVhY2hGdW5jdGlvbik7CiAgfQoKfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS54ZGVzY3JpYmUgPSBmdW5jdGlvbihkZXNjLCBzcGVjRGVmaW5pdGlvbnMpIHsKICByZXR1cm4gewogICAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7CiAgICB9CiAgfTsKfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS5pdCA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uLCBmdW5jKSB7CiAgdmFyIHNwZWMgPSBuZXcgamFzbWluZS5TcGVjKHRoaXMsIHRoaXMuY3VycmVudFN1aXRlLCBkZXNjcmlwdGlvbik7CiAgdGhpcy5jdXJyZW50U3VpdGUuYWRkKHNwZWMpOwogIHRoaXMuY3VycmVudFNwZWMgPSBzcGVjOwoKICBpZiAoZnVuYykgewogICAgc3BlYy5ydW5zKGZ1bmMpOwogIH0KCiAgcmV0dXJuIHNwZWM7Cn07CgpqYXNtaW5lLkVudi5wcm90b3R5cGUueGl0ID0gZnVuY3Rpb24oZGVzYywgZnVuYykgewogIHJldHVybiB7CiAgICBpZDogdGhpcy5uZXh0U3BlY0lkKCksCiAgICBydW5zOiBmdW5jdGlvbigpIHsKICAgIH0KICB9Owp9OwoKamFzbWluZS5FbnYucHJvdG90eXBlLmNvbXBhcmVPYmplY3RzXyA9IGZ1bmN0aW9uKGEsIGIsIG1pc21hdGNoS2V5cywgbWlzbWF0Y2hWYWx1ZXMpIHsKICBpZiAoYS5fX0phc21pbmVfYmVlbl9oZXJlX2JlZm9yZV9fID09PSBiICYmIGIuX19KYXNtaW5lX2JlZW5faGVyZV9iZWZvcmVfXyA9PT0gYSkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBhLl9fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX18gPSBiOwogIGIuX19KYXNtaW5lX2JlZW5faGVyZV9iZWZvcmVfXyA9IGE7CgogIHZhciBoYXNLZXkgPSBmdW5jdGlvbihvYmosIGtleU5hbWUpIHsKICAgIHJldHVybiBvYmogIT09IG51bGwgJiYgb2JqW2tleU5hbWVdICE9PSBqYXNtaW5lLnVuZGVmaW5lZDsKICB9OwoKICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBiKSB7CiAgICBpZiAoIWhhc0tleShhLCBwcm9wZXJ0eSkgJiYgaGFzS2V5KGIsIHByb3BlcnR5KSkgewogICAgICBtaXNtYXRjaEtleXMucHVzaCgiZXhwZWN0ZWQgaGFzIGtleSAnIiArIHByb3BlcnR5ICsgIicsIGJ1dCBtaXNzaW5nIGZyb20gYWN0dWFsLiIpOwogICAgfQogIH0KICBmb3IgKHByb3BlcnR5IGluIGEpIHsKICAgIGlmICghaGFzS2V5KGIsIHByb3BlcnR5KSAmJiBoYXNLZXkoYSwgcHJvcGVydHkpKSB7CiAgICAgIG1pc21hdGNoS2V5cy5wdXNoKCJleHBlY3RlZCBtaXNzaW5nIGtleSAnIiArIHByb3BlcnR5ICsgIicsIGJ1dCBwcmVzZW50IGluIGFjdHVhbC4iKTsKICAgIH0KICB9CiAgZm9yIChwcm9wZXJ0eSBpbiBiKSB7CiAgICBpZiAocHJvcGVydHkgPT0gJ19fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX18nKSBjb250aW51ZTsKICAgIGlmICghdGhpcy5lcXVhbHNfKGFbcHJvcGVydHldLCBiW3Byb3BlcnR5XSwgbWlzbWF0Y2hLZXlzLCBtaXNtYXRjaFZhbHVlcykpIHsKICAgICAgbWlzbWF0Y2hWYWx1ZXMucHVzaCgiJyIgKyBwcm9wZXJ0eSArICInIHdhcyAnIiArIChiW3Byb3BlcnR5XSA/IGphc21pbmUudXRpbC5odG1sRXNjYXBlKGJbcHJvcGVydHldLnRvU3RyaW5nKCkpIDogYltwcm9wZXJ0eV0pICsgIicgaW4gZXhwZWN0ZWQsIGJ1dCB3YXMgJyIgKyAoYVtwcm9wZXJ0eV0gPyBqYXNtaW5lLnV0aWwuaHRtbEVzY2FwZShhW3Byb3BlcnR5XS50b1N0cmluZygpKSA6IGFbcHJvcGVydHldKSArICInIGluIGFjdHVhbC4iKTsKICAgIH0KICB9CgogIGlmIChqYXNtaW5lLmlzQXJyYXlfKGEpICYmIGphc21pbmUuaXNBcnJheV8oYikgJiYgYS5sZW5ndGggIT0gYi5sZW5ndGgpIHsKICAgIG1pc21hdGNoVmFsdWVzLnB1c2goImFycmF5cyB3ZXJlIG5vdCB0aGUgc2FtZSBsZW5ndGgiKTsKICB9CgogIGRlbGV0ZSBhLl9fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX187CiAgZGVsZXRlIGIuX19KYXNtaW5lX2JlZW5faGVyZV9iZWZvcmVfXzsKICByZXR1cm4gKG1pc21hdGNoS2V5cy5sZW5ndGggPT09IDAgJiYgbWlzbWF0Y2hWYWx1ZXMubGVuZ3RoID09PSAwKTsKfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS5lcXVhbHNfID0gZnVuY3Rpb24oYSwgYiwgbWlzbWF0Y2hLZXlzLCBtaXNtYXRjaFZhbHVlcykgewogIG1pc21hdGNoS2V5cyA9IG1pc21hdGNoS2V5cyB8fCBbXTsKICBtaXNtYXRjaFZhbHVlcyA9IG1pc21hdGNoVmFsdWVzIHx8IFtdOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZXF1YWxpdHlUZXN0ZXJzXy5sZW5ndGg7IGkrKykgewogICAgdmFyIGVxdWFsaXR5VGVzdGVyID0gdGhpcy5lcXVhbGl0eVRlc3RlcnNfW2ldOwogICAgdmFyIHJlc3VsdCA9IGVxdWFsaXR5VGVzdGVyKGEsIGIsIHRoaXMsIG1pc21hdGNoS2V5cywgbWlzbWF0Y2hWYWx1ZXMpOwogICAgaWYgKHJlc3VsdCAhPT0gamFzbWluZS51bmRlZmluZWQpIHJldHVybiByZXN1bHQ7CiAgfQoKICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWU7CgogIGlmIChhID09PSBqYXNtaW5lLnVuZGVmaW5lZCB8fCBhID09PSBudWxsIHx8IGIgPT09IGphc21pbmUudW5kZWZpbmVkIHx8IGIgPT09IG51bGwpIHsKICAgIHJldHVybiAoYSA9PSBqYXNtaW5lLnVuZGVmaW5lZCAmJiBiID09IGphc21pbmUudW5kZWZpbmVkKTsKICB9CgogIGlmIChqYXNtaW5lLmlzRG9tTm9kZShhKSAmJiBqYXNtaW5lLmlzRG9tTm9kZShiKSkgewogICAgcmV0dXJuIGEgPT09IGI7CiAgfQoKICBpZiAoYSBpbnN0YW5jZW9mIERhdGUgJiYgYiBpbnN0YW5jZW9mIERhdGUpIHsKICAgIHJldHVybiBhLmdldFRpbWUoKSA9PSBiLmdldFRpbWUoKTsKICB9CgogIGlmIChhIGluc3RhbmNlb2YgamFzbWluZS5NYXRjaGVycy5BbnkpIHsKICAgIHJldHVybiBhLm1hdGNoZXMoYik7CiAgfQoKICBpZiAoYiBpbnN0YW5jZW9mIGphc21pbmUuTWF0Y2hlcnMuQW55KSB7CiAgICByZXR1cm4gYi5tYXRjaGVzKGEpOwogIH0KCiAgaWYgKGphc21pbmUuaXNTdHJpbmdfKGEpICYmIGphc21pbmUuaXNTdHJpbmdfKGIpKSB7CiAgICByZXR1cm4gKGEgPT0gYik7CiAgfQoKICBpZiAoamFzbWluZS5pc051bWJlcl8oYSkgJiYgamFzbWluZS5pc051bWJlcl8oYikpIHsKICAgIHJldHVybiAoYSA9PSBiKTsKICB9CgogIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIGIgPT09ICJvYmplY3QiKSB7CiAgICByZXR1cm4gdGhpcy5jb21wYXJlT2JqZWN0c18oYSwgYiwgbWlzbWF0Y2hLZXlzLCBtaXNtYXRjaFZhbHVlcyk7CiAgfQoKICAvL1N0cmFpZ2h0IGNoZWNrCiAgcmV0dXJuIChhID09PSBiKTsKfTsKCmphc21pbmUuRW52LnByb3RvdHlwZS5jb250YWluc18gPSBmdW5jdGlvbihoYXlzdGFjaywgbmVlZGxlKSB7CiAgaWYgKGphc21pbmUuaXNBcnJheV8oaGF5c3RhY2spKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhheXN0YWNrLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh0aGlzLmVxdWFsc18oaGF5c3RhY2tbaV0sIG5lZWRsZSkpIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gaGF5c3RhY2suaW5kZXhPZihuZWVkbGUpID49IDA7Cn07CgpqYXNtaW5lLkVudi5wcm90b3R5cGUuYWRkRXF1YWxpdHlUZXN0ZXIgPSBmdW5jdGlvbihlcXVhbGl0eVRlc3RlcikgewogIHRoaXMuZXF1YWxpdHlUZXN0ZXJzXy5wdXNoKGVxdWFsaXR5VGVzdGVyKTsKfTsKLyoqIE5vLW9wIGJhc2UgY2xhc3MgZm9yIEphc21pbmUgcmVwb3J0ZXJzLgogKgogKiBAY29uc3RydWN0b3IKICovCmphc21pbmUuUmVwb3J0ZXIgPSBmdW5jdGlvbigpIHsKfTsKCi8vbm9pbnNwZWN0aW9uIEpTVW51c2VkTG9jYWxTeW1ib2xzCmphc21pbmUuUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFJ1bm5lclN0YXJ0aW5nID0gZnVuY3Rpb24ocnVubmVyKSB7Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLlJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRSdW5uZXJSZXN1bHRzID0gZnVuY3Rpb24ocnVubmVyKSB7Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLlJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRTdWl0ZVJlc3VsdHMgPSBmdW5jdGlvbihzdWl0ZSkgewp9OwoKLy9ub2luc3BlY3Rpb24gSlNVbnVzZWRMb2NhbFN5bWJvbHMKamFzbWluZS5SZXBvcnRlci5wcm90b3R5cGUucmVwb3J0U3BlY1N0YXJ0aW5nID0gZnVuY3Rpb24oc3BlYykgewp9OwoKLy9ub2luc3BlY3Rpb24gSlNVbnVzZWRMb2NhbFN5bWJvbHMKamFzbWluZS5SZXBvcnRlci5wcm90b3R5cGUucmVwb3J0U3BlY1Jlc3VsdHMgPSBmdW5jdGlvbihzcGVjKSB7Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLlJlcG9ydGVyLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbihzdHIpIHsKfTsKCi8qKgogKiBCbG9ja3MgYXJlIGZ1bmN0aW9ucyB3aXRoIGV4ZWN1dGFibGUgY29kZSB0aGF0IG1ha2UgdXAgYSBzcGVjLgogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtqYXNtaW5lLkVudn0gZW52CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMKICogQHBhcmFtIHtqYXNtaW5lLlNwZWN9IHNwZWMKICovCmphc21pbmUuQmxvY2sgPSBmdW5jdGlvbihlbnYsIGZ1bmMsIHNwZWMpIHsKICB0aGlzLmVudiA9IGVudjsKICB0aGlzLmZ1bmMgPSBmdW5jOwogIHRoaXMuc3BlYyA9IHNwZWM7Cn07CgpqYXNtaW5lLkJsb2NrLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24ob25Db21wbGV0ZSkgeyAgCiAgdHJ5IHsKICAgIHRoaXMuZnVuYy5hcHBseSh0aGlzLnNwZWMpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHRoaXMuc3BlYy5mYWlsKGUpOwogIH0KICBvbkNvbXBsZXRlKCk7Cn07Ci8qKiBKYXZhU2NyaXB0IEFQSSByZXBvcnRlci4KICoKICogQGNvbnN0cnVjdG9yCiAqLwpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIgPSBmdW5jdGlvbigpIHsKICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKICB0aGlzLmZpbmlzaGVkID0gZmFsc2U7CiAgdGhpcy5zdWl0ZXNfID0gW107CiAgdGhpcy5yZXN1bHRzXyA9IHt9Owp9OwoKamFzbWluZS5Kc0FwaVJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRSdW5uZXJTdGFydGluZyA9IGZ1bmN0aW9uKHJ1bm5lcikgewogIHRoaXMuc3RhcnRlZCA9IHRydWU7CiAgdmFyIHN1aXRlcyA9IHJ1bm5lci50b3BMZXZlbFN1aXRlcygpOwogIGZvciAodmFyIGkgPSAwOyBpIDwgc3VpdGVzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc3VpdGUgPSBzdWl0ZXNbaV07CiAgICB0aGlzLnN1aXRlc18ucHVzaCh0aGlzLnN1bW1hcml6ZV8oc3VpdGUpKTsKICB9Cn07CgpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnN1aXRlcyA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLnN1aXRlc187Cn07CgpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnN1bW1hcml6ZV8gPSBmdW5jdGlvbihzdWl0ZU9yU3BlYykgewogIHZhciBpc1N1aXRlID0gc3VpdGVPclNwZWMgaW5zdGFuY2VvZiBqYXNtaW5lLlN1aXRlOwogIHZhciBzdW1tYXJ5ID0gewogICAgaWQ6IHN1aXRlT3JTcGVjLmlkLAogICAgbmFtZTogc3VpdGVPclNwZWMuZGVzY3JpcHRpb24sCiAgICB0eXBlOiBpc1N1aXRlID8gJ3N1aXRlJyA6ICdzcGVjJywKICAgIGNoaWxkcmVuOiBbXQogIH07CiAgCiAgaWYgKGlzU3VpdGUpIHsKICAgIHZhciBjaGlsZHJlbiA9IHN1aXRlT3JTcGVjLmNoaWxkcmVuKCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHN1bW1hcnkuY2hpbGRyZW4ucHVzaCh0aGlzLnN1bW1hcml6ZV8oY2hpbGRyZW5baV0pKTsKICAgIH0KICB9CiAgcmV0dXJuIHN1bW1hcnk7Cn07CgpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnJlc3VsdHMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5yZXN1bHRzXzsKfTsKCmphc21pbmUuSnNBcGlSZXBvcnRlci5wcm90b3R5cGUucmVzdWx0c0ZvclNwZWMgPSBmdW5jdGlvbihzcGVjSWQpIHsKICByZXR1cm4gdGhpcy5yZXN1bHRzX1tzcGVjSWRdOwp9OwoKLy9ub2luc3BlY3Rpb24gSlNVbnVzZWRMb2NhbFN5bWJvbHMKamFzbWluZS5Kc0FwaVJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRSdW5uZXJSZXN1bHRzID0gZnVuY3Rpb24ocnVubmVyKSB7CiAgdGhpcy5maW5pc2hlZCA9IHRydWU7Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFN1aXRlUmVzdWx0cyA9IGZ1bmN0aW9uKHN1aXRlKSB7Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFNwZWNSZXN1bHRzID0gZnVuY3Rpb24oc3BlYykgewogIHRoaXMucmVzdWx0c19bc3BlYy5pZF0gPSB7CiAgICBtZXNzYWdlczogc3BlYy5yZXN1bHRzKCkuZ2V0SXRlbXMoKSwKICAgIHJlc3VsdDogc3BlYy5yZXN1bHRzKCkuZmFpbGVkQ291bnQgPiAwID8gImZhaWxlZCIgOiAicGFzc2VkIgogIH07Cn07CgovL25vaW5zcGVjdGlvbiBKU1VudXNlZExvY2FsU3ltYm9scwpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uKHN0cikgewp9OwoKamFzbWluZS5Kc0FwaVJlcG9ydGVyLnByb3RvdHlwZS5yZXN1bHRzRm9yU3BlY3MgPSBmdW5jdGlvbihzcGVjSWRzKXsKICB2YXIgcmVzdWx0cyA9IHt9OwogIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlY0lkcy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNwZWNJZCA9IHNwZWNJZHNbaV07CiAgICByZXN1bHRzW3NwZWNJZF0gPSB0aGlzLnN1bW1hcml6ZVJlc3VsdF8odGhpcy5yZXN1bHRzX1tzcGVjSWRdKTsKICB9CiAgcmV0dXJuIHJlc3VsdHM7Cn07CgpqYXNtaW5lLkpzQXBpUmVwb3J0ZXIucHJvdG90eXBlLnN1bW1hcml6ZVJlc3VsdF8gPSBmdW5jdGlvbihyZXN1bHQpewogIHZhciBzdW1tYXJ5TWVzc2FnZXMgPSBbXTsKICB2YXIgbWVzc2FnZXNMZW5ndGggPSByZXN1bHQubWVzc2FnZXMubGVuZ3RoOwogIGZvciAodmFyIG1lc3NhZ2VJbmRleCA9IDA7IG1lc3NhZ2VJbmRleCA8IG1lc3NhZ2VzTGVuZ3RoOyBtZXNzYWdlSW5kZXgrKykgewogICAgdmFyIHJlc3VsdE1lc3NhZ2UgPSByZXN1bHQubWVzc2FnZXNbbWVzc2FnZUluZGV4XTsKICAgIHN1bW1hcnlNZXNzYWdlcy5wdXNoKHsKICAgICAgdGV4dDogcmVzdWx0TWVzc2FnZS50eXBlID09ICdsb2cnID8gcmVzdWx0TWVzc2FnZS50b1N0cmluZygpIDogamFzbWluZS51bmRlZmluZWQsCiAgICAgIHBhc3NlZDogcmVzdWx0TWVzc2FnZS5wYXNzZWQgPyByZXN1bHRNZXNzYWdlLnBhc3NlZCgpIDogdHJ1ZSwKICAgICAgdHlwZTogcmVzdWx0TWVzc2FnZS50eXBlLAogICAgICBtZXNzYWdlOiByZXN1bHRNZXNzYWdlLm1lc3NhZ2UsCiAgICAgIHRyYWNlOiB7CiAgICAgICAgc3RhY2s6IHJlc3VsdE1lc3NhZ2UucGFzc2VkICYmICFyZXN1bHRNZXNzYWdlLnBhc3NlZCgpID8gcmVzdWx0TWVzc2FnZS50cmFjZS5zdGFjayA6IGphc21pbmUudW5kZWZpbmVkCiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIHsKICAgIHJlc3VsdCA6IHJlc3VsdC5yZXN1bHQsCiAgICBtZXNzYWdlcyA6IHN1bW1hcnlNZXNzYWdlcwogIH07Cn07CgovKioKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7amFzbWluZS5FbnZ9IGVudgogKiBAcGFyYW0gYWN0dWFsCiAqIEBwYXJhbSB7amFzbWluZS5TcGVjfSBzcGVjCiAqLwpqYXNtaW5lLk1hdGNoZXJzID0gZnVuY3Rpb24oZW52LCBhY3R1YWwsIHNwZWMsIG9wdF9pc05vdCkgewogIHRoaXMuZW52ID0gZW52OwogIHRoaXMuYWN0dWFsID0gYWN0dWFsOwogIHRoaXMuc3BlYyA9IHNwZWM7CiAgdGhpcy5pc05vdCA9IG9wdF9pc05vdCB8fCBmYWxzZTsKICB0aGlzLnJlcG9ydFdhc0NhbGxlZF8gPSBmYWxzZTsKfTsKCi8vIHRvZG86IEBkZXByZWNhdGVkIGFzIG9mIEphc21pbmUgMC4xMSwgcmVtb3ZlIHNvb24gW3h3XQpqYXNtaW5lLk1hdGNoZXJzLnBwID0gZnVuY3Rpb24oc3RyKSB7CiAgdGhyb3cgbmV3IEVycm9yKCJqYXNtaW5lLk1hdGNoZXJzLnBwKCkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCwgcGxlYXNlIHVzZSBqYXNtaW5lLnBwKCkgaW5zdGVhZCEiKTsKfTsKCi8vIHRvZG86IEBkZXByZWNhdGVkIERlcHJlY2F0ZWQgYXMgb2YgSmFzbWluZSAwLjEwLiBSZXdyaXRlIHlvdXIgY3VzdG9tIG1hdGNoZXJzIHRvIHJldHVybiB0cnVlIG9yIGZhbHNlLiBbeHddCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnJlcG9ydCA9IGZ1bmN0aW9uKHJlc3VsdCwgZmFpbGluZ19tZXNzYWdlLCBkZXRhaWxzKSB7CiAgdGhyb3cgbmV3IEVycm9yKCJBcyBvZiBqYXNtaW5lIDAuMTEsIGN1c3RvbSBtYXRjaGVycyBtdXN0IGJlIGltcGxlbWVudGVkIGRpZmZlcmVudGx5IC0tIHBsZWFzZSBzZWUgamFzbWluZSBkb2NzIik7Cn07CgpqYXNtaW5lLk1hdGNoZXJzLndyYXBJbnRvXyA9IGZ1bmN0aW9uKHByb3RvdHlwZSwgbWF0Y2hlcnNDbGFzcykgewogIGZvciAodmFyIG1ldGhvZE5hbWUgaW4gcHJvdG90eXBlKSB7CiAgICBpZiAobWV0aG9kTmFtZSA9PSAncmVwb3J0JykgY29udGludWU7CiAgICB2YXIgb3JpZyA9IHByb3RvdHlwZVttZXRob2ROYW1lXTsKICAgIG1hdGNoZXJzQ2xhc3MucHJvdG90eXBlW21ldGhvZE5hbWVdID0gamFzbWluZS5NYXRjaGVycy5tYXRjaGVyRm5fKG1ldGhvZE5hbWUsIG9yaWcpOwogIH0KfTsKCmphc21pbmUuTWF0Y2hlcnMubWF0Y2hlckZuXyA9IGZ1bmN0aW9uKG1hdGNoZXJOYW1lLCBtYXRjaGVyRnVuY3Rpb24pIHsKICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB2YXIgbWF0Y2hlckFyZ3MgPSBqYXNtaW5lLnV0aWwuYXJnc1RvQXJyYXkoYXJndW1lbnRzKTsKICAgIHZhciByZXN1bHQgPSBtYXRjaGVyRnVuY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCiAgICBpZiAodGhpcy5pc05vdCkgewogICAgICByZXN1bHQgPSAhcmVzdWx0OwogICAgfQoKICAgIGlmICh0aGlzLnJlcG9ydFdhc0NhbGxlZF8pIHJldHVybiByZXN1bHQ7CgogICAgdmFyIG1lc3NhZ2U7CiAgICBpZiAoIXJlc3VsdCkgewogICAgICBpZiAodGhpcy5tZXNzYWdlKSB7CiAgICAgICAgbWVzc2FnZSA9IHRoaXMubWVzc2FnZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIGlmIChqYXNtaW5lLmlzQXJyYXlfKG1lc3NhZ2UpKSB7CiAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZVt0aGlzLmlzTm90ID8gMSA6IDBdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZW5nbGlzaHlQcmVkaWNhdGUgPSBtYXRjaGVyTmFtZS5yZXBsYWNlKC9bQS1aXS9nLCBmdW5jdGlvbihzKSB7IHJldHVybiAnICcgKyBzLnRvTG93ZXJDYXNlKCk7IH0pOwogICAgICAgIG1lc3NhZ2UgPSAiRXhwZWN0ZWQgIiArIGphc21pbmUucHAodGhpcy5hY3R1YWwpICsgKHRoaXMuaXNOb3QgPyAiIG5vdCAiIDogIiAiKSArIGVuZ2xpc2h5UHJlZGljYXRlOwogICAgICAgIGlmIChtYXRjaGVyQXJncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hdGNoZXJBcmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpID4gMCkgbWVzc2FnZSArPSAiLCI7CiAgICAgICAgICAgIG1lc3NhZ2UgKz0gIiAiICsgamFzbWluZS5wcChtYXRjaGVyQXJnc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG1lc3NhZ2UgKz0gIi4iOwogICAgICB9CiAgICB9CiAgICB2YXIgZXhwZWN0YXRpb25SZXN1bHQgPSBuZXcgamFzbWluZS5FeHBlY3RhdGlvblJlc3VsdCh7CiAgICAgIG1hdGNoZXJOYW1lOiBtYXRjaGVyTmFtZSwKICAgICAgcGFzc2VkOiByZXN1bHQsCiAgICAgIGV4cGVjdGVkOiBtYXRjaGVyQXJncy5sZW5ndGggPiAxID8gbWF0Y2hlckFyZ3MgOiBtYXRjaGVyQXJnc1swXSwKICAgICAgYWN0dWFsOiB0aGlzLmFjdHVhbCwKICAgICAgbWVzc2FnZTogbWVzc2FnZQogICAgfSk7CiAgICB0aGlzLnNwZWMuYWRkTWF0Y2hlclJlc3VsdChleHBlY3RhdGlvblJlc3VsdCk7CiAgICByZXR1cm4gamFzbWluZS51bmRlZmluZWQ7CiAgfTsKfTsKCgoKCi8qKgogKiB0b0JlOiBjb21wYXJlcyB0aGUgYWN0dWFsIHRvIHRoZSBleHBlY3RlZCB1c2luZyA9PT0KICogQHBhcmFtIGV4cGVjdGVkCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0JlID0gZnVuY3Rpb24oZXhwZWN0ZWQpIHsKICByZXR1cm4gdGhpcy5hY3R1YWwgPT09IGV4cGVjdGVkOwp9OwoKLyoqCiAqIHRvTm90QmU6IGNvbXBhcmVzIHRoZSBhY3R1YWwgdG8gdGhlIGV4cGVjdGVkIHVzaW5nICE9PQogKiBAcGFyYW0gZXhwZWN0ZWQKICogQGRlcHJlY2F0ZWQgYXMgb2YgMS4wLiBVc2Ugbm90LnRvQmUoKSBpbnN0ZWFkLgogKi8KamFzbWluZS5NYXRjaGVycy5wcm90b3R5cGUudG9Ob3RCZSA9IGZ1bmN0aW9uKGV4cGVjdGVkKSB7CiAgcmV0dXJuIHRoaXMuYWN0dWFsICE9PSBleHBlY3RlZDsKfTsKCi8qKgogKiB0b0VxdWFsOiBjb21wYXJlcyB0aGUgYWN0dWFsIHRvIHRoZSBleHBlY3RlZCB1c2luZyBjb21tb24gc2Vuc2UgZXF1YWxpdHkuIEhhbmRsZXMgT2JqZWN0cywgQXJyYXlzLCBldGMuCiAqCiAqIEBwYXJhbSBleHBlY3RlZAogKi8KamFzbWluZS5NYXRjaGVycy5wcm90b3R5cGUudG9FcXVhbCA9IGZ1bmN0aW9uKGV4cGVjdGVkKSB7CiAgcmV0dXJuIHRoaXMuZW52LmVxdWFsc18odGhpcy5hY3R1YWwsIGV4cGVjdGVkKTsKfTsKCi8qKgogKiB0b05vdEVxdWFsOiBjb21wYXJlcyB0aGUgYWN0dWFsIHRvIHRoZSBleHBlY3RlZCB1c2luZyB0aGUgISBvZiBqYXNtaW5lLk1hdGNoZXJzLnRvRXF1YWwKICogQHBhcmFtIGV4cGVjdGVkCiAqIEBkZXByZWNhdGVkIGFzIG9mIDEuMC4gVXNlIG5vdC50b05vdEVxdWFsKCkgaW5zdGVhZC4KICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvTm90RXF1YWwgPSBmdW5jdGlvbihleHBlY3RlZCkgewogIHJldHVybiAhdGhpcy5lbnYuZXF1YWxzXyh0aGlzLmFjdHVhbCwgZXhwZWN0ZWQpOwp9OwoKLyoqCiAqIE1hdGNoZXIgdGhhdCBjb21wYXJlcyB0aGUgYWN0dWFsIHRvIHRoZSBleHBlY3RlZCB1c2luZyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4gIENvbnN0cnVjdHMgYSBSZWdFeHAsIHNvIHRha2VzCiAqIGEgcGF0dGVybiBvciBhIFN0cmluZy4KICoKICogQHBhcmFtIGV4cGVjdGVkCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b01hdGNoID0gZnVuY3Rpb24oZXhwZWN0ZWQpIHsKICByZXR1cm4gbmV3IFJlZ0V4cChleHBlY3RlZCkudGVzdCh0aGlzLmFjdHVhbCk7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGNvbXBhcmVzIHRoZSBhY3R1YWwgdG8gdGhlIGV4cGVjdGVkIHVzaW5nIHRoZSBib29sZWFuIGludmVyc2Ugb2YgamFzbWluZS5NYXRjaGVycy50b01hdGNoCiAqIEBwYXJhbSBleHBlY3RlZAogKiBAZGVwcmVjYXRlZCBhcyBvZiAxLjAuIFVzZSBub3QudG9NYXRjaCgpIGluc3RlYWQuCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b05vdE1hdGNoID0gZnVuY3Rpb24oZXhwZWN0ZWQpIHsKICByZXR1cm4gIShuZXcgUmVnRXhwKGV4cGVjdGVkKS50ZXN0KHRoaXMuYWN0dWFsKSk7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGNvbXBhcmVzIHRoZSBhY3R1YWwgdG8gamFzbWluZS51bmRlZmluZWQuCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0JlRGVmaW5lZCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiAodGhpcy5hY3R1YWwgIT09IGphc21pbmUudW5kZWZpbmVkKTsKfTsKCi8qKgogKiBNYXRjaGVyIHRoYXQgY29tcGFyZXMgdGhlIGFjdHVhbCB0byBqYXNtaW5lLnVuZGVmaW5lZC4KICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvQmVVbmRlZmluZWQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gKHRoaXMuYWN0dWFsID09PSBqYXNtaW5lLnVuZGVmaW5lZCk7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGNvbXBhcmVzIHRoZSBhY3R1YWwgdG8gbnVsbC4KICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvQmVOdWxsID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICh0aGlzLmFjdHVhbCA9PT0gbnVsbCk7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGJvb2xlYW4gbm90LW5vdHMgdGhlIGFjdHVhbC4KICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvQmVUcnV0aHkgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gISF0aGlzLmFjdHVhbDsKfTsKCgovKioKICogTWF0Y2hlciB0aGF0IGJvb2xlYW4gbm90cyB0aGUgYWN0dWFsLgogKi8KamFzbWluZS5NYXRjaGVycy5wcm90b3R5cGUudG9CZUZhbHN5ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICF0aGlzLmFjdHVhbDsKfTsKCgovKioKICogTWF0Y2hlciB0aGF0IGNoZWNrcyB0byBzZWUgaWYgdGhlIGFjdHVhbCwgYSBKYXNtaW5lIHNweSwgd2FzIGNhbGxlZC4KICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvSGF2ZUJlZW5DYWxsZWQgPSBmdW5jdGlvbigpIHsKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDApIHsKICAgIHRocm93IG5ldyBFcnJvcigndG9IYXZlQmVlbkNhbGxlZCBkb2VzIG5vdCB0YWtlIGFyZ3VtZW50cywgdXNlIHRvSGF2ZUJlZW5DYWxsZWRXaXRoJyk7CiAgfQoKICBpZiAoIWphc21pbmUuaXNTcHkodGhpcy5hY3R1YWwpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgc3B5LCBidXQgZ290ICcgKyBqYXNtaW5lLnBwKHRoaXMuYWN0dWFsKSArICcuJyk7CiAgfQoKICB0aGlzLm1lc3NhZ2UgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBbCiAgICAgICJFeHBlY3RlZCBzcHkgIiArIHRoaXMuYWN0dWFsLmlkZW50aXR5ICsgIiB0byBoYXZlIGJlZW4gY2FsbGVkLiIsCiAgICAgICJFeHBlY3RlZCBzcHkgIiArIHRoaXMuYWN0dWFsLmlkZW50aXR5ICsgIiBub3QgdG8gaGF2ZSBiZWVuIGNhbGxlZC4iCiAgICBdOwogIH07CgogIHJldHVybiB0aGlzLmFjdHVhbC53YXNDYWxsZWQ7Cn07CgovKiogQGRlcHJlY2F0ZWQgVXNlIGV4cGVjdCh4eHgpLnRvSGF2ZUJlZW5DYWxsZWQoKSBpbnN0ZWFkICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLndhc0NhbGxlZCA9IGphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvSGF2ZUJlZW5DYWxsZWQ7CgovKioKICogTWF0Y2hlciB0aGF0IGNoZWNrcyB0byBzZWUgaWYgdGhlIGFjdHVhbCwgYSBKYXNtaW5lIHNweSwgd2FzIG5vdCBjYWxsZWQuCiAqCiAqIEBkZXByZWNhdGVkIFVzZSBleHBlY3QoeHh4KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpIGluc3RlYWQKICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLndhc05vdENhbGxlZCA9IGZ1bmN0aW9uKCkgewogIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCd3YXNOb3RDYWxsZWQgZG9lcyBub3QgdGFrZSBhcmd1bWVudHMnKTsKICB9CgogIGlmICghamFzbWluZS5pc1NweSh0aGlzLmFjdHVhbCkpIHsKICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgYSBzcHksIGJ1dCBnb3QgJyArIGphc21pbmUucHAodGhpcy5hY3R1YWwpICsgJy4nKTsKICB9CgogIHRoaXMubWVzc2FnZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFsKICAgICAgIkV4cGVjdGVkIHNweSAiICsgdGhpcy5hY3R1YWwuaWRlbnRpdHkgKyAiIHRvIG5vdCBoYXZlIGJlZW4gY2FsbGVkLiIsCiAgICAgICJFeHBlY3RlZCBzcHkgIiArIHRoaXMuYWN0dWFsLmlkZW50aXR5ICsgIiB0byBoYXZlIGJlZW4gY2FsbGVkLiIKICAgIF07CiAgfTsKCiAgcmV0dXJuICF0aGlzLmFjdHVhbC53YXNDYWxsZWQ7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGNoZWNrcyB0byBzZWUgaWYgdGhlIGFjdHVhbCwgYSBKYXNtaW5lIHNweSwgd2FzIGNhbGxlZCB3aXRoIGEgc2V0IG9mIHBhcmFtZXRlcnMuCiAqCiAqIEBleGFtcGxlCiAqCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0hhdmVCZWVuQ2FsbGVkV2l0aCA9IGZ1bmN0aW9uKCkgewogIHZhciBleHBlY3RlZEFyZ3MgPSBqYXNtaW5lLnV0aWwuYXJnc1RvQXJyYXkoYXJndW1lbnRzKTsKICBpZiAoIWphc21pbmUuaXNTcHkodGhpcy5hY3R1YWwpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgc3B5LCBidXQgZ290ICcgKyBqYXNtaW5lLnBwKHRoaXMuYWN0dWFsKSArICcuJyk7CiAgfQogIHRoaXMubWVzc2FnZSA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuYWN0dWFsLmNhbGxDb3VudCA9PT0gMCkgewogICAgICAvLyB0b2RvOiB3aGF0IHNob3VsZCB0aGUgZmFpbHVyZSBtZXNzYWdlIGZvciAubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCkgYmU/IGlzIHRoaXMgcmlnaHQ/IHRlc3QgYmV0dGVyLiBbeHddCiAgICAgIHJldHVybiBbCiAgICAgICAgIkV4cGVjdGVkIHNweSAiICsgdGhpcy5hY3R1YWwuaWRlbnRpdHkgKyAiIHRvIGhhdmUgYmVlbiBjYWxsZWQgd2l0aCAiICsgamFzbWluZS5wcChleHBlY3RlZEFyZ3MpICsgIiBidXQgaXQgd2FzIG5ldmVyIGNhbGxlZC4iLAogICAgICAgICJFeHBlY3RlZCBzcHkgIiArIHRoaXMuYWN0dWFsLmlkZW50aXR5ICsgIiBub3QgdG8gaGF2ZSBiZWVuIGNhbGxlZCB3aXRoICIgKyBqYXNtaW5lLnBwKGV4cGVjdGVkQXJncykgKyAiIGJ1dCBpdCB3YXMuIgogICAgICBdOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIFsKICAgICAgICAiRXhwZWN0ZWQgc3B5ICIgKyB0aGlzLmFjdHVhbC5pZGVudGl0eSArICIgdG8gaGF2ZSBiZWVuIGNhbGxlZCB3aXRoICIgKyBqYXNtaW5lLnBwKGV4cGVjdGVkQXJncykgKyAiIGJ1dCB3YXMgY2FsbGVkIHdpdGggIiArIGphc21pbmUucHAodGhpcy5hY3R1YWwuYXJnc0ZvckNhbGwpLAogICAgICAgICJFeHBlY3RlZCBzcHkgIiArIHRoaXMuYWN0dWFsLmlkZW50aXR5ICsgIiBub3QgdG8gaGF2ZSBiZWVuIGNhbGxlZCB3aXRoICIgKyBqYXNtaW5lLnBwKGV4cGVjdGVkQXJncykgKyAiIGJ1dCB3YXMgY2FsbGVkIHdpdGggIiArIGphc21pbmUucHAodGhpcy5hY3R1YWwuYXJnc0ZvckNhbGwpCiAgICAgIF07CiAgICB9CiAgfTsKCiAgcmV0dXJuIHRoaXMuZW52LmNvbnRhaW5zXyh0aGlzLmFjdHVhbC5hcmdzRm9yQ2FsbCwgZXhwZWN0ZWRBcmdzKTsKfTsKCi8qKiBAZGVwcmVjYXRlZCBVc2UgZXhwZWN0KHh4eCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKSBpbnN0ZWFkICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLndhc0NhbGxlZFdpdGggPSBqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0hhdmVCZWVuQ2FsbGVkV2l0aDsKCi8qKiBAZGVwcmVjYXRlZCBVc2UgZXhwZWN0KHh4eCkubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCkgaW5zdGVhZCAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS53YXNOb3RDYWxsZWRXaXRoID0gZnVuY3Rpb24oKSB7CiAgdmFyIGV4cGVjdGVkQXJncyA9IGphc21pbmUudXRpbC5hcmdzVG9BcnJheShhcmd1bWVudHMpOwogIGlmICghamFzbWluZS5pc1NweSh0aGlzLmFjdHVhbCkpIHsKICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgYSBzcHksIGJ1dCBnb3QgJyArIGphc21pbmUucHAodGhpcy5hY3R1YWwpICsgJy4nKTsKICB9CgogIHRoaXMubWVzc2FnZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFsKICAgICAgIkV4cGVjdGVkIHNweSBub3QgdG8gaGF2ZSBiZWVuIGNhbGxlZCB3aXRoICIgKyBqYXNtaW5lLnBwKGV4cGVjdGVkQXJncykgKyAiIGJ1dCBpdCB3YXMiLAogICAgICAiRXhwZWN0ZWQgc3B5IHRvIGhhdmUgYmVlbiBjYWxsZWQgd2l0aCAiICsgamFzbWluZS5wcChleHBlY3RlZEFyZ3MpICsgIiBidXQgaXQgd2FzIgogICAgXTsKICB9OwoKICByZXR1cm4gIXRoaXMuZW52LmNvbnRhaW5zXyh0aGlzLmFjdHVhbC5hcmdzRm9yQ2FsbCwgZXhwZWN0ZWRBcmdzKTsKfTsKCi8qKgogKiBNYXRjaGVyIHRoYXQgY2hlY2tzIHRoYXQgdGhlIGV4cGVjdGVkIGl0ZW0gaXMgYW4gZWxlbWVudCBpbiB0aGUgYWN0dWFsIEFycmF5LgogKgogKiBAcGFyYW0ge09iamVjdH0gZXhwZWN0ZWQKICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvQ29udGFpbiA9IGZ1bmN0aW9uKGV4cGVjdGVkKSB7CiAgcmV0dXJuIHRoaXMuZW52LmNvbnRhaW5zXyh0aGlzLmFjdHVhbCwgZXhwZWN0ZWQpOwp9OwoKLyoqCiAqIE1hdGNoZXIgdGhhdCBjaGVja3MgdGhhdCB0aGUgZXhwZWN0ZWQgaXRlbSBpcyBOT1QgYW4gZWxlbWVudCBpbiB0aGUgYWN0dWFsIEFycmF5LgogKgogKiBAcGFyYW0ge09iamVjdH0gZXhwZWN0ZWQKICogQGRlcHJlY2F0ZWQgYXMgb2YgMS4wLiBVc2Ugbm90LnRvTm90Q29udGFpbigpIGluc3RlYWQuCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b05vdENvbnRhaW4gPSBmdW5jdGlvbihleHBlY3RlZCkgewogIHJldHVybiAhdGhpcy5lbnYuY29udGFpbnNfKHRoaXMuYWN0dWFsLCBleHBlY3RlZCk7Cn07CgpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0JlTGVzc1RoYW4gPSBmdW5jdGlvbihleHBlY3RlZCkgewogIHJldHVybiB0aGlzLmFjdHVhbCA8IGV4cGVjdGVkOwp9OwoKamFzbWluZS5NYXRjaGVycy5wcm90b3R5cGUudG9CZUdyZWF0ZXJUaGFuID0gZnVuY3Rpb24oZXhwZWN0ZWQpIHsKICByZXR1cm4gdGhpcy5hY3R1YWwgPiBleHBlY3RlZDsKfTsKCi8qKgogKiBNYXRjaGVyIHRoYXQgY2hlY2tzIHRoYXQgdGhlIGV4cGVjdGVkIGl0ZW0gaXMgZXF1YWwgdG8gdGhlIGFjdHVhbCBpdGVtCiAqIHVwIHRvIGEgZ2l2ZW4gbGV2ZWwgb2YgZGVjaW1hbCBwcmVjaXNpb24gKGRlZmF1bHQgMikuCiAqCiAqIEBwYXJhbSB7TnVtYmVyfSBleHBlY3RlZAogKiBAcGFyYW0ge051bWJlcn0gcHJlY2lzaW9uCiAqLwpqYXNtaW5lLk1hdGNoZXJzLnByb3RvdHlwZS50b0JlQ2xvc2VUbyA9IGZ1bmN0aW9uKGV4cGVjdGVkLCBwcmVjaXNpb24pIHsKICBpZiAoIShwcmVjaXNpb24gPT09IDApKSB7CiAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gfHwgMjsKICB9CiAgdmFyIG11bHRpcGxpZXIgPSBNYXRoLnBvdygxMCwgcHJlY2lzaW9uKTsKICB2YXIgYWN0dWFsID0gTWF0aC5yb3VuZCh0aGlzLmFjdHVhbCAqIG11bHRpcGxpZXIpOwogIGV4cGVjdGVkID0gTWF0aC5yb3VuZChleHBlY3RlZCAqIG11bHRpcGxpZXIpOwogIHJldHVybiBleHBlY3RlZCA9PSBhY3R1YWw7Cn07CgovKioKICogTWF0Y2hlciB0aGF0IGNoZWNrcyB0aGF0IHRoZSBleHBlY3RlZCBleGNlcHRpb24gd2FzIHRocm93biBieSB0aGUgYWN0dWFsLgogKgogKiBAcGFyYW0ge1N0cmluZ30gZXhwZWN0ZWQKICovCmphc21pbmUuTWF0Y2hlcnMucHJvdG90eXBlLnRvVGhyb3cgPSBmdW5jdGlvbihleHBlY3RlZCkgewogIHZhciByZXN1bHQgPSBmYWxzZTsKICB2YXIgZXhjZXB0aW9uOwogIGlmICh0eXBlb2YgdGhpcy5hY3R1YWwgIT0gJ2Z1bmN0aW9uJykgewogICAgdGhyb3cgbmV3IEVycm9yKCdBY3R1YWwgaXMgbm90IGEgZnVuY3Rpb24nKTsKICB9CiAgdHJ5IHsKICAgIHRoaXMuYWN0dWFsKCk7CiAgfSBjYXRjaCAoZSkgewogICAgZXhjZXB0aW9uID0gZTsKICB9CiAgaWYgKGV4Y2VwdGlvbikgewogICAgcmVzdWx0ID0gKGV4cGVjdGVkID09PSBqYXNtaW5lLnVuZGVmaW5lZCB8fCB0aGlzLmVudi5lcXVhbHNfKGV4Y2VwdGlvbi5tZXNzYWdlIHx8IGV4Y2VwdGlvbiwgZXhwZWN0ZWQubWVzc2FnZSB8fCBleHBlY3RlZCkpOwogIH0KCiAgdmFyIG5vdCA9IHRoaXMuaXNOb3QgPyAibm90ICIgOiAiIjsKCiAgdGhpcy5tZXNzYWdlID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoZXhjZXB0aW9uICYmIChleHBlY3RlZCA9PT0gamFzbWluZS51bmRlZmluZWQgfHwgIXRoaXMuZW52LmVxdWFsc18oZXhjZXB0aW9uLm1lc3NhZ2UgfHwgZXhjZXB0aW9uLCBleHBlY3RlZC5tZXNzYWdlIHx8IGV4cGVjdGVkKSkpIHsKICAgICAgcmV0dXJuIFsiRXhwZWN0ZWQgZnVuY3Rpb24gIiArIG5vdCArICJ0byB0aHJvdyIsIGV4cGVjdGVkID8gZXhwZWN0ZWQubWVzc2FnZSB8fCBleHBlY3RlZCA6ICJhbiBleGNlcHRpb24iLCAiLCBidXQgaXQgdGhyZXciLCBleGNlcHRpb24ubWVzc2FnZSB8fCBleGNlcHRpb25dLmpvaW4oJyAnKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAiRXhwZWN0ZWQgZnVuY3Rpb24gdG8gdGhyb3cgYW4gZXhjZXB0aW9uLiI7CiAgICB9CiAgfTsKCiAgcmV0dXJuIHJlc3VsdDsKfTsKCmphc21pbmUuTWF0Y2hlcnMuQW55ID0gZnVuY3Rpb24oZXhwZWN0ZWRDbGFzcykgewogIHRoaXMuZXhwZWN0ZWRDbGFzcyA9IGV4cGVjdGVkQ2xhc3M7Cn07CgpqYXNtaW5lLk1hdGNoZXJzLkFueS5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uKG90aGVyKSB7CiAgaWYgKHRoaXMuZXhwZWN0ZWRDbGFzcyA9PSBTdHJpbmcpIHsKICAgIHJldHVybiB0eXBlb2Ygb3RoZXIgPT0gJ3N0cmluZycgfHwgb3RoZXIgaW5zdGFuY2VvZiBTdHJpbmc7CiAgfQoKICBpZiAodGhpcy5leHBlY3RlZENsYXNzID09IE51bWJlcikgewogICAgcmV0dXJuIHR5cGVvZiBvdGhlciA9PSAnbnVtYmVyJyB8fCBvdGhlciBpbnN0YW5jZW9mIE51bWJlcjsKICB9CgogIGlmICh0aGlzLmV4cGVjdGVkQ2xhc3MgPT0gRnVuY3Rpb24pIHsKICAgIHJldHVybiB0eXBlb2Ygb3RoZXIgPT0gJ2Z1bmN0aW9uJyB8fCBvdGhlciBpbnN0YW5jZW9mIEZ1bmN0aW9uOwogIH0KCiAgaWYgKHRoaXMuZXhwZWN0ZWRDbGFzcyA9PSBPYmplY3QpIHsKICAgIHJldHVybiB0eXBlb2Ygb3RoZXIgPT0gJ29iamVjdCc7CiAgfQoKICByZXR1cm4gb3RoZXIgaW5zdGFuY2VvZiB0aGlzLmV4cGVjdGVkQ2xhc3M7Cn07CgpqYXNtaW5lLk1hdGNoZXJzLkFueS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gJzxqYXNtaW5lLmFueSgnICsgdGhpcy5leHBlY3RlZENsYXNzICsgJyk+JzsKfTsKCi8qKgogKiBAY29uc3RydWN0b3IKICovCmphc21pbmUuTXVsdGlSZXBvcnRlciA9IGZ1bmN0aW9uKCkgewogIHRoaXMuc3ViUmVwb3J0ZXJzXyA9IFtdOwp9OwpqYXNtaW5lLnV0aWwuaW5oZXJpdChqYXNtaW5lLk11bHRpUmVwb3J0ZXIsIGphc21pbmUuUmVwb3J0ZXIpOwoKamFzbWluZS5NdWx0aVJlcG9ydGVyLnByb3RvdHlwZS5hZGRSZXBvcnRlciA9IGZ1bmN0aW9uKHJlcG9ydGVyKSB7CiAgdGhpcy5zdWJSZXBvcnRlcnNfLnB1c2gocmVwb3J0ZXIpOwp9OwoKKGZ1bmN0aW9uKCkgewogIHZhciBmdW5jdGlvbk5hbWVzID0gWwogICAgInJlcG9ydFJ1bm5lclN0YXJ0aW5nIiwKICAgICJyZXBvcnRSdW5uZXJSZXN1bHRzIiwKICAgICJyZXBvcnRTdWl0ZVJlc3VsdHMiLAogICAgInJlcG9ydFNwZWNTdGFydGluZyIsCiAgICAicmVwb3J0U3BlY1Jlc3VsdHMiLAogICAgImxvZyIKICBdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgZnVuY3Rpb25OYW1lcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uTmFtZXNbaV07CiAgICBqYXNtaW5lLk11bHRpUmVwb3J0ZXIucHJvdG90eXBlW2Z1bmN0aW9uTmFtZV0gPSAoZnVuY3Rpb24oZnVuY3Rpb25OYW1lKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuc3ViUmVwb3J0ZXJzXy5sZW5ndGg7IGorKykgewogICAgICAgICAgdmFyIHN1YlJlcG9ydGVyID0gdGhpcy5zdWJSZXBvcnRlcnNfW2pdOwogICAgICAgICAgaWYgKHN1YlJlcG9ydGVyW2Z1bmN0aW9uTmFtZV0pIHsKICAgICAgICAgICAgc3ViUmVwb3J0ZXJbZnVuY3Rpb25OYW1lXS5hcHBseShzdWJSZXBvcnRlciwgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9KShmdW5jdGlvbk5hbWUpOwogIH0KfSkoKTsKLyoqCiAqIEhvbGRzIHJlc3VsdHMgZm9yIGEgc2V0IG9mIEphc21pbmUgc3BlYy4gQWxsb3dzIGZvciB0aGUgcmVzdWx0cyBhcnJheSB0byBob2xkIGFub3RoZXIgamFzbWluZS5OZXN0ZWRSZXN1bHRzCiAqCiAqIEBjb25zdHJ1Y3RvcgogKi8KamFzbWluZS5OZXN0ZWRSZXN1bHRzID0gZnVuY3Rpb24oKSB7CiAgLyoqCiAgICogVGhlIHRvdGFsIGNvdW50IG9mIHJlc3VsdHMKICAgKi8KICB0aGlzLnRvdGFsQ291bnQgPSAwOwogIC8qKgogICAqIE51bWJlciBvZiBwYXNzZWQgcmVzdWx0cwogICAqLwogIHRoaXMucGFzc2VkQ291bnQgPSAwOwogIC8qKgogICAqIE51bWJlciBvZiBmYWlsZWQgcmVzdWx0cwogICAqLwogIHRoaXMuZmFpbGVkQ291bnQgPSAwOwogIC8qKgogICAqIFdhcyB0aGlzIHN1aXRlL3NwZWMgc2tpcHBlZD8KICAgKi8KICB0aGlzLnNraXBwZWQgPSBmYWxzZTsKICAvKioKICAgKiBAaWdub3JlCiAgICovCiAgdGhpcy5pdGVtc18gPSBbXTsKfTsKCi8qKgogKiBSb2xsIHVwIHRoZSByZXN1bHQgY291bnRzLgogKgogKiBAcGFyYW0gcmVzdWx0CiAqLwpqYXNtaW5lLk5lc3RlZFJlc3VsdHMucHJvdG90eXBlLnJvbGx1cENvdW50cyA9IGZ1bmN0aW9uKHJlc3VsdCkgewogIHRoaXMudG90YWxDb3VudCArPSByZXN1bHQudG90YWxDb3VudDsKICB0aGlzLnBhc3NlZENvdW50ICs9IHJlc3VsdC5wYXNzZWRDb3VudDsKICB0aGlzLmZhaWxlZENvdW50ICs9IHJlc3VsdC5mYWlsZWRDb3VudDsKfTsKCi8qKgogKiBBZGRzIGEgbG9nIG1lc3NhZ2UuCiAqIEBwYXJhbSB2YWx1ZXMgQXJyYXkgb2YgbWVzc2FnZSBwYXJ0cyB3aGljaCB3aWxsIGJlIGNvbmNhdGVuYXRlZCBsYXRlci4KICovCmphc21pbmUuTmVzdGVkUmVzdWx0cy5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24odmFsdWVzKSB7CiAgdGhpcy5pdGVtc18ucHVzaChuZXcgamFzbWluZS5NZXNzYWdlUmVzdWx0KHZhbHVlcykpOwp9OwoKLyoqCiAqIEdldHRlciBmb3IgdGhlIHJlc3VsdHM6IG1lc3NhZ2UgJiByZXN1bHRzLgogKi8KamFzbWluZS5OZXN0ZWRSZXN1bHRzLnByb3RvdHlwZS5nZXRJdGVtcyA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLml0ZW1zXzsKfTsKCi8qKgogKiBBZGRzIGEgcmVzdWx0LCB0cmFja2luZyBjb3VudHMgKHRvdGFsLCBwYXNzZWQsICYgZmFpbGVkKQogKiBAcGFyYW0ge2phc21pbmUuRXhwZWN0YXRpb25SZXN1bHR8amFzbWluZS5OZXN0ZWRSZXN1bHRzfSByZXN1bHQKICovCmphc21pbmUuTmVzdGVkUmVzdWx0cy5wcm90b3R5cGUuYWRkUmVzdWx0ID0gZnVuY3Rpb24ocmVzdWx0KSB7CiAgaWYgKHJlc3VsdC50eXBlICE9ICdsb2cnKSB7CiAgICBpZiAocmVzdWx0Lml0ZW1zXykgewogICAgICB0aGlzLnJvbGx1cENvdW50cyhyZXN1bHQpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy50b3RhbENvdW50Kys7CiAgICAgIGlmIChyZXN1bHQucGFzc2VkKCkpIHsKICAgICAgICB0aGlzLnBhc3NlZENvdW50Kys7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5mYWlsZWRDb3VudCsrOwogICAgICB9CiAgICB9CiAgfQogIHRoaXMuaXRlbXNfLnB1c2gocmVzdWx0KTsKfTsKCi8qKgogKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiA8Yj5ldmVyeXRoaW5nPC9iPiBiZWxvdyBwYXNzZWQKICovCmphc21pbmUuTmVzdGVkUmVzdWx0cy5wcm90b3R5cGUucGFzc2VkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMucGFzc2VkQ291bnQgPT09IHRoaXMudG90YWxDb3VudDsKfTsKLyoqCiAqIEJhc2UgY2xhc3MgZm9yIHByZXR0eSBwcmludGluZyBmb3IgZXhwZWN0YXRpb24gcmVzdWx0cy4KICovCmphc21pbmUuUHJldHR5UHJpbnRlciA9IGZ1bmN0aW9uKCkgewogIHRoaXMucHBOZXN0TGV2ZWxfID0gMDsKfTsKCi8qKgogKiBGb3JtYXRzIGEgdmFsdWUgaW4gYSBuaWNlLCBodW1hbi1yZWFkYWJsZSBzdHJpbmcuCiAqCiAqIEBwYXJhbSB2YWx1ZQogKi8KamFzbWluZS5QcmV0dHlQcmludGVyLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbih2YWx1ZSkgewogIGlmICh0aGlzLnBwTmVzdExldmVsXyA+IDQwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2phc21pbmUuUHJldHR5UHJpbnRlcjogZm9ybWF0KCkgbmVzdGVkIHRvbyBkZWVwbHkhJyk7CiAgfQoKICB0aGlzLnBwTmVzdExldmVsXysrOwogIHRyeSB7CiAgICBpZiAodmFsdWUgPT09IGphc21pbmUudW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcigndW5kZWZpbmVkJyk7CiAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcignbnVsbCcpOwogICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gamFzbWluZS5nZXRHbG9iYWwoKSkgewogICAgICB0aGlzLmVtaXRTY2FsYXIoJzxnbG9iYWw+Jyk7CiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgamFzbWluZS5NYXRjaGVycy5BbnkpIHsKICAgICAgdGhpcy5lbWl0U2NhbGFyKHZhbHVlLnRvU3RyaW5nKCkpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgIHRoaXMuZW1pdFN0cmluZyh2YWx1ZSk7CiAgICB9IGVsc2UgaWYgKGphc21pbmUuaXNTcHkodmFsdWUpKSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcigic3B5IG9uICIgKyB2YWx1ZS5pZGVudGl0eSk7CiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcih2YWx1ZS50b1N0cmluZygpKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcignRnVuY3Rpb24nKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlLm5vZGVUeXBlID09PSAnbnVtYmVyJykgewogICAgICB0aGlzLmVtaXRTY2FsYXIoJ0hUTUxOb2RlJyk7CiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICB0aGlzLmVtaXRTY2FsYXIoJ0RhdGUoJyArIHZhbHVlICsgJyknKTsKICAgIH0gZWxzZSBpZiAodmFsdWUuX19KYXNtaW5lX2JlZW5faGVyZV9iZWZvcmVfXykgewogICAgICB0aGlzLmVtaXRTY2FsYXIoJzxjaXJjdWxhciByZWZlcmVuY2U6ICcgKyAoamFzbWluZS5pc0FycmF5Xyh2YWx1ZSkgPyAnQXJyYXknIDogJ09iamVjdCcpICsgJz4nKTsKICAgIH0gZWxzZSBpZiAoamFzbWluZS5pc0FycmF5Xyh2YWx1ZSkgfHwgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSB7CiAgICAgIHZhbHVlLl9fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX18gPSB0cnVlOwogICAgICBpZiAoamFzbWluZS5pc0FycmF5Xyh2YWx1ZSkpIHsKICAgICAgICB0aGlzLmVtaXRBcnJheSh2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lbWl0T2JqZWN0KHZhbHVlKTsKICAgICAgfQogICAgICBkZWxldGUgdmFsdWUuX19KYXNtaW5lX2JlZW5faGVyZV9iZWZvcmVfXzsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZW1pdFNjYWxhcih2YWx1ZS50b1N0cmluZygpKTsKICAgIH0KICB9IGZpbmFsbHkgewogICAgdGhpcy5wcE5lc3RMZXZlbF8tLTsKICB9Cn07CgpqYXNtaW5lLlByZXR0eVByaW50ZXIucHJvdG90eXBlLml0ZXJhdGVPYmplY3QgPSBmdW5jdGlvbihvYmosIGZuKSB7CiAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqKSB7CiAgICBpZiAocHJvcGVydHkgPT0gJ19fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX18nKSBjb250aW51ZTsKICAgIGZuKHByb3BlcnR5LCBvYmouX19sb29rdXBHZXR0ZXJfXyA/IChvYmouX19sb29rdXBHZXR0ZXJfXyhwcm9wZXJ0eSkgIT09IGphc21pbmUudW5kZWZpbmVkICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5fX2xvb2t1cEdldHRlcl9fKHByb3BlcnR5KSAhPT0gbnVsbCkgOiBmYWxzZSk7CiAgfQp9OwoKamFzbWluZS5QcmV0dHlQcmludGVyLnByb3RvdHlwZS5lbWl0QXJyYXkgPSBqYXNtaW5lLnVuaW1wbGVtZW50ZWRNZXRob2RfOwpqYXNtaW5lLlByZXR0eVByaW50ZXIucHJvdG90eXBlLmVtaXRPYmplY3QgPSBqYXNtaW5lLnVuaW1wbGVtZW50ZWRNZXRob2RfOwpqYXNtaW5lLlByZXR0eVByaW50ZXIucHJvdG90eXBlLmVtaXRTY2FsYXIgPSBqYXNtaW5lLnVuaW1wbGVtZW50ZWRNZXRob2RfOwpqYXNtaW5lLlByZXR0eVByaW50ZXIucHJvdG90eXBlLmVtaXRTdHJpbmcgPSBqYXNtaW5lLnVuaW1wbGVtZW50ZWRNZXRob2RfOwoKamFzbWluZS5TdHJpbmdQcmV0dHlQcmludGVyID0gZnVuY3Rpb24oKSB7CiAgamFzbWluZS5QcmV0dHlQcmludGVyLmNhbGwodGhpcyk7CgogIHRoaXMuc3RyaW5nID0gJyc7Cn07Cmphc21pbmUudXRpbC5pbmhlcml0KGphc21pbmUuU3RyaW5nUHJldHR5UHJpbnRlciwgamFzbWluZS5QcmV0dHlQcmludGVyKTsKCmphc21pbmUuU3RyaW5nUHJldHR5UHJpbnRlci5wcm90b3R5cGUuZW1pdFNjYWxhciA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgdGhpcy5hcHBlbmQodmFsdWUpOwp9OwoKamFzbWluZS5TdHJpbmdQcmV0dHlQcmludGVyLnByb3RvdHlwZS5lbWl0U3RyaW5nID0gZnVuY3Rpb24odmFsdWUpIHsKICB0aGlzLmFwcGVuZCgiJyIgKyB2YWx1ZSArICInIik7Cn07CgpqYXNtaW5lLlN0cmluZ1ByZXR0eVByaW50ZXIucHJvdG90eXBlLmVtaXRBcnJheSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgdGhpcy5hcHBlbmQoJ1sgJyk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgewogICAgaWYgKGkgPiAwKSB7CiAgICAgIHRoaXMuYXBwZW5kKCcsICcpOwogICAgfQogICAgdGhpcy5mb3JtYXQoYXJyYXlbaV0pOwogIH0KICB0aGlzLmFwcGVuZCgnIF0nKTsKfTsKCmphc21pbmUuU3RyaW5nUHJldHR5UHJpbnRlci5wcm90b3R5cGUuZW1pdE9iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogIHZhciBzZWxmID0gdGhpczsKICB0aGlzLmFwcGVuZCgneyAnKTsKICB2YXIgZmlyc3QgPSB0cnVlOwoKICB0aGlzLml0ZXJhdGVPYmplY3Qob2JqLCBmdW5jdGlvbihwcm9wZXJ0eSwgaXNHZXR0ZXIpIHsKICAgIGlmIChmaXJzdCkgewogICAgICBmaXJzdCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi5hcHBlbmQoJywgJyk7CiAgICB9CgogICAgc2VsZi5hcHBlbmQocHJvcGVydHkpOwogICAgc2VsZi5hcHBlbmQoJyA6ICcpOwogICAgaWYgKGlzR2V0dGVyKSB7CiAgICAgIHNlbGYuYXBwZW5kKCc8Z2V0dGVyPicpOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi5mb3JtYXQob2JqW3Byb3BlcnR5XSk7CiAgICB9CiAgfSk7CgogIHRoaXMuYXBwZW5kKCcgfScpOwp9OwoKamFzbWluZS5TdHJpbmdQcmV0dHlQcmludGVyLnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbih2YWx1ZSkgewogIHRoaXMuc3RyaW5nICs9IHZhbHVlOwp9OwpqYXNtaW5lLlF1ZXVlID0gZnVuY3Rpb24oZW52KSB7CiAgdGhpcy5lbnYgPSBlbnY7CiAgdGhpcy5ibG9ja3MgPSBbXTsKICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICB0aGlzLmluZGV4ID0gMDsKICB0aGlzLm9mZnNldCA9IDA7CiAgdGhpcy5hYm9ydCA9IGZhbHNlOwp9OwoKamFzbWluZS5RdWV1ZS5wcm90b3R5cGUuYWRkQmVmb3JlID0gZnVuY3Rpb24oYmxvY2spIHsKICB0aGlzLmJsb2Nrcy51bnNoaWZ0KGJsb2NrKTsKfTsKCmphc21pbmUuUXVldWUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGJsb2NrKSB7CiAgdGhpcy5ibG9ja3MucHVzaChibG9jayk7Cn07CgpqYXNtaW5lLlF1ZXVlLnByb3RvdHlwZS5pbnNlcnROZXh0ID0gZnVuY3Rpb24oYmxvY2spIHsKICB0aGlzLmJsb2Nrcy5zcGxpY2UoKHRoaXMuaW5kZXggKyB0aGlzLm9mZnNldCArIDEpLCAwLCBibG9jayk7CiAgdGhpcy5vZmZzZXQrKzsKfTsKCmphc21pbmUuUXVldWUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24ob25Db21wbGV0ZSkgewogIHRoaXMucnVubmluZyA9IHRydWU7CiAgdGhpcy5vbkNvbXBsZXRlID0gb25Db21wbGV0ZTsKICB0aGlzLm5leHRfKCk7Cn07CgpqYXNtaW5lLlF1ZXVlLnByb3RvdHlwZS5pc1J1bm5pbmcgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5ydW5uaW5nOwp9OwoKamFzbWluZS5RdWV1ZS5MT09QX0RPTlRfUkVDVVJTRSA9IHRydWU7CgpqYXNtaW5lLlF1ZXVlLnByb3RvdHlwZS5uZXh0XyA9IGZ1bmN0aW9uKCkgewogIHZhciBzZWxmID0gdGhpczsKICB2YXIgZ29BZ2FpbiA9IHRydWU7CgogIHdoaWxlIChnb0FnYWluKSB7CiAgICBnb0FnYWluID0gZmFsc2U7CiAgICAKICAgIGlmIChzZWxmLmluZGV4IDwgc2VsZi5ibG9ja3MubGVuZ3RoICYmICF0aGlzLmFib3J0KSB7CiAgICAgIHZhciBjYWxsZWRTeW5jaHJvbm91c2x5ID0gdHJ1ZTsKICAgICAgdmFyIGNvbXBsZXRlZFN5bmNocm9ub3VzbHkgPSBmYWxzZTsKCiAgICAgIHZhciBvbkNvbXBsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChqYXNtaW5lLlF1ZXVlLkxPT1BfRE9OVF9SRUNVUlNFICYmIGNhbGxlZFN5bmNocm9ub3VzbHkpIHsKICAgICAgICAgIGNvbXBsZXRlZFN5bmNocm9ub3VzbHkgPSB0cnVlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuYmxvY2tzW3NlbGYuaW5kZXhdLmFib3J0KSB7CiAgICAgICAgICBzZWxmLmFib3J0ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHNlbGYub2Zmc2V0ID0gMDsKICAgICAgICBzZWxmLmluZGV4Kys7CgogICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICBpZiAoc2VsZi5lbnYudXBkYXRlSW50ZXJ2YWwgJiYgbm93IC0gc2VsZi5lbnYubGFzdFVwZGF0ZSA+IHNlbGYuZW52LnVwZGF0ZUludGVydmFsKSB7CiAgICAgICAgICBzZWxmLmVudi5sYXN0VXBkYXRlID0gbm93OwogICAgICAgICAgc2VsZi5lbnYuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgc2VsZi5uZXh0XygpOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChqYXNtaW5lLlF1ZXVlLkxPT1BfRE9OVF9SRUNVUlNFICYmIGNvbXBsZXRlZFN5bmNocm9ub3VzbHkpIHsKICAgICAgICAgICAgZ29BZ2FpbiA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLm5leHRfKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBzZWxmLmJsb2Nrc1tzZWxmLmluZGV4XS5leGVjdXRlKG9uQ29tcGxldGUpOwoKICAgICAgY2FsbGVkU3luY2hyb25vdXNseSA9IGZhbHNlOwogICAgICBpZiAoY29tcGxldGVkU3luY2hyb25vdXNseSkgewogICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgfQogICAgICAKICAgIH0gZWxzZSB7CiAgICAgIHNlbGYucnVubmluZyA9IGZhbHNlOwogICAgICBpZiAoc2VsZi5vbkNvbXBsZXRlKSB7CiAgICAgICAgc2VsZi5vbkNvbXBsZXRlKCk7CiAgICAgIH0KICAgIH0KICB9Cn07CgpqYXNtaW5lLlF1ZXVlLnByb3RvdHlwZS5yZXN1bHRzID0gZnVuY3Rpb24oKSB7CiAgdmFyIHJlc3VsdHMgPSBuZXcgamFzbWluZS5OZXN0ZWRSZXN1bHRzKCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJsb2Nrcy5sZW5ndGg7IGkrKykgewogICAgaWYgKHRoaXMuYmxvY2tzW2ldLnJlc3VsdHMpIHsKICAgICAgcmVzdWx0cy5hZGRSZXN1bHQodGhpcy5ibG9ja3NbaV0ucmVzdWx0cygpKTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdHM7Cn07CgoKLyoqCiAqIFJ1bm5lcgogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtqYXNtaW5lLkVudn0gZW52CiAqLwpqYXNtaW5lLlJ1bm5lciA9IGZ1bmN0aW9uKGVudikgewogIHZhciBzZWxmID0gdGhpczsKICBzZWxmLmVudiA9IGVudjsKICBzZWxmLnF1ZXVlID0gbmV3IGphc21pbmUuUXVldWUoZW52KTsKICBzZWxmLmJlZm9yZV8gPSBbXTsKICBzZWxmLmFmdGVyXyA9IFtdOwogIHNlbGYuc3VpdGVzXyA9IFtdOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbigpIHsKICB2YXIgc2VsZiA9IHRoaXM7CiAgaWYgKHNlbGYuZW52LnJlcG9ydGVyLnJlcG9ydFJ1bm5lclN0YXJ0aW5nKSB7CiAgICBzZWxmLmVudi5yZXBvcnRlci5yZXBvcnRSdW5uZXJTdGFydGluZyh0aGlzKTsKICB9CiAgc2VsZi5xdWV1ZS5zdGFydChmdW5jdGlvbiAoKSB7CiAgICBzZWxmLmZpbmlzaENhbGxiYWNrKCk7CiAgfSk7Cn07CgpqYXNtaW5lLlJ1bm5lci5wcm90b3R5cGUuYmVmb3JlRWFjaCA9IGZ1bmN0aW9uKGJlZm9yZUVhY2hGdW5jdGlvbikgewogIGJlZm9yZUVhY2hGdW5jdGlvbi50eXBlTmFtZSA9ICdiZWZvcmVFYWNoJzsKICB0aGlzLmJlZm9yZV8uc3BsaWNlKDAsMCxiZWZvcmVFYWNoRnVuY3Rpb24pOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLmFmdGVyRWFjaCA9IGZ1bmN0aW9uKGFmdGVyRWFjaEZ1bmN0aW9uKSB7CiAgYWZ0ZXJFYWNoRnVuY3Rpb24udHlwZU5hbWUgPSAnYWZ0ZXJFYWNoJzsKICB0aGlzLmFmdGVyXy5zcGxpY2UoMCwwLGFmdGVyRWFjaEZ1bmN0aW9uKTsKfTsKCgpqYXNtaW5lLlJ1bm5lci5wcm90b3R5cGUuZmluaXNoQ2FsbGJhY2sgPSBmdW5jdGlvbigpIHsKICB0aGlzLmVudi5yZXBvcnRlci5yZXBvcnRSdW5uZXJSZXN1bHRzKHRoaXMpOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLmFkZFN1aXRlID0gZnVuY3Rpb24oc3VpdGUpIHsKICB0aGlzLnN1aXRlc18ucHVzaChzdWl0ZSk7Cn07CgpqYXNtaW5lLlJ1bm5lci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oYmxvY2spIHsKICBpZiAoYmxvY2sgaW5zdGFuY2VvZiBqYXNtaW5lLlN1aXRlKSB7CiAgICB0aGlzLmFkZFN1aXRlKGJsb2NrKTsKICB9CiAgdGhpcy5xdWV1ZS5hZGQoYmxvY2spOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLnNwZWNzID0gZnVuY3Rpb24gKCkgewogIHZhciBzdWl0ZXMgPSB0aGlzLnN1aXRlcygpOwogIHZhciBzcGVjcyA9IFtdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgc3VpdGVzLmxlbmd0aDsgaSsrKSB7CiAgICBzcGVjcyA9IHNwZWNzLmNvbmNhdChzdWl0ZXNbaV0uc3BlY3MoKSk7CiAgfQogIHJldHVybiBzcGVjczsKfTsKCmphc21pbmUuUnVubmVyLnByb3RvdHlwZS5zdWl0ZXMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5zdWl0ZXNfOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLnRvcExldmVsU3VpdGVzID0gZnVuY3Rpb24oKSB7CiAgdmFyIHRvcExldmVsU3VpdGVzID0gW107CiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnN1aXRlc18ubGVuZ3RoOyBpKyspIHsKICAgIGlmICghdGhpcy5zdWl0ZXNfW2ldLnBhcmVudFN1aXRlKSB7CiAgICAgIHRvcExldmVsU3VpdGVzLnB1c2godGhpcy5zdWl0ZXNfW2ldKTsKICAgIH0KICB9CiAgcmV0dXJuIHRvcExldmVsU3VpdGVzOwp9OwoKamFzbWluZS5SdW5uZXIucHJvdG90eXBlLnJlc3VsdHMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5xdWV1ZS5yZXN1bHRzKCk7Cn07Ci8qKgogKiBJbnRlcm5hbCByZXByZXNlbnRhdGlvbiBvZiBhIEphc21pbmUgc3BlY2lmaWNhdGlvbiwgb3IgdGVzdC4KICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7amFzbWluZS5FbnZ9IGVudgogKiBAcGFyYW0ge2phc21pbmUuU3VpdGV9IHN1aXRlCiAqIEBwYXJhbSB7U3RyaW5nfSBkZXNjcmlwdGlvbgogKi8KamFzbWluZS5TcGVjID0gZnVuY3Rpb24oZW52LCBzdWl0ZSwgZGVzY3JpcHRpb24pIHsKICBpZiAoIWVudikgewogICAgdGhyb3cgbmV3IEVycm9yKCdqYXNtaW5lLkVudigpIHJlcXVpcmVkJyk7CiAgfQogIGlmICghc3VpdGUpIHsKICAgIHRocm93IG5ldyBFcnJvcignamFzbWluZS5TdWl0ZSgpIHJlcXVpcmVkJyk7CiAgfQogIHZhciBzcGVjID0gdGhpczsKICBzcGVjLmlkID0gZW52Lm5leHRTcGVjSWQgPyBlbnYubmV4dFNwZWNJZCgpIDogbnVsbDsKICBzcGVjLmVudiA9IGVudjsKICBzcGVjLnN1aXRlID0gc3VpdGU7CiAgc3BlYy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogIHNwZWMucXVldWUgPSBuZXcgamFzbWluZS5RdWV1ZShlbnYpOwoKICBzcGVjLmFmdGVyQ2FsbGJhY2tzID0gW107CiAgc3BlYy5zcGllc18gPSBbXTsKCiAgc3BlYy5yZXN1bHRzXyA9IG5ldyBqYXNtaW5lLk5lc3RlZFJlc3VsdHMoKTsKICBzcGVjLnJlc3VsdHNfLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247CiAgc3BlYy5tYXRjaGVyc0NsYXNzID0gbnVsbDsKfTsKCmphc21pbmUuU3BlYy5wcm90b3R5cGUuZ2V0RnVsbE5hbWUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5zdWl0ZS5nZXRGdWxsTmFtZSgpICsgJyAnICsgdGhpcy5kZXNjcmlwdGlvbiArICcuJzsKfTsKCgpqYXNtaW5lLlNwZWMucHJvdG90eXBlLnJlc3VsdHMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5yZXN1bHRzXzsKfTsKCi8qKgogKiBBbGwgcGFyYW1ldGVycyBhcmUgcHJldHR5LXByaW50ZWQgYW5kIGNvbmNhdGVuYXRlZCB0b2dldGhlciwgdGhlbiB3cml0dGVuIHRvIHRoZSBzcGVjJ3Mgb3V0cHV0LgogKgogKiBCZSBjYXJlZnVsIG5vdCB0byBsZWF2ZSBjYWxscyB0byA8Y29kZT5qYXNtaW5lLmxvZzwvY29kZT4gaW4gcHJvZHVjdGlvbiBjb2RlLgogKi8KamFzbWluZS5TcGVjLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5yZXN1bHRzXy5sb2coYXJndW1lbnRzKTsKfTsKCmphc21pbmUuU3BlYy5wcm90b3R5cGUucnVucyA9IGZ1bmN0aW9uIChmdW5jKSB7CiAgdmFyIGJsb2NrID0gbmV3IGphc21pbmUuQmxvY2sodGhpcy5lbnYsIGZ1bmMsIHRoaXMpOwogIHRoaXMuYWRkVG9RdWV1ZShibG9jayk7CiAgcmV0dXJuIHRoaXM7Cn07CgpqYXNtaW5lLlNwZWMucHJvdG90eXBlLmFkZFRvUXVldWUgPSBmdW5jdGlvbiAoYmxvY2spIHsKICBpZiAodGhpcy5xdWV1ZS5pc1J1bm5pbmcoKSkgewogICAgdGhpcy5xdWV1ZS5pbnNlcnROZXh0KGJsb2NrKTsKICB9IGVsc2UgewogICAgdGhpcy5xdWV1ZS5hZGQoYmxvY2spOwogIH0KfTsKCi8qKgogKiBAcGFyYW0ge2phc21pbmUuRXhwZWN0YXRpb25SZXN1bHR9IHJlc3VsdAogKi8KamFzbWluZS5TcGVjLnByb3RvdHlwZS5hZGRNYXRjaGVyUmVzdWx0ID0gZnVuY3Rpb24ocmVzdWx0KSB7CiAgdGhpcy5yZXN1bHRzXy5hZGRSZXN1bHQocmVzdWx0KTsKfTsKCmphc21pbmUuU3BlYy5wcm90b3R5cGUuZXhwZWN0ID0gZnVuY3Rpb24oYWN0dWFsKSB7CiAgdmFyIHBvc2l0aXZlID0gbmV3ICh0aGlzLmdldE1hdGNoZXJzQ2xhc3NfKCkpKHRoaXMuZW52LCBhY3R1YWwsIHRoaXMpOwogIHBvc2l0aXZlLm5vdCA9IG5ldyAodGhpcy5nZXRNYXRjaGVyc0NsYXNzXygpKSh0aGlzLmVudiwgYWN0dWFsLCB0aGlzLCB0cnVlKTsKICByZXR1cm4gcG9zaXRpdmU7Cn07CgovKioKICogV2FpdHMgYSBmaXhlZCB0aW1lIHBlcmlvZCBiZWZvcmUgbW92aW5nIHRvIHRoZSBuZXh0IGJsb2NrLgogKgogKiBAZGVwcmVjYXRlZCBVc2Ugd2FpdHNGb3IoKSBpbnN0ZWFkCiAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0IG1pbGxpc2Vjb25kcyB0byB3YWl0CiAqLwpqYXNtaW5lLlNwZWMucHJvdG90eXBlLndhaXRzID0gZnVuY3Rpb24odGltZW91dCkgewogIHZhciB3YWl0c0Z1bmMgPSBuZXcgamFzbWluZS5XYWl0c0Jsb2NrKHRoaXMuZW52LCB0aW1lb3V0LCB0aGlzKTsKICB0aGlzLmFkZFRvUXVldWUod2FpdHNGdW5jKTsKICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBXYWl0cyBmb3IgdGhlIGxhdGNoRnVuY3Rpb24gdG8gcmV0dXJuIHRydWUgYmVmb3JlIHByb2NlZWRpbmcgdG8gdGhlIG5leHQgYmxvY2suCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IGxhdGNoRnVuY3Rpb24KICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbmFsX3RpbWVvdXRNZXNzYWdlCiAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25hbF90aW1lb3V0CiAqLwpqYXNtaW5lLlNwZWMucHJvdG90eXBlLndhaXRzRm9yID0gZnVuY3Rpb24obGF0Y2hGdW5jdGlvbiwgb3B0aW9uYWxfdGltZW91dE1lc3NhZ2UsIG9wdGlvbmFsX3RpbWVvdXQpIHsKICB2YXIgbGF0Y2hGdW5jdGlvbl8gPSBudWxsOwogIHZhciBvcHRpb25hbF90aW1lb3V0TWVzc2FnZV8gPSBudWxsOwogIHZhciBvcHRpb25hbF90aW1lb3V0XyA9IG51bGw7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldOwogICAgc3dpdGNoICh0eXBlb2YgYXJnKSB7CiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgICBsYXRjaEZ1bmN0aW9uXyA9IGFyZzsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICBvcHRpb25hbF90aW1lb3V0TWVzc2FnZV8gPSBhcmc7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgb3B0aW9uYWxfdGltZW91dF8gPSBhcmc7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICB2YXIgd2FpdHNGb3JGdW5jID0gbmV3IGphc21pbmUuV2FpdHNGb3JCbG9jayh0aGlzLmVudiwgb3B0aW9uYWxfdGltZW91dF8sIGxhdGNoRnVuY3Rpb25fLCBvcHRpb25hbF90aW1lb3V0TWVzc2FnZV8sIHRoaXMpOwogIHRoaXMuYWRkVG9RdWV1ZSh3YWl0c0ZvckZ1bmMpOwogIHJldHVybiB0aGlzOwp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5mYWlsID0gZnVuY3Rpb24gKGUpIHsKICB2YXIgZXhwZWN0YXRpb25SZXN1bHQgPSBuZXcgamFzbWluZS5FeHBlY3RhdGlvblJlc3VsdCh7CiAgICBwYXNzZWQ6IGZhbHNlLAogICAgbWVzc2FnZTogZSA/IGphc21pbmUudXRpbC5mb3JtYXRFeGNlcHRpb24oZSkgOiAnRXhjZXB0aW9uJywKICAgIHRyYWNlOiB7IHN0YWNrOiBlLnN0YWNrIH0KICB9KTsKICB0aGlzLnJlc3VsdHNfLmFkZFJlc3VsdChleHBlY3RhdGlvblJlc3VsdCk7Cn07CgpqYXNtaW5lLlNwZWMucHJvdG90eXBlLmdldE1hdGNoZXJzQ2xhc3NfID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMubWF0Y2hlcnNDbGFzcyB8fCB0aGlzLmVudi5tYXRjaGVyc0NsYXNzOwp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5hZGRNYXRjaGVycyA9IGZ1bmN0aW9uKG1hdGNoZXJzUHJvdG90eXBlKSB7CiAgdmFyIHBhcmVudCA9IHRoaXMuZ2V0TWF0Y2hlcnNDbGFzc18oKTsKICB2YXIgbmV3TWF0Y2hlcnNDbGFzcyA9IGZ1bmN0aW9uKCkgewogICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKICBqYXNtaW5lLnV0aWwuaW5oZXJpdChuZXdNYXRjaGVyc0NsYXNzLCBwYXJlbnQpOwogIGphc21pbmUuTWF0Y2hlcnMud3JhcEludG9fKG1hdGNoZXJzUHJvdG90eXBlLCBuZXdNYXRjaGVyc0NsYXNzKTsKICB0aGlzLm1hdGNoZXJzQ2xhc3MgPSBuZXdNYXRjaGVyc0NsYXNzOwp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5maW5pc2hDYWxsYmFjayA9IGZ1bmN0aW9uKCkgewogIHRoaXMuZW52LnJlcG9ydGVyLnJlcG9ydFNwZWNSZXN1bHRzKHRoaXMpOwp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5maW5pc2ggPSBmdW5jdGlvbihvbkNvbXBsZXRlKSB7CiAgdGhpcy5yZW1vdmVBbGxTcGllcygpOwogIHRoaXMuZmluaXNoQ2FsbGJhY2soKTsKICBpZiAob25Db21wbGV0ZSkgewogICAgb25Db21wbGV0ZSgpOwogIH0KfTsKCmphc21pbmUuU3BlYy5wcm90b3R5cGUuYWZ0ZXIgPSBmdW5jdGlvbihkb0FmdGVyKSB7CiAgaWYgKHRoaXMucXVldWUuaXNSdW5uaW5nKCkpIHsKICAgIHRoaXMucXVldWUuYWRkKG5ldyBqYXNtaW5lLkJsb2NrKHRoaXMuZW52LCBkb0FmdGVyLCB0aGlzKSk7CiAgfSBlbHNlIHsKICAgIHRoaXMuYWZ0ZXJDYWxsYmFja3MudW5zaGlmdChkb0FmdGVyKTsKICB9Cn07CgpqYXNtaW5lLlNwZWMucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbihvbkNvbXBsZXRlKSB7CiAgdmFyIHNwZWMgPSB0aGlzOwogIGlmICghc3BlYy5lbnYuc3BlY0ZpbHRlcihzcGVjKSkgewogICAgc3BlYy5yZXN1bHRzXy5za2lwcGVkID0gdHJ1ZTsKICAgIHNwZWMuZmluaXNoKG9uQ29tcGxldGUpOwogICAgcmV0dXJuOwogIH0KCiAgdGhpcy5lbnYucmVwb3J0ZXIucmVwb3J0U3BlY1N0YXJ0aW5nKHRoaXMpOwoKICBzcGVjLmVudi5jdXJyZW50U3BlYyA9IHNwZWM7CgogIHNwZWMuYWRkQmVmb3Jlc0FuZEFmdGVyc1RvUXVldWUoKTsKCiAgc3BlYy5xdWV1ZS5zdGFydChmdW5jdGlvbiAoKSB7CiAgICBzcGVjLmZpbmlzaChvbkNvbXBsZXRlKTsKICB9KTsKfTsKCmphc21pbmUuU3BlYy5wcm90b3R5cGUuYWRkQmVmb3Jlc0FuZEFmdGVyc1RvUXVldWUgPSBmdW5jdGlvbigpIHsKICB2YXIgcnVubmVyID0gdGhpcy5lbnYuY3VycmVudFJ1bm5lcigpOwogIHZhciBpOwoKICBmb3IgKHZhciBzdWl0ZSA9IHRoaXMuc3VpdGU7IHN1aXRlOyBzdWl0ZSA9IHN1aXRlLnBhcmVudFN1aXRlKSB7CiAgICBmb3IgKGkgPSAwOyBpIDwgc3VpdGUuYmVmb3JlXy5sZW5ndGg7IGkrKykgewogICAgICB0aGlzLnF1ZXVlLmFkZEJlZm9yZShuZXcgamFzbWluZS5CbG9jayh0aGlzLmVudiwgc3VpdGUuYmVmb3JlX1tpXSwgdGhpcykpOwogICAgfQogIH0KICBmb3IgKGkgPSAwOyBpIDwgcnVubmVyLmJlZm9yZV8ubGVuZ3RoOyBpKyspIHsKICAgIHRoaXMucXVldWUuYWRkQmVmb3JlKG5ldyBqYXNtaW5lLkJsb2NrKHRoaXMuZW52LCBydW5uZXIuYmVmb3JlX1tpXSwgdGhpcykpOwogIH0KICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5hZnRlckNhbGxiYWNrcy5sZW5ndGg7IGkrKykgewogICAgdGhpcy5xdWV1ZS5hZGQobmV3IGphc21pbmUuQmxvY2sodGhpcy5lbnYsIHRoaXMuYWZ0ZXJDYWxsYmFja3NbaV0sIHRoaXMpKTsKICB9CiAgZm9yIChzdWl0ZSA9IHRoaXMuc3VpdGU7IHN1aXRlOyBzdWl0ZSA9IHN1aXRlLnBhcmVudFN1aXRlKSB7CiAgICBmb3IgKGkgPSAwOyBpIDwgc3VpdGUuYWZ0ZXJfLmxlbmd0aDsgaSsrKSB7CiAgICAgIHRoaXMucXVldWUuYWRkKG5ldyBqYXNtaW5lLkJsb2NrKHRoaXMuZW52LCBzdWl0ZS5hZnRlcl9baV0sIHRoaXMpKTsKICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHJ1bm5lci5hZnRlcl8ubGVuZ3RoOyBpKyspIHsKICAgIHRoaXMucXVldWUuYWRkKG5ldyBqYXNtaW5lLkJsb2NrKHRoaXMuZW52LCBydW5uZXIuYWZ0ZXJfW2ldLCB0aGlzKSk7CiAgfQp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5leHBsb2RlcyA9IGZ1bmN0aW9uKCkgewogIHRocm93ICdleHBsb2RlcyBmdW5jdGlvbiBzaG91bGQgbm90IGhhdmUgYmVlbiBjYWxsZWQnOwp9OwoKamFzbWluZS5TcGVjLnByb3RvdHlwZS5zcHlPbiA9IGZ1bmN0aW9uKG9iaiwgbWV0aG9kTmFtZSwgaWdub3JlTWV0aG9kRG9lc250RXhpc3QpIHsKICBpZiAob2JqID09IGphc21pbmUudW5kZWZpbmVkKSB7CiAgICB0aHJvdyAic3B5T24gY291bGQgbm90IGZpbmQgYW4gb2JqZWN0IHRvIHNweSB1cG9uIGZvciAiICsgbWV0aG9kTmFtZSArICIoKSI7CiAgfQoKICBpZiAoIWlnbm9yZU1ldGhvZERvZXNudEV4aXN0ICYmIG9ialttZXRob2ROYW1lXSA9PT0gamFzbWluZS51bmRlZmluZWQpIHsKICAgIHRocm93IG1ldGhvZE5hbWUgKyAnKCkgbWV0aG9kIGRvZXMgbm90IGV4aXN0JzsKICB9CgogIGlmICghaWdub3JlTWV0aG9kRG9lc250RXhpc3QgJiYgb2JqW21ldGhvZE5hbWVdICYmIG9ialttZXRob2ROYW1lXS5pc1NweSkgewogICAgdGhyb3cgbmV3IEVycm9yKG1ldGhvZE5hbWUgKyAnIGhhcyBhbHJlYWR5IGJlZW4gc3BpZWQgdXBvbicpOwogIH0KCiAgdmFyIHNweU9iaiA9IGphc21pbmUuY3JlYXRlU3B5KG1ldGhvZE5hbWUpOwoKICB0aGlzLnNwaWVzXy5wdXNoKHNweU9iaik7CiAgc3B5T2JqLmJhc2VPYmogPSBvYmo7CiAgc3B5T2JqLm1ldGhvZE5hbWUgPSBtZXRob2ROYW1lOwogIHNweU9iai5vcmlnaW5hbFZhbHVlID0gb2JqW21ldGhvZE5hbWVdOwoKICBvYmpbbWV0aG9kTmFtZV0gPSBzcHlPYmo7CgogIHJldHVybiBzcHlPYmo7Cn07CgpqYXNtaW5lLlNwZWMucHJvdG90eXBlLnJlbW92ZUFsbFNwaWVzID0gZnVuY3Rpb24oKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNwaWVzXy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNweSA9IHRoaXMuc3BpZXNfW2ldOwogICAgc3B5LmJhc2VPYmpbc3B5Lm1ldGhvZE5hbWVdID0gc3B5Lm9yaWdpbmFsVmFsdWU7CiAgfQogIHRoaXMuc3BpZXNfID0gW107Cn07CgovKioKICogSW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgYSBKYXNtaW5lIHN1aXRlLgogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtqYXNtaW5lLkVudn0gZW52CiAqIEBwYXJhbSB7U3RyaW5nfSBkZXNjcmlwdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzcGVjRGVmaW5pdGlvbnMKICogQHBhcmFtIHtqYXNtaW5lLlN1aXRlfSBwYXJlbnRTdWl0ZQogKi8KamFzbWluZS5TdWl0ZSA9IGZ1bmN0aW9uKGVudiwgZGVzY3JpcHRpb24sIHNwZWNEZWZpbml0aW9ucywgcGFyZW50U3VpdGUpIHsKICB2YXIgc2VsZiA9IHRoaXM7CiAgc2VsZi5pZCA9IGVudi5uZXh0U3VpdGVJZCA/IGVudi5uZXh0U3VpdGVJZCgpIDogbnVsbDsKICBzZWxmLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247CiAgc2VsZi5xdWV1ZSA9IG5ldyBqYXNtaW5lLlF1ZXVlKGVudik7CiAgc2VsZi5wYXJlbnRTdWl0ZSA9IHBhcmVudFN1aXRlOwogIHNlbGYuZW52ID0gZW52OwogIHNlbGYuYmVmb3JlXyA9IFtdOwogIHNlbGYuYWZ0ZXJfID0gW107CiAgc2VsZi5jaGlsZHJlbl8gPSBbXTsKICBzZWxmLnN1aXRlc18gPSBbXTsKICBzZWxmLnNwZWNzXyA9IFtdOwp9OwoKamFzbWluZS5TdWl0ZS5wcm90b3R5cGUuZ2V0RnVsbE5hbWUgPSBmdW5jdGlvbigpIHsKICB2YXIgZnVsbE5hbWUgPSB0aGlzLmRlc2NyaXB0aW9uOwogIGZvciAodmFyIHBhcmVudFN1aXRlID0gdGhpcy5wYXJlbnRTdWl0ZTsgcGFyZW50U3VpdGU7IHBhcmVudFN1aXRlID0gcGFyZW50U3VpdGUucGFyZW50U3VpdGUpIHsKICAgIGZ1bGxOYW1lID0gcGFyZW50U3VpdGUuZGVzY3JpcHRpb24gKyAnICcgKyBmdWxsTmFtZTsKICB9CiAgcmV0dXJuIGZ1bGxOYW1lOwp9OwoKamFzbWluZS5TdWl0ZS5wcm90b3R5cGUuZmluaXNoID0gZnVuY3Rpb24ob25Db21wbGV0ZSkgewogIHRoaXMuZW52LnJlcG9ydGVyLnJlcG9ydFN1aXRlUmVzdWx0cyh0aGlzKTsKICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTsKICBpZiAodHlwZW9mKG9uQ29tcGxldGUpID09ICdmdW5jdGlvbicpIHsKICAgIG9uQ29tcGxldGUoKTsKICB9Cn07CgpqYXNtaW5lLlN1aXRlLnByb3RvdHlwZS5iZWZvcmVFYWNoID0gZnVuY3Rpb24oYmVmb3JlRWFjaEZ1bmN0aW9uKSB7CiAgYmVmb3JlRWFjaEZ1bmN0aW9uLnR5cGVOYW1lID0gJ2JlZm9yZUVhY2gnOwogIHRoaXMuYmVmb3JlXy51bnNoaWZ0KGJlZm9yZUVhY2hGdW5jdGlvbik7Cn07CgpqYXNtaW5lLlN1aXRlLnByb3RvdHlwZS5hZnRlckVhY2ggPSBmdW5jdGlvbihhZnRlckVhY2hGdW5jdGlvbikgewogIGFmdGVyRWFjaEZ1bmN0aW9uLnR5cGVOYW1lID0gJ2FmdGVyRWFjaCc7CiAgdGhpcy5hZnRlcl8udW5zaGlmdChhZnRlckVhY2hGdW5jdGlvbik7Cn07CgpqYXNtaW5lLlN1aXRlLnByb3RvdHlwZS5yZXN1bHRzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMucXVldWUucmVzdWx0cygpOwp9OwoKamFzbWluZS5TdWl0ZS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oc3VpdGVPclNwZWMpIHsKICB0aGlzLmNoaWxkcmVuXy5wdXNoKHN1aXRlT3JTcGVjKTsKICBpZiAoc3VpdGVPclNwZWMgaW5zdGFuY2VvZiBqYXNtaW5lLlN1aXRlKSB7CiAgICB0aGlzLnN1aXRlc18ucHVzaChzdWl0ZU9yU3BlYyk7CiAgICB0aGlzLmVudi5jdXJyZW50UnVubmVyKCkuYWRkU3VpdGUoc3VpdGVPclNwZWMpOwogIH0gZWxzZSB7CiAgICB0aGlzLnNwZWNzXy5wdXNoKHN1aXRlT3JTcGVjKTsKICB9CiAgdGhpcy5xdWV1ZS5hZGQoc3VpdGVPclNwZWMpOwp9OwoKamFzbWluZS5TdWl0ZS5wcm90b3R5cGUuc3BlY3MgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5zcGVjc187Cn07CgpqYXNtaW5lLlN1aXRlLnByb3RvdHlwZS5zdWl0ZXMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5zdWl0ZXNfOwp9OwoKamFzbWluZS5TdWl0ZS5wcm90b3R5cGUuY2hpbGRyZW4gPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5jaGlsZHJlbl87Cn07CgpqYXNtaW5lLlN1aXRlLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24ob25Db21wbGV0ZSkgewogIHZhciBzZWxmID0gdGhpczsKICB0aGlzLnF1ZXVlLnN0YXJ0KGZ1bmN0aW9uICgpIHsKICAgIHNlbGYuZmluaXNoKG9uQ29tcGxldGUpOwogIH0pOwp9OwpqYXNtaW5lLldhaXRzQmxvY2sgPSBmdW5jdGlvbihlbnYsIHRpbWVvdXQsIHNwZWMpIHsKICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0OwogIGphc21pbmUuQmxvY2suY2FsbCh0aGlzLCBlbnYsIG51bGwsIHNwZWMpOwp9OwoKamFzbWluZS51dGlsLmluaGVyaXQoamFzbWluZS5XYWl0c0Jsb2NrLCBqYXNtaW5lLkJsb2NrKTsKCmphc21pbmUuV2FpdHNCbG9jay5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIChvbkNvbXBsZXRlKSB7CiAgaWYgKGphc21pbmUuVkVSQk9TRSkgewogICAgdGhpcy5lbnYucmVwb3J0ZXIubG9nKCc+PiBKYXNtaW5lIHdhaXRpbmcgZm9yICcgKyB0aGlzLnRpbWVvdXQgKyAnIG1zLi4uJyk7CiAgfQogIHRoaXMuZW52LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgb25Db21wbGV0ZSgpOwogIH0sIHRoaXMudGltZW91dCk7Cn07Ci8qKgogKiBBIGJsb2NrIHdoaWNoIHdhaXRzIGZvciBzb21lIGNvbmRpdGlvbiB0byBiZWNvbWUgdHJ1ZSwgd2l0aCB0aW1lb3V0LgogKgogKiBAY29uc3RydWN0b3IKICogQGV4dGVuZHMgamFzbWluZS5CbG9jawogKiBAcGFyYW0ge2phc21pbmUuRW52fSBlbnYgVGhlIEphc21pbmUgZW52aXJvbm1lbnQuCiAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0IFRoZSBtYXhpbXVtIHRpbWUgaW4gbWlsbGlzZWNvbmRzIHRvIHdhaXQgZm9yIHRoZSBjb25kaXRpb24gdG8gYmVjb21lIHRydWUuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGxhdGNoRnVuY3Rpb24gQSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIHRydWUgd2hlbiB0aGUgZGVzaXJlZCBjb25kaXRpb24gaGFzIGJlZW4gbWV0LgogKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBkaXNwbGF5IGlmIHRoZSBkZXNpcmVkIGNvbmRpdGlvbiBoYXNuJ3QgYmVlbiBtZXQgd2l0aGluIHRoZSBnaXZlbiB0aW1lIHBlcmlvZC4KICogQHBhcmFtIHtqYXNtaW5lLlNwZWN9IHNwZWMgVGhlIEphc21pbmUgc3BlYy4KICovCmphc21pbmUuV2FpdHNGb3JCbG9jayA9IGZ1bmN0aW9uKGVudiwgdGltZW91dCwgbGF0Y2hGdW5jdGlvbiwgbWVzc2FnZSwgc3BlYykgewogIHRoaXMudGltZW91dCA9IHRpbWVvdXQgfHwgZW52LmRlZmF1bHRUaW1lb3V0SW50ZXJ2YWw7CiAgdGhpcy5sYXRjaEZ1bmN0aW9uID0gbGF0Y2hGdW5jdGlvbjsKICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogIHRoaXMudG90YWxUaW1lU3BlbnRXYWl0aW5nRm9yTGF0Y2ggPSAwOwogIGphc21pbmUuQmxvY2suY2FsbCh0aGlzLCBlbnYsIG51bGwsIHNwZWMpOwp9OwpqYXNtaW5lLnV0aWwuaW5oZXJpdChqYXNtaW5lLldhaXRzRm9yQmxvY2ssIGphc21pbmUuQmxvY2spOwoKamFzbWluZS5XYWl0c0ZvckJsb2NrLlRJTUVPVVRfSU5DUkVNRU5UID0gMTA7CgpqYXNtaW5lLldhaXRzRm9yQmxvY2sucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbihvbkNvbXBsZXRlKSB7CiAgaWYgKGphc21pbmUuVkVSQk9TRSkgewogICAgdGhpcy5lbnYucmVwb3J0ZXIubG9nKCc+PiBKYXNtaW5lIHdhaXRpbmcgZm9yICcgKyAodGhpcy5tZXNzYWdlIHx8ICdzb21ldGhpbmcgdG8gaGFwcGVuJykpOwogIH0KICB2YXIgbGF0Y2hGdW5jdGlvblJlc3VsdDsKICB0cnkgewogICAgbGF0Y2hGdW5jdGlvblJlc3VsdCA9IHRoaXMubGF0Y2hGdW5jdGlvbi5hcHBseSh0aGlzLnNwZWMpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHRoaXMuc3BlYy5mYWlsKGUpOwogICAgb25Db21wbGV0ZSgpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGxhdGNoRnVuY3Rpb25SZXN1bHQpIHsKICAgIG9uQ29tcGxldGUoKTsKICB9IGVsc2UgaWYgKHRoaXMudG90YWxUaW1lU3BlbnRXYWl0aW5nRm9yTGF0Y2ggPj0gdGhpcy50aW1lb3V0KSB7CiAgICB2YXIgbWVzc2FnZSA9ICd0aW1lZCBvdXQgYWZ0ZXIgJyArIHRoaXMudGltZW91dCArICcgbXNlYyB3YWl0aW5nIGZvciAnICsgKHRoaXMubWVzc2FnZSB8fCAnc29tZXRoaW5nIHRvIGhhcHBlbicpOwogICAgdGhpcy5zcGVjLmZhaWwoewogICAgICBuYW1lOiAndGltZW91dCcsCiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UKICAgIH0pOwoKICAgIHRoaXMuYWJvcnQgPSB0cnVlOwogICAgb25Db21wbGV0ZSgpOwogIH0gZWxzZSB7CiAgICB0aGlzLnRvdGFsVGltZVNwZW50V2FpdGluZ0ZvckxhdGNoICs9IGphc21pbmUuV2FpdHNGb3JCbG9jay5USU1FT1VUX0lOQ1JFTUVOVDsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuZW52LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYuZXhlY3V0ZShvbkNvbXBsZXRlKTsKICAgIH0sIGphc21pbmUuV2FpdHNGb3JCbG9jay5USU1FT1VUX0lOQ1JFTUVOVCk7CiAgfQp9OwovLyBNb2NrIHNldFRpbWVvdXQsIGNsZWFyVGltZW91dAovLyBDb250cmlidXRlZCBieSBQaXZvdGFsIENvbXB1dGVyIFN5c3RlbXMsIHd3dy5waXZvdGFsc2YuY29tCgpqYXNtaW5lLkZha2VUaW1lciA9IGZ1bmN0aW9uKCkgewogIHRoaXMucmVzZXQoKTsKCiAgdmFyIHNlbGYgPSB0aGlzOwogIHNlbGYuc2V0VGltZW91dCA9IGZ1bmN0aW9uKGZ1bmNUb0NhbGwsIG1pbGxpcykgewogICAgc2VsZi50aW1lb3V0c01hZGUrKzsKICAgIHNlbGYuc2NoZWR1bGVGdW5jdGlvbihzZWxmLnRpbWVvdXRzTWFkZSwgZnVuY1RvQ2FsbCwgbWlsbGlzLCBmYWxzZSk7CiAgICByZXR1cm4gc2VsZi50aW1lb3V0c01hZGU7CiAgfTsKCiAgc2VsZi5zZXRJbnRlcnZhbCA9IGZ1bmN0aW9uKGZ1bmNUb0NhbGwsIG1pbGxpcykgewogICAgc2VsZi50aW1lb3V0c01hZGUrKzsKICAgIHNlbGYuc2NoZWR1bGVGdW5jdGlvbihzZWxmLnRpbWVvdXRzTWFkZSwgZnVuY1RvQ2FsbCwgbWlsbGlzLCB0cnVlKTsKICAgIHJldHVybiBzZWxmLnRpbWVvdXRzTWFkZTsKICB9OwoKICBzZWxmLmNsZWFyVGltZW91dCA9IGZ1bmN0aW9uKHRpbWVvdXRLZXkpIHsKICAgIHNlbGYuc2NoZWR1bGVkRnVuY3Rpb25zW3RpbWVvdXRLZXldID0gamFzbWluZS51bmRlZmluZWQ7CiAgfTsKCiAgc2VsZi5jbGVhckludGVydmFsID0gZnVuY3Rpb24odGltZW91dEtleSkgewogICAgc2VsZi5zY2hlZHVsZWRGdW5jdGlvbnNbdGltZW91dEtleV0gPSBqYXNtaW5lLnVuZGVmaW5lZDsKICB9OwoKfTsKCmphc21pbmUuRmFrZVRpbWVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgewogIHRoaXMudGltZW91dHNNYWRlID0gMDsKICB0aGlzLnNjaGVkdWxlZEZ1bmN0aW9ucyA9IHt9OwogIHRoaXMubm93TWlsbGlzID0gMDsKfTsKCmphc21pbmUuRmFrZVRpbWVyLnByb3RvdHlwZS50aWNrID0gZnVuY3Rpb24obWlsbGlzKSB7CiAgdmFyIG9sZE1pbGxpcyA9IHRoaXMubm93TWlsbGlzOwogIHZhciBuZXdNaWxsaXMgPSBvbGRNaWxsaXMgKyBtaWxsaXM7CiAgdGhpcy5ydW5GdW5jdGlvbnNXaXRoaW5SYW5nZShvbGRNaWxsaXMsIG5ld01pbGxpcyk7CiAgdGhpcy5ub3dNaWxsaXMgPSBuZXdNaWxsaXM7Cn07CgpqYXNtaW5lLkZha2VUaW1lci5wcm90b3R5cGUucnVuRnVuY3Rpb25zV2l0aGluUmFuZ2UgPSBmdW5jdGlvbihvbGRNaWxsaXMsIG5vd01pbGxpcykgewogIHZhciBzY2hlZHVsZWRGdW5jOwogIHZhciBmdW5jc1RvUnVuID0gW107CiAgZm9yICh2YXIgdGltZW91dEtleSBpbiB0aGlzLnNjaGVkdWxlZEZ1bmN0aW9ucykgewogICAgc2NoZWR1bGVkRnVuYyA9IHRoaXMuc2NoZWR1bGVkRnVuY3Rpb25zW3RpbWVvdXRLZXldOwogICAgaWYgKHNjaGVkdWxlZEZ1bmMgIT0gamFzbWluZS51bmRlZmluZWQgJiYKICAgICAgICBzY2hlZHVsZWRGdW5jLnJ1bkF0TWlsbGlzID49IG9sZE1pbGxpcyAmJgogICAgICAgIHNjaGVkdWxlZEZ1bmMucnVuQXRNaWxsaXMgPD0gbm93TWlsbGlzKSB7CiAgICAgIGZ1bmNzVG9SdW4ucHVzaChzY2hlZHVsZWRGdW5jKTsKICAgICAgdGhpcy5zY2hlZHVsZWRGdW5jdGlvbnNbdGltZW91dEtleV0gPSBqYXNtaW5lLnVuZGVmaW5lZDsKICAgIH0KICB9CgogIGlmIChmdW5jc1RvUnVuLmxlbmd0aCA+IDApIHsKICAgIGZ1bmNzVG9SdW4uc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBhLnJ1bkF0TWlsbGlzIC0gYi5ydW5BdE1pbGxpczsKICAgIH0pOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmdW5jc1RvUnVuLmxlbmd0aDsgKytpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGZ1bmNUb1J1biA9IGZ1bmNzVG9SdW5baV07CiAgICAgICAgdGhpcy5ub3dNaWxsaXMgPSBmdW5jVG9SdW4ucnVuQXRNaWxsaXM7CiAgICAgICAgZnVuY1RvUnVuLmZ1bmNUb0NhbGwoKTsKICAgICAgICBpZiAoZnVuY1RvUnVuLnJlY3VycmluZykgewogICAgICAgICAgdGhpcy5zY2hlZHVsZUZ1bmN0aW9uKGZ1bmNUb1J1bi50aW1lb3V0S2V5LAogICAgICAgICAgICAgIGZ1bmNUb1J1bi5mdW5jVG9DYWxsLAogICAgICAgICAgICAgIGZ1bmNUb1J1bi5taWxsaXMsCiAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoKGUpIHsKICAgICAgfQogICAgfQogICAgdGhpcy5ydW5GdW5jdGlvbnNXaXRoaW5SYW5nZShvbGRNaWxsaXMsIG5vd01pbGxpcyk7CiAgfQp9OwoKamFzbWluZS5GYWtlVGltZXIucHJvdG90eXBlLnNjaGVkdWxlRnVuY3Rpb24gPSBmdW5jdGlvbih0aW1lb3V0S2V5LCBmdW5jVG9DYWxsLCBtaWxsaXMsIHJlY3VycmluZykgewogIHRoaXMuc2NoZWR1bGVkRnVuY3Rpb25zW3RpbWVvdXRLZXldID0gewogICAgcnVuQXRNaWxsaXM6IHRoaXMubm93TWlsbGlzICsgbWlsbGlzLAogICAgZnVuY1RvQ2FsbDogZnVuY1RvQ2FsbCwKICAgIHJlY3VycmluZzogcmVjdXJyaW5nLAogICAgdGltZW91dEtleTogdGltZW91dEtleSwKICAgIG1pbGxpczogbWlsbGlzCiAgfTsKfTsKCi8qKgogKiBAbmFtZXNwYWNlCiAqLwpqYXNtaW5lLkNsb2NrID0gewogIGRlZmF1bHRGYWtlVGltZXI6IG5ldyBqYXNtaW5lLkZha2VUaW1lcigpLAoKICByZXNldDogZnVuY3Rpb24oKSB7CiAgICBqYXNtaW5lLkNsb2NrLmFzc2VydEluc3RhbGxlZCgpOwogICAgamFzbWluZS5DbG9jay5kZWZhdWx0RmFrZVRpbWVyLnJlc2V0KCk7CiAgfSwKCiAgdGljazogZnVuY3Rpb24obWlsbGlzKSB7CiAgICBqYXNtaW5lLkNsb2NrLmFzc2VydEluc3RhbGxlZCgpOwogICAgamFzbWluZS5DbG9jay5kZWZhdWx0RmFrZVRpbWVyLnRpY2sobWlsbGlzKTsKICB9LAoKICBydW5GdW5jdGlvbnNXaXRoaW5SYW5nZTogZnVuY3Rpb24ob2xkTWlsbGlzLCBub3dNaWxsaXMpIHsKICAgIGphc21pbmUuQ2xvY2suZGVmYXVsdEZha2VUaW1lci5ydW5GdW5jdGlvbnNXaXRoaW5SYW5nZShvbGRNaWxsaXMsIG5vd01pbGxpcyk7CiAgfSwKCiAgc2NoZWR1bGVGdW5jdGlvbjogZnVuY3Rpb24odGltZW91dEtleSwgZnVuY1RvQ2FsbCwgbWlsbGlzLCByZWN1cnJpbmcpIHsKICAgIGphc21pbmUuQ2xvY2suZGVmYXVsdEZha2VUaW1lci5zY2hlZHVsZUZ1bmN0aW9uKHRpbWVvdXRLZXksIGZ1bmNUb0NhbGwsIG1pbGxpcywgcmVjdXJyaW5nKTsKICB9LAoKICB1c2VNb2NrOiBmdW5jdGlvbigpIHsKICAgIGlmICghamFzbWluZS5DbG9jay5pc0luc3RhbGxlZCgpKSB7CiAgICAgIHZhciBzcGVjID0gamFzbWluZS5nZXRFbnYoKS5jdXJyZW50U3BlYzsKICAgICAgc3BlYy5hZnRlcihqYXNtaW5lLkNsb2NrLnVuaW5zdGFsbE1vY2spOwoKICAgICAgamFzbWluZS5DbG9jay5pbnN0YWxsTW9jaygpOwogICAgfQogIH0sCgogIGluc3RhbGxNb2NrOiBmdW5jdGlvbigpIHsKICAgIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkID0gamFzbWluZS5DbG9jay5kZWZhdWx0RmFrZVRpbWVyOwogIH0sCgogIHVuaW5zdGFsbE1vY2s6IGZ1bmN0aW9uKCkgewogICAgamFzbWluZS5DbG9jay5hc3NlcnRJbnN0YWxsZWQoKTsKICAgIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkID0gamFzbWluZS5DbG9jay5yZWFsOwogIH0sCgogIHJlYWw6IHsKICAgIHNldFRpbWVvdXQ6IGphc21pbmUuZ2V0R2xvYmFsKCkuc2V0VGltZW91dCwKICAgIGNsZWFyVGltZW91dDogamFzbWluZS5nZXRHbG9iYWwoKS5jbGVhclRpbWVvdXQsCiAgICBzZXRJbnRlcnZhbDogamFzbWluZS5nZXRHbG9iYWwoKS5zZXRJbnRlcnZhbCwKICAgIGNsZWFySW50ZXJ2YWw6IGphc21pbmUuZ2V0R2xvYmFsKCkuY2xlYXJJbnRlcnZhbAogIH0sCgogIGFzc2VydEluc3RhbGxlZDogZnVuY3Rpb24oKSB7CiAgICBpZiAoIWphc21pbmUuQ2xvY2suaXNJbnN0YWxsZWQoKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk1vY2sgY2xvY2sgaXMgbm90IGluc3RhbGxlZCwgdXNlIGphc21pbmUuQ2xvY2sudXNlTW9jaygpIik7CiAgICB9CiAgfSwKCiAgaXNJbnN0YWxsZWQ6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkID09IGphc21pbmUuQ2xvY2suZGVmYXVsdEZha2VUaW1lcjsKICB9LAoKICBpbnN0YWxsZWQ6IG51bGwKfTsKamFzbWluZS5DbG9jay5pbnN0YWxsZWQgPSBqYXNtaW5lLkNsb2NrLnJlYWw7CgovL2Vsc2UgZm9yIElFIHN1cHBvcnQKamFzbWluZS5nZXRHbG9iYWwoKS5zZXRUaW1lb3V0ID0gZnVuY3Rpb24oZnVuY1RvQ2FsbCwgbWlsbGlzKSB7CiAgaWYgKGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLnNldFRpbWVvdXQuYXBwbHkpIHsKICAgIHJldHVybiBqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5zZXRUaW1lb3V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5zZXRUaW1lb3V0KGZ1bmNUb0NhbGwsIG1pbGxpcyk7CiAgfQp9OwoKamFzbWluZS5nZXRHbG9iYWwoKS5zZXRJbnRlcnZhbCA9IGZ1bmN0aW9uKGZ1bmNUb0NhbGwsIG1pbGxpcykgewogIGlmIChqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5zZXRJbnRlcnZhbC5hcHBseSkgewogICAgcmV0dXJuIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLnNldEludGVydmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5zZXRJbnRlcnZhbChmdW5jVG9DYWxsLCBtaWxsaXMpOwogIH0KfTsKCmphc21pbmUuZ2V0R2xvYmFsKCkuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24odGltZW91dEtleSkgewogIGlmIChqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5jbGVhclRpbWVvdXQuYXBwbHkpIHsKICAgIHJldHVybiBqYXNtaW5lLkNsb2NrLmluc3RhbGxlZC5jbGVhclRpbWVvdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9IGVsc2UgewogICAgcmV0dXJuIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLmNsZWFyVGltZW91dCh0aW1lb3V0S2V5KTsKICB9Cn07CgpqYXNtaW5lLmdldEdsb2JhbCgpLmNsZWFySW50ZXJ2YWwgPSBmdW5jdGlvbih0aW1lb3V0S2V5KSB7CiAgaWYgKGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLmNsZWFyVGltZW91dC5hcHBseSkgewogICAgcmV0dXJuIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLmNsZWFySW50ZXJ2YWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9IGVsc2UgewogICAgcmV0dXJuIGphc21pbmUuQ2xvY2suaW5zdGFsbGVkLmNsZWFySW50ZXJ2YWwodGltZW91dEtleSk7CiAgfQp9OwoKamFzbWluZS52ZXJzaW9uXz0gewogICJtYWpvciI6IDEsCiAgIm1pbm9yIjogMSwKICAiYnVpbGQiOiAwLAogICJyZXZpc2lvbiI6IDEzMTU2NzcwNTgKfTsK", "content_type": "application/javascript"}, "grunt.js": {"data": "Ly8gVGhpcyBpcyB0aGUgbWFpbiBhcHBsaWNhdGlvbiBjb25maWd1cmF0aW9uIGZpbGUuICBJdCBpcyBhIEdydW50Ci8vIGNvbmZpZ3VyYXRpb24gZmlsZSwgd2hpY2ggeW91IGNhbiBsZWFybiBtb3JlIGFib3V0IGhlcmU6Ci8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jb3dib3kvZ3J1bnQvYmxvYi9tYXN0ZXIvZG9jcy9jb25maWd1cmluZy5tZAovLwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdydW50KSB7CgogIGdydW50LmluaXRDb25maWcoewoKICAgIC8vIFRoZSBjbGVhbiB0YXNrIGVuc3VyZXMgYWxsIGZpbGVzIGFyZSByZW1vdmVkIGZyb20gdGhlIGRpc3QvIGRpcmVjdG9yeSBzbwogICAgLy8gdGhhdCBubyBmaWxlcyBsaW5nZXIgZnJvbSBwcmV2aW91cyBidWlsZHMuCiAgICBjbGVhbjogWyJkaXN0LyJdLAoKICAgIC8vIFRoZSBsaW50IHRhc2sgd2lsbCBydW4gdGhlIGJ1aWxkIGNvbmZpZ3VyYXRpb24gYW5kIHRoZSBhcHBsaWNhdGlvbgogICAgLy8gSmF2YVNjcmlwdCB0aHJvdWdoIEpTSGludCBhbmQgcmVwb3J0IGFueSBlcnJvcnMuICBZb3UgY2FuIGNoYW5nZSB0aGUKICAgIC8vIG9wdGlvbnMgZm9yIHRoaXMgdGFzaywgYnkgcmVhZGluZyB0aGlzOgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Nvd2JveS9ncnVudC9ibG9iL21hc3Rlci9kb2NzL3Rhc2tfbGludC5tZAogICAgbGludDogewogICAgICBmaWxlczogWwogICAgICAgICJidWlsZC9jb25maWcuanMiLCAiYXBwLyoqLyouanMiCiAgICAgIF0KICAgIH0sCgogICAgLy8gVGhlIGpzaGludCBvcHRpb24gZm9yIHNjcmlwdHVybCBpcyBzZXQgdG8gbGF4LCBiZWNhdXNlIHRoZSBhbmNob3IKICAgIC8vIG92ZXJyaWRlIGluc2lkZSBtYWluLmpzIG5lZWRzIHRvIHRlc3QgZm9yIHRoZW0gc28gYXMgdG8gbm90IGFjY2lkZW50YWxseQogICAgLy8gcm91dGUuCiAgICBqc2hpbnQ6IHsKICAgICAgb3B0aW9uczogewogICAgICAgIHNjcmlwdHVybDogdHJ1ZQogICAgICB9CiAgICB9LAoKICAgIC8vIFRoZSBqc3QgdGFzayBjb21waWxlcyBhbGwgYXBwbGljYXRpb24gdGVtcGxhdGVzIGludG8gSmF2YVNjcmlwdAogICAgLy8gZnVuY3Rpb25zIHdpdGggdGhlIHVuZGVyc2NvcmUuanMgdGVtcGxhdGUgZnVuY3Rpb24gZnJvbSAxLjIuNC4gIFlvdSBjYW4KICAgIC8vIGNoYW5nZSB0aGUgbmFtZXNwYWNlIGFuZCB0aGUgdGVtcGxhdGUgb3B0aW9ucywgYnkgcmVhZGluZyB0aGlzOgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3RicmFueWVuL2J1aWxkLXRhc2tzL3RyZWUvbWFzdGVyL2pzdAogICAgLy8KICAgIC8vIFRoZSBjb25jYXQgdGFzayBkZXBlbmRzIG9uIHRoaXMgZmlsZSB0byBleGlzdCwgc28gaWYgeW91IGRlY2lkZSB0bwogICAgLy8gcmVtb3ZlIHRoaXMsIGVuc3VyZSBjb25jYXQgaXMgdXBkYXRlZCBhY2NvcmRpbmdseS4KICAgIGpzdDogewogICAgICAiZGlzdC9kZWJ1Zy90ZW1wbGF0ZXMuanMiOiBbCiAgICAgICAgImFwcC90ZW1wbGF0ZXMvKiovKi5odG1sIgogICAgICBdCiAgICB9LAoKICAgIC8vIFRoZSBjb25jYXRlbmF0ZSB0YXNrIGlzIHVzZWQgaGVyZSB0byBtZXJnZSB0aGUgYWxtb25kIHJlcXVpcmUvZGVmaW5lCiAgICAvLyBzaGltIGFuZCB0aGUgdGVtcGxhdGVzIGludG8gdGhlIGFwcGxpY2F0aW9uIGNvZGUuICBJdCdzIG5hbWVkCiAgICAvLyBkaXN0L2RlYnVnL3JlcXVpcmUuanMsIGJlY2F1c2Ugd2Ugd2FudCB0byBvbmx5IGxvYWQgb25lIHNjcmlwdCBmaWxlIGluCiAgICAvLyBpbmRleC5odG1sLgogICAgY29uY2F0OiB7CiAgICAgICJkaXN0L2RlYnVnL3JlcXVpcmUuanMiOiBbCiAgICAgICAgImFzc2V0cy9qcy9saWJzL2FsbW9uZC5qcyIsCiAgICAgICAgImRpc3QvZGVidWcvdGVtcGxhdGVzLmpzIiwKICAgICAgICAiZGlzdC9kZWJ1Zy9yZXF1aXJlLmpzIgogICAgICBdCiAgICB9LAoKICAgIC8vIFRoaXMgdGFzayB1c2VzIHRoZSBNaW5DU1MgTm9kZS5qcyBwcm9qZWN0IHRvIHRha2UgYWxsIHlvdXIgQ1NTIGZpbGVzIGluCiAgICAvLyBvcmRlciBhbmQgY29uY2F0ZW5hdGUgdGhlbSBpbnRvIGEgc2luZ2xlIENTUyBmaWxlIG5hbWVkIGluZGV4LmNzcy4gIEl0CiAgICAvLyBhbHNvIG1pbmlmaWVzIGFsbCB0aGUgQ1NTIGFzIHdlbGwuICBUaGlzIGlzIG5hbWVkIGluZGV4LmNzcywgYmVjYXVzZSB3ZQogICAgLy8gb25seSB3YW50IHRvIGxvYWQgb25lIHN0eWxlc2hlZXQgaW4gaW5kZXguaHRtbC4KICAgIG1pbmNzczogewogICAgICAiZGlzdC9yZWxlYXNlL2luZGV4LmNzcyI6IFsKICAgICAgICAiYXNzZXRzL2Nzcy9zdHlsZS5jc3MiCiAgICAgIF0KICAgIH0sCgogICAgLy8gVGFrZXMgdGhlIGJ1aWx0IHJlcXVpcmUuanMgZmlsZSBhbmQgbWluaWZpZXMgaXQgZm9yIGZpbGVzaXplIGJlbmVmaXRzLgogICAgbWluOiB7CiAgICAgICJkaXN0L3JlbGVhc2UvcmVxdWlyZS5qcyI6IFsKICAgICAgICAiZGlzdC9kZWJ1Zy9yZXF1aXJlLmpzIgogICAgICBdCiAgICB9LAoKICAgIC8vIFJ1bm5pbmcgdGhlIHNlcnZlciB3aXRob3V0IHNwZWNpZnlpbmcgYW4gYWN0aW9uIHdpbGwgcnVuIHRoZSBkZWZhdWx0cywKICAgIC8vIHBvcnQ6IDgwODAgYW5kIGhvc3Q6IDEyNy4wLjAuMS4gIElmIHlvdSB3b3VsZCBsaWtlIHRvIGNoYW5nZSB0aGVzZQogICAgLy8gZGVmYXVsdHMsIHNpbXBseSBhZGQgaW4gdGhlIHByb3BlcnRpZXMgYHBvcnRgIGFuZCBgaG9zdGAgcmVzcGVjdGl2ZWx5LgogICAgLy8KICAgIC8vIENoYW5naW5nIHRoZSBkZWZhdWx0cyBtaWdodCBsb29rIHNvbWV0aGluZyBsaWtlIHRoaXM6CiAgICAvLwogICAgLy8gc2VydmVyOiB7CiAgICAvLyAgIGhvc3Q6ICIxMjcuMC4wLjEiLCBwb3J0OiA5MDAxCiAgICAvLyAgIGRlYnVnOiB7IC4uLiBjYW4gc2V0IGhvc3QgYW5kIHBvcnQgaGVyZSB0b28gLi4uCiAgICAvLyAgfQogICAgLy8KICAgIC8vICBUbyBsZWFybiBtb3JlIGFib3V0IHVzaW5nIHRoZSBzZXJ2ZXIgdGFzaywgcGxlYXNlIHJlZmVyIHRvIHRoZSBjb2RlCiAgICAvLyAgdW50aWwgZG9jdW1lbnRhdGlvbiBoYXMgYmVlbiB3cml0dGVuLgogICAgc2VydmVyOiB7CiAgICAgIGZpbGVzOiB7ICJmYXZpY29uLmljbyI6ICJmYXZpY29uLmljbyIgfSwKCiAgICAgIGRlYnVnOiB7CiAgICAgICAgZmlsZXM6IHsgImZhdmljb24uaWNvIjogImZhdmljb24uaWNvIiB9LAoKICAgICAgICBmb2xkZXJzOiB7CiAgICAgICAgICAiYXBwIjogImRpc3QvZGVidWciLAogICAgICAgICAgImFzc2V0cy9qcy9saWJzIjogImRpc3QvZGVidWciCiAgICAgICAgfQogICAgICB9LAoKICAgICAgcmVsZWFzZTogewogICAgICAgIC8vIFRoZXNlIHR3byBvcHRpb25zIG1ha2UgaXQgZWFzaWVyIGZvciBkZXBsb3lpbmcsIGJ5IHVzaW5nIHdoYXRldmVyCiAgICAgICAgLy8gUE9SVCBpcyBhdmFpbGFibGUgaW4gdGhlIGVudmlyb25tZW50IGFuZCBkZWZhdWx0aW5nIHRvIGFueSBJUC4KICAgICAgICBob3N0OiAiMC4wLjAuMCIsCiAgICAgICAgcG9ydDogcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDAwLAoKICAgICAgICBmaWxlczogeyAiZmF2aWNvbi5pY28iOiAiZmF2aWNvbi5pY28iIH0sCgogICAgICAgIGZvbGRlcnM6IHsKICAgICAgICAgICJhcHAiOiAiZGlzdC9yZWxlYXNlIiwKICAgICAgICAgICJhc3NldHMvanMvbGlicyI6ICJkaXN0L3JlbGVhc2UiLAogICAgICAgICAgImFzc2V0cy9jc3MiOiAiZGlzdC9yZWxlYXNlIgogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvLyBUaGlzIHRhc2sgdXNlcyBKYW1lcyBCdXJrZSdzIGV4Y2VsbGVudCByLmpzIEFNRCBidWlsZCB0b29sLiAgSW4gdGhlCiAgICAvLyBmdXR1cmUgb3RoZXIgYnVpbGRlcnMgbWF5IGJlIGNvbnRyaWJ1dGVkIGFzIGRyb3AtaW4gYWx0ZXJuYXRpdmVzLgogICAgcmVxdWlyZWpzOiB7CiAgICAgIC8vIEluY2x1ZGUgdGhlIG1haW4gY29uZmlndXJhdGlvbiBmaWxlCiAgICAgIG1haW5Db25maWdGaWxlOiAiYXBwL2NvbmZpZy5qcyIsCgogICAgICAvLyBPdXRwdXQgZmlsZQogICAgICBvdXQ6ICJkaXN0L2RlYnVnL3JlcXVpcmUuanMiLAoKICAgICAgLy8gUm9vdCBhcHBsaWNhdGlvbiBtb2R1bGUKICAgICAgbmFtZTogImNvbmZpZyIsCgogICAgICAvLyBEbyBub3Qgd3JhcCBldmVyeXRoaW5nIGluIGFuIElJRkUKICAgICAgd3JhcDogZmFsc2UKICAgIH0KCiAgfSk7CgogIC8vIFRoZSBkZWZhdWx0IHRhc2sgd2lsbCByZW1vdmUgYWxsIGNvbnRlbnRzIGluc2lkZSB0aGUgZGlzdC8gZm9sZGVyLCBsaW50CiAgLy8gYWxsIHlvdXIgY29kZSwgcHJlY29tcGlsZSBhbGwgdGhlIHVuZGVyc2NvcmUgdGVtcGxhdGVzIGludG8KICAvLyBkaXN0L2RlYnVnL3RlbXBsYXRlcy5qcywgY29tcGlsZSBhbGwgdGhlIGFwcGxpY2F0aW9uIGNvZGUgaW50bwogIC8vIGRpc3QvZGVidWcvcmVxdWlyZS5qcywgYW5kIHRoZW4gY29uY2F0ZW5hdGUgdGhlIHJlcXVpcmUvZGVmaW5lIHNoaW0KICAvLyBhbG1vbmQuanMgYW5kIGRpc3QvZGVidWcvdGVtcGxhdGVzLmpzIGludG8gdGhlIHJlcXVpcmUuanMgZmlsZS4KICBncnVudC5yZWdpc3RlclRhc2soImRlZmF1bHQiLCAiY2xlYW4gbGludCBqc3QgcmVxdWlyZWpzIGNvbmNhdCIpOwoKICAvLyBUaGUgZGVidWcgdGFzayBpcyBzaW1wbHkgYW4gYWxpYXMgdG8gZGVmYXVsdCB0byByZW1haW4gY29uc2lzdGVudCB3aXRoCiAgLy8gZGVidWcvcmVsZWFzZS4KICBncnVudC5yZWdpc3RlclRhc2soImRlYnVnIiwgImRlZmF1bHQiKTsKCiAgLy8gVGhlIHJlbGVhc2UgdGFzayB3aWxsIHJ1biB0aGUgZGVidWcgdGFza3MgYW5kIHRoZW4gbWluaWZ5IHRoZQogIC8vIGRpc3QvZGVidWcvcmVxdWlyZS5qcyBmaWxlIGFuZCBDU1MgZmlsZXMuCiAgZ3J1bnQucmVnaXN0ZXJUYXNrKCJyZWxlYXNlIiwgImRlZmF1bHQgbWluIG1pbmNzcyIpOwoKfTsK", "content_type": "application/javascript"}, "assets/img/backbone.png": {"data": "iVBORw0KGgoAAAANSUhEUgAAAcMAAABQCAYAAABlAx6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAWHZJREFUeNrsXQVAlE3zH67o7hBRUhRQEEUMFAMEsbu7xVZUxO4WO7C7UBABAxUDFFFEUpGQ7uaI477dvTu911fxQED83pv///l8uXhun93Z+c3MTogcvnTTe5hDr5OKMtK3gEMi6KLC/y9Vcf9V9Y3NdhaniojY6CquRH/TQEhCEpKQhPSfJMqybfsdzW0H3Txx6ZY3+tsKXWwuYIj8Hz2nCPciQJhayHSaePFdaN9tT1aGJBeKC9lASEISkpD+42DYXEs9Pyn6E0ybs8zRftzsZ4Fvwtah18XQVckFD/Zf/oxs7rNUVlazO+9+HH+q3c6nd874xmrgtxTE6RVCNhCSkIQkpP84GLLZbBFQVgSQlwO/O77Ubg4j3Sa7bHgdFZeAXYcMdLG4199mKfIsQTx2o2tvU89b7nj6bPGZNxMzs0vR8yKDUJQG1Wy2kAuEJCQhCem/DoYc2wkBAo0KoKEGIC4Gp/Yfa2MxaPymTQdOhBWVljnyWVesv+S5qrjjhdCUwhmDT75+Pvxo8JiwTzkcEBSn/385gYUkJCEJSUj1AIY8qq4GEBMD0NKAstx8cF2+wai93XBvj2u3r6N3NaBpnyeK8AEhZBRXjF/oGfHQYkvAkVsvkxSwFQgyokIQFJKQhCQkIf0CDHlWoghCDEkJgGYaEBsRBVNmLxviMHFuRPD7yO3oE7rw7TyxqUALz3KtQnBueuh5YqDZ9idn9t6JsiVDlEPWII0iXG0hCUlIQhKSgGD4PTCqKANIS8O9Wz5yVv1GL52yYmNo3JeUGdxP8EDxTxLvXJDh+T5th9WOp+/meLzukpFZjEAQWbliVM5zCElIQhKSkIRUJzDkASKdxjlPRORx4IRMh0Hjj2w+5BFQwizvwQdIjY04LO7vKkZmFjsP8wj5POhI8JLXMVkixBKUYnAsXCEOCklIQhKSkH4bDHmEzxMlEMioq0JucjqsWrmxeweHkY/O376Hk/U784FTQxPv3JKdXVLRb4FnxGvTTQH7rj9P0AQ6lWMNAghBUEhCEpKQhNQAYMizErG1JScDoKoCke8+wLgZiwc6TZ4fEBoVOxZ9Qhq+uS0bCgTxvTscC0o6b74r0GufZ2QLFgsBtbwE51xQCIJCEpKQhCSkBgVDflDEpKIEIC4O3je86Bb2I87NXrstODElbTkfcNUX8UBQzzsi43jnPc+CZxx/PeZLaiGAAgJBMZrwXFBIQhKSkITUyGDID4oM+tfzxMM7DrayGDBu6+4T526VlFe05oIYvqrr+AtfXa/RmcUzJpwLfe10MGjqi4gMAFkx7rkgCK1BIQlJSEIS0h8EQx7h80RxBE6a6pCTkgaLF7sNtHYaE37Z2383eleTC4a1sRS/nQuWVkx08429b7Ll8ZGzAZ/lgCbCORcUgqCQhCQkIQmpSYEhz0rE54ky0gDqavD+zTuRUZPnLxw4beHbkIiYPegTovDr80T+c8H2Z0OSAy13BZ7acDmsVxXOIMQuURwkIwRBIQlJSEISUpMEw++BUVmJRJ/evuKp3MFp9IIFm/c8Tc3McuQDvO8txa/5gg9isnfY7Hv+asLxV10Skgu5dUSF+YJCEpKQhCSkhqGG6+GHgUuUQVyn7NIy2Ld5b4fLnj7eq2ZNfjpt3LBlYjRaMBcAMSBjN6pyXG7puA0+MXPPvEpuAaUVyMoU47zLhv8Ha5ANdT87/ZESI9IEnoPaBOaUxxnVdZhDtoBzyf/MIg2kRP6IP2oaW31FbDfU8/yKqn9j3UQagP+/n//GmJe68lV9ypLGljHfj536mzxUb/teMDDE7s8qhFsstP9ERWtnofHOEzXUICPhCzgvdO129trtINdFszwG9LLBnTEymCww3eQf4+n++HOLgqwSAEkG51ywLiCIx8ZiN8Xya9X1COmsRlNq/m29f/9Mf2qi/zGW5PTMRckZmcpxSSkQGRnLKRTBo4pKkFaQhe4dLQh7mBnqPZYQF/P7wVzSBJhvdgMI43+dpzMrKuhiDAYVfnzWXp/q4ffCidaY61ZZWeUUFvPROr+wGAJD3kFVeTkSj1Tem6CqrgoWbVqBnLQUtNZvuRm9WtRAvM/6wbw0NG+z6vh7jdEwgdVAvPC9HGTXYS/x85B8/JeUZfEpafD6fRQU5uejUXOHjfCKivCqq4UZSIiJQctmGq/UVZRu/WzfC/awCNDExMWBmV+AWDEHQFGh9gCFAVVBnvwZ8vwVDHzxfPKYqePtuw+emHPoPbPF25DPUiDK5pwL4s/XdquThk3oS8XlnEhTUn2myZiTrITk1E5DnVcerSgu5igUtaGKClBSVQHbTu3RI7HBspXB/RY62ucNW2jjzRPCZQ5qA1uLeDIlL3r7rd66cpOjYc9ucG3Pxu7otdxGtBDZfExsGB4bZ+b98Ony24+e0eMTkkzyy5hQkYc2Q3rmN4FKtk4VqbXLaN6M/KkpL+uipa0V7tTNWqSblcXmDmatY9DEhXLnkf7dZmWFRX90Grdo9WYoKgJtY6PiG+5b+ooyGAX19NwEiAJev12/0G3bIBYCgIK8fNHJk0Yx186dOhS99fG732Exy8vVRy9e4/MpMoZKagjXihNZIIr2sl1XK0BgC4bNtaKN9FtuMdZrQaFSKO8akJe+rl1eUbH5w4BnzjcePzcPefXWJLmwCJhMJgBSZMhaUShfxwqy0kBDgChBp4OWhtoI2w4WxaMG2J+ybmfyBL6t2e8KbVZoRPSgiYvXrAcExnQ0p6d3b7hpYqC7pgGVA1Ziavq0MYvdnAs/xkFzi3aJXkd3OglgLX3jxyoWx/tWn1RcAkrNNOHK3k3HlRXk3Ot5b7Oi4xNthzuv3AsFhaDSsnnlrQPbHKSlJDNq8Tt4vcUS0zL73r73YN15n/syn+MSm+eUlgKkpgOUlSH+oX4zxDAwamsCDSnHytLSoK6hFm5j2VbEsZv1HiP9Fu80VZS/7nvBFhoNXNeyLazdsfbuXo8L7Z7ff6JBviony2FcgUAH7a1qtHjlaNBK0gDKBnAhTVPjwsbjGlCKlD1zBySw5DnvV1VwwExQq7US3bcIgaC0KKwe0iYK7Wr5dXci1UiniibiIi0pYyq8CQppAwUFHDDEQrs2Fj5DDAJuenNSWajUNhQlxYUO1pbQtVP7i+MHOJxTU1b0bWDNHtvbunvPXl0eHv4Wwr+kwpMxQxbatG/nWkftrq4WhcYlL//Zp6/eWuEfGEwBrKChDUxIDM0rEvCgofpPOMM8ghSKisQvRMDGM8shPvS9SaDvI3yufbG7VXvo59DzwvzxI1bTqNTE7zR0dkFxsWr48+A2SO2EZGYFsKqrafVkmZFnCnofuWHo1AWuudGf0DhzoNPwsTBz5KAR6K1PPxASbBarWjTo3QeztOA3CCxkOLxUXSn4r9IYEOL3iCMoGPQ2ICExtAuymrt3snw8wqHnuTYGuh71zEvkOauqqw12nji/xePijcEf375Ha4H4v6SU5CoTeaIg9w0IeetWXgFVCCQLkZIQGRbRIjIwCA6cOLfbtnNHmDFxxLHhfXudRJ989ZvjZecVFquHP0NrjAGYWQyzpKUUnl06dga9F99Ayh67rIyp8zw4tA3Ev4cUClVTQJ76xo84qBDPW0F+PToK0L1UDKGUyTSF+j+cYheXlCmFv3jdBnJzgJGbh/CcxRDwdwgPlVVUjt957NzcPcfPWuYlJgEaKAd/sPcRK4Z4P3yn/EFGJtKxWJCG9n0alWoS+vg57Nl79KQSUo7H9OvjOX6Ik495a8OTgjEP0taqEOMOtbc9MbC3TdDhs1fdtxw9MzQtPBIBmyJnIDUBIhFGaNCVCLVVWwK06gWgZYaEFwK/V2i/x9wDKPwMYIxeb2aOFhg9ELNIMGsQgyDSAHpYaBavsTe8YKOr4HLjffozKK9qSmAISMhWiCKLupxGBaqUFBhYtY+h02jlAoIIG2mRpmVoMSuykWWeVwDVaLq9r3uB9xXP0XsPnx69YNq4R8tmThyOPpvzA+umPrR6eB0e2e91EBLAeq0AsnPh1HXvmVwwrG5g65BshNCoj/vctrsPu+vlpw5VlRy+Qv+v2tYEWurqxNt0NC9Cml5JFwvTdejjmXznA+yw6E/rk9Mzm7+LimW/D480iE1JFQME6Fizfnz9NsRn54xZOGHk0h+5ftE6MQmfI/BQkpcrEBERYdfXnL4Ii1hnN2aGa3FKGhmL3ahp7Hun9tuj3/D/2Zyi96oV5WVZaUoKVJCSBN12JgmS4mKFgvJSenaOaV5BEVQWFRNBgS2MZ/4B8OyOb/d9Rzy6Tx41eN4ml/mzJUVFX3IB5ncSmcjaeT95cdptx4H+bx88lSdlHfEsqypDKwPdvG4dzL/oNtMUMTc2fI6e6xjf/FfHxidNik9JswkOi4D3oe9N4z4nEOX8ke9DePTo6fRzTvbjD25xHaqtqnz3J5a9YLomnVZGmpxja4KhDs/v3tdwv3Ddf96YoXr1ZH3+i6hUaom8ojzkpSpjvsoW9Htf+bGiEkTlZFj6Xa1iKCIi9dNFqLgYFJFlKCEmFtYQCi6NRi0HJQW0wiKgrCBfgXlZ0L0S+Tlx4+SFrquCHzxFSiznGE3GQBc6WLZ7b93OBBD/+DXXVLvEzz+fEpNXfExMNopPTmUHh4ZpJqRlKBbGI323jAnZcQmwb+2Ogd07dyhHYHhc4DND7J4rKy9vJi4q6jlv0qhhw53s5m49dmbqgVOXzaqweSov929QJFZbOQcEZZQB9O2RbdEZgaAcxwIsR1o9HWnzYshSzE4GeHYWmbRvAYxsieVIGLOilCufvluXMiQMy1lgoC0LKxwMD0y0bHYcvfoev5VbWimBJ7tJEtJ05dSlIOjqyV4yUpLJgn4t+nPCjIKikmZRnxOqw95HdvMNCrGJfvOeWNtp8UmwfNk620ev3j69sm/TFFlpqaB6dnURhj11w3saFBYRIQZ0OtwJeCadW1DYX0FW5k4DA6GSxw3vvXNWbBzDxKCBG1Ej67qtuSmMHznoyIi+PbM0VJVxe7Hin92kbSsDp29e/2qrR0EhDncfBXa76htgk5qVA5sXzTpCoVDSoHHOQAlAvP8Yt37wZOfVxclpxHLtNXxAxY0jO+yQgHgskPDFWi+yrK7u3TQNbeYHgv74l/TM/inpmR1SMrKqX70L1w98EzbyJVZy0N4tQkrOvu0H2z55EXLv0tGdE410tD25c0Kp43M233r0rPuKDTudiAWLLRlpSZgyZljYMIeed+y6WJ3juoJ/tm5vv54WVFZOvXDHV/vKLR8XvwdP6MBkImXwltjb9xHeHvu3+PexthyEPlb628CFRRgCbJct+3Qdu1mPbdlM43yTlCUlJaBjbFgU7nXBAv3FbAgdvil41TCnv4v5tNl+5PQVGR/jODyELMD5k0aHTB8+8JSxfotDNfDPcL4/9SM/xU+4/zy4+lFg0NQ7N73VLQb2hYG2XafU+mFFvrkuqapKCgf2rFx4evLQAQ6rdx48c9vLVwyfqZCUCt55XUkeAkgEdPo9AAxs0ANooSUrQUCWz5XTXAtZBO0zMe7ZR8I7gNRoBJod0fe6AijocL7DKucG8iC5XMAEeRUpmN+v5QtnW10XeTFaIN8wKRi7oQkTV7EQQ2AIggoZo5Y6R/G/Hc1aAwxypK8pKjZ7ERLWc8l2961RL16Refe7cN14FIPm5XNkl1E9WojEKsjJL5x14/5jdeLiRVoVFhZ5sXGM87d9RzqPH34fy6p61iR5Z0y9F2zc7bFvu7sWSEgQV6iyrg64zZt6Y9KwAZslxURD+df+u3//BejkTQolqJd1B3xRls2Y2CswOHRP3x7We/nOa9gNvLkhLjltnf2YWaszPn4mWrLNAAf23eN7+jHo9Me1srIRs5eXV4jW8Nz/omZqKnfwhf97iF0PqKyq2vUu6qOB665DZ/1v+1CxhfTu5WtZx8nOt4JvnLZGVsvLWoIh5gPstxWb5bbV98juw0YgLUVc2L2d+uS6zJly27ajxXz4FgxD4fueyA/mi82x3ugnJg1xAnSdv+TlN33B5r2LM6NjISUpBewGT+xzwWO/z2iHnr1+x0Lk/DqbuNxKk5Jh3NI1555fPh6OXgxrAI/Lb+5MEahms0XKKyvFRel0Zj0rck3BmiAyIC0rZ77jpHkrMrBXABlczY30WWd2b1xlY9l2PzaLfsE//JbnR2O9Fq7ogvkTRh55NnvyEBlJiVFcYBOh/MZEYSAtNjFoedXz2K7u10+7X2xraY7Mslz0aj7HomtmAmAzDcBiJGIuFaSzFXDPNkR+7k4Vl+UAaeQjgICDAFG+6DtIzooja7ICW5rVMKqHXnbQ4m4r1zgYduUCoUgT0WIEN7Wqq/kFtyAXje+qlJOWCnHo0XnbqxunRk+aPekpOTtTU4Z7Z68qbTl+DgcXaEH9RJ2Re1zzfdg7K+qjKNbqO3a0QMskQyyTa34Bo9DbLaD+I9zw/bo7b9rjuW/LPi3sDoTSUrBx6JUf4nluyNxxw4fyASFvXmqyYH40l9Xqyor+w/v1bi0tKfmR+1pDCjuSS5uQmr7OfvR0t7Toj8T70cnOtvLm0V29kLC/z+eWFJyX2Ozf4SXsdguxNGl10e+0e8+tW92uYIsLu7I+vwyBeZv2+KCPtIPahbCTA8zV+49fPrLzkBE5yykrgxnO05L9zx7qiIBwMhcIv183kZ/Imu/HHTvKyW5J8HWPRVa9e+ThoBcoZ8K4GYtsAl6FPuCCVt34sbQMxg3uBxoa6gQQX9y9D8ev31nBvxf+D2SJIFdTAEM837KLt7m7pYaGk3gJdR3tMr9zh3oiINzGBcJf8c/P+D61i7mpu6mhnjX3PtTf1SR4Nw4eYmc75q3fZb0ze9eGUjUNACxHIFE2C1ksRpzzP+LuFOh8GN0RKbqSCuh7aIxBVwCeHEaY/hI66ivBh80DJl8c307fQEVyC3eD0uDP57s1NvHmnSolIX7JY8vq/j0de1eSQBJxcdh19Ezr/MKiFj/2L9da6cH3UDtz+54jccvRaCW7Vsz37tzOhDDn86cvICgswoHf6qkHjZQIHVf345vct+yVAEWkCBUVw7jp40senztkq62hepPL3PTfVIJofODTkJv/65lbek7eWscJc90+vQkjUW+WvW2q/Tz2OyrISD36Q3zMLyCeLJ8xYaSz8/RYyCskrqjLV2/LvYuKsa8FL+HnlD1x0/vqxnU7BpCgGASEqzeuSjqybnkX+BYU9LvrRtHRVN8TeOmoU5/+9pl4aNUVFTBw+iKblPTMPlDXPDzEZ4N6d8/du3JhJgZGbNE6u20bERkXv60e9pOQaoHx+H9eh0ctvnTllgJW9LFn4djOtb6GOtpP+MDtd3iIyr/368Osrvr2H5TCRM1udGr32chWsOaESTML6+pL5IAithQzkXn8/DTIvToNIskfDODfuUb/VeJZxAXbXZxdaPLybCzAcmI+gVfAs5FcP/TvaLPku28iop2DAoMY2EWp20xTsrO56aqe1pb++PyTXVgE5zx9pv3AJfE7v8n2exZ8eNPaHdYgi9Y/vxD6jxlacHbnuu7ovbd82mB9WXENnZaCLSVWflHxMocJc9ZE4ihQCgUMO7SrvHlkVx9pSYk6WYQNBIywYd60eRptDHPJK1k5cPqWD27irSIgL7HSsrIHLFy5cRg580cK2tgZE7+snzulJ3ovsR6fkwhDGpX6/MrhHXObt21DAoEKPyfClNVbcRRoe6hj55xPSV+yhvW1tbfu2zMZCouBmfgF5m3YPY7rbakUip3GA8OL3n4T8Brgs/HuvWygn03ndXzrXx/ykwr1cEMRHrMxWdUG+wLirrZ0u5/kdjbIpKICJ+gjrYpVKXiKxM+UTHKeKIUsRSnwu+sPre1Gu4xyXpkUm/hlEvqAAnzrivGf1tjMjQ0P23SzEsGH6ji45cmrt0gjAYnfBCjy3ZPXveZBcSnRmofa93iIXnpv37XTfYq6KnGVXr//RDsrN38K/H6KBbFEC4tLekxfvXUmcVyUl4O5bZfSa+5bsUAOgb/MHc4D7OKysqUDpi7c9vbxcwKEra07VD+9fMxBS1X5YRN7JhEZaUn/YX17pRFPgJQEBIdF9GaxqnUF4CUMlkqz1+9cW5ySThxP+h3M4cw2t25ci7AhnpMiJyV5/fLeTbtFpCQq8JmS3xVPxdO37uKCHmK1VpjQmBNT0tSx0nVqy2p3Bu7IIyMNj256q+8/f+1pU3aX/j/S09fvWKQedRkT+vfoguMmYhrKg1JXMKziakgGvtFZu7vveRaz4MK7YV/Si8RIHVEqNEDCO5KTKsoEXC+fuqjRof9YjxW7DgUVlZaO527S/7rGpmxl2pqTd0OjQlJqelZ9WGr5hUXDr/sHiAK7mqTR9Ove5TF+vW0r/bftTI2LsWDPjIoR8w541qseBAX+rtp2jwuHkl6FIj6igYiEGJzc5ubOoNPewp+rdvM7QMgqr6zs7TBlwfanPvcJH2sa6FZdP7qzj4qC/IOmCu5WZsaiJOdPlAGpmdmQV1BYLsjzBod9WOzpea8FyUFGStm+1YsvUSiUhAZcO+IhsDJrvXj6lHGpwETDFGeA675jg8orKlvWnh9FcBoZlm8SBi20d2xaMd8bK4EYZFduc28Rn5I2EoStAhqFikpKx6dmZGmR4gJI9rTRb4EDmZgNZfjUikHZ3wCOFplR3HuQx+vgvvueLwyOyeZUfZEW5dOFG0K0sEkUI653WpCTB1vXbNdv6zj6jMeV26fQuzo8awaNk/4f4xusfqS21NLYAJUVpPpKRk4uTg7/XUEudsHLb2RW9Ec6nnsra8uYzuamp7nM+HC0Y59wUgQAMet5b78B2Cr4DQAmZcHSsnK67D121ojkEZWVwbxZk2LbGupv4j7j33Q2TIAQ8aLliLkupwPv+JI8xWYmrSoDrns4GOloP2yiz0Nkgq62litZZjTm7Nw8KCwpEUSRab7u0KmZJP0mvwD6ONkV9+1qtZKPRxuKiEKxfs7ktYoGyIAVE4eUsAi46OW7nt/DIbhxSKaAWJVLJo1aZmlvSwJrShK+wNgla3AemwXXIBCeHzYgpWVm92aWl9OJd1FMFMTERGUbnPEFASEqmwXioqL5RRXVvRffjrxvuv2Jv2dgohzQKRwg/B2Aq8t3cHShhip8Rkw/Zc6yiXZjZ8YHhrzDG09LVlYm5T+mu+F1rBJl0J/zSt+VlpXjKLPfuScWbq0u3r0/iFf2aVx/e5aIiEgyTwgMseuxXwK7kdBaBD4LEo/8FD8X6q4OEQ3+krf/lJJPyJCQkACpFtrgNmsSzh8sgr+vgyV+HqlB81Z43r5wXQO7++U11cDrzIGx+tpaTeWM8KcyAfHSE46hRMFpQFBR9cvjN/b76E89791/LIctQlxGbc7IQbhwQAI0fJQuGbeKovz1wQ49X0NWNglOOn7tTn+obSQs2jvFuKTXt+9EeWx1m0dTU0U8KQovvPzhxHWv5fXgBRHSL0hcTLSISuV2K0KyjMWx2P8QGPLyBStKQBQJw/0vvri22/XMf/etiO6sStxfUJzbX7CWfM4TAcXIiskpQFpkPtQ6SZ5X7xRXjZCXBX/v+9Bt4LhNC9dvCfkYn9AC5NHrVMZ/pe0TZhKFzNz89di1iMtcqSjK4ao3db0fEQSvwiP7vHj6EkBGCqS01GFQL5tN/HzTXEMt2NG2WwE+4K7MzoWzt31m1kUT//oQLJYhEmD2JAIRWSPTRgz6oigne+ovWwveWTpj0vJ1frfPXtHAuZlK+i3A98rJFWYGulehabt7iYDPzMnbTvCLVQVoDUBGQuJX39G67v9oJWRkETe9butW2U7du7g1snekZEy/PndBRYlgb1BYBP1dVOzk76TOL8GwoPCftRva6LU4sGP1omgoKSPnh3PdtgyLikvYAcJYhQYldRWlq9KSEiXEXZ9fAJnZeQ0qzCk/3c8YRJjFBAihjRWEq9nA/KsRBnEJSOtSxE12KXUTEyQZvxIgjwmdjRUTXKb1P27cwZJTpBf75tlQ+6AbPFk4mAP9wN69x1XdXBapQuJT9CfiVQlZbuHW/2tQxA9Hj/j4uQOpz1lRDiYGurLIiqur0CVgdtbTZxYJyCkoggG9e6Qg5rz5nWsqfnjfnkdBnOMev3T3IbuktKxtXSf7xdv3G6OjYjmsIisDo/v1Xgff0mf+FiLJ5tNWb3lw2v2ENeZ3cUV58D578HCH1oZba+WR+XO8BOGxcT3JfyEAMGzZHFSVFOi/+A4t8M17XVJntLIS+tl0oolQRCIaedwiVmYmoS0N9XJwZSZ2ajr4BgaJ19aKo/4z44xY8AvGjxhpaWebjguLlCckw7yNu3B0qRoIYxUajJAy/1hHUyOLFN0vLoGXYeE4p1kM6hglXHswJCXUmJwqMYpaANajAXrMBZaiEXoPjUFKtG6/hO/LRPyYVwZqKlJwaIrF08AZ5pZbJjhMf3njXM91m139ZXCZr5RUToUTSi3lBXYJ4uReJRWoLshBkvUSwOODAMnvOCXfRGV+w4PX9Kmiskr9/svX1WQOKqvApoM5LiFVXAfNlXw+N79wxpV7D9WALUK04enD+l8AzuH1P8zN/rZdYrVNjStxsdSkD5FqN/wDVkMdz4e8Hj0TJcUDSkqhVTsTpkVro+y/aAm+WoRLth8IOHHgRFdyzqGpDp6nD9zv2KYVz7X2N5xny/q+eF1GgqbQWnQwbf2CSqVG1vSF9KxclTe4VrG0JEmp6mJhdhEaP3mbIsqge3W3aPuR4yFh4bZQWIC2qY23gvrv9GvMz2Gnt685xsBKt7QUPLzhrbrv3NWg2gKtkGpH3Tq0ZeIULuwBvOLl366wuKRj41iG2CWLS6jh2o8mvQFsZgK07EYCJKC8GOpc7xOXUMstJdti4YDWAe+Wdps4q7OODbJcsLCjyUiKP3JbMMMu9Pb5yWNmTsohFSVwGx58TlFbKxF/XBwBgqgUukccwNMTAMHnAAqTOTmLdPH/N88G2eQXvPzWJ32IIl0c1Mxag4ON9SX41o6n1ve75vvQKTsmThTzhL6pcY61uak//LsBKZVBp5906tYpmWhvSHB6PgociF43rKX2hj/bKjgsoj0uPkyCdUyMHyH+8PqLrEJsIYiuPXDSf9em3Vb4OajIur1zyv0Zt2ZmETS1cl4/sbBCI2Odnzx82hKYFeRcftqw/r7wrWLMj636d+E7inDRb6SISTRvBkiRuQgNX8D9h2RiqCdPZBhSDOOT0yRKmUyV2ijtJaU/LPMpYqyrs3W9y3wf0mlDQhxWbT/QPCElfTgIo0sbggjfjO1vv5+BE+7RDKdFxcKCLXtxRxWdhrAOvwm2skLcHAbAoBNA7/kAFkihoiEtrwxp6qyKuucLFjBJi6URXXU+vV3Zw373QGNbVSnGGT4XxFdtWVdb89T5XevMgx/cWN+zb69cnGyNk3553QkE385sjmWJC4Djc8OPSIF7sA/g3Q1OcXDsOqXS/3Ye5lki1RFxCaPmr99pQ8LKkVa7a8WC27LSUsF1EES86i9aHp4+tqQzBJ0O4/vZpdKoVF70478mbfwAhzMklF5JAXx8HlI+JX7Rre3D5BYUWn9MSlEnbl5kXbRtpV8FDd/Nuz7XQXTrifOP163ZZkNeVZCHq8f3BPXu1B7nR5Y0cSDkPUNVYWlp+0lL10wvz8kTwevvMndqRCvdFifhF67dyI9x4qQlE5MJLXWagbqykuSfepjWei0+kvZU4uIQ+ykektIyU/i9Hr8Cw/zCH9b0wLKqbPnk0Qs79O1JFL+ShCSYuHzdFa7lKYwurX+eBP3mzU5OnzAyEdLSSUWkUwc9Wi7etOcN35zX27xTKBjoSpE1qKYH0GUSQMfxAHLNOXVEWb9RCJ2JxphTCu0NleHmzI7nL09qb9tWXdqPD/z4tUw292/8elKHNq3WPLh4xOjk4R3nWxgiuZqErDqc9A11eGx8XojBrwIBxft7AAGHAGIfccFSBup+rPZHLMAqvgtbIspPXr9b4Dh+9sWi2E8y2JJesGKB3+h+fQZyNXlKHX4D3kTETH/1LEgcAxxFQQEn2nvVxLCWpsbXLMxNAINxeWY2XPZ5sIHP4hOIEpLTSjJw8AWuSC8hAYYtmsv9TRbhdo+LfiuWrrXCrkUamrfrp/ZHDO5l4wC/UzS6Yel7XoKoz4ljHCfO83n/MFALu6Z6jxocv955Gi7FlvorXvqcnFqOrUJsEWupKCOdhkH5UwK0ZTNNN3JcgPY+KycXMrNzevLzdx3cpPwyKtZji+sCqhoyNsXE4Mnte+Bx03t1be4vJIEJz3fF6lkTlxj26AokShgB4u5t+xScpsy/FxoVO4ZvD/628kyplJAHsB5LzgVBsx2n7yDpJViHYiLYjVqOxpRdAqqKkmXuk9ufeb20W+dBpur4sPkLHwj+TDDwGA7/cNbk4QPGvfG7Zrd206oEMWx5JKM9iV03tT1PxJYiXYxT7LsACdyXFwGeIFBMCWt8Zz9OU0HjR5pz0g+EUk0XqRGKr7zCIhWvh4F7RixaHdrdbtiexBdPQURVBdbtXO+5Z7mzPZ/CUVsBTKbj5PXby4grCFnmTnbdS4xa6uyqSXaIiIgkDeppc5bURhVlwOk7vq0qKivH1EaAZeTk5LCzsoglyhATYxvpNr/0F2xWvC7i+y9cf7J8iZsN6eghLQWXT+wNGdLLxhy9l9egQMgNOddUVU6rJS+R6GPMS8WlZSovQt4tmrlux1uTXkPOP7t2VRlXnZm6YMYHn+N7Leg0WjIIcM4Zl5RCwYEzuBWVlpoKVnpfwh/Ko5SSFC/XwPEHOOcWKbufkpLd+Pm7HizPfZtd5ieRrurS0jDHdfPwz19S1nHv33jWIVp7tD7V4qKiOXVY/19dTcXKpaooyF9/evn4uI69bTj9N2Vlwdvznpal4+jzE5evf/U2InoW+pwin8FQp1rDtPhmSGmSaoaYuIzjEq2rOxS7SPKQ9SXFgJlOreLW2hkOUJVmRHwnmAUVCrxakSx5aSn/NQtnGg927D1765HToy+evWqOm3tiNxSxImqbOiGKNMZqBIwpkQDxsZAxGFnbHTQbUdehkrytI5dvzpKTlha0f141s7xCMyjswzoEhPDgxWvIjYuXhBykXzQzAMdhMwsWTxp1sYeVxezfAEJC+UXFw675PaYAjU7ObMf2s8MFivPh5+dFePzFIxx7Ra13Pw4V6ZkQFxbBuP/8VSfH7p0vwK/zAzED07Pz8nsQRUcKQEZSogTNTdPsIUcw6GuXCMaeM1d8Fy1e3ZG45RCIYMtISkIUF+StgIbOjcRKIYOBo36HG7TQ1hOUl/BavnwXvjWnoFDu+Zv3kBARLQkZiJdkVaD7yFEwffSQy6Oc7JZzwfxXOYJY+FgUlZS04iXpy8tI431f8KcsYilxcbqyvByk4vZYaEjp2Tkl9bmD8RwumzJm2E2fB7eC7z/RYOYXAFImpvuf2OuO3stutOdGa59bUCh69va9qQwarRh+N0oZKTLqWhpgY9nOn7v2TQEQSf1lFQW5874XjlJWb3effOCghw2e3uqSEjhz+JTl+ZvelsP79twwelC/HT2tLd+KizL8f7Bmv17YChFRTnBMNatuwSp4yfPLiJAfbK2dt6qv0TpzTZkzXAEKUPeEWzZ8i0YrMzHQ3XVh94Y9U0YMWrlh75H1j30fiRBhgLsm8/IhBdWmSUUDaYDSYmCVlzbu0iIGLkYW1KypC3cTBaI2Vje2PBDDSurqwJhJo8Gug3mAU1/b1XJSUi/5XAS/sxFpF+74js6O+UTHQKhpblrVr0eXVPhB9/fv10lPW+tmNyuLhQ8876lgi9Ljlo8DAkNcDiv+FxYC1qZl8otK5pIgHMSHCnIySM+h4hDq4ibnq66uposy6LjUHbhfuP500SIEhLiGp6QoJ+CrsgqGzFjS7e3dy2P1m2s1LKBjAJYQgzWum5eSiLvakBh3vMiCchzoAHaW7T459e05S0dDDZe8yqgNLyHlwKqyqkqe7FSkoIqLiUrz8UajkyjaJ7K4fyKLYwiWl1fWtwMI74VXRzevOmvxLtyFVVQC9y/fUjvUq9uT2SMHt4a6Ba7VniQkID09Q2LCqBnH6yWfmpkFbQeMgLeeZzqhv4KgaQWvUeQkJc66r1t+1snO9symvUdGPA0MEiXJ+EieXjp3TfHShRtbjVobgZ1dj1sTB/bNam2ovxLJkRz4dlxTIz9TKDhopk4TiYNaGIjzpKFPJ8PAO85d19yY2kEHAeE+LhDS62kyeZ0Z8P2qbTuabwy4dMzq7LEdR7tam5VAUS7i9joCGq59SflDFbF4QUECX9zPM+hQkpsHUXEJEJWUYhIY/FYnNuFLNz6wqmveE2aYdhfu3nfEgIt/r2/njnFiooxzAqwj/u3YMf3snhLQVlYAX7+AFsnpmcYCCkR6SWkZm3y3mg1ySJDR6fSmd5iL9omYmGgGlUKVPHb1tq/z/FUdiTtZXhZ2bVz50RTXhkUAU5KaThuzxO0cq7p6EDRQTtTv85IIx7OCxh+BLKjo1HT1kLfhFu+iYnW57ngeL/1SYyspY9LLcPAWXj+k7MnJSP/RZaJRKfjMkpNuhbUtVoMchoiYGept2rhioQ/p/yglCcs37zWOT07lRZc2nlUlUk8X+p8mHAHEa9kGfawtJzy5etLy6om91+1HDuJ0IsRR6Eg2RoeGwb6dBwZZ9h87vcOgCZ89rnudiU9OG8rHz1U1mfy1Fgjk/I0hjvTHTwCfXsDUToPAqbUJrshQVg/WSU2WIo37MK/GDRukECyiNzawCsnq1BCA3FRO2gRDrGlXnUFAIyUvB7s99jnLyxA3qSBozCouLdN8Efp+QwkSOg9evGaHvngtE3rLUwkx8HkxY2NwtO0asnDymPOd25kcR58vreXacirOvI/o8fLxCzqpAEOnw/SRA85z3X0C3WtQb5tdLvq6QzNS06E0JRUuePsvXj51rDd3zWq6h0gpk1uDkBgXNG7z6SZGaFzIKpTafuL8m+Vrtxtid72soR5cOLTN17Gb9fDOFmajrZzGHMFnZ6+9/WHhdvet+13m34KGCqLBll0pEzZuWrXNULd5iKC8hLYH7cmr0G2Ip+Sfh75nf4qKlTkU8EzyELt0K7QwgF6dOyXNGjvk6mA7241cd2eNigkCG9pXwEHrhtfvj1vwPA8QGVKD8BJpbu4ydczyy3f9HcIePoXiz4kwacWGK4/PHY5G771vcHdpaSmo67cs3blv81wGnVb029ZoeQWoaeKGHfARmmbdXH4MCB/m2HsYujq8eBuufc3TZ/X1gOc6yQlJMpCdC1U5efDudajMlEeB4+X1Wox3su8R4jxuxHmLNkY8+fgvnKod14qg+RGXRPhaAhDtBxDzlIDQ6FnPul72vp+8asGMVeatDI7wWSf1tSuq+TTUVmdDkl3W3YsZ/zkL/Yx5fwCD9gBRDwDi33CiYHHLJ5EmWnWmioW0VlGYNmwAXpRahetOHOSIz+BwNffql6HvXW7cf9L/4o07hsVRH+HGp/j2t+49au+2eNb8NbMm4aLZ4bXYjGRuz932nYs3GLYYutpbg2Ub4wu14Q5ZaanPA3t3jzi640BrXJvyzC2fDksmjTajUilhvxLQstKSlUiJESd1VRHgY+FKpTQx41BcHMJiPimHvn6njPNgFU2Nq++ccl9gbdYanxVBR1Pjo1vdlsx3WejaChcqcHc/0XJwz64Huluaz4WGKN2FLR+kXI3pb39DR0v9dW2+Osze9h7mD2TRVX+I+TTm8r2HI697+VknhbyFBxdvaD949HTJ1HHDp7hvcJklRqdfqWkvM+j0SjquR0pKk7PQ+jH/6DJhIOSvy8tuGOWYJ5ijz25dvdi83+jtrPxC6hPPe3DyhrfrlCH9hkNDl2tDay8vI1M+ul+fhihZ2JRTgWh8NvEr63Ym+Lq7YXmZeMDL1ysv+Tzo//h5sH5aWATgiPg8pJifPejR/uItn/ZIhi5wXTjTpbmayjUuTn19TorA647dibiqQxLacw/2oiFcR3pRPulIX4WsxJtXbilY2A0/7Lx+Z0BKZvYYPgSH32CIr7l06FLxj8460Wnv8zcTDgWN/5xSiH4BvVWO/hVHBlKHsQA95wA0N+VYhmzBXCONHguNhD3eqGlZ2dp8CyvIhdcKH85nS0tK5PbparXs6PrlFiF3L88bNmMCOU+sRpbKWueVLeat3/kCOInvlQLOMW7RM/Xi3fucPD+kIY7t1+cscM6OqLVg0MyxA+xPk+AmtAZR4ZESD1++XiqITiopLpZKzlARAObmF1RXVlYxm9wWRGvHKisnEW1d+tuz3ty91IsHhDwXzvIpY8bajxqcQVppVVbRhs1xmZOcnrEGGiLSEFs8aL5SMrLUaslLNK7Fly0uJppriZ5hl4tz5zfeF0c6r1qURjwDCNRO7Dwo7zh5/mUEJg41uZfQPbIkxMWqsYsbC+jCwuKK39z3v0XM8nJOfVEq7aunoSHVW1NDvd2bXJy/kOhSpATNc90yLD45ZQM0dGUatPaVVVWUsvJyxTqs/6+uvyEJm8033jIpCfFcp57dllzctd7yjdfFUYeO7jpuYmFWiVNgsIJfVVQCJ46c1rGwHXj59K27vPZplTw+pdCxu5P9C0igcBumv0Vg+tQDICuR5OhxqrkA5+xBXY1oqu7b3LtbDhh7fu+pS8FV1WxT+JbHVFvc+Zr/FJ9XtnTi+bfRdgdfTgkKTxMnXTKkGN8CZyqRNcNE1qqiHkC3GQDG3Tkl5X5FSMzL0/+aPFnKd8yKhW+JoU6zA1cP73CaMW9qJQltV1eFA1v3SV2+e38tz+oSRB+4cu/B8Ny4zzRAwl7Hwgymjxh4gutOYIFgodhkrbpYmN236W2TTgI68vLhvJefGXpZvgZhStxN8jLSOwkfog2eX1jMqKiskmxyK4CtDWQ5dx/av9r7/CGn5uqqAd8JD/xv6LG1y+dI6jQjWyw7Ihqmr92BQ79l+DdeE9Gu+XkJlORlr+xzW9Jr7441mWRfqavAo0s3YcWew7v49uSP7nNTSlz8DWGlKhYUlZZJ/yldk+Ptq0RjKOWcJQGOMxETa+B5FFk2Zey4jna2qZg/ypKS8ZrP4ON7YTJ+4/Ez5uUCdWXFy7PGj5j+6sbpdteP7/Hu0MuG7F2srORkZsOkqQt6rNp3zIu7NmRf0mgkhP4XHenxZ4pyAFKR2YlrVeJ8ve8zJbCgwG2VJMQhLT4JFjqvMD9z7fY7t/kzdg2y6+GKeZS7OWoyv3kVUMgmKq2s7rr1wcdt7gFxnfKzkdYlhb4qJ/5NJ+D/GhakOD9SEvGfnOavAR4/B4UNsrS/Nk+WzSeEvY9sWuUYl5bp9cDTRxSkpGDB1n0j+9pYB8hKSR4TwPLWPnXLpxPJEZWTgTIEqlNXbd5UXlGRCLUM16ZSKfkZGZksUpEGWRdXvP3bbF0820ZDRcmzpmdRlpfPxYyKv1PCZIqlZWe7ystKz2lSM442k5qRfqnPafd+4gxGwE+sZkozdZV7l9y33O8/ekZv/Ez3Lt5Q3dfFKmT+2KHtgVMMgdpEeQlT5PyJoywSM7Ke7dm6vzk004Bt+44bjelnt9/EQNcZfhwcwlSQk2WSaOCqatxLEwcObcEuRPgDEYklZWW5GbhyFVbSmeXQQksjrYF/koom5NmxLa6nLOxHrKoqLoYHVzyVD/Ts9nzuqEaMLhXS97xcJSbKiBjSt6cTurp43PAa57xm2/QSnA8tLQWbXTfbS0qIP1o5bRwuUlJIE8ifTg6jKRxLkFrycyzjHVpjQSgrA+9evBIZ/DZ8ybCBDuPWLJmzsbWuzjmuewZ+skl4br3Op0OSXXc/jOsdHp1FBTEap12UIGNloVtUVQisjLH+/qqCvGjb+7uWz91sHhC4joUEQMbHz+Ad8MxhjJPdMfh5vhs50wiNiJ746nmwFI4CJY2BPyfByRevu6L3utZpRDjdBfMAVRQqUlLh9sOnbrNGDfaEGgJpVJUVROlKilCJtLYqZFUmpqS3NtZt0eQsQwVZmXIxDhD+zA2IhV6pU/fOfRctnPl297odJljBWLp+h35Xc5PZ5sakc0XjRhvWXsNOXjd36qzLd3x90hKTSceAS95+/UwWzf4ZGIJ+cy0q6WOI3vqSnimNtqoeEgXRf+IB8gqKOhRgMMSNp5F12ExN1bUGmVNv+9DUQHfHhlUL261YvNoBGwYrtuxt5dC549CW2prXhBj1x3iZt0+fTR7i9MxIt0X18DnLZqbEfiYyapXb1u5WJq022lq1n9cwEQo80MINMcXE4NqF66pmvYa4L9q8NyQ7L7//dy4XET5Xm8z9mKz9PQ4FPZt0NNg+PC6HCvJiyNqj/1f6Ev4WmRrqX+/UuWM26btWWITBUBlqbnmCrXD2yeteq0j7LKzw4KoW8rKV9FYGFeiqrNOlrFSJ7sPihDsz4NjV21g7Nq5p7BoqypKqivKc3LCSEoj+nJhZA+D8IbVDBCorqyjMb2c0P9NMMSCyNs+fsbyNjTWQfo9IOA+bs3x9XmGxI/wFXQ6kJSUCkTb9gXQRoVDA58lLzEfNfqYJ6zbTVCJ5jwiAEtMzcTJ40R+yCiDyU/xGEmmLlCoZbS3cFy+3EX4br3mBy5Qxi81w6bCyMihO+AKz1+/A/SvbCd2lTcNatG7bZtaTK8ePyKsqs0kDioJCWLLz0PDqarZJ7cCwtoCEP4+1M011YFVUwJ6Nu/Xa9R97++DZq2fRO1bw7axJNDGfOWz6pbAou0Mv5z0OSea0ipIR454L1mVL/Ce1oMiu5qZvQZRO0gA+JnyxRotsW9OM5BUWDb3iF0Ahfejy82HP6iWnEgJu6aCrJbr06njpHNvsuo3k4KFxvAv7wHj2JmxiDeAmIi8jHaejqZ5FOpYgS+TF2/dY8KrB31nvkVjrogz6vbM7160S01AjSuHnl6/py3YdxBayODRG/uHv8VJxl3amt7GHB+/jL+kZ6ikZWVN/xkumRvqPiVsSPWdKfCJ8ScsQ/1O7EYFhCQnGKmOCPgJDDRUluUact8/H1y9fDrKyFTiozc/TB87d8V3J54kR0p8jTkMILc1Za1ycI0mMhaICvA1+o/I2KtZSMDDkBarkFdS91yCuCIFAMfnjZ5g7e9m4Tn2Hvbzn6+OO7jpox8uM++ZbHl89fv+jBjnqkxfnJPDWFnyxCCqt5NRHFflvKmEGOtosEBcjeYI5+YXI4CupsUX5RS//cTmxn2j4bEVRryXMGDnwEbLSUtGVgq6kOl6p04YPiG7WSp90MYDMbPC4dXcI1zpk/USrftypbZsA4mpDAPo6MsaqjFluB395r7h2rQw2H9nmdgGKkeWtooKj2WhXfB9t+c470iRJR0uDQseRwXhboX2PwFD8Z59ta2SwWlNHm4N9uXnw+kPkKi44NOb6Yemh/io8UpmTg1kGrfRaxNCo1MZsMlxhaWK8fT2vdimDATNdNw9Fc7cehH0Pm4yFOHmgg5uasUEFwZnsHHj6OnSuYKiGBJqKkhL0cOjNSVnA1cPrYiXiH5aVJmAXHPgSHPZ4zW255OTNZUd9uuZWIUtQWRYxTx3PmbEmmFsG2pqy0KuNCtSq1Nn/ETHodCpwO3Gw0f+xqlk/E7j49U4X7vr35JXycrSxjhAXFfWE+gnNvj7MrmcyubGUJHj5BrREVqgs1JB71aV9W2Vc+BgHYSXGxEHEp8/Vf7mtTyINJwzou8FpzNByKCggFXZmLHGb/ykxeTs08f6GdDqNSscRmWjvsjnXT2u+SUmKKyBlhqMwI+vw0cuQ1o0M9uRcPCUjc+Tzd+HaRN4gWdOnc4fH6PV0aLxAHrLmK2eMn2LWvXMqNh5Kk5Jh5voduG6wLAjdpU2CpKUkb3dtZ1JJjpSQzIn+nGgmMBjSqDS45b75yMNb51aYd7Tg9BnMzf9mOf6KTzFz4mhPnD7Wsi3AWKQotZ8ACW9CAQLdARIfoffKa9drUIQLggVl5N8pvfVjgmaZz57bUTObWIj/QSrHpj83kraG4CjygdfvIzu/fPJCEuTkSMDT7NFD8PlGfdUDLZs6rP96uooyabKaHfMR7jx6OoOnuvzoCz07We5Sb67F4afsXLji83BpTZ//SwhrdzHndq7rpINznlgsKPiSCuOWrV2KFki3KT9bRWUVVOH9xd3fNfATliNfBvWyuUa8Rui6E/CckZaVPbQRh0vm0fdpkHlRXCIZg2wzrfK+3awf/Ik1p1IoTz12rD1BlZEiXhrv89cVj1+785yrALF488kWxkL8KVJRkJMVIV5LpPAVlZQWCewmLa+ogKKyCn/bTh23Prt1tsWObW4PVJppAKSmc1ynNeEhBsAyBJyKzZAtMg6g81QABT3EDeUklB/KSwCCrwE8OQyQEMwpQMyQ/rUCVYIEf2E5dDRRhwfOnTeeGGXWQV2SejijuDLnv7rCpWVlbKIgIEBEVh5IiIlJ/AwMz93xnU/aLpUzoUsXK+ho1rpeK1m00tW5btejCwE2fCZ54prXBPSyPvzk7ERSXOzuCIdeiTg/EZQVcTcGk/zCoi58qs/fSiKyUpJvL+xc54mtXqx4BPk9AreDJ/F8K0Njt/4RkJhMZnVlJUepxInrkhLiMjUAfol9V6szCkZ6JHClNCFJ8vQtH9z5QqKRrF/MU0onb90dTcAbKR2De3ZlKsnLXv9D00cxb2Wwb9VyZ1/SdFtSElZu2986MSV9EI//0XySalSkWIGQGt+LhnGGZAjissgigueQ4fp+FRWVpGqKOIOesGT6+N4hdy/Nm7lwZrYIPudJywQS/PDVShThpDjg8mi4bVJ7xAM95wE0tyKV/aGc2zORBNmIk4LfkJ3ESeoPPAaQ8wn9EHqNIfFPOcE7F8wrgxbqUnB2TqcrQfM7d++pr4QbbOLWORSKyK/7r/2/Ulj0J1J8GW/AZmoq6WJiom9/9DkEMpMuePtrkCaopWUwYYA9do9mw++2gfmntVAx2rG3JyechAbPgkPR+D4uquHzMHvU4M2iOAoZKV+ZkTGw5cR5HkD/zaY+BguKtbnpJNdl814QsEdCcMPG3VaPgt/s44JFk7MQI+MSgJ1BGnTgTiJMveZaj3/yUdK5BGnafpMH94viFcg+fcOrfRWL1bURno2gic+TF8tfPgqkALbGEF/PGTN0H9/8NzoYoit3zcxJ89v06Ez2WHbMJ5i1bjsucYjzTTEQUhk4wLBaGFfzJxwfJWVMNk/a0Wg0yVoJPgSI/G2CoJm66oHD613MAq+edLUb3C+fWBk5uRzAwi5R/G+rbgC2cwDaOKG/RTkWYnXVv3kZu1dEpThXQhgCxeMAb5FSV4aMPKyQYtcp1qBySkFGkgEuA42DQ5badBxnoTkS3eAJNK12I41ueQDnLKLf87APXcjmYjDAoo1RIHot6jthQATHRW//ibmfEyjYqpcz1GP379l1P3AKrdeX4CDWgmP3zu5qJsaFJJggKxvO3Lqrg16X+4G1QHpY6us0uzBkqFMWTg3BZ08Hjp3Vi0tKWcE/9r8YEEs2OE8b321gXxJ6j59m/CK34Zk5efbQtCINMXjpB4aGzSAdTKgUMDPUjxcXFb1Zg7KEn69qwYSRWyVwII2UJMS+CoWdHhe38vxDDcj7eLxSG46emQHlSGfKyQN7x96ZiP8PQB0bvdbXmiPNPMljk6sryEqV41KH927epZ3x9CHRpcgaYbKEQPiniB4W84lKyk8i46G5pnpaXa0A/ppwqZ3NTTb5ntrf0fPy8XN2tlZ5tKI8AK3WAD1mAXQYDSCtwWkczGL+4nyRm7SPzw1xl+owX4BHBwFiH5BkeilZhYrZ/Uxig5Z2m7mlv7GVgjj9FfeLtP/4whLN+2FQSNeo128lSCUgBXlwsu3K+oGLEb/W4sxtXzPi3kabcVi/Pp9UFBWecgVdfQEO4REZKclH4/rbx5A/EUBf8PK3Lykts/iBtcDLzyvZMn/6dImWOmTUpWkZMHnFhs1sjjb9N58d8p4v7uKu9W4KLXRIQFlK2AfqrDXbcGcPc2g60aXs1Mzsdj7+T+SxuxrzCFKWqgR4PoqmqvL51fOm+JIgO4YorNl5sG3k58RxDajMYI+B0u4zV14G+T6UxnPKUFMB95UL9qDXs+DPVn4hZoGlSatNa5Y7J+JShzj9ZI7rlkFIARolLysdLUoXWoZ/gl69j5z/5s07MV5ubDcLsx314RKjcRkudkAvm6lrtm7fozFwMRJdYwFUjBAIFiODtJgbfVoLBY3GQLqeApB+hUFXESgehYEyiZEHhxi5tFKVOspnodKES0usCnPXPUfnsfEZD5MJXa0tobO56bofCeQ3H6JHv3oWLEuqxCjIweRBjn5coGkQwTFhkEMQzufB6TWZEdHg+yzIiR/Evxcg2hpqnrtdF0WQQgBKCvDUyw+muGzYzWdh/K0WIt4AVE0V5Q2HtrldJUUJpKXh5oVr1GPX7qxsAtYvz8MgvWr/8fWFX1JInzhVQz0Y2MtmLZ/7rybrt9pl6rjNZr05tSArcvNg6PSFZ0vLmBOAr9RiPY4VHgaHXlyyfkcbUpC5vBzWLZ37VK95syPQNM5hSXTp6hkTZ7W17UJq9pYkp8LcTbtxVRwzKQnx6l+Wjmy6Cjirnte0sfgbdpy+5ES8T+hSb9MKLE2Nw+oDDPHNWbmllZOXe0c/cfSIXJskqc/pys4s+IFhUhv9lM05MxRFlk5OHFzYv8ms75jpVx4Hv1nP3ZSV0MRztRqYeJV7LJD19DDo3kNxkjxPocC6uVOxMIj+TnhhxqWc9ry7GoqKyLliB8t2YNW2jVtDCuLWei039erWiRTuxprx0SueU+DnaQXEXTpjxMDeo2ZOjIbUDFI26dRBj67z1u/AZdCM+Tbh3wqIMMLedsPUOZOKyTpISIDzio1DQiKid/5B4cIrgKGy+9TFoNNHThmS8+T8Qlg+c1KgkrycL/z6PJnnMQq84r5tujy3nF5U0BvoM8n5dG5h0Xjus9XHniVnyC/DIlaNmLqgNxundCDB1nf00AyXaeOw2zkfmk49UCqVSnnksc3tCBV7bZA1cu3MZePzd3xdtdRUSv9SucPmu/4WMMQ8Qzl7+57f9XPXWuMazrgKjfOYoYEyUpJPKb85IVWVbNA//iJxm9mOJye3Xw+3yssvokB1GadGaL0oZtz2URIywGZIivh63af3Gjlt9bTl6z8kpGX0+j+wFmprAVbzC5SCklL72a6bn5w6cFIO5KRJAqnzkrmpPawsZvGBy1fKLSjsf9nnIZ0UQSgrw30VTwOneHRDadH493OnDHXaTDRgBgMeBb0Ri4lPdK1BU8ICNe3sNrfuNoMcc/EzgYoiHNhzpPvAaQtfpGblLOGuN6+9F/s357OxeQc/34cDrov7tevZLQOfy5VnZcPEZWsXo9eNoKH74P2El9AkmG85ctpv8dJ1xhigcepUr5GDYMGEEaOB08FEUHChGuo0O37xwNZFpMg/AtXnPvfBdtT0MxFxCdOBc2ZcVQchyuYbL45W9e8xavrGnIxMEsHa3rYrXN27EbfLqs+z7/oiSrtWBodWLp/nT46AxMRh5e7D9LCojxIgI/NXWYRsNrvThkOnItp06x9h4TQ24v7zVzd5RlEDWHFV9bBPv/L4uTu+tybNX9WHFCYpKATDLlawaNKoqb9yefz7jmw2lQ98lL0jM9Z33xX4YbpHyLLktCJOMW1RasPUEeUVAddQQzhbBScOebRqazfs/vbj5/xLyphj/xpLgRvGq6Ion/WddSfI9VWApWflTHY/d+1up/7j7h0+4CFJQvazc2H07Mmwd/m8mXxC9x+Lcfnu/QnZsXEUHN2m2MYIhvfteR8atqo+aZEyqJdNuHY7MxJVx/qSQjt1824v+Bb88COhR6VRqRm3ju50shnkEAPpGSSg5vZVT1kLh5E7dnlcOMgsL2/LnY/v20zVZEX/aD7/BO/QRBmMJ8haOEY2JoMOEc9ewdwNuy+h9xRA0OhZxE+KcrJ5v8NLpUym3VlPH48ew6a8Wbl6a1teVY729j3g4q51q9BfyVC7HncEyO27dNxz/eyBk5I4fQrdM+xZMHTqP/bomv3HXpQxy3vyCama1o7/PWI1v4uMmTd2sdvzSbOX9S5PSSM81bGvLXifdl8jJSF+lOddaGpgiK6sNbMmzTNCAhgfZXyJT6KkpKRSoK4dptDaoz3CFhcVzanD+gty/fBXb91/ssvNdbNxxLsPxqF+j4yHzHMZlJKRNbSelUrWo6CQsU9ev1v53T4VZIzfz0V1Tl7BuFW7D/uPn7OsfzUOXkNAKK+uBjfcN59i0OmxeH0EPm/D3aMVJBif8X9HZBav3uQbO+NSUJImVKDxyYr9U4w1MJgQ9w2ybAqQ5rp8oWvvY5dv9d64cKbVyH59NmGLAn2ksskW9uY05ISAoDfdlOTlEgUEIcwIyhGf4jdFxyWIBr+PYH/4EG2aFpfAURAqmICtwtXLnd+vXzQLM8/d7+7L07I6n/Xy60ZSYNA4HG06h8tISd5rBC2aigS/j6NNp8TD7z40xw1vLnj5W62ZPdlYXFwsgvv77B8IVLq8tNSLR+ePdHXZui9wx46DhjgoIx0JwCULVs0+dPbqxH69bT4N6WlzyUBPx09VUQHpGSK4KHP8j1mHbYFThDKyc6tTklPVQ6I/bfV6+ASGOfa+On6gw6Y/YE1Q2hrpH9yyZmmPFUvXdgF5OTi493Db7h3beQ3tg+Pxf3GOi9eeSoWgsA/mzIry4lrwkkhCStr68Jg47bCYj+zQt+Gm8Z/iiducBHPQqDBt3rT4/etd9ouJMvbWcV6wG7xySO/uU5vdOPN21NzlBz6/fA1FmdmwfvXWVuc87z0Y2Lvb+2H2PQ8ZtdR5JS8rg8HizQ8EHK4Hp/MlLQNiYuNWH7nhpevr/9i0JC2d23CcAlNmTkg4uHGluyidvruJAuE3dymFknRmi+vOjk5jl5Ci9DiasbqkrncDZAjQkDywQc9eUC/8y6oGuigDDFpoZ9BptLQfzeXDlyFUwntqysQiL0JyOCQ8aqKmqnJ95nRWn7nlM+T8geMDbYY4jejZqYNI17ZtrquqKXsZtmhOYaLfRbwZxfVY/Ih0SkrL5BGfK1/19t9+6vY9sy+h7wHvMSguAGVDXbjp4X6itV7LadxnpAoGhkhMSYvSIKWAOeL0q+Ruy25HLK4qQAJYgoGEMKNuliCezEq08fKLSU7Z10bBAk8Vt38iYqa4sA8wapLznFN2PQZvXbXgiJyMlAqvsWeTI8RoBUXF0HvENM9azRueLyyssFaDAy/wRpLiKAWD+9sVzJk2fpNtp/Y7+FyT30eQskM+RFsFPw2SJSXx0EaaMXLQLfR6HjR8EBIeS+GUof23HT5z+RD+Mzk8guL/4tWSAT27TeGOj/ITC5GGEC5r+4oFtlYWbeds2HVo5buXr8i5y+fgNxL7I6JN97ufMNU00N1ioKMNes218rTUVPbCP0Pqq5EVqREUFjkDR+99+PgZ/X4kkEK9xelgbmKc8Ifc7PiZM1ymjO37+l3Ep5tnLqsCgwZTl6+3tjIzGaOlqnThV8IQK4aTFqzaV6uIRLL3Kjn5qCTnt5w0PcXnuV1srGH21LEHRvXr44I+WVKDK1sQlybmq6oObYwOBl73yNlx9MyYvcfP98NRzPGBQbAn9L3pngMeRwzaGEFzLQ1AisENZNm95+OF6s9fUoYnp2e1fhsVC7mxcRzex/1XxcUBf2/10rkPxva3H8x19dd1rI1FJLq0g2nrFYvnTpm4a90OJaLY15UkJSEpJVXKymHU43obYX4BSBnoQvS9KzsRuC39kWwoZTKrOZH/XF7CKeUsFrO+JwtZvbnVpckQcPW2aYDPQ/xbJhQl+XU9OraHwpISMNbVCWrZTPPeD2RHdVj0R+fPX1IV3+F9js+TMcbg9D30PaeRAz/uWrv0mH4zrZ188pItmBAUo0JeWSX0Pho8Ov0LurEEnVNMm5u9XyeWwGCqIAZmpi0gLKqK5AbxwrhrZSVigaCEv8cCfy8/9RcRMetaoo1Fqu03IaqorJQox73hivI5RQZqO29YeCkpAAMJfCkGHZo31/rSq6NF/sA+PbZbm5s+Q59I4HON/lt1qGYruO07thNSP+AFBYshI8C6ncmRxpwDizZGpzt3sjz0/NIZIitX7jky0aGb9SY6nfbpFy57bGWkDu7TfZWdjfW5m3d8Z++5cGPYx49xasXxicRCSEFaX8qb9xBApcgj4b7uH9BGIbv1m6sd/4tD2hXloRna+EYtm7+qadwISKUhIQnNYh4kpKjKIguzPjUtvBGLT21xdXse/OZoxuvnUJCTANZDJp4PunlKVkNF+dD3yg36fVpiajoV0tCz58rUvoIJLmKNFEmatiaIoXlorqaSb2Vh9mVEnx6XbG2sb6Mfi6yBl2ot0/D/aCgpXt6zatHlqSMGTT1w6pLzHZ/7Jqk4OApZirFPXkIs2vf3KZQh6OGGfN0beN0IcFdx9jlWcJWVwKxt64Tpg/sVjRritEpeStKrPsZaxiyXIWsMuZCcnqkA9Vd84kfzUbVl4cxh95++CHjvfZvoggkpys0FvcE3fkQ8zRCr32OpyjwozpZDBmK19M8+YmakJ0vqGWO+w4X4GQx2S22N+u5dKdKnc8ePzzs7pCbmFmgw09OR7CyBagRqD89dJd6L1zSaFdrXVv96fsw3eH9jmYn/RfzO0NSADu3NIhZPHpM0sE93HNmcxV3jr14pwRgIMWFhaSUU5uGipqKcvs51mX/8nTJOVwlzQ2VYP6D1Nkcj2+cXehmPWLP9wJi4sAhOdwt81dZ1iotTq6tCcWYWvMcH6ljTbTquUoq6slLU6o0uW3HjXZLbUlvCFWVaakPbVgagJCeLLKBmu4BTMQYEEAYUJECrunc0396u5Z5qrCX17WeHiy7nN+Cm/5EVRN+9Yr7rbb2WUiApDgxJSZFKFouOwFDQKEWQFGVEjxvW3xldO95Fxc6+/fBpdURk7MDk3DzjT0jZyIr+yHGFfKdIiCAh2tncFIpLy8BAWzNcT0fby7yNEcXWqn2OvIz0zhrmgaKrrRW8ctuarXjjK2qql9NptLJ6nDdSn0dGSvLYtSM7Gb73Hmpi70FhQZFUdm6+CgJDXu4nDwwpDDo9b+P8GVsyUvuL4ICk2mtmFSCHFEikROG+hWBqqHcen358NyZqQ4BAa70WJw5vWnli7cIZo70CnrV+9+7DkPDEZMNMpAxHh33gAh/l67rR1VQRz+uDiqwstG1jdLxr+7ZZdl2ttgGn2pQgvC8Qbxq00H6xcvvardjz0txID68vswH3BgXx0OPTO9aNuW5pboIBX1FLI0fA3/vGjxiMaPW8TOXlIKUgD3LS0o9/Nh7cMPyab8CeF3d8iYXusmx6RrtWhq61hoOa5TN1hGOvreg68/p9pPPLd+HVqSlpGq+iPk4sQ2NEliiEhIaTCOJ/zQHmIaToWpq1BgWk9LU3a7PNoVunXMTv23/AM18HISLpci+/pLxKtkFbHpFzLaTFFDJBrZksrOipd2BaF53D4jQKTwOFnMIiu12HTu3cf/pSG5yHA2oqHNBoKEDDE1ZWCifct26fMrT/8gZ2FZIgkgYCGEEqbPACVap/JIgbyUXIO7dk/8Tyq80Yvi9fplBZVWWQkZMLaSnpxN33T0uIBVJIOUICD/BZg6S4WDRXEeC3zn5WcOBHa/cPjbKe6Gcl2ejfbdo/zUv18Zz84fhKSCjqFRaXwEekzLCx+58i8nXdZJHi11xTDekHBPSDvhsvpQH3Z0OsMf/v8aKha1rrxpQlIOC+JHxaUVllFfY+AmiSktDOSA+7qKME4J+qsJhPA9sOGHcLVyrTMNKv+OB9UVdeVib5J/L3R3vCAu11OotVDR+RdczEhUO+PxJD70kgENTT1kJ8Q8dniu/55k7kZ3xDa3Dxh0GwpII06507wDjGtZfeXlVp0SPf/X6Vooy032YXZ7/hA+wnbjt2duXlizf0iSmO+6kx/vpO92z4s8UB2DUID3YjjoFaw3u1tqb4/s5FmnaQlqoK4KsmkhQX+xnvs2u5duwG2C2C/M6f5qX6eE5+gZQtIiKSLSstBe3bGAnsdm2k/cluwL1QGx78U+v/M+UQiWRakKWFWV3WpYjEOyDAUkDWPilULviewMrDG1w0Huu7JoZ6tfFKCKQNNpw1WFBOgmT6ddSODXOxGe8+qHUnLhBS+bQg3mDJgNu2Mjh9ac9GK+8rJy7b9LUtxo1CySUibAEmpBqZvbaXkP7OtRNS01wzgRTytIwsPXxOjK05LTUVEBcTbeh9LjDP1C8Y8ox/3FUitxRMW8jDjVkdd3tN72Boqi5zDr5FLor8ROvgDT7XsXvnUY8vHbc+dHDb0ea4kgXOJyou+Qa0QhKSkIQkpL+FSMR4aGTMFiL5yyuw+5sBjRez0IhgyDsXzCsDZXlx2DvO/OnLZTZdBpuqL+Z+gloLlKZxxxY+a8zQma/vXenm4rooSBwH1uD8IhxeLQREIQlJSEL6G4gnrJUv+DyggYQY6bfazbItzu1NhyZSLYhSL49ZhfMFy8i/MxyNbr1dZtNvfo+WNv9j7+xjmrjDOP70er1upUyo4svcIsoKDsp4tTjAUpms2dCFlxk10ZGxhGWibgYmoMypcxBf2CBDsNGxkTHYSycu4tzIwgZkM0owJAayOJNlVnkZgzlgNw443P3uWlKNsoktq/p8/rmm1zTPpZf79vn9nuf7qGjqBwdxk00hNlEUfbweai7M2WJotlTsT1yX2gtDQ2JJtlgijqKIIAjizpCCH3XJR5991fFjiyepWPXU+kFCtJ5UMI+Am/SG3pkY2vsFuTFYqX+kr3VH/O7Dz+tS5ns9cNJBBGknxEi+YzRC93hOnbkoou7zitIoYtBBjJ/7/pho/EQQBEGmNeO70R5NdpNzmuPfNtVn7zkYKla+jI7CpvWrL/hovBvAjTxkpy5Uw8I1siMQuHAm7FwVYF4TNr9AePfSHX/vv8dqTYyL3vyM4cmG8irLpoLiw/GdxErKU5pufcvdSARBEMSZ8H8Pc8HtP/8Sq1AqIMTfj9SFDDmcjz/ddv6x6mN1G0urLCFig/7gICw2RENOxgbS29sDblQUdXuBiG4QvJgNes1RQ15yUFFm3KJKDwV13iGLo6YhZp6SyWozN6yuTU1c8fT+QxVFZR/W6LjOboDZsyTXgWuoiAiCIC5kfIznE9dl5Rdaf7oIIfrwrWoP1SWbBoz3/znwVFvHBanOgyQrv/eDX1QknDrybu4MtfoIuNlkkf8mhvZ9wUEyeoSGNJN/xy6TttxXoyp1YSY4GRPTM+ZqvOvfeSMrdO0qU96b7x196+vak1K8xIXElU37CIIg9zlKhuYv9/QCZ22Hs9YrWuGBq51YmiNzIEjrBPEEpeWQnpV5ZuerGTUL5s4ugekxeHCyGJJskBTHyGWQEP5w956Vi3OXLvAm7uR/gWtsm6YS/5g+VLf31PvFJ75Yk/T6vrKK5JaGZpX4Q5AJ6+PjeNciCII4OSmh5fQn1Qd3x55uadN/c6YVfrNeAXGcHM8DzTBgXBIG+sAANmZp5LbwQH8y93AyA5D/lcnt2LgxMRvUaWfC1gRtYXrUo7tAqv4h3K6Flkuvw3a02xQF7TNXFpeYK1d0Cem7aAB+Y3Pn9NqxIQiC3Gs4WsOpiNfoqH06hPBaJhwVkg8zyUaG3VA3roO6aSZI9gX7WVB5KGF7alDj2TzjckEIt9uE0N4v6E4XZPc7tAtae87LaQmt9Zb0ja9ldMuJkevlLmnsEYVlpwiCIE567tqfuaxMJmMZpZJlFAqWYRhWEELiC8rahJB2Q924hRgSjSAu6KRVYoSHZMOiwXPZy0xvPxdofFBOfW/7hALcv4mBtsUJ82ZpPjhUkO/X+OnRouXJz3ZB/1WA3j5p2RT7ExEEQZz1zL3rbfSkPIkIwwAHMMSBIXjOQFOu8cCxFyPCA3w86h0u1lUO7q78x0JiZmMiQ7MbqsojLTXm0ieWhAH09Eo9ihSFtzGCIAgClJAMqsiSqO88T74sLeLjxi0xwct8vbcJ5y7aMqy73SHfnil2ppriN7ecqE7aW5jf5EX2Ebt6AHCvEEEQBMWQvwZX81J0v7bmGmNfifVdD9c3zt8rfQkTa9sMLf9yR+ZLcee+O56S9MLabo4bkeNtgCAIcn/zjwADAM6kdmKCNGQ9AAAAAElFTkSuQmCC", "content_type": "image/png"}, "favicon.ico": {"data": "AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAvoYqxNexaN3gxp1sAAAAAP///wP///8H////CP///wj///8I////BAAAAADMyMFLjoR3yGFTQ7EAAAAAAAAAALNvAPTlqAD/3ao3/9ezeMzu3sdDAAAAAP///wT///8EAAAAAOTh3iiakoWwdmVG/1U4Bv8oFgD6AAAAAAAAAAC1cwPq5a0D/+erAP/nqgX/26pB/9ezfK/17eEk+fj4DqehlomCc172XUAb/1IzAP9aPwD/MiIA7QAAAAAAAAAAtXMD6uWtBP/ntBj/5q8X/+amAP/mrxz/165d9KGRc+NlUDD/RiYA/2FGF/9xWB3/X0QH/zIgAO0AAAAAAAAAALRzAuvkqgL/zJtC/+7YsqPRplL367IT/+CfAP+PWgD/VDoG/3ppSP60raSwbmFH/mBFDP8wHwDuAAAAAAAAAAC0cwLr5asD/9GiTP/Ivqy4fm9S+qBvDv+7gAD/pnAA/8CEAv/SpUH/5sqcwn5wUv9fRAz/MB8A7gAAAAAAAAAAtXMD6uevBP/Slgn/a0cI/0AjAP9jUDD/mI134d/Ai9XhsT7/6asA/+aqBf+/hwn/XkME/zEgAO0AAAAAAAAAALh1AernrwH/26AA/6V3Gv+GdlzyqqWgbv7+/wIAAAAA79i2UdSsaOHLmy3/lGYA/1g9AP8tHQDtAAAAAAAAAACWYgXq4KYF/+yzAP/psxf/16pW9OnOpXf8+fQR////AsG/vFCEemnhZ1It/1A4AP9nSAD/SzAA7QAAAAAAAAAAOCsM6oliC//Rmg3/564N/+enAP/irCT/06ph5KSYhcxuWj3/SSkA/1g8Cf+UbA3/zpUE/7NwAO0AAAAAAAAAADwsCutYPwn/c2VN/+LLpcDarUz767IK/+ChAP+SXwD/TjUE/3JjQ/+ooZLN1KVR/umyDf+zbwDuAAAAAAAAAAA9LQrrXkQJ/2xfSP/KyMObgG9P+bN+Dv/HiwD/n2kA/7F5Bf/GnUv/7NWvqMqaRf/mrQr/sW4A7gAAAAAAAAAAPi4L6mNJC/9qURf/ZEkW/0stAP9bRBz/koJf9Nm1cuvlsi//6KoA/+euEv/ptRf/5a0F/7JvAO0AAAAAAAAAAD4uC+piSAr/VTYA/1g7Df96aUz8mI+Cou/u7Rj//foJ3sCUgNasWfTkqxn/56oA/+SqAP+ybwDtAAAAAAAAAAA5KATyXUAE/3JdOP+LgHDK2tfSMgAAAAD///8E////Bf///wH58+oc2LaBqdqsS/3lqQr/r2kA+QAAAAAAAAAAUEEozoN4ZN/DvrdYAAAAAP///wP///8H////CP///wj///8I////BAAAAADw48460KZmyMCJObgAAAAA+B+AAPAPAADAAwAAgAEAAIABAAAAAAAAAADMHQAAAAAAAAAAAAAAAAAAAACAAQAAgAEAAMADAADwDwAA+B8AAA==", "content_type": "image/x-icon"}, "app/templates/stats.html": {"data": "IDwlIGlmICh0b3RhbCkgeyAlPgogICAgICAgIDxzcGFuIGNsYXNzPSJ0b2RvLWNvdW50Ij4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJudW1iZXIiPjwlPSByZW1haW5pbmcgJT48L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0id29yZCI+PCU9IHJlbWFpbmluZyA9PSAxID8gJ2l0ZW0nIDogJ2l0ZW1zJyAlPjwvc3Bhbj4gbGVmdC4KICAgICAgICA8L3NwYW4+CiAgICAgIDwlIH0gJT4KICAgICAgPCUgaWYgKGRvbmUpIHsgJT4KICAgICAgICA8c3BhbiBjbGFzcz0idG9kby1jbGVhciI+CiAgICAgICAgICA8YSBocmVmPSIjIj4KICAgICAgICAgICAgQ2xlYXIgPHNwYW4gY2xhc3M9Im51bWJlci1kb25lIj48JT0gZG9uZSAlPjwvc3Bhbj4KICAgICAgICAgICAgY29tcGxldGVkIDxzcGFuIGNsYXNzPSJ3b3JkLWRvbmUiPjwlPSBkb25lID09IDEgPyAnaXRlbScgOiAnaXRlbXMnICU+PC9zcGFuPgogICAgICAgICAgPC9hPgogICAgICAgIDwvc3Bhbj4KICAgICAgPCUgfSAlPgo=", "content_type": "text/html"}, "assets/js/libs/almond.js": {"data": "LyoqCiAqIGFsbW9uZCAwLjAuMyBDb3B5cmlnaHQgKGMpIDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICogQXZhaWxhYmxlIHZpYSB0aGUgTUlUIG9yIG5ldyBCU0QgbGljZW5zZS4KICogc2VlOiBodHRwOi8vZ2l0aHViLmNvbS9qcmJ1cmtlL2FsbW9uZCBmb3IgZGV0YWlscwogKi8KLypqc2xpbnQgc3RyaWN0OiBmYWxzZSwgcGx1c3BsdXM6IGZhbHNlICovCi8qZ2xvYmFsIHNldFRpbWVvdXQ6IGZhbHNlICovCgp2YXIgcmVxdWlyZWpzLCByZXF1aXJlLCBkZWZpbmU7CihmdW5jdGlvbiAodW5kZWYpIHsKCiAgICB2YXIgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBhcHMgPSBbXS5zbGljZSwKICAgICAgICBtYWluLCByZXE7CgogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAvL0lmIGEgZGVmaW5lIGlzIGFscmVhZHkgaW4gcGxheSB2aWEgYW5vdGhlciBBTUQgbG9hZGVyLAogICAgICAgIC8vZG8gbm90IG92ZXJ3cml0ZS4KICAgICAgICByZXR1cm47CiAgICB9CgogICAgLyoqCiAgICAgKiBHaXZlbiBhIHJlbGF0aXZlIG1vZHVsZSBuYW1lLCBsaWtlIC4vc29tZXRoaW5nLCBub3JtYWxpemUgaXQgdG8KICAgICAqIGEgcmVhbCBuYW1lIHRoYXQgY2FuIGJlIG1hcHBlZCB0byBhIHBhdGguCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgcmVsYXRpdmUgbmFtZQogICAgICogQHBhcmFtIHtTdHJpbmd9IGJhc2VOYW1lIGEgcmVhbCBuYW1lIHRoYXQgdGhlIG5hbWUgYXJnIGlzIHJlbGF0aXZlCiAgICAgKiB0by4KICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IG5vcm1hbGl6ZWQgbmFtZQogICAgICovCiAgICBmdW5jdGlvbiBub3JtYWxpemUobmFtZSwgYmFzZU5hbWUpIHsKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VOYW1lID0gYmFzZU5hbWUuc3BsaXQoIi8iKTsKICAgICAgICAgICAgICAgIGJhc2VOYW1lID0gYmFzZU5hbWUuc2xpY2UoMCwgYmFzZU5hbWUubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VOYW1lLmNvbmNhdChuYW1lLnNwbGl0KCIvIikpOwoKICAgICAgICAgICAgICAgIC8vc3RhcnQgdHJpbURvdHMKICAgICAgICAgICAgICAgIHZhciBpLCBwYXJ0OwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgKHBhcnQgPSBuYW1lW2ldKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09ICIuIikgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMSAmJiAobmFtZVsyXSA9PT0gJy4uJyB8fCBuYW1lWzBdID09PSAnLi4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9FbmQgb2YgdGhlIGxpbmUuIEtlZXAgYXQgbGVhc3Qgb25lIG5vbi1kb3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcGF0aCBzZWdtZW50IGF0IHRoZSBmcm9udCBzbyBpdCBjYW4gYmUgbWFwcGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvcnJlY3RseSB0byBkaXNrLiBPdGhlcndpc2UsIHRoZXJlIGlzIGxpa2VseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ubyBwYXRoIG1hcHBpbmcgZm9yIGEgcGF0aCBzdGFydGluZyB3aXRoICcuLicuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RoaXMgY2FuIHN0aWxsIGZhaWwsIGJ1dCBjYXRjaGVzIHRoZSBtb3N0IHJlYXNvbmFibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdXNlcyBvZiAuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGkgLSAxLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZW5kIHRyaW1Eb3RzCgogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuam9pbigiLyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VSZXF1aXJlKHJlbE5hbWUsIGZvcmNlU3luYykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vQSB2ZXJzaW9uIG9mIGEgcmVxdWlyZSBmdW5jdGlvbiB0aGF0IHBhc3NlcyBhIG1vZHVsZU5hbWUKICAgICAgICAgICAgLy92YWx1ZSBmb3IgaXRlbXMgdGhhdCBtYXkgbmVlZCB0bwogICAgICAgICAgICAvL2xvb2sgdXAgcGF0aHMgcmVsYXRpdmUgdG8gdGhlIG1vZHVsZU5hbWUKICAgICAgICAgICAgcmV0dXJuIHJlcS5hcHBseSh1bmRlZiwgYXBzLmNhbGwoYXJndW1lbnRzLCAwKS5jb25jYXQoW3JlbE5hbWUsIGZvcmNlU3luY10pKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VOb3JtYWxpemUocmVsTmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZUxvYWQoZGVwTmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgZGVmaW5lZFtkZXBOYW1lXSA9IHZhbHVlOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gY2FsbERlcChuYW1lKSB7CiAgICAgICAgaWYgKHdhaXRpbmcuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSB3YWl0aW5nW25hbWVdOwogICAgICAgICAgICBkZWxldGUgd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZWZpbmVkW25hbWVdOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgYSBuYW1lIG1hcCwgbm9ybWFsaXppbmcgdGhlIG5hbWUsIGFuZCB1c2luZyBhIHBsdWdpbgogICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW4KICAgICAqIHRvbywgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBtYWtlTWFwKG5hbWUsIHJlbE5hbWUpIHsKICAgICAgICB2YXIgcHJlZml4LCBwbHVnaW4sCiAgICAgICAgICAgIGluZGV4ID0gbmFtZS5pbmRleE9mKCchJyk7CgogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgcHJlZml4ID0gbm9ybWFsaXplKG5hbWUuc2xpY2UoMCwgaW5kZXgpLCByZWxOYW1lKTsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc2xpY2UoaW5kZXggKyAxKTsKICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwoKICAgICAgICAgICAgLy9Ob3JtYWxpemUgYWNjb3JkaW5nCiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9CgogICAgICAgIC8vVXNpbmcgcmlkaWN1bG91cyBwcm9wZXJ0eSBuYW1lcyBmb3Igc3BhY2UgcmVhc29ucwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGY6IHByZWZpeCA/IHByZWZpeCArICchJyArIG5hbWUgOiBuYW1lLCAvL2Z1bGxOYW1lCiAgICAgICAgICAgIG46IG5hbWUsCiAgICAgICAgICAgIHA6IHBsdWdpbgogICAgICAgIH07CiAgICB9CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBhcmdzID0gW10sCiAgICAgICAgICAgIHVzaW5nRXhwb3J0cywKICAgICAgICAgICAgY2pzTW9kdWxlLCBkZXBOYW1lLCBpLCByZXQsIG1hcDsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgaWYgKCFyZWxOYW1lKSB7CiAgICAgICAgICAgIHJlbE5hbWUgPSBuYW1lOwogICAgICAgIH0KCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAgIC8vRGVmYXVsdCB0byByZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUgaWYgbm8gZGVwcyBpZgogICAgICAgICAgICAvL3RoZSBmYWN0b3J5IGFyZyBoYXMgYW55IGFyZ3VtZW50cyBzcGVjaWZpZWQuCiAgICAgICAgICAgIGlmICghZGVwcy5sZW5ndGggJiYgY2FsbGJhY2subGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBkZXBzID0gWydyZXF1aXJlJywgJ2V4cG9ydHMnLCAnbW9kdWxlJ107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkCiAgICAgICAgICAgIC8vdmFsdWVzIHRvIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRlcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIG1hcCA9IG1ha2VNYXAoZGVwc1tpXSwgcmVsTmFtZSk7CiAgICAgICAgICAgICAgICBkZXBOYW1lID0gbWFwLmY7CgogICAgICAgICAgICAgICAgLy9GYXN0IHBhdGggQ29tbW9uSlMgc3RhbmRhcmQgZGVwZW5kZW5jaWVzLgogICAgICAgICAgICAgICAgaWYgKGRlcE5hbWUgPT09ICJyZXF1aXJlIikgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBtYWtlUmVxdWlyZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gZGVmaW5lZFtuYW1lXSA9IHt9OwogICAgICAgICAgICAgICAgICAgIHVzaW5nRXhwb3J0cyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcE5hbWUgPT09ICJtb2R1bGUiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUgPSBhcmdzW2ldID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgdXJpOiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlZmluZWQuaGFzT3duUHJvcGVydHkoZGVwTmFtZSkgfHwgd2FpdGluZy5oYXNPd25Qcm9wZXJ0eShkZXBOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBjYWxsRGVwKGRlcE5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYXAucCkgewogICAgICAgICAgICAgICAgICAgIG1hcC5wLmxvYWQobWFwLm4sIG1ha2VSZXF1aXJlKHJlbE5hbWUsIHRydWUpLCBtYWtlTG9hZChkZXBOYW1lKSwge30pOwogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBkZWZpbmVkW2RlcE5hbWVdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXQgPSBjYWxsYmFjay5hcHBseShkZWZpbmVkW25hbWVdLCBhcmdzKTsKCiAgICAgICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICAgICAgICAvL0lmIHNldHRpbmcgZXhwb3J0cyB2aWEgIm1vZHVsZSIgaXMgaW4gcGxheSwKICAgICAgICAgICAgICAgIC8vZmF2b3IgdGhhdCBvdmVyIHJldHVybiB2YWx1ZSBhbmQgZXhwb3J0cy4gQWZ0ZXIgdGhhdCwKICAgICAgICAgICAgICAgIC8vZmF2b3IgYSBub24tdW5kZWZpbmVkIHJldHVybiB2YWx1ZSBvdmVyIGV4cG9ydHMgdXNlLgogICAgICAgICAgICAgICAgaWYgKGNqc01vZHVsZSAmJiBjanNNb2R1bGUuZXhwb3J0cyAhPT0gdW5kZWYpIHsKICAgICAgICAgICAgICAgICAgICBkZWZpbmVkW25hbWVdID0gY2pzTW9kdWxlLmV4cG9ydHM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxID0gZnVuY3Rpb24gKGRlcHMsIGNhbGxiYWNrLCByZWxOYW1lLCBmb3JjZVN5bmMpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CgogICAgICAgICAgICAvL0p1c3QgcmV0dXJuIHRoZSBtb2R1bGUgd2FudGVkLiBJbiB0aGlzIHNjZW5hcmlvLCB0aGUKICAgICAgICAgICAgLy9kZXBzIGFyZyBpcyB0aGUgbW9kdWxlIG5hbWUsIGFuZCBzZWNvbmQgYXJnIChpZiBwYXNzZWQpCiAgICAgICAgICAgIC8vaXMganVzdCB0aGUgcmVsTmFtZS4KICAgICAgICAgICAgLy9Ob3JtYWxpemUgbW9kdWxlIG5hbWUsIGlmIGl0IGNvbnRhaW5zIC4gb3IgLi4KICAgICAgICAgICAgcmV0dXJuIGNhbGxEZXAobWFrZU1hcChkZXBzLCBjYWxsYmFjaykuZik7CiAgICAgICAgfSBlbHNlIGlmICghZGVwcy5zcGxpY2UpIHsKICAgICAgICAgICAgLy9kZXBzIGlzIGEgY29uZmlnIG9iamVjdCwgbm90IGFuIGFycmF5LgogICAgICAgICAgICAvL0Ryb3AgdGhlIGNvbmZpZyBzdHVmZiBvbiB0aGUgZ3JvdW5kLgogICAgICAgICAgICBpZiAoY2FsbGJhY2suc3BsaWNlKSB7CiAgICAgICAgICAgICAgICAvL2NhbGxiYWNrIGlzIGFuIGFycmF5LCB3aGljaCBtZWFucyBpdCBpcyBhIGRlcGVuZGVuY3kgbGlzdC4KICAgICAgICAgICAgICAgIC8vQWRqdXN0IGFyZ3MgaWYgdGhlcmUgYXJlIGRlcGVuZGVuY2llcwogICAgICAgICAgICAgICAgZGVwcyA9IGNhbGxiYWNrOwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBhcmd1bWVudHNbMl07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZXBzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vU2ltdWxhdGUgYXN5bmMgY2FsbGJhY2s7CiAgICAgICAgaWYgKGZvcmNlU3luYykgewogICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgICAgIH0sIDE1KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH07CgogICAgLyoqCiAgICAgKiBFeHBvcnQgcmVxdWlyZSBhcyBhIGdsb2JhbCwgYnV0IG9ubHkgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdC4KICAgICAqLwogICAgaWYgKCFyZXF1aXJlKSB7CiAgICAgICAgcmVxdWlyZSA9IHJlcTsKICAgIH0KCiAgICBkZWZpbmUgPSBmdW5jdGlvbiAobmFtZSwgZGVwcywgY2FsbGJhY2spIHsKCiAgICAgICAgLy9UaGlzIG1vZHVsZSBtYXkgbm90IGhhdmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKCFkZXBzLnNwbGljZSkgewogICAgICAgICAgICAvL2RlcHMgaXMgbm90IGFuIGFycmF5LCBzbyBwcm9iYWJseSBtZWFucwogICAgICAgICAgICAvL2FuIG9iamVjdCBsaXRlcmFsIG9yIGZhY3RvcnkgZnVuY3Rpb24gZm9yCiAgICAgICAgICAgIC8vdGhlIHZhbHVlLiBBZGp1c3QgYXJncy4KICAgICAgICAgICAgY2FsbGJhY2sgPSBkZXBzOwogICAgICAgICAgICBkZXBzID0gW107CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVmaW5lLnVub3JkZXJlZCkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYWluKG5hbWUsIGRlcHMsIGNhbGxiYWNrKTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwo=", "content_type": "application/javascript"}, "test/jasmine/vendor/jasmine.css": {"data": "Ym9keSB7CiAgZm9udC1mYW1pbHk6ICJIZWx2ZXRpY2EgTmV1ZSBMaWdodCIsICJMdWNpZGEgR3JhbmRlIiwgIkNhbGlicmkiLCAiQXJpYWwiLCBzYW5zLXNlcmlmOwp9CgoKLmphc21pbmVfcmVwb3J0ZXIgYTp2aXNpdGVkLCAuamFzbWluZV9yZXBvcnRlciBhIHsKICBjb2xvcjogIzMwMzsgCn0KCi5qYXNtaW5lX3JlcG9ydGVyIGE6aG92ZXIsIC5qYXNtaW5lX3JlcG9ydGVyIGE6YWN0aXZlIHsKICBjb2xvcjogYmx1ZTsgCn0KCi5ydW5fc3BlYyB7CiAgZmxvYXQ6cmlnaHQ7CiAgcGFkZGluZy1yaWdodDogNXB4OwogIGZvbnQtc2l6ZTogLjhlbTsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCi5qYXNtaW5lX3JlcG9ydGVyIHsKICBtYXJnaW46IDAgNXB4Owp9CgouYmFubmVyIHsKICBjb2xvcjogIzMwMzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmOwogIHBhZGRpbmc6IDVweDsKfQoKLmxvZ28gewogIGZsb2F0OiBsZWZ0OwogIGZvbnQtc2l6ZTogMS4xZW07CiAgcGFkZGluZy1sZWZ0OiA1cHg7Cn0KCi5sb2dvIC52ZXJzaW9uIHsKICBmb250LXNpemU6IC42ZW07CiAgcGFkZGluZy1sZWZ0OiAxZW07Cn0KCi5ydW5uZXIucnVubmluZyB7CiAgYmFja2dyb3VuZC1jb2xvcjogeWVsbG93Owp9CgoKLm9wdGlvbnMgewogIHRleHQtYWxpZ246IHJpZ2h0OwogIGZvbnQtc2l6ZTogLjhlbTsKfQoKCgoKLnN1aXRlIHsKICBib3JkZXI6IDFweCBvdXRzZXQgZ3JheTsKICBtYXJnaW46IDVweCAwOwogIHBhZGRpbmctbGVmdDogMWVtOwp9Cgouc3VpdGUgLnN1aXRlIHsKICBtYXJnaW46IDVweDsgCn0KCi5zdWl0ZS5wYXNzZWQgewogIGJhY2tncm91bmQtY29sb3I6ICNkZmQ7Cn0KCi5zdWl0ZS5mYWlsZWQgewogIGJhY2tncm91bmQtY29sb3I6ICNmZGQ7Cn0KCi5zcGVjIHsKICBtYXJnaW46IDVweDsKICBwYWRkaW5nLWxlZnQ6IDFlbTsKICBjbGVhcjogYm90aDsKfQoKLnNwZWMuZmFpbGVkLCAuc3BlYy5wYXNzZWQsIC5zcGVjLnNraXBwZWQgewogIHBhZGRpbmctYm90dG9tOiA1cHg7CiAgYm9yZGVyOiAxcHggc29saWQgZ3JheTsKfQoKLnNwZWMuZmFpbGVkIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmJiOwogIGJvcmRlci1jb2xvcjogcmVkOwp9Cgouc3BlYy5wYXNzZWQgewogIGJhY2tncm91bmQtY29sb3I6ICNiZmI7CiAgYm9yZGVyLWNvbG9yOiBncmVlbjsKfQoKLnNwZWMuc2tpcHBlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2JiYjsKfQoKLm1lc3NhZ2VzIHsKICBib3JkZXItbGVmdDogMXB4IGRhc2hlZCBncmF5OwogIHBhZGRpbmctbGVmdDogMWVtOwogIHBhZGRpbmctcmlnaHQ6IDFlbTsKfQoKLnBhc3NlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2NmYzsKICBkaXNwbGF5OiBub25lOwp9CgouZmFpbGVkIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmJiOwp9Cgouc2tpcHBlZCB7CiAgY29sb3I6ICM3Nzc7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTsKICBkaXNwbGF5OiBub25lOwp9CgoKLyoucmVzdWx0TWVzc2FnZSB7Ki8KICAvKndoaXRlLXNwYWNlOiBwcmU7Ki8KLyp9Ki8KCi5yZXN1bHRNZXNzYWdlIHNwYW4ucmVzdWx0IHsKICBkaXNwbGF5OiBibG9jazsKICBsaW5lLWhlaWdodDogMmVtOwogIGNvbG9yOiBibGFjazsKfQoKLnJlc3VsdE1lc3NhZ2UgLm1pc21hdGNoIHsKICBjb2xvcjogYmxhY2s7Cn0KCi5zdGFja1RyYWNlIHsKICB3aGl0ZS1zcGFjZTogcHJlOwogIGZvbnQtc2l6ZTogLjhlbTsKICBtYXJnaW4tbGVmdDogMTBweDsKICBtYXgtaGVpZ2h0OiA1ZW07CiAgb3ZlcmZsb3c6IGF1dG87CiAgYm9yZGVyOiAxcHggaW5zZXQgcmVkOwogIHBhZGRpbmc6IDFlbTsKICBiYWNrZ3JvdW5kOiAjZWVmOwp9CgouZmluaXNoZWQtYXQgewogIHBhZGRpbmctbGVmdDogMWVtOwogIGZvbnQtc2l6ZTogLjZlbTsKfQoKLnNob3ctcGFzc2VkIC5wYXNzZWQsCi5zaG93LXNraXBwZWQgLnNraXBwZWQgewogIGRpc3BsYXk6IGJsb2NrOwp9CgoKI2phc21pbmVfY29udGVudCB7CiAgcG9zaXRpb246Zml4ZWQ7CiAgcmlnaHQ6IDEwMCU7Cn0KCi5ydW5uZXIgewogIGJvcmRlcjogMXB4IHNvbGlkIGdyYXk7CiAgZGlzcGxheTogYmxvY2s7CiAgbWFyZ2luOiA1cHggMDsKICBwYWRkaW5nOiAycHggMCAycHggMTBweDsKfQo=", "content_type": "text/css"}, "assets/js/libs/backbone.js": {"data": "Ly8gICAgIEJhY2tib25lLmpzIDAuOS4yCgovLyAgICAgKGMpIDIwMTAtMjAxMiBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgSW5jLgovLyAgICAgQmFja2JvbmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246Ci8vICAgICBodHRwOi8vYmFja2JvbmVqcy5vcmcKCihmdW5jdGlvbigpewoKICAvLyBJbml0aWFsIFNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0IChgd2luZG93YCBpbiB0aGUgYnJvd3NlciwgYGdsb2JhbGAKICAvLyBvbiB0aGUgc2VydmVyKS4KICB2YXIgcm9vdCA9IHRoaXM7CgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBhIGxvY2FsIHJlZmVyZW5jZSB0byBzbGljZS9zcGxpY2UuCiAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogIHZhciBzcGxpY2UgPSBBcnJheS5wcm90b3R5cGUuc3BsaWNlOwoKICAvLyBUaGUgdG9wLWxldmVsIG5hbWVzcGFjZS4gQWxsIHB1YmxpYyBCYWNrYm9uZSBjbGFzc2VzIGFuZCBtb2R1bGVzIHdpbGwKICAvLyBiZSBhdHRhY2hlZCB0byB0aGlzLiBFeHBvcnRlZCBmb3IgYm90aCBDb21tb25KUyBhbmQgdGhlIGJyb3dzZXIuCiAgdmFyIEJhY2tib25lOwogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIEJhY2tib25lID0gZXhwb3J0czsKICB9IGVsc2UgewogICAgQmFja2JvbmUgPSByb290LkJhY2tib25lID0ge307CiAgfQoKICAvLyBDdXJyZW50IHZlcnNpb24gb2YgdGhlIGxpYnJhcnkuIEtlZXAgaW4gc3luYyB3aXRoIGBwYWNrYWdlLmpzb25gLgogIEJhY2tib25lLlZFUlNJT04gPSAnMC45LjInOwoKICAvLyBSZXF1aXJlIFVuZGVyc2NvcmUsIGlmIHdlJ3JlIG9uIHRoZSBzZXJ2ZXIsIGFuZCBpdCdzIG5vdCBhbHJlYWR5IHByZXNlbnQuCiAgdmFyIF8gPSByb290Ll87CiAgaWYgKCFfICYmICh0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcpKSBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwoKICAvLyBGb3IgQmFja2JvbmUncyBwdXJwb3NlcywgalF1ZXJ5LCBaZXB0bywgb3IgRW5kZXIgb3ducyB0aGUgYCRgIHZhcmlhYmxlLgogIHZhciAkID0gcm9vdC5qUXVlcnkgfHwgcm9vdC5aZXB0byB8fCByb290LmVuZGVyOwoKICAvLyBTZXQgdGhlIEphdmFTY3JpcHQgbGlicmFyeSB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgRE9NIG1hbmlwdWxhdGlvbiBhbmQKICAvLyBBamF4IGNhbGxzIChhLmsuYS4gdGhlIGAkYCB2YXJpYWJsZSkuIEJ5IGRlZmF1bHQgQmFja2JvbmUgd2lsbCB1c2U6IGpRdWVyeSwKICAvLyBaZXB0bywgb3IgRW5kZXI7IGJ1dCB0aGUgYHNldERvbUxpYnJhcnkoKWAgbWV0aG9kIGxldHMgeW91IGluamVjdCBhbgogIC8vIGFsdGVybmF0ZSBKYXZhU2NyaXB0IGxpYnJhcnkgKG9yIGEgbW9jayBsaWJyYXJ5IGZvciB0ZXN0aW5nIHlvdXIgdmlld3MKICAvLyBvdXRzaWRlIG9mIGEgYnJvd3NlcikuCiAgQmFja2JvbmUuc2V0RG9tTGlicmFyeSA9IGZ1bmN0aW9uKGxpYikgewogICAgJCA9IGxpYjsKICB9OwoKICAvLyBSdW5zIEJhY2tib25lLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUKICAvLyB0byBpdHMgcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhpcyBCYWNrYm9uZSBvYmplY3QuCiAgQmFja2JvbmUubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5CYWNrYm9uZSA9IHByZXZpb3VzQmFja2JvbmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBUdXJuIG9uIGBlbXVsYXRlSFRUUGAgdG8gc3VwcG9ydCBsZWdhY3kgSFRUUCBzZXJ2ZXJzLiBTZXR0aW5nIHRoaXMgb3B0aW9uCiAgLy8gd2lsbCBmYWtlIGAiUFVUImAgYW5kIGAiREVMRVRFImAgcmVxdWVzdHMgdmlhIHRoZSBgX21ldGhvZGAgcGFyYW1ldGVyIGFuZAogIC8vIHNldCBhIGBYLUh0dHAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCiAgQmFja2JvbmUuZW11bGF0ZUhUVFAgPSBmYWxzZTsKCiAgLy8gVHVybiBvbiBgZW11bGF0ZUpTT05gIHRvIHN1cHBvcnQgbGVnYWN5IHNlcnZlcnMgdGhhdCBjYW4ndCBkZWFsIHdpdGggZGlyZWN0CiAgLy8gYGFwcGxpY2F0aW9uL2pzb25gIHJlcXVlc3RzIC4uLiB3aWxsIGVuY29kZSB0aGUgYm9keSBhcwogIC8vIGBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRgIGluc3RlYWQgYW5kIHdpbGwgc2VuZCB0aGUgbW9kZWwgaW4gYQogIC8vIGZvcm0gcGFyYW0gbmFtZWQgYG1vZGVsYC4KICBCYWNrYm9uZS5lbXVsYXRlSlNPTiA9IGZhbHNlOwoKICAvLyBCYWNrYm9uZS5FdmVudHMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZWd1bGFyIGV4cHJlc3Npb24gdXNlZCB0byBzcGxpdCBldmVudCBzdHJpbmdzCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gQSBtb2R1bGUgdGhhdCBjYW4gYmUgbWl4ZWQgaW4gdG8gKmFueSBvYmplY3QqIGluIG9yZGVyIHRvIHByb3ZpZGUgaXQgd2l0aAogIC8vIGN1c3RvbSBldmVudHMuIFlvdSBtYXkgYmluZCB3aXRoIGBvbmAgb3IgcmVtb3ZlIHdpdGggYG9mZmAgY2FsbGJhY2sgZnVuY3Rpb25zCiAgLy8gdG8gYW4gZXZlbnQ7IHRyaWdnZXJgLWluZyBhbiBldmVudCBmaXJlcyBhbGwgY2FsbGJhY2tzIGluIHN1Y2Nlc3Npb24uCiAgLy8KICAvLyAgICAgdmFyIG9iamVjdCA9IHt9OwogIC8vICAgICBfLmV4dGVuZChvYmplY3QsIEJhY2tib25lLkV2ZW50cyk7CiAgLy8gICAgIG9iamVjdC5vbignZXhwYW5kJywgZnVuY3Rpb24oKXsgYWxlcnQoJ2V4cGFuZGVkJyk7IH0pOwogIC8vICAgICBvYmplY3QudHJpZ2dlcignZXhwYW5kJyk7CiAgLy8KICB2YXIgRXZlbnRzID0gQmFja2JvbmUuRXZlbnRzID0gewoKICAgIC8vIEJpbmQgb25lIG9yIG1vcmUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50cywgYGV2ZW50c2AsIHRvIGEgYGNhbGxiYWNrYAogICAgLy8gZnVuY3Rpb24uIFBhc3NpbmcgYCJhbGwiYCB3aWxsIGJpbmQgdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24oZXZlbnRzLCBjYWxsYmFjaywgY29udGV4dCkgewoKICAgICAgdmFyIGNhbGxzLCBldmVudCwgbm9kZSwgdGFpbCwgbGlzdDsKICAgICAgaWYgKCFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MgfHwgKHRoaXMuX2NhbGxiYWNrcyA9IHt9KTsKCiAgICAgIC8vIENyZWF0ZSBhbiBpbW11dGFibGUgY2FsbGJhY2sgbGlzdCwgYWxsb3dpbmcgdHJhdmVyc2FsIGR1cmluZwogICAgICAvLyBtb2RpZmljYXRpb24uICBUaGUgdGFpbCBpcyBhbiBlbXB0eSBvYmplY3QgdGhhdCB3aWxsIGFsd2F5cyBiZSB1c2VkCiAgICAgIC8vIGFzIHRoZSBuZXh0IG5vZGUuCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbGlzdCA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBub2RlID0gbGlzdCA/IGxpc3QudGFpbCA6IHt9OwogICAgICAgIG5vZGUubmV4dCA9IHRhaWwgPSB7fTsKICAgICAgICBub2RlLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIG5vZGUuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICBjYWxsc1tldmVudF0gPSB7dGFpbDogdGFpbCwgbmV4dDogbGlzdCA/IGxpc3QubmV4dCA6IG5vZGV9OwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIG9uZSBvciBtYW55IGNhbGxiYWNrcy4gSWYgYGNvbnRleHRgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGNhbGxiYWNrcwogICAgLy8gd2l0aCB0aGF0IGZ1bmN0aW9uLiBJZiBgY2FsbGJhY2tgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGNhbGxiYWNrcyBmb3IgdGhlCiAgICAvLyBldmVudC4gSWYgYGV2ZW50c2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQgY2FsbGJhY2tzIGZvciBhbGwgZXZlbnRzLgogICAgb2ZmOiBmdW5jdGlvbihldmVudHMsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIHZhciBldmVudCwgY2FsbHMsIG5vZGUsIHRhaWwsIGNiLCBjdHg7CgogICAgICAvLyBObyBldmVudHMsIG9yIHJlbW92aW5nICphbGwqIGV2ZW50cy4KICAgICAgaWYgKCEoY2FsbHMgPSB0aGlzLl9jYWxsYmFja3MpKSByZXR1cm47CiAgICAgIGlmICghKGV2ZW50cyB8fCBjYWxsYmFjayB8fCBjb250ZXh0KSkgewogICAgICAgIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3M7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgbGlzdGVkIGV2ZW50cyBhbmQgY29udGV4dHMsIHNwbGljaW5nIHRoZW0gb3V0IG9mIHRoZQogICAgICAvLyBsaW5rZWQgbGlzdCBvZiBjYWxsYmFja3MgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGV2ZW50cyA9IGV2ZW50cyA/IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKSA6IF8ua2V5cyhjYWxscyk7CiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgbm9kZSA9IGNhbGxzW2V2ZW50XTsKICAgICAgICBkZWxldGUgY2FsbHNbZXZlbnRdOwogICAgICAgIGlmICghbm9kZSB8fCAhKGNhbGxiYWNrIHx8IGNvbnRleHQpKSBjb250aW51ZTsKICAgICAgICAvLyBDcmVhdGUgYSBuZXcgbGlzdCwgb21pdHRpbmcgdGhlIGluZGljYXRlZCBjYWxsYmFja3MuCiAgICAgICAgdGFpbCA9IG5vZGUudGFpbDsKICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpICE9PSB0YWlsKSB7CiAgICAgICAgICBjYiA9IG5vZGUuY2FsbGJhY2s7CiAgICAgICAgICBjdHggPSBub2RlLmNvbnRleHQ7CiAgICAgICAgICBpZiAoKGNhbGxiYWNrICYmIGNiICE9PSBjYWxsYmFjaykgfHwgKGNvbnRleHQgJiYgY3R4ICE9PSBjb250ZXh0KSkgewogICAgICAgICAgICB0aGlzLm9uKGV2ZW50LCBjYiwgY3R4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihldmVudHMpIHsKICAgICAgdmFyIGV2ZW50LCBub2RlLCBjYWxscywgdGFpbCwgYXJncywgYWxsLCByZXN0OwogICAgICBpZiAoIShjYWxscyA9IHRoaXMuX2NhbGxiYWNrcykpIHJldHVybiB0aGlzOwogICAgICBhbGwgPSBjYWxscy5hbGw7CiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICAgIC8vIEZvciBlYWNoIGV2ZW50LCB3YWxrIHRocm91Z2ggdGhlIGxpbmtlZCBsaXN0IG9mIGNhbGxiYWNrcyB0d2ljZSwKICAgICAgLy8gZmlyc3QgdG8gdHJpZ2dlciB0aGUgZXZlbnQsIHRoZW4gdG8gdHJpZ2dlciBhbnkgYCJhbGwiYCBjYWxsYmFja3MuCiAgICAgIHdoaWxlIChldmVudCA9IGV2ZW50cy5zaGlmdCgpKSB7CiAgICAgICAgaWYgKG5vZGUgPSBjYWxsc1tldmVudF0pIHsKICAgICAgICAgIHRhaWwgPSBub2RlLnRhaWw7CiAgICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHQpICE9PSB0YWlsKSB7CiAgICAgICAgICAgIG5vZGUuY2FsbGJhY2suYXBwbHkobm9kZS5jb250ZXh0IHx8IHRoaXMsIHJlc3QpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobm9kZSA9IGFsbCkgewogICAgICAgICAgdGFpbCA9IG5vZGUudGFpbDsKICAgICAgICAgIGFyZ3MgPSBbZXZlbnRdLmNvbmNhdChyZXN0KTsKICAgICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dCkgIT09IHRhaWwpIHsKICAgICAgICAgICAgbm9kZS5jYWxsYmFjay5hcHBseShub2RlLmNvbnRleHQgfHwgdGhpcywgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwsIHdpdGggZGVmaW5lZCBhdHRyaWJ1dGVzLiBBIGNsaWVudCBpZCAoYGNpZGApCiAgLy8gaXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIGFzc2lnbmVkIGZvciB5b3UuCiAgdmFyIE1vZGVsID0gQmFja2JvbmUuTW9kZWwgPSBmdW5jdGlvbihhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICB2YXIgZGVmYXVsdHM7CiAgICBhdHRyaWJ1dGVzIHx8IChhdHRyaWJ1dGVzID0ge30pOwogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJzZSkgYXR0cmlidXRlcyA9IHRoaXMucGFyc2UoYXR0cmlidXRlcyk7CiAgICBpZiAoZGVmYXVsdHMgPSBnZXRWYWx1ZSh0aGlzLCAnZGVmYXVsdHMnKSkgewogICAgICBhdHRyaWJ1dGVzID0gXy5leHRlbmQoe30sIGRlZmF1bHRzLCBhdHRyaWJ1dGVzKTsKICAgIH0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgdGhpcy5hdHRyaWJ1dGVzID0ge307CiAgICB0aGlzLl9lc2NhcGVkQXR0cmlidXRlcyA9IHt9OwogICAgdGhpcy5jaWQgPSBfLnVuaXF1ZUlkKCdjJyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuX3NpbGVudCA9IHt9OwogICAgdGhpcy5fcGVuZGluZyA9IHt9OwogICAgdGhpcy5zZXQoYXR0cmlidXRlcywge3NpbGVudDogdHJ1ZX0pOwogICAgLy8gUmVzZXQgY2hhbmdlIHRyYWNraW5nLgogICAgdGhpcy5jaGFuZ2VkID0ge307CiAgICB0aGlzLl9zaWxlbnQgPSB7fTsKICAgIHRoaXMuX3BlbmRpbmcgPSB7fTsKICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBBIGhhc2ggb2YgYXR0cmlidXRlcyB0aGF0IGhhdmUgc2lsZW50bHkgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCB0aW1lCiAgICAvLyBgY2hhbmdlYCB3YXMgY2FsbGVkLiAgV2lsbCBiZWNvbWUgcGVuZGluZyBhdHRyaWJ1dGVzIG9uIHRoZSBuZXh0IGNhbGwuCiAgICBfc2lsZW50OiBudWxsLAoKICAgIC8vIEEgaGFzaCBvZiBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAnY2hhbmdlJ2AgZXZlbnQKICAgIC8vIGJlZ2FuLgogICAgX3BlbmRpbmc6IG51bGwsCgogICAgLy8gVGhlIGRlZmF1bHQgbmFtZSBmb3IgdGhlIEpTT04gYGlkYCBhdHRyaWJ1dGUgaXMgYCJpZCJgLiBNb25nb0RCIGFuZAogICAgLy8gQ291Y2hEQiB1c2VycyBtYXkgd2FudCB0byBzZXQgdGhpcyB0byBgIl9pZCJgLgogICAgaWRBdHRyaWJ1dGU6ICdpZCcsCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBtb2RlbCdzIGBhdHRyaWJ1dGVzYCBvYmplY3QuCiAgICB0b0pTT046IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuCiAgICBnZXQ6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyXTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBIVE1MLWVzY2FwZWQgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZXNjYXBlOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHZhciBodG1sOwogICAgICBpZiAoaHRtbCA9IHRoaXMuX2VzY2FwZWRBdHRyaWJ1dGVzW2F0dHJdKSByZXR1cm4gaHRtbDsKICAgICAgdmFyIHZhbCA9IHRoaXMuZ2V0KGF0dHIpOwogICAgICByZXR1cm4gdGhpcy5fZXNjYXBlZEF0dHJpYnV0ZXNbYXR0cl0gPSBfLmVzY2FwZSh2YWwgPT0gbnVsbCA/ICcnIDogJycgKyB2YWwpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAgdW5sZXNzCiAgICAvLyB5b3UgY2hvb3NlIHRvIHNpbGVuY2UgaXQuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzLCBhdHRyLCB2YWw7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKF8uaXNPYmplY3Qoa2V5KSB8fCBrZXkgPT0gbnVsbCkgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdHRycyA9IHt9OwogICAgICAgIGF0dHJzW2tleV0gPSB2YWx1ZTsKICAgICAgfQoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBpZiAoIWF0dHJzKSByZXR1cm4gdGhpczsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIGF0dHJzID0gYXR0cnMuYXR0cmlidXRlczsKICAgICAgaWYgKG9wdGlvbnMudW5zZXQpIGZvciAoYXR0ciBpbiBhdHRycykgYXR0cnNbYXR0cl0gPSB2b2lkIDA7CgogICAgICAvLyBSdW4gdmFsaWRhdGlvbi4KICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKCiAgICAgIC8vIENoZWNrIGZvciBjaGFuZ2VzIG9mIGBpZGAuCiAgICAgIGlmICh0aGlzLmlkQXR0cmlidXRlIGluIGF0dHJzKSB0aGlzLmlkID0gYXR0cnNbdGhpcy5pZEF0dHJpYnV0ZV07CgogICAgICB2YXIgY2hhbmdlcyA9IG9wdGlvbnMuY2hhbmdlcyA9IHt9OwogICAgICB2YXIgbm93ID0gdGhpcy5hdHRyaWJ1dGVzOwogICAgICB2YXIgZXNjYXBlZCA9IHRoaXMuX2VzY2FwZWRBdHRyaWJ1dGVzOwogICAgICB2YXIgcHJldiA9IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyB8fCB7fTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZS4uLgogICAgICBmb3IgKGF0dHIgaW4gYXR0cnMpIHsKICAgICAgICB2YWwgPSBhdHRyc1thdHRyXTsKCiAgICAgICAgLy8gSWYgdGhlIG5ldyBhbmQgY3VycmVudCB2YWx1ZSBkaWZmZXIsIHJlY29yZCB0aGUgY2hhbmdlLgogICAgICAgIGlmICghXy5pc0VxdWFsKG5vd1thdHRyXSwgdmFsKSB8fCAob3B0aW9ucy51bnNldCAmJiBfLmhhcyhub3csIGF0dHIpKSkgewogICAgICAgICAgZGVsZXRlIGVzY2FwZWRbYXR0cl07CiAgICAgICAgICAob3B0aW9ucy5zaWxlbnQgPyB0aGlzLl9zaWxlbnQgOiBjaGFuZ2VzKVthdHRyXSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgb3IgZGVsZXRlIHRoZSBjdXJyZW50IHZhbHVlLgogICAgICAgIG9wdGlvbnMudW5zZXQgPyBkZWxldGUgbm93W2F0dHJdIDogbm93W2F0dHJdID0gdmFsOwoKICAgICAgICAvLyBJZiB0aGUgbmV3IGFuZCBwcmV2aW91cyB2YWx1ZSBkaWZmZXIsIHJlY29yZCB0aGUgY2hhbmdlLiAgSWYgbm90LAogICAgICAgIC8vIHRoZW4gcmVtb3ZlIGNoYW5nZXMgZm9yIHRoaXMgYXR0cmlidXRlLgogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkgfHwgKF8uaGFzKG5vdywgYXR0cikgIT0gXy5oYXMocHJldiwgYXR0cikpKSB7CiAgICAgICAgICB0aGlzLmNoYW5nZWRbYXR0cl0gPSB2YWw7CiAgICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLl9wZW5kaW5nW2F0dHJdID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICAgIGRlbGV0ZSB0aGlzLl9wZW5kaW5nW2F0dHJdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gRmlyZSB0aGUgYCJjaGFuZ2UiYCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMuY2hhbmdlKG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGFuIGF0dHJpYnV0ZSBmcm9tIHRoZSBtb2RlbCwgZmlyaW5nIGAiY2hhbmdlImAgdW5sZXNzIHlvdSBjaG9vc2UKICAgIC8vIHRvIHNpbGVuY2UgaXQuIGB1bnNldGAgaXMgYSBub29wIGlmIHRoZSBhdHRyaWJ1dGUgZG9lc24ndCBleGlzdC4KICAgIHVuc2V0OiBmdW5jdGlvbihhdHRyLCBvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChhdHRyLCBudWxsLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYCB1bmxlc3MgeW91IGNob29zZQogICAgLy8gdG8gc2lsZW5jZSBpdC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIChvcHRpb25zIHx8IChvcHRpb25zID0ge30pKS51bnNldCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzLnNldChfLmNsb25lKHRoaXMuYXR0cmlidXRlcyksIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgbW9kZWwgZnJvbSB0aGUgc2VydmVyLiBJZiB0aGUgc2VydmVyJ3MgcmVwcmVzZW50YXRpb24gb2YgdGhlCiAgICAvLyBtb2RlbCBkaWZmZXJzIGZyb20gaXRzIGN1cnJlbnQgYXR0cmlidXRlcywgdGhleSB3aWxsIGJlIG92ZXJyaWRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwLCBzdGF0dXMsIHhocikgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIHhociksIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3ApOwogICAgICB9OwogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuICh0aGlzLnN5bmMgfHwgQmFja2JvbmUuc3luYykuY2FsbCh0aGlzLCAncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMsIGFuZCBzeW5jIHRoZSBtb2RlbCB0byB0aGUgc2VydmVyLgogICAgLy8gSWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGF0dHJpYnV0ZXMgaGFzaCB0aGF0IGRpZmZlcnMsIHRoZSBtb2RlbCdzCiAgICAvLyBzdGF0ZSB3aWxsIGJlIGBzZXRgIGFnYWluLgogICAgc2F2ZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICB2YXIgYXR0cnMsIGN1cnJlbnQ7CgogICAgICAvLyBIYW5kbGUgYm90aCBgKCJrZXkiLCB2YWx1ZSlgIGFuZCBgKHtrZXk6IHZhbHVlfSlgIC1zdHlsZSBjYWxscy4KICAgICAgaWYgKF8uaXNPYmplY3Qoa2V5KSB8fCBrZXkgPT0gbnVsbCkgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdHRycyA9IHt9OwogICAgICAgIGF0dHJzW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKCiAgICAgIC8vIElmIHdlJ3JlICJ3YWl0Ii1pbmcgdG8gc2V0IGNoYW5nZWQgYXR0cmlidXRlcywgdmFsaWRhdGUgZWFybHkuCiAgICAgIGlmIChvcHRpb25zLndhaXQpIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGN1cnJlbnQgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICAgIH0KCiAgICAgIC8vIFJlZ3VsYXIgc2F2ZXMgYHNldGAgYXR0cmlidXRlcyBiZWZvcmUgcGVyc2lzdGluZyB0byB0aGUgc2VydmVyLgogICAgICB2YXIgc2lsZW50T3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7c2lsZW50OiB0cnVlfSk7CiAgICAgIGlmIChhdHRycyAmJiAhdGhpcy5zZXQoYXR0cnMsIG9wdGlvbnMud2FpdCA/IHNpbGVudE9wdGlvbnMgOiBvcHRpb25zKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gQWZ0ZXIgYSBzdWNjZXNzZnVsIHNlcnZlci1zaWRlIHNhdmUsIHRoZSBjbGllbnQgaXMgKG9wdGlvbmFsbHkpCiAgICAgIC8vIHVwZGF0ZWQgd2l0aCB0aGUgc2VydmVyLXNpZGUgc3RhdGUuCiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwLCBzdGF0dXMsIHhocikgewogICAgICAgIHZhciBzZXJ2ZXJBdHRycyA9IG1vZGVsLnBhcnNlKHJlc3AsIHhocik7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgewogICAgICAgICAgZGVsZXRlIG9wdGlvbnMud2FpdDsKICAgICAgICAgIHNlcnZlckF0dHJzID0gXy5leHRlbmQoYXR0cnMgfHwge30sIHNlcnZlckF0dHJzKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgIHN1Y2Nlc3MobW9kZWwsIHJlc3ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8vIEZpbmlzaCBjb25maWd1cmluZyBhbmQgc2VuZGluZyB0aGUgQWpheCByZXF1ZXN0LgogICAgICBvcHRpb25zLmVycm9yID0gQmFja2JvbmUud3JhcEVycm9yKG9wdGlvbnMuZXJyb3IsIG1vZGVsLCBvcHRpb25zKTsKICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuaXNOZXcoKSA/ICdjcmVhdGUnIDogJ3VwZGF0ZSc7CiAgICAgIHZhciB4aHIgPSAodGhpcy5zeW5jIHx8IEJhY2tib25lLnN5bmMpLmNhbGwodGhpcywgbWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMud2FpdCkgdGhpcy5zZXQoY3VycmVudCwgc2lsZW50T3B0aW9ucyk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgdHJpZ2dlckRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdkZXN0cm95JywgbW9kZWwsIG1vZGVsLmNvbGxlY3Rpb24sIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgewogICAgICAgIHRyaWdnZXJEZXN0cm95KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgdHJpZ2dlckRlc3Ryb3koKTsKICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgc3VjY2Vzcyhtb2RlbCwgcmVzcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgb3B0aW9ucy5lcnJvciA9IEJhY2tib25lLndyYXBFcnJvcihvcHRpb25zLmVycm9yLCBtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciB4aHIgPSAodGhpcy5zeW5jIHx8IEJhY2tib25lLnN5bmMpLmNhbGwodGhpcywgJ2RlbGV0ZScsIHRoaXMsIG9wdGlvbnMpOwogICAgICBpZiAoIW9wdGlvbnMud2FpdCkgdHJpZ2dlckRlc3Ryb3koKTsKICAgICAgcmV0dXJuIHhocjsKICAgIH0sCgogICAgLy8gRGVmYXVsdCBVUkwgZm9yIHRoZSBtb2RlbCdzIHJlcHJlc2VudGF0aW9uIG9uIHRoZSBzZXJ2ZXIgLS0gaWYgeW91J3JlCiAgICAvLyB1c2luZyBCYWNrYm9uZSdzIHJlc3RmdWwgbWV0aG9kcywgb3ZlcnJpZGUgdGhpcyB0byBjaGFuZ2UgdGhlIGVuZHBvaW50CiAgICAvLyB0aGF0IHdpbGwgYmUgY2FsbGVkLgogICAgdXJsOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJhc2UgPSBnZXRWYWx1ZSh0aGlzLCAndXJsUm9vdCcpIHx8IGdldFZhbHVlKHRoaXMuY29sbGVjdGlvbiwgJ3VybCcpIHx8IHVybEVycm9yKCk7CiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHJldHVybiBiYXNlOwogICAgICByZXR1cm4gYmFzZSArIChiYXNlLmNoYXJBdChiYXNlLmxlbmd0aCAtIDEpID09ICcvJyA/ICcnIDogJy8nKSArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmlkKTsKICAgIH0sCgogICAgLy8gKipwYXJzZSoqIGNvbnZlcnRzIGEgcmVzcG9uc2UgaW50byB0aGUgaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIGJlIGBzZXRgIG9uCiAgICAvLyB0aGUgbW9kZWwuIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyB0aGUgcmVzcG9uc2UgYWxvbmcuCiAgICBwYXJzZTogZnVuY3Rpb24ocmVzcCwgeGhyKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwgd2l0aCBpZGVudGljYWwgYXR0cmlidXRlcyB0byB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEEgbW9kZWwgaXMgbmV3IGlmIGl0IGhhcyBuZXZlciBiZWVuIHNhdmVkIHRvIHRoZSBzZXJ2ZXIsIGFuZCBsYWNrcyBhbiBpZC4KICAgIGlzTmV3OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuaWQgPT0gbnVsbDsKICAgIH0sCgogICAgLy8gQ2FsbCB0aGlzIG1ldGhvZCB0byBtYW51YWxseSBmaXJlIGEgYCJjaGFuZ2UiYCBldmVudCBmb3IgdGhpcyBtb2RlbCBhbmQKICAgIC8vIGEgYCJjaGFuZ2U6YXR0cmlidXRlImAgZXZlbnQgZm9yIGVhY2ggY2hhbmdlZCBhdHRyaWJ1dGUuCiAgICAvLyBDYWxsaW5nIHRoaXMgd2lsbCBjYXVzZSBhbGwgb2JqZWN0cyBvYnNlcnZpbmcgdGhlIG1vZGVsIHRvIHVwZGF0ZS4KICAgIGNoYW5nZTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICB2YXIgY2hhbmdpbmcgPSB0aGlzLl9jaGFuZ2luZzsKICAgICAgdGhpcy5fY2hhbmdpbmcgPSB0cnVlOwoKICAgICAgLy8gU2lsZW50IGNoYW5nZXMgYmVjb21lIHBlbmRpbmcgY2hhbmdlcy4KICAgICAgZm9yICh2YXIgYXR0ciBpbiB0aGlzLl9zaWxlbnQpIHRoaXMuX3BlbmRpbmdbYXR0cl0gPSB0cnVlOwoKICAgICAgLy8gU2lsZW50IGNoYW5nZXMgYXJlIHRyaWdnZXJlZC4KICAgICAgdmFyIGNoYW5nZXMgPSBfLmV4dGVuZCh7fSwgb3B0aW9ucy5jaGFuZ2VzLCB0aGlzLl9zaWxlbnQpOwogICAgICB0aGlzLl9zaWxlbnQgPSB7fTsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBjaGFuZ2VzKSB7CiAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGF0dHIsIHRoaXMsIHRoaXMuZ2V0KGF0dHIpLCBvcHRpb25zKTsKICAgICAgfQogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOwoKICAgICAgLy8gQ29udGludWUgZmlyaW5nIGAiY2hhbmdlImAgZXZlbnRzIHdoaWxlIHRoZXJlIGFyZSBwZW5kaW5nIGNoYW5nZXMuCiAgICAgIHdoaWxlICghXy5pc0VtcHR5KHRoaXMuX3BlbmRpbmcpKSB7CiAgICAgICAgdGhpcy5fcGVuZGluZyA9IHt9OwogICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgLy8gUGVuZGluZyBhbmQgc2lsZW50IGNoYW5nZXMgc3RpbGwgcmVtYWluLgogICAgICAgIGZvciAodmFyIGF0dHIgaW4gdGhpcy5jaGFuZ2VkKSB7CiAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ1thdHRyXSB8fCB0aGlzLl9zaWxlbnRbYXR0cl0pIGNvbnRpbnVlOwogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzID0gXy5jbG9uZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICB9CgogICAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBtb2RlbCBoYXMgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCBgImNoYW5nZSJgIGV2ZW50LgogICAgLy8gSWYgeW91IHNwZWNpZnkgYW4gYXR0cmlidXRlIG5hbWUsIGRldGVybWluZSBpZiB0aGF0IGF0dHJpYnV0ZSBoYXMgY2hhbmdlZC4KICAgIGhhc0NoYW5nZWQ6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gIV8uaXNFbXB0eSh0aGlzLmNoYW5nZWQpOwogICAgICByZXR1cm4gXy5oYXModGhpcy5jaGFuZ2VkLCBhdHRyKTsKICAgIH0sCgogICAgLy8gUmV0dXJuIGFuIG9iamVjdCBjb250YWluaW5nIGFsbCB0aGUgYXR0cmlidXRlcyB0aGF0IGhhdmUgY2hhbmdlZCwgb3IKICAgIC8vIGZhbHNlIGlmIHRoZXJlIGFyZSBubyBjaGFuZ2VkIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3IgZGV0ZXJtaW5pbmcgd2hhdAogICAgLy8gcGFydHMgb2YgYSB2aWV3IG5lZWQgdG8gYmUgdXBkYXRlZCBhbmQvb3Igd2hhdCBhdHRyaWJ1dGVzIG5lZWQgdG8gYmUKICAgIC8vIHBlcnNpc3RlZCB0byB0aGUgc2VydmVyLiBVbnNldCBhdHRyaWJ1dGVzIHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgIC8vIFlvdSBjYW4gYWxzbyBwYXNzIGFuIGF0dHJpYnV0ZXMgb2JqZWN0IHRvIGRpZmYgYWdhaW5zdCB0aGUgbW9kZWwsCiAgICAvLyBkZXRlcm1pbmluZyBpZiB0aGVyZSAqd291bGQgYmUqIGEgY2hhbmdlLgogICAgY2hhbmdlZEF0dHJpYnV0ZXM6IGZ1bmN0aW9uKGRpZmYpIHsKICAgICAgaWYgKCFkaWZmKSByZXR1cm4gdGhpcy5oYXNDaGFuZ2VkKCkgPyBfLmNsb25lKHRoaXMuY2hhbmdlZCkgOiBmYWxzZTsKICAgICAgdmFyIHZhbCwgY2hhbmdlZCA9IGZhbHNlLCBvbGQgPSB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXM7CiAgICAgIGZvciAodmFyIGF0dHIgaW4gZGlmZikgewogICAgICAgIGlmIChfLmlzRXF1YWwob2xkW2F0dHJdLCAodmFsID0gZGlmZlthdHRyXSkpKSBjb250aW51ZTsKICAgICAgICAoY2hhbmdlZCB8fCAoY2hhbmdlZCA9IHt9KSlbYXR0cl0gPSB2YWw7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYW5nZWQ7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgcHJldmlvdXMgdmFsdWUgb2YgYW4gYXR0cmlidXRlLCByZWNvcmRlZCBhdCB0aGUgdGltZSB0aGUgbGFzdAogICAgLy8gYCJjaGFuZ2UiYCBldmVudCB3YXMgZmlyZWQuCiAgICBwcmV2aW91czogZnVuY3Rpb24oYXR0cikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGggfHwgIXRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcykgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91cwogICAgLy8gYCJjaGFuZ2UiYCBldmVudC4KICAgIHByZXZpb3VzQXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIENoZWNrIGlmIHRoZSBtb2RlbCBpcyBjdXJyZW50bHkgaW4gYSB2YWxpZCBzdGF0ZS4gSXQncyBvbmx5IHBvc3NpYmxlIHRvCiAgICAvLyBnZXQgaW50byBhbiAqaW52YWxpZCogc3RhdGUgaWYgeW91J3JlIHVzaW5nIHNpbGVudCBjaGFuZ2VzLgogICAgaXNWYWxpZDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAhdGhpcy52YWxpZGF0ZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgfSwKCiAgICAvLyBSdW4gdmFsaWRhdGlvbiBhZ2FpbnN0IHRoZSBuZXh0IGNvbXBsZXRlIHNldCBvZiBtb2RlbCBhdHRyaWJ1dGVzLAogICAgLy8gcmV0dXJuaW5nIGB0cnVlYCBpZiBhbGwgaXMgd2VsbC4gSWYgYSBzcGVjaWZpYyBgZXJyb3JgIGNhbGxiYWNrIGhhcwogICAgLy8gYmVlbiBwYXNzZWQsIGNhbGwgdGhhdCBpbnN0ZWFkIG9mIGZpcmluZyB0aGUgZ2VuZXJhbCBgImVycm9yImAgZXZlbnQuCiAgICBfdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zLnNpbGVudCB8fCAhdGhpcy52YWxpZGF0ZSkgcmV0dXJuIHRydWU7CiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKTsKICAgICAgaWYgKCFlcnJvcikgcmV0dXJuIHRydWU7CiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICBvcHRpb25zLmVycm9yKHRoaXMsIGVycm9yLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgdGhpcywgZXJyb3IsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLkNvbGxlY3Rpb24KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFByb3ZpZGVzIGEgc3RhbmRhcmQgY29sbGVjdGlvbiBjbGFzcyBmb3Igb3VyIHNldHMgb2YgbW9kZWxzLCBvcmRlcmVkCiAgLy8gb3IgdW5vcmRlcmVkLiBJZiBhIGBjb21wYXJhdG9yYCBpcyBzcGVjaWZpZWQsIHRoZSBDb2xsZWN0aW9uIHdpbGwgbWFpbnRhaW4KICAvLyBpdHMgbW9kZWxzIGluIHNvcnQgb3JkZXIsIGFzIHRoZXkncmUgYWRkZWQgYW5kIHJlbW92ZWQuCiAgdmFyIENvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uID0gZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMubW9kZWwpIHRoaXMubW9kZWwgPSBvcHRpb25zLm1vZGVsOwogICAgaWYgKG9wdGlvbnMuY29tcGFyYXRvcikgdGhpcy5jb21wYXJhdG9yID0gb3B0aW9ucy5jb21wYXJhdG9yOwogICAgdGhpcy5fcmVzZXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKG1vZGVscykgdGhpcy5yZXNldChtb2RlbHMsIHtzaWxlbnQ6IHRydWUsIHBhcnNlOiBvcHRpb25zLnBhcnNlfSk7CiAgfTsKCiAgLy8gRGVmaW5lIHRoZSBDb2xsZWN0aW9uJ3MgaW5oZXJpdGFibGUgbWV0aG9kcy4KICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgbW9kZWwgZm9yIGEgY29sbGVjdGlvbiBpcyBqdXN0IGEgKipCYWNrYm9uZS5Nb2RlbCoqLgogICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLgogICAgbW9kZWw6IE1vZGVsLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gVGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBDb2xsZWN0aW9uIGlzIGFuIGFycmF5IG9mIHRoZQogICAgLy8gbW9kZWxzJyBhdHRyaWJ1dGVzLgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC50b0pTT04ob3B0aW9ucyk7IH0pOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4gUGFzcyAqKnNpbGVudCoqIHRvIGF2b2lkCiAgICAvLyBmaXJpbmcgdGhlIGBhZGRgIGV2ZW50IGZvciBldmVyeSBuZXcgbW9kZWwuCiAgICBhZGQ6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICB2YXIgaSwgaW5kZXgsIGxlbmd0aCwgbW9kZWwsIGNpZCwgaWQsIGNpZHMgPSB7fSwgaWRzID0ge30sIGR1cHMgPSBbXTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgbW9kZWxzID0gXy5pc0FycmF5KG1vZGVscykgPyBtb2RlbHMuc2xpY2UoKSA6IFttb2RlbHNdOwoKICAgICAgLy8gQmVnaW4gYnkgdHVybmluZyBiYXJlIG9iamVjdHMgaW50byBtb2RlbCByZWZlcmVuY2VzLCBhbmQgcHJldmVudGluZwogICAgICAvLyBpbnZhbGlkIG1vZGVscyBvciBkdXBsaWNhdGUgbW9kZWxzIGZyb20gYmVpbmcgYWRkZWQuCiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmICghKG1vZGVsID0gbW9kZWxzW2ldID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsc1tpXSwgb3B0aW9ucykpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbid0IGFkZCBhbiBpbnZhbGlkIG1vZGVsIHRvIGEgY29sbGVjdGlvbiIpOwogICAgICAgIH0KICAgICAgICBjaWQgPSBtb2RlbC5jaWQ7CiAgICAgICAgaWQgPSBtb2RlbC5pZDsKICAgICAgICBpZiAoY2lkc1tjaWRdIHx8IHRoaXMuX2J5Q2lkW2NpZF0gfHwgKChpZCAhPSBudWxsKSAmJiAoaWRzW2lkXSB8fCB0aGlzLl9ieUlkW2lkXSkpKSB7CiAgICAgICAgICBkdXBzLnB1c2goaSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY2lkc1tjaWRdID0gaWRzW2lkXSA9IG1vZGVsOwogICAgICB9CgogICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcy4KICAgICAgaSA9IGR1cHMubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgbW9kZWxzLnNwbGljZShkdXBzW2ldLCAxKTsKICAgICAgfQoKICAgICAgLy8gTGlzdGVuIHRvIGFkZGVkIG1vZGVscycgZXZlbnRzLCBhbmQgaW5kZXggbW9kZWxzIGZvciBsb29rdXAgYnkKICAgICAgLy8gYGlkYCBhbmQgYnkgYGNpZGAuCiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIChtb2RlbCA9IG1vZGVsc1tpXSkub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICAgICAgdGhpcy5fYnlDaWRbbW9kZWwuY2lkXSA9IG1vZGVsOwogICAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CgogICAgICAvLyBJbnNlcnQgbW9kZWxzIGludG8gdGhlIGNvbGxlY3Rpb24sIHJlLXNvcnRpbmcgaWYgbmVlZGVkLCBhbmQgdHJpZ2dlcmluZwogICAgICAvLyBgYWRkYCBldmVudHMgdW5sZXNzIHNpbGVuY2VkLgogICAgICB0aGlzLmxlbmd0aCArPSBsZW5ndGg7CiAgICAgIGluZGV4ID0gb3B0aW9ucy5hdCAhPSBudWxsID8gb3B0aW9ucy5hdCA6IHRoaXMubW9kZWxzLmxlbmd0aDsKICAgICAgc3BsaWNlLmFwcGx5KHRoaXMubW9kZWxzLCBbaW5kZXgsIDBdLmNvbmNhdChtb2RlbHMpKTsKICAgICAgaWYgKHRoaXMuY29tcGFyYXRvcikgdGhpcy5zb3J0KHtzaWxlbnQ6IHRydWV9KTsKICAgICAgaWYgKG9wdGlvbnMuc2lsZW50KSByZXR1cm4gdGhpczsKICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gdGhpcy5tb2RlbHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIWNpZHNbKG1vZGVsID0gdGhpcy5tb2RlbHNbaV0pLmNpZF0pIGNvbnRpbnVlOwogICAgICAgIG9wdGlvbnMuaW5kZXggPSBpOwogICAgICAgIG1vZGVsLnRyaWdnZXIoJ2FkZCcsIG1vZGVsLCB0aGlzLCBvcHRpb25zKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwsIG9yIGEgbGlzdCBvZiBtb2RlbHMgZnJvbSB0aGUgc2V0LiBQYXNzIHNpbGVudCB0byBhdm9pZAogICAgLy8gZmlyaW5nIHRoZSBgcmVtb3ZlYCBldmVudCBmb3IgZXZlcnkgbW9kZWwgcmVtb3ZlZC4KICAgIHJlbW92ZTogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBpLCBsLCBpbmRleCwgbW9kZWw7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIG1vZGVscyA9IF8uaXNBcnJheShtb2RlbHMpID8gbW9kZWxzLnNsaWNlKCkgOiBbbW9kZWxzXTsKICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBtb2RlbCA9IHRoaXMuZ2V0QnlDaWQobW9kZWxzW2ldKSB8fCB0aGlzLmdldChtb2RlbHNbaV0pOwogICAgICAgIGlmICghbW9kZWwpIGNvbnRpbnVlOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmlkXTsKICAgICAgICBkZWxldGUgdGhpcy5fYnlDaWRbbW9kZWwuY2lkXTsKICAgICAgICBpbmRleCA9IHRoaXMuaW5kZXhPZihtb2RlbCk7CiAgICAgICAgdGhpcy5tb2RlbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB0aGlzLmxlbmd0aC0tOwogICAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICAgIG9wdGlvbnMuaW5kZXggPSBpbmRleDsKICAgICAgICAgIG1vZGVsLnRyaWdnZXIoJ3JlbW92ZScsIG1vZGVsLCB0aGlzLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKG1vZGVsKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQWRkIGEgbW9kZWwgdG8gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHB1c2g6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG1vZGVsID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsLCBvcHRpb25zKTsKICAgICAgdGhpcy5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KHRoaXMubGVuZ3RoIC0gMSk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgbW9kZWwgPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWwsIG9wdGlvbnMpOwogICAgICB0aGlzLmFkZChtb2RlbCwgXy5leHRlbmQoe2F0OiAwfSwgb3B0aW9ucykpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHNoaWZ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQoMCk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBHZXQgYSBtb2RlbCBmcm9tIHRoZSBzZXQgYnkgaWQuCiAgICBnZXQ6IGZ1bmN0aW9uKGlkKSB7CiAgICAgIGlmIChpZCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5fYnlJZFtpZC5pZCAhPSBudWxsID8gaWQuaWQgOiBpZF07CiAgICB9LAoKICAgIC8vIEdldCBhIG1vZGVsIGZyb20gdGhlIHNldCBieSBjbGllbnQgaWQuCiAgICBnZXRCeUNpZDogZnVuY3Rpb24oY2lkKSB7CiAgICAgIHJldHVybiBjaWQgJiYgdGhpcy5fYnlDaWRbY2lkLmNpZCB8fCBjaWRdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIG1vZGVsIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIGF0OiBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbHNbaW5kZXhdOwogICAgfSwKCiAgICAvLyBSZXR1cm4gbW9kZWxzIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMgb2YgYGZpbHRlcmAuCiAgICB3aGVyZTogZnVuY3Rpb24oYXR0cnMpIHsKICAgICAgaWYgKF8uaXNFbXB0eShhdHRycykpIHJldHVybiBbXTsKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgaWYgKCF0aGlzLmNvbXBhcmF0b3IpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNvcnQgYSBzZXQgd2l0aG91dCBhIGNvbXBhcmF0b3InKTsKICAgICAgdmFyIGJvdW5kQ29tcGFyYXRvciA9IF8uYmluZCh0aGlzLmNvbXBhcmF0b3IsIHRoaXMpOwogICAgICBpZiAodGhpcy5jb21wYXJhdG9yLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgdGhpcy5tb2RlbHMgPSB0aGlzLnNvcnRCeShib3VuZENvbXBhcmF0b3IpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubW9kZWxzLnNvcnQoYm91bmRDb21wYXJhdG9yKTsKICAgICAgfQogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBQbHVjayBhbiBhdHRyaWJ1dGUgZnJvbSBlYWNoIG1vZGVsIGluIHRoZSBjb2xsZWN0aW9uLgogICAgcGx1Y2s6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIF8ubWFwKHRoaXMubW9kZWxzLCBmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC5nZXQoYXR0cik7IH0pOwogICAgfSwKCiAgICAvLyBXaGVuIHlvdSBoYXZlIG1vcmUgaXRlbXMgdGhhbiB5b3Ugd2FudCB0byBhZGQgb3IgcmVtb3ZlIGluZGl2aWR1YWxseSwKICAgIC8vIHlvdSBjYW4gcmVzZXQgdGhlIGVudGlyZSBzZXQgd2l0aCBhIG5ldyBsaXN0IG9mIG1vZGVscywgd2l0aG91dCBmaXJpbmcKICAgIC8vIGFueSBgYWRkYCBvciBgcmVtb3ZlYCBldmVudHMuIEZpcmVzIGByZXNldGAgd2hlbiBmaW5pc2hlZC4KICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgbW9kZWxzICB8fCAobW9kZWxzID0gW10pOwogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZSh0aGlzLm1vZGVsc1tpXSk7CiAgICAgIH0KICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgdGhpcy5hZGQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgZGVmYXVsdCBzZXQgb2YgbW9kZWxzIGZvciB0aGlzIGNvbGxlY3Rpb24sIHJlc2V0dGluZyB0aGUKICAgIC8vIGNvbGxlY3Rpb24gd2hlbiB0aGV5IGFycml2ZS4gSWYgYGFkZDogdHJ1ZWAgaXMgcGFzc2VkLCBhcHBlbmRzIHRoZQogICAgLy8gbW9kZWxzIHRvIHRoZSBjb2xsZWN0aW9uIGluc3RlYWQgb2YgcmVzZXR0aW5nLgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB1bmRlZmluZWQpIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwLCBzdGF0dXMsIHhocikgewogICAgICAgIGNvbGxlY3Rpb25bb3B0aW9ucy5hZGQgPyAnYWRkJyA6ICdyZXNldCddKGNvbGxlY3Rpb24ucGFyc2UocmVzcCwgeGhyKSwgb3B0aW9ucyk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MoY29sbGVjdGlvbiwgcmVzcCk7CiAgICAgIH07CiAgICAgIG9wdGlvbnMuZXJyb3IgPSBCYWNrYm9uZS53cmFwRXJyb3Iob3B0aW9ucy5lcnJvciwgY29sbGVjdGlvbiwgb3B0aW9ucyk7CiAgICAgIHJldHVybiAodGhpcy5zeW5jIHx8IEJhY2tib25lLnN5bmMpLmNhbGwodGhpcywgJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgbW9kZWwgaW4gdGhpcyBjb2xsZWN0aW9uLiBBZGQgdGhlIG1vZGVsIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbiBpbW1lZGlhdGVseSwgdW5sZXNzIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIGluIHdoaWNoIGNhc2Ugd2UKICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuCiAgICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHZhciBjb2xsID0gdGhpczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIG1vZGVsID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsLCBvcHRpb25zKTsKICAgICAgaWYgKCFtb2RlbCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMud2FpdCkgY29sbC5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24obmV4dE1vZGVsLCByZXNwLCB4aHIpIHsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBjb2xsLmFkZChuZXh0TW9kZWwsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICBzdWNjZXNzKG5leHRNb2RlbCwgcmVzcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5leHRNb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIGEgbGlzdCBvZiBtb2RlbHMgdG8gYmUgYWRkZWQgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgaXQgdGhyb3VnaC4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCB4aHIpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIFByb3h5IHRvIF8ncyBjaGFpbi4gQ2FuJ3QgYmUgcHJveGllZCB0aGUgc2FtZSB3YXkgdGhlIHJlc3Qgb2YgdGhlCiAgICAvLyB1bmRlcnNjb3JlIG1ldGhvZHMgYXJlIHByb3hpZWQgYmVjYXVzZSBpdCByZWxpZXMgb24gdGhlIHVuZGVyc2NvcmUKICAgIC8vIGNvbnN0cnVjdG9yLgogICAgY2hhaW46IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF8odGhpcy5tb2RlbHMpLmNoYWluKCk7CiAgICB9LAoKICAgIC8vIFJlc2V0IGFsbCBpbnRlcm5hbCBzdGF0ZS4gQ2FsbGVkIHdoZW4gdGhlIGNvbGxlY3Rpb24gaXMgcmVzZXQuCiAgICBfcmVzZXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdGhpcy5sZW5ndGggPSAwOwogICAgICB0aGlzLm1vZGVscyA9IFtdOwogICAgICB0aGlzLl9ieUlkICA9IHt9OwogICAgICB0aGlzLl9ieUNpZCA9IHt9OwogICAgfSwKCiAgICAvLyBQcmVwYXJlIGEgbW9kZWwgb3IgaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIGJlIGFkZGVkIHRvIHRoaXMgY29sbGVjdGlvbi4KICAgIF9wcmVwYXJlTW9kZWw6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIGlmICghKG1vZGVsIGluc3RhbmNlb2YgTW9kZWwpKSB7CiAgICAgICAgdmFyIGF0dHJzID0gbW9kZWw7CiAgICAgICAgb3B0aW9ucy5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgICBtb2RlbCA9IG5ldyB0aGlzLm1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgICBpZiAoIW1vZGVsLl92YWxpZGF0ZShtb2RlbC5hdHRyaWJ1dGVzLCBvcHRpb25zKSkgbW9kZWwgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICghbW9kZWwuY29sbGVjdGlvbikgewogICAgICAgIG1vZGVsLmNvbGxlY3Rpb24gPSB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIHRvIHJlbW92ZSBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfcmVtb3ZlUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCkgewogICAgICBpZiAodGhpcyA9PSBtb2RlbC5jb2xsZWN0aW9uKSB7CiAgICAgICAgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIH0KICAgICAgbW9kZWwub2ZmKCdhbGwnLCB0aGlzLl9vbk1vZGVsRXZlbnQsIHRoaXMpOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIGV2ZXJ5IHRpbWUgYSBtb2RlbCBpbiB0aGUgc2V0IGZpcmVzIGFuIGV2ZW50LgogICAgLy8gU2V0cyBuZWVkIHRvIHVwZGF0ZSB0aGVpciBpbmRleGVzIHdoZW4gbW9kZWxzIGNoYW5nZSBpZHMuIEFsbCBvdGhlcgogICAgLy8gZXZlbnRzIHNpbXBseSBwcm94eSB0aHJvdWdoLiAiYWRkIiBhbmQgInJlbW92ZSIgZXZlbnRzIHRoYXQgb3JpZ2luYXRlCiAgICAvLyBpbiBvdGhlciBjb2xsZWN0aW9ucyBhcmUgaWdub3JlZC4KICAgIF9vbk1vZGVsRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50LCBtb2RlbCwgY29sbGVjdGlvbiwgb3B0aW9ucykgewogICAgICBpZiAoKGV2ZW50ID09ICdhZGQnIHx8IGV2ZW50ID09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9IHRoaXMpIHJldHVybjsKICAgICAgaWYgKGV2ZW50ID09ICdkZXN0cm95JykgewogICAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgfQogICAgICBpZiAobW9kZWwgJiYgZXZlbnQgPT09ICdjaGFuZ2U6JyArIG1vZGVsLmlkQXR0cmlidXRlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwucHJldmlvdXMobW9kZWwuaWRBdHRyaWJ1dGUpXTsKICAgICAgICB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCiAgdmFyIG1ldGhvZHMgPSBbJ2ZvckVhY2gnLCAnZWFjaCcsICdtYXAnLCAncmVkdWNlJywgJ3JlZHVjZVJpZ2h0JywgJ2ZpbmQnLAogICAgJ2RldGVjdCcsICdmaWx0ZXInLCAnc2VsZWN0JywgJ3JlamVjdCcsICdldmVyeScsICdhbGwnLCAnc29tZScsICdhbnknLAogICAgJ2luY2x1ZGUnLCAnY29udGFpbnMnLCAnaW52b2tlJywgJ21heCcsICdtaW4nLCAnc29ydEJ5JywgJ3NvcnRlZEluZGV4JywKICAgICd0b0FycmF5JywgJ3NpemUnLCAnZmlyc3QnLCAnaW5pdGlhbCcsICdyZXN0JywgJ2xhc3QnLCAnd2l0aG91dCcsICdpbmRleE9mJywKICAgICdzaHVmZmxlJywgJ2xhc3RJbmRleE9mJywgJ2lzRW1wdHknLCAnZ3JvdXBCeSddOwoKICAvLyBNaXggaW4gZWFjaCBVbmRlcnNjb3JlIG1ldGhvZCBhcyBhIHByb3h5IHRvIGBDb2xsZWN0aW9uI21vZGVsc2AuCiAgXy5lYWNoKG1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgQ29sbGVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIFt0aGlzLm1vZGVsc10uY29uY2F0KF8udG9BcnJheShhcmd1bWVudHMpKSk7CiAgICB9OwogIH0pOwoKICAvLyBCYWNrYm9uZS5Sb3V0ZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJvdXRlcnMgbWFwIGZhdXgtVVJMcyB0byBhY3Rpb25zLCBhbmQgZmlyZSBldmVudHMgd2hlbiByb3V0ZXMgYXJlCiAgLy8gbWF0Y2hlZC4gQ3JlYXRpbmcgYSBuZXcgb25lIHNldHMgaXRzIGByb3V0ZXNgIGhhc2gsIGlmIG5vdCBzZXQgc3RhdGljYWxseS4KICB2YXIgUm91dGVyID0gQmFja2JvbmUuUm91dGVyID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLnJvdXRlcykgdGhpcy5yb3V0ZXMgPSBvcHRpb25zLnJvdXRlczsKICAgIHRoaXMuX2JpbmRSb3V0ZXMoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIENhY2hlZCByZWd1bGFyIGV4cHJlc3Npb25zIGZvciBtYXRjaGluZyBuYW1lZCBwYXJhbSBwYXJ0cyBhbmQgc3BsYXR0ZWQKICAvLyBwYXJ0cyBvZiByb3V0ZSBzdHJpbmdzLgogIHZhciBuYW1lZFBhcmFtICAgID0gLzpcdysvZzsKICB2YXIgc3BsYXRQYXJhbSAgICA9IC9cKlx3Ky9nOwogIHZhciBlc2NhcGVSZWdFeHAgID0gL1stW1xde30oKSs/LixcXF4kfCNcc10vZzsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlJvdXRlcioqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAgXy5leHRlbmQoUm91dGVyLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBNYW51YWxseSBiaW5kIGEgc2luZ2xlIG5hbWVkIHJvdXRlIHRvIGEgY2FsbGJhY2suIEZvciBleGFtcGxlOgogICAgLy8KICAgIC8vICAgICB0aGlzLnJvdXRlKCdzZWFyY2gvOnF1ZXJ5L3A6bnVtJywgJ3NlYXJjaCcsIGZ1bmN0aW9uKHF1ZXJ5LCBudW0pIHsKICAgIC8vICAgICAgIC4uLgogICAgLy8gICAgIH0pOwogICAgLy8KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgbmFtZSwgY2FsbGJhY2spIHsKICAgICAgQmFja2JvbmUuaGlzdG9yeSB8fCAoQmFja2JvbmUuaGlzdG9yeSA9IG5ldyBIaXN0b3J5KTsKICAgICAgaWYgKCFfLmlzUmVnRXhwKHJvdXRlKSkgcm91dGUgPSB0aGlzLl9yb3V0ZVRvUmVnRXhwKHJvdXRlKTsKICAgICAgaWYgKCFjYWxsYmFjaykgY2FsbGJhY2sgPSB0aGlzW25hbWVdOwogICAgICBCYWNrYm9uZS5oaXN0b3J5LnJvdXRlKHJvdXRlLCBfLmJpbmQoZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgICB2YXIgYXJncyA9IHRoaXMuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIFsncm91dGU6JyArIG5hbWVdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgQmFja2JvbmUuaGlzdG9yeS50cmlnZ2VyKCdyb3V0ZScsIHRoaXMsIG5hbWUsIGFyZ3MpOwogICAgICB9LCB0aGlzKSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBCaW5kIGFsbCBkZWZpbmVkIHJvdXRlcyB0byBgQmFja2JvbmUuaGlzdG9yeWAuIFdlIGhhdmUgdG8gcmV2ZXJzZSB0aGUKICAgIC8vIG9yZGVyIG9mIHRoZSByb3V0ZXMgaGVyZSB0byBzdXBwb3J0IGJlaGF2aW9yIHdoZXJlIHRoZSBtb3N0IGdlbmVyYWwKICAgIC8vIHJvdXRlcyBjYW4gYmUgZGVmaW5lZCBhdCB0aGUgYm90dG9tIG9mIHRoZSByb3V0ZSBtYXAuCiAgICBfYmluZFJvdXRlczogZnVuY3Rpb24oKSB7CiAgICAgIGlmICghdGhpcy5yb3V0ZXMpIHJldHVybjsKICAgICAgdmFyIHJvdXRlcyA9IFtdOwogICAgICBmb3IgKHZhciByb3V0ZSBpbiB0aGlzLnJvdXRlcykgewogICAgICAgIHJvdXRlcy51bnNoaWZ0KFtyb3V0ZSwgdGhpcy5yb3V0ZXNbcm91dGVdXSk7CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSByb3V0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5yb3V0ZShyb3V0ZXNbaV1bMF0sIHJvdXRlc1tpXVsxXSwgdGhpc1tyb3V0ZXNbaV1bMV1dKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBDb252ZXJ0IGEgcm91dGUgc3RyaW5nIGludG8gYSByZWd1bGFyIGV4cHJlc3Npb24sIHN1aXRhYmxlIGZvciBtYXRjaGluZwogICAgLy8gYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbiBoYXNoLgogICAgX3JvdXRlVG9SZWdFeHA6IGZ1bmN0aW9uKHJvdXRlKSB7CiAgICAgIHJvdXRlID0gcm91dGUucmVwbGFjZShlc2NhcGVSZWdFeHAsICdcXCQmJykKICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKG5hbWVkUGFyYW0sICcoW15cL10rKScpCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShzcGxhdFBhcmFtLCAnKC4qPyknKTsKICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnJCcpOwogICAgfSwKCiAgICAvLyBHaXZlbiBhIHJvdXRlLCBhbmQgYSBVUkwgZnJhZ21lbnQgdGhhdCBpdCBtYXRjaGVzLCByZXR1cm4gdGhlIGFycmF5IG9mCiAgICAvLyBleHRyYWN0ZWQgcGFyYW1ldGVycy4KICAgIF9leHRyYWN0UGFyYW1ldGVyczogZnVuY3Rpb24ocm91dGUsIGZyYWdtZW50KSB7CiAgICAgIHJldHVybiByb3V0ZS5leGVjKGZyYWdtZW50KS5zbGljZSgxKTsKICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLkhpc3RvcnkKICAvLyAtLS0tLS0tLS0tLS0tLS0tCgogIC8vIEhhbmRsZXMgY3Jvc3MtYnJvd3NlciBoaXN0b3J5IG1hbmFnZW1lbnQsIGJhc2VkIG9uIFVSTCBmcmFnbWVudHMuIElmIHRoZQogIC8vIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBgb25oYXNoY2hhbmdlYCwgZmFsbHMgYmFjayB0byBwb2xsaW5nLgogIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwogIH07CgogIC8vIENhY2hlZCByZWdleCBmb3IgY2xlYW5pbmcgbGVhZGluZyBoYXNoZXMgYW5kIHNsYXNoZXMgLgogIHZhciByb3V0ZVN0cmlwcGVyID0gL15bI1wvXS87CgogIC8vIENhY2hlZCByZWdleCBmb3IgZGV0ZWN0aW5nIE1TSUUuCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOwoKICAvLyBIYXMgdGhlIGhpc3RvcnkgaGFuZGxpbmcgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQ/CiAgSGlzdG9yeS5zdGFydGVkID0gZmFsc2U7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5IaXN0b3J5KiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KICBfLmV4dGVuZChIaXN0b3J5LnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgaW50ZXJ2YWwgdG8gcG9sbCBmb3IgaGFzaCBjaGFuZ2VzLCBpZiBuZWNlc3NhcnksIGlzCiAgICAvLyB0d2VudHkgdGltZXMgYSBzZWNvbmQuCiAgICBpbnRlcnZhbDogNTAsCgogICAgLy8gR2V0cyB0aGUgdHJ1ZSBoYXNoIHZhbHVlLiBDYW5ub3QgdXNlIGxvY2F0aW9uLmhhc2ggZGlyZWN0bHkgZHVlIHRvIGJ1ZwogICAgLy8gaW4gRmlyZWZveCB3aGVyZSBsb2NhdGlvbi5oYXNoIHdpbGwgYWx3YXlzIGJlIGRlY29kZWQuCiAgICBnZXRIYXNoOiBmdW5jdGlvbih3aW5kb3dPdmVycmlkZSkgewogICAgICB2YXIgbG9jID0gd2luZG93T3ZlcnJpZGUgPyB3aW5kb3dPdmVycmlkZS5sb2NhdGlvbiA6IHdpbmRvdy5sb2NhdGlvbjsKICAgICAgdmFyIG1hdGNoID0gbG9jLmhyZWYubWF0Y2goLyMoLiopJC8pOwogICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIGNyb3NzLWJyb3dzZXIgbm9ybWFsaXplZCBVUkwgZnJhZ21lbnQsIGVpdGhlciBmcm9tIHRoZSBVUkwsCiAgICAvLyB0aGUgaGFzaCwgb3IgdGhlIG92ZXJyaWRlLgogICAgZ2V0RnJhZ21lbnQ6IGZ1bmN0aW9uKGZyYWdtZW50LCBmb3JjZVB1c2hTdGF0ZSkgewogICAgICBpZiAoZnJhZ21lbnQgPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgfHwgZm9yY2VQdXNoU3RhdGUpIHsKICAgICAgICAgIGZyYWdtZW50ID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgdmFyIHNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7CiAgICAgICAgICBpZiAoc2VhcmNoKSBmcmFnbWVudCArPSBzZWFyY2g7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghZnJhZ21lbnQuaW5kZXhPZih0aGlzLm9wdGlvbnMucm9vdCkpIGZyYWdtZW50ID0gZnJhZ21lbnQuc3Vic3RyKHRoaXMub3B0aW9ucy5yb290Lmxlbmd0aCk7CiAgICAgIHJldHVybiBmcmFnbWVudC5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgIH0sCgogICAgLy8gU3RhcnQgdGhlIGhhc2ggY2hhbmdlIGhhbmRsaW5nLCByZXR1cm5pbmcgYHRydWVgIGlmIHRoZSBjdXJyZW50IFVSTCBtYXRjaGVzCiAgICAvLyBhbiBleGlzdGluZyByb3V0ZSwgYW5kIGBmYWxzZWAgb3RoZXJ3aXNlLgogICAgc3RhcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKEhpc3Rvcnkuc3RhcnRlZCkgdGhyb3cgbmV3IEVycm9yKCJCYWNrYm9uZS5oaXN0b3J5IGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCIpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSB0cnVlOwoKICAgICAgLy8gRmlndXJlIG91dCB0aGUgaW5pdGlhbCBjb25maWd1cmF0aW9uLiBEbyB3ZSBuZWVkIGFuIGlmcmFtZT8KICAgICAgLy8gSXMgcHVzaFN0YXRlIGRlc2lyZWQgLi4uIGlzIGl0IGF2YWlsYWJsZT8KICAgICAgdGhpcy5vcHRpb25zICAgICAgICAgID0gXy5leHRlbmQoe30sIHtyb290OiAnLyd9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLl93YW50c0hhc2hDaGFuZ2UgPSB0aGlzLm9wdGlvbnMuaGFzaENoYW5nZSAhPT0gZmFsc2U7CiAgICAgIHRoaXMuX3dhbnRzUHVzaFN0YXRlICA9ICEhdGhpcy5vcHRpb25zLnB1c2hTdGF0ZTsKICAgICAgdGhpcy5faGFzUHVzaFN0YXRlICAgID0gISEodGhpcy5vcHRpb25zLnB1c2hTdGF0ZSAmJiB3aW5kb3cuaGlzdG9yeSAmJiB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUpOwogICAgICB2YXIgZnJhZ21lbnQgICAgICAgICAgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIHZhciBkb2NNb2RlICAgICAgICAgICA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgICAgdmFyIG9sZElFICAgICAgICAgICAgID0gKGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpKTsKCiAgICAgIGlmIChvbGRJRSkgewogICAgICAgIHRoaXMuaWZyYW1lID0gJCgnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6MCIgdGFiaW5kZXg9Ii0xIiAvPicpLmhpZGUoKS5hcHBlbmRUbygnYm9keScpWzBdLmNvbnRlbnRXaW5kb3c7CiAgICAgICAgdGhpcy5uYXZpZ2F0ZShmcmFnbWVudCk7CiAgICAgIH0KCiAgICAgIC8vIERlcGVuZGluZyBvbiB3aGV0aGVyIHdlJ3JlIHVzaW5nIHB1c2hTdGF0ZSBvciBoYXNoZXMsIGFuZCB3aGV0aGVyCiAgICAgIC8vICdvbmhhc2hjaGFuZ2UnIGlzIHN1cHBvcnRlZCwgZGV0ZXJtaW5lIGhvdyB3ZSBjaGVjayB0aGUgVVJMIHN0YXRlLgogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7CiAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlICYmICgnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3cpICYmICFvbGRJRSkgewogICAgICAgICQod2luZG93KS5iaW5kKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fY2hlY2tVcmxJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuY2hlY2tVcmwsIHRoaXMuaW50ZXJ2YWwpOwogICAgICB9CgogICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgICAgdmFyIGxvYyA9IHdpbmRvdy5sb2NhdGlvbjsKICAgICAgdmFyIGF0Um9vdCAgPSBsb2MucGF0aG5hbWUgPT0gdGhpcy5vcHRpb25zLnJvb3Q7CgogICAgICAvLyBJZiB3ZSd2ZSBzdGFydGVkIG9mZiB3aXRoIGEgcm91dGUgZnJvbSBhIGBwdXNoU3RhdGVgLWVuYWJsZWQgYnJvd3NlciwKICAgICAgLy8gYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KICAgICAgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiB0aGlzLl93YW50c1B1c2hTdGF0ZSAmJiAhdGhpcy5faGFzUHVzaFN0YXRlICYmICFhdFJvb3QpIHsKICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChudWxsLCB0cnVlKTsKICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZSh0aGlzLm9wdGlvbnMucm9vdCArICcjJyArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgIC8vIFJldHVybiBpbW1lZGlhdGVseSBhcyBicm93c2VyIHdpbGwgZG8gcmVkaXJlY3QgdG8gbmV3IHVybAogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgLy8gT3IgaWYgd2UndmUgc3RhcnRlZCBvdXQgd2l0aCBhIGhhc2gtYmFzZWQgcm91dGUsIGJ1dCB3ZSdyZSBjdXJyZW50bHkKICAgICAgLy8gaW4gYSBicm93c2VyIHdoZXJlIGl0IGNvdWxkIGJlIGBwdXNoU3RhdGVgLWJhc2VkIGluc3RlYWQuLi4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c1B1c2hTdGF0ZSAmJiB0aGlzLl9oYXNQdXNoU3RhdGUgJiYgYXRSb290ICYmIGxvYy5oYXNoKSB7CiAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIGxvYy5wcm90b2NvbCArICcvLycgKyBsb2MuaG9zdCArIHRoaXMub3B0aW9ucy5yb290ICsgdGhpcy5mcmFnbWVudCk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgewogICAgICAgIHJldHVybiB0aGlzLmxvYWRVcmwoKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICQod2luZG93KS51bmJpbmQoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCkudW5iaW5kKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fY2hlY2tVcmxJbnRlcnZhbCk7CiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IGZhbHNlOwogICAgfSwKCiAgICAvLyBBZGQgYSByb3V0ZSB0byBiZSB0ZXN0ZWQgd2hlbiB0aGUgZnJhZ21lbnQgY2hhbmdlcy4gUm91dGVzIGFkZGVkIGxhdGVyCiAgICAvLyBtYXkgb3ZlcnJpZGUgcHJldmlvdXMgcm91dGVzLgogICAgcm91dGU6IGZ1bmN0aW9uKHJvdXRlLCBjYWxsYmFjaykgewogICAgICB0aGlzLmhhbmRsZXJzLnVuc2hpZnQoe3JvdXRlOiByb3V0ZSwgY2FsbGJhY2s6IGNhbGxiYWNrfSk7CiAgICB9LAoKICAgIC8vIENoZWNrcyB0aGUgY3VycmVudCBVUkwgdG8gc2VlIGlmIGl0IGhhcyBjaGFuZ2VkLCBhbmQgaWYgaXQgaGFzLAogICAgLy8gY2FsbHMgYGxvYWRVcmxgLCBub3JtYWxpemluZyBhY3Jvc3MgdGhlIGhpZGRlbiBpZnJhbWUuCiAgICBjaGVja1VybDogZnVuY3Rpb24oZSkgewogICAgICB2YXIgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgICAgaWYgKGN1cnJlbnQgPT0gdGhpcy5mcmFnbWVudCAmJiB0aGlzLmlmcmFtZSkgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICAgIGlmIChjdXJyZW50ID09IHRoaXMuZnJhZ21lbnQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHRoaXMuaWZyYW1lKSB0aGlzLm5hdmlnYXRlKGN1cnJlbnQpOwogICAgICB0aGlzLmxvYWRVcmwoKSB8fCB0aGlzLmxvYWRVcmwodGhpcy5nZXRIYXNoKCkpOwogICAgfSwKCiAgICAvLyBBdHRlbXB0IHRvIGxvYWQgdGhlIGN1cnJlbnQgVVJMIGZyYWdtZW50LiBJZiBhIHJvdXRlIHN1Y2NlZWRzIHdpdGggYQogICAgLy8gbWF0Y2gsIHJldHVybnMgYHRydWVgLiBJZiBubyBkZWZpbmVkIHJvdXRlcyBtYXRjaGVzIHRoZSBmcmFnbWVudCwKICAgIC8vIHJldHVybnMgYGZhbHNlYC4KICAgIGxvYWRVcmw6IGZ1bmN0aW9uKGZyYWdtZW50T3ZlcnJpZGUpIHsKICAgICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnRPdmVycmlkZSk7CiAgICAgIHZhciBtYXRjaGVkID0gXy5hbnkodGhpcy5oYW5kbGVycywgZnVuY3Rpb24oaGFuZGxlcikgewogICAgICAgIGlmIChoYW5kbGVyLnJvdXRlLnRlc3QoZnJhZ21lbnQpKSB7CiAgICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKGZyYWdtZW50KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBtYXRjaGVkOwogICAgfSwKCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBpZiAoIUhpc3Rvcnkuc3RhcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiBvcHRpb25zfTsKICAgICAgdmFyIGZyYWcgPSAoZnJhZ21lbnQgfHwgJycpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICBpZiAodGhpcy5mcmFnbWVudCA9PSBmcmFnKSByZXR1cm47CgogICAgICAvLyBJZiBwdXNoU3RhdGUgaXMgYXZhaWxhYmxlLCB3ZSB1c2UgaXQgdG8gc2V0IHRoZSBmcmFnbWVudCBhcyBhIHJlYWwgVVJMLgogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7CiAgICAgICAgaWYgKGZyYWcuaW5kZXhPZih0aGlzLm9wdGlvbnMucm9vdCkgIT0gMCkgZnJhZyA9IHRoaXMub3B0aW9ucy5yb290ICsgZnJhZzsKICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZzsKICAgICAgICB3aW5kb3cuaGlzdG9yeVtvcHRpb25zLnJlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgZG9jdW1lbnQudGl0bGUsIGZyYWcpOwoKICAgICAgLy8gSWYgaGFzaCBjaGFuZ2VzIGhhdmVuJ3QgYmVlbiBleHBsaWNpdGx5IGRpc2FibGVkLCB1cGRhdGUgdGhlIGhhc2gKICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZzsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHdpbmRvdy5sb2NhdGlvbiwgZnJhZywgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICBpZiAodGhpcy5pZnJhbWUgJiYgKGZyYWcgIT0gdGhpcy5nZXRGcmFnbWVudCh0aGlzLmdldEhhc2godGhpcy5pZnJhbWUpKSkpIHsKICAgICAgICAgIC8vIE9wZW5pbmcgYW5kIGNsb3NpbmcgdGhlIGlmcmFtZSB0cmlja3MgSUU3IGFuZCBlYXJsaWVyIHRvIHB1c2ggYSBoaXN0b3J5IGVudHJ5IG9uIGhhc2gtdGFnIGNoYW5nZS4KICAgICAgICAgIC8vIFdoZW4gcmVwbGFjZSBpcyB0cnVlLCB3ZSBkb24ndCB3YW50IHRoaXMuCiAgICAgICAgICBpZighb3B0aW9ucy5yZXBsYWNlKSB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWcsIG9wdGlvbnMucmVwbGFjZSk7CiAgICAgICAgfQoKICAgICAgLy8gSWYgeW91J3ZlIHRvbGQgdXMgdGhhdCB5b3UgZXhwbGljaXRseSBkb24ndCB3YW50IGZhbGxiYWNrIGhhc2hjaGFuZ2UtCiAgICAgIC8vIGJhc2VkIGhpc3RvcnksIHRoZW4gYG5hdmlnYXRlYCBiZWNvbWVzIGEgcGFnZSByZWZyZXNoLgogICAgICB9IGVsc2UgewogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24odGhpcy5vcHRpb25zLnJvb3QgKyBmcmFnbWVudCk7CiAgICAgIH0KICAgICAgaWYgKG9wdGlvbnMudHJpZ2dlcikgdGhpcy5sb2FkVXJsKGZyYWdtZW50KTsKICAgIH0sCgogICAgLy8gVXBkYXRlIHRoZSBoYXNoIGxvY2F0aW9uLCBlaXRoZXIgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGVudHJ5LCBvciBhZGRpbmcKICAgIC8vIGEgbmV3IG9uZSB0byB0aGUgYnJvd3NlciBoaXN0b3J5LgogICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIGxvY2F0aW9uLnJlcGxhY2UobG9jYXRpb24udG9TdHJpbmcoKS5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJykgKyAnIycgKyBmcmFnbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9jYXRpb24uaGFzaCA9IGZyYWdtZW50OwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIEJhY2tib25lLlZpZXcKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIENyZWF0aW5nIGEgQmFja2JvbmUuVmlldyBjcmVhdGVzIGl0cyBpbml0aWFsIGVsZW1lbnQgb3V0c2lkZSBvZiB0aGUgRE9NLAogIC8vIGlmIGFuIGV4aXN0aW5nIGVsZW1lbnQgaXMgbm90IHByb3ZpZGVkLi4uCiAgdmFyIFZpZXcgPSBCYWNrYm9uZS5WaWV3ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdGhpcy5jaWQgPSBfLnVuaXF1ZUlkKCd2aWV3Jyk7CiAgICB0aGlzLl9jb25maWd1cmUob3B0aW9ucyB8fCB7fSk7CiAgICB0aGlzLl9lbnN1cmVFbGVtZW50KCk7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICB9OwoKICAvLyBDYWNoZWQgcmVnZXggdG8gc3BsaXQga2V5cyBmb3IgYGRlbGVnYXRlYC4KICB2YXIgZGVsZWdhdGVFdmVudFNwbGl0dGVyID0gL14oXFMrKVxzKiguKikkLzsKCiAgLy8gTGlzdCBvZiB2aWV3IG9wdGlvbnMgdG8gYmUgbWVyZ2VkIGFzIHByb3BlcnRpZXMuCiAgdmFyIHZpZXdPcHRpb25zID0gWydtb2RlbCcsICdjb2xsZWN0aW9uJywgJ2VsJywgJ2lkJywgJ2F0dHJpYnV0ZXMnLCAnY2xhc3NOYW1lJywgJ3RhZ05hbWUnXTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlZpZXcqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFZpZXcucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBgdGFnTmFtZWAgb2YgYSBWaWV3J3MgZWxlbWVudCBpcyBgImRpdiJgLgogICAgdGFnTmFtZTogJ2RpdicsCgogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcmVkIHRvIGdsb2JhbCBsb29rdXBzIHdoZXJlIHBvc3NpYmxlLgogICAgJDogZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIHRoaXMuJGVsLmZpbmQoc2VsZWN0b3IpOwogICAgfSwKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vICoqcmVuZGVyKiogaXMgdGhlIGNvcmUgZnVuY3Rpb24gdGhhdCB5b3VyIHZpZXcgc2hvdWxkIG92ZXJyaWRlLCBpbiBvcmRlcgogICAgLy8gdG8gcG9wdWxhdGUgaXRzIGVsZW1lbnQgKGB0aGlzLmVsYCksIHdpdGggdGhlIGFwcHJvcHJpYXRlIEhUTUwuIFRoZQogICAgLy8gY29udmVudGlvbiBpcyBmb3IgKipyZW5kZXIqKiB0byBhbHdheXMgcmV0dXJuIGB0aGlzYC4KICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBSZW1vdmUgdGhpcyB2aWV3IGZyb20gdGhlIERPTS4gTm90ZSB0aGF0IHRoZSB2aWV3IGlzbid0IHByZXNlbnQgaW4gdGhlCiAgICAvLyBET00gYnkgZGVmYXVsdCwgc28gY2FsbGluZyB0aGlzIG1ldGhvZCBtYXkgYmUgYSBuby1vcC4KICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRm9yIHNtYWxsIGFtb3VudHMgb2YgRE9NIEVsZW1lbnRzLCB3aGVyZSBhIGZ1bGwtYmxvd24gdGVtcGxhdGUgaXNuJ3QKICAgIC8vIG5lZWRlZCwgdXNlICoqbWFrZSoqIHRvIG1hbnVmYWN0dXJlIGVsZW1lbnRzLCBvbmUgYXQgYSB0aW1lLgogICAgLy8KICAgIC8vICAgICB2YXIgZWwgPSB0aGlzLm1ha2UoJ2xpJywgeydjbGFzcyc6ICdyb3cnfSwgdGhpcy5tb2RlbC5lc2NhcGUoJ3RpdGxlJykpOwogICAgLy8KICAgIG1ha2U6IGZ1bmN0aW9uKHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGNvbnRlbnQpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTsKICAgICAgaWYgKGF0dHJpYnV0ZXMpICQoZWwpLmF0dHIoYXR0cmlidXRlcyk7CiAgICAgIGlmIChjb250ZW50KSAkKGVsKS5odG1sKGNvbnRlbnQpOwogICAgICByZXR1cm4gZWw7CiAgICB9LAoKICAgIC8vIENoYW5nZSB0aGUgdmlldydzIGVsZW1lbnQgKGB0aGlzLmVsYCBwcm9wZXJ0eSksIGluY2x1ZGluZyBldmVudAogICAgLy8gcmUtZGVsZWdhdGlvbi4KICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGRlbGVnYXRlKSB7CiAgICAgIGlmICh0aGlzLiRlbCkgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHRoaXMuJGVsID0gKGVsZW1lbnQgaW5zdGFuY2VvZiAkKSA/IGVsZW1lbnQgOiAkKGVsZW1lbnQpOwogICAgICB0aGlzLmVsID0gdGhpcy4kZWxbMF07CiAgICAgIGlmIChkZWxlZ2F0ZSAhPT0gZmFsc2UpIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFNldCBjYWxsYmFja3MsIHdoZXJlIGB0aGlzLmV2ZW50c2AgaXMgYSBoYXNoIG9mCiAgICAvLwogICAgLy8gKnsiZXZlbnQgc2VsZWN0b3IiOiAiY2FsbGJhY2sifSoKICAgIC8vCiAgICAvLyAgICAgewogICAgLy8gICAgICAgJ21vdXNlZG93biAudGl0bGUnOiAgJ2VkaXQnLAogICAgLy8gICAgICAgJ2NsaWNrIC5idXR0b24nOiAgICAgJ3NhdmUnCiAgICAvLyAgICAgICAnY2xpY2sgLm9wZW4nOiAgICAgICBmdW5jdGlvbihlKSB7IC4uLiB9CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIHBhaXJzLiBDYWxsYmFja3Mgd2lsbCBiZSBib3VuZCB0byB0aGUgdmlldywgd2l0aCBgdGhpc2Agc2V0IHByb3Blcmx5LgogICAgLy8gVXNlcyBldmVudCBkZWxlZ2F0aW9uIGZvciBlZmZpY2llbmN5LgogICAgLy8gT21pdHRpbmcgdGhlIHNlbGVjdG9yIGJpbmRzIHRoZSBldmVudCB0byBgdGhpcy5lbGAuCiAgICAvLyBUaGlzIG9ubHkgd29ya3MgZm9yIGRlbGVnYXRlLWFibGUgZXZlbnRzOiBub3QgYGZvY3VzYCwgYGJsdXJgLCBhbmQKICAgIC8vIG5vdCBgY2hhbmdlYCwgYHN1Ym1pdGAsIGFuZCBgcmVzZXRgIGluIEludGVybmV0IEV4cGxvcmVyLgogICAgZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKGV2ZW50cykgewogICAgICBpZiAoIShldmVudHMgfHwgKGV2ZW50cyA9IGdldFZhbHVlKHRoaXMsICdldmVudHMnKSkpKSByZXR1cm47CiAgICAgIHRoaXMudW5kZWxlZ2F0ZUV2ZW50cygpOwogICAgICBmb3IgKHZhciBrZXkgaW4gZXZlbnRzKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IGV2ZW50c1trZXldOwogICAgICAgIGlmICghXy5pc0Z1bmN0aW9uKG1ldGhvZCkpIG1ldGhvZCA9IHRoaXNbZXZlbnRzW2tleV1dOwogICAgICAgIGlmICghbWV0aG9kKSB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCAiJyArIGV2ZW50c1trZXldICsgJyIgZG9lcyBub3QgZXhpc3QnKTsKICAgICAgICB2YXIgbWF0Y2ggPSBrZXkubWF0Y2goZGVsZWdhdGVFdmVudFNwbGl0dGVyKTsKICAgICAgICB2YXIgZXZlbnROYW1lID0gbWF0Y2hbMV0sIHNlbGVjdG9yID0gbWF0Y2hbMl07CiAgICAgICAgbWV0aG9kID0gXy5iaW5kKG1ldGhvZCwgdGhpcyk7CiAgICAgICAgZXZlbnROYW1lICs9ICcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQ7CiAgICAgICAgaWYgKHNlbGVjdG9yID09PSAnJykgewogICAgICAgICAgdGhpcy4kZWwuYmluZChldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVsLmRlbGVnYXRlKHNlbGVjdG9yLCBldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8vIENsZWFycyBhbGwgY2FsbGJhY2tzIHByZXZpb3VzbHkgYm91bmQgdG8gdGhlIHZpZXcgd2l0aCBgZGVsZWdhdGVFdmVudHNgLgogICAgLy8gWW91IHVzdWFsbHkgZG9uJ3QgbmVlZCB0byB1c2UgdGhpcywgYnV0IG1heSB3aXNoIHRvIGlmIHlvdSBoYXZlIG11bHRpcGxlCiAgICAvLyBCYWNrYm9uZSB2aWV3cyBhdHRhY2hlZCB0byB0aGUgc2FtZSBET00gZWxlbWVudC4KICAgIHVuZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLiRlbC51bmJpbmQoJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZCk7CiAgICB9LAoKICAgIC8vIFBlcmZvcm1zIHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24gb2YgYSBWaWV3IHdpdGggYSBzZXQgb2Ygb3B0aW9ucy4KICAgIC8vIEtleXMgd2l0aCBzcGVjaWFsIG1lYW5pbmcgKihtb2RlbCwgY29sbGVjdGlvbiwgaWQsIGNsYXNzTmFtZSkqLCBhcmUKICAgIC8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSB2aWV3LgogICAgX2NvbmZpZ3VyZTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBpZiAodGhpcy5vcHRpb25zKSBvcHRpb25zID0gXy5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdmlld09wdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGF0dHIgPSB2aWV3T3B0aW9uc1tpXTsKICAgICAgICBpZiAob3B0aW9uc1thdHRyXSkgdGhpc1thdHRyXSA9IG9wdGlvbnNbYXR0cl07CiAgICAgIH0KICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIH0sCgogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICB2YXIgYXR0cnMgPSBnZXRWYWx1ZSh0aGlzLCAnYXR0cmlidXRlcycpIHx8IHt9OwogICAgICAgIGlmICh0aGlzLmlkKSBhdHRycy5pZCA9IHRoaXMuaWQ7CiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSBhdHRyc1snY2xhc3MnXSA9IHRoaXMuY2xhc3NOYW1lOwogICAgICAgIHRoaXMuc2V0RWxlbWVudCh0aGlzLm1ha2UodGhpcy50YWdOYW1lLCBhdHRycyksIGZhbHNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldEVsZW1lbnQodGhpcy5lbCwgZmFsc2UpOwogICAgICB9CiAgICB9CgogIH0pOwoKICAvLyBUaGUgc2VsZi1wcm9wYWdhdGluZyBleHRlbmQgZnVuY3Rpb24gdGhhdCBCYWNrYm9uZSBjbGFzc2VzIHVzZS4KICB2YXIgZXh0ZW5kID0gZnVuY3Rpb24gKHByb3RvUHJvcHMsIGNsYXNzUHJvcHMpIHsKICAgIHZhciBjaGlsZCA9IGluaGVyaXRzKHRoaXMsIHByb3RvUHJvcHMsIGNsYXNzUHJvcHMpOwogICAgY2hpbGQuZXh0ZW5kID0gdGhpcy5leHRlbmQ7CiAgICByZXR1cm4gY2hpbGQ7CiAgfTsKCiAgLy8gU2V0IHVwIGluaGVyaXRhbmNlIGZvciB0aGUgbW9kZWwsIGNvbGxlY3Rpb24sIGFuZCB2aWV3LgogIE1vZGVsLmV4dGVuZCA9IENvbGxlY3Rpb24uZXh0ZW5kID0gUm91dGVyLmV4dGVuZCA9IFZpZXcuZXh0ZW5kID0gZXh0ZW5kOwoKICAvLyBCYWNrYm9uZS5zeW5jCiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBNYXAgZnJvbSBDUlVEIHRvIEhUVFAgZm9yIG91ciBkZWZhdWx0IGBCYWNrYm9uZS5zeW5jYCBpbXBsZW1lbnRhdGlvbi4KICB2YXIgbWV0aG9kTWFwID0gewogICAgJ2NyZWF0ZSc6ICdQT1NUJywKICAgICd1cGRhdGUnOiAnUFVUJywKICAgICdkZWxldGUnOiAnREVMRVRFJywKICAgICdyZWFkJzogICAnR0VUJwogIH07CgogIC8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBtYW5uZXIgaW4gd2hpY2ggQmFja2JvbmUgcGVyc2lzdHMKICAvLyBtb2RlbHMgdG8gdGhlIHNlcnZlci4gWW91IHdpbGwgYmUgcGFzc2VkIHRoZSB0eXBlIG9mIHJlcXVlc3QsIGFuZCB0aGUKICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdAogIC8vIHRvIHRoZSBtb2RlbCdzIGB1cmwoKWAuIFNvbWUgcG9zc2libGUgY3VzdG9taXphdGlvbnMgY291bGQgYmU6CiAgLy8KICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC4KICAvLyAqIFNlbmQgdXAgdGhlIG1vZGVscyBhcyBYTUwgaW5zdGVhZCBvZiBKU09OLgogIC8vICogUGVyc2lzdCBtb2RlbHMgdmlhIFdlYlNvY2tldHMgaW5zdGVhZCBvZiBBamF4LgogIC8vCiAgLy8gVHVybiBvbiBgQmFja2JvbmUuZW11bGF0ZUhUVFBgIGluIG9yZGVyIHRvIHNlbmQgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzCiAgLy8gYXMgYFBPU1RgLCB3aXRoIGEgYF9tZXRob2RgIHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0cnVlIEhUVFAgbWV0aG9kLAogIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAKICAvLyBpbnN0ZWFkIG9mIGBhcHBsaWNhdGlvbi9qc29uYCB3aXRoIHRoZSBtb2RlbCBpbiBhIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgLy8gVXNlZnVsIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBzZXJ2ZXItc2lkZSBsYW5ndWFnZXMgbGlrZSAqKlBIUCoqIHRoYXQgbWFrZQogIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdHlwZSA9IG1ldGhvZE1hcFttZXRob2RdOwoKICAgIC8vIERlZmF1bHQgb3B0aW9ucywgdW5sZXNzIHNwZWNpZmllZC4KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CgogICAgLy8gRGVmYXVsdCBKU09OLXJlcXVlc3Qgb3B0aW9ucy4KICAgIHZhciBwYXJhbXMgPSB7dHlwZTogdHlwZSwgZGF0YVR5cGU6ICdqc29uJ307CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KICAgIGlmICghb3B0aW9ucy51cmwpIHsKICAgICAgcGFyYW1zLnVybCA9IGdldFZhbHVlKG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgIH0KCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuCiAgICBpZiAoIW9wdGlvbnMuZGF0YSAmJiBtb2RlbCAmJiAobWV0aG9kID09ICdjcmVhdGUnIHx8IG1ldGhvZCA9PSAndXBkYXRlJykpIHsKICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL2pzb24nOwogICAgICBwYXJhbXMuZGF0YSA9IEpTT04uc3RyaW5naWZ5KG1vZGVsLnRvSlNPTigpKTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBKU09OIGJ5IGVuY29kaW5nIHRoZSByZXF1ZXN0IGludG8gYW4gSFRNTC1mb3JtLgogICAgaWYgKEJhY2tib25lLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogICAgaWYgKEJhY2tib25lLmVtdWxhdGVIVFRQKSB7CiAgICAgIGlmICh0eXBlID09PSAnUFVUJyB8fCB0eXBlID09PSAnREVMRVRFJykgewogICAgICAgIGlmIChCYWNrYm9uZS5lbXVsYXRlSlNPTikgcGFyYW1zLmRhdGEuX21ldGhvZCA9IHR5cGU7CiAgICAgICAgcGFyYW1zLnR5cGUgPSAnUE9TVCc7CiAgICAgICAgcGFyYW1zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLUhUVFAtTWV0aG9kLU92ZXJyaWRlJywgdHlwZSk7CiAgICAgICAgfTsKICAgICAgfQogICAgfQoKICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC4KICAgIGlmIChwYXJhbXMudHlwZSAhPT0gJ0dFVCcgJiYgIUJhY2tib25lLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5wcm9jZXNzRGF0YSA9IGZhbHNlOwogICAgfQoKICAgIC8vIE1ha2UgdGhlIHJlcXVlc3QsIGFsbG93aW5nIHRoZSB1c2VyIHRvIG92ZXJyaWRlIGFueSBBamF4IG9wdGlvbnMuCiAgICByZXR1cm4gJC5hamF4KF8uZXh0ZW5kKHBhcmFtcywgb3B0aW9ucykpOwogIH07CgogIC8vIFdyYXAgYW4gb3B0aW9uYWwgZXJyb3IgY2FsbGJhY2sgd2l0aCBhIGZhbGxiYWNrIGVycm9yIGV2ZW50LgogIEJhY2tib25lLndyYXBFcnJvciA9IGZ1bmN0aW9uKG9uRXJyb3IsIG9yaWdpbmFsTW9kZWwsIG9wdGlvbnMpIHsKICAgIHJldHVybiBmdW5jdGlvbihtb2RlbCwgcmVzcCkgewogICAgICByZXNwID0gbW9kZWwgPT09IG9yaWdpbmFsTW9kZWwgPyByZXNwIDogbW9kZWw7CiAgICAgIGlmIChvbkVycm9yKSB7CiAgICAgICAgb25FcnJvcihvcmlnaW5hbE1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcmlnaW5hbE1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgb3JpZ2luYWxNb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH0KICAgIH07CiAgfTsKCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KCiAgLy8gU2hhcmVkIGVtcHR5IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHRvIGFpZCBpbiBwcm90b3R5cGUtY2hhaW4gY3JlYXRpb24uCiAgdmFyIGN0b3IgPSBmdW5jdGlvbigpe307CgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb3JyZWN0bHkgc2V0IHVwIHRoZSBwcm90b3R5cGUgY2hhaW4sIGZvciBzdWJjbGFzc2VzLgogIC8vIFNpbWlsYXIgdG8gYGdvb2cuaW5oZXJpdHNgLCBidXQgdXNlcyBhIGhhc2ggb2YgcHJvdG90eXBlIHByb3BlcnRpZXMgYW5kCiAgLy8gY2xhc3MgcHJvcGVydGllcyB0byBiZSBleHRlbmRlZC4KICB2YXIgaW5oZXJpdHMgPSBmdW5jdGlvbihwYXJlbnQsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICB2YXIgY2hpbGQ7CgogICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQogICAgLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAogICAgLy8gYnkgdXMgdG8gc2ltcGx5IGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yLgogICAgaWYgKHByb3RvUHJvcHMgJiYgcHJvdG9Qcm9wcy5oYXNPd25Qcm9wZXJ0eSgnY29uc3RydWN0b3InKSkgewogICAgICBjaGlsZCA9IHByb3RvUHJvcHMuY29uc3RydWN0b3I7CiAgICB9IGVsc2UgewogICAgICBjaGlsZCA9IGZ1bmN0aW9uKCl7IHBhcmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OwogICAgfQoKICAgIC8vIEluaGVyaXQgY2xhc3MgKHN0YXRpYykgcHJvcGVydGllcyBmcm9tIHBhcmVudC4KICAgIF8uZXh0ZW5kKGNoaWxkLCBwYXJlbnQpOwoKICAgIC8vIFNldCB0aGUgcHJvdG90eXBlIGNoYWluIHRvIGluaGVyaXQgZnJvbSBgcGFyZW50YCwgd2l0aG91dCBjYWxsaW5nCiAgICAvLyBgcGFyZW50YCdzIGNvbnN0cnVjdG9yIGZ1bmN0aW9uLgogICAgY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwogICAgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsKCiAgICAvLyBBZGQgcHJvdG90eXBlIHByb3BlcnRpZXMgKGluc3RhbmNlIHByb3BlcnRpZXMpIHRvIHRoZSBzdWJjbGFzcywKICAgIC8vIGlmIHN1cHBsaWVkLgogICAgaWYgKHByb3RvUHJvcHMpIF8uZXh0ZW5kKGNoaWxkLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CgogICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCiAgICBpZiAoc3RhdGljUHJvcHMpIF8uZXh0ZW5kKGNoaWxkLCBzdGF0aWNQcm9wcyk7CgogICAgLy8gQ29ycmVjdGx5IHNldCBjaGlsZCdzIGBwcm90b3R5cGUuY29uc3RydWN0b3JgLgogICAgY2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGQ7CgogICAgLy8gU2V0IGEgY29udmVuaWVuY2UgcHJvcGVydHkgaW4gY2FzZSB0aGUgcGFyZW50J3MgcHJvdG90eXBlIGlzIG5lZWRlZCBsYXRlci4KICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgogICAgcmV0dXJuIGNoaWxkOwogIH07CgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgYSB2YWx1ZSBmcm9tIGEgQmFja2JvbmUgb2JqZWN0IGFzIGEgcHJvcGVydHkKICAvLyBvciBhcyBhIGZ1bmN0aW9uLgogIHZhciBnZXRWYWx1ZSA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcCkgewogICAgaWYgKCEob2JqZWN0ICYmIG9iamVjdFtwcm9wXSkpIHJldHVybiBudWxsOwogICAgcmV0dXJuIF8uaXNGdW5jdGlvbihvYmplY3RbcHJvcF0pID8gb2JqZWN0W3Byb3BdKCkgOiBvYmplY3RbcHJvcF07CiAgfTsKCiAgLy8gVGhyb3cgYW4gZXJyb3Igd2hlbiBhIFVSTCBpcyBuZWVkZWQsIGFuZCBub25lIGlzIHN1cHBsaWVkLgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdBICJ1cmwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgfTsKCn0pLmNhbGwodGhpcyk7Cg==", "content_type": "application/javascript"}, "app/namespace.js": {"data": "ZGVmaW5lKFsKICAvLyBMaWJzCiAgImpxdWVyeSIsCiAgInVzZSF1bmRlcnNjb3JlIiwKICAidXNlIWJhY2tib25lIiwKICAidXNlIWJhY2tib25lX2NvdWNoZGIiCl0sCgpmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSkgewogIC8vIFB1dCBhcHBsaWNhdGlvbiB3aWRlIGNvZGUgaGVyZQoKICByZXR1cm4gewogICAgLy8gVGhpcyBpcyB1c2VmdWwgd2hlbiBkZXZlbG9waW5nIGlmIHlvdSBkb24ndCB3YW50IHRvIHVzZSBhCiAgICAvLyBidWlsZCBwcm9jZXNzIGV2ZXJ5IHRpbWUgeW91IGNoYW5nZSBhIHRlbXBsYXRlLgogICAgLy8KICAgIC8vIERlbGV0ZSBpZiB5b3UgYXJlIHVzaW5nIGEgZGlmZmVyZW50IHRlbXBsYXRlIGxvYWRpbmcgbWV0aG9kLgogICAgZmV0Y2hUZW1wbGF0ZTogZnVuY3Rpb24ocGF0aCwgZG9uZSkgewogICAgICB2YXIgSlNUID0gd2luZG93LkpTVCA9IHdpbmRvdy5KU1QgfHwge307CiAgICAgIHZhciBkZWYgPSBuZXcgJC5EZWZlcnJlZCgpOwoKICAgICAgLy8gU2hvdWxkIGJlIGFuIGluc3RhbnQgc3luY2hyb25vdXMgd2F5IG9mIGdldHRpbmcgdGhlIHRlbXBsYXRlLCBpZiBpdAogICAgICAvLyBleGlzdHMgaW4gdGhlIEpTVCBvYmplY3QuCiAgICAgIGlmIChKU1RbcGF0aF0pIHsKICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKGRvbmUpKSB7CiAgICAgICAgICBkb25lKEpTVFtwYXRoXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVmLnJlc29sdmUoSlNUW3BhdGhdKTsKICAgICAgfQoKICAgICAgLy8gRmV0Y2ggaXQgYXN5bmNocm9ub3VzbHkgaWYgbm90IGF2YWlsYWJsZSBmcm9tIEpTVCwgZW5zdXJlIHRoYXQKICAgICAgLy8gdGVtcGxhdGUgcmVxdWVzdHMgYXJlIG5ldmVyIGNhY2hlZCBhbmQgcHJldmVudCBnbG9iYWwgYWpheCBldmVudAogICAgICAvLyBoYW5kbGVycyBmcm9tIGZpcmluZy4KICAgICAgJC5hamF4KHsKICAgICAgICB1cmw6IHBhdGgsCiAgICAgICAgdHlwZTogImdldCIsCiAgICAgICAgZGF0YVR5cGU6ICJ0ZXh0IiwKICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgZ2xvYmFsOiBmYWxzZSwKCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oY29udGVudHMpIHsKICAgICAgICAgIEpTVFtwYXRoXSA9IF8udGVtcGxhdGUoY29udGVudHMpOwoKICAgICAgICAgIC8vIFNldCB0aGUgZ2xvYmFsIEpTVCBjYWNoZSBhbmQgcmV0dXJuIHRoZSB0ZW1wbGF0ZQogICAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihkb25lKSkgewogICAgICAgICAgICBkb25lKEpTVFtwYXRoXSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUmVzb2x2ZSB0aGUgdGVtcGxhdGUgZGVmZXJyZWQKICAgICAgICAgIGRlZi5yZXNvbHZlKEpTVFtwYXRoXSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIEVuc3VyZSBhIG5vcm1hbGl6ZWQgcmV0dXJuIHZhbHVlIChQcm9taXNlKQogICAgICByZXR1cm4gZGVmLnByb21pc2UoKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgY3VzdG9tIG9iamVjdCB3aXRoIGEgbmVzdGVkIFZpZXdzIG9iamVjdAogICAgbW9kdWxlOiBmdW5jdGlvbihhZGRpdGlvbmFsUHJvcHMpIHsKICAgICAgcmV0dXJuIF8uZXh0ZW5kKHsgVmlld3M6IHt9IH0sIGFkZGl0aW9uYWxQcm9wcyk7CiAgICB9LAoKICAgIC8vIEtlZXAgYWN0aXZlIGFwcGxpY2F0aW9uIGluc3RhbmNlcyBuYW1lc3BhY2VkIHVuZGVyIGFuIGFwcCBvYmplY3QuCiAgICBhcHA6IF8uZXh0ZW5kKHt9LCBCYWNrYm9uZS5FdmVudHMpCiAgfTsKfSk7Cg==", "content_type": "application/javascript"}, "app/modules/example.js": {"data": "ZGVmaW5lKFsKICAibmFtZXNwYWNlIiwKCiAgLy8gTGlicwogICJ1c2UhYmFja2JvbmUiLAogICJ1c2UhYmFja2JvbmVfY291Y2hkYiIKCiAgLy8gTW9kdWxlcwoKICAvLyBQbHVnaW5zCl0sCgpmdW5jdGlvbihuYW1lc3BhY2UsIEJhY2tib25lKSB7CgogIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUKICB2YXIgRXhhbXBsZSA9IG5hbWVzcGFjZS5tb2R1bGUoKTsKCiAgLy8gRXhhbXBsZSBleHRlbmRpbmdzCiAgRXhhbXBsZS5Nb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7IC8qIC4uLiAqLyB9KTsKICBFeGFtcGxlLkNvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CgkJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CgkJCXRoaXMucGFnZSA9IDE7CgkJfSwKCQlkYiA6IHsKCQkJdmlldzogImJ5SWQiLAoJCX0sCgkJdXJsIDogIi9leGFtcGxlIiwKCQltb2RlbCA6IEV4YW1wbGUKCX0pOwogIEV4YW1wbGUuUm91dGVyID0gQmFja2JvbmUuUm91dGVyLmV4dGVuZCh7IC8qIC4uLiAqLyB9KTsKCiAgLy8gVGhpcyB3aWxsIGZldGNoIHRoZSB0dXRvcmlhbCB0ZW1wbGF0ZSBhbmQgcmVuZGVyIGl0LgogIEV4YW1wbGUuVmlld3MuVHV0b3JpYWwgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICB0ZW1wbGF0ZTogImFwcC90ZW1wbGF0ZXMvZXhhbXBsZS5odG1sIiwKCiAgICByZW5kZXI6IGZ1bmN0aW9uKGRvbmUpIHsKICAgICAgdmFyIHZpZXcgPSB0aGlzOwoKICAgICAgLy8gRmV0Y2ggdGhlIHRlbXBsYXRlLCByZW5kZXIgaXQgdG8gdGhlIFZpZXcgZWxlbWVudCBhbmQgY2FsbCBkb25lLgogICAgICBuYW1lc3BhY2UuZmV0Y2hUZW1wbGF0ZSh0aGlzLnRlbXBsYXRlLCBmdW5jdGlvbih0bXBsKSB7CiAgICAgICAgdmlldy5lbC5pbm5lckhUTUwgPSB0bXBsKCk7CgogICAgICAgIC8vIElmIGEgZG9uZSBmdW5jdGlvbiBpcyBwYXNzZWQsIGNhbGwgaXQgd2l0aCB0aGUgZWxlbWVudAogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oZG9uZSkpIHsKICAgICAgICAgIGRvbmUodmlldy5lbCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gUmVxdWlyZWQsIHJldHVybiB0aGUgbW9kdWxlIGZvciBBTUQgY29tcGxpYW5jZQogIHJldHVybiBFeGFtcGxlOwoKfSk7Cg==", "content_type": "application/javascript"}, "assets/js/libs/jquery.js": {"data": "LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNy4xCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBDb3B5cmlnaHQgMjAxMSwgSm9obiBSZXNpZwogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICogQ29weXJpZ2h0IDIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLgogKgogKiBEYXRlOiBNb24gTm92IDIxIDIxOjExOjAzIDIwMTEgLTA1MDAKICovCihmdW5jdGlvbiggd2luZG93LCB1bmRlZmluZWQgKSB7CgovLyBVc2UgdGhlIGNvcnJlY3QgZG9jdW1lbnQgYWNjb3JkaW5nbHkgd2l0aCB3aW5kb3cgYXJndW1lbnQgKHNhbmRib3gpCnZhciBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwKCW5hdmlnYXRvciA9IHdpbmRvdy5uYXZpZ2F0b3IsCglsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjsKdmFyIGpRdWVyeSA9IChmdW5jdGlvbigpIHsKCi8vIERlZmluZSBhIGxvY2FsIGNvcHkgb2YgalF1ZXJ5CnZhciBqUXVlcnkgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQgKSB7CgkJLy8gVGhlIGpRdWVyeSBvYmplY3QgaXMgYWN0dWFsbHkganVzdCB0aGUgaW5pdCBjb25zdHJ1Y3RvciAnZW5oYW5jZWQnCgkJcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKTsKCX0sCgoJLy8gTWFwIG92ZXIgalF1ZXJ5IGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSwKCgkvLyBNYXAgb3ZlciB0aGUgJCBpbiBjYXNlIG9mIG92ZXJ3cml0ZQoJXyQgPSB3aW5kb3cuJCwKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXJvb3RqUXVlcnksCgoJLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3Mgb3IgSUQgc3RyaW5ncwoJLy8gUHJpb3JpdGl6ZSAjaWQgb3ZlciA8dGFnPiB0byBhdm9pZCBYU1MgdmlhIGxvY2F0aW9uLmhhc2ggKCM5NTIxKQoJcXVpY2tFeHByID0gL14oPzpbXiM8XSooPFtcd1xXXSs+KVtePl0qJHwjKFtcd1wtXSopJCkvLAoKCS8vIENoZWNrIGlmIGEgc3RyaW5nIGhhcyBhIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlciBpbiBpdAoJcm5vdHdoaXRlID0gL1xTLywKCgkvLyBVc2VkIGZvciB0cmltbWluZyB3aGl0ZXNwYWNlCgl0cmltTGVmdCA9IC9eXHMrLywKCXRyaW1SaWdodCA9IC9ccyskLywKCgkvLyBNYXRjaCBhIHN0YW5kYWxvbmUgdGFnCglyc2luZ2xlVGFnID0gL148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLywKCgkvLyBKU09OIFJlZ0V4cAoJcnZhbGlkY2hhcnMgPSAvXltcXSw6e31cc10qJC8sCglydmFsaWRlc2NhcGUgPSAvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLAoJcnZhbGlkdG9rZW5zID0gLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLAoJcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKCgkvLyBVc2VyYWdlbnQgUmVnRXhwCglyd2Via2l0ID0gLyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8sCglyb3BlcmEgPSAvKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8sCglybXNpZSA9IC8obXNpZSkgKFtcdy5dKykvLAoJcm1vemlsbGEgPSAvKG1vemlsbGEpKD86Lio/IHJ2OihbXHcuXSspKT8vLAoKCS8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZwoJcmRhc2hBbHBoYSA9IC8tKFthLXpdfFswLTldKS9pZywKCXJtc1ByZWZpeCA9IC9eLW1zLS8sCgoJLy8gVXNlZCBieSBqUXVlcnkuY2FtZWxDYXNlIGFzIGNhbGxiYWNrIHRvIHJlcGxhY2UoKQoJZmNhbWVsQ2FzZSA9IGZ1bmN0aW9uKCBhbGwsIGxldHRlciApIHsKCQlyZXR1cm4gKCBsZXR0ZXIgKyAiIiApLnRvVXBwZXJDYXNlKCk7Cgl9LAoKCS8vIEtlZXAgYSBVc2VyQWdlbnQgc3RyaW5nIGZvciB1c2Ugd2l0aCBqUXVlcnkuYnJvd3NlcgoJdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCwKCgkvLyBGb3IgbWF0Y2hpbmcgdGhlIGVuZ2luZSBhbmQgdmVyc2lvbiBvZiB0aGUgYnJvd3NlcgoJYnJvd3Nlck1hdGNoLAoKCS8vIFRoZSBkZWZlcnJlZCB1c2VkIG9uIERPTSByZWFkeQoJcmVhZHlMaXN0LAoKCS8vIFRoZSByZWFkeSBldmVudCBoYW5kbGVyCglET01Db250ZW50TG9hZGVkLAoKCS8vIFNhdmUgYSByZWZlcmVuY2UgdG8gc29tZSBjb3JlIG1ldGhvZHMKCXRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCWhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCglwdXNoID0gQXJyYXkucHJvdG90eXBlLnB1c2gsCglzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKCXRyaW0gPSBTdHJpbmcucHJvdG90eXBlLnRyaW0sCglpbmRleE9mID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YsCgoJLy8gW1tDbGFzc11dIC0+IHR5cGUgcGFpcnMKCWNsYXNzMnR5cGUgPSB7fTsKCmpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7Cgljb25zdHJ1Y3RvcjogalF1ZXJ5LAoJaW5pdDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0LCByb290alF1ZXJ5ICkgewoJCXZhciBtYXRjaCwgZWxlbSwgcmV0LCBkb2M7CgoJCS8vIEhhbmRsZSAkKCIiKSwgJChudWxsKSwgb3IgJCh1bmRlZmluZWQpCgkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJLy8gSGFuZGxlICQoRE9NRWxlbWVudCkKCQlpZiAoIHNlbGVjdG9yLm5vZGVUeXBlICkgewoJCQl0aGlzLmNvbnRleHQgPSB0aGlzWzBdID0gc2VsZWN0b3I7CgkJCXRoaXMubGVuZ3RoID0gMTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBUaGUgYm9keSBlbGVtZW50IG9ubHkgZXhpc3RzIG9uY2UsIG9wdGltaXplIGZpbmRpbmcgaXQKCQlpZiAoIHNlbGVjdG9yID09PSAiYm9keSIgJiYgIWNvbnRleHQgJiYgZG9jdW1lbnQuYm9keSApIHsKCQkJdGhpcy5jb250ZXh0ID0gZG9jdW1lbnQ7CgkJCXRoaXNbMF0gPSBkb2N1bWVudC5ib2R5OwoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7CgkJCXRoaXMubGVuZ3RoID0gMTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICkgewoJCQkvLyBBcmUgd2UgZGVhbGluZyB3aXRoIEhUTUwgc3RyaW5nIG9yIGFuIElEPwoJCQlpZiAoIHNlbGVjdG9yLmNoYXJBdCgwKSA9PT0gIjwiICYmIHNlbGVjdG9yLmNoYXJBdCggc2VsZWN0b3IubGVuZ3RoIC0gMSApID09PSAiPiIgJiYgc2VsZWN0b3IubGVuZ3RoID49IDMgKSB7CgkJCQkvLyBBc3N1bWUgdGhhdCBzdHJpbmdzIHRoYXQgc3RhcnQgYW5kIGVuZCB3aXRoIDw+IGFyZSBIVE1MIGFuZCBza2lwIHRoZSByZWdleCBjaGVjawoJCQkJbWF0Y2ggPSBbIG51bGwsIHNlbGVjdG9yLCBudWxsIF07CgoJCQl9IGVsc2UgewoJCQkJbWF0Y2ggPSBxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKTsKCQkJfQoKCQkJLy8gVmVyaWZ5IGEgbWF0Y2gsIGFuZCB0aGF0IG5vIGNvbnRleHQgd2FzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCQkJCQlkb2MgPSAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IGRvY3VtZW50ICk7CgoJCQkJCS8vIElmIGEgc2luZ2xlIHN0cmluZyBpcyBwYXNzZWQgaW4gYW5kIGl0J3MgYSBzaW5nbGUgdGFnCgkJCQkJLy8ganVzdCBkbyBhIGNyZWF0ZUVsZW1lbnQgYW5kIHNraXAgdGhlIHJlc3QKCQkJCQlyZXQgPSByc2luZ2xlVGFnLmV4ZWMoIHNlbGVjdG9yICk7CgoJCQkJCWlmICggcmV0ICkgewoJCQkJCQlpZiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KCBjb250ZXh0ICkgKSB7CgkJCQkJCQlzZWxlY3RvciA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggcmV0WzFdICkgXTsKCQkJCQkJCWpRdWVyeS5mbi5hdHRyLmNhbGwoIHNlbGVjdG9yLCBjb250ZXh0LCB0cnVlICk7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJc2VsZWN0b3IgPSBbIGRvYy5jcmVhdGVFbGVtZW50KCByZXRbMV0gKSBdOwoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIG1hdGNoWzFdIF0sIFsgZG9jIF0gKTsKCQkJCQkJc2VsZWN0b3IgPSAoIHJldC5jYWNoZWFibGUgPyBqUXVlcnkuY2xvbmUocmV0LmZyYWdtZW50KSA6IHJldC5mcmFnbWVudCApLmNoaWxkTm9kZXM7CgkJCQkJfQoKCQkJCQlyZXR1cm4galF1ZXJ5Lm1lcmdlKCB0aGlzLCBzZWxlY3RvciApOwoKCQkJCS8vIEhBTkRMRTogJCgiI2lkIikKCQkJCX0gZWxzZSB7CgkJCQkJZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtYXRjaFsyXSApOwoKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHsKCQkJCQkJCXJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7CgkJCQkJCX0KCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QKCQkJCQkJdGhpcy5sZW5ndGggPSAxOwoJCQkJCQl0aGlzWzBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290alF1ZXJ5ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoZnVuY3Rpb24pCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNlbGVjdG9yICkgKSB7CgkJCXJldHVybiByb290alF1ZXJ5LnJlYWR5KCBzZWxlY3RvciApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX0sCgoJLy8gU3RhcnQgd2l0aCBhbiBlbXB0eSBzZWxlY3RvcgoJc2VsZWN0b3I6ICIiLAoKCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCWpxdWVyeTogIjEuNy4xIiwKCgkvLyBUaGUgZGVmYXVsdCBsZW5ndGggb2YgYSBqUXVlcnkgb2JqZWN0IGlzIDAKCWxlbmd0aDogMCwKCgkvLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldAoJc2l6ZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubGVuZ3RoOwoJfSwKCgl0b0FycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2xpY2UuY2FsbCggdGhpcywgMCApOwoJfSwKCgkvLyBHZXQgdGhlIE50aCBlbGVtZW50IGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0IE9SCgkvLyBHZXQgdGhlIHdob2xlIG1hdGNoZWQgZWxlbWVudCBzZXQgYXMgYSBjbGVhbiBhcnJheQoJZ2V0OiBmdW5jdGlvbiggbnVtICkgewoJCXJldHVybiBudW0gPT0gbnVsbCA/CgoJCQkvLyBSZXR1cm4gYSAnY2xlYW4nIGFycmF5CgkJCXRoaXMudG9BcnJheSgpIDoKCgkJCS8vIFJldHVybiBqdXN0IHRoZSBvYmplY3QKCQkJKCBudW0gPCAwID8gdGhpc1sgdGhpcy5sZW5ndGggKyBudW0gXSA6IHRoaXNbIG51bSBdICk7Cgl9LAoKCS8vIFRha2UgYW4gYXJyYXkgb2YgZWxlbWVudHMgYW5kIHB1c2ggaXQgb250byB0aGUgc3RhY2sKCS8vIChyZXR1cm5pbmcgdGhlIG5ldyBtYXRjaGVkIGVsZW1lbnQgc2V0KQoJcHVzaFN0YWNrOiBmdW5jdGlvbiggZWxlbXMsIG5hbWUsIHNlbGVjdG9yICkgewoJCS8vIEJ1aWxkIGEgbmV3IGpRdWVyeSBtYXRjaGVkIGVsZW1lbnQgc2V0CgkJdmFyIHJldCA9IHRoaXMuY29uc3RydWN0b3IoKTsKCgkJaWYgKCBqUXVlcnkuaXNBcnJheSggZWxlbXMgKSApIHsKCQkJcHVzaC5hcHBseSggcmV0LCBlbGVtcyApOwoKCQl9IGVsc2UgewoJCQlqUXVlcnkubWVyZ2UoIHJldCwgZWxlbXMgKTsKCQl9CgoJCS8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpCgkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoKCQlyZXQuY29udGV4dCA9IHRoaXMuY29udGV4dDsKCgkJaWYgKCBuYW1lID09PSAiZmluZCIgKSB7CgkJCXJldC5zZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgKyAoIHRoaXMuc2VsZWN0b3IgPyAiICIgOiAiIiApICsgc2VsZWN0b3I7CgkJfSBlbHNlIGlmICggbmFtZSApIHsKCQkJcmV0LnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciArICIuIiArIG5hbWUgKyAiKCIgKyBzZWxlY3RvciArICIpIjsKCQl9CgoJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCS8vIChZb3UgY2FuIHNlZWQgdGhlIGFyZ3VtZW50cyB3aXRoIGFuIGFycmF5IG9mIGFyZ3MsIGJ1dCB0aGlzIGlzCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2ssIGFyZ3MgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjaywgYXJncyApOwoJfSwKCglyZWFkeTogZnVuY3Rpb24oIGZuICkgewoJCS8vIEF0dGFjaCB0aGUgbGlzdGVuZXJzCgkJalF1ZXJ5LmJpbmRSZWFkeSgpOwoKCQkvLyBBZGQgdGhlIGNhbGxiYWNrCgkJcmVhZHlMaXN0LmFkZCggZm4gKTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCWVxOiBmdW5jdGlvbiggaSApIHsKCQlpID0gK2k7CgkJcmV0dXJuIGkgPT09IC0xID8KCQkJdGhpcy5zbGljZSggaSApIDoKCQkJdGhpcy5zbGljZSggaSwgaSArIDEgKTsKCX0sCgoJZmlyc3Q6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVxKCAwICk7Cgl9LAoKCWxhc3Q6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVxKCAtMSApOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBzbGljZS5hcHBseSggdGhpcywgYXJndW1lbnRzICksCgkJCSJzbGljZSIsIHNsaWNlLmNhbGwoYXJndW1lbnRzKS5qb2luKCIsIikgKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCS8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgoJcHVzaDogcHVzaCwKCXNvcnQ6IFtdLnNvcnQsCglzcGxpY2U6IFtdLnNwbGljZQp9OwoKLy8gR2l2ZSB0aGUgaW5pdCBmdW5jdGlvbiB0aGUgalF1ZXJ5IHByb3RvdHlwZSBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvbgpqUXVlcnkuZm4uaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47CgpqUXVlcnkuZXh0ZW5kID0galF1ZXJ5LmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgewoJdmFyIG9wdGlvbnMsIG5hbWUsIHNyYywgY29weSwgY29weUlzQXJyYXksIGNsb25lLAoJCXRhcmdldCA9IGFyZ3VtZW50c1swXSB8fCB7fSwKCQlpID0gMSwKCQlsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLAoJCWRlZXAgPSBmYWxzZTsKCgkvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uCglpZiAoIHR5cGVvZiB0YXJnZXQgPT09ICJib29sZWFuIiApIHsKCQlkZWVwID0gdGFyZ2V0OwoJCXRhcmdldCA9IGFyZ3VtZW50c1sxXSB8fCB7fTsKCQkvLyBza2lwIHRoZSBib29sZWFuIGFuZCB0aGUgdGFyZ2V0CgkJaSA9IDI7Cgl9CgoJLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCglpZiAoIHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiICYmICFqUXVlcnkuaXNGdW5jdGlvbih0YXJnZXQpICkgewoJCXRhcmdldCA9IHt9OwoJfQoKCS8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJaWYgKCBsZW5ndGggPT09IGkgKSB7CgkJdGFyZ2V0ID0gdGhpczsKCQktLWk7Cgl9CgoJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcwoJCWlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHsKCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAoJCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJCQlzcmMgPSB0YXJnZXRbIG5hbWUgXTsKCQkJCWNvcHkgPSBvcHRpb25zWyBuYW1lIF07CgoJCQkJLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcAoJCQkJaWYgKCB0YXJnZXQgPT09IGNvcHkgKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIHBsYWluIG9iamVjdHMgb3IgYXJyYXlzCgkJCQlpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KGNvcHkpKSApICkgewoJCQkJCWlmICggY29weUlzQXJyYXkgKSB7CgkJCQkJCWNvcHlJc0FycmF5ID0gZmFsc2U7CgkJCQkJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9OwoJCQkJCX0KCgkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOwoKCQkJCS8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMKCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCXJldHVybiB0YXJnZXQ7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCW5vQ29uZmxpY3Q6IGZ1bmN0aW9uKCBkZWVwICkgewoJCWlmICggd2luZG93LiQgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LiQgPSBfJDsKCQl9CgoJCWlmICggZGVlcCAmJiB3aW5kb3cualF1ZXJ5ID09PSBqUXVlcnkgKSB7CgkJCXdpbmRvdy5qUXVlcnkgPSBfalF1ZXJ5OwoJCX0KCgkJcmV0dXJuIGpRdWVyeTsKCX0sCgoJLy8gSXMgdGhlIERPTSByZWFkeSB0byBiZSB1c2VkPyBTZXQgdG8gdHJ1ZSBvbmNlIGl0IG9jY3Vycy4KCWlzUmVhZHk6IGZhbHNlLAoKCS8vIEEgY291bnRlciB0byB0cmFjayBob3cgbWFueSBpdGVtcyB0byB3YWl0IGZvciBiZWZvcmUKCS8vIHRoZSByZWFkeSBldmVudCBmaXJlcy4gU2VlICM2NzgxCglyZWFkeVdhaXQ6IDEsCgoJLy8gSG9sZCAob3IgcmVsZWFzZSkgdGhlIHJlYWR5IGV2ZW50Cglob2xkUmVhZHk6IGZ1bmN0aW9uKCBob2xkICkgewoJCWlmICggaG9sZCApIHsKCQkJalF1ZXJ5LnJlYWR5V2FpdCsrOwoJCX0gZWxzZSB7CgkJCWpRdWVyeS5yZWFkeSggdHJ1ZSApOwoJCX0KCX0sCgoJLy8gSGFuZGxlIHdoZW4gdGhlIERPTSBpcyByZWFkeQoJcmVhZHk6IGZ1bmN0aW9uKCB3YWl0ICkgewoJCS8vIEVpdGhlciBhIHJlbGVhc2VkIGhvbGQgb3IgYW4gRE9NcmVhZHkvbG9hZCBldmVudCBhbmQgbm90IHlldCByZWFkeQoJCWlmICggKHdhaXQgPT09IHRydWUgJiYgIS0talF1ZXJ5LnJlYWR5V2FpdCkgfHwgKHdhaXQgIT09IHRydWUgJiYgIWpRdWVyeS5pc1JlYWR5KSApIHsKCQkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCQlpZiAoICFkb2N1bWVudC5ib2R5ICkgewoJCQkJcmV0dXJuIHNldFRpbWVvdXQoIGpRdWVyeS5yZWFkeSwgMSApOwoJCQl9CgoJCQkvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkKCQkJalF1ZXJ5LmlzUmVhZHkgPSB0cnVlOwoKCQkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQkJaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKCQkJcmVhZHlMaXN0LmZpcmVXaXRoKCBkb2N1bWVudCwgWyBqUXVlcnkgXSApOwoKCQkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJCWlmICggalF1ZXJ5LmZuLnRyaWdnZXIgKSB7CgkJCQlqUXVlcnkoIGRvY3VtZW50ICkudHJpZ2dlciggInJlYWR5IiApLm9mZiggInJlYWR5IiApOwoJCQl9CgkJfQoJfSwKCgliaW5kUmVhZHk6IGZ1bmN0aW9uKCkgewoJCWlmICggcmVhZHlMaXN0ICkgewoJCQlyZXR1cm47CgkJfQoKCQlyZWFkeUxpc3QgPSBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICk7CgoJCS8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZQoJCS8vIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQkvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKCQkJcmV0dXJuIHNldFRpbWVvdXQoIGpRdWVyeS5yZWFkeSwgMSApOwoJCX0KCgkJLy8gTW96aWxsYSwgT3BlcmEgYW5kIHdlYmtpdCBuaWdodGxpZXMgY3VycmVudGx5IHN1cHBvcnQgdGhpcyBldmVudAoJCWlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsKCQkJLy8gVXNlIHRoZSBoYW5keSBldmVudCBjYWxsYmFjawoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIERPTUNvbnRlbnRMb2FkZWQsIGZhbHNlICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggImxvYWQiLCBqUXVlcnkucmVhZHksIGZhbHNlICk7CgoJCS8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKCQl9IGVsc2UgaWYgKCBkb2N1bWVudC5hdHRhY2hFdmVudCApIHsKCQkJLy8gZW5zdXJlIGZpcmluZyBiZWZvcmUgb25sb2FkLAoJCQkvLyBtYXliZSBsYXRlIGJ1dCBzYWZlIGFsc28gZm9yIGlmcmFtZXMKCQkJZG9jdW1lbnQuYXR0YWNoRXZlbnQoICJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBET01Db250ZW50TG9hZGVkICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbmxvYWQiLCBqUXVlcnkucmVhZHkgKTsKCgkJCS8vIElmIElFIGFuZCBub3QgYSBmcmFtZQoJCQkvLyBjb250aW51YWxseSBjaGVjayB0byBzZWUgaWYgdGhlIGRvY3VtZW50IGlzIHJlYWR5CgkJCXZhciB0b3BsZXZlbCA9IGZhbHNlOwoKCQkJdHJ5IHsKCQkJCXRvcGxldmVsID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsOwoJCQl9IGNhdGNoKGUpIHt9CgoJCQlpZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCAmJiB0b3BsZXZlbCApIHsKCQkJCWRvU2Nyb2xsQ2hlY2soKTsKCQkJfQoJCX0KCX0sCgoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgaXNGdW5jdGlvbi4KCS8vIFNpbmNlIHZlcnNpb24gMS4zLCBET00gbWV0aG9kcyBhbmQgZnVuY3Rpb25zIGxpa2UgYWxlcnQKCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKG9iaikgPT09ICJhcnJheSI7Cgl9LAoKCS8vIEEgY3J1ZGUgd2F5IG9mIGRldGVybWluaW5nIGlmIGFuIG9iamVjdCBpcyBhIHdpbmRvdwoJaXNXaW5kb3c6IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIG9iaiAmJiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IiAmJiAic2V0SW50ZXJ2YWwiIGluIG9iajsKCX0sCgoJaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlyZXR1cm4gb2JqID09IG51bGwgPwoJCQlTdHJpbmcoIG9iaiApIDoKCQkJY2xhc3MydHlwZVsgdG9TdHJpbmcuY2FsbChvYmopIF0gfHwgIm9iamVjdCI7Cgl9LAoKCWlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7CgkJLy8gTXVzdCBiZSBhbiBPYmplY3QuCgkJLy8gQmVjYXVzZSBvZiBJRSwgd2UgYWxzbyBoYXZlIHRvIGNoZWNrIHRoZSBwcmVzZW5jZSBvZiB0aGUgY29uc3RydWN0b3IgcHJvcGVydHkuCgkJLy8gTWFrZSBzdXJlIHRoYXQgRE9NIG5vZGVzIGFuZCB3aW5kb3cgb2JqZWN0cyBkb24ndCBwYXNzIHRocm91Z2gsIGFzIHdlbGwKCQlpZiAoICFvYmogfHwgalF1ZXJ5LnR5cGUob2JqKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXRyeSB7CgkJCS8vIE5vdCBvd24gY29uc3RydWN0b3IgcHJvcGVydHkgbXVzdCBiZSBPYmplY3QKCQkJaWYgKCBvYmouY29uc3RydWN0b3IgJiYKCQkJCSFoYXNPd24uY2FsbChvYmosICJjb25zdHJ1Y3RvciIpICYmCgkJCQkhaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgImlzUHJvdG90eXBlT2YiKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBoYXNPd24uY2FsbCggb2JqLCBrZXkgKTsKCX0sCgoJaXNFbXB0eU9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQlmb3IgKCB2YXIgbmFtZSBpbiBvYmogKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9LAoKCWVycm9yOiBmdW5jdGlvbiggbXNnICkgewoJCXRocm93IG5ldyBFcnJvciggbXNnICk7Cgl9LAoKCXBhcnNlSlNPTjogZnVuY3Rpb24oIGRhdGEgKSB7CgkJaWYgKCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgfHwgIWRhdGEgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJLy8gTWFrZSBzdXJlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBpcyByZW1vdmVkIChJRSBjYW4ndCBoYW5kbGUgaXQpCgkJZGF0YSA9IGpRdWVyeS50cmltKCBkYXRhICk7CgoJCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJCWlmICggd2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UgKSB7CgkJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSApOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OCgkJLy8gTG9naWMgYm9ycm93ZWQgZnJvbSBodHRwOi8vanNvbi5vcmcvanNvbjIuanMKCQlpZiAoIHJ2YWxpZGNoYXJzLnRlc3QoIGRhdGEucmVwbGFjZSggcnZhbGlkZXNjYXBlLCAiQCIgKQoJCQkucmVwbGFjZSggcnZhbGlkdG9rZW5zLCAiXSIgKQoJCQkucmVwbGFjZSggcnZhbGlkYnJhY2VzLCAiIikpICkgewoKCQkJcmV0dXJuICggbmV3IEZ1bmN0aW9uKCAicmV0dXJuICIgKyBkYXRhICkgKSgpOwoKCQl9CgkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfSwKCgkvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCglwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCXRyeSB7CgkJCWlmICggd2luZG93LkRPTVBhcnNlciApIHsgLy8gU3RhbmRhcmQKCQkJCXRtcCA9IG5ldyBET01QYXJzZXIoKTsKCQkJCXhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEgLCAidGV4dC94bWwiICk7CgkJCX0gZWxzZSB7IC8vIElFCgkJCQl4bWwgPSBuZXcgQWN0aXZlWE9iamVjdCggIk1pY3Jvc29mdC5YTUxET00iICk7CgkJCQl4bWwuYXN5bmMgPSAiZmFsc2UiOwoJCQkJeG1sLmxvYWRYTUwoIGRhdGEgKTsKCQkJfQoJCX0gY2F0Y2goIGUgKSB7CgkJCXhtbCA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCAheG1sIHx8ICF4bWwuZG9jdW1lbnRFbGVtZW50IHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsKCQkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBYTUw6ICIgKyBkYXRhICk7CgkJfQoJCXJldHVybiB4bWw7Cgl9LAoKCW5vb3A6IGZ1bmN0aW9uKCkge30sCgoJLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHQKCS8vIFdvcmthcm91bmRzIGJhc2VkIG9uIGZpbmRpbmdzIGJ5IEppbSBEcmlzY29sbAoJLy8gaHR0cDovL3dlYmxvZ3MuamF2YS5uZXQvYmxvZy9kcmlzY29sbC9hcmNoaXZlLzIwMDkvMDkvMDgvZXZhbC1qYXZhc2NyaXB0LWdsb2JhbC1jb250ZXh0CglnbG9iYWxFdmFsOiBmdW5jdGlvbiggZGF0YSApIHsKCQlpZiAoIGRhdGEgJiYgcm5vdHdoaXRlLnRlc3QoIGRhdGEgKSApIHsKCQkJLy8gV2UgdXNlIGV4ZWNTY3JpcHQgb24gSW50ZXJuZXQgRXhwbG9yZXIKCQkJLy8gV2UgdXNlIGFuIGFub255bW91cyBmdW5jdGlvbiBzbyB0aGF0IGNvbnRleHQgaXMgd2luZG93CgkJCS8vIHJhdGhlciB0aGFuIGpRdWVyeSBpbiBGaXJlZm94CgkJCSggd2luZG93LmV4ZWNTY3JpcHQgfHwgZnVuY3Rpb24oIGRhdGEgKSB7CgkJCQl3aW5kb3dbICJldmFsIiBdLmNhbGwoIHdpbmRvdywgZGF0YSApOwoJCQl9ICkoIGRhdGEgKTsKCQl9Cgl9LAoKCS8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKCS8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MikKCWNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHsKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7Cgl9LAoKCW5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5hbWUudG9VcHBlckNhc2UoKTsKCX0sCgoJLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJZWFjaDogZnVuY3Rpb24oIG9iamVjdCwgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIG5hbWUsIGkgPSAwLAoJCQlsZW5ndGggPSBvYmplY3QubGVuZ3RoLAoJCQlpc09iaiA9IGxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGpRdWVyeS5pc0Z1bmN0aW9uKCBvYmplY3QgKTsKCgkJaWYgKCBhcmdzICkgewoJCQlpZiAoIGlzT2JqICkgewoJCQkJZm9yICggbmFtZSBpbiBvYmplY3QgKSB7CgkJCQkJaWYgKCBjYWxsYmFjay5hcHBseSggb2JqZWN0WyBuYW1lIF0sIGFyZ3MgKSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgKSB7CgkJCQkJaWYgKCBjYWxsYmFjay5hcHBseSggb2JqZWN0WyBpKysgXSwgYXJncyApID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEEgc3BlY2lhbCwgZmFzdCwgY2FzZSBmb3IgdGhlIG1vc3QgY29tbW9uIHVzZSBvZiBlYWNoCgkJfSBlbHNlIHsKCQkJaWYgKCBpc09iaiApIHsKCQkJCWZvciAoIG5hbWUgaW4gb2JqZWN0ICkgewoJCQkJCWlmICggY2FsbGJhY2suY2FsbCggb2JqZWN0WyBuYW1lIF0sIG5hbWUsIG9iamVjdFsgbmFtZSBdICkgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCA7IGkgPCBsZW5ndGg7ICkgewoJCQkJCWlmICggY2FsbGJhY2suY2FsbCggb2JqZWN0WyBpIF0sIGksIG9iamVjdFsgaSsrIF0gKSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIG9iamVjdDsKCX0sCgoJLy8gVXNlIG5hdGl2ZSBTdHJpbmcudHJpbSBmdW5jdGlvbiB3aGVyZXZlciBwb3NzaWJsZQoJdHJpbTogdHJpbSA/CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJdHJpbS5jYWxsKCB0ZXh0ICk7CgkJfSA6CgoJCS8vIE90aGVyd2lzZSB1c2Ugb3VyIG93biB0cmltbWluZyBmdW5jdGlvbmFsaXR5CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJdGV4dC50b1N0cmluZygpLnJlcGxhY2UoIHRyaW1MZWZ0LCAiIiApLnJlcGxhY2UoIHRyaW1SaWdodCwgIiIgKTsKCQl9LAoKCS8vIHJlc3VsdHMgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1ha2VBcnJheTogZnVuY3Rpb24oIGFycmF5LCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFycmF5ICE9IG51bGwgKSB7CgkJCS8vIFRoZSB3aW5kb3csIHN0cmluZ3MgKGFuZCBmdW5jdGlvbnMpIGFsc28gaGF2ZSAnbGVuZ3RoJwoJCQkvLyBUd2Vha2VkIGxvZ2ljIHNsaWdodGx5IHRvIGhhbmRsZSBCbGFja2JlcnJ5IDQuNyBSZWdFeHAgaXNzdWVzICM2OTMwCgkJCXZhciB0eXBlID0galF1ZXJ5LnR5cGUoIGFycmF5ICk7CgoJCQlpZiAoIGFycmF5Lmxlbmd0aCA9PSBudWxsIHx8IHR5cGUgPT09ICJzdHJpbmciIHx8IHR5cGUgPT09ICJmdW5jdGlvbiIgfHwgdHlwZSA9PT0gInJlZ2V4cCIgfHwgalF1ZXJ5LmlzV2luZG93KCBhcnJheSApICkgewoJCQkJcHVzaC5jYWxsKCByZXQsIGFycmF5ICk7CgkJCX0gZWxzZSB7CgkJCQlqUXVlcnkubWVyZ2UoIHJldCwgYXJyYXkgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFycmF5LCBpICkgewoJCXZhciBsZW47CgoJCWlmICggYXJyYXkgKSB7CgkJCWlmICggaW5kZXhPZiApIHsKCQkJCXJldHVybiBpbmRleE9mLmNhbGwoIGFycmF5LCBlbGVtLCBpICk7CgkJCX0KCgkJCWxlbiA9IGFycmF5Lmxlbmd0aDsKCQkJaSA9IGkgPyBpIDwgMCA/IE1hdGgubWF4KCAwLCBsZW4gKyBpICkgOiBpIDogMDsKCgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJLy8gU2tpcCBhY2Nlc3NpbmcgaW4gc3BhcnNlIGFycmF5cwoJCQkJaWYgKCBpIGluIGFycmF5ICYmIGFycmF5WyBpIF0gPT09IGVsZW0gKSB7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiAtMTsKCX0sCgoJbWVyZ2U6IGZ1bmN0aW9uKCBmaXJzdCwgc2Vjb25kICkgewoJCXZhciBpID0gZmlyc3QubGVuZ3RoLAoJCQlqID0gMDsKCgkJaWYgKCB0eXBlb2Ygc2Vjb25kLmxlbmd0aCA9PT0gIm51bWJlciIgKSB7CgkJCWZvciAoIHZhciBsID0gc2Vjb25kLmxlbmd0aDsgaiA8IGw7IGorKyApIHsKCQkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaiBdOwoJCQl9CgoJCX0gZWxzZSB7CgkJCXdoaWxlICggc2Vjb25kW2pdICE9PSB1bmRlZmluZWQgKSB7CgkJCQlmaXJzdFsgaSsrIF0gPSBzZWNvbmRbIGorKyBdOwoJCQl9CgkJfQoKCQlmaXJzdC5sZW5ndGggPSBpOwoKCQlyZXR1cm4gZmlyc3Q7Cgl9LAoKCWdyZXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGludiApIHsKCQl2YXIgcmV0ID0gW10sIHJldFZhbDsKCQlpbnYgPSAhIWludjsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIG9ubHkgc2F2aW5nIHRoZSBpdGVtcwoJCS8vIHRoYXQgcGFzcyB0aGUgdmFsaWRhdG9yIGZ1bmN0aW9uCgkJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJcmV0VmFsID0gISFjYWxsYmFjayggZWxlbXNbIGkgXSwgaSApOwoJCQlpZiAoIGludiAhPT0gcmV0VmFsICkgewoJCQkJcmV0LnB1c2goIGVsZW1zWyBpIF0gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gYXJnIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgltYXA6IGZ1bmN0aW9uKCBlbGVtcywgY2FsbGJhY2ssIGFyZyApIHsKCQl2YXIgdmFsdWUsIGtleSwgcmV0ID0gW10sCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBlbGVtcy5sZW5ndGgsCgkJCS8vIGpxdWVyeSBvYmplY3RzIGFyZSB0cmVhdGVkIGFzIGFycmF5cwoJCQlpc0FycmF5ID0gZWxlbXMgaW5zdGFuY2VvZiBqUXVlcnkgfHwgbGVuZ3RoICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGxlbmd0aCA9PT0gIm51bWJlciIgJiYgKCAoIGxlbmd0aCA+IDAgJiYgZWxlbXNbIDAgXSAmJiBlbGVtc1sgbGVuZ3RoIC0xIF0gKSB8fCBsZW5ndGggPT09IDAgfHwgalF1ZXJ5LmlzQXJyYXkoIGVsZW1zICkgKSA7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCB0cmFuc2xhdGluZyBlYWNoIG9mIHRoZSBpdGVtcyB0byB0aGVpcgoJCWlmICggaXNBcnJheSApIHsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQl2YWx1ZSA9IGNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpLCBhcmcgKTsKCgkJCQlpZiAoIHZhbHVlICE9IG51bGwgKSB7CgkJCQkJcmV0WyByZXQubGVuZ3RoIF0gPSB2YWx1ZTsKCQkJCX0KCQkJfQoKCQkvLyBHbyB0aHJvdWdoIGV2ZXJ5IGtleSBvbiB0aGUgb2JqZWN0LAoJCX0gZWxzZSB7CgkJCWZvciAoIGtleSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBrZXkgXSwga2V5LCBhcmcgKTsKCgkJCQlpZiAoIHZhbHVlICE9IG51bGwgKSB7CgkJCQkJcmV0WyByZXQubGVuZ3RoIF0gPSB2YWx1ZTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cwoJCXJldHVybiByZXQuY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7Cgl9LAoKCS8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwoJZ3VpZDogMSwKCgkvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKCS8vIGFyZ3VtZW50cy4KCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gInN0cmluZyIgKSB7CgkJCXZhciB0bXAgPSBmblsgY29udGV4dCBdOwoJCQljb250ZXh0ID0gZm47CgkJCWZuID0gdG1wOwoJCX0KCgkJLy8gUXVpY2sgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRhcmdldCBpcyBjYWxsYWJsZSwgaW4gdGhlIHNwZWMKCQkvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCgkJLy8gU2ltdWxhdGVkIGJpbmQKCQl2YXIgYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMiApLAoJCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIGZuLmFwcGx5KCBjb250ZXh0LCBhcmdzLmNvbmNhdCggc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCQl9OwoKCQkvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQKCQlwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgcHJveHkuZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCS8vIE11dGlmdW5jdGlvbmFsIG1ldGhvZCB0byBnZXQgYW5kIHNldCB2YWx1ZXMgdG8gYSBjb2xsZWN0aW9uCgkvLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb24KCWFjY2VzczogZnVuY3Rpb24oIGVsZW1zLCBrZXksIHZhbHVlLCBleGVjLCBmbiwgcGFzcyApIHsKCQl2YXIgbGVuZ3RoID0gZWxlbXMubGVuZ3RoOwoKCQkvLyBTZXR0aW5nIG1hbnkgYXR0cmlidXRlcwoJCWlmICggdHlwZW9mIGtleSA9PT0gIm9iamVjdCIgKSB7CgkJCWZvciAoIHZhciBrIGluIGtleSApIHsKCQkJCWpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBrLCBrZXlba10sIGV4ZWMsIGZuLCB2YWx1ZSApOwoJCQl9CgkJCXJldHVybiBlbGVtczsKCQl9CgoJCS8vIFNldHRpbmcgb25lIGF0dHJpYnV0ZQoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJLy8gT3B0aW9uYWxseSwgZnVuY3Rpb24gdmFsdWVzIGdldCBleGVjdXRlZCBpZiBleGVjIGlzIHRydWUKCQkJZXhlYyA9ICFwYXNzICYmIGV4ZWMgJiYgalF1ZXJ5LmlzRnVuY3Rpb24odmFsdWUpOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQlmbiggZWxlbXNbaV0sIGtleSwgZXhlYyA/IHZhbHVlLmNhbGwoIGVsZW1zW2ldLCBpLCBmbiggZWxlbXNbaV0sIGtleSApICkgOiB2YWx1ZSwgcGFzcyApOwoJCQl9CgoJCQlyZXR1cm4gZWxlbXM7CgkJfQoKCQkvLyBHZXR0aW5nIGFuIGF0dHJpYnV0ZQoJCXJldHVybiBsZW5ndGggPyBmbiggZWxlbXNbMF0sIGtleSApIDogdW5kZWZpbmVkOwoJfSwKCglub3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAoIG5ldyBEYXRlKCkgKS5nZXRUaW1lKCk7Cgl9LAoKCS8vIFVzZSBvZiBqUXVlcnkuYnJvd3NlciBpcyBmcm93bmVkIHVwb24uCgkvLyBNb3JlIGRldGFpbHM6IGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vVXRpbGl0aWVzL2pRdWVyeS5icm93c2VyCgl1YU1hdGNoOiBmdW5jdGlvbiggdWEgKSB7CgkJdWEgPSB1YS50b0xvd2VyQ2FzZSgpOwoKCQl2YXIgbWF0Y2ggPSByd2Via2l0LmV4ZWMoIHVhICkgfHwKCQkJcm9wZXJhLmV4ZWMoIHVhICkgfHwKCQkJcm1zaWUuZXhlYyggdWEgKSB8fAoJCQl1YS5pbmRleE9mKCJjb21wYXRpYmxlIikgPCAwICYmIHJtb3ppbGxhLmV4ZWMoIHVhICkgfHwKCQkJW107CgoJCXJldHVybiB7IGJyb3dzZXI6IG1hdGNoWzFdIHx8ICIiLCB2ZXJzaW9uOiBtYXRjaFsyXSB8fCAiMCIgfTsKCX0sCgoJc3ViOiBmdW5jdGlvbigpIHsKCQlmdW5jdGlvbiBqUXVlcnlTdWIoIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCQlyZXR1cm4gbmV3IGpRdWVyeVN1Yi5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCApOwoJCX0KCQlqUXVlcnkuZXh0ZW5kKCB0cnVlLCBqUXVlcnlTdWIsIHRoaXMgKTsKCQlqUXVlcnlTdWIuc3VwZXJjbGFzcyA9IHRoaXM7CgkJalF1ZXJ5U3ViLmZuID0galF1ZXJ5U3ViLnByb3RvdHlwZSA9IHRoaXMoKTsKCQlqUXVlcnlTdWIuZm4uY29uc3RydWN0b3IgPSBqUXVlcnlTdWI7CgkJalF1ZXJ5U3ViLnN1YiA9IHRoaXMuc3ViOwoJCWpRdWVyeVN1Yi5mbi5pbml0ID0gZnVuY3Rpb24gaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKSB7CgkJCWlmICggY29udGV4dCAmJiBjb250ZXh0IGluc3RhbmNlb2YgalF1ZXJ5ICYmICEoY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeVN1YikgKSB7CgkJCQljb250ZXh0ID0galF1ZXJ5U3ViKCBjb250ZXh0ICk7CgkJCX0KCgkJCXJldHVybiBqUXVlcnkuZm4uaW5pdC5jYWxsKCB0aGlzLCBzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeVN1YiApOwoJCX07CgkJalF1ZXJ5U3ViLmZuLmluaXQucHJvdG90eXBlID0galF1ZXJ5U3ViLmZuOwoJCXZhciByb290alF1ZXJ5U3ViID0galF1ZXJ5U3ViKGRvY3VtZW50KTsKCQlyZXR1cm4galF1ZXJ5U3ViOwoJfSwKCglicm93c2VyOiB7fQp9KTsKCi8vIFBvcHVsYXRlIHRoZSBjbGFzczJ0eXBlIG1hcApqUXVlcnkuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oaSwgbmFtZSkgewoJY2xhc3MydHlwZVsgIltvYmplY3QgIiArIG5hbWUgKyAiXSIgXSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKfSk7Cgpicm93c2VyTWF0Y2ggPSBqUXVlcnkudWFNYXRjaCggdXNlckFnZW50ICk7CmlmICggYnJvd3Nlck1hdGNoLmJyb3dzZXIgKSB7CglqUXVlcnkuYnJvd3NlclsgYnJvd3Nlck1hdGNoLmJyb3dzZXIgXSA9IHRydWU7CglqUXVlcnkuYnJvd3Nlci52ZXJzaW9uID0gYnJvd3Nlck1hdGNoLnZlcnNpb247Cn0KCi8vIERlcHJlY2F0ZWQsIHVzZSBqUXVlcnkuYnJvd3Nlci53ZWJraXQgaW5zdGVhZAppZiAoIGpRdWVyeS5icm93c2VyLndlYmtpdCApIHsKCWpRdWVyeS5icm93c2VyLnNhZmFyaSA9IHRydWU7Cn0KCi8vIElFIGRvZXNuJ3QgbWF0Y2ggbm9uLWJyZWFraW5nIHNwYWNlcyB3aXRoIFxzCmlmICggcm5vdHdoaXRlLnRlc3QoICJceEEwIiApICkgewoJdHJpbUxlZnQgPSAvXltcc1x4QTBdKy87Cgl0cmltUmlnaHQgPSAvW1xzXHhBMF0rJC87Cn0KCi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZQpyb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKCi8vIENsZWFudXAgZnVuY3Rpb25zIGZvciB0aGUgZG9jdW1lbnQgcmVhZHkgbWV0aG9kCmlmICggZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciApIHsKCURPTUNvbnRlbnRMb2FkZWQgPSBmdW5jdGlvbigpIHsKCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIERPTUNvbnRlbnRMb2FkZWQsIGZhbHNlICk7CgkJalF1ZXJ5LnJlYWR5KCk7Cgl9OwoKfSBlbHNlIGlmICggZG9jdW1lbnQuYXR0YWNoRXZlbnQgKSB7CglET01Db250ZW50TG9hZGVkID0gZnVuY3Rpb24oKSB7CgkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCWlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiApIHsKCQkJZG9jdW1lbnQuZGV0YWNoRXZlbnQoICJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBET01Db250ZW50TG9hZGVkICk7CgkJCWpRdWVyeS5yZWFkeSgpOwoJCX0KCX07Cn0KCi8vIFRoZSBET00gcmVhZHkgY2hlY2sgZm9yIEludGVybmV0IEV4cGxvcmVyCmZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CglpZiAoIGpRdWVyeS5pc1JlYWR5ICkgewoJCXJldHVybjsKCX0KCgl0cnkgewoJCS8vIElmIElFIGlzIHVzZWQsIHVzZSB0aGUgdHJpY2sgYnkgRGllZ28gUGVyaW5pCgkJLy8gaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC8KCQlkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoImxlZnQiKTsKCX0gY2F0Y2goZSkgewoJCXNldFRpbWVvdXQoIGRvU2Nyb2xsQ2hlY2ssIDEgKTsKCQlyZXR1cm47Cgl9CgoJLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zCglqUXVlcnkucmVhZHkoKTsKfQoKcmV0dXJuIGpRdWVyeTsKCn0pKCk7CgoKLy8gU3RyaW5nIHRvIE9iamVjdCBmbGFncyBmb3JtYXQgY2FjaGUKdmFyIGZsYWdzQ2FjaGUgPSB7fTsKCi8vIENvbnZlcnQgU3RyaW5nLWZvcm1hdHRlZCBmbGFncyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlRmxhZ3MoIGZsYWdzICkgewoJdmFyIG9iamVjdCA9IGZsYWdzQ2FjaGVbIGZsYWdzIF0gPSB7fSwKCQlpLCBsZW5ndGg7CglmbGFncyA9IGZsYWdzLnNwbGl0KCAvXHMrLyApOwoJZm9yICggaSA9IDAsIGxlbmd0aCA9IGZsYWdzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCW9iamVjdFsgZmxhZ3NbaV0gXSA9IHRydWU7Cgl9CglyZXR1cm4gb2JqZWN0Owp9CgovKgogKiBDcmVhdGUgYSBjYWxsYmFjayBsaXN0IHVzaW5nIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKICoKICoJZmxhZ3M6CWFuIG9wdGlvbmFsIGxpc3Qgb2Ygc3BhY2Utc2VwYXJhdGVkIGZsYWdzIHRoYXQgd2lsbCBjaGFuZ2UgaG93CiAqCQkJdGhlIGNhbGxiYWNrIGxpc3QgYmVoYXZlcwogKgogKiBCeSBkZWZhdWx0IGEgY2FsbGJhY2sgbGlzdCB3aWxsIGFjdCBsaWtlIGFuIGV2ZW50IGNhbGxiYWNrIGxpc3QgYW5kIGNhbiBiZQogKiAiZmlyZWQiIG11bHRpcGxlIHRpbWVzLgogKgogKiBQb3NzaWJsZSBmbGFnczoKICoKICoJb25jZToJCQl3aWxsIGVuc3VyZSB0aGUgY2FsbGJhY2sgbGlzdCBjYW4gb25seSBiZSBmaXJlZCBvbmNlIChsaWtlIGEgRGVmZXJyZWQpCiAqCiAqCW1lbW9yeToJCQl3aWxsIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdmFsdWVzIGFuZCB3aWxsIGNhbGwgYW55IGNhbGxiYWNrIGFkZGVkCiAqCQkJCQlhZnRlciB0aGUgbGlzdCBoYXMgYmVlbiBmaXJlZCByaWdodCBhd2F5IHdpdGggdGhlIGxhdGVzdCAibWVtb3JpemVkIgogKgkJCQkJdmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpCiAqCiAqCXVuaXF1ZToJCQl3aWxsIGVuc3VyZSBhIGNhbGxiYWNrIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2UgKG5vIGR1cGxpY2F0ZSBpbiB0aGUgbGlzdCkKICoKICoJc3RvcE9uRmFsc2U6CWludGVycnVwdCBjYWxsaW5ncyB3aGVuIGEgY2FsbGJhY2sgcmV0dXJucyBmYWxzZQogKgogKi8KalF1ZXJ5LkNhbGxiYWNrcyA9IGZ1bmN0aW9uKCBmbGFncyApIHsKCgkvLyBDb252ZXJ0IGZsYWdzIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkCgkvLyAod2UgY2hlY2sgaW4gY2FjaGUgZmlyc3QpCglmbGFncyA9IGZsYWdzID8gKCBmbGFnc0NhY2hlWyBmbGFncyBdIHx8IGNyZWF0ZUZsYWdzKCBmbGFncyApICkgOiB7fTsKCgl2YXIgLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3QKCQlsaXN0ID0gW10sCgkJLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0cwoJCXN0YWNrID0gW10sCgkJLy8gTGFzdCBmaXJlIHZhbHVlIChmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzKQoJCW1lbW9yeSwKCQkvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nCgkJZmlyaW5nLAoJCS8vIEZpcnN0IGNhbGxiYWNrIHRvIGZpcmUgKHVzZWQgaW50ZXJuYWxseSBieSBhZGQgYW5kIGZpcmVXaXRoKQoJCWZpcmluZ1N0YXJ0LAoJCS8vIEVuZCBvZiB0aGUgbG9vcCB3aGVuIGZpcmluZwoJCWZpcmluZ0xlbmd0aCwKCQkvLyBJbmRleCBvZiBjdXJyZW50bHkgZmlyaW5nIGNhbGxiYWNrIChtb2RpZmllZCBieSByZW1vdmUgaWYgbmVlZGVkKQoJCWZpcmluZ0luZGV4LAoJCS8vIEFkZCBvbmUgb3Igc2V2ZXJhbCBjYWxsYmFja3MgdG8gdGhlIGxpc3QKCQlhZGQgPSBmdW5jdGlvbiggYXJncyApIHsKCQkJdmFyIGksCgkJCQlsZW5ndGgsCgkJCQllbGVtLAoJCQkJdHlwZSwKCQkJCWFjdHVhbDsKCQkJZm9yICggaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQllbGVtID0gYXJnc1sgaSBdOwoJCQkJdHlwZSA9IGpRdWVyeS50eXBlKCBlbGVtICk7CgkJCQlpZiAoIHR5cGUgPT09ICJhcnJheSIgKSB7CgkJCQkJLy8gSW5zcGVjdCByZWN1cnNpdmVseQoJCQkJCWFkZCggZWxlbSApOwoJCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCQkvLyBBZGQgaWYgbm90IGluIHVuaXF1ZSBtb2RlIGFuZCBjYWxsYmFjayBpcyBub3QgaW4KCQkJCQlpZiAoICFmbGFncy51bmlxdWUgfHwgIXNlbGYuaGFzKCBlbGVtICkgKSB7CgkJCQkJCWxpc3QucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgkJLy8gRmlyZSBjYWxsYmFja3MKCQlmaXJlID0gZnVuY3Rpb24oIGNvbnRleHQsIGFyZ3MgKSB7CgkJCWFyZ3MgPSBhcmdzIHx8IFtdOwoJCQltZW1vcnkgPSAhZmxhZ3MubWVtb3J5IHx8IFsgY29udGV4dCwgYXJncyBdOwoJCQlmaXJpbmcgPSB0cnVlOwoJCQlmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7CgkJCWZpcmluZ1N0YXJ0ID0gMDsKCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCWZvciAoIDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKyApIHsKCQkJCWlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggY29udGV4dCwgYXJncyApID09PSBmYWxzZSAmJiBmbGFncy5zdG9wT25GYWxzZSApIHsKCQkJCQltZW1vcnkgPSB0cnVlOyAvLyBNYXJrIGFzIGhhbHRlZAoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWZpcmluZyA9IGZhbHNlOwoJCQlpZiAoIGxpc3QgKSB7CgkJCQlpZiAoICFmbGFncy5vbmNlICkgewoJCQkJCWlmICggc3RhY2sgJiYgc3RhY2subGVuZ3RoICkgewoJCQkJCQltZW1vcnkgPSBzdGFjay5zaGlmdCgpOwoJCQkJCQlzZWxmLmZpcmVXaXRoKCBtZW1vcnlbIDAgXSwgbWVtb3J5WyAxIF0gKTsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgPT09IHRydWUgKSB7CgkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQl9IGVsc2UgewoJCQkJCWxpc3QgPSBbXTsKCQkJCX0KCQkJfQoJCX0sCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoJCQkvLyBBZGQgYSBjYWxsYmFjayBvciBhIGNvbGxlY3Rpb24gb2YgY2FsbGJhY2tzIHRvIHRoZSBsaXN0CgkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJdmFyIGxlbmd0aCA9IGxpc3QubGVuZ3RoOwoJCQkJCWFkZCggYXJndW1lbnRzICk7CgkJCQkJLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGUKCQkJCQkvLyBjdXJyZW50IGZpcmluZyBiYXRjaD8KCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbgoJCQkJCS8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXksIHVubGVzcyBwcmV2aW91cwoJCQkJCS8vIGZpcmluZyB3YXMgaGFsdGVkIChzdG9wT25GYWxzZSkKCQkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgJiYgbWVtb3J5ICE9PSB0cnVlICkgewoJCQkJCQlmaXJpbmdTdGFydCA9IGxlbmd0aDsKCQkJCQkJZmlyZSggbWVtb3J5WyAwIF0sIG1lbW9yeVsgMSBdICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIFJlbW92ZSBhIGNhbGxiYWNrIGZyb20gdGhlIGxpc3QKCQkJcmVtb3ZlOiBmdW5jdGlvbigpIHsKCQkJCWlmICggbGlzdCApIHsKCQkJCQl2YXIgYXJncyA9IGFyZ3VtZW50cywKCQkJCQkJYXJnSW5kZXggPSAwLAoJCQkJCQlhcmdMZW5ndGggPSBhcmdzLmxlbmd0aDsKCQkJCQlmb3IgKCA7IGFyZ0luZGV4IDwgYXJnTGVuZ3RoIDsgYXJnSW5kZXgrKyApIHsKCQkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKyApIHsKCQkJCQkJCWlmICggYXJnc1sgYXJnSW5kZXggXSA9PT0gbGlzdFsgaSBdICkgewoJCQkJCQkJCS8vIEhhbmRsZSBmaXJpbmdJbmRleCBhbmQgZmlyaW5nTGVuZ3RoCgkJCQkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCQkJCWlmICggaSA8PSBmaXJpbmdMZW5ndGggKSB7CgkJCQkJCQkJCQlmaXJpbmdMZW5ndGgtLTsKCQkJCQkJCQkJCWlmICggaSA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCQkJCQlmaXJpbmdJbmRleC0tOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJlbW92ZSB0aGUgZWxlbWVudAoJCQkJCQkJCWxpc3Quc3BsaWNlKCBpLS0sIDEgKTsKCQkJCQkJCQkvLyBJZiB3ZSBoYXZlIHNvbWUgdW5pY2l0eSBwcm9wZXJ0eSB0aGVuCgkJCQkJCQkJLy8gd2Ugb25seSBuZWVkIHRvIGRvIHRoaXMgb25jZQoJCQkJCQkJCWlmICggZmxhZ3MudW5pcXVlICkgewoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gQ29udHJvbCBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0CgkJCWhhczogZnVuY3Rpb24oIGZuICkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCXZhciBpID0gMCwKCQkJCQkJbGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJCWlmICggZm4gPT09IGxpc3RbIGkgXSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9LAoJCQkvLyBSZW1vdmUgYWxsIGNhbGxiYWNrcyBmcm9tIHRoZSBsaXN0CgkJCWVtcHR5OiBmdW5jdGlvbigpIHsKCQkJCWxpc3QgPSBbXTsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBIYXZlIHRoZSBsaXN0IGRvIG5vdGhpbmcgYW55bW9yZQoJCQlkaXNhYmxlOiBmdW5jdGlvbigpIHsKCQkJCWxpc3QgPSBzdGFjayA9IG1lbW9yeSA9IHVuZGVmaW5lZDsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBJcyBpdCBkaXNhYmxlZD8KCQkJZGlzYWJsZWQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICFsaXN0OwoJCQl9LAoJCQkvLyBMb2NrIHRoZSBsaXN0IGluIGl0cyBjdXJyZW50IHN0YXRlCgkJCWxvY2s6IGZ1bmN0aW9uKCkgewoJCQkJc3RhY2sgPSB1bmRlZmluZWQ7CgkJCQlpZiAoICFtZW1vcnkgfHwgbWVtb3J5ID09PSB0cnVlICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJaWYgKCBzdGFjayApIHsKCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJaWYgKCAhZmxhZ3Mub25jZSApIHsKCQkJCQkJCXN0YWNrLnB1c2goIFsgY29udGV4dCwgYXJncyBdICk7CgkJCQkJCX0KCQkJCQl9IGVsc2UgaWYgKCAhKCBmbGFncy5vbmNlICYmIG1lbW9yeSApICkgewoJCQkJCQlmaXJlKCBjb250ZXh0LCBhcmdzICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCWZpcmU6IGZ1bmN0aW9uKCkgewoJCQkJc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIW1lbW9yeTsKCQkJfQoJCX07CgoJcmV0dXJuIHNlbGY7Cn07CgoKCgp2YXIgLy8gU3RhdGljIHJlZmVyZW5jZSB0byBzbGljZQoJc2xpY2VEZWZlcnJlZCA9IFtdLnNsaWNlOwoKalF1ZXJ5LmV4dGVuZCh7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciBkb25lTGlzdCA9IGpRdWVyeS5DYWxsYmFja3MoICJvbmNlIG1lbW9yeSIgKSwKCQkJZmFpbExpc3QgPSBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksCgkJCXByb2dyZXNzTGlzdCA9IGpRdWVyeS5DYWxsYmFja3MoICJtZW1vcnkiICksCgkJCXN0YXRlID0gInBlbmRpbmciLAoJCQlsaXN0cyA9IHsKCQkJCXJlc29sdmU6IGRvbmVMaXN0LAoJCQkJcmVqZWN0OiBmYWlsTGlzdCwKCQkJCW5vdGlmeTogcHJvZ3Jlc3NMaXN0CgkJCX0sCgkJCXByb21pc2UgPSB7CgkJCQlkb25lOiBkb25lTGlzdC5hZGQsCgkJCQlmYWlsOiBmYWlsTGlzdC5hZGQsCgkJCQlwcm9ncmVzczogcHJvZ3Jlc3NMaXN0LmFkZCwKCgkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJfSwKCgkJCQkvLyBEZXByZWNhdGVkCgkJCQlpc1Jlc29sdmVkOiBkb25lTGlzdC5maXJlZCwKCQkJCWlzUmVqZWN0ZWQ6IGZhaWxMaXN0LmZpcmVkLAoKCQkJCXRoZW46IGZ1bmN0aW9uKCBkb25lQ2FsbGJhY2tzLCBmYWlsQ2FsbGJhY2tzLCBwcm9ncmVzc0NhbGxiYWNrcyApIHsKCQkJCQlkZWZlcnJlZC5kb25lKCBkb25lQ2FsbGJhY2tzICkuZmFpbCggZmFpbENhbGxiYWNrcyApLnByb2dyZXNzKCBwcm9ncmVzc0NhbGxiYWNrcyApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCQkJCWFsd2F5czogZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQuZG9uZS5hcHBseSggZGVmZXJyZWQsIGFyZ3VtZW50cyApLmZhaWwuYXBwbHkoIGRlZmVycmVkLCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgkJCQlwaXBlOiBmdW5jdGlvbiggZm5Eb25lLCBmbkZhaWwsIGZuUHJvZ3Jlc3MgKSB7CgkJCQkJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCB7CgkJCQkJCQlkb25lOiBbIGZuRG9uZSwgInJlc29sdmUiIF0sCgkJCQkJCQlmYWlsOiBbIGZuRmFpbCwgInJlamVjdCIgXSwKCQkJCQkJCXByb2dyZXNzOiBbIGZuUHJvZ3Jlc3MsICJub3RpZnkiIF0KCQkJCQkJfSwgZnVuY3Rpb24oIGhhbmRsZXIsIGRhdGEgKSB7CgkJCQkJCQl2YXIgZm4gPSBkYXRhWyAwIF0sCgkJCQkJCQkJYWN0aW9uID0gZGF0YVsgMSBdLAoJCQkJCQkJCXJldHVybmVkOwoJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZm4gKSApIHsKCQkJCQkJCQlkZWZlcnJlZFsgaGFuZGxlciBdKGZ1bmN0aW9uKCkgewoJCQkJCQkJCQlyZXR1cm5lZCA9IGZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCQkJCQkJaWYgKCByZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmV0dXJuZWQucHJvbWlzZSApICkgewoJCQkJCQkJCQkJcmV0dXJuZWQucHJvbWlzZSgpLnRoZW4oIG5ld0RlZmVyLnJlc29sdmUsIG5ld0RlZmVyLnJlamVjdCwgbmV3RGVmZXIubm90aWZ5ICk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQluZXdEZWZlclsgYWN0aW9uICsgIldpdGgiIF0oIHRoaXMgPT09IGRlZmVycmVkID8gbmV3RGVmZXIgOiB0aGlzLCBbIHJldHVybmVkIF0gKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0pOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlkZWZlcnJlZFsgaGFuZGxlciBdKCBuZXdEZWZlclsgYWN0aW9uIF0gKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJaWYgKCBvYmogPT0gbnVsbCApIHsKCQkJCQkJb2JqID0gcHJvbWlzZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlmb3IgKCB2YXIga2V5IGluIHByb21pc2UgKSB7CgkJCQkJCQlvYmpbIGtleSBdID0gcHJvbWlzZVsga2V5IF07CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIG9iajsKCQkJCX0KCQkJfSwKCQkJZGVmZXJyZWQgPSBwcm9taXNlLnByb21pc2Uoe30pLAoJCQlrZXk7CgoJCWZvciAoIGtleSBpbiBsaXN0cyApIHsKCQkJZGVmZXJyZWRbIGtleSBdID0gbGlzdHNbIGtleSBdLmZpcmU7CgkJCWRlZmVycmVkWyBrZXkgKyAiV2l0aCIgXSA9IGxpc3RzWyBrZXkgXS5maXJlV2l0aDsKCQl9CgoJCS8vIEhhbmRsZSBzdGF0ZQoJCWRlZmVycmVkLmRvbmUoIGZ1bmN0aW9uKCkgewoJCQlzdGF0ZSA9ICJyZXNvbHZlZCI7CgkJfSwgZmFpbExpc3QuZGlzYWJsZSwgcHJvZ3Jlc3NMaXN0LmxvY2sgKS5mYWlsKCBmdW5jdGlvbigpIHsKCQkJc3RhdGUgPSAicmVqZWN0ZWQiOwoJCX0sIGRvbmVMaXN0LmRpc2FibGUsIHByb2dyZXNzTGlzdC5sb2NrICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIGZpcnN0UGFyYW0gKSB7CgkJdmFyIGFyZ3MgPSBzbGljZURlZmVycmVkLmNhbGwoIGFyZ3VtZW50cywgMCApLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gYXJncy5sZW5ndGgsCgkJCXBWYWx1ZXMgPSBuZXcgQXJyYXkoIGxlbmd0aCApLAoJCQljb3VudCA9IGxlbmd0aCwKCQkJcENvdW50ID0gbGVuZ3RoLAoJCQlkZWZlcnJlZCA9IGxlbmd0aCA8PSAxICYmIGZpcnN0UGFyYW0gJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIGZpcnN0UGFyYW0ucHJvbWlzZSApID8KCQkJCWZpcnN0UGFyYW0gOgoJCQkJalF1ZXJ5LkRlZmVycmVkKCksCgkJCXByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlKCk7CgkJZnVuY3Rpb24gcmVzb2x2ZUZ1bmMoIGkgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCQlhcmdzWyBpIF0gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IHNsaWNlRGVmZXJyZWQuY2FsbCggYXJndW1lbnRzLCAwICkgOiB2YWx1ZTsKCQkJCWlmICggISggLS1jb3VudCApICkgewoJCQkJCWRlZmVycmVkLnJlc29sdmVXaXRoKCBkZWZlcnJlZCwgYXJncyApOwoJCQkJfQoJCQl9OwoJCX0KCQlmdW5jdGlvbiBwcm9ncmVzc0Z1bmMoIGkgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCQlwVmFsdWVzWyBpIF0gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IHNsaWNlRGVmZXJyZWQuY2FsbCggYXJndW1lbnRzLCAwICkgOiB2YWx1ZTsKCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIHByb21pc2UsIHBWYWx1ZXMgKTsKCQkJfTsKCQl9CgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggYXJnc1sgaSBdICYmIGFyZ3NbIGkgXS5wcm9taXNlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBhcmdzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCWFyZ3NbIGkgXS5wcm9taXNlKCkudGhlbiggcmVzb2x2ZUZ1bmMoaSksIGRlZmVycmVkLnJlamVjdCwgcHJvZ3Jlc3NGdW5jKGkpICk7CgkJCQl9IGVsc2UgewoJCQkJCS0tY291bnQ7CgkJCQl9CgkJCX0KCQkJaWYgKCAhY291bnQgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZGVmZXJyZWQsIGFyZ3MgKTsKCQkJfQoJCX0gZWxzZSBpZiAoIGRlZmVycmVkICE9PSBmaXJzdFBhcmFtICkgewoJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZGVmZXJyZWQsIGxlbmd0aCA/IFsgZmlyc3RQYXJhbSBdIDogW10gKTsKCQl9CgkJcmV0dXJuIHByb21pc2U7Cgl9Cn0pOwoKCgoKalF1ZXJ5LnN1cHBvcnQgPSAoZnVuY3Rpb24oKSB7CgoJdmFyIHN1cHBvcnQsCgkJYWxsLAoJCWEsCgkJc2VsZWN0LAoJCW9wdCwKCQlpbnB1dCwKCQltYXJnaW5EaXYsCgkJZnJhZ21lbnQsCgkJdGRzLAoJCWV2ZW50cywKCQlldmVudE5hbWUsCgkJaSwKCQlpc1N1cHBvcnRlZCwKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCWRvY3VtZW50RWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkvLyBQcmVsaW1pbmFyeSB0ZXN0cwoJZGl2LnNldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIiwgInQiKTsKCWRpdi5pbm5lckhUTUwgPSAiICAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJyBzdHlsZT0ndG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iOwoKCWFsbCA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggIioiICk7CglhID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAiYSIgKVsgMCBdOwoKCS8vIENhbid0IGdldCBiYXNpYyB0ZXN0IHN1cHBvcnQKCWlmICggIWFsbCB8fCAhYWxsLmxlbmd0aCB8fCAhYSApIHsKCQlyZXR1cm4ge307Cgl9CgoJLy8gRmlyc3QgYmF0Y2ggb2Ygc3VwcG9ydHMgdGVzdHMKCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJzZWxlY3QiICk7CglvcHQgPSBzZWxlY3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpICk7CglpbnB1dCA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSggImlucHV0IiApWyAwIF07CgoJc3VwcG9ydCA9IHsKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJbGVhZGluZ1doaXRlc3BhY2U6ICggZGl2LmZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDMgKSwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGJvZHkgZWxlbWVudHMgYXJlbid0IGF1dG9tYXRpY2FsbHkgaW5zZXJ0ZWQKCQkvLyBJRSB3aWxsIGluc2VydCB0aGVtIGludG8gZW1wdHkgdGFibGVzCgkJdGJvZHk6ICFkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IikubGVuZ3RoLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCBsaW5rIGVsZW1lbnRzIGdldCBzZXJpYWxpemVkIGNvcnJlY3RseSBieSBpbm5lckhUTUwKCQkvLyBUaGlzIHJlcXVpcmVzIGEgd3JhcHBlciBlbGVtZW50IGluIElFCgkJaHRtbFNlcmlhbGl6ZTogISFkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpbmsiKS5sZW5ndGgsCgoJCS8vIEdldCB0aGUgc3R5bGUgaW5mb3JtYXRpb24gZnJvbSBnZXRBdHRyaWJ1dGUKCQkvLyAoSUUgdXNlcyAuY3NzVGV4dCBpbnN0ZWFkKQoJCXN0eWxlOiAvdG9wLy50ZXN0KCBhLmdldEF0dHJpYnV0ZSgic3R5bGUiKSApLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCBVUkxzIGFyZW4ndCBtYW5pcHVsYXRlZAoJCS8vIChJRSBub3JtYWxpemVzIGl0IGJ5IGRlZmF1bHQpCgkJaHJlZk5vcm1hbGl6ZWQ6ICggYS5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIi9hIiApLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCBlbGVtZW50IG9wYWNpdHkgZXhpc3RzCgkJLy8gKElFIHVzZXMgZmlsdGVyIGluc3RlYWQpCgkJLy8gVXNlIGEgcmVnZXggdG8gd29yayBhcm91bmQgYSBXZWJLaXQgaXNzdWUuIFNlZSAjNTE0NQoJCW9wYWNpdHk6IC9eMC41NS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksCgoJCS8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2UKCQkvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCgkJY3NzRmxvYXQ6ICEhYS5zdHlsZS5jc3NGbG9hdCwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgaWYgbm8gdmFsdWUgaXMgc3BlY2lmaWVkIGZvciBhIGNoZWNrYm94CgkJLy8gdGhhdCBpdCBkZWZhdWx0cyB0byAib24iLgoJCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gIiIgaW5zdGVhZCkKCQljaGVja09uOiAoIGlucHV0LnZhbHVlID09PSAib24iICksCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IGEgc2VsZWN0ZWQtYnktZGVmYXVsdCBvcHRpb24gaGFzIGEgd29ya2luZyBzZWxlY3RlZCBwcm9wZXJ0eS4KCQkvLyAoV2ViS2l0IGRlZmF1bHRzIHRvIGZhbHNlIGluc3RlYWQgb2YgdHJ1ZSwgSUUgdG9vLCBpZiBpdCdzIGluIGFuIG9wdGdyb3VwKQoJCW9wdFNlbGVjdGVkOiBvcHQuc2VsZWN0ZWQsCgoJCS8vIFRlc3Qgc2V0QXR0cmlidXRlIG9uIGNhbWVsQ2FzZSBjbGFzcy4gSWYgaXQgd29ya3MsIHdlIG5lZWQgYXR0ckZpeGVzIHdoZW4gZG9pbmcgZ2V0L3NldEF0dHJpYnV0ZSAoaWU2LzcpCgkJZ2V0U2V0QXR0cmlidXRlOiBkaXYuY2xhc3NOYW1lICE9PSAidCIsCgoJCS8vIFRlc3RzIGZvciBlbmN0eXBlIHN1cHBvcnQgb24gYSBmb3JtKCM2NzQzKQoJCWVuY3R5cGU6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsCgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCWh0bWw1Q2xvbmU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iLAoKCQkvLyBXaWxsIGJlIGRlZmluZWQgbGF0ZXIKCQlzdWJtaXRCdWJibGVzOiB0cnVlLAoJCWNoYW5nZUJ1YmJsZXM6IHRydWUsCgkJZm9jdXNpbkJ1YmJsZXM6IGZhbHNlLAoJCWRlbGV0ZUV4cGFuZG86IHRydWUsCgkJbm9DbG9uZUV2ZW50OiB0cnVlLAoJCWlubGluZUJsb2NrTmVlZHNMYXlvdXQ6IGZhbHNlLAoJCXNocmlua1dyYXBCbG9ja3M6IGZhbHNlLAoJCXJlbGlhYmxlTWFyZ2luUmlnaHQ6IHRydWUKCX07CgoJLy8gTWFrZSBzdXJlIGNoZWNrZWQgc3RhdHVzIGlzIHByb3Blcmx5IGNsb25lZAoJaW5wdXQuY2hlY2tlZCA9IHRydWU7CglzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkID0gaW5wdXQuY2xvbmVOb2RlKCB0cnVlICkuY2hlY2tlZDsKCgkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgb3B0aW9ucyBpbnNpZGUgZGlzYWJsZWQgc2VsZWN0cyBhcmVuJ3QgbWFya2VkIGFzIGRpc2FibGVkCgkvLyAoV2ViS2l0IG1hcmtzIHRoZW0gYXMgZGlzYWJsZWQpCglzZWxlY3QuZGlzYWJsZWQgPSB0cnVlOwoJc3VwcG9ydC5vcHREaXNhYmxlZCA9ICFvcHQuZGlzYWJsZWQ7CgoJLy8gVGVzdCB0byBzZWUgaWYgaXQncyBwb3NzaWJsZSB0byBkZWxldGUgYW4gZXhwYW5kbyBmcm9tIGFuIGVsZW1lbnQKCS8vIEZhaWxzIGluIEludGVybmV0IEV4cGxvcmVyCgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2goIGUgKSB7CgkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7Cgl9CgoJaWYgKCAhZGl2LmFkZEV2ZW50TGlzdGVuZXIgJiYgZGl2LmF0dGFjaEV2ZW50ICYmIGRpdi5maXJlRXZlbnQgKSB7CgkJZGl2LmF0dGFjaEV2ZW50KCAib25jbGljayIsIGZ1bmN0aW9uKCkgewoJCQkvLyBDbG9uaW5nIGEgbm9kZSBzaG91bGRuJ3QgY29weSBvdmVyIGFueQoJCQkvLyBib3VuZCBldmVudCBoYW5kbGVycyAoSUUgZG9lcyB0aGlzKQoJCQlzdXBwb3J0Lm5vQ2xvbmVFdmVudCA9IGZhbHNlOwoJCX0pOwoJCWRpdi5jbG9uZU5vZGUoIHRydWUgKS5maXJlRXZlbnQoICJvbmNsaWNrIiApOwoJfQoKCS8vIENoZWNrIGlmIGEgcmFkaW8gbWFpbnRhaW5zIGl0cyB2YWx1ZQoJLy8gYWZ0ZXIgYmVpbmcgYXBwZW5kZWQgdG8gdGhlIERPTQoJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQudmFsdWUgPSAidCI7CglpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAicmFkaW8iKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CgoJaW5wdXQuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgImNoZWNrZWQiKTsKCWRpdi5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCWZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoJZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRpdi5sYXN0Q2hpbGQgKTsKCgkvLyBXZWJLaXQgZG9lc24ndCBjbG9uZSBjaGVja2VkIHN0YXRlIGNvcnJlY3RseSBpbiBmcmFnbWVudHMKCXN1cHBvcnQuY2hlY2tDbG9uZSA9IGZyYWdtZW50LmNsb25lTm9kZSggdHJ1ZSApLmNsb25lTm9kZSggdHJ1ZSApLmxhc3RDaGlsZC5jaGVja2VkOwoKCS8vIENoZWNrIGlmIGEgZGlzY29ubmVjdGVkIGNoZWNrYm94IHdpbGwgcmV0YWluIGl0cyBjaGVja2VkCgkvLyB2YWx1ZSBvZiB0cnVlIGFmdGVyIGFwcGVuZGVkIHRvIHRoZSBET00gKElFNi83KQoJc3VwcG9ydC5hcHBlbmRDaGVja2VkID0gaW5wdXQuY2hlY2tlZDsKCglmcmFnbWVudC5yZW1vdmVDaGlsZCggaW5wdXQgKTsKCWZyYWdtZW50LmFwcGVuZENoaWxkKCBkaXYgKTsKCglkaXYuaW5uZXJIVE1MID0gIiI7CgoJLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJLy8gZ2V0cyBjb21wdXRlZCBtYXJnaW4tcmlnaHQgYmFzZWQgb24gd2lkdGggb2YgY29udGFpbmVyLiBGb3IgbW9yZQoJLy8gaW5mbyBzZWUgYnVnICMzMzMzCgkvLyBGYWlscyBpbiBXZWJLaXQgYmVmb3JlIEZlYiAyMDExIG5pZ2h0bGllcwoJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CglpZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkgewoJCW1hcmdpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgkJbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gIjAiOwoJCW1hcmdpbkRpdi5zdHlsZS5tYXJnaW5SaWdodCA9ICIwIjsKCQlkaXYuc3R5bGUud2lkdGggPSAiMnB4IjsKCQlkaXYuYXBwZW5kQ2hpbGQoIG1hcmdpbkRpdiApOwoJCXN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCA9CgkJCSggcGFyc2VJbnQoICggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIG1hcmdpbkRpdiwgbnVsbCApIHx8IHsgbWFyZ2luUmlnaHQ6IDAgfSApLm1hcmdpblJpZ2h0LCAxMCApIHx8IDAgKSA9PT0gMDsKCX0KCgkvLyBUZWNobmlxdWUgZnJvbSBKdXJpeSBaYXl0c2V2CgkvLyBodHRwOi8vcGVyZmVjdGlvbmtpbGxzLmNvbS9kZXRlY3RpbmctZXZlbnQtc3VwcG9ydC13aXRob3V0LWJyb3dzZXItc25pZmZpbmcvCgkvLyBXZSBvbmx5IGNhcmUgYWJvdXQgdGhlIGNhc2Ugd2hlcmUgbm9uLXN0YW5kYXJkIGV2ZW50IHN5c3RlbXMKCS8vIGFyZSB1c2VkLCBuYW1lbHkgaW4gSUUuIFNob3J0LWNpcmN1aXRpbmcgaGVyZSBoZWxwcyB1cyB0bwoJLy8gYXZvaWQgYW4gZXZhbCBjYWxsIChpbiBzZXRBdHRyaWJ1dGUpIHdoaWNoIGNhbiBjYXVzZSBDU1AKCS8vIHRvIGdvIGhheXdpcmUuIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQCglpZiAoIGRpdi5hdHRhY2hFdmVudCApIHsKCQlmb3IoIGkgaW4gewoJCQlzdWJtaXQ6IDEsCgkJCWNoYW5nZTogMSwKCQkJZm9jdXNpbjogMQoJCX0pIHsKCQkJZXZlbnROYW1lID0gIm9uIiArIGk7CgkJCWlzU3VwcG9ydGVkID0gKCBldmVudE5hbWUgaW4gZGl2ICk7CgkJCWlmICggIWlzU3VwcG9ydGVkICkgewoJCQkJZGl2LnNldEF0dHJpYnV0ZSggZXZlbnROYW1lLCAicmV0dXJuOyIgKTsKCQkJCWlzU3VwcG9ydGVkID0gKCB0eXBlb2YgZGl2WyBldmVudE5hbWUgXSA9PT0gImZ1bmN0aW9uIiApOwoJCQl9CgkJCXN1cHBvcnRbIGkgKyAiQnViYmxlcyIgXSA9IGlzU3VwcG9ydGVkOwoJCX0KCX0KCglmcmFnbWVudC5yZW1vdmVDaGlsZCggZGl2ICk7CgoJLy8gTnVsbCBlbGVtZW50cyB0byBhdm9pZCBsZWFrcyBpbiBJRQoJZnJhZ21lbnQgPSBzZWxlY3QgPSBvcHQgPSBtYXJnaW5EaXYgPSBkaXYgPSBpbnB1dCA9IG51bGw7CgoJLy8gUnVuIHRlc3RzIHRoYXQgbmVlZCBhIGJvZHkgYXQgZG9jIHJlYWR5CglqUXVlcnkoZnVuY3Rpb24oKSB7CgkJdmFyIGNvbnRhaW5lciwgb3V0ZXIsIGlubmVyLCB0YWJsZSwgdGQsIG9mZnNldFN1cHBvcnQsCgkJCWNvbk1hcmdpblRvcCwgcHRsbSwgdmIsIHN0eWxlLCBodG1sLAoJCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCgkJaWYgKCAhYm9keSApIHsKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJY29uTWFyZ2luVG9wID0gMTsKCQlwdGxtID0gInBvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxcHg7aGVpZ2h0OjFweDttYXJnaW46MDsiOwoJCXZiID0gInZpc2liaWxpdHk6aGlkZGVuO2JvcmRlcjowOyI7CgkJc3R5bGUgPSAic3R5bGU9JyIgKyBwdGxtICsgImJvcmRlcjo1cHggc29saWQgIzAwMDtwYWRkaW5nOjA7JyI7CgkJaHRtbCA9ICI8ZGl2ICIgKyBzdHlsZSArICI+PGRpdj48L2Rpdj48L2Rpdj4iICsKCQkJIjx0YWJsZSAiICsgc3R5bGUgKyAiIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+IiArCgkJCSI8dHI+PHRkPjwvdGQ+PC90cj48L3RhYmxlPiI7CgoJCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCWNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gdmIgKyAid2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjpzdGF0aWM7dG9wOjA7bWFyZ2luLXRvcDoiICsgY29uTWFyZ2luVG9wICsgInB4IjsKCQlib2R5Lmluc2VydEJlZm9yZSggY29udGFpbmVyLCBib2R5LmZpcnN0Q2hpbGQgKTsKCgkJLy8gQ29uc3RydWN0IHRoZSB0ZXN0IGVsZW1lbnQKCQlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQljb250YWluZXIuYXBwZW5kQ2hpbGQoIGRpdiApOwoKCQkvLyBDaGVjayBpZiB0YWJsZSBjZWxscyBzdGlsbCBoYXZlIG9mZnNldFdpZHRoL0hlaWdodCB3aGVuIHRoZXkgYXJlIHNldAoJCS8vIHRvIGRpc3BsYXk6bm9uZSBhbmQgdGhlcmUgYXJlIHN0aWxsIG90aGVyIHZpc2libGUgdGFibGUgY2VsbHMgaW4gYQoJCS8vIHRhYmxlIHJvdzsgaWYgc28sIG9mZnNldFdpZHRoL0hlaWdodCBhcmUgbm90IHJlbGlhYmxlIGZvciB1c2Ugd2hlbgoJCS8vIGRldGVybWluaW5nIGlmIGFuIGVsZW1lbnQgaGFzIGJlZW4gaGlkZGVuIGRpcmVjdGx5IHVzaW5nCgkJLy8gZGlzcGxheTpub25lIChpdCBpcyBzdGlsbCBzYWZlIHRvIHVzZSBvZmZzZXRzIGlmIGEgcGFyZW50IGVsZW1lbnQgaXMKCQkvLyBoaWRkZW47IGRvbiBzYWZldHkgZ29nZ2xlcyBhbmQgc2VlIGJ1ZyAjNDUxMiBmb3IgbW9yZSBpbmZvcm1hdGlvbikuCgkJLy8gKG9ubHkgSUUgOCBmYWlscyB0aGlzIHRlc3QpCgkJZGl2LmlubmVySFRNTCA9ICI8dGFibGU+PHRyPjx0ZCBzdHlsZT0ncGFkZGluZzowO2JvcmRlcjowO2Rpc3BsYXk6bm9uZSc+PC90ZD48dGQ+dDwvdGQ+PC90cj48L3RhYmxlPiI7CgkJdGRzID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAidGQiICk7CgkJaXNTdXBwb3J0ZWQgPSAoIHRkc1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMCApOwoKCQl0ZHNbIDAgXS5zdHlsZS5kaXNwbGF5ID0gIiI7CgkJdGRzWyAxIF0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCgkJLy8gQ2hlY2sgaWYgZW1wdHkgdGFibGUgY2VsbHMgc3RpbGwgaGF2ZSBvZmZzZXRXaWR0aC9IZWlnaHQKCQkvLyAoSUUgPD0gOCBmYWlsIHRoaXMgdGVzdCkKCQlzdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyA9IGlzU3VwcG9ydGVkICYmICggdGRzWyAwIF0ub2Zmc2V0SGVpZ2h0ID09PSAwICk7CgoJCS8vIEZpZ3VyZSBvdXQgaWYgdGhlIFczQyBib3ggbW9kZWwgd29ya3MgYXMgZXhwZWN0ZWQKCQlkaXYuaW5uZXJIVE1MID0gIiI7CgkJZGl2LnN0eWxlLndpZHRoID0gZGl2LnN0eWxlLnBhZGRpbmdMZWZ0ID0gIjFweCI7CgkJalF1ZXJ5LmJveE1vZGVsID0gc3VwcG9ydC5ib3hNb2RlbCA9IGRpdi5vZmZzZXRXaWR0aCA9PT0gMjsKCgkJaWYgKCB0eXBlb2YgZGl2LnN0eWxlLnpvb20gIT09ICJ1bmRlZmluZWQiICkgewoJCQkvLyBDaGVjayBpZiBuYXRpdmVseSBibG9jay1sZXZlbCBlbGVtZW50cyBhY3QgbGlrZSBpbmxpbmUtYmxvY2sKCQkJLy8gZWxlbWVudHMgd2hlbiBzZXR0aW5nIHRoZWlyIGRpc3BsYXkgdG8gJ2lubGluZScgYW5kIGdpdmluZwoJCQkvLyB0aGVtIGxheW91dAoJCQkvLyAoSUUgPCA4IGRvZXMgdGhpcykKCQkJZGl2LnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCQkJZGl2LnN0eWxlLnpvb20gPSAxOwoJCQlzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gMiApOwoKCQkJLy8gQ2hlY2sgaWYgZWxlbWVudHMgd2l0aCBsYXlvdXQgc2hyaW5rLXdyYXAgdGhlaXIgY2hpbGRyZW4KCQkJLy8gKElFIDYgZG9lcyB0aGlzKQoJCQlkaXYuc3R5bGUuZGlzcGxheSA9ICIiOwoJCQlkaXYuaW5uZXJIVE1MID0gIjxkaXYgc3R5bGU9J3dpZHRoOjRweDsnPjwvZGl2PiI7CgkJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9ICggZGl2Lm9mZnNldFdpZHRoICE9PSAyICk7CgkJfQoKCQlkaXYuc3R5bGUuY3NzVGV4dCA9IHB0bG0gKyB2YjsKCQlkaXYuaW5uZXJIVE1MID0gaHRtbDsKCgkJb3V0ZXIgPSBkaXYuZmlyc3RDaGlsZDsKCQlpbm5lciA9IG91dGVyLmZpcnN0Q2hpbGQ7CgkJdGQgPSBvdXRlci5uZXh0U2libGluZy5maXJzdENoaWxkLmZpcnN0Q2hpbGQ7CgoJCW9mZnNldFN1cHBvcnQgPSB7CgkJCWRvZXNOb3RBZGRCb3JkZXI6ICggaW5uZXIub2Zmc2V0VG9wICE9PSA1ICksCgkJCWRvZXNBZGRCb3JkZXJGb3JUYWJsZUFuZENlbGxzOiAoIHRkLm9mZnNldFRvcCA9PT0gNSApCgkJfTsKCgkJaW5uZXIuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwoJCWlubmVyLnN0eWxlLnRvcCA9ICIyMHB4IjsKCgkJLy8gc2FmYXJpIHN1YnRyYWN0cyBwYXJlbnQgYm9yZGVyIHdpZHRoIGhlcmUgd2hpY2ggaXMgNXB4CgkJb2Zmc2V0U3VwcG9ydC5maXhlZFBvc2l0aW9uID0gKCBpbm5lci5vZmZzZXRUb3AgPT09IDIwIHx8IGlubmVyLm9mZnNldFRvcCA9PT0gMTUgKTsKCQlpbm5lci5zdHlsZS5wb3NpdGlvbiA9IGlubmVyLnN0eWxlLnRvcCA9ICIiOwoKCQlvdXRlci5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCW91dGVyLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCgkJb2Zmc2V0U3VwcG9ydC5zdWJ0cmFjdHNCb3JkZXJGb3JPdmVyZmxvd05vdFZpc2libGUgPSAoIGlubmVyLm9mZnNldFRvcCA9PT0gLTUgKTsKCQlvZmZzZXRTdXBwb3J0LmRvZXNOb3RJbmNsdWRlTWFyZ2luSW5Cb2R5T2Zmc2V0ID0gKCBib2R5Lm9mZnNldFRvcCAhPT0gY29uTWFyZ2luVG9wICk7CgoJCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoJCWRpdiAgPSBjb250YWluZXIgPSBudWxsOwoKCQlqUXVlcnkuZXh0ZW5kKCBzdXBwb3J0LCBvZmZzZXRTdXBwb3J0ICk7Cgl9KTsKCglyZXR1cm4gc3VwcG9ydDsKfSkoKTsKCgoKCnZhciByYnJhY2UgPSAvXig/Olx7LipcfXxcWy4qXF0pJC8sCglybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCmpRdWVyeS5leHRlbmQoewoJY2FjaGU6IHt9LAoKCS8vIFBsZWFzZSB1c2Ugd2l0aCBjYXV0aW9uCgl1dWlkOiAwLAoKCS8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZQoJLy8gTm9uLWRpZ2l0cyByZW1vdmVkIHRvIG1hdGNoIHJpbmxpbmVqUXVlcnkKCWV4cGFuZG86ICJqUXVlcnkiICsgKCBqUXVlcnkuZm4uanF1ZXJ5ICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3UKCS8vIGF0dGVtcHQgdG8gYWRkIGV4cGFuZG8gcHJvcGVydGllcyB0byB0aGVtLgoJbm9EYXRhOiB7CgkJImVtYmVkIjogdHJ1ZSwKCQkvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQoJCSJvYmplY3QiOiAiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiwKCQkiYXBwbGV0IjogdHJ1ZQoJfSwKCgloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQllbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJcmV0dXJuICEhZWxlbSAmJiAhaXNFbXB0eURhdGFPYmplY3QoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEsIHB2dCAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCQlpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgcHJpdmF0ZUNhY2hlLCB0aGlzQ2FjaGUsIHJldCwKCQkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQkJZ2V0QnlOYW1lID0gdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciLAoKCQkJLy8gV2UgaGF2ZSB0byBoYW5kbGUgRE9NIG5vZGVzIGFuZCBKUyBvYmplY3RzIGRpZmZlcmVudGx5IGJlY2F1c2UgSUU2LTcKCQkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQkJaXNOb2RlID0gZWxlbS5ub2RlVHlwZSwKCgkJCS8vIE9ubHkgRE9NIG5vZGVzIG5lZWQgdGhlIGdsb2JhbCBqUXVlcnkgY2FjaGU7IEpTIG9iamVjdCBkYXRhIGlzCgkJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQkJY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLAoKCQkJLy8gT25seSBkZWZpbmluZyBhbiBJRCBmb3IgSlMgb2JqZWN0cyBpZiBpdHMgY2FjaGUgYWxyZWFkeSBleGlzdHMgYWxsb3dzCgkJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJCWlkID0gaXNOb2RlID8gZWxlbVsgaW50ZXJuYWxLZXkgXSA6IGVsZW1bIGludGVybmFsS2V5IF0gJiYgaW50ZXJuYWxLZXksCgkJCWlzRXZlbnRzID0gbmFtZSA9PT0gImV2ZW50cyI7CgoJCS8vIEF2b2lkIGRvaW5nIGFueSBtb3JlIHdvcmsgdGhhbiB3ZSBuZWVkIHRvIHdoZW4gdHJ5aW5nIHRvIGdldCBkYXRhIG9uIGFuCgkJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCgkJaWYgKCAoIWlkIHx8ICFjYWNoZVtpZF0gfHwgKCFpc0V2ZW50cyAmJiAhcHZ0ICYmICFjYWNoZVtpZF0uZGF0YSkpICYmIGdldEJ5TmFtZSAmJiBkYXRhID09PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggIWlkICkgewoJCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGEKCQkJLy8gZW5kcyB1cCBpbiB0aGUgZ2xvYmFsIGNhY2hlCgkJCWlmICggaXNOb2RlICkgewoJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gKytqUXVlcnkudXVpZDsKCQkJfSBlbHNlIHsKCQkJCWlkID0gaW50ZXJuYWxLZXk7CgkJCX0KCQl9CgoJCWlmICggIWNhY2hlWyBpZCBdICkgewoJCQljYWNoZVsgaWQgXSA9IHt9OwoKCQkJLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCQkvLyBpcyBzZXJpYWxpemVkIHVzaW5nIEpTT04uc3RyaW5naWZ5CgkJCWlmICggIWlzTm9kZSApIHsKCQkJCWNhY2hlWyBpZCBdLnRvSlNPTiA9IGpRdWVyeS5ub29wOwoJCQl9CgkJfQoKCQkvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwoJCS8vIHNoYWxsb3cgY29waWVkIG92ZXIgb250byB0aGUgZXhpc3RpbmcgY2FjaGUKCQlpZiAoIHR5cGVvZiBuYW1lID09PSAib2JqZWN0IiB8fCB0eXBlb2YgbmFtZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJaWYgKCBwdnQgKSB7CgkJCQljYWNoZVsgaWQgXSA9IGpRdWVyeS5leHRlbmQoIGNhY2hlWyBpZCBdLCBuYW1lICk7CgkJCX0gZWxzZSB7CgkJCQljYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApOwoJCQl9CgkJfQoKCQlwcml2YXRlQ2FjaGUgPSB0aGlzQ2FjaGUgPSBjYWNoZVsgaWQgXTsKCgkJLy8galF1ZXJ5IGRhdGEoKSBpcyBzdG9yZWQgaW4gYSBzZXBhcmF0ZSBvYmplY3QgaW5zaWRlIHRoZSBvYmplY3QncyBpbnRlcm5hbCBkYXRhCgkJLy8gY2FjaGUgaW4gb3JkZXIgdG8gYXZvaWQga2V5IGNvbGxpc2lvbnMgYmV0d2VlbiBpbnRlcm5hbCBkYXRhIGFuZCB1c2VyLWRlZmluZWQKCQkvLyBkYXRhLgoJCWlmICggIXB2dCApIHsKCQkJaWYgKCAhdGhpc0NhY2hlLmRhdGEgKSB7CgkJCQl0aGlzQ2FjaGUuZGF0YSA9IHt9OwoJCQl9CgoJCQl0aGlzQ2FjaGUgPSB0aGlzQ2FjaGUuZGF0YTsKCQl9CgoJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzQ2FjaGVbIGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKSBdID0gZGF0YTsKCQl9CgoJCS8vIFVzZXJzIHNob3VsZCBub3QgYXR0ZW1wdCB0byBpbnNwZWN0IHRoZSBpbnRlcm5hbCBldmVudHMgb2JqZWN0IHVzaW5nIGpRdWVyeS5kYXRhLAoJCS8vIGl0IGlzIHVuZG9jdW1lbnRlZCBhbmQgc3ViamVjdCB0byBjaGFuZ2UuIEJ1dCBkb2VzIGFueW9uZSBsaXN0ZW4/IE5vLgoJCWlmICggaXNFdmVudHMgJiYgIXRoaXNDYWNoZVsgbmFtZSBdICkgewoJCQlyZXR1cm4gcHJpdmF0ZUNhY2hlLmV2ZW50czsKCQl9CgoJCS8vIENoZWNrIGZvciBib3RoIGNvbnZlcnRlZC10by1jYW1lbCBhbmQgbm9uLWNvbnZlcnRlZCBkYXRhIHByb3BlcnR5IG5hbWVzCgkJLy8gSWYgYSBkYXRhIHByb3BlcnR5IHdhcyBzcGVjaWZpZWQKCQlpZiAoIGdldEJ5TmFtZSApIHsKCgkJCS8vIEZpcnN0IFRyeSB0byBmaW5kIGFzLWlzIHByb3BlcnR5IGRhdGEKCQkJcmV0ID0gdGhpc0NhY2hlWyBuYW1lIF07CgoJCQkvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgkJCWlmICggcmV0ID09IG51bGwgKSB7CgoJCQkJLy8gVHJ5IHRvIGZpbmQgdGhlIGNhbWVsQ2FzZWQgcHJvcGVydHkKCQkJCXJldCA9IHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF07CgkJCX0KCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzQ2FjaGU7CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCglyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJCWlmICggIWpRdWVyeS5hY2NlcHREYXRhKCBlbGVtICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciB0aGlzQ2FjaGUsIGksIGwsCgoJCQkvLyBSZWZlcmVuY2UgdG8gaW50ZXJuYWwgZGF0YSBjYWNoZSBrZXkKCQkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCgkJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCQkvLyBTZWUgalF1ZXJ5LmRhdGEgZm9yIG1vcmUgaW5mb3JtYXRpb24KCQkJY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLAoKCQkJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCgkJCWlkID0gaXNOb2RlID8gZWxlbVsgaW50ZXJuYWxLZXkgXSA6IGludGVybmFsS2V5OwoKCQkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCQkvLyBwdXJwb3NlIGluIGNvbnRpbnVpbmcKCQlpZiAoICFjYWNoZVsgaWQgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBuYW1lICkgewoKCQkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQkJaWYgKCB0aGlzQ2FjaGUgKSB7CgoJCQkJLy8gU3VwcG9ydCBhcnJheSBvciBzcGFjZSBzZXBhcmF0ZWQgc3RyaW5nIG5hbWVzIGZvciBkYXRhIGtleXMKCQkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJCS8vIHRyeSB0aGUgc3RyaW5nIGFzIGEga2V5IGJlZm9yZSBhbnkgbWFuaXB1bGF0aW9uCgkJCQkJaWYgKCBuYW1lIGluIHRoaXNDYWNoZSApIHsKCQkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBzcGxpdCB0aGUgY2FtZWwgY2FzZWQgdmVyc2lvbiBieSBzcGFjZXMgdW5sZXNzIGEga2V5IHdpdGggdGhlIHNwYWNlcyBleGlzdHMKCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQkJaWYgKCBuYW1lIGluIHRoaXNDYWNoZSApIHsKCQkJCQkJCW5hbWUgPSBbIG5hbWUgXTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW5hbWUgPSBuYW1lLnNwbGl0KCAiICIgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQlmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWRlbGV0ZSB0aGlzQ2FjaGVbIG5hbWVbaV0gXTsKCQkJCX0KCgkJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCQkvLyBhbmQgbGV0IHRoZSBjYWNoZSBvYmplY3QgaXRzZWxmIGdldCBkZXN0cm95ZWQKCQkJCWlmICggISggcHZ0ID8gaXNFbXB0eURhdGFPYmplY3QgOiBqUXVlcnkuaXNFbXB0eU9iamVjdCApKCB0aGlzQ2FjaGUgKSApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWlmICggIXB2dCApIHsKCQkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCQkvLyBEb24ndCBkZXN0cm95IHRoZSBwYXJlbnQgY2FjaGUgdW5sZXNzIHRoZSBpbnRlcm5hbCBkYXRhIG9iamVjdAoJCQkvLyBoYWQgYmVlbiB0aGUgb25seSB0aGluZyBsZWZ0IGluIGl0CgkJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KGNhY2hlWyBpZCBdKSApIHsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJLy8gQnJvd3NlcnMgdGhhdCBmYWlsIGV4cGFuZG8gZGVsZXRpb24gYWxzbyByZWZ1c2UgdG8gZGVsZXRlIGV4cGFuZG9zIG9uCgkJLy8gdGhlIHdpbmRvdywgYnV0IGl0IHdpbGwgYWxsb3cgaXQgb24gYWxsIG90aGVyIEpTIG9iamVjdHM7IG90aGVyIGJyb3dzZXJzCgkJLy8gZG9uJ3QgY2FyZQoJCS8vIEVuc3VyZSB0aGF0IGBjYWNoZWAgaXMgbm90IGEgd2luZG93IG9iamVjdCAjMTAwODAKCQlpZiAoIGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8gfHwgIWNhY2hlLnNldEludGVydmFsICkgewoJCQlkZWxldGUgY2FjaGVbIGlkIF07CgkJfSBlbHNlIHsKCQkJY2FjaGVbIGlkIF0gPSBudWxsOwoJCX0KCgkJLy8gV2UgZGVzdHJveWVkIHRoZSBjYWNoZSBhbmQgbmVlZCB0byBlbGltaW5hdGUgdGhlIGV4cGFuZG8gb24gdGhlIG5vZGUgdG8gYXZvaWQKCQkvLyBmYWxzZSBsb29rdXBzIGluIHRoZSBjYWNoZSBmb3IgZW50cmllcyB0aGF0IG5vIGxvbmdlciBleGlzdAoJCWlmICggaXNOb2RlICkgewoJCQkvLyBJRSBkb2VzIG5vdCBhbGxvdyB1cyB0byBkZWxldGUgZXhwYW5kbyBwcm9wZXJ0aWVzIGZyb20gbm9kZXMsCgkJCS8vIG5vciBkb2VzIGl0IGhhdmUgYSByZW1vdmVBdHRyaWJ1dGUgZnVuY3Rpb24gb24gRG9jdW1lbnQgbm9kZXM7CgkJCS8vIHdlIG11c3QgaGFuZGxlIGFsbCBvZiB0aGVzZSBjYXNlcwoJCQlpZiAoIGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8gKSB7CgkJCQlkZWxldGUgZWxlbVsgaW50ZXJuYWxLZXkgXTsKCQkJfSBlbHNlIGlmICggZWxlbS5yZW1vdmVBdHRyaWJ1dGUgKSB7CgkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggaW50ZXJuYWxLZXkgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1bIGludGVybmFsS2V5IF0gPSBudWxsOwoJCQl9CgkJfQoJfSwKCgkvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuCglfZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGpRdWVyeS5kYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7Cgl9LAoKCS8vIEEgbWV0aG9kIGZvciBkZXRlcm1pbmluZyBpZiBhIERPTSBub2RlIGNhbiBoYW5kbGUgdGhlIGRhdGEgZXhwYW5kbwoJYWNjZXB0RGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJaWYgKCBlbGVtLm5vZGVOYW1lICkgewoJCQl2YXIgbWF0Y2ggPSBqUXVlcnkubm9EYXRhWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCWlmICggbWF0Y2ggKSB7CgkJCQlyZXR1cm4gIShtYXRjaCA9PT0gdHJ1ZSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpICE9PSBtYXRjaCk7CgkJCX0KCQl9CgoJCXJldHVybiB0cnVlOwoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJZGF0YTogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdmFyIHBhcnRzLCBhdHRyLCBuYW1lLAoJCQlkYXRhID0gbnVsbDsKCgkJaWYgKCB0eXBlb2Yga2V5ID09PSAidW5kZWZpbmVkIiApIHsKCQkJaWYgKCB0aGlzLmxlbmd0aCApIHsKCQkJCWRhdGEgPSBqUXVlcnkuZGF0YSggdGhpc1swXSApOwoKCQkJCWlmICggdGhpc1swXS5ub2RlVHlwZSA9PT0gMSAmJiAhalF1ZXJ5Ll9kYXRhKCB0aGlzWzBdLCAicGFyc2VkQXR0cnMiICkgKSB7CgkJCQkJYXR0ciA9IHRoaXNbMF0uYXR0cmlidXRlczsKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBhdHRyLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCQkJbmFtZSA9IGF0dHJbaV0ubmFtZTsKCgkJCQkJCWlmICggbmFtZS5pbmRleE9mKCAiZGF0YS0iICkgPT09IDAgKSB7CgkJCQkJCQluYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZS5zdWJzdHJpbmcoNSkgKTsKCgkJCQkJCQlkYXRhQXR0ciggdGhpc1swXSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCB0aGlzWzBdLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9IGVsc2UgaWYgKCB0eXBlb2Yga2V5ID09PSAib2JqZWN0IiApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5kYXRhKCB0aGlzLCBrZXkgKTsKCQkJfSk7CgkJfQoKCQlwYXJ0cyA9IGtleS5zcGxpdCgiLiIpOwoJCXBhcnRzWzFdID0gcGFydHNbMV0gPyAiLiIgKyBwYXJ0c1sxXSA6ICIiOwoKCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCWRhdGEgPSB0aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIiArIHBhcnRzWzFdICsgIiEiLCBbcGFydHNbMF1dKTsKCgkJCS8vIFRyeSB0byBmZXRjaCBhbnkgaW50ZXJuYWxseSBzdG9yZWQgZGF0YSBmaXJzdAoJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmxlbmd0aCApIHsKCQkJCWRhdGEgPSBqUXVlcnkuZGF0YSggdGhpc1swXSwga2V5ICk7CgkJCQlkYXRhID0gZGF0YUF0dHIoIHRoaXNbMF0sIGtleSwgZGF0YSApOwoJCQl9CgoJCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkICYmIHBhcnRzWzFdID8KCQkJCXRoaXMuZGF0YSggcGFydHNbMF0gKSA6CgkJCQlkYXRhOwoKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKSwKCQkJCQlhcmdzID0gWyBwYXJ0c1swXSwgdmFsdWUgXTsKCgkJCQlzZWxmLnRyaWdnZXJIYW5kbGVyKCAic2V0RGF0YSIgKyBwYXJ0c1sxXSArICIhIiwgYXJncyApOwoJCQkJalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSwgdmFsdWUgKTsKCQkJCXNlbGYudHJpZ2dlckhhbmRsZXIoICJjaGFuZ2VEYXRhIiArIHBhcnRzWzFdICsgIiEiLCBhcmdzICk7CgkJCX0pOwoJCX0KCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJfSk7Cgl9Cn0pOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJZGF0YSA9PT0gImZhbHNlIiA/IGZhbHNlIDoKCQkJCWRhdGEgPT09ICJudWxsIiA/IG51bGwgOgoJCQkJalF1ZXJ5LmlzTnVtZXJpYyggZGF0YSApID8gcGFyc2VGbG9hdCggZGF0YSApIDoKCQkJCQlyYnJhY2UudGVzdCggZGF0YSApID8galF1ZXJ5LnBhcnNlSlNPTiggZGF0YSApIDoKCQkJCQlkYXRhOwoJCQl9IGNhdGNoKCBlICkge30KCgkJCS8vIE1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGRhdGEgc28gaXQgaXNuJ3QgY2hhbmdlZCBsYXRlcgoJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoKCXJldHVybiBkYXRhOwp9CgovLyBjaGVja3MgYSBjYWNoZSBvYmplY3QgZm9yIGVtcHRpbmVzcwpmdW5jdGlvbiBpc0VtcHR5RGF0YU9iamVjdCggb2JqICkgewoJZm9yICggdmFyIG5hbWUgaW4gb2JqICkgewoKCQkvLyBpZiB0aGUgcHVibGljIGRhdGEgb2JqZWN0IGlzIGVtcHR5LCB0aGUgcHJpdmF0ZSBpcyBzdGlsbCBlbXB0eQoJCWlmICggbmFtZSA9PT0gImRhdGEiICYmIGpRdWVyeS5pc0VtcHR5T2JqZWN0KCBvYmpbbmFtZV0gKSApIHsKCQkJY29udGludWU7CgkJfQoJCWlmICggbmFtZSAhPT0gInRvSlNPTiIgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9CgoJcmV0dXJuIHRydWU7Cn0KCgoKCmZ1bmN0aW9uIGhhbmRsZVF1ZXVlTWFya0RlZmVyKCBlbGVtLCB0eXBlLCBzcmMgKSB7Cgl2YXIgZGVmZXJEYXRhS2V5ID0gdHlwZSArICJkZWZlciIsCgkJcXVldWVEYXRhS2V5ID0gdHlwZSArICJxdWV1ZSIsCgkJbWFya0RhdGFLZXkgPSB0eXBlICsgIm1hcmsiLAoJCWRlZmVyID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCBkZWZlckRhdGFLZXkgKTsKCWlmICggZGVmZXIgJiYKCQkoIHNyYyA9PT0gInF1ZXVlIiB8fCAhalF1ZXJ5Ll9kYXRhKGVsZW0sIHF1ZXVlRGF0YUtleSkgKSAmJgoJCSggc3JjID09PSAibWFyayIgfHwgIWpRdWVyeS5fZGF0YShlbGVtLCBtYXJrRGF0YUtleSkgKSApIHsKCQkvLyBHaXZlIHJvb20gZm9yIGhhcmQtY29kZWQgY2FsbGJhY2tzIHRvIGZpcmUgZmlyc3QKCQkvLyBhbmQgZXZlbnR1YWxseSBtYXJrL3F1ZXVlIHNvbWV0aGluZyBlbHNlIG9uIHRoZSBlbGVtZW50CgkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCWlmICggIWpRdWVyeS5fZGF0YSggZWxlbSwgcXVldWVEYXRhS2V5ICkgJiYKCQkJCSFqUXVlcnkuX2RhdGEoIGVsZW0sIG1hcmtEYXRhS2V5ICkgKSB7CgkJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgZGVmZXJEYXRhS2V5LCB0cnVlICk7CgkJCQlkZWZlci5maXJlKCk7CgkJCX0KCQl9LCAwICk7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoKCV9tYXJrOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgIm1hcmsiOwoJCQlqUXVlcnkuX2RhdGEoIGVsZW0sIHR5cGUsIChqUXVlcnkuX2RhdGEoIGVsZW0sIHR5cGUgKSB8fCAwKSArIDEgKTsKCQl9Cgl9LAoKCV91bm1hcms6IGZ1bmN0aW9uKCBmb3JjZSwgZWxlbSwgdHlwZSApIHsKCQlpZiAoIGZvcmNlICE9PSB0cnVlICkgewoJCQl0eXBlID0gZWxlbTsKCQkJZWxlbSA9IGZvcmNlOwoJCQlmb3JjZSA9IGZhbHNlOwoJCX0KCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJCXZhciBrZXkgPSB0eXBlICsgIm1hcmsiLAoJCQkJY291bnQgPSBmb3JjZSA/IDAgOiAoIChqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IDEpIC0gMSApOwoJCQlpZiAoIGNvdW50ICkgewoJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCBrZXksIGNvdW50ICk7CgkJCX0gZWxzZSB7CgkJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwga2V5LCB0cnVlICk7CgkJCQloYW5kbGVRdWV1ZU1hcmtEZWZlciggZWxlbSwgdHlwZSwgIm1hcmsiICk7CgkJCX0KCQl9Cgl9LAoKCXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSwgZGF0YSApIHsKCQl2YXIgcTsKCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgInF1ZXVlIjsKCQkJcSA9IGpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSApOwoKCQkJLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cAoJCQlpZiAoIGRhdGEgKSB7CgkJCQlpZiAoICFxIHx8IGpRdWVyeS5pc0FycmF5KGRhdGEpICkgewoJCQkJCXEgPSBqUXVlcnkuX2RhdGEoIGVsZW0sIHR5cGUsIGpRdWVyeS5tYWtlQXJyYXkoZGF0YSkgKTsKCQkJCX0gZWxzZSB7CgkJCQkJcS5wdXNoKCBkYXRhICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHEgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpLAoJCQlob29rcyA9IHt9OwoKCQkvLyBJZiB0aGUgZnggcXVldWUgaXMgZGVxdWV1ZWQsIGFsd2F5cyByZW1vdmUgdGhlIHByb2dyZXNzIHNlbnRpbmVsCgkJaWYgKCBmbiA9PT0gImlucHJvZ3Jlc3MiICkgewoJCQlmbiA9IHF1ZXVlLnNoaWZ0KCk7CgkJfQoKCQlpZiAoIGZuICkgewoJCQkvLyBBZGQgYSBwcm9ncmVzcyBzZW50aW5lbCB0byBwcmV2ZW50IHRoZSBmeCBxdWV1ZSBmcm9tIGJlaW5nCgkJCS8vIGF1dG9tYXRpY2FsbHkgZGVxdWV1ZWQKCQkJaWYgKCB0eXBlID09PSAiZngiICkgewoJCQkJcXVldWUudW5zaGlmdCggImlucHJvZ3Jlc3MiICk7CgkJCX0KCgkJCWpRdWVyeS5fZGF0YSggZWxlbSwgdHlwZSArICIucnVuIiwgaG9va3MgKTsKCQkJZm4uY2FsbCggZWxlbSwgZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggZWxlbSwgdHlwZSApOwoJCQl9LCBob29rcyApOwoJCX0KCgkJaWYgKCAhcXVldWUubGVuZ3RoICkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSAiICsgdHlwZSArICIucnVuIiwgdHJ1ZSApOwoJCQloYW5kbGVRdWV1ZU1hcmtEZWZlciggZWxlbSwgdHlwZSwgInF1ZXVlIiApOwoJCX0KCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJZGF0YSA9IHR5cGU7CgkJCXR5cGUgPSAiZngiOwoJCX0KCgkJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiBqUXVlcnkucXVldWUoIHRoaXNbMF0sIHR5cGUgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBkYXRhICk7CgoJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbMF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0KCQl9KTsKCX0sCglkZXF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCX0pOwoJfSwKCS8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KCS8vIGh0dHA6Ly9ibGluZHNpZ25hbHMuY29tL2luZGV4LnBocC8yMDA5LzA3L2pxdWVyeS1kZWxheS8KCWRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dCggbmV4dCwgdGltZSApOwoJCQlob29rcy5zdG9wID0gZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJfTsKCQl9KTsKCX0sCgljbGVhclF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJfSwKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iamVjdCApIHsKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqZWN0ID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCQl2YXIgZGVmZXIgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJZWxlbWVudHMgPSB0aGlzLAoJCQlpID0gZWxlbWVudHMubGVuZ3RoLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyRGF0YUtleSA9IHR5cGUgKyAiZGVmZXIiLAoJCQlxdWV1ZURhdGFLZXkgPSB0eXBlICsgInF1ZXVlIiwKCQkJbWFya0RhdGFLZXkgPSB0eXBlICsgIm1hcmsiLAoJCQl0bXA7CgkJZnVuY3Rpb24gcmVzb2x2ZSgpIHsKCQkJaWYgKCAhKCAtLWNvdW50ICkgKSB7CgkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQl9CgkJfQoJCXdoaWxlKCBpLS0gKSB7CgkJCWlmICgoIHRtcCA9IGpRdWVyeS5kYXRhKCBlbGVtZW50c1sgaSBdLCBkZWZlckRhdGFLZXksIHVuZGVmaW5lZCwgdHJ1ZSApIHx8CgkJCQkJKCBqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgcXVldWVEYXRhS2V5LCB1bmRlZmluZWQsIHRydWUgKSB8fAoJCQkJCQlqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgbWFya0RhdGFLZXksIHVuZGVmaW5lZCwgdHJ1ZSApICkgJiYKCQkJCQlqUXVlcnkuZGF0YSggZWxlbWVudHNbIGkgXSwgZGVmZXJEYXRhS2V5LCBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksIHRydWUgKSApKSB7CgkJCQljb3VudCsrOwoJCQkJdG1wLmFkZCggcmVzb2x2ZSApOwoJCQl9CgkJfQoJCXJlc29sdmUoKTsKCQlyZXR1cm4gZGVmZXIucHJvbWlzZSgpOwoJfQp9KTsKCgoKCnZhciByY2xhc3MgPSAvW1xuXHRccl0vZywKCXJzcGFjZSA9IC9ccysvLAoJcnJldHVybiA9IC9cci9nLAoJcnR5cGUgPSAvXig/OmJ1dHRvbnxpbnB1dCkkL2ksCglyZm9jdXNhYmxlID0gL14oPzpidXR0b258aW5wdXR8b2JqZWN0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCglyY2xpY2thYmxlID0gL15hKD86cmVhKT8kL2ksCglyYm9vbGVhbiA9IC9eKD86YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNoZWNrZWR8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0galF1ZXJ5LnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJbm9kZUhvb2ssIGJvb2xIb29rLCBmaXhTcGVjaWZpZWQ7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWF0dHI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgbmFtZSwgdmFsdWUsIHRydWUsIGpRdWVyeS5hdHRyICk7Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5yZW1vdmVBdHRyKCB0aGlzLCBuYW1lICk7CgkJfSk7Cgl9LAoKCXByb3A6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgbmFtZSwgdmFsdWUsIHRydWUsIGpRdWVyeS5wcm9wICk7Cgl9LAoKCXJlbW92ZVByb3A6IGZ1bmN0aW9uKCBuYW1lICkgewoJCW5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJLy8gdHJ5L2NhdGNoIGhhbmRsZXMgY2FzZXMgd2hlcmUgSUUgYmFsa3MgKHN1Y2ggYXMgcmVtb3ZpbmcgYSBwcm9wZXJ0eSBvbiB3aW5kb3cpCgkJCXRyeSB7CgkJCQl0aGlzWyBuYW1lIF0gPSB1bmRlZmluZWQ7CgkJCQlkZWxldGUgdGhpc1sgbmFtZSBdOwoJCQl9IGNhdGNoKCBlICkge30KCQl9KTsKCX0sCgoJYWRkQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgY2xhc3NOYW1lcywgaSwgbCwgZWxlbSwKCQkJc2V0Q2xhc3MsIGMsIGNsOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuYWRkQ2xhc3MoIHZhbHVlLmNhbGwodGhpcywgaiwgdGhpcy5jbGFzc05hbWUpICk7CgkJCX0pOwoJCX0KCgkJaWYgKCB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICkgewoJCQljbGFzc05hbWVzID0gdmFsdWUuc3BsaXQoIHJzcGFjZSApOwoKCQkJZm9yICggaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWlmICggIWVsZW0uY2xhc3NOYW1lICYmIGNsYXNzTmFtZXMubGVuZ3RoID09PSAxICkgewoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IHZhbHVlOwoKCQkJCQl9IGVsc2UgewoJCQkJCQlzZXRDbGFzcyA9ICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiOwoKCQkJCQkJZm9yICggYyA9IDAsIGNsID0gY2xhc3NOYW1lcy5sZW5ndGg7IGMgPCBjbDsgYysrICkgewoJCQkJCQkJaWYgKCAhfnNldENsYXNzLmluZGV4T2YoICIgIiArIGNsYXNzTmFtZXNbIGMgXSArICIgIiApICkgewoJCQkJCQkJCXNldENsYXNzICs9IGNsYXNzTmFtZXNbIGMgXSArICIgIjsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IGpRdWVyeS50cmltKCBzZXRDbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzTmFtZXMsIGksIGwsIGVsZW0sIGNsYXNzTmFtZSwgYywgY2w7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5yZW1vdmVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgewoJCQljbGFzc05hbWVzID0gKCB2YWx1ZSB8fCAiIiApLnNwbGl0KCByc3BhY2UgKTsKCgkJCWZvciAoIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQllbGVtID0gdGhpc1sgaSBdOwoKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiBlbGVtLmNsYXNzTmFtZSApIHsKCQkJCQlpZiAoIHZhbHVlICkgewoJCQkJCQljbGFzc05hbWUgPSAoIiAiICsgZWxlbS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UoIHJjbGFzcywgIiAiICk7CgkJCQkJCWZvciAoIGMgPSAwLCBjbCA9IGNsYXNzTmFtZXMubGVuZ3RoOyBjIDwgY2w7IGMrKyApIHsKCQkJCQkJCWNsYXNzTmFtZSA9IGNsYXNzTmFtZS5yZXBsYWNlKCIgIiArIGNsYXNzTmFtZXNbIGMgXSArICIgIiwgIiAiKTsKCQkJCQkJfQoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IGpRdWVyeS50cmltKCBjbGFzc05hbWUgKTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJZWxlbS5jbGFzc05hbWUgPSAiIjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgl0b2dnbGVDbGFzczogZnVuY3Rpb24oIHZhbHVlLCBzdGF0ZVZhbCApIHsKCQl2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZSwKCQkJaXNCb29sID0gdHlwZW9mIHN0YXRlVmFsID09PSAiYm9vbGVhbiI7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBpLCB0aGlzLmNsYXNzTmFtZSwgc3RhdGVWYWwpLCBzdGF0ZVZhbCApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCQkvLyB0b2dnbGUgaW5kaXZpZHVhbCBjbGFzcyBuYW1lcwoJCQkJdmFyIGNsYXNzTmFtZSwKCQkJCQlpID0gMCwKCQkJCQlzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQkJc3RhdGUgPSBzdGF0ZVZhbCwKCQkJCQljbGFzc05hbWVzID0gdmFsdWUuc3BsaXQoIHJzcGFjZSApOwoKCQkJCXdoaWxlICggKGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdKSApIHsKCQkJCQkvLyBjaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwZXJhdGVkIGxpc3QKCQkJCQlzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCXNlbGZbIHN0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyIgXSggY2xhc3NOYW1lICk7CgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSAidW5kZWZpbmVkIiB8fCB0eXBlID09PSAiYm9vbGVhbiIgKSB7CgkJCQlpZiAoIHRoaXMuY2xhc3NOYW1lICkgewoJCQkJCS8vIHN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyB0b2dnbGUgd2hvbGUgY2xhc3NOYW1lCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIjsKCQkJfQoJCX0pOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoIGNsYXNzTmFtZSApID4gLTEgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0udHlwZSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHNlbGYgPSBqUXVlcnkodGhpcyksIHZhbDsKCgkJCWlmICggdGhpcy5ub2RlVHlwZSAhPT0gMSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJdmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgc2VsZi52YWwoKSApOwoJCQl9IGVsc2UgewoJCQkJdmFsID0gdmFsdWU7CgkJCX0KCgkJCS8vIFRyZWF0IG51bGwvdW5kZWZpbmVkIGFzICIiOyBjb252ZXJ0IG51bWJlcnMgdG8gc3RyaW5nCgkJCWlmICggdmFsID09IG51bGwgKSB7CgkJCQl2YWwgPSAiIjsKCQkJfSBlbHNlIGlmICggdHlwZW9mIHZhbCA9PT0gIm51bWJlciIgKSB7CgkJCQl2YWwgKz0gIiI7CgkJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWwgKSApIHsKCQkJCXZhbCA9IGpRdWVyeS5tYXAodmFsLCBmdW5jdGlvbiAoIHZhbHVlICkgewoJCQkJCXJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSArICIiOwoJCQkJfSk7CgkJCX0KCgkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXSB8fCBqUXVlcnkudmFsSG9va3NbIHRoaXMudHlwZSBdOwoKCQkJLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgaG9va3Muc2V0KCB0aGlzLCB2YWwsICJ2YWx1ZSIgKSA9PT0gdW5kZWZpbmVkICkgewoJCQkJdGhpcy52YWx1ZSA9IHZhbDsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJdmFsSG9va3M6IHsKCQlvcHRpb246IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIGF0dHJpYnV0ZXMudmFsdWUgaXMgdW5kZWZpbmVkIGluIEJsYWNrYmVycnkgNC43IGJ1dAoJCQkJLy8gdXNlcyAudmFsdWUuIFNlZSAjNjkzMgoJCQkJdmFyIHZhbCA9IGVsZW0uYXR0cmlidXRlcy52YWx1ZTsKCQkJCXJldHVybiAhdmFsIHx8IHZhbC5zcGVjaWZpZWQgPyBlbGVtLnZhbHVlIDogZWxlbS50ZXh0OwoJCQl9CgkJfSwKCQlzZWxlY3Q6IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciB2YWx1ZSwgaSwgbWF4LCBvcHRpb24sCgkJCQkJaW5kZXggPSBlbGVtLnNlbGVjdGVkSW5kZXgsCgkJCQkJdmFsdWVzID0gW10sCgkJCQkJb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywKCQkJCQlvbmUgPSBlbGVtLnR5cGUgPT09ICJzZWxlY3Qtb25lIjsKCgkJCQkvLyBOb3RoaW5nIHdhcyBzZWxlY3RlZAoJCQkJaWYgKCBpbmRleCA8IDAgKSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJLy8gTG9vcCB0aHJvdWdoIGFsbCB0aGUgc2VsZWN0ZWQgb3B0aW9ucwoJCQkJaSA9IG9uZSA/IGluZGV4IDogMDsKCQkJCW1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoOwoJCQkJZm9yICggOyBpIDwgbWF4OyBpKysgKSB7CgkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoKCQkJCQkvLyBEb24ndCByZXR1cm4gb3B0aW9ucyB0aGF0IGFyZSBkaXNhYmxlZCBvciBpbiBhIGRpc2FibGVkIG9wdGdyb3VwCgkJCQkJaWYgKCBvcHRpb24uc2VsZWN0ZWQgJiYgKGpRdWVyeS5zdXBwb3J0Lm9wdERpc2FibGVkID8gIW9wdGlvbi5kaXNhYmxlZCA6IG9wdGlvbi5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIikgPT09IG51bGwpICYmCgkJCQkJCQkoIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkpICkgewoKCQkJCQkJLy8gR2V0IHRoZSBzcGVjaWZpYyB2YWx1ZSBmb3IgdGhlIG9wdGlvbgoJCQkJCQl2YWx1ZSA9IGpRdWVyeSggb3B0aW9uICkudmFsKCk7CgoJCQkJCQkvLyBXZSBkb24ndCBuZWVkIGFuIGFycmF5IGZvciBvbmUgc2VsZWN0cwoJCQkJCQlpZiAoIG9uZSApIHsKCQkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQkJfQoKCQkJCQkJLy8gTXVsdGktU2VsZWN0cyByZXR1cm4gYW4gYXJyYXkKCQkJCQkJdmFsdWVzLnB1c2goIHZhbHVlICk7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEZpeGVzIEJ1ZyAjMjU1MSAtLSBzZWxlY3QudmFsKCkgYnJva2VuIGluIElFIGFmdGVyIGZvcm0ucmVzZXQoKQoJCQkJaWYgKCBvbmUgJiYgIXZhbHVlcy5sZW5ndGggJiYgb3B0aW9ucy5sZW5ndGggKSB7CgkJCQkJcmV0dXJuIGpRdWVyeSggb3B0aW9uc1sgaW5kZXggXSApLnZhbCgpOwoJCQkJfQoKCQkJCXJldHVybiB2YWx1ZXM7CgkJCX0sCgoJCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJCXZhciB2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KCB2YWx1ZSApOwoKCQkJCWpRdWVyeShlbGVtKS5maW5kKCJvcHRpb24iKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJCXRoaXMuc2VsZWN0ZWQgPSBqUXVlcnkuaW5BcnJheSggalF1ZXJ5KHRoaXMpLnZhbCgpLCB2YWx1ZXMgKSA+PSAwOwoJCQkJfSk7CgoJCQkJaWYgKCAhdmFsdWVzLmxlbmd0aCApIHsKCQkJCQllbGVtLnNlbGVjdGVkSW5kZXggPSAtMTsKCQkJCX0KCQkJCXJldHVybiB2YWx1ZXM7CgkJCX0KCQl9Cgl9LAoKCWF0dHJGbjogewoJCXZhbDogdHJ1ZSwKCQljc3M6IHRydWUsCgkJaHRtbDogdHJ1ZSwKCQl0ZXh0OiB0cnVlLAoJCWRhdGE6IHRydWUsCgkJd2lkdGg6IHRydWUsCgkJaGVpZ2h0OiB0cnVlLAoJCW9mZnNldDogdHJ1ZQoJfSwKCglhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIHBhc3MgKSB7CgkJdmFyIHJldCwgaG9va3MsIG5vdHhtbCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBwYXNzICYmIG5hbWUgaW4galF1ZXJ5LmF0dHJGbiApIHsKCQkJcmV0dXJuIGpRdWVyeSggZWxlbSApWyBuYW1lIF0oIHZhbHVlICk7CgkJfQoKCQkvLyBGYWxsYmFjayB0byBwcm9wIHdoZW4gYXR0cmlidXRlcyBhcmUgbm90IHN1cHBvcnRlZAoJCWlmICggdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlID09PSAidW5kZWZpbmVkIiApIHsKCQkJcmV0dXJuIGpRdWVyeS5wcm9wKCBlbGVtLCBuYW1lLCB2YWx1ZSApOwoJCX0KCgkJbm90eG1sID0gblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApOwoKCQkvLyBBbGwgYXR0cmlidXRlcyBhcmUgbG93ZXJjYXNlCgkJLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZAoJCWlmICggbm90eG1sICkgewoJCQluYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlob29rcyA9IGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSB8fCAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSA/IGJvb2xIb29rIDogbm9kZUhvb2sgKTsKCQl9CgoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggdmFsdWUgPT09IG51bGwgKSB7CgkJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoJCQkJcmV0dXJuOwoKCQkJfSBlbHNlIGlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgbm90eG1sICYmIChyZXQgPSBob29rcy5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gcmV0OwoKCQkJfSBlbHNlIHsKCQkJCWVsZW0uc2V0QXR0cmlidXRlKCBuYW1lLCAiIiArIHZhbHVlICk7CgkJCQlyZXR1cm4gdmFsdWU7CgkJCX0KCgkJfSBlbHNlIGlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgbm90eG1sICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7CgkJCXJldHVybiByZXQ7CgoJCX0gZWxzZSB7CgoJCQlyZXQgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOwoKCQkJLy8gTm9uLWV4aXN0ZW50IGF0dHJpYnV0ZXMgcmV0dXJuIG51bGwsIHdlIG5vcm1hbGl6ZSB0byB1bmRlZmluZWQKCQkJcmV0dXJuIHJldCA9PT0gbnVsbCA/CgkJCQl1bmRlZmluZWQgOgoJCQkJcmV0OwoJCX0KCX0sCgoJcmVtb3ZlQXR0cjogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCXZhciBwcm9wTmFtZSwgYXR0ck5hbWVzLCBuYW1lLCBsLAoJCQlpID0gMDsKCgkJaWYgKCB2YWx1ZSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQlhdHRyTmFtZXMgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpLnNwbGl0KCByc3BhY2UgKTsKCQkJbCA9IGF0dHJOYW1lcy5sZW5ndGg7CgoJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQluYW1lID0gYXR0ck5hbWVzWyBpIF07CgoJCQkJaWYgKCBuYW1lICkgewoJCQkJCXByb3BOYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoKCQkJCQkvLyBTZWUgIzk2OTkgZm9yIGV4cGxhbmF0aW9uIG9mIHRoaXMgYXBwcm9hY2ggKHNldHRpbmcgZmlyc3QsIHRoZW4gcmVtb3ZhbCkKCQkJCQlqUXVlcnkuYXR0ciggZWxlbSwgbmFtZSwgIiIgKTsKCQkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggZ2V0U2V0QXR0cmlidXRlID8gbmFtZSA6IHByb3BOYW1lICk7CgoJCQkJCS8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlIGZvciBib29sZWFuIGF0dHJpYnV0ZXMKCQkJCQlpZiAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSAmJiBwcm9wTmFtZSBpbiBlbGVtICkgewoJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJLy8gV2UgY2FuJ3QgYWxsb3cgdGhlIHR5cGUgcHJvcGVydHkgdG8gYmUgY2hhbmdlZCAoc2luY2UgaXQgY2F1c2VzIHByb2JsZW1zIGluIElFKQoJCQkJaWYgKCBydHlwZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWpRdWVyeS5lcnJvciggInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIgKTsKCQkJCX0gZWxzZSBpZiAoICFqUXVlcnkuc3VwcG9ydC5yYWRpb1ZhbHVlICYmIHZhbHVlID09PSAicmFkaW8iICYmIGpRdWVyeS5ub2RlTmFtZShlbGVtLCAiaW5wdXQiKSApIHsKCQkJCQkvLyBTZXR0aW5nIHRoZSB0eXBlIG9uIGEgcmFkaW8gYnV0dG9uIGFmdGVyIHRoZSB2YWx1ZSByZXNldHMgdGhlIHZhbHVlIGluIElFNi05CgkJCQkJLy8gUmVzZXQgdmFsdWUgdG8gaXQncyBkZWZhdWx0IGluIGNhc2UgdHlwZSBpcyBzZXQgYWZ0ZXIgdmFsdWUKCQkJCQkvLyBUaGlzIGlzIGZvciBlbGVtZW50IGNyZWF0aW9uCgkJCQkJdmFyIHZhbCA9IGVsZW0udmFsdWU7CgkJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgdmFsdWUgKTsKCQkJCQlpZiAoIHZhbCApIHsKCQkJCQkJZWxlbS52YWx1ZSA9IHZhbDsKCQkJCQl9CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfSwKCQkvLyBVc2UgdGhlIHZhbHVlIHByb3BlcnR5IGZvciBiYWNrIGNvbXBhdAoJCS8vIFVzZSB0aGUgbm9kZUhvb2sgZm9yIGJ1dHRvbiBlbGVtZW50cyBpbiBJRTYvNyAoIzE5NTQpCgkJdmFsdWU6IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJCWlmICggbm9kZUhvb2sgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiYnV0dG9uIiApICkgewoJCQkJCXJldHVybiBub2RlSG9vay5nZXQoIGVsZW0sIG5hbWUgKTsKCQkJCX0KCQkJCXJldHVybiBuYW1lIGluIGVsZW0gPwoJCQkJCWVsZW0udmFsdWUgOgoJCQkJCW51bGw7CgkJCX0sCgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCQkJaWYgKCBub2RlSG9vayAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJidXR0b24iICkgKSB7CgkJCQkJcmV0dXJuIG5vZGVIb29rLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKTsKCQkJCX0KCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0udmFsdWUgPSB2YWx1ZTsKCQkJfQoJCX0KCX0sCgoJcHJvcEZpeDogewoJCXRhYmluZGV4OiAidGFiSW5kZXgiLAoJCXJlYWRvbmx5OiAicmVhZE9ubHkiLAoJCSJmb3IiOiAiaHRtbEZvciIsCgkJImNsYXNzIjogImNsYXNzTmFtZSIsCgkJbWF4bGVuZ3RoOiAibWF4TGVuZ3RoIiwKCQljZWxsc3BhY2luZzogImNlbGxTcGFjaW5nIiwKCQljZWxscGFkZGluZzogImNlbGxQYWRkaW5nIiwKCQlyb3dzcGFuOiAicm93U3BhbiIsCgkJY29sc3BhbjogImNvbFNwYW4iLAoJCXVzZW1hcDogInVzZU1hcCIsCgkJZnJhbWVib3JkZXI6ICJmcmFtZUJvcmRlciIsCgkJY29udGVudGVkaXRhYmxlOiAiY29udGVudEVkaXRhYmxlIgoJfSwKCglwcm9wOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJdmFyIHJldCwgaG9va3MsIG5vdHhtbCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IHByb3BlcnRpZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJbm90eG1sID0gblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApOwoKCQlpZiAoIG5vdHhtbCApIHsKCQkJLy8gRml4IG5hbWUgYW5kIGF0dGFjaCBob29rcwoJCQluYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoJCQlob29rcyA9IGpRdWVyeS5wcm9wSG9va3NbIG5hbWUgXTsKCQl9CgoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJaWYgKCBob29rcyAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gKCBlbGVtWyBuYW1lIF0gPSB2YWx1ZSApOwoJCQl9CgoJCX0gZWxzZSB7CgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgbmFtZSApKSAhPT0gbnVsbCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGVsZW1bIG5hbWUgXTsKCQkJfQoJCX0KCX0sCgoJcHJvcEhvb2tzOiB7CgkJdGFiSW5kZXg6IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIGVsZW0udGFiSW5kZXggZG9lc24ndCBhbHdheXMgcmV0dXJuIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4gaXQgaGFzbid0IGJlZW4gZXhwbGljaXRseSBzZXQKCQkJCS8vIGh0dHA6Ly9mbHVpZHByb2plY3Qub3JnL2Jsb2cvMjAwOC8wMS8wOS9nZXR0aW5nLXNldHRpbmctYW5kLXJlbW92aW5nLXRhYmluZGV4LXZhbHVlcy13aXRoLWphdmFzY3JpcHQvCgkJCQl2YXIgYXR0cmlidXRlTm9kZSA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgidGFiaW5kZXgiKTsKCgkJCQlyZXR1cm4gYXR0cmlidXRlTm9kZSAmJiBhdHRyaWJ1dGVOb2RlLnNwZWNpZmllZCA/CgkJCQkJcGFyc2VJbnQoIGF0dHJpYnV0ZU5vZGUudmFsdWUsIDEwICkgOgoJCQkJCXJmb2N1c2FibGUudGVzdCggZWxlbS5ub2RlTmFtZSApIHx8IHJjbGlja2FibGUudGVzdCggZWxlbS5ub2RlTmFtZSApICYmIGVsZW0uaHJlZiA/CgkJCQkJCTAgOgoJCQkJCQl1bmRlZmluZWQ7CgkJCX0KCQl9Cgl9Cn0pOwoKLy8gQWRkIHRoZSB0YWJJbmRleCBwcm9wSG9vayB0byBhdHRySG9va3MgZm9yIGJhY2stY29tcGF0IChkaWZmZXJlbnQgY2FzZSBpcyBpbnRlbnRpb25hbCkKalF1ZXJ5LmF0dHJIb29rcy50YWJpbmRleCA9IGpRdWVyeS5wcm9wSG9va3MudGFiSW5kZXg7CgovLyBIb29rIGZvciBib29sZWFuIGF0dHJpYnV0ZXMKYm9vbEhvb2sgPSB7CglnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCS8vIEFsaWduIGJvb2xlYW4gYXR0cmlidXRlcyB3aXRoIGNvcnJlc3BvbmRpbmcgcHJvcGVydGllcwoJCS8vIEZhbGwgYmFjayB0byBhdHRyaWJ1dGUgcHJlc2VuY2Ugd2hlcmUgc29tZSBib29sZWFucyBhcmUgbm90IHN1cHBvcnRlZAoJCXZhciBhdHRyTm9kZSwKCQkJcHJvcGVydHkgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApOwoJCXJldHVybiBwcm9wZXJ0eSA9PT0gdHJ1ZSB8fCB0eXBlb2YgcHJvcGVydHkgIT09ICJib29sZWFuIiAmJiAoIGF0dHJOb2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpICkgJiYgYXR0ck5vZGUubm9kZVZhbHVlICE9PSBmYWxzZSA/CgkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCXVuZGVmaW5lZDsKCX0sCglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQl2YXIgcHJvcE5hbWU7CgkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCS8vIFJlbW92ZSBib29sZWFuIGF0dHJpYnV0ZXMgd2hlbiBzZXQgdG8gZmFsc2UKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCQl9IGVsc2UgewoJCQkvLyB2YWx1ZSBpcyB0cnVlIHNpbmNlIHdlIGtub3cgYXQgdGhpcyBwb2ludCBpdCdzIHR5cGUgYm9vbGVhbiBhbmQgbm90IGZhbHNlCgkJCS8vIFNldCBib29sZWFuIGF0dHJpYnV0ZXMgdG8gdGhlIHNhbWUgbmFtZSBhbmQgc2V0IHRoZSBET00gcHJvcGVydHkKCQkJcHJvcE5hbWUgPSBqUXVlcnkucHJvcEZpeFsgbmFtZSBdIHx8IG5hbWU7CgkJCWlmICggcHJvcE5hbWUgaW4gZWxlbSApIHsKCQkJCS8vIE9ubHkgc2V0IHRoZSBJREwgc3BlY2lmaWNhbGx5IGlmIGl0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBlbGVtZW50CgkJCQllbGVtWyBwcm9wTmFtZSBdID0gdHJ1ZTsKCQkJfQoKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUudG9Mb3dlckNhc2UoKSApOwoJCX0KCQlyZXR1cm4gbmFtZTsKCX0KfTsKCi8vIElFNi83IGRvIG5vdCBzdXBwb3J0IGdldHRpbmcvc2V0dGluZyBzb21lIGF0dHJpYnV0ZXMgd2l0aCBnZXQvc2V0QXR0cmlidXRlCmlmICggIWdldFNldEF0dHJpYnV0ZSApIHsKCglmaXhTcGVjaWZpZWQgPSB7CgkJbmFtZTogdHJ1ZSwKCQlpZDogdHJ1ZQoJfTsKCgkvLyBVc2UgdGhpcyBmb3IgYW55IGF0dHJpYnV0ZSBpbiBJRTYvNwoJLy8gVGhpcyBmaXhlcyBhbG1vc3QgZXZlcnkgSUU2LzcgaXNzdWUKCW5vZGVIb29rID0galF1ZXJ5LnZhbEhvb2tzLmJ1dHRvbiA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCQl2YXIgcmV0OwoJCQlyZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJcmV0dXJuIHJldCAmJiAoIGZpeFNwZWNpZmllZFsgbmFtZSBdID8gcmV0Lm5vZGVWYWx1ZSAhPT0gIiIgOiByZXQuc3BlY2lmaWVkICkgPwoJCQkJcmV0Lm5vZGVWYWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGUKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlpZiAoICFyZXQgKSB7CgkJCQlyZXQgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKTsKCQkJCWVsZW0uc2V0QXR0cmlidXRlTm9kZSggcmV0ICk7CgkJCX0KCQkJcmV0dXJuICggcmV0Lm5vZGVWYWx1ZSA9IHZhbHVlICsgIiIgKTsKCQl9Cgl9OwoKCS8vIEFwcGx5IHRoZSBub2RlSG9vayB0byB0YWJpbmRleAoJalF1ZXJ5LmF0dHJIb29rcy50YWJpbmRleC5zZXQgPSBub2RlSG9vay5zZXQ7CgoJLy8gU2V0IHdpZHRoIGFuZCBoZWlnaHQgdG8gYXV0byBpbnN0ZWFkIG9mIDAgb24gZW1wdHkgc3RyaW5nKCBCdWcgIzgxNTAgKQoJLy8gVGhpcyBpcyBmb3IgcmVtb3ZhbHMKCWpRdWVyeS5lYWNoKFsgIndpZHRoIiwgImhlaWdodCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LmF0dHJIb29rc1sgbmFtZSBdLCB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCB2YWx1ZSA9PT0gIiIgKSB7CgkJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsICJhdXRvIiApOwoJCQkJCXJldHVybiB2YWx1ZTsKCQkJCX0KCQkJfQoJCX0pOwoJfSk7CgoJLy8gU2V0IGNvbnRlbnRlZGl0YWJsZSB0byBmYWxzZSBvbiByZW1vdmFscygjMTA0MjkpCgkvLyBTZXR0aW5nIHRvIGVtcHR5IHN0cmluZyB0aHJvd3MgYW4gZXJyb3IgYXMgYW4gaW52YWxpZCB2YWx1ZQoJalF1ZXJ5LmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGUgPSB7CgkJZ2V0OiBub2RlSG9vay5nZXQsCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIG5hbWUgKSB7CgkJCWlmICggdmFsdWUgPT09ICIiICkgewoJCQkJdmFsdWUgPSAiZmFsc2UiOwoJCQl9CgkJCW5vZGVIb29rLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKTsKCQl9Cgl9Owp9CgoKLy8gU29tZSBhdHRyaWJ1dGVzIHJlcXVpcmUgYSBzcGVjaWFsIGNhbGwgb24gSUUKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7CglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIsICJ3aWR0aCIsICJoZWlnaHQiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwgewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCAyICk7CgkJCQlyZXR1cm4gcmV0ID09PSBudWxsID8gdW5kZWZpbmVkIDogcmV0OwoJCQl9CgkJfSk7Cgl9KTsKfQoKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc3R5bGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnN0eWxlID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCS8vIFJldHVybiB1bmRlZmluZWQgaW4gdGhlIGNhc2Ugb2YgZW1wdHkgc3RyaW5nCgkJCS8vIE5vcm1hbGl6ZSB0byBsb3dlcmNhc2Ugc2luY2UgSUUgdXBwZXJjYXNlcyBjc3MgcHJvcGVydHkgbmFtZXMKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dC50b0xvd2VyQ2FzZSgpIHx8IHVuZGVmaW5lZDsKCQl9LAoJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQlyZXR1cm4gKCBlbGVtLnN0eWxlLmNzc1RleHQgPSAiIiArIHZhbHVlICk7CgkJfQoJfTsKfQoKLy8gU2FmYXJpIG1pcy1yZXBvcnRzIHRoZSBkZWZhdWx0IHNlbGVjdGVkIHByb3BlcnR5IG9mIGFuIG9wdGlvbgovLyBBY2Nlc3NpbmcgdGhlIHBhcmVudCdzIHNlbGVjdGVkSW5kZXggcHJvcGVydHkgZml4ZXMgaXQKaWYgKCAhalF1ZXJ5LnN1cHBvcnQub3B0U2VsZWN0ZWQgKSB7CglqUXVlcnkucHJvcEhvb2tzLnNlbGVjdGVkID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCwgewoJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgoJCQlpZiAoIHBhcmVudCApIHsKCQkJCXBhcmVudC5zZWxlY3RlZEluZGV4OwoKCQkJCS8vIE1ha2Ugc3VyZSB0aGF0IGl0IGFsc28gd29ya3Mgd2l0aCBvcHRncm91cHMsIHNlZSAjNTcwMQoJCQkJaWYgKCBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCQlwYXJlbnQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQkJfQoJCQl9CgkJCXJldHVybiBudWxsOwoJCX0KCX0pOwp9CgovLyBJRTYvNyBjYWxsIGVuY3R5cGUgZW5jb2RpbmcKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuZW5jdHlwZSApIHsKCWpRdWVyeS5wcm9wRml4LmVuY3R5cGUgPSAiZW5jb2RpbmciOwp9CgovLyBSYWRpb3MgYW5kIGNoZWNrYm94ZXMgZ2V0dGVyL3NldHRlcgppZiAoICFqUXVlcnkuc3VwcG9ydC5jaGVja09uICkgewoJalF1ZXJ5LmVhY2goWyAicmFkaW8iLCAiY2hlY2tib3giIF0sIGZ1bmN0aW9uKCkgewoJCWpRdWVyeS52YWxIb29rc1sgdGhpcyBdID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIGluIFdlYmtpdCAiIiBpcyByZXR1cm5lZCBpbnN0ZWFkIG9mICJvbiIgaWYgYSB2YWx1ZSBpc24ndCBzcGVjaWZpZWQKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidmFsdWUiKSA9PT0gbnVsbCA/ICJvbiIgOiBlbGVtLnZhbHVlOwoJCQl9CgkJfTsKCX0pOwp9CmpRdWVyeS5lYWNoKFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCWpRdWVyeS52YWxIb29rc1sgdGhpcyBdID0galF1ZXJ5LmV4dGVuZCggalF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0sIHsKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJCXJldHVybiAoIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkoZWxlbSkudmFsKCksIHZhbHVlICkgPj0gMCApOwoJCQl9CgkJfQoJfSk7Cn0pOwoKCgoKdmFyIHJmb3JtRWxlbXMgPSAvXig/OnRleHRhcmVhfGlucHV0fHNlbGVjdCkkL2ksCglydHlwZW5hbWVzcGFjZSA9IC9eKFteXC5dKik/KD86XC4oLispKT8kLywKCXJob3ZlckhhY2sgPSAvXGJob3ZlcihcLlxTKyk/XGIvLAoJcmtleUV2ZW50ID0gL15rZXkvLAoJcm1vdXNlRXZlbnQgPSAvXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sCglyZm9jdXNNb3JwaCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywKCXJxdWlja0lzID0gL14oXHcqKSg/OiMoW1x3XC1dKykpPyg/OlwuKFtcd1wtXSspKT8kLywKCXF1aWNrUGFyc2UgPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJdmFyIHF1aWNrID0gcnF1aWNrSXMuZXhlYyggc2VsZWN0b3IgKTsKCQlpZiAoIHF1aWNrICkgewoJCQkvLyAgIDAgIDEgICAgMiAgIDMKCQkJLy8gWyBfLCB0YWcsIGlkLCBjbGFzcyBdCgkJCXF1aWNrWzFdID0gKCBxdWlja1sxXSB8fCAiIiApLnRvTG93ZXJDYXNlKCk7CgkJCXF1aWNrWzNdID0gcXVpY2tbM10gJiYgbmV3IFJlZ0V4cCggIig/Ol58XFxzKSIgKyBxdWlja1szXSArICIoPzpcXHN8JCkiICk7CgkJfQoJCXJldHVybiBxdWljazsKCX0sCglxdWlja0lzID0gZnVuY3Rpb24oIGVsZW0sIG0gKSB7CgkJdmFyIGF0dHJzID0gZWxlbS5hdHRyaWJ1dGVzIHx8IHt9OwoJCXJldHVybiAoCgkJCSghbVsxXSB8fCBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1bMV0pICYmCgkJCSghbVsyXSB8fCAoYXR0cnMuaWQgfHwge30pLnZhbHVlID09PSBtWzJdKSAmJgoJCQkoIW1bM10gfHwgbVszXS50ZXN0KCAoYXR0cnNbICJjbGFzcyIgXSB8fCB7fSkudmFsdWUgKSkKCQkpOwoJfSwKCWhvdmVySGFjayA9IGZ1bmN0aW9uKCBldmVudHMgKSB7CgkJcmV0dXJuIGpRdWVyeS5ldmVudC5zcGVjaWFsLmhvdmVyID8gZXZlbnRzIDogZXZlbnRzLnJlcGxhY2UoIHJob3ZlckhhY2ssICJtb3VzZWVudGVyJDEgbW91c2VsZWF2ZSQxIiApOwoJfTsKCi8qCiAqIEhlbHBlciBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIGV2ZW50cyAtLSBub3QgcGFydCBvZiB0aGUgcHVibGljIGludGVyZmFjZS4KICogUHJvcHMgdG8gRGVhbiBFZHdhcmRzJyBhZGRFdmVudCBsaWJyYXJ5IGZvciBtYW55IG9mIHRoZSBpZGVhcy4KICovCmpRdWVyeS5ldmVudCA9IHsKCglhZGQ6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgZGF0YSwgc2VsZWN0b3IgKSB7CgoJCXZhciBlbGVtRGF0YSwgZXZlbnRIYW5kbGUsIGV2ZW50cywKCQkJdCwgdG5zLCB0eXBlLCBuYW1lc3BhY2VzLCBoYW5kbGVPYmosCgkJCWhhbmRsZU9iakluLCBxdWljaywgaGFuZGxlcnMsIHNwZWNpYWw7CgoJCS8vIERvbid0IGF0dGFjaCBldmVudHMgdG8gbm9EYXRhIG9yIHRleHQvY29tbWVudCBub2RlcyAoYWxsb3cgcGxhaW4gb2JqZWN0cyB0aG8pCgkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDggfHwgIXR5cGVzIHx8ICFoYW5kbGVyIHx8ICEoZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKSkgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIENhbGxlciBjYW4gcGFzcyBpbiBhbiBvYmplY3Qgb2YgY3VzdG9tIGRhdGEgaW4gbGlldSBvZiB0aGUgaGFuZGxlcgoJCWlmICggaGFuZGxlci5oYW5kbGVyICkgewoJCQloYW5kbGVPYmpJbiA9IGhhbmRsZXI7CgkJCWhhbmRsZXIgPSBoYW5kbGVPYmpJbi5oYW5kbGVyOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGhhbmRsZXIgaGFzIGEgdW5pcXVlIElELCB1c2VkIHRvIGZpbmQvcmVtb3ZlIGl0IGxhdGVyCgkJaWYgKCAhaGFuZGxlci5ndWlkICkgewoJCQloYW5kbGVyLmd1aWQgPSBqUXVlcnkuZ3VpZCsrOwoJCX0KCgkJLy8gSW5pdCB0aGUgZWxlbWVudCdzIGV2ZW50IHN0cnVjdHVyZSBhbmQgbWFpbiBoYW5kbGVyLCBpZiB0aGlzIGlzIHRoZSBmaXJzdAoJCWV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50czsKCQlpZiAoICFldmVudHMgKSB7CgkJCWVsZW1EYXRhLmV2ZW50cyA9IGV2ZW50cyA9IHt9OwoJCX0KCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZTsKCQlpZiAoICFldmVudEhhbmRsZSApIHsKCQkJZWxlbURhdGEuaGFuZGxlID0gZXZlbnRIYW5kbGUgPSBmdW5jdGlvbiggZSApIHsKCQkJCS8vIERpc2NhcmQgdGhlIHNlY29uZCBldmVudCBvZiBhIGpRdWVyeS5ldmVudC50cmlnZ2VyKCkgYW5kCgkJCQkvLyB3aGVuIGFuIGV2ZW50IGlzIGNhbGxlZCBhZnRlciBhIHBhZ2UgaGFzIHVubG9hZGVkCgkJCQlyZXR1cm4gdHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIgJiYgKCFlIHx8IGpRdWVyeS5ldmVudC50cmlnZ2VyZWQgIT09IGUudHlwZSkgPwoJCQkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZXZlbnRIYW5kbGUuZWxlbSwgYXJndW1lbnRzICkgOgoJCQkJCXVuZGVmaW5lZDsKCQkJfTsKCQkJLy8gQWRkIGVsZW0gYXMgYSBwcm9wZXJ0eSBvZiB0aGUgaGFuZGxlIGZuIHRvIHByZXZlbnQgYSBtZW1vcnkgbGVhayB3aXRoIElFIG5vbi1uYXRpdmUgZXZlbnRzCgkJCWV2ZW50SGFuZGxlLmVsZW0gPSBlbGVtOwoJCX0KCgkJLy8gSGFuZGxlIG11bHRpcGxlIGV2ZW50cyBzZXBhcmF0ZWQgYnkgYSBzcGFjZQoJCS8vIGpRdWVyeSguLi4pLmJpbmQoIm1vdXNlb3ZlciBtb3VzZW91dCIsIGZuKTsKCQl0eXBlcyA9IGpRdWVyeS50cmltKCBob3ZlckhhY2sodHlwZXMpICkuc3BsaXQoICIgIiApOwoJCWZvciAoIHQgPSAwOyB0IDwgdHlwZXMubGVuZ3RoOyB0KysgKSB7CgoJCQl0bnMgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gdG5zWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bnNbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoKCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCgkJCS8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoJCQloYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogdG5zWzFdLAoJCQkJZGF0YTogZGF0YSwKCQkJCWhhbmRsZXI6IGhhbmRsZXIsCgkJCQlndWlkOiBoYW5kbGVyLmd1aWQsCgkJCQlzZWxlY3Rvcjogc2VsZWN0b3IsCgkJCQlxdWljazogcXVpY2tQYXJzZSggc2VsZWN0b3IgKSwKCQkJCW5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKCIuIikKCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCS8vIEluaXQgdGhlIGV2ZW50IGhhbmRsZXIgcXVldWUgaWYgd2UncmUgdGhlIGZpcnN0CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF07CgkJCWlmICggIWhhbmRsZXJzICkgewoJCQkJaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSA9IFtdOwoJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudCA9IDA7CgoJCQkJLy8gT25seSB1c2UgYWRkRXZlbnRMaXN0ZW5lci9hdHRhY2hFdmVudCBpZiB0aGUgc3BlY2lhbCBldmVudHMgaGFuZGxlciByZXR1cm5zIGZhbHNlCgkJCQlpZiAoICFzcGVjaWFsLnNldHVwIHx8IHNwZWNpYWwuc2V0dXAuY2FsbCggZWxlbSwgZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgkJCQkJLy8gQmluZCB0aGUgZ2xvYmFsIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGVsZW1lbnQKCQkJCQlpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsKCQkJCQkJZWxlbS5hZGRFdmVudExpc3RlbmVyKCB0eXBlLCBldmVudEhhbmRsZSwgZmFsc2UgKTsKCgkJCQkJfSBlbHNlIGlmICggZWxlbS5hdHRhY2hFdmVudCApIHsKCQkJCQkJZWxlbS5hdHRhY2hFdmVudCggIm9uIiArIHR5cGUsIGV2ZW50SGFuZGxlICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlpZiAoIHNwZWNpYWwuYWRkICkgewoJCQkJc3BlY2lhbC5hZGQuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7CgoJCQkJaWYgKCAhaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCApIHsKCQkJCQloYW5kbGVPYmouaGFuZGxlci5ndWlkID0gaGFuZGxlci5ndWlkOwoJCQkJfQoJCQl9CgoJCQkvLyBBZGQgdG8gdGhlIGVsZW1lbnQncyBoYW5kbGVyIGxpc3QsIGRlbGVnYXRlcyBpbiBmcm9udAoJCQlpZiAoIHNlbGVjdG9yICkgewoJCQkJaGFuZGxlcnMuc3BsaWNlKCBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaiApOwoJCQl9IGVsc2UgewoJCQkJaGFuZGxlcnMucHVzaCggaGFuZGxlT2JqICk7CgkJCX0KCgkJCS8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgZXZlciBiZWVuIHVzZWQsIGZvciBldmVudCBvcHRpbWl6YXRpb24KCQkJalF1ZXJ5LmV2ZW50Lmdsb2JhbFsgdHlwZSBdID0gdHJ1ZTsKCQl9CgoJCS8vIE51bGxpZnkgZWxlbSB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcyBpbiBJRQoJCWVsZW0gPSBudWxsOwoJfSwKCglnbG9iYWw6IHt9LAoKCS8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAoJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCgkJdmFyIGVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoIGVsZW0gKSAmJiBqUXVlcnkuX2RhdGEoIGVsZW0gKSwKCQkJdCwgdG5zLCB0eXBlLCBvcmlnVHlwZSwgbmFtZXNwYWNlcywgb3JpZ0NvdW50LAoJCQlqLCBldmVudHMsIHNwZWNpYWwsIGhhbmRsZSwgZXZlbnRUeXBlLCBoYW5kbGVPYmo7CgoJCWlmICggIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAoJCXR5cGVzID0galF1ZXJ5LnRyaW0oIGhvdmVySGFjayggdHlwZXMgfHwgIiIgKSApLnNwbGl0KCIgIik7CgkJZm9yICggdCA9IDA7IHQgPCB0eXBlcy5sZW5ndGg7IHQrKyApIHsKCQkJdG5zID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG5zWzFdOwoJCQluYW1lc3BhY2VzID0gdG5zWzJdOwoKCQkJLy8gVW5iaW5kIGFsbCBldmVudHMgKG9uIHRoaXMgbmFtZXNwYWNlLCBpZiBwcm92aWRlZCkgZm9yIHRoZSBlbGVtZW50CgkJCWlmICggIXR5cGUgKSB7CgkJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICsgdHlwZXNbIHQgXSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUgKTsKCQkJCX0KCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJdHlwZSA9ICggc2VsZWN0b3I/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWV2ZW50VHlwZSA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdOwoJCQlvcmlnQ291bnQgPSBldmVudFR5cGUubGVuZ3RoOwoJCQluYW1lc3BhY2VzID0gbmFtZXNwYWNlcyA/IG5ldyBSZWdFeHAoIihefFxcLikiICsgbmFtZXNwYWNlcy5zcGxpdCgiLiIpLnNvcnQoKS5qb2luKCJcXC4oPzouKlxcLik/IikgKyAiKFxcLnwkKSIpIDogbnVsbDsKCgkJCS8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMKCQkJZm9yICggaiA9IDA7IGogPCBldmVudFR5cGUubGVuZ3RoOyBqKysgKSB7CgkJCQloYW5kbGVPYmogPSBldmVudFR5cGVbIGogXTsKCgkJCQlpZiAoICggbWFwcGVkVHlwZXMgfHwgb3JpZ1R5cGUgPT09IGhhbmRsZU9iai5vcmlnVHlwZSApICYmCgkJCQkJICggIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCApICYmCgkJCQkJICggIW5hbWVzcGFjZXMgfHwgbmFtZXNwYWNlcy50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSAmJgoJCQkJCSAoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgewoJCQkJCWV2ZW50VHlwZS5zcGxpY2UoIGotLSwgMSApOwoKCQkJCQlpZiAoIGhhbmRsZU9iai5zZWxlY3RvciApIHsKCQkJCQkJZXZlbnRUeXBlLmRlbGVnYXRlQ291bnQtLTsKCQkJCQl9CgkJCQkJaWYgKCBzcGVjaWFsLnJlbW92ZSApIHsKCQkJCQkJc3BlY2lhbC5yZW1vdmUuY2FsbCggZWxlbSwgaGFuZGxlT2JqICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBSZW1vdmUgZ2VuZXJpYyBldmVudCBoYW5kbGVyIGlmIHdlIHJlbW92ZWQgc29tZXRoaW5nIGFuZCBubyBtb3JlIGhhbmRsZXJzIGV4aXN0CgkJCS8vIChhdm9pZHMgcG90ZW50aWFsIGZvciBlbmRsZXNzIHJlY3Vyc2lvbiBkdXJpbmcgcmVtb3ZhbCBvZiBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzKQoJCQlpZiAoIGV2ZW50VHlwZS5sZW5ndGggPT09IDAgJiYgb3JpZ0NvdW50ICE9PSBldmVudFR5cGUubGVuZ3RoICkgewoJCQkJaWYgKCAhc3BlY2lhbC50ZWFyZG93biB8fCBzcGVjaWFsLnRlYXJkb3duLmNhbGwoIGVsZW0sIG5hbWVzcGFjZXMgKSA9PT0gZmFsc2UgKSB7CgkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUgKTsKCQkJCX0KCgkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCX0KCQl9CgoJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggZXZlbnRzICkgKSB7CgkJCWhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZTsKCQkJaWYgKCBoYW5kbGUgKSB7CgkJCQloYW5kbGUuZWxlbSA9IG51bGw7CgkJCX0KCgkJCS8vIHJlbW92ZURhdGEgYWxzbyBjaGVja3MgZm9yIGVtcHRpbmVzcyBhbmQgY2xlYXJzIHRoZSBleHBhbmRvIGlmIGVtcHR5CgkJCS8vIHNvIHVzZSBpdCBpbnN0ZWFkIG9mIGRlbGV0ZQoJCQlqUXVlcnkucmVtb3ZlRGF0YSggZWxlbSwgWyAiZXZlbnRzIiwgImhhbmRsZSIgXSwgdHJ1ZSApOwoJCX0KCX0sCgoJLy8gRXZlbnRzIHRoYXQgYXJlIHNhZmUgdG8gc2hvcnQtY2lyY3VpdCBpZiBubyBoYW5kbGVycyBhcmUgYXR0YWNoZWQuCgkvLyBOYXRpdmUgRE9NIGV2ZW50cyBzaG91bGQgbm90IGJlIGFkZGVkLCB0aGV5IG1heSBoYXZlIGlubGluZSBoYW5kbGVycy4KCWN1c3RvbUV2ZW50OiB7CgkJImdldERhdGEiOiB0cnVlLAoJCSJzZXREYXRhIjogdHJ1ZSwKCQkiY2hhbmdlRGF0YSI6IHRydWUKCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgkJLy8gRG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoIGVsZW0gJiYgKGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCkgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIEV2ZW50IG9iamVjdCBvciBldmVudCB0eXBlCgkJdmFyIHR5cGUgPSBldmVudC50eXBlIHx8IGV2ZW50LAoJCQluYW1lc3BhY2VzID0gW10sCgkJCWNhY2hlLCBleGNsdXNpdmUsIGksIGN1ciwgb2xkLCBvbnR5cGUsIHNwZWNpYWwsIGhhbmRsZSwgZXZlbnRQYXRoLCBidWJibGVUeXBlOwoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCAiISIgKSA+PSAwICkgewoJCQkvLyBFeGNsdXNpdmUgZXZlbnRzIHRyaWdnZXIgb25seSBmb3IgdGhlIGV4YWN0IGV2ZW50IChubyBuYW1lc3BhY2VzKQoJCQl0eXBlID0gdHlwZS5zbGljZSgwLCAtMSk7CgkJCWV4Y2x1c2l2ZSA9IHRydWU7CgkJfQoKCQlpZiAoIHR5cGUuaW5kZXhPZiggIi4iICkgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgoJCWlmICggKCFlbGVtIHx8IGpRdWVyeS5ldmVudC5jdXN0b21FdmVudFsgdHlwZSBdKSAmJiAhalF1ZXJ5LmV2ZW50Lmdsb2JhbFsgdHlwZSBdICkgewoJCQkvLyBObyBqUXVlcnkgaGFuZGxlcnMgZm9yIHRoaXMgZXZlbnQgdHlwZSwgYW5kIGl0IGNhbid0IGhhdmUgaW5saW5lIGhhbmRsZXJzCgkJCXJldHVybjsKCQl9CgoJCS8vIENhbGxlciBjYW4gcGFzcyBpbiBhbiBFdmVudCwgT2JqZWN0LCBvciBqdXN0IGFuIGV2ZW50IHR5cGUgc3RyaW5nCgkJZXZlbnQgPSB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiID8KCQkJLy8galF1ZXJ5LkV2ZW50IG9iamVjdAoJCQlldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSA/IGV2ZW50IDoKCQkJLy8gT2JqZWN0IGxpdGVyYWwKCQkJbmV3IGpRdWVyeS5FdmVudCggdHlwZSwgZXZlbnQgKSA6CgkJCS8vIEp1c3QgdGhlIGV2ZW50IHR5cGUgKHN0cmluZykKCQkJbmV3IGpRdWVyeS5FdmVudCggdHlwZSApOwoKCQlldmVudC50eXBlID0gdHlwZTsKCQlldmVudC5pc1RyaWdnZXIgPSB0cnVlOwoJCWV2ZW50LmV4Y2x1c2l2ZSA9IGV4Y2x1c2l2ZTsKCQlldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oICIuIiApOwoJCWV2ZW50Lm5hbWVzcGFjZV9yZSA9IGV2ZW50Lm5hbWVzcGFjZT8gbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSArICIoXFwufCQpIikgOiBudWxsOwoJCW9udHlwZSA9IHR5cGUuaW5kZXhPZiggIjoiICkgPCAwID8gIm9uIiArIHR5cGUgOiAiIjsKCgkJLy8gSGFuZGxlIGEgZ2xvYmFsIHRyaWdnZXIKCQlpZiAoICFlbGVtICkgewoKCQkJLy8gVE9ETzogU3RvcCB0YXVudGluZyB0aGUgZGF0YSBjYWNoZTsgcmVtb3ZlIGdsb2JhbCBldmVudHMgYW5kIGFsd2F5cyBhdHRhY2ggdG8gZG9jdW1lbnQKCQkJY2FjaGUgPSBqUXVlcnkuY2FjaGU7CgkJCWZvciAoIGkgaW4gY2FjaGUgKSB7CgkJCQlpZiAoIGNhY2hlWyBpIF0uZXZlbnRzICYmIGNhY2hlWyBpIF0uZXZlbnRzWyB0eXBlIF0gKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGV2ZW50LCBkYXRhLCBjYWNoZVsgaSBdLmhhbmRsZS5lbGVtLCB0cnVlICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2xlYW4gdXAgdGhlIGV2ZW50IGluIGNhc2UgaXQgaXMgYmVpbmcgcmV1c2VkCgkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gZWxlbTsKCQl9CgoJCS8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3QKCQlkYXRhID0gZGF0YSAhPSBudWxsID8galF1ZXJ5Lm1ha2VBcnJheSggZGF0YSApIDogW107CgkJZGF0YS51bnNoaWZ0KCBldmVudCApOwoKCQkvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgkJaWYgKCBzcGVjaWFsLnRyaWdnZXIgJiYgc3BlY2lhbC50cmlnZ2VyLmFwcGx5KCBlbGVtLCBkYXRhICkgPT09IGZhbHNlICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBEZXRlcm1pbmUgZXZlbnQgcHJvcGFnYXRpb24gcGF0aCBpbiBhZHZhbmNlLCBwZXIgVzNDIGV2ZW50cyBzcGVjICgjOTk1MSkKCQkvLyBCdWJibGUgdXAgdG8gZG9jdW1lbnQsIHRoZW4gdG8gd2luZG93OyB3YXRjaCBmb3IgYSBnbG9iYWwgb3duZXJEb2N1bWVudCB2YXIgKCM5NzI0KQoJCWV2ZW50UGF0aCA9IFtbIGVsZW0sIHNwZWNpYWwuYmluZFR5cGUgfHwgdHlwZSBdXTsKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgkJCWN1ciA9IHJmb2N1c01vcnBoLnRlc3QoIGJ1YmJsZVR5cGUgKyB0eXBlICkgPyBlbGVtIDogZWxlbS5wYXJlbnROb2RlOwoJCQlvbGQgPSBudWxsOwoJCQlmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgkJCQlldmVudFBhdGgucHVzaChbIGN1ciwgYnViYmxlVHlwZSBdKTsKCQkJCW9sZCA9IGN1cjsKCQkJfQoKCQkJLy8gT25seSBhZGQgd2luZG93IGlmIHdlIGdvdCB0byBkb2N1bWVudCAoZS5nLiwgbm90IHBsYWluIG9iaiBvciBkZXRhY2hlZCBET00pCgkJCWlmICggb2xkICYmIG9sZCA9PT0gZWxlbS5vd25lckRvY3VtZW50ICkgewoJCQkJZXZlbnRQYXRoLnB1c2goWyBvbGQuZGVmYXVsdFZpZXcgfHwgb2xkLnBhcmVudFdpbmRvdyB8fCB3aW5kb3csIGJ1YmJsZVR5cGUgXSk7CgkJCX0KCQl9CgoJCS8vIEZpcmUgaGFuZGxlcnMgb24gdGhlIGV2ZW50IHBhdGgKCQlmb3IgKCBpID0gMDsgaSA8IGV2ZW50UGF0aC5sZW5ndGggJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCk7IGkrKyApIHsKCgkJCWN1ciA9IGV2ZW50UGF0aFtpXVswXTsKCQkJZXZlbnQudHlwZSA9IGV2ZW50UGF0aFtpXVsxXTsKCgkJCWhhbmRsZSA9ICggalF1ZXJ5Ll9kYXRhKCBjdXIsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdICYmIGpRdWVyeS5fZGF0YSggY3VyLCAiaGFuZGxlIiApOwoJCQlpZiAoIGhhbmRsZSApIHsKCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCX0KCQkJLy8gTm90ZSB0aGF0IHRoaXMgaXMgYSBiYXJlIEpTIGZ1bmN0aW9uIGFuZCBub3QgYSBqUXVlcnkgaGFuZGxlcgoJCQloYW5kbGUgPSBvbnR5cGUgJiYgY3VyWyBvbnR5cGUgXTsKCQkJaWYgKCBoYW5kbGUgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGN1ciApICYmIGhhbmRsZS5hcHBseSggY3VyLCBkYXRhICkgPT09IGZhbHNlICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfQoJCX0KCQlldmVudC50eXBlID0gdHlwZTsKCgkJLy8gSWYgbm9ib2R5IHByZXZlbnRlZCB0aGUgZGVmYXVsdCBhY3Rpb24sIGRvIGl0IG5vdwoJCWlmICggIW9ubHlIYW5kbGVycyAmJiAhZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgoJCQlpZiAoICghc3BlY2lhbC5fZGVmYXVsdCB8fCBzcGVjaWFsLl9kZWZhdWx0LmFwcGx5KCBlbGVtLm93bmVyRG9jdW1lbnQsIGRhdGEgKSA9PT0gZmFsc2UpICYmCgkJCQkhKHR5cGUgPT09ICJjbGljayIgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiYSIgKSkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQkvLyBDYWxsIGEgbmF0aXZlIERPTSBtZXRob2Qgb24gdGhlIHRhcmdldCB3aXRoIHRoZSBzYW1lIG5hbWUgbmFtZSBhcyB0aGUgZXZlbnQuCgkJCQkvLyBDYW4ndCB1c2UgYW4gLmlzRnVuY3Rpb24oKSBjaGVjayBoZXJlIGJlY2F1c2UgSUU2LzcgZmFpbHMgdGhhdCB0ZXN0LgoJCQkJLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQoJCQkJLy8gSUU8OSBkaWVzIG9uIGZvY3VzL2JsdXIgdG8gaGlkZGVuIGVsZW1lbnQgKCMxNDg2KQoJCQkJaWYgKCBvbnR5cGUgJiYgZWxlbVsgdHlwZSBdICYmICgodHlwZSAhPT0gImZvY3VzIiAmJiB0eXBlICE9PSAiYmx1ciIpIHx8IGV2ZW50LnRhcmdldC5vZmZzZXRXaWR0aCAhPT0gMCkgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCgkJCQkJb2xkID0gZWxlbVsgb250eXBlIF07CgoJCQkJCWlmICggb2xkICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG51bGw7CgkJCQkJfQoKCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwoJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggb2xkICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG9sZDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgfHwgd2luZG93LmV2ZW50ICk7CgoJCXZhciBoYW5kbGVycyA9ICggKGpRdWVyeS5fZGF0YSggdGhpcywgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gfHwgW10pLAoJCQlkZWxlZ2F0ZUNvdW50ID0gaGFuZGxlcnMuZGVsZWdhdGVDb3VudCwKCQkJYXJncyA9IFtdLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMCApLAoJCQlydW5fYWxsID0gIWV2ZW50LmV4Y2x1c2l2ZSAmJiAhZXZlbnQubmFtZXNwYWNlLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJaSwgaiwgY3VyLCBqcWN1ciwgcmV0LCBzZWxNYXRjaCwgbWF0Y2hlZCwgbWF0Y2hlcywgaGFuZGxlT2JqLCBzZWwsIHJlbGF0ZWQ7CgoJCS8vIFVzZSB0aGUgZml4LWVkIGpRdWVyeS5FdmVudCByYXRoZXIgdGhhbiB0aGUgKHJlYWQtb25seSkgbmF0aXZlIGV2ZW50CgkJYXJnc1swXSA9IGV2ZW50OwoJCWV2ZW50LmRlbGVnYXRlVGFyZ2V0ID0gdGhpczsKCgkJLy8gRGV0ZXJtaW5lIGhhbmRsZXJzIHRoYXQgc2hvdWxkIHJ1biBpZiB0aGVyZSBhcmUgZGVsZWdhdGVkIGV2ZW50cwoJCS8vIEF2b2lkIGRpc2FibGVkIGVsZW1lbnRzIGluIElFICgjNjkxMSkgYW5kIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiAhZXZlbnQudGFyZ2V0LmRpc2FibGVkICYmICEoZXZlbnQuYnV0dG9uICYmIGV2ZW50LnR5cGUgPT09ICJjbGljayIpICkgewoKCQkJLy8gUHJlZ2VuZXJhdGUgYSBzaW5nbGUgalF1ZXJ5IG9iamVjdCBmb3IgcmV1c2Ugd2l0aCAuaXMoKQoJCQlqcWN1ciA9IGpRdWVyeSh0aGlzKTsKCQkJanFjdXIuY29udGV4dCA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzOwoKCQkJZm9yICggY3VyID0gZXZlbnQudGFyZ2V0OyBjdXIgIT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHsKCQkJCXNlbE1hdGNoID0ge307CgkJCQltYXRjaGVzID0gW107CgkJCQlqcWN1clswXSA9IGN1cjsKCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBpIF07CgkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yOwoKCQkJCQlpZiAoIHNlbE1hdGNoWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkgewoJCQkJCQlzZWxNYXRjaFsgc2VsIF0gPSAoCgkJCQkJCQloYW5kbGVPYmoucXVpY2sgPyBxdWlja0lzKCBjdXIsIGhhbmRsZU9iai5xdWljayApIDoganFjdXIuaXMoIHNlbCApCgkJCQkJCSk7CgkJCQkJfQoJCQkJCWlmICggc2VsTWF0Y2hbIHNlbCBdICkgewoJCQkJCQltYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApOwoJCQkJCX0KCQkJCX0KCQkJCWlmICggbWF0Y2hlcy5sZW5ndGggKSB7CgkJCQkJaGFuZGxlclF1ZXVlLnB1c2goeyBlbGVtOiBjdXIsIG1hdGNoZXM6IG1hdGNoZXMgfSk7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEFkZCB0aGUgcmVtYWluaW5nIChkaXJlY3RseS1ib3VuZCkgaGFuZGxlcnMKCQlpZiAoIGhhbmRsZXJzLmxlbmd0aCA+IGRlbGVnYXRlQ291bnQgKSB7CgkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogdGhpcywgbWF0Y2hlczogaGFuZGxlcnMuc2xpY2UoIGRlbGVnYXRlQ291bnQgKSB9KTsKCQl9CgoJCS8vIFJ1biBkZWxlZ2F0ZXMgZmlyc3Q7IHRoZXkgbWF5IHdhbnQgdG8gc3RvcCBwcm9wYWdhdGlvbiBiZW5lYXRoIHVzCgkJZm9yICggaSA9IDA7IGkgPCBoYW5kbGVyUXVldWUubGVuZ3RoICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpOyBpKysgKSB7CgkJCW1hdGNoZWQgPSBoYW5kbGVyUXVldWVbIGkgXTsKCQkJZXZlbnQuY3VycmVudFRhcmdldCA9IG1hdGNoZWQuZWxlbTsKCgkJCWZvciAoIGogPSAwOyBqIDwgbWF0Y2hlZC5tYXRjaGVzLmxlbmd0aCAmJiAhZXZlbnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKTsgaisrICkgewoJCQkJaGFuZGxlT2JqID0gbWF0Y2hlZC5tYXRjaGVzWyBqIF07CgoJCQkJLy8gVHJpZ2dlcmVkIGV2ZW50IG11c3QgZWl0aGVyIDEpIGJlIG5vbi1leGNsdXNpdmUgYW5kIGhhdmUgbm8gbmFtZXNwYWNlLCBvcgoJCQkJLy8gMikgaGF2ZSBuYW1lc3BhY2UocykgYSBzdWJzZXQgb3IgZXF1YWwgdG8gdGhvc2UgaW4gdGhlIGJvdW5kIGV2ZW50IChib3RoIGNhbiBoYXZlIG5vIG5hbWVzcGFjZSkuCgkJCQlpZiAoIHJ1bl9hbGwgfHwgKCFldmVudC5uYW1lc3BhY2UgJiYgIWhhbmRsZU9iai5uYW1lc3BhY2UpIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZSAmJiBldmVudC5uYW1lc3BhY2VfcmUudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgewoKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgkJCQkJZXZlbnQuaGFuZGxlT2JqID0gaGFuZGxlT2JqOwoKCQkJCQlyZXQgPSAoIChqUXVlcnkuZXZlbnQuc3BlY2lhbFsgaGFuZGxlT2JqLm9yaWdUeXBlIF0gfHwge30pLmhhbmRsZSB8fCBoYW5kbGVPYmouaGFuZGxlciApCgkJCQkJCQkuYXBwbHkoIG1hdGNoZWQuZWxlbSwgYXJncyApOwoKCQkJCQlpZiAoIHJldCAhPT0gdW5kZWZpbmVkICkgewoJCQkJCQlldmVudC5yZXN1bHQgPSByZXQ7CgkJCQkJCWlmICggcmV0ID09PSBmYWxzZSApIHsKCQkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIGV2ZW50LnJlc3VsdDsKCX0sCgoJLy8gSW5jbHVkZXMgc29tZSBldmVudCBwcm9wcyBzaGFyZWQgYnkgS2V5RXZlbnQgYW5kIE1vdXNlRXZlbnQKCS8vICoqKiBhdHRyQ2hhbmdlIGF0dHJOYW1lIHJlbGF0ZWROb2RlIHNyY0VsZW1lbnQgIGFyZSBub3Qgbm9ybWFsaXplZCwgbm9uLVczQywgZGVwcmVjYXRlZCwgd2lsbCBiZSByZW1vdmVkIGluIDEuOCAqKioKCXByb3BzOiAiYXR0ckNoYW5nZSBhdHRyTmFtZSByZWxhdGVkTm9kZSBzcmNFbGVtZW50IGFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaCIuc3BsaXQoIiAiKSwKCglmaXhIb29rczoge30sCgoJa2V5SG9va3M6IHsKCQlwcm9wczogImNoYXIgY2hhckNvZGUga2V5IGtleUNvZGUiLnNwbGl0KCIgIiksCgkJZmlsdGVyOiBmdW5jdGlvbiggZXZlbnQsIG9yaWdpbmFsICkgewoKCQkJLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzCgkJCWlmICggZXZlbnQud2hpY2ggPT0gbnVsbCApIHsKCQkJCWV2ZW50LndoaWNoID0gb3JpZ2luYWwuY2hhckNvZGUgIT0gbnVsbCA/IG9yaWdpbmFsLmNoYXJDb2RlIDogb3JpZ2luYWwua2V5Q29kZTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJbW91c2VIb29rczogewoJCXByb3BzOiAiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50Ii5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCQkJdmFyIGV2ZW50RG9jLCBkb2MsIGJvZHksCgkJCQlidXR0b24gPSBvcmlnaW5hbC5idXR0b24sCgkJCQlmcm9tRWxlbWVudCA9IG9yaWdpbmFsLmZyb21FbGVtZW50OwoKCQkJLy8gQ2FsY3VsYXRlIHBhZ2VYL1kgaWYgbWlzc2luZyBhbmQgY2xpZW50WC9ZIGF2YWlsYWJsZQoJCQlpZiAoIGV2ZW50LnBhZ2VYID09IG51bGwgJiYgb3JpZ2luYWwuY2xpZW50WCAhPSBudWxsICkgewoJCQkJZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsKCQkJCWRvYyA9IGV2ZW50RG9jLmRvY3VtZW50RWxlbWVudDsKCQkJCWJvZHkgPSBldmVudERvYy5ib2R5OwoKCQkJCWV2ZW50LnBhZ2VYID0gb3JpZ2luYWwuY2xpZW50WCArICggZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCWV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArICggZG9jICYmIGRvYy5zY3JvbGxUb3AgIHx8IGJvZHkgJiYgYm9keS5zY3JvbGxUb3AgIHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRUb3AgIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgIHx8IDAgKTsKCQkJfQoKCQkJLy8gQWRkIHJlbGF0ZWRUYXJnZXQsIGlmIG5lY2Vzc2FyeQoJCQlpZiAoICFldmVudC5yZWxhdGVkVGFyZ2V0ICYmIGZyb21FbGVtZW50ICkgewoJCQkJZXZlbnQucmVsYXRlZFRhcmdldCA9IGZyb21FbGVtZW50ID09PSBldmVudC50YXJnZXQgPyBvcmlnaW5hbC50b0VsZW1lbnQgOiBmcm9tRWxlbWVudDsKCQkJfQoKCQkJLy8gQWRkIHdoaWNoIGZvciBjbGljazogMSA9PT0gbGVmdDsgMiA9PT0gbWlkZGxlOyAzID09PSByaWdodAoJCQkvLyBOb3RlOiBidXR0b24gaXMgbm90IG5vcm1hbGl6ZWQsIHNvIGRvbid0IHVzZSBpdAoJCQlpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHsKCQkJCWV2ZW50LndoaWNoID0gKCBidXR0b24gJiAxID8gMSA6ICggYnV0dG9uICYgMiA/IDMgOiAoIGJ1dHRvbiAmIDQgPyAyIDogMCApICkgKTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsCgkJCW9yaWdpbmFsRXZlbnQgPSBldmVudCwKCQkJZml4SG9vayA9IGpRdWVyeS5ldmVudC5maXhIb29rc1sgZXZlbnQudHlwZSBdIHx8IHt9LAoJCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IGpRdWVyeS5FdmVudCggb3JpZ2luYWxFdmVudCApOwoKCQlmb3IgKCBpID0gY29weS5sZW5ndGg7IGk7ICkgewoJCQlwcm9wID0gY29weVsgLS1pIF07CgkJCWV2ZW50WyBwcm9wIF0gPSBvcmlnaW5hbEV2ZW50WyBwcm9wIF07CgkJfQoKCQkvLyBGaXggdGFyZ2V0IHByb3BlcnR5LCBpZiBuZWNlc3NhcnkgKCMxOTI1LCBJRSA2LzcvOCAmIFNhZmFyaTIpCgkJaWYgKCAhZXZlbnQudGFyZ2V0ICkgewoJCQlldmVudC50YXJnZXQgPSBvcmlnaW5hbEV2ZW50LnNyY0VsZW1lbnQgfHwgZG9jdW1lbnQ7CgkJfQoKCQkvLyBUYXJnZXQgc2hvdWxkIG5vdCBiZSBhIHRleHQgbm9kZSAoIzUwNCwgU2FmYXJpKQoJCWlmICggZXZlbnQudGFyZ2V0Lm5vZGVUeXBlID09PSAzICkgewoJCQlldmVudC50YXJnZXQgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZTsKCQl9CgoJCS8vIEZvciBtb3VzZS9rZXkgZXZlbnRzOyBhZGQgbWV0YUtleSBpZiBpdCdzIG5vdCB0aGVyZSAoIzMzNjgsIElFNi83LzgpCgkJaWYgKCBldmVudC5tZXRhS2V5ID09PSB1bmRlZmluZWQgKSB7CgkJCWV2ZW50Lm1ldGFLZXkgPSBldmVudC5jdHJsS2V5OwoJCX0KCgkJcmV0dXJuIGZpeEhvb2suZmlsdGVyPyBmaXhIb29rLmZpbHRlciggZXZlbnQsIG9yaWdpbmFsRXZlbnQgKSA6IGV2ZW50OwoJfSwKCglzcGVjaWFsOiB7CgkJcmVhZHk6IHsKCQkJLy8gTWFrZSBzdXJlIHRoZSByZWFkeSBldmVudCBpcyBzZXR1cAoJCQlzZXR1cDogalF1ZXJ5LmJpbmRSZWFkeQoJCX0sCgoJCWxvYWQ6IHsKCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQlub0J1YmJsZTogdHJ1ZQoJCX0sCgoJCWZvY3VzOiB7CgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlzZXR1cDogZnVuY3Rpb24oIGRhdGEsIG5hbWVzcGFjZXMsIGV2ZW50SGFuZGxlICkgewoJCQkJLy8gV2Ugb25seSB3YW50IHRvIGRvIHRoaXMgc3BlY2lhbCBjYXNlIG9uIHdpbmRvd3MKCQkJCWlmICggalF1ZXJ5LmlzV2luZG93KCB0aGlzICkgKSB7CgkJCQkJdGhpcy5vbmJlZm9yZXVubG9hZCA9IGV2ZW50SGFuZGxlOwoJCQkJfQoJCQl9LAoKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApIHsKCQkJCWlmICggdGhpcy5vbmJlZm9yZXVubG9hZCA9PT0gZXZlbnRIYW5kbGUgKSB7CgkJCQkJdGhpcy5vbmJlZm9yZXVubG9hZCA9IG51bGw7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXNpbXVsYXRlOiBmdW5jdGlvbiggdHlwZSwgZWxlbSwgZXZlbnQsIGJ1YmJsZSApIHsKCQkvLyBQaWdneWJhY2sgb24gYSBkb25vciBldmVudCB0byBzaW11bGF0ZSBhIGRpZmZlcmVudCBvbmUuCgkJLy8gRmFrZSBvcmlnaW5hbEV2ZW50IHRvIGF2b2lkIGRvbm9yJ3Mgc3RvcFByb3BhZ2F0aW9uLCBidXQgaWYgdGhlCgkJLy8gc2ltdWxhdGVkIGV2ZW50IHByZXZlbnRzIGRlZmF1bHQgdGhlbiB3ZSBkbyB0aGUgc2FtZSBvbiB0aGUgZG9ub3IuCgkJdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKAoJCQluZXcgalF1ZXJ5LkV2ZW50KCksCgkJCWV2ZW50LAoJCQl7IHR5cGU6IHR5cGUsCgkJCQlpc1NpbXVsYXRlZDogdHJ1ZSwKCQkJCW9yaWdpbmFsRXZlbnQ6IHt9CgkJCX0KCQkpOwoJCWlmICggYnViYmxlICkgewoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggZSwgbnVsbCwgZWxlbSApOwoJCX0gZWxzZSB7CgkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5jYWxsKCBlbGVtLCBlICk7CgkJfQoJCWlmICggZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9Cn07CgovLyBTb21lIHBsdWdpbnMgYXJlIHVzaW5nLCBidXQgaXQncyB1bmRvY3VtZW50ZWQvZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkLgovLyBUaGUgMS43IHNwZWNpYWwgZXZlbnQgaW50ZXJmYWNlIHNob3VsZCBwcm92aWRlIGFsbCB0aGUgaG9va3MgbmVlZGVkIG5vdy4KalF1ZXJ5LmV2ZW50LmhhbmRsZSA9IGpRdWVyeS5ldmVudC5kaXNwYXRjaDsKCmpRdWVyeS5yZW1vdmVFdmVudCA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPwoJZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCQlpZiAoIGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciApIHsKCQkJZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCB0eXBlLCBoYW5kbGUsIGZhbHNlICk7CgkJfQoJfSA6CglmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgewoJCWlmICggZWxlbS5kZXRhY2hFdmVudCApIHsKCQkJZWxlbS5kZXRhY2hFdmVudCggIm9uIiArIHR5cGUsIGhhbmRsZSApOwoJCX0KCX07CgpqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKHRoaXMgaW5zdGFuY2VvZiBqUXVlcnkuRXZlbnQpICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7Cgl9CgoJLy8gRXZlbnQgb2JqZWN0CglpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQl0aGlzLm9yaWdpbmFsRXZlbnQgPSBzcmM7CgkJdGhpcy50eXBlID0gc3JjLnR5cGU7CgoJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAoIHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwKCQkJc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpICkgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgoJLy8gRXZlbnQgdHlwZQoJfSBlbHNlIHsKCQl0aGlzLnR5cGUgPSBzcmM7Cgl9CgoJLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3QKCWlmICggcHJvcHMgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdGhpcywgcHJvcHMgKTsKCX0KCgkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7CgoJLy8gTWFyayBpdCBhcyBmaXhlZAoJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cn07CgpmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHsKCXJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiByZXR1cm5UcnVlKCkgewoJcmV0dXJuIHRydWU7Cn0KCi8vIGpRdWVyeS5FdmVudCBpcyBiYXNlZCBvbiBET00zIEV2ZW50cyBhcyBzcGVjaWZpZWQgYnkgdGhlIEVDTUFTY3JpcHQgTGFuZ3VhZ2UgQmluZGluZwovLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAzL1dELURPTS1MZXZlbC0zLUV2ZW50cy0yMDAzMDMzMS9lY21hLXNjcmlwdC1iaW5kaW5nLmh0bWwKalF1ZXJ5LkV2ZW50LnByb3RvdHlwZSA9IHsKCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsKCQl0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHJldHVyblRydWU7CgoJCXZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwoJCWlmICggIWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIGlmIHByZXZlbnREZWZhdWx0IGV4aXN0cyBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnByZXZlbnREZWZhdWx0ICkgewoJCQllLnByZXZlbnREZWZhdWx0KCk7CgoJCS8vIG90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZSAoSUUpCgkJfSBlbHNlIHsKCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwoJCX0KCX0sCglzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uKCkgewoJCXRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5UcnVlOwoKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCQlpZiAoICFlICkgewoJCQlyZXR1cm47CgkJfQoJCS8vIGlmIHN0b3BQcm9wYWdhdGlvbiBleGlzdHMgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudAoJCWlmICggZS5zdG9wUHJvcGFnYXRpb24gKSB7CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJfQoJCS8vIG90aGVyd2lzZSBzZXQgdGhlIGNhbmNlbEJ1YmJsZSBwcm9wZXJ0eSBvZiB0aGUgb3JpZ2luYWwgZXZlbnQgdG8gdHJ1ZSAoSUUpCgkJZS5jYW5jZWxCdWJibGUgPSB0cnVlOwoJfSwKCXN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7CgkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgkJdGhpcy5zdG9wUHJvcGFnYXRpb24oKTsKCX0sCglpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLAoJaXNQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlCn07CgovLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKalF1ZXJ5LmVhY2goewoJbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsCgltb3VzZWxlYXZlOiAibW91c2VvdXQiCn0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CglqUXVlcnkuZXZlbnQuc3BlY2lhbFsgb3JpZyBdID0gewoJCWRlbGVnYXRlVHlwZTogZml4LAoJCWJpbmRUeXBlOiBmaXgsCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgdGFyZ2V0ID0gdGhpcywKCQkJCXJlbGF0ZWQgPSBldmVudC5yZWxhdGVkVGFyZ2V0LAoJCQkJaGFuZGxlT2JqID0gZXZlbnQuaGFuZGxlT2JqLAoJCQkJc2VsZWN0b3IgPSBoYW5kbGVPYmouc2VsZWN0b3IsCgkJCQlyZXQ7CgoJCQkvLyBGb3IgbW91c2VudGVyL2xlYXZlIGNhbGwgdGhlIGhhbmRsZXIgaWYgcmVsYXRlZCBpcyBvdXRzaWRlIHRoZSB0YXJnZXQuCgkJCS8vIE5COiBObyByZWxhdGVkVGFyZ2V0IGlmIHRoZSBtb3VzZSBsZWZ0L2VudGVyZWQgdGhlIGJyb3dzZXIgd2luZG93CgkJCWlmICggIXJlbGF0ZWQgfHwgKHJlbGF0ZWQgIT09IHRhcmdldCAmJiAhalF1ZXJ5LmNvbnRhaW5zKCB0YXJnZXQsIHJlbGF0ZWQgKSkgKSB7CgkJCQlldmVudC50eXBlID0gaGFuZGxlT2JqLm9yaWdUeXBlOwoJCQkJcmV0ID0gaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJZXZlbnQudHlwZSA9IGZpeDsKCQkJfQoJCQlyZXR1cm4gcmV0OwoJCX0KCX07Cn0pOwoKLy8gSUUgc3VibWl0IGRlbGVnYXRpb24KaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc3VibWl0QnViYmxlcyApIHsKCglqUXVlcnkuZXZlbnQuc3BlY2lhbC5zdWJtaXQgPSB7CgkJc2V0dXA6IGZ1bmN0aW9uKCkgewoJCQkvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cwoJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggdGhpcywgImZvcm0iICkgKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCS8vIExhenktYWRkIGEgc3VibWl0IGhhbmRsZXIgd2hlbiBhIGRlc2NlbmRhbnQgZm9ybSBtYXkgcG90ZW50aWFsbHkgYmUgc3VibWl0dGVkCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXQiLCBmdW5jdGlvbiggZSApIHsKCQkJCS8vIE5vZGUgbmFtZSBjaGVjayBhdm9pZHMgYSBWTUwtcmVsYXRlZCBjcmFzaCBpbiBJRSAoIzk4MDcpCgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0LAoJCQkJCWZvcm0gPSBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSB8fCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJidXR0b24iICkgPyBlbGVtLmZvcm0gOiB1bmRlZmluZWQ7CgkJCQlpZiAoIGZvcm0gJiYgIWZvcm0uX3N1Ym1pdF9hdHRhY2hlZCApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCAic3VibWl0Ll9zdWJtaXQiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCS8vIElmIGZvcm0gd2FzIHN1Ym1pdHRlZCBieSB0aGUgdXNlciwgYnViYmxlIHRoZSBldmVudCB1cCB0aGUgdHJlZQoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNUcmlnZ2VyICkgewoJCQkJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAic3VibWl0IiwgdGhpcy5wYXJlbnROb2RlLCBldmVudCwgdHJ1ZSApOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJZm9ybS5fc3VibWl0X2F0dGFjaGVkID0gdHJ1ZTsKCQkJCX0KCQkJfSk7CgkJCS8vIHJldHVybiB1bmRlZmluZWQgc2luY2Ugd2UgZG9uJ3QgbmVlZCBhbiBldmVudCBsaXN0ZW5lcgoJCX0sCgoJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJLy8gT25seSBuZWVkIHRoaXMgZm9yIGRlbGVnYXRlZCBmb3JtIHN1Ym1pdCBldmVudHMKCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJmb3JtIiApICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQkvLyBSZW1vdmUgZGVsZWdhdGVkIGhhbmRsZXJzOyBjbGVhbkRhdGEgZXZlbnR1YWxseSByZWFwcyBzdWJtaXQgaGFuZGxlcnMgYXR0YWNoZWQgYWJvdmUKCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggdGhpcywgIi5fc3VibWl0IiApOwoJCX0KCX07Cn0KCi8vIElFIGNoYW5nZSBkZWxlZ2F0aW9uIGFuZCBjaGVja2JveC9yYWRpbyBmaXgKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hhbmdlQnViYmxlcyApIHsKCglqUXVlcnkuZXZlbnQuc3BlY2lhbC5jaGFuZ2UgPSB7CgoJCXNldHVwOiBmdW5jdGlvbigpIHsKCgkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICkgKSB7CgkJCQkvLyBJRSBkb2Vzbid0IGZpcmUgY2hhbmdlIG9uIGEgY2hlY2svcmFkaW8gdW50aWwgYmx1cjsgdHJpZ2dlciBpdCBvbiBjbGljawoJCQkJLy8gYWZ0ZXIgYSBwcm9wZXJ0eWNoYW5nZS4gRWF0IHRoZSBibHVyLWNoYW5nZSBpbiBzcGVjaWFsLmNoYW5nZS5oYW5kbGUuCgkJCQkvLyBUaGlzIHN0aWxsIGZpcmVzIG9uY2hhbmdlIGEgc2Vjb25kIHRpbWUgZm9yIGNoZWNrL3JhZGlvIGFmdGVyIGJsdXIuCgkJCQlpZiAoIHRoaXMudHlwZSA9PT0gImNoZWNrYm94IiB8fCB0aGlzLnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggZXZlbnQub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09ICJjaGVja2VkIiApIHsKCQkJCQkJCXRoaXMuX2p1c3RfY2hhbmdlZCA9IHRydWU7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiY2xpY2suX2NoYW5nZSIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCQkJaWYgKCB0aGlzLl9qdXN0X2NoYW5nZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCXRoaXMuX2p1c3RfY2hhbmdlZCA9IGZhbHNlOwoJCQkJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCAiY2hhbmdlIiwgdGhpcywgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCS8vIERlbGVnYXRlZCBldmVudDsgbGF6eS1hZGQgYSBjaGFuZ2UgaGFuZGxlciBvbiBkZXNjZW5kYW50IGlucHV0cwoJCQlqUXVlcnkuZXZlbnQuYWRkKCB0aGlzLCAiYmVmb3JlYWN0aXZhdGUuX2NoYW5nZSIsIGZ1bmN0aW9uKCBlICkgewoJCQkJdmFyIGVsZW0gPSBlLnRhcmdldDsKCgkJCQlpZiAoIHJmb3JtRWxlbXMudGVzdCggZWxlbS5ub2RlTmFtZSApICYmICFlbGVtLl9jaGFuZ2VfYXR0YWNoZWQgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNTaW11bGF0ZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCWVsZW0uX2NoYW5nZV9hdHRhY2hlZCA9IHRydWU7CgkJCQl9CgkJCX0pOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8IChlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSApIHsKCQkJCXJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX2NoYW5nZSIgKTsKCgkJCXJldHVybiByZm9ybUVsZW1zLnRlc3QoIHRoaXMubm9kZU5hbWUgKTsKCQl9Cgl9Owp9CgovLyBDcmVhdGUgImJ1YmJsaW5nIiBmb2N1cyBhbmQgYmx1ciBldmVudHMKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXMgKSB7CglqUXVlcnkuZWFjaCh7IGZvY3VzOiAiZm9jdXNpbiIsIGJsdXI6ICJmb2N1c291dCIgfSwgZnVuY3Rpb24oIG9yaWcsIGZpeCApIHsKCgkJLy8gQXR0YWNoIGEgc2luZ2xlIGNhcHR1cmluZyBoYW5kbGVyIHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAoJCXZhciBhdHRhY2hlcyA9IDAsCgkJCWhhbmRsZXIgPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoIGZpeCwgZXZlbnQudGFyZ2V0LCBqUXVlcnkuZXZlbnQuZml4KCBldmVudCApLCB0cnVlICk7CgkJCX07CgoJCWpRdWVyeS5ldmVudC5zcGVjaWFsWyBmaXggXSA9IHsKCQkJc2V0dXA6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBhdHRhY2hlcysrID09PSAwICkgewoJCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCX0KCQkJfSwKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAtLWF0dGFjaGVzID09PSAwICkgewoJCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9KTsKfQoKalF1ZXJ5LmZuLmV4dGVuZCh7CgoJb246IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAvKklOVEVSTkFMKi8gb25lICkgewoJCXZhciBvcmlnRm4sIHR5cGU7CgoJCS8vIFR5cGVzIGNhbiBiZSBhIG1hcCBvZiB0eXBlcy9oYW5kbGVycwoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1PYmplY3QsIHNlbGVjdG9yLCBkYXRhICkKCQkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgewoJCQkJLy8gKCB0eXBlcy1PYmplY3QsIGRhdGEgKQoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uLmNhbGwoIHRoaXMsIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIDEgKTsKCX0sCglvZmY6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGZuICkgewoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCXZhciBoYW5kbGVPYmogPSB0eXBlcy5oYW5kbGVPYmo7CgkJCWpRdWVyeSggdHlwZXMuZGVsZWdhdGVUYXJnZXQgKS5vZmYoCgkJCQloYW5kbGVPYmoubmFtZXNwYWNlPyBoYW5kbGVPYmoudHlwZSArICIuIiArIGhhbmRsZU9iai5uYW1lc3BhY2UgOiBoYW5kbGVPYmoudHlwZSwKCQkJCWhhbmRsZU9iai5zZWxlY3RvciwKCQkJCWhhbmRsZU9iai5oYW5kbGVyCgkJCSk7CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtb2JqZWN0IFssIHNlbGVjdG9yXSApCgkJCWZvciAoIHZhciB0eXBlIGluIHR5cGVzICkgewoJCQkJdGhpcy5vZmYoIHR5cGUsIHNlbGVjdG9yLCB0eXBlc1sgdHlwZSBdICk7CgkJCX0KCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggc2VsZWN0b3IgPT09IGZhbHNlIHx8IHR5cGVvZiBzZWxlY3RvciA9PT0gImZ1bmN0aW9uIiApIHsKCQkJLy8gKCB0eXBlcyBbLCBmbl0gKQoJCQlmbiA9IHNlbGVjdG9yOwoJCQlzZWxlY3RvciA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsIHR5cGVzLCBmbiwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCgoJYmluZDogZnVuY3Rpb24oIHR5cGVzLCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZXMsIG51bGwsIGRhdGEsIGZuICk7Cgl9LAoJdW5iaW5kOiBmdW5jdGlvbiggdHlwZXMsIGZuICkgewoJCXJldHVybiB0aGlzLm9mZiggdHlwZXMsIG51bGwsIGZuICk7Cgl9LAoKCWxpdmU6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJalF1ZXJ5KCB0aGlzLmNvbnRleHQgKS5vbiggdHlwZXMsIHRoaXMuc2VsZWN0b3IsIGRhdGEsIGZuICk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoJZGllOiBmdW5jdGlvbiggdHlwZXMsIGZuICkgewoJCWpRdWVyeSggdGhpcy5jb250ZXh0ICkub2ZmKCB0eXBlcywgdGhpcy5zZWxlY3RvciB8fCAiKioiLCBmbiApOwoJCXJldHVybiB0aGlzOwoJfSwKCglkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKTsKCX0sCgl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT0gMT8gdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOiB0aGlzLm9mZiggdHlwZXMsIHNlbGVjdG9yLCBmbiApOwoJfSwKCgl0cmlnZ2VyOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpcyApOwoJCX0pOwoJfSwKCXRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCXJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgdGhpc1swXSwgdHJ1ZSApOwoJCX0KCX0sCgoJdG9nZ2xlOiBmdW5jdGlvbiggZm4gKSB7CgkJLy8gU2F2ZSByZWZlcmVuY2UgdG8gYXJndW1lbnRzIGZvciBhY2Nlc3MgaW4gY2xvc3VyZQoJCXZhciBhcmdzID0gYXJndW1lbnRzLAoJCQlndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrLAoJCQlpID0gMCwKCQkJdG9nZ2xlciA9IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCS8vIEZpZ3VyZSBvdXQgd2hpY2ggZnVuY3Rpb24gdG8gZXhlY3V0ZQoJCQkJdmFyIGxhc3RUb2dnbGUgPSAoIGpRdWVyeS5fZGF0YSggdGhpcywgImxhc3RUb2dnbGUiICsgZm4uZ3VpZCApIHx8IDAgKSAlIGk7CgkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJsYXN0VG9nZ2xlIiArIGZuLmd1aWQsIGxhc3RUb2dnbGUgKyAxICk7CgoJCQkJLy8gTWFrZSBzdXJlIHRoYXQgY2xpY2tzIHN0b3AKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQkJLy8gYW5kIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uCgkJCQlyZXR1cm4gYXJnc1sgbGFzdFRvZ2dsZSBdLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSB8fCBmYWxzZTsKCQkJfTsKCgkJLy8gbGluayBhbGwgdGhlIGZ1bmN0aW9ucywgc28gYW55IG9mIHRoZW0gY2FuIHVuYmluZCB0aGlzIGNsaWNrIGhhbmRsZXIKCQl0b2dnbGVyLmd1aWQgPSBndWlkOwoJCXdoaWxlICggaSA8IGFyZ3MubGVuZ3RoICkgewoJCQlhcmdzWyBpKysgXS5ndWlkID0gZ3VpZDsKCQl9CgoJCXJldHVybiB0aGlzLmNsaWNrKCB0b2dnbGVyICk7Cgl9LAoKCWhvdmVyOiBmdW5jdGlvbiggZm5PdmVyLCBmbk91dCApIHsKCQlyZXR1cm4gdGhpcy5tb3VzZWVudGVyKCBmbk92ZXIgKS5tb3VzZWxlYXZlKCBmbk91dCB8fCBmbk92ZXIgKTsKCX0KfSk7CgpqUXVlcnkuZWFjaCggKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayAiICsKCSJtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSAiICsKCSJjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51Iikuc3BsaXQoIiAiKSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgoJLy8gSGFuZGxlIGV2ZW50IGJpbmRpbmcKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIGRhdGEsIGZuICkgewoJCWlmICggZm4gPT0gbnVsbCApIHsKCQkJZm4gPSBkYXRhOwoJCQlkYXRhID0gbnVsbDsKCQl9CgoJCXJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMCA/CgkJCXRoaXMub24oIG5hbWUsIG51bGwsIGRhdGEsIGZuICkgOgoJCQl0aGlzLnRyaWdnZXIoIG5hbWUgKTsKCX07CgoJaWYgKCBqUXVlcnkuYXR0ckZuICkgewoJCWpRdWVyeS5hdHRyRm5bIG5hbWUgXSA9IHRydWU7Cgl9CgoJaWYgKCBya2V5RXZlbnQudGVzdCggbmFtZSApICkgewoJCWpRdWVyeS5ldmVudC5maXhIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV2ZW50LmtleUhvb2tzOwoJfQoKCWlmICggcm1vdXNlRXZlbnQudGVzdCggbmFtZSApICkgewoJCWpRdWVyeS5ldmVudC5maXhIb29rc1sgbmFtZSBdID0galF1ZXJ5LmV2ZW50Lm1vdXNlSG9va3M7Cgl9Cn0pOwoKCgovKiEKICogU2l6emxlIENTUyBTZWxlY3RvciBFbmdpbmUKICogIENvcHlyaWdodCAyMDExLCBUaGUgRG9qbyBGb3VuZGF0aW9uCiAqICBSZWxlYXNlZCB1bmRlciB0aGUgTUlULCBCU0QsIGFuZCBHUEwgTGljZW5zZXMuCiAqICBNb3JlIGluZm9ybWF0aW9uOiBodHRwOi8vc2l6emxlanMuY29tLwogKi8KKGZ1bmN0aW9uKCl7Cgp2YXIgY2h1bmtlciA9IC8oKD86XCgoPzpcKFteKCldK1wpfFteKCldKykrXCl8XFsoPzpcW1teXFtcXV0qXF18WyciXVteJyJdKlsnIl18W15cW1xdJyJdKykrXF18XFwufFteID4rfiwoXFtcXF0rKSt8Wz4rfl0pKFxzKixccyopPygoPzoufFxyfFxuKSopL2csCglleHBhbmRvID0gInNpemNhY2hlIiArIChNYXRoLnJhbmRvbSgpICsgJycpLnJlcGxhY2UoJy4nLCAnJyksCglkb25lID0gMCwKCXRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCWhhc0R1cGxpY2F0ZSA9IGZhbHNlLAoJYmFzZUhhc0R1cGxpY2F0ZSA9IHRydWUsCglyQmFja3NsYXNoID0gL1xcL2csCglyUmV0dXJuID0gL1xyXG4vZywKCXJOb25Xb3JkID0gL1xXLzsKCi8vIEhlcmUgd2UgY2hlY2sgaWYgdGhlIEphdmFTY3JpcHQgZW5naW5lIGlzIHVzaW5nIHNvbWUgc29ydCBvZgovLyBvcHRpbWl6YXRpb24gd2hlcmUgaXQgZG9lcyBub3QgYWx3YXlzIGNhbGwgb3VyIGNvbXBhcmlzaW9uCi8vIGZ1bmN0aW9uLiBJZiB0aGF0IGlzIHRoZSBjYXNlLCBkaXNjYXJkIHRoZSBoYXNEdXBsaWNhdGUgdmFsdWUuCi8vICAgVGh1cyBmYXIgdGhhdCBpbmNsdWRlcyBHb29nbGUgQ2hyb21lLgpbMCwgMF0uc29ydChmdW5jdGlvbigpIHsKCWJhc2VIYXNEdXBsaWNhdGUgPSBmYWxzZTsKCXJldHVybiAwOwp9KTsKCnZhciBTaXp6bGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7CglyZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsKCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoKCXZhciBvcmlnQ29udGV4dCA9IGNvbnRleHQ7CgoJaWYgKCBjb250ZXh0Lm5vZGVUeXBlICE9PSAxICYmIGNvbnRleHQubm9kZVR5cGUgIT09IDkgKSB7CgkJcmV0dXJuIFtdOwoJfQoJCglpZiAoICFzZWxlY3RvciB8fCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgewoJCXJldHVybiByZXN1bHRzOwoJfQoKCXZhciBtLCBzZXQsIGNoZWNrU2V0LCBleHRyYSwgcmV0LCBjdXIsIHBvcCwgaSwKCQlwcnVuZSA9IHRydWUsCgkJY29udGV4dFhNTCA9IFNpenpsZS5pc1hNTCggY29udGV4dCApLAoJCXBhcnRzID0gW10sCgkJc29GYXIgPSBzZWxlY3RvcjsKCQoJLy8gUmVzZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjaHVua2VyIHJlZ2V4cCAoc3RhcnQgZnJvbSBoZWFkKQoJZG8gewoJCWNodW5rZXIuZXhlYyggIiIgKTsKCQltID0gY2h1bmtlci5leGVjKCBzb0ZhciApOwoKCQlpZiAoIG0gKSB7CgkJCXNvRmFyID0gbVszXTsKCQkKCQkJcGFydHMucHVzaCggbVsxXSApOwoJCQoJCQlpZiAoIG1bMl0gKSB7CgkJCQlleHRyYSA9IG1bM107CgkJCQlicmVhazsKCQkJfQoJCX0KCX0gd2hpbGUgKCBtICk7CgoJaWYgKCBwYXJ0cy5sZW5ndGggPiAxICYmIG9yaWdQT1MuZXhlYyggc2VsZWN0b3IgKSApIHsKCgkJaWYgKCBwYXJ0cy5sZW5ndGggPT09IDIgJiYgRXhwci5yZWxhdGl2ZVsgcGFydHNbMF0gXSApIHsKCQkJc2V0ID0gcG9zUHJvY2VzcyggcGFydHNbMF0gKyBwYXJ0c1sxXSwgY29udGV4dCwgc2VlZCApOwoKCQl9IGVsc2UgewoJCQlzZXQgPSBFeHByLnJlbGF0aXZlWyBwYXJ0c1swXSBdID8KCQkJCVsgY29udGV4dCBdIDoKCQkJCVNpenpsZSggcGFydHMuc2hpZnQoKSwgY29udGV4dCApOwoKCQkJd2hpbGUgKCBwYXJ0cy5sZW5ndGggKSB7CgkJCQlzZWxlY3RvciA9IHBhcnRzLnNoaWZ0KCk7CgoJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyBzZWxlY3RvciBdICkgewoJCQkJCXNlbGVjdG9yICs9IHBhcnRzLnNoaWZ0KCk7CgkJCQl9CgkJCQkKCQkJCXNldCA9IHBvc1Byb2Nlc3MoIHNlbGVjdG9yLCBzZXQsIHNlZWQgKTsKCQkJfQoJCX0KCgl9IGVsc2UgewoJCS8vIFRha2UgYSBzaG9ydGN1dCBhbmQgc2V0IHRoZSBjb250ZXh0IGlmIHRoZSByb290IHNlbGVjdG9yIGlzIGFuIElECgkJLy8gKGJ1dCBub3QgaWYgaXQnbGwgYmUgZmFzdGVyIGlmIHRoZSBpbm5lciBzZWxlY3RvciBpcyBhbiBJRCkKCQlpZiAoICFzZWVkICYmIHBhcnRzLmxlbmd0aCA+IDEgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiAhY29udGV4dFhNTCAmJgoJCQkJRXhwci5tYXRjaC5JRC50ZXN0KHBhcnRzWzBdKSAmJiAhRXhwci5tYXRjaC5JRC50ZXN0KHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKSApIHsKCgkJCXJldCA9IFNpenpsZS5maW5kKCBwYXJ0cy5zaGlmdCgpLCBjb250ZXh0LCBjb250ZXh0WE1MICk7CgkJCWNvbnRleHQgPSByZXQuZXhwciA/CgkJCQlTaXp6bGUuZmlsdGVyKCByZXQuZXhwciwgcmV0LnNldCApWzBdIDoKCQkJCXJldC5zZXRbMF07CgkJfQoKCQlpZiAoIGNvbnRleHQgKSB7CgkJCXJldCA9IHNlZWQgPwoJCQkJeyBleHByOiBwYXJ0cy5wb3AoKSwgc2V0OiBtYWtlQXJyYXkoc2VlZCkgfSA6CgkJCQlTaXp6bGUuZmluZCggcGFydHMucG9wKCksIHBhcnRzLmxlbmd0aCA9PT0gMSAmJiAocGFydHNbMF0gPT09ICJ+IiB8fCBwYXJ0c1swXSA9PT0gIisiKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgPyBjb250ZXh0LnBhcmVudE5vZGUgOiBjb250ZXh0LCBjb250ZXh0WE1MICk7CgoJCQlzZXQgPSByZXQuZXhwciA/CgkJCQlTaXp6bGUuZmlsdGVyKCByZXQuZXhwciwgcmV0LnNldCApIDoKCQkJCXJldC5zZXQ7CgoJCQlpZiAoIHBhcnRzLmxlbmd0aCA+IDAgKSB7CgkJCQljaGVja1NldCA9IG1ha2VBcnJheSggc2V0ICk7CgoJCQl9IGVsc2UgewoJCQkJcHJ1bmUgPSBmYWxzZTsKCQkJfQoKCQkJd2hpbGUgKCBwYXJ0cy5sZW5ndGggKSB7CgkJCQljdXIgPSBwYXJ0cy5wb3AoKTsKCQkJCXBvcCA9IGN1cjsKCgkJCQlpZiAoICFFeHByLnJlbGF0aXZlWyBjdXIgXSApIHsKCQkJCQljdXIgPSAiIjsKCQkJCX0gZWxzZSB7CgkJCQkJcG9wID0gcGFydHMucG9wKCk7CgkJCQl9CgoJCQkJaWYgKCBwb3AgPT0gbnVsbCApIHsKCQkJCQlwb3AgPSBjb250ZXh0OwoJCQkJfQoKCQkJCUV4cHIucmVsYXRpdmVbIGN1ciBdKCBjaGVja1NldCwgcG9wLCBjb250ZXh0WE1MICk7CgkJCX0KCgkJfSBlbHNlIHsKCQkJY2hlY2tTZXQgPSBwYXJ0cyA9IFtdOwoJCX0KCX0KCglpZiAoICFjaGVja1NldCApIHsKCQljaGVja1NldCA9IHNldDsKCX0KCglpZiAoICFjaGVja1NldCApIHsKCQlTaXp6bGUuZXJyb3IoIGN1ciB8fCBzZWxlY3RvciApOwoJfQoKCWlmICggdG9TdHJpbmcuY2FsbChjaGVja1NldCkgPT09ICJbb2JqZWN0IEFycmF5XSIgKSB7CgkJaWYgKCAhcHJ1bmUgKSB7CgkJCXJlc3VsdHMucHVzaC5hcHBseSggcmVzdWx0cywgY2hlY2tTZXQgKTsKCgkJfSBlbHNlIGlmICggY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSAxICkgewoJCQlmb3IgKCBpID0gMDsgY2hlY2tTZXRbaV0gIT0gbnVsbDsgaSsrICkgewoJCQkJaWYgKCBjaGVja1NldFtpXSAmJiAoY2hlY2tTZXRbaV0gPT09IHRydWUgfHwgY2hlY2tTZXRbaV0ubm9kZVR5cGUgPT09IDEgJiYgU2l6emxlLmNvbnRhaW5zKGNvbnRleHQsIGNoZWNrU2V0W2ldKSkgKSB7CgkJCQkJcmVzdWx0cy5wdXNoKCBzZXRbaV0gKTsKCQkJCX0KCQkJfQoKCQl9IGVsc2UgewoJCQlmb3IgKCBpID0gMDsgY2hlY2tTZXRbaV0gIT0gbnVsbDsgaSsrICkgewoJCQkJaWYgKCBjaGVja1NldFtpXSAmJiBjaGVja1NldFtpXS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlyZXN1bHRzLnB1c2goIHNldFtpXSApOwoJCQkJfQoJCQl9CgkJfQoKCX0gZWxzZSB7CgkJbWFrZUFycmF5KCBjaGVja1NldCwgcmVzdWx0cyApOwoJfQoKCWlmICggZXh0cmEgKSB7CgkJU2l6emxlKCBleHRyYSwgb3JpZ0NvbnRleHQsIHJlc3VsdHMsIHNlZWQgKTsKCQlTaXp6bGUudW5pcXVlU29ydCggcmVzdWx0cyApOwoJfQoKCXJldHVybiByZXN1bHRzOwp9OwoKU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiggcmVzdWx0cyApIHsKCWlmICggc29ydE9yZGVyICkgewoJCWhhc0R1cGxpY2F0ZSA9IGJhc2VIYXNEdXBsaWNhdGU7CgkJcmVzdWx0cy5zb3J0KCBzb3J0T3JkZXIgKTsKCgkJaWYgKCBoYXNEdXBsaWNhdGUgKSB7CgkJCWZvciAoIHZhciBpID0gMTsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKysgKSB7CgkJCQlpZiAoIHJlc3VsdHNbaV0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7CgkJCQkJcmVzdWx0cy5zcGxpY2UoIGktLSwgMSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiByZXN1bHRzOwp9OwoKU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiggZXhwciwgc2V0ICkgewoJcmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgc2V0ICk7Cn07CgpTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oIG5vZGUsIGV4cHIgKSB7CglyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBbbm9kZV0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmZpbmQgPSBmdW5jdGlvbiggZXhwciwgY29udGV4dCwgaXNYTUwgKSB7Cgl2YXIgc2V0LCBpLCBsZW4sIG1hdGNoLCB0eXBlLCBsZWZ0OwoKCWlmICggIWV4cHIgKSB7CgkJcmV0dXJuIFtdOwoJfQoKCWZvciAoIGkgPSAwLCBsZW4gPSBFeHByLm9yZGVyLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkgewoJCXR5cGUgPSBFeHByLm9yZGVyW2ldOwoJCQoJCWlmICggKG1hdGNoID0gRXhwci5sZWZ0TWF0Y2hbIHR5cGUgXS5leGVjKCBleHByICkpICkgewoJCQlsZWZ0ID0gbWF0Y2hbMV07CgkJCW1hdGNoLnNwbGljZSggMSwgMSApOwoKCQkJaWYgKCBsZWZ0LnN1YnN0ciggbGVmdC5sZW5ndGggLSAxICkgIT09ICJcXCIgKSB7CgkJCQltYXRjaFsxXSA9IChtYXRjaFsxXSB8fCAiIikucmVwbGFjZSggckJhY2tzbGFzaCwgIiIgKTsKCQkJCXNldCA9IEV4cHIuZmluZFsgdHlwZSBdKCBtYXRjaCwgY29udGV4dCwgaXNYTUwgKTsKCgkJCQlpZiAoIHNldCAhPSBudWxsICkgewoJCQkJCWV4cHIgPSBleHByLnJlcGxhY2UoIEV4cHIubWF0Y2hbIHR5cGUgXSwgIiIgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCX0KCglpZiAoICFzZXQgKSB7CgkJc2V0ID0gdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09ICJ1bmRlZmluZWQiID8KCQkJY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggIioiICkgOgoJCQlbXTsKCX0KCglyZXR1cm4geyBzZXQ6IHNldCwgZXhwcjogZXhwciB9Owp9OwoKU2l6emxlLmZpbHRlciA9IGZ1bmN0aW9uKCBleHByLCBzZXQsIGlucGxhY2UsIG5vdCApIHsKCXZhciBtYXRjaCwgYW55Rm91bmQsCgkJdHlwZSwgZm91bmQsIGl0ZW0sIGZpbHRlciwgbGVmdCwKCQlpLCBwYXNzLAoJCW9sZCA9IGV4cHIsCgkJcmVzdWx0ID0gW10sCgkJY3VyTG9vcCA9IHNldCwKCQlpc1hNTEZpbHRlciA9IHNldCAmJiBzZXRbMF0gJiYgU2l6emxlLmlzWE1MKCBzZXRbMF0gKTsKCgl3aGlsZSAoIGV4cHIgJiYgc2V0Lmxlbmd0aCApIHsKCQlmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkgewoJCQlpZiAoIChtYXRjaCA9IEV4cHIubGVmdE1hdGNoWyB0eXBlIF0uZXhlYyggZXhwciApKSAhPSBudWxsICYmIG1hdGNoWzJdICkgewoJCQkJZmlsdGVyID0gRXhwci5maWx0ZXJbIHR5cGUgXTsKCQkJCWxlZnQgPSBtYXRjaFsxXTsKCgkJCQlhbnlGb3VuZCA9IGZhbHNlOwoKCQkJCW1hdGNoLnNwbGljZSgxLDEpOwoKCQkJCWlmICggbGVmdC5zdWJzdHIoIGxlZnQubGVuZ3RoIC0gMSApID09PSAiXFwiICkgewoJCQkJCWNvbnRpbnVlOwoJCQkJfQoKCQkJCWlmICggY3VyTG9vcCA9PT0gcmVzdWx0ICkgewoJCQkJCXJlc3VsdCA9IFtdOwoJCQkJfQoKCQkJCWlmICggRXhwci5wcmVGaWx0ZXJbIHR5cGUgXSApIHsKCQkJCQltYXRjaCA9IEV4cHIucHJlRmlsdGVyWyB0eXBlIF0oIG1hdGNoLCBjdXJMb29wLCBpbnBsYWNlLCByZXN1bHQsIG5vdCwgaXNYTUxGaWx0ZXIgKTsKCgkJCQkJaWYgKCAhbWF0Y2ggKSB7CgkJCQkJCWFueUZvdW5kID0gZm91bmQgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRjaCA9PT0gdHJ1ZSApIHsKCQkJCQkJY29udGludWU7CgkJCQkJfQoJCQkJfQoKCQkJCWlmICggbWF0Y2ggKSB7CgkJCQkJZm9yICggaSA9IDA7IChpdGVtID0gY3VyTG9vcFtpXSkgIT0gbnVsbDsgaSsrICkgewoJCQkJCQlpZiAoIGl0ZW0gKSB7CgkJCQkJCQlmb3VuZCA9IGZpbHRlciggaXRlbSwgbWF0Y2gsIGksIGN1ckxvb3AgKTsKCQkJCQkJCXBhc3MgPSBub3QgXiBmb3VuZDsKCgkJCQkJCQlpZiAoIGlucGxhY2UgJiYgZm91bmQgIT0gbnVsbCApIHsKCQkJCQkJCQlpZiAoIHBhc3MgKSB7CgkJCQkJCQkJCWFueUZvdW5kID0gdHJ1ZTsKCgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJY3VyTG9vcFtpXSA9IGZhbHNlOwoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgaWYgKCBwYXNzICkgewoJCQkJCQkJCXJlc3VsdC5wdXNoKCBpdGVtICk7CgkJCQkJCQkJYW55Rm91bmQgPSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCWlmICggZm91bmQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQlpZiAoICFpbnBsYWNlICkgewoJCQkJCQljdXJMb29wID0gcmVzdWx0OwoJCQkJCX0KCgkJCQkJZXhwciA9IGV4cHIucmVwbGFjZSggRXhwci5tYXRjaFsgdHlwZSBdLCAiIiApOwoKCQkJCQlpZiAoICFhbnlGb3VuZCApIHsKCQkJCQkJcmV0dXJuIFtdOwoJCQkJCX0KCgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEltcHJvcGVyIGV4cHJlc3Npb24KCQlpZiAoIGV4cHIgPT09IG9sZCApIHsKCQkJaWYgKCBhbnlGb3VuZCA9PSBudWxsICkgewoJCQkJU2l6emxlLmVycm9yKCBleHByICk7CgoJCQl9IGVsc2UgewoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCW9sZCA9IGV4cHI7Cgl9CgoJcmV0dXJuIGN1ckxvb3A7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLyoqCiAqIFV0aWxpdHkgZnVuY3Rpb24gZm9yIHJldHJlaXZpbmcgdGhlIHRleHQgdmFsdWUgb2YgYW4gYXJyYXkgb2YgRE9NIG5vZGVzCiAqIEBwYXJhbSB7QXJyYXl8RWxlbWVudH0gZWxlbQogKi8KdmFyIGdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewogICAgdmFyIGksIG5vZGUsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlLAoJCXJldCA9ICIiOwoKCWlmICggbm9kZVR5cGUgKSB7CgkJaWYgKCBub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gOSApIHsKCQkJLy8gVXNlIHRleHRDb250ZW50IHx8IGlubmVyVGV4dCBmb3IgZWxlbWVudHMKCQkJaWYgKCB0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gJ3N0cmluZycgKSB7CgkJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQkJfSBlbHNlIGlmICggdHlwZW9mIGVsZW0uaW5uZXJUZXh0ID09PSAnc3RyaW5nJyApIHsKCQkJCS8vIFJlcGxhY2UgSUUncyBjYXJyaWFnZSByZXR1cm5zCgkJCQlyZXR1cm4gZWxlbS5pbm5lclRleHQucmVwbGFjZSggclJldHVybiwgJycgKTsKCQkJfSBlbHNlIHsKCQkJCS8vIFRyYXZlcnNlIGl0J3MgY2hpbGRyZW4KCQkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nKSB7CgkJCQkJcmV0ICs9IGdldFRleHQoIGVsZW0gKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlVmFsdWU7CgkJfQoJfSBlbHNlIHsKCgkJLy8gSWYgbm8gbm9kZVR5cGUsIHRoaXMgaXMgZXhwZWN0ZWQgdG8gYmUgYW4gYXJyYXkKCQlmb3IgKCBpID0gMDsgKG5vZGUgPSBlbGVtW2ldKTsgaSsrICkgewoJCQkvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2RlcwoJCQlpZiAoIG5vZGUubm9kZVR5cGUgIT09IDggKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggbm9kZSApOwoJCQl9CgkJfQoJfQoJcmV0dXJuIHJldDsKfTsKCnZhciBFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKCW9yZGVyOiBbICJJRCIsICJOQU1FIiwgIlRBRyIgXSwKCgltYXRjaDogewoJCUlEOiAvIygoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sCgkJQ0xBU1M6IC9cLigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sCgkJTkFNRTogL1xbbmFtZT1bJyJdKigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKVsnIl0qXF0vLAoJCUFUVFI6IC9cW1xzKigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKVxzKig/OihcUz89KVxzKig/OihbJyJdKSguKj8pXDN8KCM/KD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKil8KXwpXHMqXF0vLAoJCVRBRzogL14oKD86W1x3XHUwMGMwLVx1RkZGRlwqXC1dfFxcLikrKS8sCgkJQ0hJTEQ6IC86KG9ubHl8bnRofGxhc3R8Zmlyc3QpLWNoaWxkKD86XChccyooZXZlbnxvZGR8KD86WytcLV0/XGQrfCg/OlsrXC1dP1xkKik/blxzKig/OlsrXC1dXHMqXGQrKT8pKVxzKlwpKT8vLAoJCVBPUzogLzoobnRofGVxfGd0fGx0fGZpcnN0fGxhc3R8ZXZlbnxvZGQpKD86XCgoXGQqKVwpKT8oPz1bXlwtXXwkKS8sCgkJUFNFVURPOiAvOigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKSg/OlwoKFsnIl0/KSgoPzpcKFteXCldK1wpfFteXChcKV0qKSspXDJcKSk/LwoJfSwKCglsZWZ0TWF0Y2g6IHt9LAoKCWF0dHJNYXA6IHsKCQkiY2xhc3MiOiAiY2xhc3NOYW1lIiwKCQkiZm9yIjogImh0bWxGb3IiCgl9LAoKCWF0dHJIYW5kbGU6IHsKCQlocmVmOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCAiaHJlZiIgKTsKCQl9LAoJCXR5cGU6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoICJ0eXBlIiApOwoJCX0KCX0sCgoJcmVsYXRpdmU6IHsKCQkiKyI6IGZ1bmN0aW9uKGNoZWNrU2V0LCBwYXJ0KXsKCQkJdmFyIGlzUGFydFN0ciA9IHR5cGVvZiBwYXJ0ID09PSAic3RyaW5nIiwKCQkJCWlzVGFnID0gaXNQYXJ0U3RyICYmICFyTm9uV29yZC50ZXN0KCBwYXJ0ICksCgkJCQlpc1BhcnRTdHJOb3RUYWcgPSBpc1BhcnRTdHIgJiYgIWlzVGFnOwoKCQkJaWYgKCBpc1RhZyApIHsKCQkJCXBhcnQgPSBwYXJ0LnRvTG93ZXJDYXNlKCk7CgkJCX0KCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNoZWNrU2V0Lmxlbmd0aCwgZWxlbTsgaSA8IGw7IGkrKyApIHsKCQkJCWlmICggKGVsZW0gPSBjaGVja1NldFtpXSkgKSB7CgkJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW0ucHJldmlvdXNTaWJsaW5nKSAmJiBlbGVtLm5vZGVUeXBlICE9PSAxICkge30KCgkJCQkJY2hlY2tTZXRbaV0gPSBpc1BhcnRTdHJOb3RUYWcgfHwgZWxlbSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHBhcnQgPwoJCQkJCQllbGVtIHx8IGZhbHNlIDoKCQkJCQkJZWxlbSA9PT0gcGFydDsKCQkJCX0KCQkJfQoKCQkJaWYgKCBpc1BhcnRTdHJOb3RUYWcgKSB7CgkJCQlTaXp6bGUuZmlsdGVyKCBwYXJ0LCBjaGVja1NldCwgdHJ1ZSApOwoJCQl9CgkJfSwKCgkJIj4iOiBmdW5jdGlvbiggY2hlY2tTZXQsIHBhcnQgKSB7CgkJCXZhciBlbGVtLAoJCQkJaXNQYXJ0U3RyID0gdHlwZW9mIHBhcnQgPT09ICJzdHJpbmciLAoJCQkJaSA9IDAsCgkJCQlsID0gY2hlY2tTZXQubGVuZ3RoOwoKCQkJaWYgKCBpc1BhcnRTdHIgJiYgIXJOb25Xb3JkLnRlc3QoIHBhcnQgKSApIHsKCQkJCXBhcnQgPSBwYXJ0LnRvTG93ZXJDYXNlKCk7CgoJCQkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQkJCWVsZW0gPSBjaGVja1NldFtpXTsKCgkJCQkJaWYgKCBlbGVtICkgewoJCQkJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoJCQkJCQljaGVja1NldFtpXSA9IHBhcmVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBwYXJ0ID8gcGFyZW50IDogZmFsc2U7CgkJCQkJfQoJCQkJfQoKCQkJfSBlbHNlIHsKCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCQllbGVtID0gY2hlY2tTZXRbaV07CgoJCQkJCWlmICggZWxlbSApIHsKCQkJCQkJY2hlY2tTZXRbaV0gPSBpc1BhcnRTdHIgPwoJCQkJCQkJZWxlbS5wYXJlbnROb2RlIDoKCQkJCQkJCWVsZW0ucGFyZW50Tm9kZSA9PT0gcGFydDsKCQkJCQl9CgkJCQl9CgoJCQkJaWYgKCBpc1BhcnRTdHIgKSB7CgkJCQkJU2l6emxlLmZpbHRlciggcGFydCwgY2hlY2tTZXQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX0sCgoJCSIiOiBmdW5jdGlvbihjaGVja1NldCwgcGFydCwgaXNYTUwpewoJCQl2YXIgbm9kZUNoZWNrLAoJCQkJZG9uZU5hbWUgPSBkb25lKyssCgkJCQljaGVja0ZuID0gZGlyQ2hlY2s7CgoJCQlpZiAoIHR5cGVvZiBwYXJ0ID09PSAic3RyaW5nIiAmJiAhck5vbldvcmQudGVzdCggcGFydCApICkgewoJCQkJcGFydCA9IHBhcnQudG9Mb3dlckNhc2UoKTsKCQkJCW5vZGVDaGVjayA9IHBhcnQ7CgkJCQljaGVja0ZuID0gZGlyTm9kZUNoZWNrOwoJCQl9CgoJCQljaGVja0ZuKCAicGFyZW50Tm9kZSIsIHBhcnQsIGRvbmVOYW1lLCBjaGVja1NldCwgbm9kZUNoZWNrLCBpc1hNTCApOwoJCX0sCgoJCSJ+IjogZnVuY3Rpb24oIGNoZWNrU2V0LCBwYXJ0LCBpc1hNTCApIHsKCQkJdmFyIG5vZGVDaGVjaywKCQkJCWRvbmVOYW1lID0gZG9uZSsrLAoJCQkJY2hlY2tGbiA9IGRpckNoZWNrOwoKCQkJaWYgKCB0eXBlb2YgcGFydCA9PT0gInN0cmluZyIgJiYgIXJOb25Xb3JkLnRlc3QoIHBhcnQgKSApIHsKCQkJCXBhcnQgPSBwYXJ0LnRvTG93ZXJDYXNlKCk7CgkJCQlub2RlQ2hlY2sgPSBwYXJ0OwoJCQkJY2hlY2tGbiA9IGRpck5vZGVDaGVjazsKCQkJfQoKCQkJY2hlY2tGbiggInByZXZpb3VzU2libGluZyIsIHBhcnQsIGRvbmVOYW1lLCBjaGVja1NldCwgbm9kZUNoZWNrLCBpc1hNTCApOwoJCX0KCX0sCgoJZmluZDogewoJCUlEOiBmdW5jdGlvbiggbWF0Y2gsIGNvbnRleHQsIGlzWE1MICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiAhaXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQobWF0Y2hbMV0pOwoJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCXJldHVybiBtICYmIG0ucGFyZW50Tm9kZSA/IFttXSA6IFtdOwoJCQl9CgkJfSwKCgkJTkFNRTogZnVuY3Rpb24oIG1hdGNoLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlOYW1lICE9PSAidW5kZWZpbmVkIiApIHsKCQkJCXZhciByZXQgPSBbXSwKCQkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5TmFtZSggbWF0Y2hbMV0gKTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSByZXN1bHRzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCQlpZiAoIHJlc3VsdHNbaV0uZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09IG1hdGNoWzFdICkgewoJCQkJCQlyZXQucHVzaCggcmVzdWx0c1tpXSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IG51bGwgOiByZXQ7CgkJCX0KCQl9LAoKCQlUQUc6IGZ1bmN0aW9uKCBtYXRjaCwgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggbWF0Y2hbMV0gKTsKCQkJfQoJCX0KCX0sCglwcmVGaWx0ZXI6IHsKCQlDTEFTUzogZnVuY3Rpb24oIG1hdGNoLCBjdXJMb29wLCBpbnBsYWNlLCByZXN1bHQsIG5vdCwgaXNYTUwgKSB7CgkJCW1hdGNoID0gIiAiICsgbWF0Y2hbMV0ucmVwbGFjZSggckJhY2tzbGFzaCwgIiIgKSArICIgIjsKCgkJCWlmICggaXNYTUwgKSB7CgkJCQlyZXR1cm4gbWF0Y2g7CgkJCX0KCgkJCWZvciAoIHZhciBpID0gMCwgZWxlbTsgKGVsZW0gPSBjdXJMb29wW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGVsZW0gKSB7CgkJCQkJaWYgKCBub3QgXiAoZWxlbS5jbGFzc05hbWUgJiYgKCIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCAiICIpLmluZGV4T2YobWF0Y2gpID49IDApICkgewoJCQkJCQlpZiAoICFpbnBsYWNlICkgewoJCQkJCQkJcmVzdWx0LnB1c2goIGVsZW0gKTsKCQkJCQkJfQoKCQkJCQl9IGVsc2UgaWYgKCBpbnBsYWNlICkgewoJCQkJCQljdXJMb29wW2ldID0gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgkJfSwKCgkJSUQ6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJcmV0dXJuIG1hdGNoWzFdLnJlcGxhY2UoIHJCYWNrc2xhc2gsICIiICk7CgkJfSwKCgkJVEFHOiBmdW5jdGlvbiggbWF0Y2gsIGN1ckxvb3AgKSB7CgkJCXJldHVybiBtYXRjaFsxXS5yZXBsYWNlKCByQmFja3NsYXNoLCAiIiApLnRvTG93ZXJDYXNlKCk7CgkJfSwKCgkJQ0hJTEQ6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJaWYgKCBtYXRjaFsxXSA9PT0gIm50aCIgKSB7CgkJCQlpZiAoICFtYXRjaFsyXSApIHsKCQkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCQl9CgoJCQkJbWF0Y2hbMl0gPSBtYXRjaFsyXS5yZXBsYWNlKC9eXCt8XHMqL2csICcnKTsKCgkJCQkvLyBwYXJzZSBlcXVhdGlvbnMgbGlrZSAnZXZlbicsICdvZGQnLCAnNScsICcybicsICczbisyJywgJzRuLTEnLCAnLW4rNicKCQkJCXZhciB0ZXN0ID0gLygtPykoXGQqKSg/Om4oWytcLV0/XGQqKSk/Ly5leGVjKAoJCQkJCW1hdGNoWzJdID09PSAiZXZlbiIgJiYgIjJuIiB8fCBtYXRjaFsyXSA9PT0gIm9kZCIgJiYgIjJuKzEiIHx8CgkJCQkJIS9cRC8udGVzdCggbWF0Y2hbMl0gKSAmJiAiMG4rIiArIG1hdGNoWzJdIHx8IG1hdGNoWzJdKTsKCgkJCQkvLyBjYWxjdWxhdGUgdGhlIG51bWJlcnMgKGZpcnN0KW4rKGxhc3QpIGluY2x1ZGluZyBpZiB0aGV5IGFyZSBuZWdhdGl2ZQoJCQkJbWF0Y2hbMl0gPSAodGVzdFsxXSArICh0ZXN0WzJdIHx8IDEpKSAtIDA7CgkJCQltYXRjaFszXSA9IHRlc3RbM10gLSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtYXRjaFsyXSApIHsKCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJfQoKCQkJLy8gVE9ETzogTW92ZSB0byBub3JtYWwgY2FjaGluZyBzeXN0ZW0KCQkJbWF0Y2hbMF0gPSBkb25lKys7CgoJCQlyZXR1cm4gbWF0Y2g7CgkJfSwKCgkJQVRUUjogZnVuY3Rpb24oIG1hdGNoLCBjdXJMb29wLCBpbnBsYWNlLCByZXN1bHQsIG5vdCwgaXNYTUwgKSB7CgkJCXZhciBuYW1lID0gbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCByQmFja3NsYXNoLCAiIiApOwoJCQkKCQkJaWYgKCAhaXNYTUwgJiYgRXhwci5hdHRyTWFwW25hbWVdICkgewoJCQkJbWF0Y2hbMV0gPSBFeHByLmF0dHJNYXBbbmFtZV07CgkJCX0KCgkJCS8vIEhhbmRsZSBpZiBhbiB1bi1xdW90ZWQgdmFsdWUgd2FzIHVzZWQKCQkJbWF0Y2hbNF0gPSAoIG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggckJhY2tzbGFzaCwgIiIgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFs0XSA9ICIgIiArIG1hdGNoWzRdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2g7CgkJfSwKCgkJUFNFVURPOiBmdW5jdGlvbiggbWF0Y2gsIGN1ckxvb3AsIGlucGxhY2UsIHJlc3VsdCwgbm90ICkgewoJCQlpZiAoIG1hdGNoWzFdID09PSAibm90IiApIHsKCQkJCS8vIElmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGNvbXBsZXggZXhwcmVzc2lvbiwgb3IgYSBzaW1wbGUgb25lCgkJCQlpZiAoICggY2h1bmtlci5leGVjKG1hdGNoWzNdKSB8fCAiIiApLmxlbmd0aCA+IDEgfHwgL15cdy8udGVzdChtYXRjaFszXSkgKSB7CgkJCQkJbWF0Y2hbM10gPSBTaXp6bGUobWF0Y2hbM10sIG51bGwsIG51bGwsIGN1ckxvb3ApOwoKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHJldCA9IFNpenpsZS5maWx0ZXIobWF0Y2hbM10sIGN1ckxvb3AsIGlucGxhY2UsIHRydWUgXiBub3QpOwoKCQkJCQlpZiAoICFpbnBsYWNlICkgewoJCQkJCQlyZXN1bHQucHVzaC5hcHBseSggcmVzdWx0LCByZXQgKTsKCQkJCQl9CgoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIEV4cHIubWF0Y2guUE9TLnRlc3QoIG1hdGNoWzBdICkgfHwgRXhwci5tYXRjaC5DSElMRC50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQkJCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQlQT1M6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2gudW5zaGlmdCggdHJ1ZSApOwoKCQkJcmV0dXJuIG1hdGNoOwoJCX0KCX0sCgkKCWZpbHRlcnM6IHsKCQllbmFibGVkOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlICYmIGVsZW0udHlwZSAhPT0gImhpZGRlbiI7CgkJfSwKCgkJZGlzYWJsZWQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQl9LAoKCQljaGVja2VkOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uY2hlY2tlZCA9PT0gdHJ1ZTsKCQl9LAoJCQoJCXNlbGVjdGVkOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gQWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgbWFrZXMgc2VsZWN0ZWQtYnktZGVmYXVsdAoJCQkvLyBvcHRpb25zIGluIFNhZmFyaSB3b3JrIHByb3Blcmx5CgkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CgkJCX0KCQkJCgkJCXJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlOwoJCX0sCgoJCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhIWVsZW0uZmlyc3RDaGlsZDsKCQl9LAoKCQllbXB0eTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhZWxlbS5maXJzdENoaWxkOwoJCX0sCgoJCWhhczogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkgewoJCQlyZXR1cm4gISFTaXp6bGUoIG1hdGNoWzNdLCBlbGVtICkubGVuZ3RoOwoJCX0sCgoJCWhlYWRlcjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAoL2hcZC9pKS50ZXN0KCBlbGVtLm5vZGVOYW1lICk7CgkJfSwKCgkJdGV4dDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoICJ0eXBlIiApLCB0eXBlID0gZWxlbS50eXBlOwoJCQkvLyBJRTYgYW5kIDcgd2lsbCBtYXAgZWxlbS50eXBlIHRvICd0ZXh0JyBmb3IgbmV3IEhUTUw1IHR5cGVzIChzZWFyY2gsIGV0YykgCgkJCS8vIHVzZSBnZXRBdHRyaWJ1dGUgaW5zdGVhZCB0byB0ZXN0IHRoaXMgY2FzZQoJCQlyZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICYmICJ0ZXh0IiA9PT0gdHlwZSAmJiAoIGF0dHIgPT09IHR5cGUgfHwgYXR0ciA9PT0gbnVsbCApOwoJCX0sCgoJCXJhZGlvOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJiAicmFkaW8iID09PSBlbGVtLnR5cGU7CgkJfSwKCgkJY2hlY2tib3g6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICYmICJjaGVja2JveCIgPT09IGVsZW0udHlwZTsKCQl9LAoKCQlmaWxlOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJiAiZmlsZSIgPT09IGVsZW0udHlwZTsKCQl9LAoKCQlwYXNzd29yZDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCIgJiYgInBhc3N3b3JkIiA9PT0gZWxlbS50eXBlOwoJCX0sCgoJCXN1Ym1pdDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5hbWUgPT09ICJpbnB1dCIgfHwgbmFtZSA9PT0gImJ1dHRvbiIpICYmICJzdWJtaXQiID09PSBlbGVtLnR5cGU7CgkJfSwKCgkJaW1hZ2U6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICYmICJpbWFnZSIgPT09IGVsZW0udHlwZTsKCQl9LAoKCQlyZXNldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5hbWUgPT09ICJpbnB1dCIgfHwgbmFtZSA9PT0gImJ1dHRvbiIpICYmICJyZXNldCIgPT09IGVsZW0udHlwZTsKCQl9LAoKCQlidXR0b246IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgImJ1dHRvbiIgPT09IGVsZW0udHlwZSB8fCBuYW1lID09PSAiYnV0dG9uIjsKCQl9LAoKCQlpbnB1dDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAoL2lucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24vaSkudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCWZvY3VzOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGVsZW0ub3duZXJEb2N1bWVudC5hY3RpdmVFbGVtZW50OwoJCX0KCX0sCglzZXRGaWx0ZXJzOiB7CgkJZmlyc3Q6IGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gaSA9PT0gMDsKCQl9LAoKCQlsYXN0OiBmdW5jdGlvbiggZWxlbSwgaSwgbWF0Y2gsIGFycmF5ICkgewoJCQlyZXR1cm4gaSA9PT0gYXJyYXkubGVuZ3RoIC0gMTsKCQl9LAoKCQlldmVuOiBmdW5jdGlvbiggZWxlbSwgaSApIHsKCQkJcmV0dXJuIGkgJSAyID09PSAwOwoJCX0sCgoJCW9kZDogZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCXJldHVybiBpICUgMiA9PT0gMTsKCQl9LAoKCQlsdDogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkgewoJCQlyZXR1cm4gaSA8IG1hdGNoWzNdIC0gMDsKCQl9LAoKCQlndDogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkgewoJCQlyZXR1cm4gaSA+IG1hdGNoWzNdIC0gMDsKCQl9LAoKCQludGg6IGZ1bmN0aW9uKCBlbGVtLCBpLCBtYXRjaCApIHsKCQkJcmV0dXJuIG1hdGNoWzNdIC0gMCA9PT0gaTsKCQl9LAoKCQllcTogZnVuY3Rpb24oIGVsZW0sIGksIG1hdGNoICkgewoJCQlyZXR1cm4gbWF0Y2hbM10gLSAwID09PSBpOwoJCX0KCX0sCglmaWx0ZXI6IHsKCQlQU0VVRE86IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCwgaSwgYXJyYXkgKSB7CgkJCXZhciBuYW1lID0gbWF0Y2hbMV0sCgkJCQlmaWx0ZXIgPSBFeHByLmZpbHRlcnNbIG5hbWUgXTsKCgkJCWlmICggZmlsdGVyICkgewoJCQkJcmV0dXJuIGZpbHRlciggZWxlbSwgaSwgbWF0Y2gsIGFycmF5ICk7CgoJCQl9IGVsc2UgaWYgKCBuYW1lID09PSAiY29udGFpbnMiICkgewoJCQkJcmV0dXJuIChlbGVtLnRleHRDb250ZW50IHx8IGVsZW0uaW5uZXJUZXh0IHx8IGdldFRleHQoWyBlbGVtIF0pIHx8ICIiKS5pbmRleE9mKG1hdGNoWzNdKSA+PSAwOwoKCQkJfSBlbHNlIGlmICggbmFtZSA9PT0gIm5vdCIgKSB7CgkJCQl2YXIgbm90ID0gbWF0Y2hbM107CgoJCQkJZm9yICggdmFyIGogPSAwLCBsID0gbm90Lmxlbmd0aDsgaiA8IGw7IGorKyApIHsKCQkJCQlpZiAoIG5vdFtqXSA9PT0gZWxlbSApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0gZWxzZSB7CgkJCQlTaXp6bGUuZXJyb3IoIG5hbWUgKTsKCQkJfQoJCX0sCgoJCUNISUxEOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2ggKSB7CgkJCXZhciBmaXJzdCwgbGFzdCwKCQkJCWRvbmVOYW1lLCBwYXJlbnQsIGNhY2hlLAoJCQkJY291bnQsIGRpZmYsCgkJCQl0eXBlID0gbWF0Y2hbMV0sCgkJCQlub2RlID0gZWxlbTsKCgkJCXN3aXRjaCAoIHR5cGUgKSB7CgkJCQljYXNlICJvbmx5IjoKCQkJCWNhc2UgImZpcnN0IjoKCQkJCQl3aGlsZSAoIChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpICkJIHsKCQkJCQkJaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICkgeyAKCQkJCQkJCXJldHVybiBmYWxzZTsgCgkJCQkJCX0KCQkJCQl9CgoJCQkJCWlmICggdHlwZSA9PT0gImZpcnN0IiApIHsgCgkJCQkJCXJldHVybiB0cnVlOyAKCQkJCQl9CgoJCQkJCW5vZGUgPSBlbGVtOwoKCQkJCWNhc2UgImxhc3QiOgoJCQkJCXdoaWxlICggKG5vZGUgPSBub2RlLm5leHRTaWJsaW5nKSApCSB7CgkJCQkJCWlmICggbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsgCgkJCQkJCQlyZXR1cm4gZmFsc2U7IAoJCQkJCQl9CgkJCQkJfQoKCQkJCQlyZXR1cm4gdHJ1ZTsKCgkJCQljYXNlICJudGgiOgoJCQkJCWZpcnN0ID0gbWF0Y2hbMl07CgkJCQkJbGFzdCA9IG1hdGNoWzNdOwoKCQkJCQlpZiAoIGZpcnN0ID09PSAxICYmIGxhc3QgPT09IDAgKSB7CgkJCQkJCXJldHVybiB0cnVlOwoJCQkJCX0KCQkJCQkKCQkJCQlkb25lTmFtZSA9IG1hdGNoWzBdOwoJCQkJCXBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCQoJCQkJCWlmICggcGFyZW50ICYmIChwYXJlbnRbIGV4cGFuZG8gXSAhPT0gZG9uZU5hbWUgfHwgIWVsZW0ubm9kZUluZGV4KSApIHsKCQkJCQkJY291bnQgPSAwOwoJCQkJCQkKCQkJCQkJZm9yICggbm9kZSA9IHBhcmVudC5maXJzdENoaWxkOyBub2RlOyBub2RlID0gbm9kZS5uZXh0U2libGluZyApIHsKCQkJCQkJCWlmICggbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCQlub2RlLm5vZGVJbmRleCA9ICsrY291bnQ7CgkJCQkJCQl9CgkJCQkJCX0gCgoJCQkJCQlwYXJlbnRbIGV4cGFuZG8gXSA9IGRvbmVOYW1lOwoJCQkJCX0KCQkJCQkKCQkJCQlkaWZmID0gZWxlbS5ub2RlSW5kZXggLSBsYXN0OwoKCQkJCQlpZiAoIGZpcnN0ID09PSAwICkgewoJCQkJCQlyZXR1cm4gZGlmZiA9PT0gMDsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0dXJuICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJfQoJCQl9CgkJfSwKCgkJSUQ6IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCApIHsKCQkJcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IG1hdGNoOwoJCX0sCgoJCVRBRzogZnVuY3Rpb24oIGVsZW0sIG1hdGNoICkgewoJCQlyZXR1cm4gKG1hdGNoID09PSAiKiIgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgfHwgISFlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2g7CgkJfSwKCQkKCQlDTEFTUzogZnVuY3Rpb24oIGVsZW0sIG1hdGNoICkgewoJCQlyZXR1cm4gKCIgIiArIChlbGVtLmNsYXNzTmFtZSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkgKyAiICIpCgkJCQkuaW5kZXhPZiggbWF0Y2ggKSA+IC0xOwoJCX0sCgoJCUFUVFI6IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCApIHsKCQkJdmFyIG5hbWUgPSBtYXRjaFsxXSwKCQkJCXJlc3VsdCA9IFNpenpsZS5hdHRyID8KCQkJCQlTaXp6bGUuYXR0ciggZWxlbSwgbmFtZSApIDoKCQkJCQlFeHByLmF0dHJIYW5kbGVbIG5hbWUgXSA/CgkJCQkJRXhwci5hdHRySGFuZGxlWyBuYW1lIF0oIGVsZW0gKSA6CgkJCQkJZWxlbVsgbmFtZSBdICE9IG51bGwgPwoJCQkJCQllbGVtWyBuYW1lIF0gOgoJCQkJCQllbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApLAoJCQkJdmFsdWUgPSByZXN1bHQgKyAiIiwKCQkJCXR5cGUgPSBtYXRjaFsyXSwKCQkJCWNoZWNrID0gbWF0Y2hbNF07CgoJCQlyZXR1cm4gcmVzdWx0ID09IG51bGwgPwoJCQkJdHlwZSA9PT0gIiE9IiA6CgkJCQkhdHlwZSAmJiBTaXp6bGUuYXR0ciA/CgkJCQlyZXN1bHQgIT0gbnVsbCA6CgkJCQl0eXBlID09PSAiPSIgPwoJCQkJdmFsdWUgPT09IGNoZWNrIDoKCQkJCXR5cGUgPT09ICIqPSIgPwoJCQkJdmFsdWUuaW5kZXhPZihjaGVjaykgPj0gMCA6CgkJCQl0eXBlID09PSAifj0iID8KCQkJCSgiICIgKyB2YWx1ZSArICIgIikuaW5kZXhPZihjaGVjaykgPj0gMCA6CgkJCQkhY2hlY2sgPwoJCQkJdmFsdWUgJiYgcmVzdWx0ICE9PSBmYWxzZSA6CgkJCQl0eXBlID09PSAiIT0iID8KCQkJCXZhbHVlICE9PSBjaGVjayA6CgkJCQl0eXBlID09PSAiXj0iID8KCQkJCXZhbHVlLmluZGV4T2YoY2hlY2spID09PSAwIDoKCQkJCXR5cGUgPT09ICIkPSIgPwoJCQkJdmFsdWUuc3Vic3RyKHZhbHVlLmxlbmd0aCAtIGNoZWNrLmxlbmd0aCkgPT09IGNoZWNrIDoKCQkJCXR5cGUgPT09ICJ8PSIgPwoJCQkJdmFsdWUgPT09IGNoZWNrIHx8IHZhbHVlLnN1YnN0cigwLCBjaGVjay5sZW5ndGggKyAxKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJZmFsc2U7CgkJfSwKCgkJUE9TOiBmdW5jdGlvbiggZWxlbSwgbWF0Y2gsIGksIGFycmF5ICkgewoJCQl2YXIgbmFtZSA9IG1hdGNoWzJdLAoJCQkJZmlsdGVyID0gRXhwci5zZXRGaWx0ZXJzWyBuYW1lIF07CgoJCQlpZiAoIGZpbHRlciApIHsKCQkJCXJldHVybiBmaWx0ZXIoIGVsZW0sIGksIG1hdGNoLCBhcnJheSApOwoJCQl9CgkJfQoJfQp9OwoKdmFyIG9yaWdQT1MgPSBFeHByLm1hdGNoLlBPUywKCWZlc2NhcGUgPSBmdW5jdGlvbihhbGwsIG51bSl7CgkJcmV0dXJuICJcXCIgKyAobnVtIC0gMCArIDEpOwoJfTsKCmZvciAoIHZhciB0eXBlIGluIEV4cHIubWF0Y2ggKSB7CglFeHByLm1hdGNoWyB0eXBlIF0gPSBuZXcgUmVnRXhwKCBFeHByLm1hdGNoWyB0eXBlIF0uc291cmNlICsgKC8oPyFbXlxbXSpcXSkoPyFbXlwoXSpcKSkvLnNvdXJjZSkgKTsKCUV4cHIubGVmdE1hdGNoWyB0eXBlIF0gPSBuZXcgUmVnRXhwKCAvKF4oPzoufFxyfFxuKSo/KS8uc291cmNlICsgRXhwci5tYXRjaFsgdHlwZSBdLnNvdXJjZS5yZXBsYWNlKC9cXChcZCspL2csIGZlc2NhcGUpICk7Cn0KCnZhciBtYWtlQXJyYXkgPSBmdW5jdGlvbiggYXJyYXksIHJlc3VsdHMgKSB7CglhcnJheSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcnJheSwgMCApOwoKCWlmICggcmVzdWx0cyApIHsKCQlyZXN1bHRzLnB1c2guYXBwbHkoIHJlc3VsdHMsIGFycmF5ICk7CgkJcmV0dXJuIHJlc3VsdHM7Cgl9CgkKCXJldHVybiBhcnJheTsKfTsKCi8vIFBlcmZvcm0gYSBzaW1wbGUgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRoZSBicm93c2VyIGlzIGNhcGFibGUgb2YKLy8gY29udmVydGluZyBhIE5vZGVMaXN0IHRvIGFuIGFycmF5IHVzaW5nIGJ1aWx0aW4gbWV0aG9kcy4KLy8gQWxzbyB2ZXJpZmllcyB0aGF0IHRoZSByZXR1cm5lZCBhcnJheSBob2xkcyBET00gbm9kZXMKLy8gKHdoaWNoIGlzIG5vdCB0aGUgY2FzZSBpbiB0aGUgQmxhY2tiZXJyeSBicm93c2VyKQp0cnkgewoJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLCAwIClbMF0ubm9kZVR5cGU7CgovLyBQcm92aWRlIGEgZmFsbGJhY2sgbWV0aG9kIGlmIGl0IGRvZXMgbm90IHdvcmsKfSBjYXRjaCggZSApIHsKCW1ha2VBcnJheSA9IGZ1bmN0aW9uKCBhcnJheSwgcmVzdWx0cyApIHsKCQl2YXIgaSA9IDAsCgkJCXJldCA9IHJlc3VsdHMgfHwgW107CgoJCWlmICggdG9TdHJpbmcuY2FsbChhcnJheSkgPT09ICJbb2JqZWN0IEFycmF5XSIgKSB7CgkJCUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KCByZXQsIGFycmF5ICk7CgoJCX0gZWxzZSB7CgkJCWlmICggdHlwZW9mIGFycmF5Lmxlbmd0aCA9PT0gIm51bWJlciIgKSB7CgkJCQlmb3IgKCB2YXIgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCQlyZXQucHVzaCggYXJyYXlbaV0gKTsKCQkJCX0KCgkJCX0gZWxzZSB7CgkJCQlmb3IgKCA7IGFycmF5W2ldOyBpKysgKSB7CgkJCQkJcmV0LnB1c2goIGFycmF5W2ldICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9Owp9Cgp2YXIgc29ydE9yZGVyLCBzaWJsaW5nQ2hlY2s7CgppZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApIHsKCXNvcnRPcmRlciA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQlpZiAoICFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIHx8ICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICkgewoJCQlyZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/IC0xIDogMTsKCQl9CgoJCXJldHVybiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgNCA/IC0xIDogMTsKCX07Cgp9IGVsc2UgewoJc29ydE9yZGVyID0gZnVuY3Rpb24oIGEsIGIgKSB7CgkJLy8gVGhlIG5vZGVzIGFyZSBpZGVudGljYWwsIHdlIGNhbiBleGl0IGVhcmx5CgkJaWYgKCBhID09PSBiICkgewoJCQloYXNEdXBsaWNhdGUgPSB0cnVlOwoJCQlyZXR1cm4gMDsKCgkJLy8gRmFsbGJhY2sgdG8gdXNpbmcgc291cmNlSW5kZXggKGluIElFKSBpZiBpdCdzIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCgkJfSBlbHNlIGlmICggYS5zb3VyY2VJbmRleCAmJiBiLnNvdXJjZUluZGV4ICkgewoJCQlyZXR1cm4gYS5zb3VyY2VJbmRleCAtIGIuc291cmNlSW5kZXg7CgkJfQoKCQl2YXIgYWwsIGJsLAoJCQlhcCA9IFtdLAoJCQlicCA9IFtdLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJY3VyID0gYXVwOwoKCQkvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzIChvciBpZGVudGljYWwpIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrCgkJaWYgKCBhdXAgPT09IGJ1cCApIHsKCQkJcmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApOwoKCQkvLyBJZiBubyBwYXJlbnRzIHdlcmUgZm91bmQgdGhlbiB0aGUgbm9kZXMgYXJlIGRpc2Nvbm5lY3RlZAoJCX0gZWxzZSBpZiAoICFhdXAgKSB7CgkJCXJldHVybiAtMTsKCgkJfSBlbHNlIGlmICggIWJ1cCApIHsKCQkJcmV0dXJuIDE7CgkJfQoKCQkvLyBPdGhlcndpc2UgdGhleSdyZSBzb21ld2hlcmUgZWxzZSBpbiB0aGUgdHJlZSBzbyB3ZSBuZWVkCgkJLy8gdG8gYnVpbGQgdXAgYSBmdWxsIGxpc3Qgb2YgdGhlIHBhcmVudE5vZGVzIGZvciBjb21wYXJpc29uCgkJd2hpbGUgKCBjdXIgKSB7CgkJCWFwLnVuc2hpZnQoIGN1ciApOwoJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQl9CgoJCWN1ciA9IGJ1cDsKCgkJd2hpbGUgKCBjdXIgKSB7CgkJCWJwLnVuc2hpZnQoIGN1ciApOwoJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQl9CgoJCWFsID0gYXAubGVuZ3RoOwoJCWJsID0gYnAubGVuZ3RoOwoKCQkvLyBTdGFydCB3YWxraW5nIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeQoJCWZvciAoIHZhciBpID0gMDsgaSA8IGFsICYmIGkgPCBibDsgaSsrICkgewoJCQlpZiAoIGFwW2ldICE9PSBicFtpXSApIHsKCQkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApOwoJCQl9CgkJfQoKCQkvLyBXZSBlbmRlZCBzb21lcGxhY2UgdXAgdGhlIHRyZWUgc28gZG8gYSBzaWJsaW5nIGNoZWNrCgkJcmV0dXJuIGkgPT09IGFsID8KCQkJc2libGluZ0NoZWNrKCBhLCBicFtpXSwgLTEgKSA6CgkJCXNpYmxpbmdDaGVjayggYXBbaV0sIGIsIDEgKTsKCX07CgoJc2libGluZ0NoZWNrID0gZnVuY3Rpb24oIGEsIGIsIHJldCApIHsKCQlpZiAoIGEgPT09IGIgKSB7CgkJCXJldHVybiByZXQ7CgkJfQoKCQl2YXIgY3VyID0gYS5uZXh0U2libGluZzsKCgkJd2hpbGUgKCBjdXIgKSB7CgkJCWlmICggY3VyID09PSBiICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgoJCQljdXIgPSBjdXIubmV4dFNpYmxpbmc7CgkJfQoKCQlyZXR1cm4gMTsKCX07Cn0KCi8vIENoZWNrIHRvIHNlZSBpZiB0aGUgYnJvd3NlciByZXR1cm5zIGVsZW1lbnRzIGJ5IG5hbWUgd2hlbgovLyBxdWVyeWluZyBieSBnZXRFbGVtZW50QnlJZCAoYW5kIHByb3ZpZGUgYSB3b3JrYXJvdW5kKQooZnVuY3Rpb24oKXsKCS8vIFdlJ3JlIGdvaW5nIHRvIGluamVjdCBhIGZha2UgaW5wdXQgZWxlbWVudCB3aXRoIGEgc3BlY2lmaWVkIG5hbWUKCXZhciBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksCgkJaWQgPSAic2NyaXB0IiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCksCgkJcm9vdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCglmb3JtLmlubmVySFRNTCA9ICI8YSBuYW1lPSciICsgaWQgKyAiJy8+IjsKCgkvLyBJbmplY3QgaXQgaW50byB0aGUgcm9vdCBlbGVtZW50LCBjaGVjayBpdHMgc3RhdHVzLCBhbmQgcmVtb3ZlIGl0IHF1aWNrbHkKCXJvb3QuaW5zZXJ0QmVmb3JlKCBmb3JtLCByb290LmZpcnN0Q2hpbGQgKTsKCgkvLyBUaGUgd29ya2Fyb3VuZCBoYXMgdG8gZG8gYWRkaXRpb25hbCBjaGVja3MgYWZ0ZXIgYSBnZXRFbGVtZW50QnlJZAoJLy8gV2hpY2ggc2xvd3MgdGhpbmdzIGRvd24gZm9yIG90aGVyIGJyb3dzZXJzIChoZW5jZSB0aGUgYnJhbmNoaW5nKQoJaWYgKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggaWQgKSApIHsKCQlFeHByLmZpbmQuSUQgPSBmdW5jdGlvbiggbWF0Y2gsIGNvbnRleHQsIGlzWE1MICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiAhaXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQobWF0Y2hbMV0pOwoKCQkJCXJldHVybiBtID8KCQkJCQltLmlkID09PSBtYXRjaFsxXSB8fCB0eXBlb2YgbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSAidW5kZWZpbmVkIiAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikubm9kZVZhbHVlID09PSBtYXRjaFsxXSA/CgkJCQkJCVttXSA6CgkJCQkJCXVuZGVmaW5lZCA6CgkJCQkJW107CgkJCX0KCQl9OwoKCQlFeHByLmZpbHRlci5JRCA9IGZ1bmN0aW9uKCBlbGVtLCBtYXRjaCApIHsKCQkJdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSAidW5kZWZpbmVkIiAmJiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7CgoJCQlyZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiBub2RlICYmIG5vZGUubm9kZVZhbHVlID09PSBtYXRjaDsKCQl9OwoJfQoKCXJvb3QucmVtb3ZlQ2hpbGQoIGZvcm0gKTsKCgkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJcm9vdCA9IGZvcm0gPSBudWxsOwp9KSgpOwoKKGZ1bmN0aW9uKCl7CgkvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgcmV0dXJucyBvbmx5IGVsZW1lbnRzCgkvLyB3aGVuIGRvaW5nIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikKCgkvLyBDcmVhdGUgYSBmYWtlIGVsZW1lbnQKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCWRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgiIikgKTsKCgkvLyBNYWtlIHN1cmUgbm8gY29tbWVudHMgYXJlIGZvdW5kCglpZiAoIGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aCA+IDAgKSB7CgkJRXhwci5maW5kLlRBRyA9IGZ1bmN0aW9uKCBtYXRjaCwgY29udGV4dCApIHsKCQkJdmFyIHJlc3VsdHMgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBtYXRjaFsxXSApOwoKCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQlpZiAoIG1hdGNoWzFdID09PSAiKiIgKSB7CgkJCQl2YXIgdG1wID0gW107CgoJCQkJZm9yICggdmFyIGkgPSAwOyByZXN1bHRzW2ldOyBpKysgKSB7CgkJCQkJaWYgKCByZXN1bHRzW2ldLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQl0bXAucHVzaCggcmVzdWx0c1tpXSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXN1bHRzID0gdG1wOwoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0czsKCQl9OwoJfQoKCS8vIENoZWNrIHRvIHNlZSBpZiBhbiBhdHRyaWJ1dGUgcmV0dXJucyBub3JtYWxpemVkIGhyZWYgYXR0cmlidXRlcwoJZGl2LmlubmVySFRNTCA9ICI8YSBocmVmPScjJz48L2E+IjsKCglpZiAoIGRpdi5maXJzdENoaWxkICYmIHR5cGVvZiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUgIT09ICJ1bmRlZmluZWQiICYmCgkJCWRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpICE9PSAiIyIgKSB7CgoJCUV4cHIuYXR0ckhhbmRsZS5ocmVmID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggImhyZWYiLCAyICk7CgkJfTsKCX0KCgkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJZGl2ID0gbnVsbDsKfSkoKTsKCmlmICggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCApIHsKCShmdW5jdGlvbigpewoJCXZhciBvbGRTaXp6bGUgPSBTaXp6bGUsCgkJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLAoJCQlpZCA9ICJfX3NpenpsZV9fIjsKCgkJZGl2LmlubmVySFRNTCA9ICI8cCBjbGFzcz0nVEVTVCc+PC9wPiI7CgoJCS8vIFNhZmFyaSBjYW4ndCBoYW5kbGUgdXBwZXJjYXNlIG9yIHVuaWNvZGUgY2hhcmFjdGVycyB3aGVuCgkJLy8gaW4gcXVpcmtzIG1vZGUuCgkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCAmJiBkaXYucXVlcnlTZWxlY3RvckFsbCgiLlRFU1QiKS5sZW5ndGggPT09IDAgKSB7CgkJCXJldHVybjsKCQl9CgkKCQlTaXp6bGUgPSBmdW5jdGlvbiggcXVlcnksIGNvbnRleHQsIGV4dHJhLCBzZWVkICkgewoJCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJCS8vIE9ubHkgdXNlIHF1ZXJ5U2VsZWN0b3JBbGwgb24gbm9uLVhNTCBkb2N1bWVudHMKCQkJLy8gKElEIHNlbGVjdG9ycyBkb24ndCB3b3JrIGluIG5vbi1IVE1MIGRvY3VtZW50cykKCQkJaWYgKCAhc2VlZCAmJiAhU2l6emxlLmlzWE1MKGNvbnRleHQpICkgewoJCQkJLy8gU2VlIGlmIHdlIGZpbmQgYSBzZWxlY3RvciB0byBzcGVlZCB1cAoJCQkJdmFyIG1hdGNoID0gL14oXHcrJCl8XlwuKFtcd1wtXSskKXxeIyhbXHdcLV0rJCkvLmV4ZWMoIHF1ZXJ5ICk7CgkJCQkKCQkJCWlmICggbWF0Y2ggJiYgKGNvbnRleHQubm9kZVR5cGUgPT09IDEgfHwgY29udGV4dC5ub2RlVHlwZSA9PT0gOSkgKSB7CgkJCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiVEFHIikKCQkJCQlpZiAoIG1hdGNoWzFdICkgewoJCQkJCQlyZXR1cm4gbWFrZUFycmF5KCBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBxdWVyeSApLCBleHRyYSApOwoJCQkJCQoJCQkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIi5DTEFTUyIpCgkJCQkJfSBlbHNlIGlmICggbWF0Y2hbMl0gJiYgRXhwci5maW5kLkNMQVNTICYmIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSApIHsKCQkJCQkJcmV0dXJuIG1ha2VBcnJheSggY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCBtYXRjaFsyXSApLCBleHRyYSApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBjb250ZXh0Lm5vZGVUeXBlID09PSA5ICkgewoJCQkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoImJvZHkiKQoJCQkJCS8vIFRoZSBib2R5IGVsZW1lbnQgb25seSBleGlzdHMgb25jZSwgb3B0aW1pemUgZmluZGluZyBpdAoJCQkJCWlmICggcXVlcnkgPT09ICJib2R5IiAmJiBjb250ZXh0LmJvZHkgKSB7CgkJCQkJCXJldHVybiBtYWtlQXJyYXkoIFsgY29udGV4dC5ib2R5IF0sIGV4dHJhICk7CgkJCQkJCQoJCQkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCgkJCQkJfSBlbHNlIGlmICggbWF0Y2ggJiYgbWF0Y2hbM10gKSB7CgkJCQkJCXZhciBlbGVtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggbWF0Y2hbM10gKTsKCgkJCQkJCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zCgkJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBJRSBhbmQgT3BlcmEgcmV0dXJuIGl0ZW1zCgkJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJCWlmICggZWxlbS5pZCA9PT0gbWF0Y2hbM10gKSB7CgkJCQkJCQkJcmV0dXJuIG1ha2VBcnJheSggWyBlbGVtIF0sIGV4dHJhICk7CgkJCQkJCQl9CgkJCQkJCQkKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiBtYWtlQXJyYXkoIFtdLCBleHRyYSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXRyeSB7CgkJCQkJCXJldHVybiBtYWtlQXJyYXkoIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbChxdWVyeSksIGV4dHJhICk7CgkJCQkJfSBjYXRjaChxc2FFcnJvcikge30KCgkJCQkvLyBxU0Egd29ya3Mgc3RyYW5nZWx5IG9uIEVsZW1lbnQtcm9vdGVkIHF1ZXJpZXMKCQkJCS8vIFdlIGNhbiB3b3JrIGFyb3VuZCB0aGlzIGJ5IHNwZWNpZnlpbmcgYW4gZXh0cmEgSUQgb24gdGhlIHJvb3QKCQkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkJLy8gSUUgOCBkb2Vzbid0IHdvcmsgb24gb2JqZWN0IGVsZW1lbnRzCgkJCQl9IGVsc2UgaWYgKCBjb250ZXh0Lm5vZGVUeXBlID09PSAxICYmIGNvbnRleHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gIm9iamVjdCIgKSB7CgkJCQkJdmFyIG9sZENvbnRleHQgPSBjb250ZXh0LAoJCQkJCQlvbGQgPSBjb250ZXh0LmdldEF0dHJpYnV0ZSggImlkIiApLAoJCQkJCQluaWQgPSBvbGQgfHwgaWQsCgkJCQkJCWhhc1BhcmVudCA9IGNvbnRleHQucGFyZW50Tm9kZSwKCQkJCQkJcmVsYXRpdmVIaWVyYXJjaHlTZWxlY3RvciA9IC9eXHMqWyt+XS8udGVzdCggcXVlcnkgKTsKCgkJCQkJaWYgKCAhb2xkICkgewoJCQkJCQljb250ZXh0LnNldEF0dHJpYnV0ZSggImlkIiwgbmlkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmlkID0gbmlkLnJlcGxhY2UoIC8nL2csICJcXCQmIiApOwoJCQkJCX0KCQkJCQlpZiAoIHJlbGF0aXZlSGllcmFyY2h5U2VsZWN0b3IgJiYgaGFzUGFyZW50ICkgewoJCQkJCQljb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlOwoJCQkJCX0KCgkJCQkJdHJ5IHsKCQkJCQkJaWYgKCAhcmVsYXRpdmVIaWVyYXJjaHlTZWxlY3RvciB8fCBoYXNQYXJlbnQgKSB7CgkJCQkJCQlyZXR1cm4gbWFrZUFycmF5KCBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoICJbaWQ9JyIgKyBuaWQgKyAiJ10gIiArIHF1ZXJ5ICksIGV4dHJhICk7CgkJCQkJCX0KCgkJCQkJfSBjYXRjaChwc2V1ZG9FcnJvcikgewoJCQkJCX0gZmluYWxseSB7CgkJCQkJCWlmICggIW9sZCApIHsKCQkJCQkJCW9sZENvbnRleHQucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIG9sZFNpenpsZShxdWVyeSwgY29udGV4dCwgZXh0cmEsIHNlZWQpOwoJCX07CgoJCWZvciAoIHZhciBwcm9wIGluIG9sZFNpenpsZSApIHsKCQkJU2l6emxlWyBwcm9wIF0gPSBvbGRTaXp6bGVbIHByb3AgXTsKCQl9CgoJCS8vIHJlbGVhc2UgbWVtb3J5IGluIElFCgkJZGl2ID0gbnVsbDsKCX0pKCk7Cn0KCihmdW5jdGlvbigpewoJdmFyIGh0bWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCgkJbWF0Y2hlcyA9IGh0bWwubWF0Y2hlc1NlbGVjdG9yIHx8IGh0bWwubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGh0bWwud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGh0bWwubXNNYXRjaGVzU2VsZWN0b3I7CgoJaWYgKCBtYXRjaGVzICkgewoJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCS8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkgZmFpbHMgdGhpcykKCQl2YXIgZGlzY29ubmVjdGVkTWF0Y2ggPSAhbWF0Y2hlcy5jYWxsKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLCAiZGl2IiApLAoJCQlwc2V1ZG9Xb3JrcyA9IGZhbHNlOwoKCQl0cnkgewoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsICJbdGVzdCE9JyddOnNpenpsZSIgKTsKCQoJCX0gY2F0Y2goIHBzZXVkb0Vycm9yICkgewoJCQlwc2V1ZG9Xb3JrcyA9IHRydWU7CgkJfQoKCQlTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24oIG5vZGUsIGV4cHIgKSB7CgkJCS8vIE1ha2Ugc3VyZSB0aGF0IGF0dHJpYnV0ZSBzZWxlY3RvcnMgYXJlIHF1b3RlZAoJCQlleHByID0gZXhwci5yZXBsYWNlKC9cPVxzKihbXiciXF1dKilccypcXS9nLCAiPSckMSddIik7CgoJCQlpZiAoICFTaXp6bGUuaXNYTUwoIG5vZGUgKSApIHsKCQkJCXRyeSB7IAoJCQkJCWlmICggcHNldWRvV29ya3MgfHwgIUV4cHIubWF0Y2guUFNFVURPLnRlc3QoIGV4cHIgKSAmJiAhLyE9Ly50ZXN0KCBleHByICkgKSB7CgkJCQkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIG5vZGUsIGV4cHIgKTsKCgkJCQkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJCQkJaWYgKCByZXQgfHwgIWRpc2Nvbm5lY3RlZE1hdGNoIHx8CgkJCQkJCQkJLy8gQXMgd2VsbCwgZGlzY29ubmVjdGVkIG5vZGVzIGFyZSBzYWlkIHRvIGJlIGluIGEgZG9jdW1lbnQKCQkJCQkJCQkvLyBmcmFnbWVudCBpbiBJRSA5LCBzbyBjaGVjayBmb3IgdGhhdAoJCQkJCQkJCW5vZGUuZG9jdW1lbnQgJiYgbm9kZS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBjYXRjaChlKSB7fQoJCQl9CgoJCQlyZXR1cm4gU2l6emxlKGV4cHIsIG51bGwsIG51bGwsIFtub2RlXSkubGVuZ3RoID4gMDsKCQl9OwoJfQp9KSgpOwoKKGZ1bmN0aW9uKCl7Cgl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgoJZGl2LmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSd0ZXN0IGUnPjwvZGl2PjxkaXYgY2xhc3M9J3Rlc3QnPjwvZGl2PiI7CgoJLy8gT3BlcmEgY2FuJ3QgZmluZCBhIHNlY29uZCBjbGFzc25hbWUgKGluIDkuNikKCS8vIEFsc28sIG1ha2Ugc3VyZSB0aGF0IGdldEVsZW1lbnRzQnlDbGFzc05hbWUgYWN0dWFsbHkgZXhpc3RzCglpZiAoICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSB8fCBkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCA9PT0gMCApIHsKCQlyZXR1cm47Cgl9CgoJLy8gU2FmYXJpIGNhY2hlcyBjbGFzcyBhdHRyaWJ1dGVzLCBkb2Vzbid0IGNhdGNoIGNoYW5nZXMgKGluIDMuMikKCWRpdi5sYXN0Q2hpbGQuY2xhc3NOYW1lID0gImUiOwoKCWlmICggZGl2LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGggPT09IDEgKSB7CgkJcmV0dXJuOwoJfQoJCglFeHByLm9yZGVyLnNwbGljZSgxLCAwLCAiQ0xBU1MiKTsKCUV4cHIuZmluZC5DTEFTUyA9IGZ1bmN0aW9uKCBtYXRjaCwgY29udGV4dCwgaXNYTUwgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSAidW5kZWZpbmVkIiAmJiAhaXNYTUwgKSB7CgkJCXJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobWF0Y2hbMV0pOwoJCX0KCX07CgoJLy8gcmVsZWFzZSBtZW1vcnkgaW4gSUUKCWRpdiA9IG51bGw7Cn0pKCk7CgpmdW5jdGlvbiBkaXJOb2RlQ2hlY2soIGRpciwgY3VyLCBkb25lTmFtZSwgY2hlY2tTZXQsIG5vZGVDaGVjaywgaXNYTUwgKSB7Cglmb3IgKCB2YXIgaSA9IDAsIGwgPSBjaGVja1NldC5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJdmFyIGVsZW0gPSBjaGVja1NldFtpXTsKCgkJaWYgKCBlbGVtICkgewoJCQl2YXIgbWF0Y2ggPSBmYWxzZTsKCgkJCWVsZW0gPSBlbGVtW2Rpcl07CgoJCQl3aGlsZSAoIGVsZW0gKSB7CgkJCQlpZiAoIGVsZW1bIGV4cGFuZG8gXSA9PT0gZG9uZU5hbWUgKSB7CgkJCQkJbWF0Y2ggPSBjaGVja1NldFtlbGVtLnNpenNldF07CgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFpc1hNTCApewoJCQkJCWVsZW1bIGV4cGFuZG8gXSA9IGRvbmVOYW1lOwoJCQkJCWVsZW0uc2l6c2V0ID0gaTsKCQkJCX0KCgkJCQlpZiAoIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gY3VyICkgewoJCQkJCW1hdGNoID0gZWxlbTsKCQkJCQlicmVhazsKCQkJCX0KCgkJCQllbGVtID0gZWxlbVtkaXJdOwoJCQl9CgoJCQljaGVja1NldFtpXSA9IG1hdGNoOwoJCX0KCX0KfQoKZnVuY3Rpb24gZGlyQ2hlY2soIGRpciwgY3VyLCBkb25lTmFtZSwgY2hlY2tTZXQsIG5vZGVDaGVjaywgaXNYTUwgKSB7Cglmb3IgKCB2YXIgaSA9IDAsIGwgPSBjaGVja1NldC5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJdmFyIGVsZW0gPSBjaGVja1NldFtpXTsKCgkJaWYgKCBlbGVtICkgewoJCQl2YXIgbWF0Y2ggPSBmYWxzZTsKCQkJCgkJCWVsZW0gPSBlbGVtW2Rpcl07CgoJCQl3aGlsZSAoIGVsZW0gKSB7CgkJCQlpZiAoIGVsZW1bIGV4cGFuZG8gXSA9PT0gZG9uZU5hbWUgKSB7CgkJCQkJbWF0Y2ggPSBjaGVja1NldFtlbGVtLnNpenNldF07CgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWlmICggIWlzWE1MICkgewoJCQkJCQllbGVtWyBleHBhbmRvIF0gPSBkb25lTmFtZTsKCQkJCQkJZWxlbS5zaXpzZXQgPSBpOwoJCQkJCX0KCgkJCQkJaWYgKCB0eXBlb2YgY3VyICE9PSAic3RyaW5nIiApIHsKCQkJCQkJaWYgKCBlbGVtID09PSBjdXIgKSB7CgkJCQkJCQltYXRjaCA9IHRydWU7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoKCQkJCQl9IGVsc2UgaWYgKCBTaXp6bGUuZmlsdGVyKCBjdXIsIFtlbGVtXSApLmxlbmd0aCA+IDAgKSB7CgkJCQkJCW1hdGNoID0gZWxlbTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoKCQkJCWVsZW0gPSBlbGVtW2Rpcl07CgkJCX0KCgkJCWNoZWNrU2V0W2ldID0gbWF0Y2g7CgkJfQoJfQp9CgppZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jb250YWlucyApIHsKCVNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCXJldHVybiBhICE9PSBiICYmIChhLmNvbnRhaW5zID8gYS5jb250YWlucyhiKSA6IHRydWUpOwoJfTsKCn0gZWxzZSBpZiAoIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApIHsKCVNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCXJldHVybiAhIShhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgMTYpOwoJfTsKCn0gZWxzZSB7CglTaXp6bGUuY29udGFpbnMgPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9Owp9CgpTaXp6bGUuaXNYTUwgPSBmdW5jdGlvbiggZWxlbSApIHsKCS8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3QKCS8vIChzdWNoIGFzIGxvYWRpbmcgaWZyYW1lcyBpbiBJRSAtICM0ODMzKSAKCXZhciBkb2N1bWVudEVsZW1lbnQgPSAoZWxlbSA/IGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtIDogMCkuZG9jdW1lbnRFbGVtZW50OwoKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKdmFyIHBvc1Byb2Nlc3MgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHNlZWQgKSB7Cgl2YXIgbWF0Y2gsCgkJdG1wU2V0ID0gW10sCgkJbGF0ZXIgPSAiIiwKCQlyb290ID0gY29udGV4dC5ub2RlVHlwZSA/IFtjb250ZXh0XSA6IGNvbnRleHQ7CgoJLy8gUG9zaXRpb24gc2VsZWN0b3JzIG11c3QgYmUgZG9uZSBhZnRlciB0aGUgZmlsdGVyCgkvLyBBbmQgc28gbXVzdCA6bm90KHBvc2l0aW9uYWwpIHNvIHdlIG1vdmUgYWxsIFBTRVVET3MgdG8gdGhlIGVuZAoJd2hpbGUgKCAobWF0Y2ggPSBFeHByLm1hdGNoLlBTRVVETy5leGVjKCBzZWxlY3RvciApKSApIHsKCQlsYXRlciArPSBtYXRjaFswXTsKCQlzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UoIEV4cHIubWF0Y2guUFNFVURPLCAiIiApOwoJfQoKCXNlbGVjdG9yID0gRXhwci5yZWxhdGl2ZVtzZWxlY3Rvcl0gPyBzZWxlY3RvciArICIqIiA6IHNlbGVjdG9yOwoKCWZvciAoIHZhciBpID0gMCwgbCA9IHJvb3QubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCVNpenpsZSggc2VsZWN0b3IsIHJvb3RbaV0sIHRtcFNldCwgc2VlZCApOwoJfQoKCXJldHVybiBTaXp6bGUuZmlsdGVyKCBsYXRlciwgdG1wU2V0ICk7Cn07CgovLyBFWFBPU0UKLy8gT3ZlcnJpZGUgc2l6emxlIGF0dHJpYnV0ZSByZXRyaWV2YWwKU2l6emxlLmF0dHIgPSBqUXVlcnkuYXR0cjsKU2l6emxlLnNlbGVjdG9ycy5hdHRyTWFwID0ge307CmpRdWVyeS5maW5kID0gU2l6emxlOwpqUXVlcnkuZXhwciA9IFNpenpsZS5zZWxlY3RvcnM7CmpRdWVyeS5leHByWyI6Il0gPSBqUXVlcnkuZXhwci5maWx0ZXJzOwpqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7CmpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7CmpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDsKalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zOwoKCn0pKCk7CgoKdmFyIHJ1bnRpbCA9IC9VbnRpbCQvLAoJcnBhcmVudHNwcmV2ID0gL14oPzpwYXJlbnRzfHByZXZVbnRpbHxwcmV2QWxsKS8sCgkvLyBOb3RlOiBUaGlzIFJlZ0V4cCBzaG91bGQgYmUgaW1wcm92ZWQsIG9yIGxpa2VseSBwdWxsZWQgZnJvbSBTaXp6bGUKCXJtdWx0aXNlbGVjdG9yID0gLywvLAoJaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAoJc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCglQT1MgPSBqUXVlcnkuZXhwci5tYXRjaC5QT1MsCgkvLyBtZXRob2RzIGd1YXJhbnRlZWQgdG8gcHJvZHVjZSBhIHVuaXF1ZSBzZXQgd2hlbiBzdGFydGluZyBmcm9tIGEgdW5pcXVlIHNldAoJZ3VhcmFudGVlZFVuaXF1ZSA9IHsKCQljaGlsZHJlbjogdHJ1ZSwKCQljb250ZW50czogdHJ1ZSwKCQluZXh0OiB0cnVlLAoJCXByZXY6IHRydWUKCX07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgc2VsZiA9IHRoaXMsCgkJCWksIGw7CgoJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMCwgbCA9IHNlbGYubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQl9CgoJCXZhciByZXQgPSB0aGlzLnB1c2hTdGFjayggIiIsICJmaW5kIiwgc2VsZWN0b3IgKSwKCQkJbGVuZ3RoLCBuLCByOwoKCQlmb3IgKCBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQlsZW5ndGggPSByZXQubGVuZ3RoOwoJCQlqUXVlcnkuZmluZCggc2VsZWN0b3IsIHRoaXNbaV0sIHJldCApOwoKCQkJaWYgKCBpID4gMCApIHsKCQkJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSByZXN1bHRzIGFyZSB1bmlxdWUKCQkJCWZvciAoIG4gPSBsZW5ndGg7IG4gPCByZXQubGVuZ3RoOyBuKysgKSB7CgkJCQkJZm9yICggciA9IDA7IHIgPCBsZW5ndGg7IHIrKyApIHsKCQkJCQkJaWYgKCByZXRbcl0gPT09IHJldFtuXSApIHsKCQkJCQkJCXJldC5zcGxpY2Uobi0tLCAxKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCgloYXM6IGZ1bmN0aW9uKCB0YXJnZXQgKSB7CgkJdmFyIHRhcmdldHMgPSBqUXVlcnkoIHRhcmdldCApOwoJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gdGFyZ2V0cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlpZiAoIGpRdWVyeS5jb250YWlucyggdGhpcywgdGFyZ2V0c1tpXSApICkgewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9CgkJfSk7Cgl9LAoKCW5vdDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yLCBmYWxzZSksICJub3QiLCBzZWxlY3Rvcik7Cgl9LAoKCWZpbHRlcjogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yLCB0cnVlKSwgImZpbHRlciIsIHNlbGVjdG9yICk7Cgl9LAoKCWlzOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuICEhc2VsZWN0b3IgJiYgKCAKCQkJdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA/CgkJCQkvLyBJZiB0aGlzIGlzIGEgcG9zaXRpb25hbCBzZWxlY3RvciwgY2hlY2sgbWVtYmVyc2hpcCBpbiB0aGUgcmV0dXJuZWQgc2V0CgkJCQkvLyBzbyAkKCJwOmZpcnN0IikuaXMoInA6bGFzdCIpIHdvbid0IHJldHVybiB0cnVlIGZvciBhIGRvYyB3aXRoIHR3byAicCIuCgkJCQlQT1MudGVzdCggc2VsZWN0b3IgKSA/IAoJCQkJCWpRdWVyeSggc2VsZWN0b3IsIHRoaXMuY29udGV4dCApLmluZGV4KCB0aGlzWzBdICkgPj0gMCA6CgkJCQkJalF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHRoaXMgKS5sZW5ndGggPiAwIDoKCQkJCXRoaXMuZmlsdGVyKCBzZWxlY3RvciApLmxlbmd0aCA+IDAgKTsKCX0sCgoJY2xvc2VzdDogZnVuY3Rpb24oIHNlbGVjdG9ycywgY29udGV4dCApIHsKCQl2YXIgcmV0ID0gW10sIGksIGwsIGN1ciA9IHRoaXNbMF07CgkJCgkJLy8gQXJyYXkgKGRlcHJlY2F0ZWQgYXMgb2YgalF1ZXJ5IDEuNykKCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBzZWxlY3RvcnMgKSApIHsKCQkJdmFyIGxldmVsID0gMTsKCgkJCXdoaWxlICggY3VyICYmIGN1ci5vd25lckRvY3VtZW50ICYmIGN1ciAhPT0gY29udGV4dCApIHsKCQkJCWZvciAoIGkgPSAwOyBpIDwgc2VsZWN0b3JzLmxlbmd0aDsgaSsrICkgewoKCQkJCQlpZiAoIGpRdWVyeSggY3VyICkuaXMoIHNlbGVjdG9yc1sgaSBdICkgKSB7CgkJCQkJCXJldC5wdXNoKHsgc2VsZWN0b3I6IHNlbGVjdG9yc1sgaSBdLCBlbGVtOiBjdXIsIGxldmVsOiBsZXZlbCB9KTsKCQkJCQl9CgkJCQl9CgoJCQkJY3VyID0gY3VyLnBhcmVudE5vZGU7CgkJCQlsZXZlbCsrOwoJCQl9CgoJCQlyZXR1cm4gcmV0OwoJCX0KCgkJLy8gU3RyaW5nCgkJdmFyIHBvcyA9IFBPUy50ZXN0KCBzZWxlY3RvcnMgKSB8fCB0eXBlb2Ygc2VsZWN0b3JzICE9PSAic3RyaW5nIiA/CgkJCQlqUXVlcnkoIHNlbGVjdG9ycywgY29udGV4dCB8fCB0aGlzLmNvbnRleHQgKSA6CgkJCQkwOwoKCQlmb3IgKCBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQljdXIgPSB0aGlzW2ldOwoKCQkJd2hpbGUgKCBjdXIgKSB7CgkJCQlpZiAoIHBvcyA/IHBvcy5pbmRleChjdXIpID4gLTEgOiBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoY3VyLCBzZWxlY3RvcnMpICkgewoJCQkJCXJldC5wdXNoKCBjdXIgKTsKCQkJCQlicmVhazsKCgkJCQl9IGVsc2UgewoJCQkJCWN1ciA9IGN1ci5wYXJlbnROb2RlOwoJCQkJCWlmICggIWN1ciB8fCAhY3VyLm93bmVyRG9jdW1lbnQgfHwgY3VyID09PSBjb250ZXh0IHx8IGN1ci5ub2RlVHlwZSA9PT0gMTEgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0ID0gcmV0Lmxlbmd0aCA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDsKCgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCByZXQsICJjbG9zZXN0Iiwgc2VsZWN0b3JzICk7Cgl9LAoKCS8vIERldGVybWluZSB0aGUgcG9zaXRpb24gb2YgYW4gZWxlbWVudCB3aXRoaW4KCS8vIHRoZSBtYXRjaGVkIHNldCBvZiBlbGVtZW50cwoJaW5kZXg6IGZ1bmN0aW9uKCBlbGVtICkgewoKCQkvLyBObyBhcmd1bWVudCwgcmV0dXJuIGluZGV4IGluIHBhcmVudAoJCWlmICggIWVsZW0gKSB7CgkJCXJldHVybiAoIHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlICkgPyB0aGlzLnByZXZBbGwoKS5sZW5ndGggOiAtMTsKCQl9CgoJCS8vIGluZGV4IGluIHNlbGVjdG9yCgkJaWYgKCB0eXBlb2YgZWxlbSA9PT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBqUXVlcnkuaW5BcnJheSggdGhpc1swXSwgalF1ZXJ5KCBlbGVtICkgKTsKCQl9CgoJCS8vIExvY2F0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGRlc2lyZWQgZWxlbWVudAoJCXJldHVybiBqUXVlcnkuaW5BcnJheSgKCQkJLy8gSWYgaXQgcmVjZWl2ZXMgYSBqUXVlcnkgb2JqZWN0LCB0aGUgZmlyc3QgZWxlbWVudCBpcyB1c2VkCgkJCWVsZW0uanF1ZXJ5ID8gZWxlbVswXSA6IGVsZW0sIHRoaXMgKTsKCX0sCgoJYWRkOiBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQgKSB7CgkJdmFyIHNldCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvciwgY29udGV4dCApIDoKCQkJCWpRdWVyeS5tYWtlQXJyYXkoIHNlbGVjdG9yICYmIHNlbGVjdG9yLm5vZGVUeXBlID8gWyBzZWxlY3RvciBdIDogc2VsZWN0b3IgKSwKCQkJYWxsID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmdldCgpLCBzZXQgKTsKCgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBpc0Rpc2Nvbm5lY3RlZCggc2V0WzBdICkgfHwgaXNEaXNjb25uZWN0ZWQoIGFsbFswXSApID8KCQkJYWxsIDoKCQkJalF1ZXJ5LnVuaXF1ZSggYWxsICkgKTsKCX0sCgoJYW5kU2VsZjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCB0aGlzLnByZXZPYmplY3QgKTsKCX0KfSk7CgovLyBBIHBhaW5mdWxseSBzaW1wbGUgY2hlY2sgdG8gc2VlIGlmIGFuIGVsZW1lbnQgaXMgZGlzY29ubmVjdGVkCi8vIGZyb20gYSBkb2N1bWVudCAoc2hvdWxkIGJlIGltcHJvdmVkLCB3aGVyZSBmZWFzaWJsZSkuCmZ1bmN0aW9uIGlzRGlzY29ubmVjdGVkKCBub2RlICkgewoJcmV0dXJuICFub2RlIHx8ICFub2RlLnBhcmVudE5vZGUgfHwgbm9kZS5wYXJlbnROb2RlLm5vZGVUeXBlID09PSAxMTsKfQoKalF1ZXJ5LmVhY2goewoJcGFyZW50OiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoJCXJldHVybiBwYXJlbnQgJiYgcGFyZW50Lm5vZGVUeXBlICE9PSAxMSA/IHBhcmVudCA6IG51bGw7Cgl9LAoJcGFyZW50czogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwYXJlbnROb2RlIiApOwoJfSwKCXBhcmVudHNVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIsIHVudGlsICk7Cgl9LAoJbmV4dDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5udGgoIGVsZW0sIDIsICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2OiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5Lm50aCggZWxlbSwgMiwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgIm5leHRTaWJsaW5nIiApOwoJfSwKCXByZXZBbGw6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiApOwoJfSwKCW5leHRVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciLCB1bnRpbCApOwoJfSwKCXByZXZVbnRpbDogZnVuY3Rpb24oIGVsZW0sIGksIHVudGlsICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiwgdW50aWwgKTsKCX0sCglzaWJsaW5nczogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5zaWJsaW5nKCBlbGVtLnBhcmVudE5vZGUuZmlyc3RDaGlsZCwgZWxlbSApOwoJfSwKCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApOwoJfSwKCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCAiaWZyYW1lIiApID8KCQkJZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgZWxlbS5jb250ZW50V2luZG93LmRvY3VtZW50IDoKCQkJalF1ZXJ5Lm1ha2VBcnJheSggZWxlbS5jaGlsZE5vZGVzICk7Cgl9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQl2YXIgcmV0ID0galF1ZXJ5Lm1hcCggdGhpcywgZm4sIHVudGlsICk7CgoJCWlmICggIXJ1bnRpbC50ZXN0KCBuYW1lICkgKSB7CgkJCXNlbGVjdG9yID0gdW50aWw7CgkJfQoKCQlpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgkJCXJldCA9IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCByZXQgKTsKCQl9CgoJCXJldCA9IHRoaXMubGVuZ3RoID4gMSAmJiAhZ3VhcmFudGVlZFVuaXF1ZVsgbmFtZSBdID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQ7CgoJCWlmICggKHRoaXMubGVuZ3RoID4gMSB8fCBybXVsdGlzZWxlY3Rvci50ZXN0KCBzZWxlY3RvciApKSAmJiBycGFyZW50c3ByZXYudGVzdCggbmFtZSApICkgewoJCQlyZXQgPSByZXQucmV2ZXJzZSgpOwoJCX0KCgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCByZXQsIG5hbWUsIHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApLmpvaW4oIiwiKSApOwoJfTsKfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCWZpbHRlcjogZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7CgkJaWYgKCBub3QgKSB7CgkJCWV4cHIgPSAiOm5vdCgiICsgZXhwciArICIpIjsKCQl9CgoJCXJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgPwoJCQlqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoZWxlbXNbMF0sIGV4cHIpID8gWyBlbGVtc1swXSBdIDogW10gOgoJCQlqUXVlcnkuZmluZC5tYXRjaGVzKGV4cHIsIGVsZW1zKTsKCX0sCgoJZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdLAoJCQljdXIgPSBlbGVtWyBkaXIgXTsKCgkJd2hpbGUgKCBjdXIgJiYgY3VyLm5vZGVUeXBlICE9PSA5ICYmICh1bnRpbCA9PT0gdW5kZWZpbmVkIHx8IGN1ci5ub2RlVHlwZSAhPT0gMSB8fCAhalF1ZXJ5KCBjdXIgKS5pcyggdW50aWwgKSkgKSB7CgkJCWlmICggY3VyLm5vZGVUeXBlID09PSAxICkgewoJCQkJbWF0Y2hlZC5wdXNoKCBjdXIgKTsKCQkJfQoJCQljdXIgPSBjdXJbZGlyXTsKCQl9CgkJcmV0dXJuIG1hdGNoZWQ7Cgl9LAoKCW50aDogZnVuY3Rpb24oIGN1ciwgcmVzdWx0LCBkaXIsIGVsZW0gKSB7CgkJcmVzdWx0ID0gcmVzdWx0IHx8IDE7CgkJdmFyIG51bSA9IDA7CgoJCWZvciAoIDsgY3VyOyBjdXIgPSBjdXJbZGlyXSApIHsKCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgJiYgKytudW0gPT09IHJlc3VsdCApIHsKCQkJCWJyZWFrOwoJCQl9CgkJfQoKCQlyZXR1cm4gY3VyOwoJfSwKCglzaWJsaW5nOiBmdW5jdGlvbiggbiwgZWxlbSApIHsKCQl2YXIgciA9IFtdOwoKCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCQlpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHsKCQkJCXIucHVzaCggbiApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcjsKCX0KfSk7CgovLyBJbXBsZW1lbnQgdGhlIGlkZW50aWNhbCBmdW5jdGlvbmFsaXR5IGZvciBmaWx0ZXIgYW5kIG5vdApmdW5jdGlvbiB3aW5ub3coIGVsZW1lbnRzLCBxdWFsaWZpZXIsIGtlZXAgKSB7CgoJLy8gQ2FuJ3QgcGFzcyBudWxsIG9yIHVuZGVmaW5lZCB0byBpbmRleE9mIGluIEZpcmVmb3ggNAoJLy8gU2V0IHRvIDAgdG8gc2tpcCBzdHJpbmcgY2hlY2sKCXF1YWxpZmllciA9IHF1YWxpZmllciB8fCAwOwoKCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHF1YWxpZmllciApICkgewoJCXJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCXZhciByZXRWYWwgPSAhIXF1YWxpZmllci5jYWxsKCBlbGVtLCBpLCBlbGVtICk7CgkJCXJldHVybiByZXRWYWwgPT09IGtlZXA7CgkJfSk7CgoJfSBlbHNlIGlmICggcXVhbGlmaWVyLm5vZGVUeXBlICkgewoJCXJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCXJldHVybiAoIGVsZW0gPT09IHF1YWxpZmllciApID09PSBrZWVwOwoJCX0pOwoKCX0gZWxzZSBpZiAoIHR5cGVvZiBxdWFsaWZpZXIgPT09ICJzdHJpbmciICkgewoJCXZhciBmaWx0ZXJlZCA9IGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDE7CgkJfSk7CgoJCWlmICggaXNTaW1wbGUudGVzdCggcXVhbGlmaWVyICkgKSB7CgkJCXJldHVybiBqUXVlcnkuZmlsdGVyKHF1YWxpZmllciwgZmlsdGVyZWQsICFrZWVwKTsKCQl9IGVsc2UgewoJCQlxdWFsaWZpZXIgPSBqUXVlcnkuZmlsdGVyKCBxdWFsaWZpZXIsIGZpbHRlcmVkICk7CgkJfQoJfQoKCXJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJcmV0dXJuICggalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHF1YWxpZmllciApID49IDAgKSA9PT0ga2VlcDsKCX0pOwp9CgoKCgpmdW5jdGlvbiBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICkgewoJdmFyIGxpc3QgPSBub2RlTmFtZXMuc3BsaXQoICJ8IiApLAoJc2FmZUZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CgoJaWYgKCBzYWZlRnJhZy5jcmVhdGVFbGVtZW50ICkgewoJCXdoaWxlICggbGlzdC5sZW5ndGggKSB7CgkJCXNhZmVGcmFnLmNyZWF0ZUVsZW1lbnQoCgkJCQlsaXN0LnBvcCgpCgkJCSk7CgkJfQoJfQoJcmV0dXJuIHNhZmVGcmFnOwp9Cgp2YXIgbm9kZU5hbWVzID0gImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xjYW52YXN8ZGF0YWxpc3R8ZGV0YWlsc3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8IiArCgkJImhlYWRlcnxoZ3JvdXB8bWFya3xtZXRlcnxuYXZ8b3V0cHV0fHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0aW1lfHZpZGVvIiwKCXJpbmxpbmVqUXVlcnkgPSAvIGpRdWVyeVxkKz0iKD86XGQrfG51bGwpIi9nLAoJcmxlYWRpbmdXaGl0ZXNwYWNlID0gL15ccysvLAoJcnhodG1sVGFnID0gLzwoPyFhcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSgoW1x3Ol0rKVtePl0qKVwvPi9pZywKCXJ0YWdOYW1lID0gLzwoW1x3Ol0rKS8sCglydGJvZHkgPSAvPHRib2R5L2ksCglyaHRtbCA9IC88fCYjP1x3KzsvLAoJcm5vSW5uZXJodG1sID0gLzwoPzpzY3JpcHR8c3R5bGUpL2ksCglybm9jYWNoZSA9IC88KD86c2NyaXB0fG9iamVjdHxlbWJlZHxvcHRpb258c3R5bGUpL2ksCglybm9zaGltY2FjaGUgPSBuZXcgUmVnRXhwKCI8KD86IiArIG5vZGVOYW1lcyArICIpIiwgImkiKSwKCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCXJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCglyc2NyaXB0VHlwZSA9IC9cLyhqYXZhfGVjbWEpc2NyaXB0L2ksCglyY2xlYW5TY3JpcHQgPSAvXlxzKjwhKD86XFtDREFUQVxbfFwtXC0pLywKCXdyYXBNYXAgPSB7CgkJb3B0aW9uOiBbIDEsICI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwgIjwvc2VsZWN0PiIgXSwKCQlsZWdlbmQ6IFsgMSwgIjxmaWVsZHNldD4iLCAiPC9maWVsZHNldD4iIF0sCgkJdGhlYWQ6IFsgMSwgIjx0YWJsZT4iLCAiPC90YWJsZT4iIF0sCgkJdHI6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgkJY29sOiBbIDIsICI8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPiIsICI8L2NvbGdyb3VwPjwvdGFibGU+IiBdLAoJCWFyZWE6IFsgMSwgIjxtYXA+IiwgIjwvbWFwPiIgXSwKCQlfZGVmYXVsdDogWyAwLCAiIiwgIiIgXQoJfSwKCXNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKTsKCndyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKd3JhcE1hcC50Ym9keSA9IHdyYXBNYXAudGZvb3QgPSB3cmFwTWFwLmNvbGdyb3VwID0gd3JhcE1hcC5jYXB0aW9uID0gd3JhcE1hcC50aGVhZDsKd3JhcE1hcC50aCA9IHdyYXBNYXAudGQ7CgovLyBJRSBjYW4ndCBzZXJpYWxpemUgPGxpbms+IGFuZCA8c2NyaXB0PiB0YWdzIG5vcm1hbGx5CmlmICggIWpRdWVyeS5zdXBwb3J0Lmh0bWxTZXJpYWxpemUgKSB7Cgl3cmFwTWFwLl9kZWZhdWx0ID0gWyAxLCAiZGl2PGRpdj4iLCAiPC9kaXY+IiBdOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXRleHQ6IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24odGV4dCkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkgewoJCQkJdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKTsKCgkJCQlzZWxmLnRleHQoIHRleHQuY2FsbCh0aGlzLCBpLCBzZWxmLnRleHQoKSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHR5cGVvZiB0ZXh0ICE9PSAib2JqZWN0IiAmJiB0ZXh0ICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiB0aGlzLmVtcHR5KCkuYXBwZW5kKCAodGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKCB0ZXh0ICkgKTsKCQl9CgoJCXJldHVybiBqUXVlcnkudGV4dCggdGhpcyApOwoJfSwKCgl3cmFwQWxsOiBmdW5jdGlvbiggaHRtbCApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkgewoJCQkJalF1ZXJ5KHRoaXMpLndyYXBBbGwoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCWlmICggdGhpc1swXSApIHsKCQkJLy8gVGhlIGVsZW1lbnRzIHRvIHdyYXAgdGhlIHRhcmdldCBhcm91bmQKCQkJdmFyIHdyYXAgPSBqUXVlcnkoIGh0bWwsIHRoaXNbMF0ub3duZXJEb2N1bWVudCApLmVxKDApLmNsb25lKHRydWUpOwoKCQkJaWYgKCB0aGlzWzBdLnBhcmVudE5vZGUgKSB7CgkJCQl3cmFwLmluc2VydEJlZm9yZSggdGhpc1swXSApOwoJCQl9CgoJCQl3cmFwLm1hcChmdW5jdGlvbigpIHsKCQkJCXZhciBlbGVtID0gdGhpczsKCgkJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCAmJiBlbGVtLmZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsKCQkJCX0KCgkJCQlyZXR1cm4gZWxlbTsKCQkJfSkuYXBwZW5kKCB0aGlzICk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJd3JhcElubmVyOiBmdW5jdGlvbiggaHRtbCApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkgewoJCQkJalF1ZXJ5KHRoaXMpLndyYXBJbm5lciggaHRtbC5jYWxsKHRoaXMsIGkpICk7CgkJCX0pOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKSwKCQkJCWNvbnRlbnRzID0gc2VsZi5jb250ZW50cygpOwoKCQkJaWYgKCBjb250ZW50cy5sZW5ndGggKSB7CgkJCQljb250ZW50cy53cmFwQWxsKCBodG1sICk7CgoJCQl9IGVsc2UgewoJCQkJc2VsZi5hcHBlbmQoIGh0bWwgKTsKCQkJfQoJCX0pOwoJfSwKCgl3cmFwOiBmdW5jdGlvbiggaHRtbCApIHsKCQl2YXIgaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICk7CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkgewoJCQlqUXVlcnkoIHRoaXMgKS53cmFwQWxsKCBpc0Z1bmN0aW9uID8gaHRtbC5jYWxsKHRoaXMsIGkpIDogaHRtbCApOwoJCX0pOwoJfSwKCgl1bndyYXA6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggIWpRdWVyeS5ub2RlTmFtZSggdGhpcywgImJvZHkiICkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5yZXBsYWNlV2l0aCggdGhpcy5jaGlsZE5vZGVzICk7CgkJCX0KCQl9KS5lbmQoKTsKCX0sCgoJYXBwZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlpZiAoIHRoaXMubm9kZVR5cGUgPT09IDEgKSB7CgkJCQl0aGlzLmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxICkgewoJCQkJdGhpcy5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMuZmlyc3RDaGlsZCApOwoJCQl9CgkJfSk7Cgl9LAoKCWJlZm9yZTogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSApIHsKCQkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBlbGVtLCB0aGlzICk7CgkJCX0pOwoJCX0gZWxzZSBpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCXZhciBzZXQgPSBqUXVlcnkuY2xlYW4oIGFyZ3VtZW50cyApOwoJCQlzZXQucHVzaC5hcHBseSggc2V0LCB0aGlzLnRvQXJyYXkoKSApOwoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHNldCwgImJlZm9yZSIsIGFyZ3VtZW50cyApOwoJCX0KCX0sCgoJYWZ0ZXI6IGZ1bmN0aW9uKCkgewoJCWlmICggdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgKSB7CgkJCXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9KTsKCQl9IGVsc2UgaWYgKCBhcmd1bWVudHMubGVuZ3RoICkgewoJCQl2YXIgc2V0ID0gdGhpcy5wdXNoU3RhY2soIHRoaXMsICJhZnRlciIsIGFyZ3VtZW50cyApOwoJCQlzZXQucHVzaC5hcHBseSggc2V0LCBqUXVlcnkuY2xlYW4oYXJndW1lbnRzKSApOwoJCQlyZXR1cm4gc2V0OwoJCX0KCX0sCgoJLy8ga2VlcERhdGEgaXMgZm9yIGludGVybmFsIHVzZSBvbmx5LS1kbyBub3QgZG9jdW1lbnQKCXJlbW92ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCBrZWVwRGF0YSApIHsKCQlmb3IgKCB2YXIgaSA9IDAsIGVsZW07IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggKSB7CgkJCQlpZiAoICFrZWVwRGF0YSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSApOwoJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIFsgZWxlbSBdICk7CgkJCQl9CgoJCQkJaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQkJZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBlbGVtICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgllbXB0eTogZnVuY3Rpb24oKSB7CgkJZm9yICggdmFyIGkgPSAwLCBlbGVtOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSApOwoJCQl9CgoJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCApIHsKCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSk7Cgl9LAoKCWh0bWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiB0aGlzWzBdICYmIHRoaXNbMF0ubm9kZVR5cGUgPT09IDEgPwoJCQkJdGhpc1swXS5pbm5lckhUTUwucmVwbGFjZShyaW5saW5lalF1ZXJ5LCAiIikgOgoJCQkJbnVsbDsKCgkJLy8gU2VlIGlmIHdlIGNhbiB0YWtlIGEgc2hvcnRjdXQgYW5kIGp1c3QgdXNlIGlubmVySFRNTAoJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgIXJub0lubmVyaHRtbC50ZXN0KCB2YWx1ZSApICYmCgkJCShqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkpICYmCgkJCSF3cmFwTWFwWyAocnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbIiIsICIiXSlbMV0udG9Mb3dlckNhc2UoKSBdICkgewoKCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHJ4aHRtbFRhZywgIjwkMT48LyQyPiIpOwoKCQkJdHJ5IHsKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCS8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcwoJCQkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJalF1ZXJ5LmNsZWFuRGF0YSggdGhpc1tpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpICk7CgkJCQkJCXRoaXNbaV0uaW5uZXJIVE1MID0gdmFsdWU7CgkJCQkJfQoJCQkJfQoKCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCX0gY2F0Y2goZSkgewoJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCggdmFsdWUgKTsKCQkJfQoKCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKGkpewoJCQkJdmFyIHNlbGYgPSBqUXVlcnkoIHRoaXMgKTsKCgkJCQlzZWxmLmh0bWwoIHZhbHVlLmNhbGwodGhpcywgaSwgc2VsZi5odG1sKCkpICk7CgkJCX0pOwoKCQl9IGVsc2UgewoJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlcGxhY2VXaXRoOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJaWYgKCB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSApIHsKCQkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGVsZW1lbnRzIGFyZSByZW1vdmVkIGZyb20gdGhlIERPTSBiZWZvcmUgdGhleSBhcmUgaW5zZXJ0ZWQKCQkJLy8gdGhpcyBjYW4gaGVscCBmaXggcmVwbGFjaW5nIGEgcGFyZW50IHdpdGggY2hpbGQgZWxlbWVudHMKCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaSkgewoJCQkJCXZhciBzZWxmID0galF1ZXJ5KHRoaXMpLCBvbGQgPSBzZWxmLmh0bWwoKTsKCQkJCQlzZWxmLnJlcGxhY2VXaXRoKCB2YWx1ZS5jYWxsKCB0aGlzLCBpLCBvbGQgKSApOwoJCQkJfSk7CgkJCX0KCgkJCWlmICggdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiApIHsKCQkJCXZhbHVlID0galF1ZXJ5KCB2YWx1ZSApLmRldGFjaCgpOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIG5leHQgPSB0aGlzLm5leHRTaWJsaW5nLAoJCQkJCXBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTsKCgkJCQlqUXVlcnkoIHRoaXMgKS5yZW1vdmUoKTsKCgkJCQlpZiAoIG5leHQgKSB7CgkJCQkJalF1ZXJ5KG5leHQpLmJlZm9yZSggdmFsdWUgKTsKCQkJCX0gZWxzZSB7CgkJCQkJalF1ZXJ5KHBhcmVudCkuYXBwZW5kKCB2YWx1ZSApOwoJCQkJfQoJCQl9KTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5sZW5ndGggPwoJCQkJdGhpcy5wdXNoU3RhY2soIGpRdWVyeShqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSkgPyB2YWx1ZSgpIDogdmFsdWUpLCAicmVwbGFjZVdpdGgiLCB2YWx1ZSApIDoKCQkJCXRoaXM7CgkJfQoJfSwKCglkZXRhY2g6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5yZW1vdmUoIHNlbGVjdG9yLCB0cnVlICk7Cgl9LAoKCWRvbU1hbmlwOiBmdW5jdGlvbiggYXJncywgdGFibGUsIGNhbGxiYWNrICkgewoJCXZhciByZXN1bHRzLCBmaXJzdCwgZnJhZ21lbnQsIHBhcmVudCwKCQkJdmFsdWUgPSBhcmdzWzBdLAoJCQlzY3JpcHRzID0gW107CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggIWpRdWVyeS5zdXBwb3J0LmNoZWNrQ2xvbmUgJiYgYXJndW1lbnRzLmxlbmd0aCA9PT0gMyAmJiB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmIHJjaGVja2VkLnRlc3QoIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkodGhpcykuZG9tTWFuaXAoIGFyZ3MsIHRhYmxlLCBjYWxsYmFjaywgdHJ1ZSApOwoJCQl9KTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24odmFsdWUpICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCXZhciBzZWxmID0galF1ZXJ5KHRoaXMpOwoJCQkJYXJnc1swXSA9IHZhbHVlLmNhbGwodGhpcywgaSwgdGFibGUgPyBzZWxmLmh0bWwoKSA6IHVuZGVmaW5lZCk7CgkJCQlzZWxmLmRvbU1hbmlwKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCXBhcmVudCA9IHZhbHVlICYmIHZhbHVlLnBhcmVudE5vZGU7CgoJCQkvLyBJZiB3ZSdyZSBpbiBhIGZyYWdtZW50LCBqdXN0IHVzZSB0aGF0IGluc3RlYWQgb2YgYnVpbGRpbmcgYSBuZXcgb25lCgkJCWlmICggalF1ZXJ5LnN1cHBvcnQucGFyZW50Tm9kZSAmJiBwYXJlbnQgJiYgcGFyZW50Lm5vZGVUeXBlID09PSAxMSAmJiBwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IHRoaXMubGVuZ3RoICkgewoJCQkJcmVzdWx0cyA9IHsgZnJhZ21lbnQ6IHBhcmVudCB9OwoKCQkJfSBlbHNlIHsKCQkJCXJlc3VsdHMgPSBqUXVlcnkuYnVpbGRGcmFnbWVudCggYXJncywgdGhpcywgc2NyaXB0cyApOwoJCQl9CgoJCQlmcmFnbWVudCA9IHJlc3VsdHMuZnJhZ21lbnQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZmlyc3QgPSBmcmFnbWVudCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgkJCX0gZWxzZSB7CgkJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgkJCX0KCgkJCWlmICggZmlyc3QgKSB7CgkJCQl0YWJsZSA9IHRhYmxlICYmIGpRdWVyeS5ub2RlTmFtZSggZmlyc3QsICJ0ciIgKTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aCwgbGFzdEluZGV4ID0gbCAtIDE7IGkgPCBsOyBpKysgKSB7CgkJCQkJY2FsbGJhY2suY2FsbCgKCQkJCQkJdGFibGUgPwoJCQkJCQkJcm9vdCh0aGlzW2ldLCBmaXJzdCkgOgoJCQkJCQkJdGhpc1tpXSwKCQkJCQkJLy8gTWFrZSBzdXJlIHRoYXQgd2UgZG8gbm90IGxlYWsgbWVtb3J5IGJ5IGluYWR2ZXJ0ZW50bHkgZGlzY2FyZGluZwoJCQkJCQkvLyB0aGUgb3JpZ2luYWwgZnJhZ21lbnQgKHdoaWNoIG1pZ2h0IGhhdmUgYXR0YWNoZWQgZGF0YSkgaW5zdGVhZCBvZgoJCQkJCQkvLyB1c2luZyBpdDsgaW4gYWRkaXRpb24sIHVzZSB0aGUgb3JpZ2luYWwgZnJhZ21lbnQgb2JqZWN0IGZvciB0aGUgbGFzdAoJCQkJCQkvLyBpdGVtIGluc3RlYWQgb2YgZmlyc3QgYmVjYXVzZSBpdCBjYW4gZW5kIHVwIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkKCQkJCQkJLy8gaW4gY2VydGFpbiBzaXR1YXRpb25zIChCdWcgIzgwNzApLgoJCQkJCQkvLyBGcmFnbWVudHMgZnJvbSB0aGUgZnJhZ21lbnQgY2FjaGUgbXVzdCBhbHdheXMgYmUgY2xvbmVkIGFuZCBuZXZlciB1c2VkCgkJCQkJCS8vIGluIHBsYWNlLgoJCQkJCQlyZXN1bHRzLmNhY2hlYWJsZSB8fCAoIGwgPiAxICYmIGkgPCBsYXN0SW5kZXggKSA/CgkJCQkJCQlqUXVlcnkuY2xvbmUoIGZyYWdtZW50LCB0cnVlLCB0cnVlICkgOgoJCQkJCQkJZnJhZ21lbnQKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlpZiAoIHNjcmlwdHMubGVuZ3RoICkgewoJCQkJalF1ZXJ5LmVhY2goIHNjcmlwdHMsIGV2YWxTY3JpcHQgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9Cn0pOwoKZnVuY3Rpb24gcm9vdCggZWxlbSwgY3VyICkgewoJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZShlbGVtLCAidGFibGUiKSA/CgkJKGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF0gfHwKCQllbGVtLmFwcGVuZENoaWxkKGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpKSkgOgoJCWVsZW07Cn0KCmZ1bmN0aW9uIGNsb25lQ29weUV2ZW50KCBzcmMsIGRlc3QgKSB7CgoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkuaGFzRGF0YSggc3JjICkgKSB7CgkJcmV0dXJuOwoJfQoKCXZhciB0eXBlLCBpLCBsLAoJCW9sZERhdGEgPSBqUXVlcnkuX2RhdGEoIHNyYyApLAoJCWN1ckRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QsIG9sZERhdGEgKSwKCQlldmVudHMgPSBvbGREYXRhLmV2ZW50czsKCglpZiAoIGV2ZW50cyApIHsKCQlkZWxldGUgY3VyRGF0YS5oYW5kbGU7CgkJY3VyRGF0YS5ldmVudHMgPSB7fTsKCgkJZm9yICggdHlwZSBpbiBldmVudHMgKSB7CgkJCWZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZGVzdCwgdHlwZSArICggZXZlbnRzWyB0eXBlIF1bIGkgXS5uYW1lc3BhY2UgPyAiLiIgOiAiIiApICsgZXZlbnRzWyB0eXBlIF1bIGkgXS5uYW1lc3BhY2UsIGV2ZW50c1sgdHlwZSBdWyBpIF0sIGV2ZW50c1sgdHlwZSBdWyBpIF0uZGF0YSApOwoJCQl9CgkJfQoJfQoKCS8vIG1ha2UgdGhlIGNsb25lZCBwdWJsaWMgZGF0YSBvYmplY3QgYSBjb3B5IGZyb20gdGhlIG9yaWdpbmFsCglpZiAoIGN1ckRhdGEuZGF0YSApIHsKCQljdXJEYXRhLmRhdGEgPSBqUXVlcnkuZXh0ZW5kKCB7fSwgY3VyRGF0YS5kYXRhICk7Cgl9Cn0KCmZ1bmN0aW9uIGNsb25lRml4QXR0cmlidXRlcyggc3JjLCBkZXN0ICkgewoJdmFyIG5vZGVOYW1lOwoKCS8vIFdlIGRvIG5vdCBuZWVkIHRvIGRvIGFueXRoaW5nIGZvciBub24tRWxlbWVudHMKCWlmICggZGVzdC5ub2RlVHlwZSAhPT0gMSApIHsKCQlyZXR1cm47Cgl9CgoJLy8gY2xlYXJBdHRyaWJ1dGVzIHJlbW92ZXMgdGhlIGF0dHJpYnV0ZXMsIHdoaWNoIHdlIGRvbid0IHdhbnQsCgkvLyBidXQgYWxzbyByZW1vdmVzIHRoZSBhdHRhY2hFdmVudCBldmVudHMsIHdoaWNoIHdlICpkbyogd2FudAoJaWYgKCBkZXN0LmNsZWFyQXR0cmlidXRlcyApIHsKCQlkZXN0LmNsZWFyQXR0cmlidXRlcygpOwoJfQoKCS8vIG1lcmdlQXR0cmlidXRlcywgaW4gY29udHJhc3QsIG9ubHkgbWVyZ2VzIGJhY2sgb24gdGhlCgkvLyBvcmlnaW5hbCBhdHRyaWJ1dGVzLCBub3QgdGhlIGV2ZW50cwoJaWYgKCBkZXN0Lm1lcmdlQXR0cmlidXRlcyApIHsKCQlkZXN0Lm1lcmdlQXR0cmlidXRlcyggc3JjICk7Cgl9CgoJbm9kZU5hbWUgPSBkZXN0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgoJLy8gSUU2LTggZmFpbCB0byBjbG9uZSBjaGlsZHJlbiBpbnNpZGUgb2JqZWN0IGVsZW1lbnRzIHRoYXQgdXNlCgkvLyB0aGUgcHJvcHJpZXRhcnkgY2xhc3NpZCBhdHRyaWJ1dGUgdmFsdWUgKHJhdGhlciB0aGFuIHRoZSB0eXBlCgkvLyBhdHRyaWJ1dGUpIHRvIGlkZW50aWZ5IHRoZSB0eXBlIG9mIGNvbnRlbnQgdG8gZGlzcGxheQoJaWYgKCBub2RlTmFtZSA9PT0gIm9iamVjdCIgKSB7CgkJZGVzdC5vdXRlckhUTUwgPSBzcmMub3V0ZXJIVE1MOwoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIChzcmMudHlwZSA9PT0gImNoZWNrYm94IiB8fCBzcmMudHlwZSA9PT0gInJhZGlvIikgKSB7CgkJLy8gSUU2LTggZmFpbHMgdG8gcGVyc2lzdCB0aGUgY2hlY2tlZCBzdGF0ZSBvZiBhIGNsb25lZCBjaGVja2JveAoJCS8vIG9yIHJhZGlvIGJ1dHRvbi4gV29yc2UsIElFNi03IGZhaWwgdG8gZ2l2ZSB0aGUgY2xvbmVkIGVsZW1lbnQKCQkvLyBhIGNoZWNrZWQgYXBwZWFyYW5jZSBpZiB0aGUgZGVmYXVsdENoZWNrZWQgdmFsdWUgaXNuJ3QgYWxzbyBzZXQKCQlpZiAoIHNyYy5jaGVja2VkICkgewoJCQlkZXN0LmRlZmF1bHRDaGVja2VkID0gZGVzdC5jaGVja2VkID0gc3JjLmNoZWNrZWQ7CgkJfQoKCQkvLyBJRTYtNyBnZXQgY29uZnVzZWQgYW5kIGVuZCB1cCBzZXR0aW5nIHRoZSB2YWx1ZSBvZiBhIGNsb25lZAoJCS8vIGNoZWNrYm94L3JhZGlvIGJ1dHRvbiB0byBhbiBlbXB0eSBzdHJpbmcgaW5zdGVhZCBvZiAib24iCgkJaWYgKCBkZXN0LnZhbHVlICE9PSBzcmMudmFsdWUgKSB7CgkJCWRlc3QudmFsdWUgPSBzcmMudmFsdWU7CgkJfQoKCS8vIElFNi04IGZhaWxzIHRvIHJldHVybiB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRvIHRoZSBkZWZhdWx0IHNlbGVjdGVkCgkvLyBzdGF0ZSB3aGVuIGNsb25pbmcgb3B0aW9ucwoJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJvcHRpb24iICkgewoJCWRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9CgoJLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8KCS8vIGdldHMgY29waWVkIHRvbwoJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cn0KCmpRdWVyeS5idWlsZEZyYWdtZW50ID0gZnVuY3Rpb24oIGFyZ3MsIG5vZGVzLCBzY3JpcHRzICkgewoJdmFyIGZyYWdtZW50LCBjYWNoZWFibGUsIGNhY2hlcmVzdWx0cywgZG9jLAoJZmlyc3QgPSBhcmdzWyAwIF07CgoJLy8gbm9kZXMgbWF5IGNvbnRhaW4gZWl0aGVyIGFuIGV4cGxpY2l0IGRvY3VtZW50IG9iamVjdCwKCS8vIGEgalF1ZXJ5IGNvbGxlY3Rpb24gb3IgY29udGV4dCBvYmplY3QuCgkvLyBJZiBub2Rlc1swXSBjb250YWlucyBhIHZhbGlkIG9iamVjdCB0byBhc3NpZ24gdG8gZG9jCglpZiAoIG5vZGVzICYmIG5vZGVzWzBdICkgewoJCWRvYyA9IG5vZGVzWzBdLm93bmVyRG9jdW1lbnQgfHwgbm9kZXNbMF07Cgl9CgoJLy8gRW5zdXJlIHRoYXQgYW4gYXR0ciBvYmplY3QgZG9lc24ndCBpbmNvcnJlY3RseSBzdGFuZCBpbiBhcyBhIGRvY3VtZW50IG9iamVjdAoJLy8gQ2hyb21lIGFuZCBGaXJlZm94IHNlZW0gdG8gYWxsb3cgdGhpcyB0byBvY2N1ciBhbmQgd2lsbCB0aHJvdyBleGNlcHRpb24KCS8vIEZpeGVzICM4OTUwCglpZiAoICFkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCApIHsKCQlkb2MgPSBkb2N1bWVudDsKCX0KCgkvLyBPbmx5IGNhY2hlICJzbWFsbCIgKDEvMiBLQikgSFRNTCBzdHJpbmdzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWFpbiBkb2N1bWVudAoJLy8gQ2xvbmluZyBvcHRpb25zIGxvc2VzIHRoZSBzZWxlY3RlZCBzdGF0ZSwgc28gZG9uJ3QgY2FjaGUgdGhlbQoJLy8gSUUgNiBkb2Vzbid0IGxpa2UgaXQgd2hlbiB5b3UgcHV0IDxvYmplY3Q+IG9yIDxlbWJlZD4gZWxlbWVudHMgaW4gYSBmcmFnbWVudAoJLy8gQWxzbywgV2ViS2l0IGRvZXMgbm90IGNsb25lICdjaGVja2VkJyBhdHRyaWJ1dGVzIG9uIGNsb25lTm9kZSwgc28gZG9uJ3QgY2FjaGUKCS8vIExhc3RseSwgSUU2LDcsOCB3aWxsIG5vdCBjb3JyZWN0bHkgcmV1c2UgY2FjaGVkIGZyYWdtZW50cyB0aGF0IHdlcmUgY3JlYXRlZCBmcm9tIHVua25vd24gZWxlbXMgIzEwNTAxCglpZiAoIGFyZ3MubGVuZ3RoID09PSAxICYmIHR5cGVvZiBmaXJzdCA9PT0gInN0cmluZyIgJiYgZmlyc3QubGVuZ3RoIDwgNTEyICYmIGRvYyA9PT0gZG9jdW1lbnQgJiYKCQlmaXJzdC5jaGFyQXQoMCkgPT09ICI8IiAmJiAhcm5vY2FjaGUudGVzdCggZmlyc3QgKSAmJgoJCShqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCBmaXJzdCApKSAmJgoJCShqUXVlcnkuc3VwcG9ydC5odG1sNUNsb25lIHx8ICFybm9zaGltY2FjaGUudGVzdCggZmlyc3QgKSkgKSB7CgoJCWNhY2hlYWJsZSA9IHRydWU7CgoJCWNhY2hlcmVzdWx0cyA9IGpRdWVyeS5mcmFnbWVudHNbIGZpcnN0IF07CgkJaWYgKCBjYWNoZXJlc3VsdHMgJiYgY2FjaGVyZXN1bHRzICE9PSAxICkgewoJCQlmcmFnbWVudCA9IGNhY2hlcmVzdWx0czsKCQl9Cgl9CgoJaWYgKCAhZnJhZ21lbnQgKSB7CgkJZnJhZ21lbnQgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoJCWpRdWVyeS5jbGVhbiggYXJncywgZG9jLCBmcmFnbWVudCwgc2NyaXB0cyApOwoJfQoKCWlmICggY2FjaGVhYmxlICkgewoJCWpRdWVyeS5mcmFnbWVudHNbIGZpcnN0IF0gPSBjYWNoZXJlc3VsdHMgPyBmcmFnbWVudCA6IDE7Cgl9CgoJcmV0dXJuIHsgZnJhZ21lbnQ6IGZyYWdtZW50LCBjYWNoZWFibGU6IGNhY2hlYWJsZSB9Owp9OwoKalF1ZXJ5LmZyYWdtZW50cyA9IHt9OwoKalF1ZXJ5LmVhY2goewoJYXBwZW5kVG86ICJhcHBlbmQiLAoJcHJlcGVuZFRvOiAicHJlcGVuZCIsCglpbnNlcnRCZWZvcmU6ICJiZWZvcmUiLAoJaW5zZXJ0QWZ0ZXI6ICJhZnRlciIsCglyZXBsYWNlQWxsOiAicmVwbGFjZVdpdGgiCn0sIGZ1bmN0aW9uKCBuYW1lLCBvcmlnaW5hbCApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciByZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlwYXJlbnQgPSB0aGlzLmxlbmd0aCA9PT0gMSAmJiB0aGlzWzBdLnBhcmVudE5vZGU7CgoJCWlmICggcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSA9PT0gMTEgJiYgcGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmIGluc2VydC5sZW5ndGggPT09IDEgKSB7CgkJCWluc2VydFsgb3JpZ2luYWwgXSggdGhpc1swXSApOwoJCQlyZXR1cm4gdGhpczsKCgkJfSBlbHNlIHsKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gaW5zZXJ0Lmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCXZhciBlbGVtcyA9ICggaSA+IDAgPyB0aGlzLmNsb25lKHRydWUpIDogdGhpcyApLmdldCgpOwoJCQkJalF1ZXJ5KCBpbnNlcnRbaV0gKVsgb3JpZ2luYWwgXSggZWxlbXMgKTsKCQkJCXJldCA9IHJldC5jb25jYXQoIGVsZW1zICk7CgkJCX0KCgkJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0LCBuYW1lLCBpbnNlcnQuc2VsZWN0b3IgKTsKCQl9Cgl9Owp9KTsKCmZ1bmN0aW9uIGdldEFsbCggZWxlbSApIHsKCWlmICggdHlwZW9mIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09ICJ1bmRlZmluZWQiICkgewoJCXJldHVybiBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAiKiIgKTsKCgl9IGVsc2UgaWYgKCB0eXBlb2YgZWxlbS5xdWVyeVNlbGVjdG9yQWxsICE9PSAidW5kZWZpbmVkIiApIHsKCQlyZXR1cm4gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCAiKiIgKTsKCgl9IGVsc2UgewoJCXJldHVybiBbXTsKCX0KfQoKLy8gVXNlZCBpbiBjbGVhbiwgZml4ZXMgdGhlIGRlZmF1bHRDaGVja2VkIHByb3BlcnR5CmZ1bmN0aW9uIGZpeERlZmF1bHRDaGVja2VkKCBlbGVtICkgewoJaWYgKCBlbGVtLnR5cGUgPT09ICJjaGVja2JveCIgfHwgZWxlbS50eXBlID09PSAicmFkaW8iICkgewoJCWVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7Cgl9Cn0KLy8gRmluZHMgYWxsIGlucHV0cyBhbmQgcGFzc2VzIHRoZW0gdG8gZml4RGVmYXVsdENoZWNrZWQKZnVuY3Rpb24gZmluZElucHV0cyggZWxlbSApIHsKCXZhciBub2RlTmFtZSA9ICggZWxlbS5ub2RlTmFtZSB8fCAiIiApLnRvTG93ZXJDYXNlKCk7CglpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICkgewoJCWZpeERlZmF1bHRDaGVja2VkKCBlbGVtICk7CgkvLyBTa2lwIHNjcmlwdHMsIGdldCBvdGhlciBjaGlsZHJlbgoJfSBlbHNlIGlmICggbm9kZU5hbWUgIT09ICJzY3JpcHQiICYmIHR5cGVvZiBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSAidW5kZWZpbmVkIiApIHsKCQlqUXVlcnkuZ3JlcCggZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKSwgZml4RGVmYXVsdENoZWNrZWQgKTsKCX0KfQoKLy8gRGVyaXZlZCBGcm9tOiBodHRwOi8vd3d3LmllY3NzLmNvbS9zaGltcHJvdmUvamF2YXNjcmlwdC9zaGltcHJvdmUuMS0wLTEuanMKZnVuY3Rpb24gc2hpbUNsb25lTm9kZSggZWxlbSApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkaXYgKTsKCglkaXYuaW5uZXJIVE1MID0gZWxlbS5vdXRlckhUTUw7CglyZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgc3JjRWxlbWVudHMsCgkJCWRlc3RFbGVtZW50cywKCQkJaSwKCQkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCQljbG9uZSA9IGpRdWVyeS5zdXBwb3J0Lmh0bWw1Q2xvbmUgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCAiPCIgKyBlbGVtLm5vZGVOYW1lICkgPwoJCQkJZWxlbS5jbG9uZU5vZGUoIHRydWUgKSA6CgkJCQlzaGltQ2xvbmVOb2RlKCBlbGVtICk7CgoJCWlmICggKCFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lRXZlbnQgfHwgIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVDaGVja2VkKSAmJgoJCQkJKGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgZWxlbS5ub2RlVHlwZSA9PT0gMTEpICYmICFqUXVlcnkuaXNYTUxEb2MoZWxlbSkgKSB7CgkJCS8vIElFIGNvcGllcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50IHdoZW4gdXNpbmcgY2xvbmVOb2RlLgoJCQkvLyBDYWxsaW5nIGRldGFjaEV2ZW50IG9uIHRoZSBjbG9uZSB3aWxsIGFsc28gcmVtb3ZlIHRoZSBldmVudHMKCQkJLy8gZnJvbSB0aGUgb3JpZ2luYWwuIEluIG9yZGVyIHRvIGdldCBhcm91bmQgdGhpcywgd2UgdXNlIHNvbWUKCQkJLy8gcHJvcHJpZXRhcnkgbWV0aG9kcyB0byBjbGVhciB0aGUgZXZlbnRzLiBUaGFua3MgdG8gTW9vVG9vbHMKCQkJLy8gZ3V5cyBmb3IgdGhpcyBob3RuZXNzLgoKCQkJY2xvbmVGaXhBdHRyaWJ1dGVzKCBlbGVtLCBjbG9uZSApOwoKCQkJLy8gVXNpbmcgU2l6emxlIGhlcmUgaXMgY3Jhenkgc2xvdywgc28gd2UgdXNlIGdldEVsZW1lbnRzQnlUYWdOYW1lIGluc3RlYWQKCQkJc3JjRWxlbWVudHMgPSBnZXRBbGwoIGVsZW0gKTsKCQkJZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApOwoKCQkJLy8gV2VpcmQgaXRlcmF0aW9uIGJlY2F1c2UgSUUgd2lsbCByZXBsYWNlIHRoZSBsZW5ndGggcHJvcGVydHkKCQkJLy8gd2l0aCBhbiBlbGVtZW50IGlmIHlvdSBhcmUgY2xvbmluZyB0aGUgYm9keSBhbmQgb25lIG9mIHRoZQoJCQkvLyBlbGVtZW50cyBvbiB0aGUgcGFnZSBoYXMgYSBuYW1lIG9yIGlkIG9mICJsZW5ndGgiCgkJCWZvciAoIGkgPSAwOyBzcmNFbGVtZW50c1tpXTsgKytpICkgewoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1tpXSApIHsKCQkJCQljbG9uZUZpeEF0dHJpYnV0ZXMoIHNyY0VsZW1lbnRzW2ldLCBkZXN0RWxlbWVudHNbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gQ29weSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIHRvIHRoZSBjbG9uZQoJCWlmICggZGF0YUFuZEV2ZW50cyApIHsKCQkJY2xvbmVDb3B5RXZlbnQoIGVsZW0sIGNsb25lICk7CgoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUgKTsKCgkJCQlmb3IgKCBpID0gMDsgc3JjRWxlbWVudHNbaV07ICsraSApIHsKCQkJCQljbG9uZUNvcHlFdmVudCggc3JjRWxlbWVudHNbaV0sIGRlc3RFbGVtZW50c1tpXSApOwoJCQkJfQoJCQl9CgkJfQoKCQlzcmNFbGVtZW50cyA9IGRlc3RFbGVtZW50cyA9IG51bGw7CgoJCS8vIFJldHVybiB0aGUgY2xvbmVkIHNldAoJCXJldHVybiBjbG9uZTsKCX0sCgoJY2xlYW46IGZ1bmN0aW9uKCBlbGVtcywgY29udGV4dCwgZnJhZ21lbnQsIHNjcmlwdHMgKSB7CgkJdmFyIGNoZWNrU2NyaXB0VHlwZTsKCgkJY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7CgoJCS8vICFjb250ZXh0LmNyZWF0ZUVsZW1lbnQgZmFpbHMgaW4gSUUgd2l0aCBhbiBlcnJvciBidXQgcmV0dXJucyB0eXBlb2YgJ29iamVjdCcKCQlpZiAoIHR5cGVvZiBjb250ZXh0LmNyZWF0ZUVsZW1lbnQgPT09ICJ1bmRlZmluZWQiICkgewoJCQljb250ZXh0ID0gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHRbMF0gJiYgY29udGV4dFswXS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJdmFyIHJldCA9IFtdLCBqOwoKCQlmb3IgKCB2YXIgaSA9IDAsIGVsZW07IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJaWYgKCB0eXBlb2YgZWxlbSA9PT0gIm51bWJlciIgKSB7CgkJCQllbGVtICs9ICIiOwoJCQl9CgoJCQlpZiAoICFlbGVtICkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCS8vIENvbnZlcnQgaHRtbCBzdHJpbmcgaW50byBET00gbm9kZXMKCQkJaWYgKCB0eXBlb2YgZWxlbSA9PT0gInN0cmluZyIgKSB7CgkJCQlpZiAoICFyaHRtbC50ZXN0KCBlbGVtICkgKSB7CgkJCQkJZWxlbSA9IGNvbnRleHQuY3JlYXRlVGV4dE5vZGUoIGVsZW0gKTsKCQkJCX0gZWxzZSB7CgkJCQkJLy8gRml4ICJYSFRNTCItc3R5bGUgdGFncyBpbiBhbGwgYnJvd3NlcnMKCQkJCQllbGVtID0gZWxlbS5yZXBsYWNlKHJ4aHRtbFRhZywgIjwkMT48LyQyPiIpOwoKCQkJCQkvLyBUcmltIHdoaXRlc3BhY2UsIG90aGVyd2lzZSBpbmRleE9mIHdvbid0IHdvcmsgYXMgZXhwZWN0ZWQKCQkJCQl2YXIgdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyIiLCAiIl0gKVsxXS50b0xvd2VyQ2FzZSgpLAoJCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdCwKCQkJCQkJZGVwdGggPSB3cmFwWzBdLAoJCQkJCQlkaXYgPSBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKCQkJCQkvLyBBcHBlbmQgd3JhcHBlciBlbGVtZW50IHRvIHVua25vd24gZWxlbWVudCBzYWZlIGRvYyBmcmFnbWVudAoJCQkJCWlmICggY29udGV4dCA9PT0gZG9jdW1lbnQgKSB7CgkJCQkJCS8vIFVzZSB0aGUgZnJhZ21lbnQgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGZvciB0aGlzIGRvY3VtZW50CgkJCQkJCXNhZmVGcmFnbWVudC5hcHBlbmRDaGlsZCggZGl2ICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJLy8gVXNlIGEgZnJhZ21lbnQgY3JlYXRlZCB3aXRoIHRoZSBvd25lciBkb2N1bWVudAoJCQkJCQljcmVhdGVTYWZlRnJhZ21lbnQoIGNvbnRleHQgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgkJCQkJfQoKCQkJCQkvLyBHbyB0byBodG1sIGFuZCBiYWNrLCB0aGVuIHBlZWwgb2ZmIGV4dHJhIHdyYXBwZXJzCgkJCQkJZGl2LmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtICsgd3JhcFsyXTsKCgkJCQkJLy8gTW92ZSB0byB0aGUgcmlnaHQgZGVwdGgKCQkJCQl3aGlsZSAoIGRlcHRoLS0gKSB7CgkJCQkJCWRpdiA9IGRpdi5sYXN0Q2hpbGQ7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIWpRdWVyeS5zdXBwb3J0LnRib2R5ICkgewoKCQkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCQl2YXIgaGFzQm9keSA9IHJ0Ym9keS50ZXN0KGVsZW0pLAoJCQkJCQkJdGJvZHkgPSB0YWcgPT09ICJ0YWJsZSIgJiYgIWhhc0JvZHkgPwoJCQkJCQkJCWRpdi5maXJzdENoaWxkICYmIGRpdi5maXJzdENoaWxkLmNoaWxkTm9kZXMgOgoKCQkJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJCQl3cmFwWzFdID09PSAiPHRhYmxlPiIgJiYgIWhhc0JvZHkgPwoJCQkJCQkJCQlkaXYuY2hpbGROb2RlcyA6CgkJCQkJCQkJCVtdOwoKCQkJCQkJZm9yICggaiA9IHRib2R5Lmxlbmd0aCAtIDE7IGogPj0gMCA7IC0taiApIHsKCQkJCQkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0Ym9keVsgaiBdLCAidGJvZHkiICkgJiYgIXRib2R5WyBqIF0uY2hpbGROb2Rlcy5sZW5ndGggKSB7CgkJCQkJCQkJdGJvZHlbIGogXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCB0Ym9keVsgaiBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIElFIGNvbXBsZXRlbHkga2lsbHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gaW5uZXJIVE1MIGlzIHVzZWQKCQkJCQlpZiAoICFqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSAmJiBybGVhZGluZ1doaXRlc3BhY2UudGVzdCggZWxlbSApICkgewoJCQkJCQlkaXYuaW5zZXJ0QmVmb3JlKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBybGVhZGluZ1doaXRlc3BhY2UuZXhlYyhlbGVtKVswXSApLCBkaXYuZmlyc3RDaGlsZCApOwoJCQkJCX0KCgkJCQkJZWxlbSA9IGRpdi5jaGlsZE5vZGVzOwoJCQkJfQoJCQl9CgoJCQkvLyBSZXNldHMgZGVmYXVsdENoZWNrZWQgZm9yIGFueSByYWRpb3MgYW5kIGNoZWNrYm94ZXMKCQkJLy8gYWJvdXQgdG8gYmUgYXBwZW5kZWQgdG8gdGhlIERPTSBpbiBJRSA2LzcgKCM4MDYwKQoJCQl2YXIgbGVuOwoJCQlpZiAoICFqUXVlcnkuc3VwcG9ydC5hcHBlbmRDaGVja2VkICkgewoJCQkJaWYgKCBlbGVtWzBdICYmIHR5cGVvZiAobGVuID0gZWxlbS5sZW5ndGgpID09PSAibnVtYmVyIiApIHsKCQkJCQlmb3IgKCBqID0gMDsgaiA8IGxlbjsgaisrICkgewoJCQkJCQlmaW5kSW5wdXRzKCBlbGVtW2pdICk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlmaW5kSW5wdXRzKCBlbGVtICk7CgkJCQl9CgkJCX0KCgkJCWlmICggZWxlbS5ub2RlVHlwZSApIHsKCQkJCXJldC5wdXNoKCBlbGVtICk7CgkJCX0gZWxzZSB7CgkJCQlyZXQgPSBqUXVlcnkubWVyZ2UoIHJldCwgZWxlbSApOwoJCQl9CgkJfQoKCQlpZiAoIGZyYWdtZW50ICkgewoJCQljaGVja1NjcmlwdFR5cGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAhZWxlbS50eXBlIHx8IHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSApOwoJCQl9OwoJCQlmb3IgKCBpID0gMDsgcmV0W2ldOyBpKysgKSB7CgkJCQlpZiAoIHNjcmlwdHMgJiYgalF1ZXJ5Lm5vZGVOYW1lKCByZXRbaV0sICJzY3JpcHQiICkgJiYgKCFyZXRbaV0udHlwZSB8fCByZXRbaV0udHlwZS50b0xvd2VyQ2FzZSgpID09PSAidGV4dC9qYXZhc2NyaXB0IikgKSB7CgkJCQkJc2NyaXB0cy5wdXNoKCByZXRbaV0ucGFyZW50Tm9kZSA/IHJldFtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCByZXRbaV0gKSA6IHJldFtpXSApOwoKCQkJCX0gZWxzZSB7CgkJCQkJaWYgKCByZXRbaV0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCXZhciBqc1RhZ3MgPSBqUXVlcnkuZ3JlcCggcmV0W2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAic2NyaXB0IiApLCBjaGVja1NjcmlwdFR5cGUgKTsKCgkJCQkJCXJldC5zcGxpY2UuYXBwbHkoIHJldCwgW2kgKyAxLCAwXS5jb25jYXQoIGpzVGFncyApICk7CgkJCQkJfQoJCQkJCWZyYWdtZW50LmFwcGVuZENoaWxkKCByZXRbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMgKSB7CgkJdmFyIGRhdGEsIGlkLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsLAoJCQlkZWxldGVFeHBhbmRvID0galF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbzsKCgkJZm9yICggdmFyIGkgPSAwLCBlbGVtOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCWlmICggZWxlbS5ub2RlTmFtZSAmJiBqUXVlcnkubm9EYXRhW2VsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0gKSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJaWQgPSBlbGVtWyBqUXVlcnkuZXhwYW5kbyBdOwoKCQkJaWYgKCBpZCApIHsKCQkJCWRhdGEgPSBjYWNoZVsgaWQgXTsKCgkJCQlpZiAoIGRhdGEgJiYgZGF0YS5ldmVudHMgKSB7CgkJCQkJZm9yICggdmFyIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCWlmICggc3BlY2lhbFsgdHlwZSBdICkgewoJCQkJCQkJalF1ZXJ5LmV2ZW50LnJlbW92ZSggZWxlbSwgdHlwZSApOwoKCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQl9IGVsc2UgewoJCQkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBkYXRhLmhhbmRsZSApOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBOdWxsIHRoZSBET00gcmVmZXJlbmNlIHRvIGF2b2lkIElFNi83LzggbGVhayAoIzcwNTQpCgkJCQkJaWYgKCBkYXRhLmhhbmRsZSApIHsKCQkJCQkJZGF0YS5oYW5kbGUuZWxlbSA9IG51bGw7CgkJCQkJfQoJCQkJfQoKCQkJCWlmICggZGVsZXRlRXhwYW5kbyApIHsKCQkJCQlkZWxldGUgZWxlbVsgalF1ZXJ5LmV4cGFuZG8gXTsKCgkJCQl9IGVsc2UgaWYgKCBlbGVtLnJlbW92ZUF0dHJpYnV0ZSApIHsKCQkJCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSggalF1ZXJ5LmV4cGFuZG8gKTsKCQkJCX0KCgkJCQlkZWxldGUgY2FjaGVbIGlkIF07CgkJCX0KCQl9Cgl9Cn0pOwoKZnVuY3Rpb24gZXZhbFNjcmlwdCggaSwgZWxlbSApIHsKCWlmICggZWxlbS5zcmMgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IGVsZW0uc3JjLAoJCQlhc3luYzogZmFsc2UsCgkJCWRhdGFUeXBlOiAic2NyaXB0IgoJCX0pOwoJfSBlbHNlIHsKCQlqUXVlcnkuZ2xvYmFsRXZhbCggKCBlbGVtLnRleHQgfHwgZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVySFRNTCB8fCAiIiApLnJlcGxhY2UoIHJjbGVhblNjcmlwdCwgIi8qJDAqLyIgKSApOwoJfQoKCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJfQp9CgoKCgp2YXIgcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCglyb3BhY2l0eSA9IC9vcGFjaXR5PShbXildKikvLAoJLy8gZml4ZWQgZm9yIElFOSwgc2VlICM4MzQ2CglydXBwZXIgPSAvKFtBLVpdfF5tcykvZywKCXJudW1weCA9IC9eLT9cZCsoPzpweCk/JC9pLAoJcm51bSA9IC9eLT9cZC8sCglycmVsTnVtID0gL14oW1wtK10pPShbXC0rLlxkZV0rKS8sCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NXaWR0aCA9IFsgIkxlZnQiLCAiUmlnaHQiIF0sCgljc3NIZWlnaHQgPSBbICJUb3AiLCAiQm90dG9tIiBdLAoJY3VyQ1NTLAoKCWdldENvbXB1dGVkU3R5bGUsCgljdXJyZW50U3R5bGU7CgpqUXVlcnkuZm4uY3NzID0gZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJLy8gU2V0dGluZyAndW5kZWZpbmVkJyBpcyBhIG5vLW9wCglpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQlyZXR1cm4gdGhpczsKCX0KCglyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgbmFtZSwgdmFsdWUsIHRydWUsIGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/CgkJCWpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSwgdmFsdWUgKSA6CgkJCWpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsKCX0pOwp9OwoKalF1ZXJ5LmV4dGVuZCh7CgkvLyBBZGQgaW4gc3R5bGUgcHJvcGVydHkgaG9va3MgZm9yIG92ZXJyaWRpbmcgdGhlIGRlZmF1bHQKCS8vIGJlaGF2aW9yIG9mIGdldHRpbmcgYW5kIHNldHRpbmcgYSBzdHlsZSBwcm9wZXJ0eQoJY3NzSG9va3M6IHsKCQlvcGFjaXR5OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkvLyBXZSBzaG91bGQgYWx3YXlzIGdldCBhIG51bWJlciBiYWNrIGZyb20gb3BhY2l0eQoJCQkJCXZhciByZXQgPSBjdXJDU1MoIGVsZW0sICJvcGFjaXR5IiwgIm9wYWNpdHkiICk7CgkJCQkJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7CgoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gZWxlbS5zdHlsZS5vcGFjaXR5OwoJCQkJfQoJCQl9CgkJfQoJfSwKCgkvLyBFeGNsdWRlIHRoZSBmb2xsb3dpbmcgY3NzIHByb3BlcnRpZXMgdG8gYWRkIHB4Cgljc3NOdW1iZXI6IHsKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCQkvLyBub3JtYWxpemUgZmxvYXQgY3NzIHByb3BlcnR5CgkJImZsb2F0IjogalF1ZXJ5LnN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICksCgkJCXN0eWxlID0gZWxlbS5zdHlsZSwgaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgb3JpZ05hbWU7CgoJCS8vIENoZWNrIGlmIHdlJ3JlIHNldHRpbmcgYSB2YWx1ZQoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJdHlwZSA9IHR5cGVvZiB2YWx1ZTsKCgkJCS8vIGNvbnZlcnQgcmVsYXRpdmUgbnVtYmVyIHN0cmluZ3MgKCs9IG9yIC09KSB0byByZWxhdGl2ZSBudW1iZXJzLiAjNzM0NQoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICYmIChyZXQgPSBycmVsTnVtLmV4ZWMoIHZhbHVlICkpICkgewoJCQkJdmFsdWUgPSAoICsoIHJldFsxXSArIDEpICogK3JldFsyXSApICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgTmFOIGFuZCBudWxsIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSAibnVtYmVyIiAmJiBpc05hTiggdmFsdWUgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCWlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgIWpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gKSB7CgkJCQl2YWx1ZSArPSAicHgiOwoJCQl9CgoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJLy8gV3JhcHBlZCB0byBwcmV2ZW50IElFIGZyb20gdGhyb3dpbmcgZXJyb3JzIHdoZW4gJ2ludmFsaWQnIHZhbHVlcyBhcmUgcHJvdmlkZWQKCQkJCS8vIEZpeGVzIGJ1ZyAjNTUwOQoJCQkJdHJ5IHsKCQkJCQlzdHlsZVsgbmFtZSBdID0gdmFsdWU7CgkJCQl9IGNhdGNoKGUpIHt9CgkJCX0KCgkJfSBlbHNlIHsKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgZmFsc2UsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgoJCQkvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdAoJCQlyZXR1cm4gc3R5bGVbIG5hbWUgXTsKCQl9Cgl9LAoKCWNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhICkgewoJCXZhciByZXQsIGhvb2tzOwoKCQkvLyBNYWtlIHN1cmUgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggdGhlIHJpZ2h0IG5hbWUKCQluYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApOwoJCWhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07CgkJbmFtZSA9IGpRdWVyeS5jc3NQcm9wc1sgbmFtZSBdIHx8IG5hbWU7CgoJCS8vIGNzc0Zsb2F0IG5lZWRzIGEgc3BlY2lhbCB0cmVhdG1lbnQKCQlpZiAoIG5hbWUgPT09ICJjc3NGbG9hdCIgKSB7CgkJCW5hbWUgPSAiZmxvYXQiOwoJCX0KCgkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIHRydWUsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiByZXQ7CgoJCS8vIE90aGVyd2lzZSwgaWYgYSB3YXkgdG8gZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBleGlzdHMsIHVzZSB0aGF0CgkJfSBlbHNlIGlmICggY3VyQ1NTICkgewoJCQlyZXR1cm4gY3VyQ1NTKCBlbGVtLCBuYW1lICk7CgkJfQoJfSwKCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCglzd2FwOiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgY2FsbGJhY2sgKSB7CgkJdmFyIG9sZCA9IHt9OwoKCQkvLyBSZW1lbWJlciB0aGUgb2xkIHZhbHVlcywgYW5kIGluc2VydCB0aGUgbmV3IG9uZXMKCQlmb3IgKCB2YXIgbmFtZSBpbiBvcHRpb25zICkgewoJCQlvbGRbIG5hbWUgXSA9IGVsZW0uc3R5bGVbIG5hbWUgXTsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdOwoJCX0KCgkJY2FsbGJhY2suY2FsbCggZWxlbSApOwoKCQkvLyBSZXZlcnQgdGhlIG9sZCB2YWx1ZXMKCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJCWVsZW0uc3R5bGVbIG5hbWUgXSA9IG9sZFsgbmFtZSBdOwoJCX0KCX0KfSk7CgovLyBERVBSRUNBVEVELCBVc2UgalF1ZXJ5LmNzcygpIGluc3RlYWQKalF1ZXJ5LmN1ckNTUyA9IGpRdWVyeS5jc3M7CgpqUXVlcnkuZWFjaChbImhlaWdodCIsICJ3aWR0aCJdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJdmFyIHZhbDsKCgkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQlpZiAoIGVsZW0ub2Zmc2V0V2lkdGggIT09IDAgKSB7CgkJCQkJcmV0dXJuIGdldFdIKCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJfSBlbHNlIHsKCQkJCQlqUXVlcnkuc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCXZhbCA9IGdldFdIKCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJCX0pOwoJCQkJfQoKCQkJCXJldHVybiB2YWw7CgkJCX0KCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJaWYgKCBybnVtcHgudGVzdCggdmFsdWUgKSApIHsKCQkJCS8vIGlnbm9yZSBuZWdhdGl2ZSB3aWR0aCBhbmQgaGVpZ2h0IHZhbHVlcyAjMTU5OQoJCQkJdmFsdWUgPSBwYXJzZUZsb2F0KCB2YWx1ZSApOwoKCQkJCWlmICggdmFsdWUgPj0gMCApIHsKCQkJCQlyZXR1cm4gdmFsdWUgKyAicHgiOwoJCQkJfQoKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB2YWx1ZTsKCQkJfQoJCX0KCX07Cn0pOwoKaWYgKCAhalF1ZXJ5LnN1cHBvcnQub3BhY2l0eSApIHsKCWpRdWVyeS5jc3NIb29rcy5vcGFjaXR5ID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkvLyBJRSB1c2VzIGZpbHRlcnMgZm9yIG9wYWNpdHkKCQkJcmV0dXJuIHJvcGFjaXR5LnRlc3QoIChjb21wdXRlZCAmJiBlbGVtLmN1cnJlbnRTdHlsZSA/IGVsZW0uY3VycmVudFN0eWxlLmZpbHRlciA6IGVsZW0uc3R5bGUuZmlsdGVyKSB8fCAiIiApID8KCQkJCSggcGFyc2VGbG9hdCggUmVnRXhwLiQxICkgLyAxMDAgKSArICIiIDoKCQkJCWNvbXB1dGVkID8gIjEiIDogIiI7CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCXZhciBzdHlsZSA9IGVsZW0uc3R5bGUsCgkJCQljdXJyZW50U3R5bGUgPSBlbGVtLmN1cnJlbnRTdHlsZSwKCQkJCW9wYWNpdHkgPSBqUXVlcnkuaXNOdW1lcmljKCB2YWx1ZSApID8gImFscGhhKG9wYWNpdHk9IiArIHZhbHVlICogMTAwICsgIikiIDogIiIsCgkJCQlmaWx0ZXIgPSBjdXJyZW50U3R5bGUgJiYgY3VycmVudFN0eWxlLmZpbHRlciB8fCBzdHlsZS5maWx0ZXIgfHwgIiI7CgoJCQkvLyBJRSBoYXMgdHJvdWJsZSB3aXRoIG9wYWNpdHkgaWYgaXQgZG9lcyBub3QgaGF2ZSBsYXlvdXQKCQkJLy8gRm9yY2UgaXQgYnkgc2V0dGluZyB0aGUgem9vbSBsZXZlbAoJCQlzdHlsZS56b29tID0gMTsKCgkJCS8vIGlmIHNldHRpbmcgb3BhY2l0eSB0byAxLCBhbmQgbm8gb3RoZXIgZmlsdGVycyBleGlzdCAtIGF0dGVtcHQgdG8gcmVtb3ZlIGZpbHRlciBhdHRyaWJ1dGUgIzY2NTIKCQkJaWYgKCB2YWx1ZSA+PSAxICYmIGpRdWVyeS50cmltKCBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCAiIiApICkgPT09ICIiICkgewoKCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJLy8gaWYgImZpbHRlcjoiIGlzIHByZXNlbnQgYXQgYWxsLCBjbGVhclR5cGUgaXMgZGlzYWJsZWQsIHdlIHdhbnQgdG8gYXZvaWQgdGhpcwoJCQkJLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uCgkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJLy8gaWYgdGhlcmUgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSwgd2UgYXJlIGRvbmUKCQkJCWlmICggY3VycmVudFN0eWxlICYmICFjdXJyZW50U3R5bGUuZmlsdGVyICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoKCQkJLy8gb3RoZXJ3aXNlLCBzZXQgbmV3IGZpbHRlciB2YWx1ZXMKCQkJc3R5bGUuZmlsdGVyID0gcmFscGhhLnRlc3QoIGZpbHRlciApID8KCQkJCWZpbHRlci5yZXBsYWNlKCByYWxwaGEsIG9wYWNpdHkgKSA6CgkJCQlmaWx0ZXIgKyAiICIgKyBvcGFjaXR5OwoJCX0KCX07Cn0KCmpRdWVyeShmdW5jdGlvbigpIHsKCS8vIFRoaXMgaG9vayBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdAoJLy8gZm9yIGl0IGlzIG5vdCBydW4gdW50aWwgYWZ0ZXIgRE9NIHJlYWR5CglpZiAoICFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ICkgewoJCWpRdWVyeS5jc3NIb29rcy5tYXJnaW5SaWdodCA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQkvLyBXZWJLaXQgQnVnIDEzMzQzIC0gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHdyb25nIHZhbHVlIGZvciBtYXJnaW4tcmlnaHQKCQkJCS8vIFdvcmsgYXJvdW5kIGJ5IHRlbXBvcmFyaWx5IHNldHRpbmcgZWxlbWVudCBkaXNwbGF5IHRvIGlubGluZS1ibG9jawoJCQkJdmFyIHJldDsKCQkJCWpRdWVyeS5zd2FwKCBlbGVtLCB7ICJkaXNwbGF5IjogImlubGluZS1ibG9jayIgfSwgZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkJcmV0ID0gY3VyQ1NTKCBlbGVtLCAibWFyZ2luLXJpZ2h0IiwgIm1hcmdpblJpZ2h0IiApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCA9IGVsZW0uc3R5bGUubWFyZ2luUmlnaHQ7CgkJCQkJfQoJCQkJfSk7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfTsKCX0KfSk7CgppZiAoIGRvY3VtZW50LmRlZmF1bHRWaWV3ICYmIGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUgKSB7CglnZXRDb21wdXRlZFN0eWxlID0gZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJdmFyIHJldCwgZGVmYXVsdFZpZXcsIGNvbXB1dGVkU3R5bGU7CgoJCW5hbWUgPSBuYW1lLnJlcGxhY2UoIHJ1cHBlciwgIi0kMSIgKS50b0xvd2VyQ2FzZSgpOwoKCQlpZiAoIChkZWZhdWx0VmlldyA9IGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykgJiYKCQkJCShjb21wdXRlZFN0eWxlID0gZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSwgbnVsbCApKSApIHsKCQkJcmV0ID0gY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCBuYW1lICk7CgkJCWlmICggcmV0ID09PSAiIiAmJiAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBlbGVtICkgKSB7CgkJCQlyZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX07Cn0KCmlmICggZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSApIHsKCWN1cnJlbnRTdHlsZSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXZhciBsZWZ0LCByc0xlZnQsIHVuY29tcHV0ZWQsCgkJCXJldCA9IGVsZW0uY3VycmVudFN0eWxlICYmIGVsZW0uY3VycmVudFN0eWxlWyBuYW1lIF0sCgkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJLy8gQXZvaWQgc2V0dGluZyByZXQgdG8gZW1wdHkgc3RyaW5nIGhlcmUKCQkvLyBzbyB3ZSBkb24ndCBkZWZhdWx0IHRvIGF1dG8KCQlpZiAoIHJldCA9PT0gbnVsbCAmJiBzdHlsZSAmJiAodW5jb21wdXRlZCA9IHN0eWxlWyBuYW1lIF0pICkgewoJCQlyZXQgPSB1bmNvbXB1dGVkOwoJCX0KCgkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcwoJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyCgkJLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCgkJaWYgKCAhcm51bXB4LnRlc3QoIHJldCApICYmIHJudW0udGVzdCggcmV0ICkgKSB7CgoJCQkvLyBSZW1lbWJlciB0aGUgb3JpZ2luYWwgdmFsdWVzCgkJCWxlZnQgPSBzdHlsZS5sZWZ0OwoJCQlyc0xlZnQgPSBlbGVtLnJ1bnRpbWVTdHlsZSAmJiBlbGVtLnJ1bnRpbWVTdHlsZS5sZWZ0OwoKCQkJLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dAoJCQlpZiAoIHJzTGVmdCApIHsKCQkJCWVsZW0ucnVudGltZVN0eWxlLmxlZnQgPSBlbGVtLmN1cnJlbnRTdHlsZS5sZWZ0OwoJCQl9CgkJCXN0eWxlLmxlZnQgPSBuYW1lID09PSAiZm9udFNpemUiID8gIjFlbSIgOiAoIHJldCB8fCAwICk7CgkJCXJldCA9IHN0eWxlLnBpeGVsTGVmdCArICJweCI7CgoJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCXN0eWxlLmxlZnQgPSBsZWZ0OwoJCQlpZiAoIHJzTGVmdCApIHsKCQkJCWVsZW0ucnVudGltZVN0eWxlLmxlZnQgPSByc0xlZnQ7CgkJCX0KCQl9CgoJCXJldHVybiByZXQgPT09ICIiID8gImF1dG8iIDogcmV0OwoJfTsKfQoKY3VyQ1NTID0gZ2V0Q29tcHV0ZWRTdHlsZSB8fCBjdXJyZW50U3R5bGU7CgpmdW5jdGlvbiBnZXRXSCggZWxlbSwgbmFtZSwgZXh0cmEgKSB7CgoJLy8gU3RhcnQgd2l0aCBvZmZzZXQgcHJvcGVydHkKCXZhciB2YWwgPSBuYW1lID09PSAid2lkdGgiID8gZWxlbS5vZmZzZXRXaWR0aCA6IGVsZW0ub2Zmc2V0SGVpZ2h0LAoJCXdoaWNoID0gbmFtZSA9PT0gIndpZHRoIiA/IGNzc1dpZHRoIDogY3NzSGVpZ2h0LAoJCWkgPSAwLAoJCWxlbiA9IHdoaWNoLmxlbmd0aDsKCglpZiAoIHZhbCA+IDAgKSB7CgkJaWYgKCBleHRyYSAhPT0gImJvcmRlciIgKSB7CgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJaWYgKCAhZXh0cmEgKSB7CgkJCQkJdmFsIC09IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIHdoaWNoWyBpIF0gKSApIHx8IDA7CgkJCQl9CgkJCQlpZiAoIGV4dHJhID09PSAibWFyZ2luIiApIHsKCQkJCQl2YWwgKz0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgZXh0cmEgKyB3aGljaFsgaSBdICkgKSB8fCAwOwoJCQkJfSBlbHNlIHsKCQkJCQl2YWwgLT0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyB3aGljaFsgaSBdICsgIldpZHRoIiApICkgfHwgMDsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHZhbCArICJweCI7Cgl9CgoJLy8gRmFsbCBiYWNrIHRvIGNvbXB1dGVkIHRoZW4gdW5jb21wdXRlZCBjc3MgaWYgbmVjZXNzYXJ5Cgl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIG5hbWUgKTsKCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQl2YWwgPSBlbGVtLnN0eWxlWyBuYW1lIF0gfHwgMDsKCX0KCS8vIE5vcm1hbGl6ZSAiIiwgYXV0bywgYW5kIHByZXBhcmUgZm9yIGV4dHJhCgl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoKCS8vIEFkZCBwYWRkaW5nLCBib3JkZXIsIG1hcmdpbgoJaWYgKCBleHRyYSApIHsKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJdmFsICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIHdoaWNoWyBpIF0gKSApIHx8IDA7CgkJCWlmICggZXh0cmEgIT09ICJwYWRkaW5nIiApIHsKCQkJCXZhbCArPSBwYXJzZUZsb2F0KCBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIHdoaWNoWyBpIF0gKyAiV2lkdGgiICkgKSB8fCAwOwoJCQl9CgkJCWlmICggZXh0cmEgPT09ICJtYXJnaW4iICkgewoJCQkJdmFsICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sIGV4dHJhICsgd2hpY2hbIGkgXSApICkgfHwgMDsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdmFsICsgInB4IjsKfQoKaWYgKCBqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzICkgewoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgd2lkdGggPSBlbGVtLm9mZnNldFdpZHRoLAoJCQloZWlnaHQgPSBlbGVtLm9mZnNldEhlaWdodDsKCgkJcmV0dXJuICggd2lkdGggPT09IDAgJiYgaGVpZ2h0ID09PSAwICkgfHwgKCFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgJiYgKChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkpID09PSAibm9uZSIpOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9Owp9CgoKCgp2YXIgcjIwID0gLyUyMC9nLAoJcmJyYWNrZXQgPSAvXFtcXSQvLAoJckNSTEYgPSAvXHI/XG4vZywKCXJoYXNoID0gLyMuKiQvLAoJcmhlYWRlcnMgPSAvXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLCAvLyBJRSBsZWF2ZXMgYW4gXHIgY2hhcmFjdGVyIGF0IEVPTAoJcmlucHV0ID0gL14oPzpjb2xvcnxkYXRlfGRhdGV0aW1lfGRhdGV0aW1lLWxvY2FsfGVtYWlsfGhpZGRlbnxtb250aHxudW1iZXJ8cGFzc3dvcmR8cmFuZ2V8c2VhcmNofHRlbHx0ZXh0fHRpbWV8dXJsfHdlZWspJC9pLAoJLy8gIzc2NTMsICM4MTI1LCAjODE1MjogbG9jYWwgcHJvdG9jb2wgZGV0ZWN0aW9uCglybG9jYWxQcm90b2NvbCA9IC9eKD86YWJvdXR8YXBwfGFwcFwtc3RvcmFnZXwuK1wtZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCglybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCXJwcm90b2NvbCA9IC9eXC9cLy8sCglycXVlcnkgPSAvXD8vLAoJcnNjcmlwdCA9IC88c2NyaXB0XGJbXjxdKig/Oig/ITxcL3NjcmlwdD4pPFtePF0qKSo8XC9zY3JpcHQ+L2dpLAoJcnNlbGVjdFRleHRhcmVhID0gL14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksCglyc3BhY2VzQWpheCA9IC9ccysvLAoJcnRzID0gLyhbPyZdKV89W14mXSovLAoJcnVybCA9IC9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LywKCgkvLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kCglfbG9hZCA9IGpRdWVyeS5mbi5sb2FkLAoKCS8qIFByZWZpbHRlcnMKCSAqIDEpIFRoZXkgYXJlIHVzZWZ1bCB0byBpbnRyb2R1Y2UgY3VzdG9tIGRhdGFUeXBlcyAoc2VlIGFqYXgvanNvbnAuanMgZm9yIGFuIGV4YW1wbGUpCgkgKiAyKSBUaGVzZSBhcmUgY2FsbGVkOgoJICogICAgLSBCRUZPUkUgYXNraW5nIGZvciBhIHRyYW5zcG9ydAoJICogICAgLSBBRlRFUiBwYXJhbSBzZXJpYWxpemF0aW9uIChzLmRhdGEgaXMgYSBzdHJpbmcgaWYgcy5wcm9jZXNzRGF0YSBpcyB0cnVlKQoJICogMykga2V5IGlzIHRoZSBkYXRhVHlwZQoJICogNCkgdGhlIGNhdGNoYWxsIHN5bWJvbCAiKiIgY2FuIGJlIHVzZWQKCSAqIDUpIGV4ZWN1dGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGNvbnRpbnVlIGRvd24gdG8gIioiIGlmIG5lZWRlZAoJICovCglwcmVmaWx0ZXJzID0ge30sCgoJLyogVHJhbnNwb3J0cyBiaW5kaW5ncwoJICogMSkga2V5IGlzIHRoZSBkYXRhVHlwZQoJICogMikgdGhlIGNhdGNoYWxsIHN5bWJvbCAiKiIgY2FuIGJlIHVzZWQKCSAqIDMpIHNlbGVjdGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGdvIHRvICIqIiBpZiBuZWVkZWQKCSAqLwoJdHJhbnNwb3J0cyA9IHt9LAoKCS8vIERvY3VtZW50IGxvY2F0aW9uCglhamF4TG9jYXRpb24sCgoJLy8gRG9jdW1lbnQgbG9jYXRpb24gc2VnbWVudHMKCWFqYXhMb2NQYXJ0cywKCgkvLyBBdm9pZCBjb21tZW50LXByb2xvZyBjaGFyIHNlcXVlbmNlICgjMTAwOTgpOyBtdXN0IGFwcGVhc2UgbGludCBhbmQgZXZhZGUgY29tcHJlc3Npb24KCWFsbFR5cGVzID0gWyIqLyJdICsgWyIqIl07CgovLyAjODEzOCwgSUUgbWF5IHRocm93IGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwovLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKdHJ5IHsKCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7Cn0gY2F0Y2goIGUgKSB7CgkvLyBVc2UgdGhlIGhyZWYgYXR0cmlidXRlIG9mIGFuIEEgZWxlbWVudAoJLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb24KCWFqYXhMb2NhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJhIiApOwoJYWpheExvY2F0aW9uLmhyZWYgPSAiIjsKCWFqYXhMb2NhdGlvbiA9IGFqYXhMb2NhdGlvbi5ocmVmOwp9CgovLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBmdW5jICkgKSB7CgkJCXZhciBkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5zcGxpdCggcnNwYWNlc0FqYXggKSwKCQkJCWkgPSAwLAoJCQkJbGVuZ3RoID0gZGF0YVR5cGVzLmxlbmd0aCwKCQkJCWRhdGFUeXBlLAoJCQkJbGlzdCwKCQkJCXBsYWNlQmVmb3JlOwoKCQkJLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGRhdGFUeXBlRXhwcmVzc2lvbgoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWRhdGFUeXBlID0gZGF0YVR5cGVzWyBpIF07CgkJCQkvLyBXZSBjb250cm9sIGlmIHdlJ3JlIGFza2VkIHRvIGFkZCBiZWZvcmUKCQkJCS8vIGFueSBleGlzdGluZyBlbGVtZW50CgkJCQlwbGFjZUJlZm9yZSA9IC9eXCsvLnRlc3QoIGRhdGFUeXBlICk7CgkJCQlpZiAoIHBsYWNlQmVmb3JlICkgewoJCQkJCWRhdGFUeXBlID0gZGF0YVR5cGUuc3Vic3RyKCAxICkgfHwgIioiOwoJCQkJfQoJCQkJbGlzdCA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXTsKCQkJCS8vIHRoZW4gd2UgYWRkIHRvIHRoZSBzdHJ1Y3R1cmUgYWNjb3JkaW5nbHkKCQkJCWxpc3RbIHBsYWNlQmVmb3JlID8gInVuc2hpZnQiIDogInB1c2giIF0oIGZ1bmMgKTsKCQkJfQoJCX0KCX07Cn0KCi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwpmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSLAoJCWRhdGFUeXBlIC8qIGludGVybmFsICovLCBpbnNwZWN0ZWQgLyogaW50ZXJuYWwgKi8gKSB7CgoJZGF0YVR5cGUgPSBkYXRhVHlwZSB8fCBvcHRpb25zLmRhdGFUeXBlc1sgMCBdOwoJaW5zcGVjdGVkID0gaW5zcGVjdGVkIHx8IHt9OwoKCWluc3BlY3RlZFsgZGF0YVR5cGUgXSA9IHRydWU7CgoJdmFyIGxpc3QgPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0sCgkJaSA9IDAsCgkJbGVuZ3RoID0gbGlzdCA/IGxpc3QubGVuZ3RoIDogMCwKCQlleGVjdXRlT25seSA9ICggc3RydWN0dXJlID09PSBwcmVmaWx0ZXJzICksCgkJc2VsZWN0aW9uOwoKCWZvciAoIDsgaSA8IGxlbmd0aCAmJiAoIGV4ZWN1dGVPbmx5IHx8ICFzZWxlY3Rpb24gKTsgaSsrICkgewoJCXNlbGVjdGlvbiA9IGxpc3RbIGkgXSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApOwoJCS8vIElmIHdlIGdvdCByZWRpcmVjdGVkIHRvIGFub3RoZXIgZGF0YVR5cGUKCQkvLyB3ZSB0cnkgdGhlcmUgaWYgZXhlY3V0aW5nIG9ubHkgYW5kIG5vdCBkb25lIGFscmVhZHkKCQlpZiAoIHR5cGVvZiBzZWxlY3Rpb24gPT09ICJzdHJpbmciICkgewoJCQlpZiAoICFleGVjdXRlT25seSB8fCBpbnNwZWN0ZWRbIHNlbGVjdGlvbiBdICkgewoJCQkJc2VsZWN0aW9uID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJb3B0aW9ucy5kYXRhVHlwZXMudW5zaGlmdCggc2VsZWN0aW9uICk7CgkJCQlzZWxlY3Rpb24gPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cygKCQkJCQkJc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSLCBzZWxlY3Rpb24sIGluc3BlY3RlZCApOwoJCQl9CgkJfQoJfQoJLy8gSWYgd2UncmUgb25seSBleGVjdXRpbmcgb3Igbm90aGluZyB3YXMgc2VsZWN0ZWQKCS8vIHdlIHRyeSB0aGUgY2F0Y2hhbGwgZGF0YVR5cGUgaWYgbm90IGRvbmUgYWxyZWFkeQoJaWYgKCAoIGV4ZWN1dGVPbmx5IHx8ICFzZWxlY3Rpb24gKSAmJiAhaW5zcGVjdGVkWyAiKiIgXSApIHsKCQlzZWxlY3Rpb24gPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cygKCQkJCXN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiwgIioiLCBpbnNwZWN0ZWQgKTsKCX0KCS8vIHVubmVjZXNzYXJ5IHdoZW4gb25seSBleGVjdXRpbmcgKHByZWZpbHRlcnMpCgkvLyBidXQgaXQnbGwgYmUgaWdub3JlZCBieSB0aGUgY2FsbGVyIGluIHRoYXQgY2FzZQoJcmV0dXJuIHNlbGVjdGlvbjsKfQoKLy8gQSBzcGVjaWFsIGV4dGVuZCBmb3IgYWpheCBvcHRpb25zCi8vIHRoYXQgdGFrZXMgImZsYXQiIG9wdGlvbnMgKG5vdCB0byBiZSBkZWVwIGV4dGVuZGVkKQovLyBGaXhlcyAjOTg4NwpmdW5jdGlvbiBhamF4RXh0ZW5kKCB0YXJnZXQsIHNyYyApIHsKCXZhciBrZXksIGRlZXAsCgkJZmxhdE9wdGlvbnMgPSBqUXVlcnkuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zIHx8IHt9OwoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKCBkZWVwID0ge30gKSApIClbIGtleSBdID0gc3JjWyBrZXkgXTsKCQl9Cgl9CglpZiAoIGRlZXAgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdHJ1ZSwgdGFyZ2V0LCBkZWVwICk7Cgl9Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoJbG9hZDogZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCQlpZiAoIHR5cGVvZiB1cmwgIT09ICJzdHJpbmciICYmIF9sb2FkICkgewoJCQlyZXR1cm4gX2xvYWQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoKCQkvLyBEb24ndCBkbyBhIHJlcXVlc3QgaWYgbm8gZWxlbWVudHMgYXJlIGJlaW5nIHJlcXVlc3RlZAoJCX0gZWxzZSBpZiAoICF0aGlzLmxlbmd0aCApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQl2YXIgb2ZmID0gdXJsLmluZGV4T2YoICIgIiApOwoJCWlmICggb2ZmID49IDAgKSB7CgkJCXZhciBzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7CgkJCXVybCA9IHVybC5zbGljZSggMCwgb2ZmICk7CgkJfQoKCQkvLyBEZWZhdWx0IHRvIGEgR0VUIHJlcXVlc3QKCQl2YXIgdHlwZSA9ICJHRVQiOwoKCQkvLyBJZiB0aGUgc2Vjb25kIHBhcmFtZXRlciB3YXMgcHJvdmlkZWQKCQlpZiAoIHBhcmFtcyApIHsKCQkJLy8gSWYgaXQncyBhIGZ1bmN0aW9uCgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoJCQkJLy8gV2UgYXNzdW1lIHRoYXQgaXQncyB0aGUgY2FsbGJhY2sKCQkJCWNhbGxiYWNrID0gcGFyYW1zOwoJCQkJcGFyYW1zID0gdW5kZWZpbmVkOwoKCQkJLy8gT3RoZXJ3aXNlLCBidWlsZCBhIHBhcmFtIHN0cmluZwoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgcGFyYW1zID09PSAib2JqZWN0IiApIHsKCQkJCXBhcmFtcyA9IGpRdWVyeS5wYXJhbSggcGFyYW1zLCBqUXVlcnkuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsICk7CgkJCQl0eXBlID0gIlBPU1QiOwoJCQl9CgkJfQoKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCS8vIFJlcXVlc3QgdGhlIHJlbW90ZSBkb2N1bWVudAoJCWpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IHR5cGUsCgkJCWRhdGFUeXBlOiAiaHRtbCIsCgkJCWRhdGE6IHBhcmFtcywKCQkJLy8gQ29tcGxldGUgY2FsbGJhY2sgKHJlc3BvbnNlVGV4dCBpcyB1c2VkIGludGVybmFsbHkpCgkJCWNvbXBsZXRlOiBmdW5jdGlvbigganFYSFIsIHN0YXR1cywgcmVzcG9uc2VUZXh0ICkgewoJCQkJLy8gU3RvcmUgdGhlIHJlc3BvbnNlIGFzIHNwZWNpZmllZCBieSB0aGUganFYSFIgb2JqZWN0CgkJCQlyZXNwb25zZVRleHQgPSBqcVhIUi5yZXNwb25zZVRleHQ7CgkJCQkvLyBJZiBzdWNjZXNzZnVsLCBpbmplY3QgdGhlIEhUTUwgaW50byBhbGwgdGhlIG1hdGNoZWQgZWxlbWVudHMKCQkJCWlmICgganFYSFIuaXNSZXNvbHZlZCgpICkgewoJCQkJCS8vICM0ODI1OiBHZXQgdGhlIGFjdHVhbCByZXNwb25zZSBpbiBjYXNlCgkJCQkJLy8gYSBkYXRhRmlsdGVyIGlzIHByZXNlbnQgaW4gYWpheFNldHRpbmdzCgkJCQkJanFYSFIuZG9uZShmdW5jdGlvbiggciApIHsKCQkJCQkJcmVzcG9uc2VUZXh0ID0gcjsKCQkJCQl9KTsKCQkJCQkvLyBTZWUgaWYgYSBzZWxlY3RvciB3YXMgc3BlY2lmaWVkCgkJCQkJc2VsZi5odG1sKCBzZWxlY3RvciA/CgkJCQkJCS8vIENyZWF0ZSBhIGR1bW15IGRpdiB0byBob2xkIHRoZSByZXN1bHRzCgkJCQkJCWpRdWVyeSgiPGRpdj4iKQoJCQkJCQkJLy8gaW5qZWN0IHRoZSBjb250ZW50cyBvZiB0aGUgZG9jdW1lbnQgaW4sIHJlbW92aW5nIHRoZSBzY3JpcHRzCgkJCQkJCQkvLyB0byBhdm9pZCBhbnkgJ1Blcm1pc3Npb24gRGVuaWVkJyBlcnJvcnMgaW4gSUUKCQkJCQkJCS5hcHBlbmQocmVzcG9uc2VUZXh0LnJlcGxhY2UocnNjcmlwdCwgIiIpKQoKCQkJCQkJCS8vIExvY2F0ZSB0aGUgc3BlY2lmaWVkIGVsZW1lbnRzCgkJCQkJCQkuZmluZChzZWxlY3RvcikgOgoKCQkJCQkJLy8gSWYgbm90LCBqdXN0IGluamVjdCB0aGUgZnVsbCByZXN1bHQKCQkJCQkJcmVzcG9uc2VUZXh0ICk7CgkJCQl9CgoJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQlzZWxmLmVhY2goIGNhbGxiYWNrLCBbIHJlc3BvbnNlVGV4dCwgc3RhdHVzLCBqcVhIUiBdICk7CgkJCQl9CgkJCX0KCQl9KTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGpRdWVyeS5wYXJhbSggdGhpcy5zZXJpYWxpemVBcnJheSgpICk7Cgl9LAoKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsKCQkJcmV0dXJuIHRoaXMuZWxlbWVudHMgPyBqUXVlcnkubWFrZUFycmF5KCB0aGlzLmVsZW1lbnRzICkgOiB0aGlzOwoJCX0pCgkJLmZpbHRlcihmdW5jdGlvbigpewoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICF0aGlzLmRpc2FibGVkICYmCgkJCQkoIHRoaXMuY2hlY2tlZCB8fCByc2VsZWN0VGV4dGFyZWEudGVzdCggdGhpcy5ub2RlTmFtZSApIHx8CgkJCQkJcmlucHV0LnRlc3QoIHRoaXMudHlwZSApICk7CgkJfSkKCQkubWFwKGZ1bmN0aW9uKCBpLCBlbGVtICl7CgkJCXZhciB2YWwgPSBqUXVlcnkoIHRoaXMgKS52YWwoKTsKCgkJCXJldHVybiB2YWwgPT0gbnVsbCA/CgkJCQludWxsIDoKCQkJCWpRdWVyeS5pc0FycmF5KCB2YWwgKSA/CgkJCQkJalF1ZXJ5Lm1hcCggdmFsLCBmdW5jdGlvbiggdmFsLCBpICl7CgkJCQkJCXJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQkJCQl9KSA6CgkJCQkJeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07CgkJfSkuZ2V0KCk7Cgl9Cn0pOwoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goICJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoICIgIiApLCBmdW5jdGlvbiggaSwgbyApewoJalF1ZXJ5LmZuWyBvIF0gPSBmdW5jdGlvbiggZiApewoJCXJldHVybiB0aGlzLm9uKCBvLCBmICk7Cgl9Owp9KTsKCmpRdWVyeS5lYWNoKCBbICJnZXQiLCAicG9zdCIgXSwgZnVuY3Rpb24oIGksIG1ldGhvZCApIHsKCWpRdWVyeVsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSApIHsKCQkvLyBzaGlmdCBhcmd1bWVudHMgaWYgZGF0YSBhcmd1bWVudCB3YXMgb21pdHRlZAoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGRhdGEgKSApIHsKCQkJdHlwZSA9IHR5cGUgfHwgY2FsbGJhY2s7CgkJCWNhbGxiYWNrID0gZGF0YTsKCQkJZGF0YSA9IHVuZGVmaW5lZDsKCQl9CgoJCXJldHVybiBqUXVlcnkuYWpheCh7CgkJCXR5cGU6IG1ldGhvZCwKCQkJdXJsOiB1cmwsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrLAoJCQlkYXRhVHlwZTogdHlwZQoJCX0pOwoJfTsKfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCglnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgewoJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIHVuZGVmaW5lZCwgY2FsbGJhY2ssICJzY3JpcHQiICk7Cgl9LAoKCWdldEpTT046IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrICkgewoJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIGRhdGEsIGNhbGxiYWNrLCAianNvbiIgKTsKCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCWlmICggc2V0dGluZ3MgKSB7CgkJCS8vIEJ1aWxkaW5nIGEgc2V0dGluZ3Mgb2JqZWN0CgkJCWFqYXhFeHRlbmQoIHRhcmdldCwgalF1ZXJ5LmFqYXhTZXR0aW5ncyApOwoJCX0gZWxzZSB7CgkJCS8vIEV4dGVuZGluZyBhamF4U2V0dGluZ3MKCQkJc2V0dGluZ3MgPSB0YXJnZXQ7CgkJCXRhcmdldCA9IGpRdWVyeS5hamF4U2V0dGluZ3M7CgkJfQoJCWFqYXhFeHRlbmQoIHRhcmdldCwgc2V0dGluZ3MgKTsKCQlyZXR1cm4gdGFyZ2V0OwoJfSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQl0eXBlOiAiR0VUIiwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsCgkJcHJvY2Vzc0RhdGE6IHRydWUsCgkJYXN5bmM6IHRydWUsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdHJhZGl0aW9uYWw6IGZhbHNlLAoJCWhlYWRlcnM6IHt9LAoJCSovCgoJCWFjY2VwdHM6IHsKCQkJeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWpzb246ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLAoJCQkiKiI6IGFsbFR5cGVzCgkJfSwKCgkJY29udGVudHM6IHsKCQkJeG1sOiAveG1sLywKCQkJaHRtbDogL2h0bWwvLAoJCQlqc29uOiAvanNvbi8KCQl9LAoKCQlyZXNwb25zZUZpZWxkczogewoJCQl4bWw6ICJyZXNwb25zZVhNTCIsCgkJCXRleHQ6ICJyZXNwb25zZVRleHQiCgkJfSwKCgkJLy8gTGlzdCBvZiBkYXRhIGNvbnZlcnRlcnMKCQkvLyAxKSBrZXkgZm9ybWF0IGlzICJzb3VyY2VfdHlwZSBkZXN0aW5hdGlvbl90eXBlIiAoYSBzaW5nbGUgc3BhY2UgaW4tYmV0d2VlbikKCQkvLyAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZCBmb3Igc291cmNlX3R5cGUKCQljb252ZXJ0ZXJzOiB7CgoJCQkvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKCQkJIiogdGV4dCI6IHdpbmRvdy5TdHJpbmcsCgoJCQkvLyBUZXh0IHRvIGh0bWwgKHRydWUgPSBubyB0cmFuc2Zvcm1hdGlvbikKCQkJInRleHQgaHRtbCI6IHRydWUsCgoJCQkvLyBFdmFsdWF0ZSB0ZXh0IGFzIGEganNvbiBleHByZXNzaW9uCgkJCSJ0ZXh0IGpzb24iOiBqUXVlcnkucGFyc2VKU09OLAoKCQkJLy8gUGFyc2UgdGV4dCBhcyB4bWwKCQkJInRleHQgeG1sIjogalF1ZXJ5LnBhcnNlWE1MCgkJfSwKCgkJLy8gRm9yIG9wdGlvbnMgdGhhdCBzaG91bGRuJ3QgYmUgZGVlcCBleHRlbmRlZDoKCQkvLyB5b3UgY2FuIGFkZCB5b3VyIG93biBjdXN0b20gb3B0aW9ucyBoZXJlIGlmCgkJLy8gYW5kIHdoZW4geW91IGNyZWF0ZSBvbmUgdGhhdCBzaG91bGRuJ3QgYmUKCQkvLyBkZWVwIGV4dGVuZGVkIChzZWUgYWpheEV4dGVuZCkKCQlmbGF0T3B0aW9uczogewoJCQljb250ZXh0OiB0cnVlLAoJCQl1cmw6IHRydWUKCQl9Cgl9LAoKCWFqYXhQcmVmaWx0ZXI6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycyApLAoJYWpheFRyYW5zcG9ydDogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzICksCgoJLy8gTWFpbiBtZXRob2QKCWFqYXg6IGZ1bmN0aW9uKCB1cmwsIG9wdGlvbnMgKSB7CgoJCS8vIElmIHVybCBpcyBhbiBvYmplY3QsIHNpbXVsYXRlIHByZS0xLjUgc2lnbmF0dXJlCgkJaWYgKCB0eXBlb2YgdXJsID09PSAib2JqZWN0IiApIHsKCQkJb3B0aW9ucyA9IHVybDsKCQkJdXJsID0gdW5kZWZpbmVkOwoJCX0KCgkJLy8gRm9yY2Ugb3B0aW9ucyB0byBiZSBhbiBvYmplY3QKCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCgkJdmFyIC8vIENyZWF0ZSB0aGUgZmluYWwgb3B0aW9ucyBvYmplY3QKCQkJcyA9IGpRdWVyeS5hamF4U2V0dXAoIHt9LCBvcHRpb25zICksCgkJCS8vIENhbGxiYWNrcyBjb250ZXh0CgkJCWNhbGxiYWNrQ29udGV4dCA9IHMuY29udGV4dCB8fCBzLAoJCQkvLyBDb250ZXh0IGZvciBnbG9iYWwgZXZlbnRzCgkJCS8vIEl0J3MgdGhlIGNhbGxiYWNrQ29udGV4dCBpZiBvbmUgd2FzIHByb3ZpZGVkIGluIHRoZSBvcHRpb25zCgkJCS8vIGFuZCBpZiBpdCdzIGEgRE9NIG5vZGUgb3IgYSBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBjYWxsYmFja0NvbnRleHQgIT09IHMgJiYKCQkJCSggY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeSApID8KCQkJCQkJalF1ZXJ5KCBjYWxsYmFja0NvbnRleHQgKSA6IGpRdWVyeS5ldmVudCwKCQkJLy8gRGVmZXJyZWRzCgkJCWRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCAib25jZSBtZW1vcnkiICksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIGlmTW9kaWZpZWQga2V5CgkJCWlmTW9kaWZpZWRLZXksCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycwoJCQlyZXNwb25zZUhlYWRlcnNTdHJpbmcsCgkJCXJlc3BvbnNlSGVhZGVycywKCQkJLy8gdHJhbnNwb3J0CgkJCXRyYW5zcG9ydCwKCQkJLy8gdGltZW91dCBoYW5kbGUKCQkJdGltZW91dFRpbWVyLAoJCQkvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIFRoZSBqcVhIUiBzdGF0ZQoJCQlzdGF0ZSA9IDAsCgkJCS8vIFRvIGtub3cgaWYgZ2xvYmFsIGV2ZW50cyBhcmUgdG8gYmUgZGlzcGF0Y2hlZAoJCQlmaXJlR2xvYmFscywKCQkJLy8gTG9vcCB2YXJpYWJsZQoJCQlpLAoJCQkvLyBGYWtlIHhocgoJCQlqcVhIUiA9IHsKCgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIENhY2hlcyB0aGUgaGVhZGVyCgkJCQlzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXZhciBsbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQkJbmFtZSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdIHx8IG5hbWU7CgkJCQkJCXJlcXVlc3RIZWFkZXJzWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQnVpbGRzIGhlYWRlcnMgaGFzaHRhYmxlIGlmIG5lZWRlZAoJCQkJZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKCBrZXkgKSB7CgkJCQkJdmFyIG1hdGNoOwoJCQkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQkJCWlmICggIXJlc3BvbnNlSGVhZGVycyApIHsKCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHt9OwoJCQkJCQkJd2hpbGUoICggbWF0Y2ggPSByaGVhZGVycy5leGVjKCByZXNwb25zZUhlYWRlcnNTdHJpbmcgKSApICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09PSB1bmRlZmluZWQgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIE92ZXJyaWRlcyByZXNwb25zZSBjb250ZW50LXR5cGUgaGVhZGVyCgkJCQlvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbiggdHlwZSApIHsKCQkJCQlpZiAoICFzdGF0ZSApIHsKCQkJCQkJcy5taW1lVHlwZSA9IHR5cGU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBDYW5jZWwgdGhlIHJlcXVlc3QKCQkJCWFib3J0OiBmdW5jdGlvbiggc3RhdHVzVGV4dCApIHsKCQkJCQlzdGF0dXNUZXh0ID0gc3RhdHVzVGV4dCB8fCAiYWJvcnQiOwoJCQkJCWlmICggdHJhbnNwb3J0ICkgewoJCQkJCQl0cmFuc3BvcnQuYWJvcnQoIHN0YXR1c1RleHQgKTsKCQkJCQl9CgkJCQkJZG9uZSggMCwgc3RhdHVzVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQkvLyBJdCBpcyBkZWZpbmVkIGhlcmUgYmVjYXVzZSBqc2xpbnQgY29tcGxhaW5zIGlmIGl0IGlzIGRlY2xhcmVkCgkJLy8gYXQgdGhlIGVuZCBvZiB0aGUgZnVuY3Rpb24gKHdoaWNoIHdvdWxkIGJlIG1vcmUgbG9naWNhbCBhbmQgcmVhZGFibGUpCgkJZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7CgoJCQkvLyBDYWxsZWQgb25jZQoJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBTdGF0ZSBpcyAiZG9uZSIgbm93CgkJCXN0YXRlID0gMjsKCgkJCS8vIENsZWFyIHRpbWVvdXQgaWYgaXQgZXhpc3RzCgkJCWlmICggdGltZW91dFRpbWVyICkgewoJCQkJY2xlYXJUaW1lb3V0KCB0aW1lb3V0VGltZXIgKTsKCQkJfQoKCQkJLy8gRGVyZWZlcmVuY2UgdHJhbnNwb3J0IGZvciBlYXJseSBnYXJiYWdlIGNvbGxlY3Rpb24KCQkJLy8gKG5vIG1hdHRlciBob3cgbG9uZyB0aGUganFYSFIgb2JqZWN0IHdpbGwgYmUgdXNlZCkKCQkJdHJhbnNwb3J0ID0gdW5kZWZpbmVkOwoKCQkJLy8gQ2FjaGUgcmVzcG9uc2UgaGVhZGVycwoJCQlyZXNwb25zZUhlYWRlcnNTdHJpbmcgPSBoZWFkZXJzIHx8ICIiOwoKCQkJLy8gU2V0IHJlYWR5U3RhdGUKCQkJanFYSFIucmVhZHlTdGF0ZSA9IHN0YXR1cyA+IDAgPyA0IDogMDsKCgkJCXZhciBpc1N1Y2Nlc3MsCgkJCQlzdWNjZXNzLAoJCQkJZXJyb3IsCgkJCQlzdGF0dXNUZXh0ID0gbmF0aXZlU3RhdHVzVGV4dCwKCQkJCXJlc3BvbnNlID0gcmVzcG9uc2VzID8gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApIDogdW5kZWZpbmVkLAoJCQkJbGFzdE1vZGlmaWVkLAoJCQkJZXRhZzsKCgkJCS8vIElmIHN1Y2Nlc3NmdWwsIGhhbmRsZSB0eXBlIGNoYWluaW5nCgkJCWlmICggc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQgKSB7CgoJCQkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQkJCWlmICggcy5pZk1vZGlmaWVkICkgewoKCQkJCQlpZiAoICggbGFzdE1vZGlmaWVkID0ganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoICJMYXN0LU1vZGlmaWVkIiApICkgKSB7CgkJCQkJCWpRdWVyeS5sYXN0TW9kaWZpZWRbIGlmTW9kaWZpZWRLZXkgXSA9IGxhc3RNb2RpZmllZDsKCQkJCQl9CgkJCQkJaWYgKCAoIGV0YWcgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggIkV0YWciICkgKSApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGlmTW9kaWZpZWRLZXkgXSA9IGV0YWc7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIElmIG5vdCBtb2RpZmllZAoJCQkJaWYgKCBzdGF0dXMgPT09IDMwNCApIHsKCgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgkJCQkJaXNTdWNjZXNzID0gdHJ1ZTsKCgkJCQkvLyBJZiB3ZSBoYXZlIGRhdGEKCQkJCX0gZWxzZSB7CgoJCQkJCXRyeSB7CgkJCQkJCXN1Y2Nlc3MgPSBhamF4Q29udmVydCggcywgcmVzcG9uc2UgKTsKCQkJCQkJc3RhdHVzVGV4dCA9ICJzdWNjZXNzIjsKCQkJCQkJaXNTdWNjZXNzID0gdHJ1ZTsKCQkJCQl9IGNhdGNoKGUpIHsKCQkJCQkJLy8gV2UgaGF2ZSBhIHBhcnNlcmVycm9yCgkJCQkJCXN0YXR1c1RleHQgPSAicGFyc2VyZXJyb3IiOwoJCQkJCQllcnJvciA9IGU7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJLy8gV2UgZXh0cmFjdCBlcnJvciBmcm9tIHN0YXR1c1RleHQKCQkJCS8vIHRoZW4gbm9ybWFsaXplIHN0YXR1c1RleHQgYW5kIHN0YXR1cyBmb3Igbm9uLWFib3J0cwoJCQkJZXJyb3IgPSBzdGF0dXNUZXh0OwoJCQkJaWYgKCAhc3RhdHVzVGV4dCB8fCBzdGF0dXMgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJlcnJvciI7CgkJCQkJaWYgKCBzdGF0dXMgPCAwICkgewoJCQkJCQlzdGF0dXMgPSAwOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gU2V0IGRhdGEgZm9yIHRoZSBmYWtlIHhociBvYmplY3QKCQkJanFYSFIuc3RhdHVzID0gc3RhdHVzOwoJCQlqcVhIUi5zdGF0dXNUZXh0ID0gIiIgKyAoIG5hdGl2ZVN0YXR1c1RleHQgfHwgc3RhdHVzVGV4dCApOwoKCQkJLy8gU3VjY2Vzcy9FcnJvcgoJCQlpZiAoIGlzU3VjY2VzcyApIHsKCQkJCWRlZmVycmVkLnJlc29sdmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsgc3VjY2Vzcywgc3RhdHVzVGV4dCwganFYSFIgXSApOwoJCQl9IGVsc2UgewoJCQkJZGVmZXJyZWQucmVqZWN0V2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIGpxWEhSLCBzdGF0dXNUZXh0LCBlcnJvciBdICk7CgkJCX0KCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCWpxWEhSLnN0YXR1c0NvZGUoIHN0YXR1c0NvZGUgKTsKCQkJc3RhdHVzQ29kZSA9IHVuZGVmaW5lZDsKCgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXgiICsgKCBpc1N1Y2Nlc3MgPyAiU3VjY2VzcyIgOiAiRXJyb3IiICksCgkJCQkJCVsganFYSFIsIHMsIGlzU3VjY2VzcyA/IHN1Y2Nlc3MgOiBlcnJvciBdICk7CgkJCX0KCgkJCS8vIENvbXBsZXRlCgkJCWNvbXBsZXRlRGVmZXJyZWQuZmlyZVdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCBdICk7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4Q29tcGxldGUiLCBbIGpxWEhSLCBzIF0gKTsKCQkJCS8vIEhhbmRsZSB0aGUgZ2xvYmFsIEFKQVggY291bnRlcgoJCQkJaWYgKCAhKCAtLWpRdWVyeS5hY3RpdmUgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlciggImFqYXhTdG9wIiApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKTsKCQlqcVhIUi5zdWNjZXNzID0ganFYSFIuZG9uZTsKCQlqcVhIUi5lcnJvciA9IGpxWEhSLmZhaWw7CgkJanFYSFIuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsKCgkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQlqcVhIUi5zdGF0dXNDb2RlID0gZnVuY3Rpb24oIG1hcCApIHsKCQkJaWYgKCBtYXAgKSB7CgkJCQl2YXIgdG1wOwoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZm9yICggdG1wIGluIG1hcCApIHsKCQkJCQkJc3RhdHVzQ29kZVsgdG1wIF0gPSBbIHN0YXR1c0NvZGVbdG1wXSwgbWFwW3RtcF0gXTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCXRtcCA9IG1hcFsganFYSFIuc3RhdHVzIF07CgkJCQkJanFYSFIudGhlbiggdG1wLCB0bXAgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9OwoKCQkvLyBSZW1vdmUgaGFzaCBjaGFyYWN0ZXIgKCM3NTMxOiBhbmQgc3RyaW5nIHByb21vdGlvbikKCQkvLyBBZGQgcHJvdG9jb2wgaWYgbm90IHByb3ZpZGVkICgjNTg2NjogSUU3IGlzc3VlIHdpdGggcHJvdG9jb2wtbGVzcyB1cmxzKQoJCS8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoJCXMudXJsID0gKCAoIHVybCB8fCBzLnVybCApICsgIiIgKS5yZXBsYWNlKCByaGFzaCwgIiIgKS5yZXBsYWNlKCBycHJvdG9jb2wsIGFqYXhMb2NQYXJ0c1sgMSBdICsgIi8vIiApOwoKCQkvLyBFeHRyYWN0IGRhdGFUeXBlcyBsaXN0CgkJcy5kYXRhVHlwZXMgPSBqUXVlcnkudHJpbSggcy5kYXRhVHlwZSB8fCAiKiIgKS50b0xvd2VyQ2FzZSgpLnNwbGl0KCByc3BhY2VzQWpheCApOwoKCQkvLyBEZXRlcm1pbmUgaWYgYSBjcm9zcy1kb21haW4gcmVxdWVzdCBpcyBpbiBvcmRlcgoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT0gYWpheExvY1BhcnRzWyAxIF0gfHwgcGFydHNbIDIgXSAhPSBhamF4TG9jUGFydHNbIDIgXSB8fAoJCQkJCSggcGFydHNbIDMgXSB8fCAoIHBhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgIT0KCQkJCQkJKCBhamF4TG9jUGFydHNbIDMgXSB8fCAoIGFqYXhMb2NQYXJ0c1sgMSBdID09PSAiaHR0cDoiID8gODAgOiA0NDMgKSApICkKCQkJKTsKCQl9CgoJCS8vIENvbnZlcnQgZGF0YSBpZiBub3QgYWxyZWFkeSBhIHN0cmluZwoJCWlmICggcy5kYXRhICYmIHMucHJvY2Vzc0RhdGEgJiYgdHlwZW9mIHMuZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXMuZGF0YSA9IGpRdWVyeS5wYXJhbSggcy5kYXRhLCBzLnRyYWRpdGlvbmFsICk7CgkJfQoKCQkvLyBBcHBseSBwcmVmaWx0ZXJzCgkJaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSICk7CgoJCS8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGEgcHJlZmlsZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCWZpcmVHbG9iYWxzID0gcy5nbG9iYWw7CgoJCS8vIFVwcGVyY2FzZSB0aGUgdHlwZQoJCXMudHlwZSA9IHMudHlwZS50b1VwcGVyQ2FzZSgpOwoKCQkvLyBEZXRlcm1pbmUgaWYgcmVxdWVzdCBoYXMgY29udGVudAoJCXMuaGFzQ29udGVudCA9ICFybm9Db250ZW50LnRlc3QoIHMudHlwZSApOwoKCQkvLyBXYXRjaCBmb3IgYSBuZXcgc2V0IG9mIHJlcXVlc3RzCgkJaWYgKCBmaXJlR2xvYmFscyAmJiBqUXVlcnkuYWN0aXZlKysgPT09IDAgKSB7CgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCAiYWpheFN0YXJ0IiApOwoJCX0KCgkJLy8gTW9yZSBvcHRpb25zIGhhbmRsaW5nIGZvciByZXF1ZXN0cyB3aXRoIG5vIGNvbnRlbnQKCQlpZiAoICFzLmhhc0NvbnRlbnQgKSB7CgoJCQkvLyBJZiBkYXRhIGlzIGF2YWlsYWJsZSwgYXBwZW5kIGRhdGEgdG8gdXJsCgkJCWlmICggcy5kYXRhICkgewoJCQkJcy51cmwgKz0gKCBycXVlcnkudGVzdCggcy51cmwgKSA/ICImIiA6ICI/IiApICsgcy5kYXRhOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gR2V0IGlmTW9kaWZpZWRLZXkgYmVmb3JlIGFkZGluZyB0aGUgYW50aS1jYWNoZSBwYXJhbWV0ZXIKCQkJaWZNb2RpZmllZEtleSA9IHMudXJsOwoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoKCQkJCXZhciB0cyA9IGpRdWVyeS5ub3coKSwKCQkJCQkvLyB0cnkgcmVwbGFjaW5nIF89IGlmIGl0IGlzIHRoZXJlCgkJCQkJcmV0ID0gcy51cmwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyB0cyApOwoKCQkJCS8vIGlmIG5vdGhpbmcgd2FzIHJlcGxhY2VkLCBhZGQgdGltZXN0YW1wIHRvIHRoZSBlbmQKCQkJCXMudXJsID0gcmV0ICsgKCAoIHJldCA9PT0gcy51cmwgKSA/ICggcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArICJfPSIgKyB0cyA6ICIiICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWZNb2RpZmllZEtleSA9IGlmTW9kaWZpZWRLZXkgfHwgcy51cmw7CgkJCWlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgaWZNb2RpZmllZEtleSBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgaWZNb2RpZmllZEtleSBdICk7CgkJCX0KCQkJaWYgKCBqUXVlcnkuZXRhZ1sgaWZNb2RpZmllZEtleSBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU5vbmUtTWF0Y2giLCBqUXVlcnkuZXRhZ1sgaWZNb2RpZmllZEtleSBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgQWNjZXB0cyBoZWFkZXIgZm9yIHRoZSBzZXJ2ZXIsIGRlcGVuZGluZyBvbiB0aGUgZGF0YVR5cGUKCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkiQWNjZXB0IiwKCQkJcy5kYXRhVHlwZXNbIDAgXSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gPwoJCQkJcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1swXSBdICsgKCBzLmRhdGFUeXBlc1sgMCBdICE9PSAiKiIgPyAiLCAiICsgYWxsVHlwZXMgKyAiOyBxPTAuMDEiIDogIiIgKSA6CgkJCQlzLmFjY2VwdHNbICIqIiBdCgkJKTsKCgkJLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uCgkJZm9yICggaSBpbiBzLmhlYWRlcnMgKSB7CgkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIGksIHMuaGVhZGVyc1sgaSBdICk7CgkJfQoKCQkvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0CgkJaWYgKCBzLmJlZm9yZVNlbmQgJiYgKCBzLmJlZm9yZVNlbmQuY2FsbCggY2FsbGJhY2tDb250ZXh0LCBqcVhIUiwgcyApID09PSBmYWxzZSB8fCBzdGF0ZSA9PT0gMiApICkgewoJCQkJLy8gQWJvcnQgaWYgbm90IGRvbmUgYWxyZWFkeQoJCQkJanFYSFIuYWJvcnQoKTsKCQkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrcyBvbiBkZWZlcnJlZHMKCQlmb3IgKCBpIGluIHsgc3VjY2VzczogMSwgZXJyb3I6IDEsIGNvbXBsZXRlOiAxIH0gKSB7CgkJCWpxWEhSWyBpIF0oIHNbIGkgXSApOwoJCX0KCgkJLy8gR2V0IHRyYW5zcG9ydAoJCXRyYW5zcG9ydCA9IGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzLCBzLCBvcHRpb25zLCBqcVhIUiApOwoKCQkvLyBJZiBubyB0cmFuc3BvcnQsIHdlIGF1dG8tYWJvcnQKCQlpZiAoICF0cmFuc3BvcnQgKSB7CgkJCWRvbmUoIC0xLCAiTm8gVHJhbnNwb3J0IiApOwoJCX0gZWxzZSB7CgkJCWpxWEhSLnJlYWR5U3RhdGUgPSAxOwoJCQkvLyBTZW5kIGdsb2JhbCBldmVudAoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4U2VuZCIsIFsganFYSFIsIHMgXSApOwoJCQl9CgkJCS8vIFRpbWVvdXQKCQkJaWYgKCBzLmFzeW5jICYmIHMudGltZW91dCA+IDAgKSB7CgkJCQl0aW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpewoJCQkJCWpxWEhSLmFib3J0KCAidGltZW91dCIgKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCS8vIFByb3BhZ2F0ZSBleGNlcHRpb24gYXMgZXJyb3IgaWYgbm90IGRvbmUKCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCWRvbmUoIC0xLCBlICk7CgkJCQkvLyBTaW1wbHkgcmV0aHJvdyBvdGhlcndpc2UKCQkJCX0gZWxzZSB7CgkJCQkJdGhyb3cgZTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIGpxWEhSOwoJfSwKCgkvLyBTZXJpYWxpemUgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cyBvciBhIHNldCBvZgoJLy8ga2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCglwYXJhbTogZnVuY3Rpb24oIGEsIHRyYWRpdGlvbmFsICkgewoJCXZhciBzID0gW10sCgkJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkJLy8gSWYgdmFsdWUgaXMgYSBmdW5jdGlvbiwgaW52b2tlIGl0IGFuZCByZXR1cm4gaXRzIHZhbHVlCgkJCQl2YWx1ZSA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApID8gdmFsdWUoKSA6IHZhbHVlOwoJCQkJc1sgcy5sZW5ndGggXSA9IGVuY29kZVVSSUNvbXBvbmVudCgga2V5ICkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7CgkJCX07CgoJCS8vIFNldCB0cmFkaXRpb25hbCB0byB0cnVlIGZvciBqUXVlcnkgPD0gMS4zLjIgYmVoYXZpb3IuCgkJaWYgKCB0cmFkaXRpb25hbCA9PT0gdW5kZWZpbmVkICkgewoJCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWw7CgkJfQoKCQkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIGEgKSB8fCAoIGEuanF1ZXJ5ICYmICFqUXVlcnkuaXNQbGFpbk9iamVjdCggYSApICkgKSB7CgkJCS8vIFNlcmlhbGl6ZSB0aGUgZm9ybSBlbGVtZW50cwoJCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCQlhZGQoIHRoaXMubmFtZSwgdGhpcy52YWx1ZSApOwoJCQl9KTsKCgkJfSBlbHNlIHsKCQkJLy8gSWYgdHJhZGl0aW9uYWwsIGVuY29kZSB0aGUgIm9sZCIgd2F5ICh0aGUgd2F5IDEuMy4yIG9yIG9sZGVyCgkJCS8vIGRpZCBpdCksIG90aGVyd2lzZSBlbmNvZGUgcGFyYW1zIHJlY3Vyc2l2ZWx5LgoJCQlmb3IgKCB2YXIgcHJlZml4IGluIGEgKSB7CgkJCQlidWlsZFBhcmFtcyggcHJlZml4LCBhWyBwcmVmaXggXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCQl9CgkJfQoKCQkvLyBSZXR1cm4gdGhlIHJlc3VsdGluZyBzZXJpYWxpemF0aW9uCgkJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKCX0KfSk7CgpmdW5jdGlvbiBidWlsZFBhcmFtcyggcHJlZml4LCBvYmosIHRyYWRpdGlvbmFsLCBhZGQgKSB7CglpZiAoIGpRdWVyeS5pc0FycmF5KCBvYmogKSApIHsKCQkvLyBTZXJpYWxpemUgYXJyYXkgaXRlbS4KCQlqUXVlcnkuZWFjaCggb2JqLCBmdW5jdGlvbiggaSwgdiApIHsKCQkJaWYgKCB0cmFkaXRpb25hbCB8fCByYnJhY2tldC50ZXN0KCBwcmVmaXggKSApIHsKCQkJCS8vIFRyZWF0IGVhY2ggYXJyYXkgaXRlbSBhcyBhIHNjYWxhci4KCQkJCWFkZCggcHJlZml4LCB2ICk7CgoJCQl9IGVsc2UgewoJCQkJLy8gSWYgYXJyYXkgaXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzCgkJCQkvLyBudW1lcmljIGluZGV4IHRvIHJlc29sdmUgZGVzZXJpYWxpemF0aW9uIGFtYmlndWl0eSBpc3N1ZXMuCgkJCQkvLyBOb3RlIHRoYXQgcmFjayAoYXMgb2YgMS4wLjApIGNhbid0IGN1cnJlbnRseSBkZXNlcmlhbGl6ZQoJCQkJLy8gbmVzdGVkIGFycmF5cyBwcm9wZXJseSwgYW5kIGF0dGVtcHRpbmcgdG8gZG8gc28gbWF5IGNhdXNlCgkJCQkvLyBhIHNlcnZlciBlcnJvci4gUG9zc2libGUgZml4ZXMgYXJlIHRvIG1vZGlmeSByYWNrJ3MKCQkJCS8vIGRlc2VyaWFsaXphdGlvbiBhbGdvcml0aG0gb3IgdG8gcHJvdmlkZSBhbiBvcHRpb24gb3IgZmxhZwoJCQkJLy8gdG8gZm9yY2UgYXJyYXkgc2VyaWFsaXphdGlvbiB0byBiZSBzaGFsbG93LgoJCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArICggdHlwZW9mIHYgPT09ICJvYmplY3QiIHx8IGpRdWVyeS5pc0FycmF5KHYpID8gaSA6ICIiICkgKyAiXSIsIHYsIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQkJfQoJCX0pOwoKCX0gZWxzZSBpZiAoICF0cmFkaXRpb25hbCAmJiBvYmogIT0gbnVsbCAmJiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IiApIHsKCQkvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCgkJZm9yICggdmFyIG5hbWUgaW4gb2JqICkgewoJCQlidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgbmFtZSArICJdIiwgb2JqWyBuYW1lIF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9CgoJfSBlbHNlIHsKCQkvLyBTZXJpYWxpemUgc2NhbGFyIGl0ZW0uCgkJYWRkKCBwcmVmaXgsIG9iaiApOwoJfQp9CgovLyBUaGlzIGlzIHN0aWxsIG9uIHRoZSBqUXVlcnkgb2JqZWN0Li4uIGZvciBub3cKLy8gV2FudCB0byBtb3ZlIHRoaXMgdG8galF1ZXJ5LmFqYXggc29tZSBkYXkKalF1ZXJ5LmV4dGVuZCh7CgoJLy8gQ291bnRlciBmb3IgaG9sZGluZyB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBxdWVyaWVzCglhY3RpdmU6IDAsCgoJLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdAoJbGFzdE1vZGlmaWVkOiB7fSwKCWV0YWc6IHt9Cgp9KTsKCi8qIEhhbmRsZXMgcmVzcG9uc2VzIHRvIGFuIGFqYXggcmVxdWVzdDoKICogLSBzZXRzIGFsbCByZXNwb25zZVhYWCBmaWVsZHMgYWNjb3JkaW5nbHkKICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkKICogLSByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCiAqLwpmdW5jdGlvbiBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICkgewoKCXZhciBjb250ZW50cyA9IHMuY29udGVudHMsCgkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMsCgkJcmVzcG9uc2VGaWVsZHMgPSBzLnJlc3BvbnNlRmllbGRzLAoJCWN0LAoJCXR5cGUsCgkJZmluYWxEYXRhVHlwZSwKCQlmaXJzdERhdGFUeXBlOwoKCS8vIEZpbGwgcmVzcG9uc2VYWFggZmllbGRzCglmb3IgKCB0eXBlIGluIHJlc3BvbnNlRmllbGRzICkgewoJCWlmICggdHlwZSBpbiByZXNwb25zZXMgKSB7CgkJCWpxWEhSWyByZXNwb25zZUZpZWxkc1t0eXBlXSBdID0gcmVzcG9uc2VzWyB0eXBlIF07CgkJfQoJfQoKCS8vIFJlbW92ZSBhdXRvIGRhdGFUeXBlIGFuZCBnZXQgY29udGVudC10eXBlIGluIHRoZSBwcm9jZXNzCgl3aGlsZSggZGF0YVR5cGVzWyAwIF0gPT09ICIqIiApIHsKCQlkYXRhVHlwZXMuc2hpZnQoKTsKCQlpZiAoIGN0ID09PSB1bmRlZmluZWQgKSB7CgkJCWN0ID0gcy5taW1lVHlwZSB8fCBqcVhIUi5nZXRSZXNwb25zZUhlYWRlciggImNvbnRlbnQtdHlwZSIgKTsKCQl9Cgl9CgoJLy8gQ2hlY2sgaWYgd2UncmUgZGVhbGluZyB3aXRoIGEga25vd24gY29udGVudC10eXBlCglpZiAoIGN0ICkgewoJCWZvciAoIHR5cGUgaW4gY29udGVudHMgKSB7CgkJCWlmICggY29udGVudHNbIHR5cGUgXSAmJiBjb250ZW50c1sgdHlwZSBdLnRlc3QoIGN0ICkgKSB7CgkJCQlkYXRhVHlwZXMudW5zaGlmdCggdHlwZSApOwoJCQkJYnJlYWs7CgkJCX0KCQl9Cgl9CgoJLy8gQ2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgYSByZXNwb25zZSBmb3IgdGhlIGV4cGVjdGVkIGRhdGFUeXBlCglpZiAoIGRhdGFUeXBlc1sgMCBdIGluIHJlc3BvbnNlcyApIHsKCQlmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWyAwIF07Cgl9IGVsc2UgewoJCS8vIFRyeSBjb252ZXJ0aWJsZSBkYXRhVHlwZXMKCQlmb3IgKCB0eXBlIGluIHJlc3BvbnNlcyApIHsKCQkJaWYgKCAhZGF0YVR5cGVzWyAwIF0gfHwgcy5jb252ZXJ0ZXJzWyB0eXBlICsgIiAiICsgZGF0YVR5cGVzWzBdIF0gKSB7CgkJCQlmaW5hbERhdGFUeXBlID0gdHlwZTsKCQkJCWJyZWFrOwoJCQl9CgkJCWlmICggIWZpcnN0RGF0YVR5cGUgKSB7CgkJCQlmaXJzdERhdGFUeXBlID0gdHlwZTsKCQkJfQoJCX0KCQkvLyBPciBqdXN0IHVzZSBmaXJzdCBvbmUKCQlmaW5hbERhdGFUeXBlID0gZmluYWxEYXRhVHlwZSB8fCBmaXJzdERhdGFUeXBlOwoJfQoKCS8vIElmIHdlIGZvdW5kIGEgZGF0YVR5cGUKCS8vIFdlIGFkZCB0aGUgZGF0YVR5cGUgdG8gdGhlIGxpc3QgaWYgbmVlZGVkCgkvLyBhbmQgcmV0dXJuIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCglpZiAoIGZpbmFsRGF0YVR5cGUgKSB7CgkJaWYgKCBmaW5hbERhdGFUeXBlICE9PSBkYXRhVHlwZXNbIDAgXSApIHsKCQkJZGF0YVR5cGVzLnVuc2hpZnQoIGZpbmFsRGF0YVR5cGUgKTsKCQl9CgkJcmV0dXJuIHJlc3BvbnNlc1sgZmluYWxEYXRhVHlwZSBdOwoJfQp9CgovLyBDaGFpbiBjb252ZXJzaW9ucyBnaXZlbiB0aGUgcmVxdWVzdCBhbmQgdGhlIG9yaWdpbmFsIHJlc3BvbnNlCmZ1bmN0aW9uIGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApIHsKCgkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJaWYgKCBzLmRhdGFGaWx0ZXIgKSB7CgkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7Cgl9CgoJdmFyIGRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLAoJCWNvbnZlcnRlcnMgPSB7fSwKCQlpLAoJCWtleSwKCQlsZW5ndGggPSBkYXRhVHlwZXMubGVuZ3RoLAoJCXRtcCwKCQkvLyBDdXJyZW50IGFuZCBwcmV2aW91cyBkYXRhVHlwZXMKCQljdXJyZW50ID0gZGF0YVR5cGVzWyAwIF0sCgkJcHJldiwKCQkvLyBDb252ZXJzaW9uIGV4cHJlc3Npb24KCQljb252ZXJzaW9uLAoJCS8vIENvbnZlcnNpb24gZnVuY3Rpb24KCQljb252LAoJCS8vIENvbnZlcnNpb24gZnVuY3Rpb25zICh0cmFuc2l0aXZlIGNvbnZlcnNpb24pCgkJY29udjEsCgkJY29udjI7CgoJLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGNoYWluCglmb3IgKCBpID0gMTsgaSA8IGxlbmd0aDsgaSsrICkgewoKCQkvLyBDcmVhdGUgY29udmVydGVycyBtYXAKCQkvLyB3aXRoIGxvd2VyY2FzZWQga2V5cwoJCWlmICggaSA9PT0gMSApIHsKCQkJZm9yICgga2V5IGluIHMuY29udmVydGVycyApIHsKCQkJCWlmICggdHlwZW9mIGtleSA9PT0gInN0cmluZyIgKSB7CgkJCQkJY29udmVydGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sga2V5IF07CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEdldCB0aGUgZGF0YVR5cGVzCgkJcHJldiA9IGN1cnJlbnQ7CgkJY3VycmVudCA9IGRhdGFUeXBlc1sgaSBdOwoKCQkvLyBJZiBjdXJyZW50IGlzIGF1dG8gZGF0YVR5cGUsIHVwZGF0ZSBpdCB0byBwcmV2CgkJaWYgKCBjdXJyZW50ID09PSAiKiIgKSB7CgkJCWN1cnJlbnQgPSBwcmV2OwoJCS8vIElmIG5vIGF1dG8gYW5kIGRhdGFUeXBlcyBhcmUgYWN0dWFsbHkgZGlmZmVyZW50CgkJfSBlbHNlIGlmICggcHJldiAhPT0gIioiICYmIHByZXYgIT09IGN1cnJlbnQgKSB7CgoJCQkvLyBHZXQgdGhlIGNvbnZlcnRlcgoJCQljb252ZXJzaW9uID0gcHJldiArICIgIiArIGN1cnJlbnQ7CgkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBjb252ZXJzaW9uIF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCS8vIElmIHRoZXJlIGlzIG5vIGRpcmVjdCBjb252ZXJ0ZXIsIHNlYXJjaCB0cmFuc2l0aXZlbHkKCQkJaWYgKCAhY29udiApIHsKCQkJCWNvbnYyID0gdW5kZWZpbmVkOwoJCQkJZm9yICggY29udjEgaW4gY29udmVydGVycyApIHsKCQkJCQl0bXAgPSBjb252MS5zcGxpdCggIiAiICk7CgkJCQkJaWYgKCB0bXBbIDAgXSA9PT0gcHJldiB8fCB0bXBbIDAgXSA9PT0gIioiICkgewoJCQkJCQljb252MiA9IGNvbnZlcnRlcnNbIHRtcFsxXSArICIgIiArIGN1cnJlbnQgXTsKCQkJCQkJaWYgKCBjb252MiApIHsKCQkJCQkJCWNvbnYxID0gY29udmVydGVyc1sgY29udjEgXTsKCQkJCQkJCWlmICggY29udjEgPT09IHRydWUgKSB7CgkJCQkJCQkJY29udiA9IGNvbnYyOwoJCQkJCQkJfSBlbHNlIGlmICggY29udjIgPT09IHRydWUgKSB7CgkJCQkJCQkJY29udiA9IGNvbnYxOwoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJLy8gSWYgd2UgZm91bmQgbm8gY29udmVydGVyLCBkaXNwYXRjaCBhbiBlcnJvcgoJCQlpZiAoICEoIGNvbnYgfHwgY29udjIgKSApIHsKCQkJCWpRdWVyeS5lcnJvciggIk5vIGNvbnZlcnNpb24gZnJvbSAiICsgY29udmVyc2lvbi5yZXBsYWNlKCIgIiwiIHRvICIpICk7CgkJCX0KCQkJLy8gSWYgZm91bmQgY29udmVydGVyIGlzIG5vdCBhbiBlcXVpdmFsZW5jZQoJCQlpZiAoIGNvbnYgIT09IHRydWUgKSB7CgkJCQkvLyBDb252ZXJ0IHdpdGggMSBvciAyIGNvbnZlcnRlcnMgYWNjb3JkaW5nbHkKCQkJCXJlc3BvbnNlID0gY29udiA/IGNvbnYoIHJlc3BvbnNlICkgOiBjb252MiggY29udjEocmVzcG9uc2UpICk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVzcG9uc2U7Cn0KCgoKCnZhciBqc2MgPSBqUXVlcnkubm93KCksCglqc3JlID0gLyhcPSlcPygmfCQpfFw/XD8vaTsKCi8vIERlZmF1bHQganNvbnAgc2V0dGluZ3MKalF1ZXJ5LmFqYXhTZXR1cCh7Cglqc29ucDogImNhbGxiYWNrIiwKCWpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkuZXhwYW5kbyArICJfIiArICgganNjKysgKTsKCX0KfSk7CgovLyBEZXRlY3QsIG5vcm1hbGl6ZSBvcHRpb25zIGFuZCBpbnN0YWxsIGNhbGxiYWNrcyBmb3IganNvbnAgcmVxdWVzdHMKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJqc29uIGpzb25wIiwgZnVuY3Rpb24oIHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSICkgewoKCXZhciBpbnNwZWN0RGF0YSA9IHMuY29udGVudFR5cGUgPT09ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiICYmCgkJKCB0eXBlb2Ygcy5kYXRhID09PSAic3RyaW5nIiApOwoKCWlmICggcy5kYXRhVHlwZXNbIDAgXSA9PT0gImpzb25wIiB8fAoJCXMuanNvbnAgIT09IGZhbHNlICYmICgganNyZS50ZXN0KCBzLnVybCApIHx8CgkJCQlpbnNwZWN0RGF0YSAmJiBqc3JlLnRlc3QoIHMuZGF0YSApICkgKSB7CgoJCXZhciByZXNwb25zZUNvbnRhaW5lciwKCQkJanNvbnBDYWxsYmFjayA9IHMuanNvbnBDYWxsYmFjayA9CgkJCQlqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPyBzLmpzb25wQ2FsbGJhY2soKSA6IHMuanNvbnBDYWxsYmFjaywKCQkJcHJldmlvdXMgPSB3aW5kb3dbIGpzb25wQ2FsbGJhY2sgXSwKCQkJdXJsID0gcy51cmwsCgkJCWRhdGEgPSBzLmRhdGEsCgkJCXJlcGxhY2UgPSAiJDEiICsganNvbnBDYWxsYmFjayArICIkMiI7CgoJCWlmICggcy5qc29ucCAhPT0gZmFsc2UgKSB7CgkJCXVybCA9IHVybC5yZXBsYWNlKCBqc3JlLCByZXBsYWNlICk7CgkJCWlmICggcy51cmwgPT09IHVybCApIHsKCQkJCWlmICggaW5zcGVjdERhdGEgKSB7CgkJCQkJZGF0YSA9IGRhdGEucmVwbGFjZSgganNyZSwgcmVwbGFjZSApOwoJCQkJfQoJCQkJaWYgKCBzLmRhdGEgPT09IGRhdGEgKSB7CgkJCQkJLy8gQWRkIGNhbGxiYWNrIG1hbnVhbGx5CgkJCQkJdXJsICs9ICgvXD8vLnRlc3QoIHVybCApID8gIiYiIDogIj8iKSArIHMuanNvbnAgKyAiPSIgKyBqc29ucENhbGxiYWNrOwoJCQkJfQoJCQl9CgkJfQoKCQlzLnVybCA9IHVybDsKCQlzLmRhdGEgPSBkYXRhOwoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrCgkJd2luZG93WyBqc29ucENhbGxiYWNrIF0gPSBmdW5jdGlvbiggcmVzcG9uc2UgKSB7CgkJCXJlc3BvbnNlQ29udGFpbmVyID0gWyByZXNwb25zZSBdOwoJCX07CgoJCS8vIENsZWFuLXVwIGZ1bmN0aW9uCgkJanFYSFIuYWx3YXlzKGZ1bmN0aW9uKCkgewoJCQkvLyBTZXQgY2FsbGJhY2sgYmFjayB0byBwcmV2aW91cyB2YWx1ZQoJCQl3aW5kb3dbIGpzb25wQ2FsbGJhY2sgXSA9IHByZXZpb3VzOwoJCQkvLyBDYWxsIGlmIGl0IHdhcyBhIGZ1bmN0aW9uIGFuZCB3ZSBoYXZlIGEgcmVzcG9uc2UKCQkJaWYgKCByZXNwb25zZUNvbnRhaW5lciAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcHJldmlvdXMgKSApIHsKCQkJCXdpbmRvd1sganNvbnBDYWxsYmFjayBdKCByZXNwb25zZUNvbnRhaW5lclsgMCBdICk7CgkJCX0KCQl9KTsKCgkJLy8gVXNlIGRhdGEgY29udmVydGVyIHRvIHJldHJpZXZlIGpzb24gYWZ0ZXIgc2NyaXB0IGV4ZWN1dGlvbgoJCXMuY29udmVydGVyc1sic2NyaXB0IGpzb24iXSA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoICFyZXNwb25zZUNvbnRhaW5lciApIHsKCQkJCWpRdWVyeS5lcnJvcigganNvbnBDYWxsYmFjayArICIgd2FzIG5vdCBjYWxsZWQiICk7CgkJCX0KCQkJcmV0dXJuIHJlc3BvbnNlQ29udGFpbmVyWyAwIF07CgkJfTsKCgkJLy8gZm9yY2UganNvbiBkYXRhVHlwZQoJCXMuZGF0YVR5cGVzWyAwIF0gPSAianNvbiI7CgoJCS8vIERlbGVnYXRlIHRvIHNjcmlwdAoJCXJldHVybiAic2NyaXB0IjsKCX0KfSk7CgoKCgovLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQpqUXVlcnkuYWpheFNldHVwKHsKCWFjY2VwdHM6IHsKCQlzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKCX0sCgljb250ZW50czogewoJCXNjcmlwdDogL2phdmFzY3JpcHR8ZWNtYXNjcmlwdC8KCX0sCgljb252ZXJ0ZXJzOiB7CgkJInRleHQgc2NyaXB0IjogZnVuY3Rpb24oIHRleHQgKSB7CgkJCWpRdWVyeS5nbG9iYWxFdmFsKCB0ZXh0ICk7CgkJCXJldHVybiB0ZXh0OwoJCX0KCX0KfSk7CgovLyBIYW5kbGUgY2FjaGUncyBzcGVjaWFsIGNhc2UgYW5kIGdsb2JhbApqUXVlcnkuYWpheFByZWZpbHRlciggInNjcmlwdCIsIGZ1bmN0aW9uKCBzICkgewoJaWYgKCBzLmNhY2hlID09PSB1bmRlZmluZWQgKSB7CgkJcy5jYWNoZSA9IGZhbHNlOwoJfQoJaWYgKCBzLmNyb3NzRG9tYWluICkgewoJCXMudHlwZSA9ICJHRVQiOwoJCXMuZ2xvYmFsID0gZmFsc2U7Cgl9Cn0pOwoKLy8gQmluZCBzY3JpcHQgdGFnIGhhY2sgdHJhbnNwb3J0CmpRdWVyeS5hamF4VHJhbnNwb3J0KCAic2NyaXB0IiwgZnVuY3Rpb24ocykgewoKCS8vIFRoaXMgdHJhbnNwb3J0IG9ubHkgZGVhbHMgd2l0aCBjcm9zcyBkb21haW4gcmVxdWVzdHMKCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCgkJdmFyIHNjcmlwdCwKCQkJaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJoZWFkIiApWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJcmV0dXJuIHsKCgkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAic2NyaXB0IiApOwoKCQkJCXNjcmlwdC5hc3luYyA9ICJhc3luYyI7CgoJCQkJaWYgKCBzLnNjcmlwdENoYXJzZXQgKSB7CgkJCQkJc2NyaXB0LmNoYXJzZXQgPSBzLnNjcmlwdENoYXJzZXQ7CgkJCQl9CgoJCQkJc2NyaXB0LnNyYyA9IHMudXJsOwoKCQkJCS8vIEF0dGFjaCBoYW5kbGVycyBmb3IgYWxsIGJyb3dzZXJzCgkJCQlzY3JpcHQub25sb2FkID0gc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCBfLCBpc0Fib3J0ICkgewoKCQkJCQlpZiAoIGlzQWJvcnQgfHwgIXNjcmlwdC5yZWFkeVN0YXRlIHx8IC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoIHNjcmlwdC5yZWFkeVN0YXRlICkgKSB7CgoJCQkJCQkvLyBIYW5kbGUgbWVtb3J5IGxlYWsgaW4gSUUKCQkJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsOwoKCQkJCQkJLy8gUmVtb3ZlIHRoZSBzY3JpcHQKCQkJCQkJaWYgKCBoZWFkICYmIHNjcmlwdC5wYXJlbnROb2RlICkgewoJCQkJCQkJaGVhZC5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gdW5kZWZpbmVkOwoKCQkJCQkJLy8gQ2FsbGJhY2sgaWYgbm90IGFib3J0CgkJCQkJCWlmICggIWlzQWJvcnQgKSB7CgkJCQkJCQljYWxsYmFjayggMjAwLCAic3VjY2VzcyIgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX07CgkJCQkvLyBVc2UgaW5zZXJ0QmVmb3JlIGluc3RlYWQgb2YgYXBwZW5kQ2hpbGQgIHRvIGNpcmN1bXZlbnQgYW4gSUU2IGJ1Zy4KCQkJCS8vIFRoaXMgYXJpc2VzIHdoZW4gYSBiYXNlIG5vZGUgaXMgdXNlZCAoIzI3MDkgYW5kICM0Mzc4KS4KCQkJCWhlYWQuaW5zZXJ0QmVmb3JlKCBzY3JpcHQsIGhlYWQuZmlyc3RDaGlsZCApOwoJCQl9LAoKCQkJYWJvcnQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBzY3JpcHQgKSB7CgkJCQkJc2NyaXB0Lm9ubG9hZCggMCwgMSApOwoJCQkJfQoJCQl9CgkJfTsKCX0KfSk7CgoKCgp2YXIgLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKCXhock9uVW5sb2FkQWJvcnQgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCA/IGZ1bmN0aW9uKCkgewoJCS8vIEFib3J0IGFsbCBwZW5kaW5nIHJlcXVlc3RzCgkJZm9yICggdmFyIGtleSBpbiB4aHJDYWxsYmFja3MgKSB7CgkJCXhockNhbGxiYWNrc1sga2V5IF0oIDAsIDEgKTsKCQl9Cgl9IDogZmFsc2UsCgl4aHJJZCA9IDAsCgl4aHJDYWxsYmFja3M7CgovLyBGdW5jdGlvbnMgdG8gY3JlYXRlIHhocnMKZnVuY3Rpb24gY3JlYXRlU3RhbmRhcmRYSFIoKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KCk7Cgl9IGNhdGNoKCBlICkge30KfQoKZnVuY3Rpb24gY3JlYXRlQWN0aXZlWEhSKCkgewoJdHJ5IHsKCQlyZXR1cm4gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTEhUVFAiICk7Cgl9IGNhdGNoKCBlICkge30KfQoKLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdAovLyAoVGhpcyBpcyBzdGlsbCBhdHRhY2hlZCB0byBhamF4U2V0dGluZ3MgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPwoJLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQoJICogaW1wbGVtZW50IHRoZSBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgKGNhbid0IHJlcXVlc3QgbG9jYWwgZmlsZXMpLAoJICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlCgkgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28KCSAqIHdlIG5lZWQgYSBmYWxsYmFjay4KCSAqLwoJZnVuY3Rpb24oKSB7CgkJcmV0dXJuICF0aGlzLmlzTG9jYWwgJiYgY3JlYXRlU3RhbmRhcmRYSFIoKSB8fCBjcmVhdGVBY3RpdmVYSFIoKTsKCX0gOgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwooZnVuY3Rpb24oIHhociApIHsKCWpRdWVyeS5leHRlbmQoIGpRdWVyeS5zdXBwb3J0LCB7CgkJYWpheDogISF4aHIsCgkJY29yczogISF4aHIgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHIgKQoJfSk7Cn0pKCBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpICk7CgovLyBDcmVhdGUgdHJhbnNwb3J0IGlmIHRoZSBicm93c2VyIGNhbiBwcm92aWRlIGFuIHhocgppZiAoIGpRdWVyeS5zdXBwb3J0LmFqYXggKSB7CgoJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7CgkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCWlmICggIXMuY3Jvc3NEb21haW4gfHwgalF1ZXJ5LnN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgoJCQkJCS8vIEdldCBhIG5ldyB4aHIKCQkJCQl2YXIgeGhyID0gcy54aHIoKSwKCQkJCQkJaGFuZGxlLAoJCQkJCQlpOwoKCQkJCQkvLyBPcGVuIHRoZSBzb2NrZXQKCQkJCQkvLyBQYXNzaW5nIG51bGwgdXNlcm5hbWUsIGdlbmVyYXRlcyBhIGxvZ2luIHBvcHVwIG9uIE9wZXJhICgjMjg2NSkKCQkJCQlpZiAoIHMudXNlcm5hbWUgKSB7CgkJCQkJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJeGhyLm9wZW4oIHMudHlwZSwgcy51cmwsIHMuYXN5bmMgKTsKCQkJCQl9CgoJCQkJCS8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWQKCQkJCQlpZiAoIHMueGhyRmllbGRzICkgewoJCQkJCQlmb3IgKCBpIGluIHMueGhyRmllbGRzICkgewoJCQkJCQkJeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBPdmVycmlkZSBtaW1lIHR5cGUgaWYgbmVlZGVkCgkJCQkJaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggcy5taW1lVHlwZSApOwoJCQkJCX0KCgkJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJLy8gYWtpbiB0byBhIGppZ3NhdyBwdXp6bGUsIHdlIHNpbXBseSBuZXZlciBzZXQgaXQgdG8gYmUgc3VyZS4KCQkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQlpZiAoICFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gKSB7CgkJCQkJCWhlYWRlcnNbICJYLVJlcXVlc3RlZC1XaXRoIiBdID0gIlhNTEh0dHBSZXF1ZXN0IjsKCQkJCQl9CgoJCQkJCS8vIE5lZWQgYW4gZXh0cmEgdHJ5L2NhdGNoIGZvciBjcm9zcyBkb21haW4gcmVxdWVzdHMgaW4gRmlyZWZveCAzCgkJCQkJdHJ5IHsKCQkJCQkJZm9yICggaSBpbiBoZWFkZXJzICkgewoJCQkJCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIGksIGhlYWRlcnNbIGkgXSApOwoJCQkJCQl9CgkJCQkJfSBjYXRjaCggXyApIHt9CgoJCQkJCS8vIERvIHNlbmQgdGhlIHJlcXVlc3QKCQkJCQkvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHkKCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQl4aHIuc2VuZCggKCBzLmhhc0NvbnRlbnQgJiYgcy5kYXRhICkgfHwgbnVsbCApOwoKCQkJCQkvLyBMaXN0ZW5lcgoJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgoJCQkJCQl2YXIgc3RhdHVzLAoJCQkJCQkJc3RhdHVzVGV4dCwKCQkJCQkJCXJlc3BvbnNlSGVhZGVycywKCQkJCQkJCXJlc3BvbnNlcywKCQkJCQkJCXhtbDsKCgkJCQkJCS8vIEZpcmVmb3ggdGhyb3dzIGV4Y2VwdGlvbnMgd2hlbiBhY2Nlc3NpbmcgcHJvcGVydGllcwoJCQkJCQkvLyBvZiBhbiB4aHIgd2hlbiBhIG5ldHdvcmsgZXJyb3Igb2NjdXJlZAoJCQkJCQkvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpCgkJCQkJCXRyeSB7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gT25seSBjYWxsZWQgb25jZQoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoKCQkJCQkJCQkvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoJCQkJCQkJCWlmICggaGFuZGxlICkgewoJCQkJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0galF1ZXJ5Lm5vb3A7CgkJCQkJCQkJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsKCQkJCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGhhbmRsZSBdOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBJZiBpdCdzIGFuIGFib3J0CgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQkvLyBBYm9ydCBpdCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCQkJaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHsKCQkJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJc3RhdHVzID0geGhyLnN0YXR1czsKCQkJCQkJCQkJcmVzcG9uc2VIZWFkZXJzID0geGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwoJCQkJCQkJCQlyZXNwb25zZXMgPSB7fTsKCQkJCQkJCQkJeG1sID0geGhyLnJlc3BvbnNlWE1MOwoKCQkJCQkJCQkJLy8gQ29uc3RydWN0IHJlc3BvbnNlIGxpc3QKCQkJCQkJCQkJaWYgKCB4bWwgJiYgeG1sLmRvY3VtZW50RWxlbWVudCAvKiAjNDk1OCAqLyApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy54bWwgPSB4bWw7CgkJCQkJCQkJCX0KCQkJCQkJCQkJcmVzcG9uc2VzLnRleHQgPSB4aHIucmVzcG9uc2VUZXh0OwoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQkJc3RhdHVzVGV4dCA9ICIiOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCQkvLyBJZiB0aGUgcmVxdWVzdCBpcyBsb2NhbCBhbmQgd2UgaGF2ZSBkYXRhOiBhc3N1bWUgYSBzdWNjZXNzCgkJCQkJCQkJCS8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQoJCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJCWlmICggIXN0YXR1cyAmJiBzLmlzTG9jYWwgJiYgIXMuY3Jvc3NEb21haW4gKSB7CgkJCQkJCQkJCQlzdGF0dXMgPSByZXNwb25zZXMudGV4dCA/IDIwMCA6IDQwNDsKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGNhdGNoKCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICkgewoJCQkJCQkJaWYgKCAhaXNBYm9ydCApIHsKCQkJCQkJCQljb21wbGV0ZSggLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24gKTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCQkJCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHJlc3BvbnNlSGVhZGVycyApOwoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJLy8gaWYgd2UncmUgaW4gc3luYyBtb2RlIG9yIGl0J3MgaW4gY2FjaGUKCQkJCQkvLyBhbmQgaGFzIGJlZW4gcmV0cmlldmVkIGRpcmVjdGx5IChJRTYgJiBJRTcpCgkJCQkJLy8gd2UgbmVlZCB0byBtYW51YWxseSBmaXJlIHRoZSBjYWxsYmFjawoJCQkJCWlmICggIXMuYXN5bmMgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgkJCQkJCWNhbGxiYWNrKCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaGFuZGxlID0gKyt4aHJJZDsKCQkJCQkJaWYgKCB4aHJPblVubG9hZEFib3J0ICkgewoJCQkJCQkJLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKCQkJCQkJCS8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCgkJCQkJCQlpZiAoICF4aHJDYWxsYmFja3MgKSB7CgkJCQkJCQkJeGhyQ2FsbGJhY2tzID0ge307CgkJCQkJCQkJalF1ZXJ5KCB3aW5kb3cgKS51bmxvYWQoIHhock9uVW5sb2FkQWJvcnQgKTsKCQkJCQkJCX0KCQkJCQkJCS8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrcwoJCQkJCQkJeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXSA9IGNhbGxiYWNrOwoJCQkJCQl9CgkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjazsKCQkJCQl9CgkJCQl9LAoKCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQljYWxsYmFjaygwLDEpOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9Cgl9KTsKfQoKCgoKdmFyIGVsZW1kaXNwbGF5ID0ge30sCglpZnJhbWUsIGlmcmFtZURvYywKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcmZ4bnVtID0gL14oWytcLV09KT8oW1xkKy5cLV0rKShbYS16JV0qKSQvaSwKCXRpbWVySWQsCglmeEF0dHJzID0gWwoJCS8vIGhlaWdodCBhbmltYXRpb25zCgkJWyAiaGVpZ2h0IiwgIm1hcmdpblRvcCIsICJtYXJnaW5Cb3R0b20iLCAicGFkZGluZ1RvcCIsICJwYWRkaW5nQm90dG9tIiBdLAoJCS8vIHdpZHRoIGFuaW1hdGlvbnMKCQlbICJ3aWR0aCIsICJtYXJnaW5MZWZ0IiwgIm1hcmdpblJpZ2h0IiwgInBhZGRpbmdMZWZ0IiwgInBhZGRpbmdSaWdodCIgXSwKCQkvLyBvcGFjaXR5IGFuaW1hdGlvbnMKCQlbICJvcGFjaXR5IiBdCgldLAoJZnhOb3c7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXNob3c6IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQl2YXIgZWxlbSwgZGlzcGxheTsKCgkJaWYgKCBzcGVlZCB8fCBzcGVlZCA9PT0gMCApIHsKCQkJcmV0dXJuIHRoaXMuYW5pbWF0ZSggZ2VuRngoInNob3ciLCAzKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCgkJfSBlbHNlIHsKCQkJZm9yICggdmFyIGkgPSAwLCBqID0gdGhpcy5sZW5ndGg7IGkgPCBqOyBpKysgKSB7CgkJCQllbGVtID0gdGhpc1sgaSBdOwoKCQkJCWlmICggZWxlbS5zdHlsZSApIHsKCQkJCQlkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoKCQkJCQkvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCgkJCQkJLy8gYmVpbmcgaGlkZGVuIGJ5IGNhc2NhZGVkIHJ1bGVzIG9yIG5vdAoJCQkJCWlmICggIWpRdWVyeS5fZGF0YShlbGVtLCAib2xkZGlzcGxheSIpICYmIGRpc3BsYXkgPT09ICJub25lIiApIHsKCQkJCQkJZGlzcGxheSA9IGVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCQkJCX0KCgkJCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkJCS8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCgkJCQkJLy8gZm9yIHN1Y2ggYW4gZWxlbWVudAoJCQkJCWlmICggZGlzcGxheSA9PT0gIiIgJiYgalF1ZXJ5LmNzcyhlbGVtLCAiZGlzcGxheSIpID09PSAibm9uZSIgKSB7CgkJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBkZWZhdWx0RGlzcGxheShlbGVtLm5vZGVOYW1lKSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3AKCQkJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJCQlmb3IgKCBpID0gMDsgaSA8IGo7IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgoJCQkJaWYgKCBlbGVtLnN0eWxlICkgewoJCQkJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgoJCQkJCWlmICggZGlzcGxheSA9PT0gIiIgfHwgZGlzcGxheSA9PT0gIm5vbmUiICkgewoJCQkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSBqUXVlcnkuX2RhdGEoIGVsZW0sICJvbGRkaXNwbGF5IiApIHx8ICIiOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgkJfQoJfSwKCgloaWRlOiBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJaWYgKCBzcGVlZCB8fCBzcGVlZCA9PT0gMCApIHsKCQkJcmV0dXJuIHRoaXMuYW5pbWF0ZSggZ2VuRngoImhpZGUiLCAzKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spOwoKCQl9IGVsc2UgewoJCQl2YXIgZWxlbSwgZGlzcGxheSwKCQkJCWkgPSAwLAoJCQkJaiA9IHRoaXMubGVuZ3RoOwoKCQkJZm9yICggOyBpIDwgajsgaSsrICkgewoJCQkJZWxlbSA9IHRoaXNbaV07CgkJCQlpZiAoIGVsZW0uc3R5bGUgKSB7CgkJCQkJZGlzcGxheSA9IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApOwoKCQkJCQlpZiAoIGRpc3BsYXkgIT09ICJub25lIiAmJiAhalF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIgKSApIHsKCQkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIsIGRpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCB0aGUgZGlzcGxheSBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAoJCQkvLyB0byBhdm9pZCB0aGUgY29uc3RhbnQgcmVmbG93CgkJCWZvciAoIGkgPSAwOyBpIDwgajsgaSsrICkgewoJCQkJaWYgKCB0aGlzW2ldLnN0eWxlICkgewoJCQkJCXRoaXNbaV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgkJfQoJfSwKCgkvLyBTYXZlIHRoZSBvbGQgdG9nZ2xlIGZ1bmN0aW9uCglfdG9nZ2xlOiBqUXVlcnkuZm4udG9nZ2xlLAoKCXRvZ2dsZTogZnVuY3Rpb24oIGZuLCBmbjIsIGNhbGxiYWNrICkgewoJCXZhciBib29sID0gdHlwZW9mIGZuID09PSAiYm9vbGVhbiI7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oZm4pICYmIGpRdWVyeS5pc0Z1bmN0aW9uKGZuMikgKSB7CgkJCXRoaXMuX3RvZ2dsZS5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgfHwgYm9vbCApIHsKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIHN0YXRlID0gYm9vbCA/IGZuIDogalF1ZXJ5KHRoaXMpLmlzKCI6aGlkZGVuIik7CgkJCQlqUXVlcnkodGhpcylbIHN0YXRlID8gInNob3ciIDogImhpZGUiIF0oKTsKCQkJfSk7CgoJCX0gZWxzZSB7CgkJCXRoaXMuYW5pbWF0ZShnZW5GeCgidG9nZ2xlIiwgMyksIGZuLCBmbjIsIGNhbGxiYWNrKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCglmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMuZmlsdGVyKCI6aGlkZGVuIikuY3NzKCJvcGFjaXR5IiwgMCkuc2hvdygpLmVuZCgpCgkJCQkJLmFuaW1hdGUoe29wYWNpdHk6IHRvfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spOwoJfSwKCglhbmltYXRlOiBmdW5jdGlvbiggcHJvcCwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJdmFyIG9wdGFsbCA9IGpRdWVyeS5zcGVlZCggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggcHJvcCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKCBvcHRhbGwuY29tcGxldGUsIFsgZmFsc2UgXSApOwoJCX0KCgkJLy8gRG8gbm90IGNoYW5nZSByZWZlcmVuY2VkIHByb3BlcnRpZXMgYXMgcGVyLXByb3BlcnR5IGVhc2luZyB3aWxsIGJlIGxvc3QKCQlwcm9wID0galF1ZXJ5LmV4dGVuZCgge30sIHByb3AgKTsKCgkJZnVuY3Rpb24gZG9BbmltYXRpb24oKSB7CgkJCS8vIFhYWCAndGhpcycgZG9lcyBub3QgYWx3YXlzIGhhdmUgYSBub2RlTmFtZSB3aGVuIHJ1bm5pbmcgdGhlCgkJCS8vIHRlc3Qgc3VpdGUKCgkJCWlmICggb3B0YWxsLnF1ZXVlID09PSBmYWxzZSApIHsKCQkJCWpRdWVyeS5fbWFyayggdGhpcyApOwoJCQl9CgoJCQl2YXIgb3B0ID0galF1ZXJ5LmV4dGVuZCgge30sIG9wdGFsbCApLAoJCQkJaXNFbGVtZW50ID0gdGhpcy5ub2RlVHlwZSA9PT0gMSwKCQkJCWhpZGRlbiA9IGlzRWxlbWVudCAmJiBqUXVlcnkodGhpcykuaXMoIjpoaWRkZW4iKSwKCQkJCW5hbWUsIHZhbCwgcCwgZSwKCQkJCXBhcnRzLCBzdGFydCwgZW5kLCB1bml0LAoJCQkJbWV0aG9kOwoKCQkJLy8gd2lsbCBzdG9yZSBwZXIgcHJvcGVydHkgZWFzaW5nIGFuZCBiZSB1c2VkIHRvIGRldGVybWluZSB3aGVuIGFuIGFuaW1hdGlvbiBpcyBjb21wbGV0ZQoJCQlvcHQuYW5pbWF0ZWRQcm9wZXJ0aWVzID0ge307CgoJCQlmb3IgKCBwIGluIHByb3AgKSB7CgoJCQkJLy8gcHJvcGVydHkgbmFtZSBub3JtYWxpemF0aW9uCgkJCQluYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggcCApOwoJCQkJaWYgKCBwICE9PSBuYW1lICkgewoJCQkJCXByb3BbIG5hbWUgXSA9IHByb3BbIHAgXTsKCQkJCQlkZWxldGUgcHJvcFsgcCBdOwoJCQkJfQoKCQkJCXZhbCA9IHByb3BbIG5hbWUgXTsKCgkJCQkvLyBlYXNpbmcgcmVzb2x1dGlvbjogcGVyIHByb3BlcnR5ID4gb3B0LnNwZWNpYWxFYXNpbmcgPiBvcHQuZWFzaW5nID4gJ3N3aW5nJyAoZGVmYXVsdCkKCQkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbCApICkgewoJCQkJCW9wdC5hbmltYXRlZFByb3BlcnRpZXNbIG5hbWUgXSA9IHZhbFsgMSBdOwoJCQkJCXZhbCA9IHByb3BbIG5hbWUgXSA9IHZhbFsgMCBdOwoJCQkJfSBlbHNlIHsKCQkJCQlvcHQuYW5pbWF0ZWRQcm9wZXJ0aWVzWyBuYW1lIF0gPSBvcHQuc3BlY2lhbEVhc2luZyAmJiBvcHQuc3BlY2lhbEVhc2luZ1sgbmFtZSBdIHx8IG9wdC5lYXNpbmcgfHwgJ3N3aW5nJzsKCQkJCX0KCgkJCQlpZiAoIHZhbCA9PT0gImhpZGUiICYmIGhpZGRlbiB8fCB2YWwgPT09ICJzaG93IiAmJiAhaGlkZGVuICkgewoJCQkJCXJldHVybiBvcHQuY29tcGxldGUuY2FsbCggdGhpcyApOwoJCQkJfQoKCQkJCWlmICggaXNFbGVtZW50ICYmICggbmFtZSA9PT0gImhlaWdodCIgfHwgbmFtZSA9PT0gIndpZHRoIiApICkgewoJCQkJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dAoJCQkJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkJCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkJCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCQkJCW9wdC5vdmVyZmxvdyA9IFsgdGhpcy5zdHlsZS5vdmVyZmxvdywgdGhpcy5zdHlsZS5vdmVyZmxvd1gsIHRoaXMuc3R5bGUub3ZlcmZsb3dZIF07CgoJCQkJCS8vIFNldCBkaXNwbGF5IHByb3BlcnR5IHRvIGlubGluZS1ibG9jayBmb3IgaGVpZ2h0L3dpZHRoCgkJCQkJLy8gYW5pbWF0aW9ucyBvbiBpbmxpbmUgZWxlbWVudHMgdGhhdCBhcmUgaGF2aW5nIHdpZHRoL2hlaWdodCBhbmltYXRlZAoJCQkJCWlmICggalF1ZXJ5LmNzcyggdGhpcywgImRpc3BsYXkiICkgPT09ICJpbmxpbmUiICYmCgkJCQkJCQlqUXVlcnkuY3NzKCB0aGlzLCAiZmxvYXQiICkgPT09ICJub25lIiApIHsKCgkJCQkJCS8vIGlubGluZS1sZXZlbCBlbGVtZW50cyBhY2NlcHQgaW5saW5lLWJsb2NrOwoJCQkJCQkvLyBibG9jay1sZXZlbCBlbGVtZW50cyBuZWVkIHRvIGJlIGlubGluZSB3aXRoIGxheW91dAoJCQkJCQlpZiAoICFqUXVlcnkuc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0IHx8IGRlZmF1bHREaXNwbGF5KCB0aGlzLm5vZGVOYW1lICkgPT09ICJpbmxpbmUiICkgewoJCQkJCQkJdGhpcy5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdGhpcy5zdHlsZS56b29tID0gMTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKCBvcHQub3ZlcmZsb3cgIT0gbnVsbCApIHsKCQkJCXRoaXMuc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJfQoKCQkJZm9yICggcCBpbiBwcm9wICkgewoJCQkJZSA9IG5ldyBqUXVlcnkuZngoIHRoaXMsIG9wdCwgcCApOwoJCQkJdmFsID0gcHJvcFsgcCBdOwoKCQkJCWlmICggcmZ4dHlwZXMudGVzdCggdmFsICkgKSB7CgoJCQkJCS8vIFRyYWNrcyB3aGV0aGVyIHRvIHNob3cgb3IgaGlkZSBiYXNlZCBvbiBwcml2YXRlCgkJCQkJLy8gZGF0YSBhdHRhY2hlZCB0byB0aGUgZWxlbWVudAoJCQkJCW1ldGhvZCA9IGpRdWVyeS5fZGF0YSggdGhpcywgInRvZ2dsZSIgKyBwICkgfHwgKCB2YWwgPT09ICJ0b2dnbGUiID8gaGlkZGVuID8gInNob3ciIDogImhpZGUiIDogMCApOwoJCQkJCWlmICggbWV0aG9kICkgewoJCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJ0b2dnbGUiICsgcCwgbWV0aG9kID09PSAic2hvdyIgPyAiaGlkZSIgOiAic2hvdyIgKTsKCQkJCQkJZVsgbWV0aG9kIF0oKTsKCQkJCQl9IGVsc2UgewoJCQkJCQllWyB2YWwgXSgpOwoJCQkJCX0KCgkJCQl9IGVsc2UgewoJCQkJCXBhcnRzID0gcmZ4bnVtLmV4ZWMoIHZhbCApOwoJCQkJCXN0YXJ0ID0gZS5jdXIoKTsKCgkJCQkJaWYgKCBwYXJ0cyApIHsKCQkJCQkJZW5kID0gcGFyc2VGbG9hdCggcGFydHNbMl0gKTsKCQkJCQkJdW5pdCA9IHBhcnRzWzNdIHx8ICggalF1ZXJ5LmNzc051bWJlclsgcCBdID8gIiIgOiAicHgiICk7CgoJCQkJCQkvLyBXZSBuZWVkIHRvIGNvbXB1dGUgc3RhcnRpbmcgdmFsdWUKCQkJCQkJaWYgKCB1bml0ICE9PSAicHgiICkgewoJCQkJCQkJalF1ZXJ5LnN0eWxlKCB0aGlzLCBwLCAoZW5kIHx8IDEpICsgdW5pdCk7CgkJCQkJCQlzdGFydCA9ICggKGVuZCB8fCAxKSAvIGUuY3VyKCkgKSAqIHN0YXJ0OwoJCQkJCQkJalF1ZXJ5LnN0eWxlKCB0aGlzLCBwLCBzdGFydCArIHVuaXQpOwoJCQkJCQl9CgoJCQkJCQkvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24KCQkJCQkJaWYgKCBwYXJ0c1sxXSApIHsKCQkJCQkJCWVuZCA9ICggKHBhcnRzWyAxIF0gPT09ICItPSIgPyAtMSA6IDEpICogZW5kICkgKyBzdGFydDsKCQkJCQkJfQoKCQkJCQkJZS5jdXN0b20oIHN0YXJ0LCBlbmQsIHVuaXQgKTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJZS5jdXN0b20oIHN0YXJ0LCB2YWwsICIiICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBGb3IgSlMgc3RyaWN0IGNvbXBsaWFuY2UKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQlyZXR1cm4gb3B0YWxsLnF1ZXVlID09PSBmYWxzZSA/CgkJCXRoaXMuZWFjaCggZG9BbmltYXRpb24gKSA6CgkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCX0sCgoJc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7CgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQljbGVhclF1ZXVlID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBjbGVhclF1ZXVlICYmIHR5cGUgIT09IGZhbHNlICkgewoJCQl0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaW5kZXgsCgkJCQloYWRUaW1lcnMgPSBmYWxzZSwKCQkJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJCQlkYXRhID0galF1ZXJ5Ll9kYXRhKCB0aGlzICk7CgoJCQkvLyBjbGVhciBtYXJrZXIgY291bnRlcnMgaWYgd2Uga25vdyB0aGV5IHdvbid0IGJlCgkJCWlmICggIWdvdG9FbmQgKSB7CgkJCQlqUXVlcnkuX3VubWFyayggdHJ1ZSwgdGhpcyApOwoJCQl9CgoJCQlmdW5jdGlvbiBzdG9wUXVldWUoIGVsZW0sIGRhdGEsIGluZGV4ICkgewoJCQkJdmFyIGhvb2tzID0gZGF0YVsgaW5kZXggXTsKCQkJCWpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCBpbmRleCwgdHJ1ZSApOwoJCQkJaG9va3Muc3RvcCggZ290b0VuZCApOwoJCQl9CgoJCQlpZiAoIHR5cGUgPT0gbnVsbCApIHsKCQkJCWZvciAoIGluZGV4IGluIGRhdGEgKSB7CgkJCQkJaWYgKCBkYXRhWyBpbmRleCBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCAmJiBpbmRleC5pbmRleE9mKCIucnVuIikgPT09IGluZGV4Lmxlbmd0aCAtIDQgKSB7CgkJCQkJCXN0b3BRdWV1ZSggdGhpcywgZGF0YSwgaW5kZXggKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSBpZiAoIGRhdGFbIGluZGV4ID0gdHlwZSArICIucnVuIiBdICYmIGRhdGFbIGluZGV4IF0uc3RvcCApewoJCQkJc3RvcFF1ZXVlKCB0aGlzLCBkYXRhLCBpbmRleCApOwoJCQl9CgoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7CgkJCQkJaWYgKCBnb3RvRW5kICkgewoKCQkJCQkJLy8gZm9yY2UgdGhlIG5leHQgc3RlcCB0byBiZSB0aGUgbGFzdAoJCQkJCQl0aW1lcnNbIGluZGV4IF0oIHRydWUgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0aW1lcnNbIGluZGV4IF0uc2F2ZVN0YXRlKCk7CgkJCQkJfQoJCQkJCWhhZFRpbWVycyA9IHRydWU7CgkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCX0KCQkJfQoKCQkJLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZAoJCQkvLyB0aW1lcnMgY3VycmVudGx5IHdpbGwgY2FsbCB0aGVpciBjb21wbGV0ZSBjYWxsYmFja3MsIHdoaWNoIHdpbGwgZGVxdWV1ZQoJCQkvLyBidXQgb25seSBpZiB0aGV5IHdlcmUgZ290b0VuZAoJCQlpZiAoICEoIGdvdG9FbmQgJiYgaGFkVGltZXJzICkgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQl9CgkJfSk7Cgl9Cgp9KTsKCi8vIEFuaW1hdGlvbnMgY3JlYXRlZCBzeW5jaHJvbm91c2x5IHdpbGwgcnVuIHN5bmNocm9ub3VzbHkKZnVuY3Rpb24gY3JlYXRlRnhOb3coKSB7CglzZXRUaW1lb3V0KCBjbGVhckZ4Tm93LCAwICk7CglyZXR1cm4gKCBmeE5vdyA9IGpRdWVyeS5ub3coKSApOwp9CgpmdW5jdGlvbiBjbGVhckZ4Tm93KCkgewoJZnhOb3cgPSB1bmRlZmluZWQ7Cn0KCi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCmZ1bmN0aW9uIGdlbkZ4KCB0eXBlLCBudW0gKSB7Cgl2YXIgb2JqID0ge307CgoJalF1ZXJ5LmVhY2goIGZ4QXR0cnMuY29uY2F0LmFwcGx5KFtdLCBmeEF0dHJzLnNsaWNlKCAwLCBudW0gKSksIGZ1bmN0aW9uKCkgewoJCW9ialsgdGhpcyBdID0gdHlwZTsKCX0pOwoKCXJldHVybiBvYmo7Cn0KCi8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnMKalF1ZXJ5LmVhY2goewoJc2xpZGVEb3duOiBnZW5GeCggInNob3ciLCAxICksCglzbGlkZVVwOiBnZW5GeCggImhpZGUiLCAxICksCglzbGlkZVRvZ2dsZTogZ2VuRngoICJ0b2dnbGUiLCAxICksCglmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCglmYWRlT3V0OiB7IG9wYWNpdHk6ICJoaWRlIiB9LAoJZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiAidG9nZ2xlIiB9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiB0aGlzLmFuaW1hdGUoIHByb3BzLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCXNwZWVkOiBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgZm4gKSB7CgkJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQkJY29tcGxldGU6IGZuIHx8ICFmbiAmJiBlYXNpbmcgfHwKCQkJCWpRdWVyeS5pc0Z1bmN0aW9uKCBzcGVlZCApICYmIHNwZWVkLAoJCQlkdXJhdGlvbjogc3BlZWQsCgkJCWVhc2luZzogZm4gJiYgZWFzaW5nIHx8IGVhc2luZyAmJiAhalF1ZXJ5LmlzRnVuY3Rpb24oIGVhc2luZyApICYmIGVhc2luZwoJCX07CgoJCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCQlvcHQuZHVyYXRpb24gaW4galF1ZXJ5LmZ4LnNwZWVkcyA/IGpRdWVyeS5meC5zcGVlZHNbIG9wdC5kdXJhdGlvbiBdIDogalF1ZXJ5LmZ4LnNwZWVkcy5fZGVmYXVsdDsKCgkJLy8gbm9ybWFsaXplIG9wdC5xdWV1ZSAtIHRydWUvdW5kZWZpbmVkL251bGwgLT4gImZ4IgoJCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCQlvcHQucXVldWUgPSAiZngiOwoJCX0KCgkJLy8gUXVldWVpbmcKCQlvcHQub2xkID0gb3B0LmNvbXBsZXRlOwoKCQlvcHQuY29tcGxldGUgPSBmdW5jdGlvbiggbm9Vbm1hcmsgKSB7CgkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIG9wdC5vbGQgKSApIHsKCQkJCW9wdC5vbGQuY2FsbCggdGhpcyApOwoJCQl9CgoJCQlpZiAoIG9wdC5xdWV1ZSApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCBvcHQucXVldWUgKTsKCQkJfSBlbHNlIGlmICggbm9Vbm1hcmsgIT09IGZhbHNlICkgewoJCQkJalF1ZXJ5Ll91bm1hcmsoIHRoaXMgKTsKCQkJfQoJCX07CgoJCXJldHVybiBvcHQ7Cgl9LAoKCWVhc2luZzogewoJCWxpbmVhcjogZnVuY3Rpb24oIHAsIG4sIGZpcnN0TnVtLCBkaWZmICkgewoJCQlyZXR1cm4gZmlyc3ROdW0gKyBkaWZmICogcDsKCQl9LAoJCXN3aW5nOiBmdW5jdGlvbiggcCwgbiwgZmlyc3ROdW0sIGRpZmYgKSB7CgkJCXJldHVybiAoICggLU1hdGguY29zKCBwKk1hdGguUEkgKSAvIDIgKSArIDAuNSApICogZGlmZiArIGZpcnN0TnVtOwoJCX0KCX0sCgoJdGltZXJzOiBbXSwKCglmeDogZnVuY3Rpb24oIGVsZW0sIG9wdGlvbnMsIHByb3AgKSB7CgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCQl0aGlzLmVsZW0gPSBlbGVtOwoJCXRoaXMucHJvcCA9IHByb3A7CgoJCW9wdGlvbnMub3JpZyA9IG9wdGlvbnMub3JpZyB8fCB7fTsKCX0KCn0pOwoKalF1ZXJ5LmZ4LnByb3RvdHlwZSA9IHsKCS8vIFNpbXBsZSBmdW5jdGlvbiBmb3Igc2V0dGluZyBhIHN0eWxlIHZhbHVlCgl1cGRhdGU6IGZ1bmN0aW9uKCkgewoJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCXRoaXMub3B0aW9ucy5zdGVwLmNhbGwoIHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMgKTsKCQl9CgoJCSggalF1ZXJ5LmZ4LnN0ZXBbIHRoaXMucHJvcCBdIHx8IGpRdWVyeS5meC5zdGVwLl9kZWZhdWx0ICkoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBjdXJyZW50IHNpemUKCWN1cjogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzLmVsZW1bIHRoaXMucHJvcCBdICE9IG51bGwgJiYgKCF0aGlzLmVsZW0uc3R5bGUgfHwgdGhpcy5lbGVtLnN0eWxlWyB0aGlzLnByb3AgXSA9PSBudWxsKSApIHsKCQkJcmV0dXJuIHRoaXMuZWxlbVsgdGhpcy5wcm9wIF07CgkJfQoKCQl2YXIgcGFyc2VkLAoJCQlyID0galF1ZXJ5LmNzcyggdGhpcy5lbGVtLCB0aGlzLnByb3AgKTsKCQkvLyBFbXB0eSBzdHJpbmdzLCBudWxsLCB1bmRlZmluZWQgYW5kICJhdXRvIiBhcmUgY29udmVydGVkIHRvIDAsCgkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMgaXMsCgkJLy8gc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCXJldHVybiBpc05hTiggcGFyc2VkID0gcGFyc2VGbG9hdCggciApICkgPyAhciB8fCByID09PSAiYXV0byIgPyAwIDogciA6IHBhcnNlZDsKCX0sCgoJLy8gU3RhcnQgYW4gYW5pbWF0aW9uIGZyb20gb25lIG51bWJlciB0byBhbm90aGVyCgljdXN0b206IGZ1bmN0aW9uKCBmcm9tLCB0bywgdW5pdCApIHsKCQl2YXIgc2VsZiA9IHRoaXMsCgkJCWZ4ID0galF1ZXJ5LmZ4OwoKCQl0aGlzLnN0YXJ0VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCk7CgkJdGhpcy5lbmQgPSB0bzsKCQl0aGlzLm5vdyA9IHRoaXMuc3RhcnQgPSBmcm9tOwoJCXRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDA7CgkJdGhpcy51bml0ID0gdW5pdCB8fCB0aGlzLnVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyB0aGlzLnByb3AgXSA/ICIiIDogInB4IiApOwoKCQlmdW5jdGlvbiB0KCBnb3RvRW5kICkgewoJCQlyZXR1cm4gc2VsZi5zdGVwKCBnb3RvRW5kICk7CgkJfQoKCQl0LnF1ZXVlID0gdGhpcy5vcHRpb25zLnF1ZXVlOwoJCXQuZWxlbSA9IHRoaXMuZWxlbTsKCQl0LnNhdmVTdGF0ZSA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoIHNlbGYub3B0aW9ucy5oaWRlICYmIGpRdWVyeS5fZGF0YSggc2VsZi5lbGVtLCAiZnhzaG93IiArIHNlbGYucHJvcCApID09PSB1bmRlZmluZWQgKSB7CgkJCQlqUXVlcnkuX2RhdGEoIHNlbGYuZWxlbSwgImZ4c2hvdyIgKyBzZWxmLnByb3AsIHNlbGYuc3RhcnQgKTsKCQkJfQoJCX07CgoJCWlmICggdCgpICYmIGpRdWVyeS50aW1lcnMucHVzaCh0KSAmJiAhdGltZXJJZCApIHsKCQkJdGltZXJJZCA9IHNldEludGVydmFsKCBmeC50aWNrLCBmeC5pbnRlcnZhbCApOwoJCX0KCX0sCgoJLy8gU2ltcGxlICdzaG93JyBmdW5jdGlvbgoJc2hvdzogZnVuY3Rpb24oKSB7CgkJdmFyIGRhdGFTaG93ID0galF1ZXJ5Ll9kYXRhKCB0aGlzLmVsZW0sICJmeHNob3ciICsgdGhpcy5wcm9wICk7CgoJCS8vIFJlbWVtYmVyIHdoZXJlIHdlIHN0YXJ0ZWQsIHNvIHRoYXQgd2UgY2FuIGdvIGJhY2sgdG8gaXQgbGF0ZXIKCQl0aGlzLm9wdGlvbnMub3JpZ1sgdGhpcy5wcm9wIF0gPSBkYXRhU2hvdyB8fCBqUXVlcnkuc3R5bGUoIHRoaXMuZWxlbSwgdGhpcy5wcm9wICk7CgkJdGhpcy5vcHRpb25zLnNob3cgPSB0cnVlOwoKCQkvLyBCZWdpbiB0aGUgYW5pbWF0aW9uCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2Ugc3RhcnQgYXQgYSBzbWFsbCB3aWR0aC9oZWlnaHQgdG8gYXZvaWQgYW55IGZsYXNoIG9mIGNvbnRlbnQKCQlpZiAoIGRhdGFTaG93ICE9PSB1bmRlZmluZWQgKSB7CgkJCS8vIFRoaXMgc2hvdyBpcyBwaWNraW5nIHVwIHdoZXJlIGEgcHJldmlvdXMgaGlkZSBvciBzaG93IGxlZnQgb2ZmCgkJCXRoaXMuY3VzdG9tKCB0aGlzLmN1cigpLCBkYXRhU2hvdyApOwoJCX0gZWxzZSB7CgkJCXRoaXMuY3VzdG9tKCB0aGlzLnByb3AgPT09ICJ3aWR0aCIgfHwgdGhpcy5wcm9wID09PSAiaGVpZ2h0IiA/IDEgOiAwLCB0aGlzLmN1cigpICk7CgkJfQoKCQkvLyBTdGFydCBieSBzaG93aW5nIHRoZSBlbGVtZW50CgkJalF1ZXJ5KCB0aGlzLmVsZW0gKS5zaG93KCk7Cgl9LAoKCS8vIFNpbXBsZSAnaGlkZScgZnVuY3Rpb24KCWhpZGU6IGZ1bmN0aW9uKCkgewoJCS8vIFJlbWVtYmVyIHdoZXJlIHdlIHN0YXJ0ZWQsIHNvIHRoYXQgd2UgY2FuIGdvIGJhY2sgdG8gaXQgbGF0ZXIKCQl0aGlzLm9wdGlvbnMub3JpZ1sgdGhpcy5wcm9wIF0gPSBqUXVlcnkuX2RhdGEoIHRoaXMuZWxlbSwgImZ4c2hvdyIgKyB0aGlzLnByb3AgKSB8fCBqUXVlcnkuc3R5bGUoIHRoaXMuZWxlbSwgdGhpcy5wcm9wICk7CgkJdGhpcy5vcHRpb25zLmhpZGUgPSB0cnVlOwoKCQkvLyBCZWdpbiB0aGUgYW5pbWF0aW9uCgkJdGhpcy5jdXN0b20oIHRoaXMuY3VyKCksIDAgKTsKCX0sCgoJLy8gRWFjaCBzdGVwIG9mIGFuIGFuaW1hdGlvbgoJc3RlcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJdmFyIHAsIG4sIGNvbXBsZXRlLAoJCQl0ID0gZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwKCQkJZG9uZSA9IHRydWUsCgkJCWVsZW0gPSB0aGlzLmVsZW0sCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCWlmICggZ290b0VuZCB8fCB0ID49IG9wdGlvbnMuZHVyYXRpb24gKyB0aGlzLnN0YXJ0VGltZSApIHsKCQkJdGhpcy5ub3cgPSB0aGlzLmVuZDsKCQkJdGhpcy5wb3MgPSB0aGlzLnN0YXRlID0gMTsKCQkJdGhpcy51cGRhdGUoKTsKCgkJCW9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzWyB0aGlzLnByb3AgXSA9IHRydWU7CgoJCQlmb3IgKCBwIGluIG9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzICkgewoJCQkJaWYgKCBvcHRpb25zLmFuaW1hdGVkUHJvcGVydGllc1sgcCBdICE9PSB0cnVlICkgewoJCQkJCWRvbmUgPSBmYWxzZTsKCQkJCX0KCQkJfQoKCQkJaWYgKCBkb25lICkgewoJCQkJLy8gUmVzZXQgdGhlIG92ZXJmbG93CgkJCQlpZiAoIG9wdGlvbnMub3ZlcmZsb3cgIT0gbnVsbCAmJiAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHsKCgkJCQkJalF1ZXJ5LmVhY2goIFsgIiIsICJYIiwgIlkiIF0sIGZ1bmN0aW9uKCBpbmRleCwgdmFsdWUgKSB7CgkJCQkJCWVsZW0uc3R5bGVbICJvdmVyZmxvdyIgKyB2YWx1ZSBdID0gb3B0aW9ucy5vdmVyZmxvd1sgaW5kZXggXTsKCQkJCQl9KTsKCQkJCX0KCgkJCQkvLyBIaWRlIHRoZSBlbGVtZW50IGlmIHRoZSAiaGlkZSIgb3BlcmF0aW9uIHdhcyBkb25lCgkJCQlpZiAoIG9wdGlvbnMuaGlkZSApIHsKCQkJCQlqUXVlcnkoIGVsZW0gKS5oaWRlKCk7CgkJCQl9CgoJCQkJLy8gUmVzZXQgdGhlIHByb3BlcnRpZXMsIGlmIHRoZSBpdGVtIGhhcyBiZWVuIGhpZGRlbiBvciBzaG93bgoJCQkJaWYgKCBvcHRpb25zLmhpZGUgfHwgb3B0aW9ucy5zaG93ICkgewoJCQkJCWZvciAoIHAgaW4gb3B0aW9ucy5hbmltYXRlZFByb3BlcnRpZXMgKSB7CgkJCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgcCwgb3B0aW9ucy5vcmlnWyBwIF0gKTsKCQkJCQkJalF1ZXJ5LnJlbW92ZURhdGEoIGVsZW0sICJmeHNob3ciICsgcCwgdHJ1ZSApOwoJCQkJCQkvLyBUb2dnbGUgZGF0YSBpcyBubyBsb25nZXIgbmVlZGVkCgkJCQkJCWpRdWVyeS5yZW1vdmVEYXRhKCBlbGVtLCAidG9nZ2xlIiArIHAsIHRydWUgKTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gRXhlY3V0ZSB0aGUgY29tcGxldGUgZnVuY3Rpb24KCQkJCS8vIGluIHRoZSBldmVudCB0aGF0IHRoZSBjb21wbGV0ZSBmdW5jdGlvbiB0aHJvd3MgYW4gZXhjZXB0aW9uCgkJCQkvLyB3ZSBtdXN0IGVuc3VyZSBpdCB3b24ndCBiZSBjYWxsZWQgdHdpY2UuICM1Njg0CgoJCQkJY29tcGxldGUgPSBvcHRpb25zLmNvbXBsZXRlOwoJCQkJaWYgKCBjb21wbGV0ZSApIHsKCgkJCQkJb3B0aW9ucy5jb21wbGV0ZSA9IGZhbHNlOwoJCQkJCWNvbXBsZXRlLmNhbGwoIGVsZW0gKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGZhbHNlOwoKCQl9IGVsc2UgewoJCQkvLyBjbGFzc2ljYWwgZWFzaW5nIGNhbm5vdCBiZSB1c2VkIHdpdGggYW4gSW5maW5pdHkgZHVyYXRpb24KCQkJaWYgKCBvcHRpb25zLmR1cmF0aW9uID09IEluZmluaXR5ICkgewoJCQkJdGhpcy5ub3cgPSB0OwoJCQl9IGVsc2UgewoJCQkJbiA9IHQgLSB0aGlzLnN0YXJ0VGltZTsKCQkJCXRoaXMuc3RhdGUgPSBuIC8gb3B0aW9ucy5kdXJhdGlvbjsKCgkJCQkvLyBQZXJmb3JtIHRoZSBlYXNpbmcgZnVuY3Rpb24sIGRlZmF1bHRzIHRvIHN3aW5nCgkJCQl0aGlzLnBvcyA9IGpRdWVyeS5lYXNpbmdbIG9wdGlvbnMuYW5pbWF0ZWRQcm9wZXJ0aWVzW3RoaXMucHJvcF0gXSggdGhpcy5zdGF0ZSwgbiwgMCwgMSwgb3B0aW9ucy5kdXJhdGlvbiApOwoJCQkJdGhpcy5ub3cgPSB0aGlzLnN0YXJ0ICsgKCAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHRoaXMucG9zICk7CgkJCX0KCQkJLy8gUGVyZm9ybSB0aGUgbmV4dCBzdGVwIG9mIHRoZSBhbmltYXRpb24KCQkJdGhpcy51cGRhdGUoKTsKCQl9CgoJCXJldHVybiB0cnVlOwoJfQp9OwoKalF1ZXJ5LmV4dGVuZCggalF1ZXJ5LmZ4LCB7Cgl0aWNrOiBmdW5jdGlvbigpIHsKCQl2YXIgdGltZXIsCgkJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJCWkgPSAwOwoKCQlmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7CgkJCXRpbWVyID0gdGltZXJzWyBpIF07CgkJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCQlpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHsKCQkJCXRpbWVycy5zcGxpY2UoIGktLSwgMSApOwoJCQl9CgkJfQoKCQlpZiAoICF0aW1lcnMubGVuZ3RoICkgewoJCQlqUXVlcnkuZnguc3RvcCgpOwoJCX0KCX0sCgoJaW50ZXJ2YWw6IDEzLAoKCXN0b3A6IGZ1bmN0aW9uKCkgewoJCWNsZWFySW50ZXJ2YWwoIHRpbWVySWQgKTsKCQl0aW1lcklkID0gbnVsbDsKCX0sCgoJc3BlZWRzOiB7CgkJc2xvdzogNjAwLAoJCWZhc3Q6IDIwMCwKCQkvLyBEZWZhdWx0IHNwZWVkCgkJX2RlZmF1bHQ6IDQwMAoJfSwKCglzdGVwOiB7CgkJb3BhY2l0eTogZnVuY3Rpb24oIGZ4ICkgewoJCQlqUXVlcnkuc3R5bGUoIGZ4LmVsZW0sICJvcGFjaXR5IiwgZngubm93ICk7CgkJfSwKCgkJX2RlZmF1bHQ6IGZ1bmN0aW9uKCBmeCApIHsKCQkJaWYgKCBmeC5lbGVtLnN0eWxlICYmIGZ4LmVsZW0uc3R5bGVbIGZ4LnByb3AgXSAhPSBudWxsICkgewoJCQkJZnguZWxlbS5zdHlsZVsgZngucHJvcCBdID0gZngubm93ICsgZngudW5pdDsKCQkJfSBlbHNlIHsKCQkJCWZ4LmVsZW1bIGZ4LnByb3AgXSA9IGZ4Lm5vdzsKCQkJfQoJCX0KCX0KfSk7CgovLyBBZGRzIHdpZHRoL2hlaWdodCBzdGVwIGZ1bmN0aW9ucwovLyBEbyBub3Qgc2V0IGFueXRoaW5nIGJlbG93IDAKalF1ZXJ5LmVhY2goWyAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgcHJvcCApIHsKCWpRdWVyeS5meC5zdGVwWyBwcm9wIF0gPSBmdW5jdGlvbiggZnggKSB7CgkJalF1ZXJ5LnN0eWxlKCBmeC5lbGVtLCBwcm9wLCBNYXRoLm1heCgwLCBmeC5ub3cpICsgZngudW5pdCApOwoJfTsKfSk7CgppZiAoIGpRdWVyeS5leHByICYmIGpRdWVyeS5leHByLmZpbHRlcnMgKSB7CglqUXVlcnkuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5ncmVwKGpRdWVyeS50aW1lcnMsIGZ1bmN0aW9uKCBmbiApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGZuLmVsZW07CgkJfSkubGVuZ3RoOwoJfTsKfQoKLy8gVHJ5IHRvIHJlc3RvcmUgdGhlIGRlZmF1bHQgZGlzcGxheSB2YWx1ZSBvZiBhbiBlbGVtZW50CmZ1bmN0aW9uIGRlZmF1bHREaXNwbGF5KCBub2RlTmFtZSApIHsKCglpZiAoICFlbGVtZGlzcGxheVsgbm9kZU5hbWUgXSApIHsKCgkJdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LAoJCQllbGVtID0galF1ZXJ5KCAiPCIgKyBub2RlTmFtZSArICI+IiApLmFwcGVuZFRvKCBib2R5ICksCgkJCWRpc3BsYXkgPSBlbGVtLmNzcyggImRpc3BsYXkiICk7CgkJZWxlbS5yZW1vdmUoKTsKCgkJLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsCgkJLy8gZ2V0IGVsZW1lbnQncyByZWFsIGRlZmF1bHQgZGlzcGxheSBieSBhdHRhY2hpbmcgaXQgdG8gYSB0ZW1wIGlmcmFtZQoJCWlmICggZGlzcGxheSA9PT0gIm5vbmUiIHx8IGRpc3BsYXkgPT09ICIiICkgewoJCQkvLyBObyBpZnJhbWUgdG8gdXNlIHlldCwgc28gY3JlYXRlIGl0CgkJCWlmICggIWlmcmFtZSApIHsKCQkJCWlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpZnJhbWUiICk7CgkJCQlpZnJhbWUuZnJhbWVCb3JkZXIgPSBpZnJhbWUud2lkdGggPSBpZnJhbWUuaGVpZ2h0ID0gMDsKCQkJfQoKCQkJYm9keS5hcHBlbmRDaGlsZCggaWZyYW1lICk7CgoJCQkvLyBDcmVhdGUgYSBjYWNoZWFibGUgY29weSBvZiB0aGUgaWZyYW1lIGRvY3VtZW50IG9uIGZpcnN0IGNhbGwuCgkJCS8vIElFIGFuZCBPcGVyYSB3aWxsIGFsbG93IHVzIHRvIHJldXNlIHRoZSBpZnJhbWVEb2Mgd2l0aG91dCByZS13cml0aW5nIHRoZSBmYWtlIEhUTUwKCQkJLy8gZG9jdW1lbnQgdG8gaXQ7IFdlYktpdCAmIEZpcmVmb3ggd29uJ3QgYWxsb3cgcmV1c2luZyB0aGUgaWZyYW1lIGRvY3VtZW50LgoJCQlpZiAoICFpZnJhbWVEb2MgfHwgIWlmcmFtZS5jcmVhdGVFbGVtZW50ICkgewoJCQkJaWZyYW1lRG9jID0gKCBpZnJhbWUuY29udGVudFdpbmRvdyB8fCBpZnJhbWUuY29udGVudERvY3VtZW50ICkuZG9jdW1lbnQ7CgkJCQlpZnJhbWVEb2Mud3JpdGUoICggZG9jdW1lbnQuY29tcGF0TW9kZSA9PT0gIkNTUzFDb21wYXQiID8gIjwhZG9jdHlwZSBodG1sPiIgOiAiIiApICsgIjxodG1sPjxib2R5PiIgKTsKCQkJCWlmcmFtZURvYy5jbG9zZSgpOwoJCQl9CgoJCQllbGVtID0gaWZyYW1lRG9jLmNyZWF0ZUVsZW1lbnQoIG5vZGVOYW1lICk7CgoJCQlpZnJhbWVEb2MuYm9keS5hcHBlbmRDaGlsZCggZWxlbSApOwoKCQkJZGlzcGxheSA9IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApOwoJCQlib2R5LnJlbW92ZUNoaWxkKCBpZnJhbWUgKTsKCQl9CgoJCS8vIFN0b3JlIHRoZSBjb3JyZWN0IGRlZmF1bHQgZGlzcGxheQoJCWVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTsKCX0KCglyZXR1cm4gZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF07Cn0KCgoKCnZhciBydGFibGUgPSAvXnQoPzphYmxlfGR8aCkkL2ksCglycm9vdCA9IC9eKD86Ym9keXxodG1sKSQvaTsKCmlmICggImdldEJvdW5kaW5nQ2xpZW50UmVjdCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICkgewoJalF1ZXJ5LmZuLm9mZnNldCA9IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCXZhciBlbGVtID0gdGhpc1swXSwgYm94OwoKCQlpZiAoIG9wdGlvbnMgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkub2Zmc2V0LnNldE9mZnNldCggdGhpcywgb3B0aW9ucywgaSApOwoJCQl9KTsKCQl9CgoJCWlmICggIWVsZW0gfHwgIWVsZW0ub3duZXJEb2N1bWVudCApIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlpZiAoIGVsZW0gPT09IGVsZW0ub3duZXJEb2N1bWVudC5ib2R5ICkgewoJCQlyZXR1cm4galF1ZXJ5Lm9mZnNldC5ib2R5T2Zmc2V0KCBlbGVtICk7CgkJfQoKCQl0cnkgewoJCQlib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCX0gY2F0Y2goZSkge30KCgkJdmFyIGRvYyA9IGVsZW0ub3duZXJEb2N1bWVudCwKCQkJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJCS8vIE1ha2Ugc3VyZSB3ZSdyZSBub3QgZGVhbGluZyB3aXRoIGEgZGlzY29ubmVjdGVkIERPTSBub2RlCgkJaWYgKCAhYm94IHx8ICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQkJcmV0dXJuIGJveCA/IHsgdG9wOiBib3gudG9wLCBsZWZ0OiBib3gubGVmdCB9IDogeyB0b3A6IDAsIGxlZnQ6IDAgfTsKCQl9CgoJCXZhciBib2R5ID0gZG9jLmJvZHksCgkJCXdpbiA9IGdldFdpbmRvdyhkb2MpLAoJCQljbGllbnRUb3AgID0gZG9jRWxlbS5jbGllbnRUb3AgIHx8IGJvZHkuY2xpZW50VG9wICB8fCAwLAoJCQljbGllbnRMZWZ0ID0gZG9jRWxlbS5jbGllbnRMZWZ0IHx8IGJvZHkuY2xpZW50TGVmdCB8fCAwLAoJCQlzY3JvbGxUb3AgID0gd2luLnBhZ2VZT2Zmc2V0IHx8IGpRdWVyeS5zdXBwb3J0LmJveE1vZGVsICYmIGRvY0VsZW0uc2Nyb2xsVG9wICB8fCBib2R5LnNjcm9sbFRvcCwKCQkJc2Nyb2xsTGVmdCA9IHdpbi5wYWdlWE9mZnNldCB8fCBqUXVlcnkuc3VwcG9ydC5ib3hNb2RlbCAmJiBkb2NFbGVtLnNjcm9sbExlZnQgfHwgYm9keS5zY3JvbGxMZWZ0LAoJCQl0b3AgID0gYm94LnRvcCAgKyBzY3JvbGxUb3AgIC0gY2xpZW50VG9wLAoJCQlsZWZ0ID0gYm94LmxlZnQgKyBzY3JvbGxMZWZ0IC0gY2xpZW50TGVmdDsKCgkJcmV0dXJuIHsgdG9wOiB0b3AsIGxlZnQ6IGxlZnQgfTsKCX07Cgp9IGVsc2UgewoJalF1ZXJ5LmZuLm9mZnNldCA9IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCXZhciBlbGVtID0gdGhpc1swXTsKCgkJaWYgKCBvcHRpb25zICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5Lm9mZnNldC5zZXRPZmZzZXQoIHRoaXMsIG9wdGlvbnMsIGkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoICFlbGVtIHx8ICFlbGVtLm93bmVyRG9jdW1lbnQgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJaWYgKCBlbGVtID09PSBlbGVtLm93bmVyRG9jdW1lbnQuYm9keSApIHsKCQkJcmV0dXJuIGpRdWVyeS5vZmZzZXQuYm9keU9mZnNldCggZWxlbSApOwoJCX0KCgkJdmFyIGNvbXB1dGVkU3R5bGUsCgkJCW9mZnNldFBhcmVudCA9IGVsZW0ub2Zmc2V0UGFyZW50LAoJCQlwcmV2T2Zmc2V0UGFyZW50ID0gZWxlbSwKCQkJZG9jID0gZWxlbS5vd25lckRvY3VtZW50LAoJCQlkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudCwKCQkJYm9keSA9IGRvYy5ib2R5LAoJCQlkZWZhdWx0VmlldyA9IGRvYy5kZWZhdWx0VmlldywKCQkJcHJldkNvbXB1dGVkU3R5bGUgPSBkZWZhdWx0VmlldyA/IGRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKSA6IGVsZW0uY3VycmVudFN0eWxlLAoJCQl0b3AgPSBlbGVtLm9mZnNldFRvcCwKCQkJbGVmdCA9IGVsZW0ub2Zmc2V0TGVmdDsKCgkJd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbSAhPT0gYm9keSAmJiBlbGVtICE9PSBkb2NFbGVtICkgewoJCQlpZiAoIGpRdWVyeS5zdXBwb3J0LmZpeGVkUG9zaXRpb24gJiYgcHJldkNvbXB1dGVkU3R5bGUucG9zaXRpb24gPT09ICJmaXhlZCIgKSB7CgkJCQlicmVhazsKCQkJfQoKCQkJY29tcHV0ZWRTdHlsZSA9IGRlZmF1bHRWaWV3ID8gZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtLCBudWxsKSA6IGVsZW0uY3VycmVudFN0eWxlOwoJCQl0b3AgIC09IGVsZW0uc2Nyb2xsVG9wOwoJCQlsZWZ0IC09IGVsZW0uc2Nyb2xsTGVmdDsKCgkJCWlmICggZWxlbSA9PT0gb2Zmc2V0UGFyZW50ICkgewoJCQkJdG9wICArPSBlbGVtLm9mZnNldFRvcDsKCQkJCWxlZnQgKz0gZWxlbS5vZmZzZXRMZWZ0OwoKCQkJCWlmICggalF1ZXJ5LnN1cHBvcnQuZG9lc05vdEFkZEJvcmRlciAmJiAhKGpRdWVyeS5zdXBwb3J0LmRvZXNBZGRCb3JkZXJGb3JUYWJsZUFuZENlbGxzICYmIHJ0YWJsZS50ZXN0KGVsZW0ubm9kZU5hbWUpKSApIHsKCQkJCQl0b3AgICs9IHBhcnNlRmxvYXQoIGNvbXB1dGVkU3R5bGUuYm9yZGVyVG9wV2lkdGggICkgfHwgMDsKCQkJCQlsZWZ0ICs9IHBhcnNlRmxvYXQoIGNvbXB1dGVkU3R5bGUuYm9yZGVyTGVmdFdpZHRoICkgfHwgMDsKCQkJCX0KCgkJCQlwcmV2T2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50OwoJCQkJb2Zmc2V0UGFyZW50ID0gZWxlbS5vZmZzZXRQYXJlbnQ7CgkJCX0KCgkJCWlmICggalF1ZXJ5LnN1cHBvcnQuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlICYmIGNvbXB1dGVkU3R5bGUub3ZlcmZsb3cgIT09ICJ2aXNpYmxlIiApIHsKCQkJCXRvcCAgKz0gcGFyc2VGbG9hdCggY29tcHV0ZWRTdHlsZS5ib3JkZXJUb3BXaWR0aCAgKSB8fCAwOwoJCQkJbGVmdCArPSBwYXJzZUZsb2F0KCBjb21wdXRlZFN0eWxlLmJvcmRlckxlZnRXaWR0aCApIHx8IDA7CgkJCX0KCgkJCXByZXZDb21wdXRlZFN0eWxlID0gY29tcHV0ZWRTdHlsZTsKCQl9CgoJCWlmICggcHJldkNvbXB1dGVkU3R5bGUucG9zaXRpb24gPT09ICJyZWxhdGl2ZSIgfHwgcHJldkNvbXB1dGVkU3R5bGUucG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQl0b3AgICs9IGJvZHkub2Zmc2V0VG9wOwoJCQlsZWZ0ICs9IGJvZHkub2Zmc2V0TGVmdDsKCQl9CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuZml4ZWRQb3NpdGlvbiAmJiBwcmV2Q29tcHV0ZWRTdHlsZS5wb3NpdGlvbiA9PT0gImZpeGVkIiApIHsKCQkJdG9wICArPSBNYXRoLm1heCggZG9jRWxlbS5zY3JvbGxUb3AsIGJvZHkuc2Nyb2xsVG9wICk7CgkJCWxlZnQgKz0gTWF0aC5tYXgoIGRvY0VsZW0uc2Nyb2xsTGVmdCwgYm9keS5zY3JvbGxMZWZ0ICk7CgkJfQoKCQlyZXR1cm4geyB0b3A6IHRvcCwgbGVmdDogbGVmdCB9OwoJfTsKfQoKalF1ZXJ5Lm9mZnNldCA9IHsKCglib2R5T2Zmc2V0OiBmdW5jdGlvbiggYm9keSApIHsKCQl2YXIgdG9wID0gYm9keS5vZmZzZXRUb3AsCgkJCWxlZnQgPSBib2R5Lm9mZnNldExlZnQ7CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQgKSB7CgkJCXRvcCAgKz0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyhib2R5LCAibWFyZ2luVG9wIikgKSB8fCAwOwoJCQlsZWZ0ICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoYm9keSwgIm1hcmdpbkxlZnQiKSApIHx8IDA7CgkJfQoKCQlyZXR1cm4geyB0b3A6IHRvcCwgbGVmdDogbGVmdCB9OwoJfSwKCglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCXZhciBjdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCksCgkJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICksCgkJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKSwKCQkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYgalF1ZXJ5LmluQXJyYXkoImF1dG8iLCBbY3VyQ1NTVG9wLCBjdXJDU1NMZWZ0XSkgPiAtMSwKCQkJcHJvcHMgPSB7fSwgY3VyUG9zaXRpb24gPSB7fSwgY3VyVG9wLCBjdXJMZWZ0OwoKCQkvLyBuZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlciB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoKCXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzWzBdICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCXZhciBlbGVtID0gdGhpc1swXSwKCgkJLy8gR2V0ICpyZWFsKiBvZmZzZXRQYXJlbnQKCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpLAoKCQkvLyBHZXQgY29ycmVjdCBvZmZzZXRzCgkJb2Zmc2V0ICAgICAgID0gdGhpcy5vZmZzZXQoKSwKCQlwYXJlbnRPZmZzZXQgPSBycm9vdC50ZXN0KG9mZnNldFBhcmVudFswXS5ub2RlTmFtZSkgPyB7IHRvcDogMCwgbGVmdDogMCB9IDogb2Zmc2V0UGFyZW50Lm9mZnNldCgpOwoKCQkvLyBTdWJ0cmFjdCBlbGVtZW50IG1hcmdpbnMKCQkvLyBub3RlOiB3aGVuIGFuIGVsZW1lbnQgaGFzIG1hcmdpbjogYXV0byB0aGUgb2Zmc2V0TGVmdCBhbmQgbWFyZ2luTGVmdAoJCS8vIGFyZSB0aGUgc2FtZSBpbiBTYWZhcmkgY2F1c2luZyBvZmZzZXQubGVmdCB0byBpbmNvcnJlY3RseSBiZSAwCgkJb2Zmc2V0LnRvcCAgLT0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyhlbGVtLCAibWFyZ2luVG9wIikgKSB8fCAwOwoJCW9mZnNldC5sZWZ0IC09IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoZWxlbSwgIm1hcmdpbkxlZnQiKSApIHx8IDA7CgoJCS8vIEFkZCBvZmZzZXRQYXJlbnQgYm9yZGVycwoJCXBhcmVudE9mZnNldC50b3AgICs9IHBhcnNlRmxvYXQoIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50WzBdLCAiYm9yZGVyVG9wV2lkdGgiKSApIHx8IDA7CgkJcGFyZW50T2Zmc2V0LmxlZnQgKz0gcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyhvZmZzZXRQYXJlbnRbMF0sICJib3JkZXJMZWZ0V2lkdGgiKSApIHx8IDA7CgoJCS8vIFN1YnRyYWN0IHRoZSB0d28gb2Zmc2V0cwoJCXJldHVybiB7CgkJCXRvcDogIG9mZnNldC50b3AgIC0gcGFyZW50T2Zmc2V0LnRvcCwKCQkJbGVmdDogb2Zmc2V0LmxlZnQgLSBwYXJlbnRPZmZzZXQubGVmdAoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQl2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuYm9keTsKCQkJd2hpbGUgKCBvZmZzZXRQYXJlbnQgJiYgKCFycm9vdC50ZXN0KG9mZnNldFBhcmVudC5ub2RlTmFtZSkgJiYgalF1ZXJ5LmNzcyhvZmZzZXRQYXJlbnQsICJwb3NpdGlvbiIpID09PSAic3RhdGljIikgKSB7CgkJCQlvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50OwoJCQl9CgkJCXJldHVybiBvZmZzZXRQYXJlbnQ7CgkJfSk7Cgl9Cn0pOwoKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCggWyJMZWZ0IiwgIlRvcCJdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCXZhciBtZXRob2QgPSAic2Nyb2xsIiArIG5hbWU7CgoJalF1ZXJ5LmZuWyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB2YWwgKSB7CgkJdmFyIGVsZW0sIHdpbjsKCgkJaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsKCQkJZWxlbSA9IHRoaXNbIDAgXTsKCgkJCWlmICggIWVsZW0gKSB7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoKCQkJd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQkvLyBSZXR1cm4gdGhlIHNjcm9sbCBvZmZzZXQKCQkJcmV0dXJuIHdpbiA/ICgicGFnZVhPZmZzZXQiIGluIHdpbikgPyB3aW5bIGkgPyAicGFnZVlPZmZzZXQiIDogInBhZ2VYT2Zmc2V0IiBdIDoKCQkJCWpRdWVyeS5zdXBwb3J0LmJveE1vZGVsICYmIHdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbIG1ldGhvZCBdIHx8CgkJCQkJd2luLmRvY3VtZW50LmJvZHlbIG1ldGhvZCBdIDoKCQkJCWVsZW1bIG1ldGhvZCBdOwoJCX0KCgkJLy8gU2V0IHRoZSBzY3JvbGwgb2Zmc2V0CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJd2luID0gZ2V0V2luZG93KCB0aGlzICk7CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhaSA/IHZhbCA6IGpRdWVyeSggd2luICkuc2Nyb2xsTGVmdCgpLAoJCQkJCSBpID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQl0aGlzWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0pOwoJfTsKfSk7CgpmdW5jdGlvbiBnZXRXaW5kb3coIGVsZW0gKSB7CglyZXR1cm4galF1ZXJ5LmlzV2luZG93KCBlbGVtICkgPwoJCWVsZW0gOgoJCWVsZW0ubm9kZVR5cGUgPT09IDkgPwoJCQllbGVtLmRlZmF1bHRWaWV3IHx8IGVsZW0ucGFyZW50V2luZG93IDoKCQkJZmFsc2U7Cn0KCgoKCi8vIENyZWF0ZSB3aWR0aCwgaGVpZ2h0LCBpbm5lckhlaWdodCwgaW5uZXJXaWR0aCwgb3V0ZXJIZWlnaHQgYW5kIG91dGVyV2lkdGggbWV0aG9kcwpqUXVlcnkuZWFjaChbICJIZWlnaHQiLCAiV2lkdGgiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCXZhciB0eXBlID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoKCS8vIGlubmVySGVpZ2h0IGFuZCBpbm5lcldpZHRoCglqUXVlcnkuZm5bICJpbm5lciIgKyBuYW1lIF0gPSBmdW5jdGlvbigpIHsKCQl2YXIgZWxlbSA9IHRoaXNbMF07CgkJcmV0dXJuIGVsZW0gPwoJCQllbGVtLnN0eWxlID8KCQkJcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgdHlwZSwgInBhZGRpbmciICkgKSA6CgkJCXRoaXNbIHR5cGUgXSgpIDoKCQkJbnVsbDsKCX07CgoJLy8gb3V0ZXJIZWlnaHQgYW5kIG91dGVyV2lkdGgKCWpRdWVyeS5mblsgIm91dGVyIiArIG5hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4gKSB7CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCXJldHVybiBlbGVtID8KCQkJZWxlbS5zdHlsZSA/CgkJCXBhcnNlRmxvYXQoIGpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIG1hcmdpbiA/ICJtYXJnaW4iIDogImJvcmRlciIgKSApIDoKCQkJdGhpc1sgdHlwZSBdKCkgOgoJCQludWxsOwoJfTsKCglqUXVlcnkuZm5bIHR5cGUgXSA9IGZ1bmN0aW9uKCBzaXplICkgewoJCS8vIEdldCB3aW5kb3cgd2lkdGggb3IgaGVpZ2h0CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCWlmICggIWVsZW0gKSB7CgkJCXJldHVybiBzaXplID09IG51bGwgPyBudWxsIDogdGhpczsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNpemUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICk7CgkJCQlzZWxmWyB0eXBlIF0oIHNpemUuY2FsbCggdGhpcywgaSwgc2VsZlsgdHlwZSBdKCkgKSApOwoJCQl9KTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7CgkJCS8vIEV2ZXJ5b25lIGVsc2UgdXNlIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCBvciBkb2N1bWVudC5ib2R5IGRlcGVuZGluZyBvbiBRdWlya3MgdnMgU3RhbmRhcmRzIG1vZGUKCQkJLy8gM3JkIGNvbmRpdGlvbiBhbGxvd3MgTm9raWEgc3VwcG9ydCwgYXMgaXQgc3VwcG9ydHMgdGhlIGRvY0VsZW0gcHJvcCBidXQgbm90IENTUzFDb21wYXQKCQkJdmFyIGRvY0VsZW1Qcm9wID0gZWxlbS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbICJjbGllbnQiICsgbmFtZSBdLAoJCQkJYm9keSA9IGVsZW0uZG9jdW1lbnQuYm9keTsKCQkJcmV0dXJuIGVsZW0uZG9jdW1lbnQuY29tcGF0TW9kZSA9PT0gIkNTUzFDb21wYXQiICYmIGRvY0VsZW1Qcm9wIHx8CgkJCQlib2R5ICYmIGJvZHlbICJjbGllbnQiICsgbmFtZSBdIHx8IGRvY0VsZW1Qcm9wOwoKCQkvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0CgkJfSBlbHNlIGlmICggZWxlbS5ub2RlVHlwZSA9PT0gOSApIHsKCQkJLy8gRWl0aGVyIHNjcm9sbFtXaWR0aC9IZWlnaHRdIG9yIG9mZnNldFtXaWR0aC9IZWlnaHRdLCB3aGljaGV2ZXIgaXMgZ3JlYXRlcgoJCQlyZXR1cm4gTWF0aC5tYXgoCgkJCQllbGVtLmRvY3VtZW50RWxlbWVudFsiY2xpZW50IiArIG5hbWVdLAoJCQkJZWxlbS5ib2R5WyJzY3JvbGwiICsgbmFtZV0sIGVsZW0uZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiICsgbmFtZV0sCgkJCQllbGVtLmJvZHlbIm9mZnNldCIgKyBuYW1lXSwgZWxlbS5kb2N1bWVudEVsZW1lbnRbIm9mZnNldCIgKyBuYW1lXQoJCQkpOwoKCQkvLyBHZXQgb3Igc2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudAoJCX0gZWxzZSBpZiAoIHNpemUgPT09IHVuZGVmaW5lZCApIHsKCQkJdmFyIG9yaWcgPSBqUXVlcnkuY3NzKCBlbGVtLCB0eXBlICksCgkJCQlyZXQgPSBwYXJzZUZsb2F0KCBvcmlnICk7CgoJCQlyZXR1cm4galF1ZXJ5LmlzTnVtZXJpYyggcmV0ICkgPyByZXQgOiBvcmlnOwoKCQkvLyBTZXQgdGhlIHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCAoZGVmYXVsdCB0byBwaXhlbHMgaWYgdmFsdWUgaXMgdW5pdGxlc3MpCgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuY3NzKCB0eXBlLCB0eXBlb2Ygc2l6ZSA9PT0gInN0cmluZyIgPyBzaXplIDogc2l6ZSArICJweCIgKTsKCQl9Cgl9OwoKfSk7CgoKCgovLyBFeHBvc2UgalF1ZXJ5IHRvIHRoZSBnbG9iYWwgb2JqZWN0CndpbmRvdy5qUXVlcnkgPSB3aW5kb3cuJCA9IGpRdWVyeTsKCi8vIEV4cG9zZSBqUXVlcnkgYXMgYW4gQU1EIG1vZHVsZSwgYnV0IG9ubHkgZm9yIEFNRCBsb2FkZXJzIHRoYXQKLy8gdW5kZXJzdGFuZCB0aGUgaXNzdWVzIHdpdGggbG9hZGluZyBtdWx0aXBsZSB2ZXJzaW9ucyBvZiBqUXVlcnkKLy8gaW4gYSBwYWdlIHRoYXQgYWxsIG1pZ2h0IGNhbGwgZGVmaW5lKCkuIFRoZSBsb2FkZXIgd2lsbCBpbmRpY2F0ZQovLyB0aGV5IGhhdmUgc3BlY2lhbCBhbGxvd2FuY2VzIGZvciBtdWx0aXBsZSBqUXVlcnkgdmVyc2lvbnMgYnkKLy8gc3BlY2lmeWluZyBkZWZpbmUuYW1kLmpRdWVyeSA9IHRydWUuIFJlZ2lzdGVyIGFzIGEgbmFtZWQgbW9kdWxlLAovLyBzaW5jZSBqUXVlcnkgY2FuIGJlIGNvbmNhdGVuYXRlZCB3aXRoIG90aGVyIGZpbGVzIHRoYXQgbWF5IHVzZSBkZWZpbmUsCi8vIGJ1dCBub3QgdXNlIGEgcHJvcGVyIGNvbmNhdGVuYXRpb24gc2NyaXB0IHRoYXQgdW5kZXJzdGFuZHMgYW5vbnltb3VzCi8vIEFNRCBtb2R1bGVzLiBBIG5hbWVkIEFNRCBpcyBzYWZlc3QgYW5kIG1vc3Qgcm9idXN0IHdheSB0byByZWdpc3Rlci4KLy8gTG93ZXJjYXNlIGpxdWVyeSBpcyB1c2VkIGJlY2F1c2UgQU1EIG1vZHVsZSBuYW1lcyBhcmUgZGVyaXZlZCBmcm9tCi8vIGZpbGUgbmFtZXMsIGFuZCBqUXVlcnkgaXMgbm9ybWFsbHkgZGVsaXZlcmVkIGluIGEgbG93ZXJjYXNlIGZpbGUgbmFtZS4KLy8gRG8gdGhpcyBhZnRlciBjcmVhdGluZyB0aGUgZ2xvYmFsIHNvIHRoYXQgaWYgYW4gQU1EIG1vZHVsZSB3YW50cyB0byBjYWxsCi8vIG5vQ29uZmxpY3QgdG8gaGlkZSB0aGlzIHZlcnNpb24gb2YgalF1ZXJ5LCBpdCB3aWxsIHdvcmsuCmlmICggdHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kICYmIGRlZmluZS5hbWQualF1ZXJ5ICkgewoJZGVmaW5lKCAianF1ZXJ5IiwgW10sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGpRdWVyeTsgfSApOwp9CgoKCn0pKCB3aW5kb3cgKTsK", "content_type": "application/javascript"}, "assets/css/todos.css": {"data": "aHRtbCwgYm9keSwgZGl2LCBzcGFuLCBhcHBsZXQsIG9iamVjdCwgaWZyYW1lLApoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBwLCBibG9ja3F1b3RlLCBwcmUsCmEsIGFiYnIsIGFjcm9ueW0sIGFkZHJlc3MsIGJpZywgY2l0ZSwgY29kZSwKZGVsLCBkZm4sIGVtLCBmb250LCBpbWcsIGlucywga2JkLCBxLCBzLCBzYW1wLApzbWFsbCwgc3RyaWtlLCBzdHJvbmcsIHN1Yiwgc3VwLCB0dCwgdmFyLApkbCwgZHQsIGRkLCBvbCwgdWwsIGxpLApmaWVsZHNldCwgZm9ybSwgbGFiZWwsIGxlZ2VuZCwKdGFibGUsIGNhcHRpb24sIHRib2R5LCB0Zm9vdCwgdGhlYWQsIHRyLCB0aCwgdGQgewoJbWFyZ2luOiAwOwoJcGFkZGluZzogMDsKCWJvcmRlcjogMDsKCW91dGxpbmU6IDA7Cglmb250LXdlaWdodDogaW5oZXJpdDsKCWZvbnQtc3R5bGU6IGluaGVyaXQ7Cglmb250LXNpemU6IDEwMCU7Cglmb250LWZhbWlseTogaW5oZXJpdDsKCXZlcnRpY2FsLWFsaWduOiBiYXNlbGluZTsKfQpib2R5IHsKCWxpbmUtaGVpZ2h0OiAxOwoJY29sb3I6IGJsYWNrOwoJYmFja2dyb3VuZDogd2hpdGU7Cn0Kb2wsIHVsIHsKCWxpc3Qtc3R5bGU6IG5vbmU7Cn0KYSBpbWcgewoJYm9yZGVyOiBub25lOwp9CgpodG1sIHsKCWJhY2tncm91bmQ6ICNlZWVlZWU7Cn0KYm9keSB7Cglmb250LWZhbWlseTogIkhlbHZldGljYSBOZXVlIiwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKCWZvbnQtc2l6ZTogMTRweDsKCWxpbmUtaGVpZ2h0OiAxLjRlbTsKCWJhY2tncm91bmQ6ICNlZWVlZWU7Cgljb2xvcjogIzMzMzMzMzsKfQoKI3RvZG9hcHAgewoJd2lkdGg6IDQ4MHB4OwoJbWFyZ2luOiAwIGF1dG8gNDBweDsKCWJhY2tncm91bmQ6IHdoaXRlOwoJcGFkZGluZzogMjBweDsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgNXB4IDZweCAwOwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCA1cHggNnB4IDA7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCA1cHggNnB4IDA7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCA1cHggNnB4IDA7Cn0KI3RvZG9hcHAgaDEgewoJZm9udC1zaXplOiAzNnB4OwoJZm9udC13ZWlnaHQ6IGJvbGQ7Cgl0ZXh0LWFsaWduOiBjZW50ZXI7CglwYWRkaW5nOiAyMHB4IDAgMzBweCAwOwoJbGluZS1oZWlnaHQ6IDE7Cn0KCiNjcmVhdGUtdG9kbyB7Cglwb3NpdGlvbjogcmVsYXRpdmU7Cn0KI2NyZWF0ZS10b2RvIGlucHV0IHsKCXdpZHRoOiA0NjZweDsKCWZvbnQtc2l6ZTogMjRweDsKCWZvbnQtZmFtaWx5OiBpbmhlcml0OwoJbGluZS1oZWlnaHQ6IDEuNGVtOwoJYm9yZGVyOiAwOwoJb3V0bGluZTogbm9uZTsKCXBhZGRpbmc6IDZweDsKCWJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0Owp9CgojY3JlYXRlLXRvZG8gc3BhbiB7Cglwb3NpdGlvbjogYWJzb2x1dGU7Cgl6LWluZGV4OiA5OTk7Cgl3aWR0aDogMTcwcHg7CglsZWZ0OiA1MCU7CgltYXJnaW4tbGVmdDogLTg1cHg7Cn0KCiN0b2RvLWxpc3QgewoJbWFyZ2luLXRvcDogMTBweDsKfQojdG9kby1saXN0IGxpIHsKCXBhZGRpbmc6IDEycHggMjBweCAxMXB4IDA7Cglwb3NpdGlvbjogcmVsYXRpdmU7Cglmb250LXNpemU6IDI0cHg7CglsaW5lLWhlaWdodDogMS4xZW07Cglib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NjY2NjYzsKfQojdG9kby1saXN0IGxpOmFmdGVyIHsKCWNvbnRlbnQ6ICJcMDAyMCI7CglkaXNwbGF5OiBibG9jazsKCWhlaWdodDogMDsKCWNsZWFyOiBib3RoOwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXZpc2liaWxpdHk6IGhpZGRlbjsKfQojdG9kby1saXN0IGxpLmVkaXRpbmcgewoJcGFkZGluZzogMDsKCWJvcmRlci1ib3R0b206IDA7Cn0KI3RvZG8tbGlzdCAuZWRpdGluZyAuZGlzcGxheSwKI3RvZG8tbGlzdCAuZWRpdCB7CglkaXNwbGF5OiBub25lOwp9CiN0b2RvLWxpc3QgLmVkaXRpbmcgLmVkaXQgewoJZGlzcGxheTogYmxvY2s7Cn0KI3RvZG8tbGlzdCAuZWRpdGluZyBpbnB1dCB7Cgl3aWR0aDogNDQ0cHg7Cglmb250LXNpemU6IDI0cHg7Cglmb250LWZhbWlseTogaW5oZXJpdDsKCW1hcmdpbjogMDsKCWxpbmUtaGVpZ2h0OiAxLjZlbTsKCWJvcmRlcjogMDsKCW91dGxpbmU6IG5vbmU7CglwYWRkaW5nOiAxMHB4IDdweCAwcHggMjdweDsKCWJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0Owp9CiN0b2RvLWxpc3QgLmNoZWNrIHsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCXRvcDogOXB4OwoJbWFyZ2luOiAwIDEwcHggMCA3cHg7CglmbG9hdDogbGVmdDsKfQojdG9kby1saXN0IC5kb25lIC50b2RvLWNvbnRlbnQgewoJdGV4dC1kZWNvcmF0aW9uOiBsaW5lLXRocm91Z2g7Cgljb2xvcjogIzc3Nzc3NzsKfQojdG9kby1saXN0IC50b2RvLWRlc3Ryb3kgewoJcG9zaXRpb246IGFic29sdXRlOwoJcmlnaHQ6IDVweDsKCXRvcDogMTRweDsKCWRpc3BsYXk6IG5vbmU7CgljdXJzb3I6IHBvaW50ZXI7Cgl3aWR0aDogMjBweDsKCWhlaWdodDogMjBweDsKCWJhY2tncm91bmQ6IHVybChkZXN0cm95LnBuZykgbm8tcmVwZWF0IDAgMDsKfQojdG9kby1saXN0IGxpOmhvdmVyIC50b2RvLWRlc3Ryb3kgewoJZGlzcGxheTogYmxvY2s7Cn0KI3RvZG8tbGlzdCAudG9kby1kZXN0cm95OmhvdmVyIHsKCWJhY2tncm91bmQtcG9zaXRpb246IDAgLTIwcHg7Cn0KCiN0b2RvLXN0YXRzIHsKCSp6b29tOiAxOwoJbWFyZ2luLXRvcDogMTBweDsKCWNvbG9yOiAjNzc3Nzc3Owp9CiN0b2RvLXN0YXRzOmFmdGVyIHsKCWNvbnRlbnQ6ICJcMDAyMCI7CglkaXNwbGF5OiBibG9jazsKCWhlaWdodDogMDsKCWNsZWFyOiBib3RoOwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXZpc2liaWxpdHk6IGhpZGRlbjsKfQojdG9kby1zdGF0cyAudG9kby1jb3VudCB7CglmbG9hdDogbGVmdDsKfQojdG9kby1zdGF0cyAudG9kby1jb3VudCAubnVtYmVyIHsKCWZvbnQtd2VpZ2h0OiBib2xkOwoJY29sb3I6ICMzMzMzMzM7Cn0KI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgewoJZmxvYXQ6IHJpZ2h0Owp9CiN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGEgewoJY29sb3I6ICM3Nzc3Nzc7Cglmb250LXNpemU6IDEycHg7Cn0KI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgYTp2aXNpdGVkIHsKCWNvbG9yOiAjNzc3Nzc3Owp9CiN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGE6aG92ZXIgewoJY29sb3I6ICMzMzY2OTk7Cn0KCiNpbnN0cnVjdGlvbnMgewoJd2lkdGg6IDUyMHB4OwoJbWFyZ2luOiAxMHB4IGF1dG87Cgljb2xvcjogIzc3Nzc3NzsKCXRleHQtc2hhZG93OiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCkgMCAxcHggMDsKCXRleHQtYWxpZ246IGNlbnRlcjsKfQojaW5zdHJ1Y3Rpb25zIGEgewoJY29sb3I6ICMzMzY2OTk7Cn0KCiNjcmVkaXRzIHsKCXdpZHRoOiA1MjBweDsKCW1hcmdpbjogMzBweCBhdXRvOwoJY29sb3I6ICM5OTk7Cgl0ZXh0LXNoYWRvdzogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIDAgMXB4IDA7Cgl0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KI2NyZWRpdHMgYSB7Cgljb2xvcjogIzg4ODsKfQoKCi8qCiogIEZyYW7Dp29pcyAnY2Fobm9yeScgR2VybWFpbgoqLwoudWktdG9vbHRpcCwgLnVpLXRvb2x0aXAtdG9wLCAudWktdG9vbHRpcC1yaWdodCwgLnVpLXRvb2x0aXAtYm90dG9tLCAudWktdG9vbHRpcC1sZWZ0IHsKCWNvbG9yOiNmZmZmZmY7CgljdXJzb3I6bm9ybWFsOwoJZGlzcGxheTotbW96LWlubGluZS1zdGFjazsKCWRpc3BsYXk6aW5saW5lLWJsb2NrOwoJZm9udC1zaXplOjEycHg7Cglmb250LWZhbWlseTphcmlhbDsKCXBhZGRpbmc6LjVlbSAxZW07Cglwb3NpdGlvbjpyZWxhdGl2ZTsKCXRleHQtYWxpZ246Y2VudGVyOwoJdGV4dC1zaGFkb3c6MCAtMXB4IDFweCAjMTExMTExOwoJLXdlYmtpdC1ib3JkZXItdG9wLWxlZnQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjRweCA7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6NHB4IDsKCS1raHRtbC1ib3JkZXItdG9wLWxlZnQtcmFkaXVzOjRweCA7Cgkta2h0bWwtYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6NHB4IDsKCS1raHRtbC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czo0cHggOwoJLWtodG1sLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6NHB4IDsKCS1tb3otYm9yZGVyLXJhZGl1cy10b3BsZWZ0OjRweCA7CgktbW96LWJvcmRlci1yYWRpdXMtdG9wcmlnaHQ6NHB4IDsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDo0cHggOwoJLW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6NHB4IDsKCWJvcmRlci10b3AtbGVmdC1yYWRpdXM6NHB4IDsKCWJvcmRlci10b3AtcmlnaHQtcmFkaXVzOjRweCA7Cglib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czo0cHggOwoJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czo0cHggOwoJLW8tYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCS1tb3otYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCS1raHRtbC1ib3gtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwLCBpbnNldCAwIDAgMCAxcHggIzIyMjIyMiwgaW5zZXQgMCAycHggIzY2NjY2NiwgaW5zZXQgMCAtMnB4IDJweCAjNDQ0NDQ0OwoJLXdlYmtpdC1ib3gtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwLCBpbnNldCAwIDAgMCAxcHggIzIyMjIyMiwgaW5zZXQgMCAycHggIzY2NjY2NiwgaW5zZXQgMCAtMnB4IDJweCAjNDQ0NDQ0OwoJYm94LXNoYWRvdzowIDFweCAycHggIzAwMDAwMCwgaW5zZXQgMCAwIDAgMXB4ICMyMjIyMjIsIGluc2V0IDAgMnB4ICM2NjY2NjYsIGluc2V0IDAgLTJweCAycHggIzQ0NDQ0NDsKCWJhY2tncm91bmQtY29sb3I6IzNiM2IzYjsKCWJhY2tncm91bmQtaW1hZ2U6LW1vei1saW5lYXItZ3JhZGllbnQodG9wLCM1NTU1NTUsIzIyMjIyMik7CgliYWNrZ3JvdW5kLWltYWdlOi13ZWJraXQtZ3JhZGllbnQobGluZWFyLGxlZnQgdG9wLGxlZnQgYm90dG9tLGNvbG9yLXN0b3AoMCwjNTU1NTU1KSxjb2xvci1zdG9wKDEsIzIyMjIyMikpOwoJZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yU3RyPSM1NTU1NTUsRW5kQ29sb3JTdHI9IzIyMjIyMik7CgktbXMtZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yU3RyPSM1NTU1NTUsRW5kQ29sb3JTdHI9IzIyMjIyMik7Cn0KLnVpLXRvb2x0aXA6YWZ0ZXIsIC51aS10b29sdGlwLXRvcDphZnRlciwgLnVpLXRvb2x0aXAtcmlnaHQ6YWZ0ZXIsIC51aS10b29sdGlwLWJvdHRvbTphZnRlciwgLnVpLXRvb2x0aXAtbGVmdDphZnRlciB7Cgljb250ZW50OiJcMjVCOCI7CglkaXNwbGF5OmJsb2NrOwoJZm9udC1zaXplOjJlbTsKCWhlaWdodDowOwoJbGluZS1oZWlnaHQ6MDsKCXBvc2l0aW9uOmFic29sdXRlOwp9Ci51aS10b29sdGlwOmFmdGVyLCAudWktdG9vbHRpcC1ib3R0b206YWZ0ZXIgewoJY29sb3I6IzJhMmEyYTsKCWJvdHRvbTowOwoJbGVmdDoxcHg7Cgl0ZXh0LWFsaWduOmNlbnRlcjsKCXRleHQtc2hhZG93OjFweCAwIDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSg5MGRlZyk7CgktbW96LXRyYW5zZm9ybTpyb3RhdGUoOTBkZWcpOwoJLWtodG1sLXRyYW5zZm9ybTpyb3RhdGUoOTBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDkwZGVnKTsKCXdpZHRoOjEwMCU7Cn0KLnVpLXRvb2x0aXAtdG9wOmFmdGVyIHsKCWJvdHRvbTphdXRvOwoJY29sb3I6IzRmNGY0ZjsKCWxlZnQ6LTJweDsKCXRvcDowOwoJdGV4dC1hbGlnbjpjZW50ZXI7Cgl0ZXh0LXNoYWRvdzpub25lOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgtOTBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKC05MGRlZyk7Cgkta2h0bWwtdHJhbnNmb3JtOnJvdGF0ZSgtOTBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKC05MGRlZyk7Cgl3aWR0aDoxMDAlOwp9Ci51aS10b29sdGlwLXJpZ2h0OmFmdGVyIHsKCWNvbG9yOiMyMjIyMjI7CglyaWdodDotMC4zNzVlbTsKCXRvcDo1MCU7CgltYXJnaW4tdG9wOi0uMDVlbTsKCXRleHQtc2hhZG93OjAgMXB4IDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgwKTsKCS1tb3otdHJhbnNmb3JtOnJvdGF0ZSgwKTsKCS1raHRtbC10cmFuc2Zvcm06cm90YXRlKDApOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDApOwp9Ci51aS10b29sdGlwLWxlZnQ6YWZ0ZXIgewoJY29sb3I6IzIyMjIyMjsKCWxlZnQ6LTAuMzc1ZW07Cgl0b3A6NTAlOwoJbWFyZ2luLXRvcDouMWVtOwoJdGV4dC1zaGFkb3c6MCAtMXB4IDJweCAjMDAwMDAwOwoJLW8tdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKDE4MGRlZyk7Cgkta2h0bWwtdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpOwoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDE4MGRlZyk7Cn0KCgoKLyp0aGUgZm9sbG93aW5nIGNoYW5nZXMgcmVxdWlyZSBzb21lIGNsZWFudXAgYW5kIGludGVncmF0aW9uIHdpdGggdGhlIGFib3ZlLioqLwoKLyogbGluZSA5ICovCgoKLyogbGluZSAxNyAqLwojdG9kb2FwcCB7CgliYWNrZ3JvdW5kOiB3aGl0ZTsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMnB4IDZweCAwOwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAycHggNnB4IDA7CgktbW96LWJvcmRlci1yYWRpdXMtYm90dG9tbGVmdDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7Cgktby1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7CgktbXMtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDogNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLW8tYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDVweDsKCS1tcy1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLWtodG1sLWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7Cglib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4Owp9Ci8qIGxpbmUgMjQgKi8KCgovKiBsaW5lIDMyICovCiN0b2RvYXBwIC5jb250ZW50ICNjcmVhdGUtdG9kbyB7Cglwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLyogbGluZSAzNCAqLwojdG9kb2FwcCAuY29udGVudCAjY3JlYXRlLXRvZG8gaW5wdXQgewoJZm9udC1zaXplOiAyNHB4OwoJZm9udC1mYW1pbHk6IGluaGVyaXQ7CglsaW5lLWhlaWdodDogMS40ZW07Cglib3JkZXI6IDA7CglvdXRsaW5lOiBub25lOwoJcGFkZGluZzogNnB4OwoJYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cgktby1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAxcHggMnB4IDAgaW5zZXQ7Cn0KCi8qIGxpbmUgNDcgKi8KI3RvZG9hcHAgLmNvbnRlbnQgI2NyZWF0ZS10b2RvIHNwYW4gewoJcG9zaXRpb246IGFic29sdXRlOwoJei1pbmRleDogOTk5OwoJd2lkdGg6IDE3MHB4OwoJbGVmdDogNTAlOwoJbWFyZ2luLWxlZnQ6IC04NXB4Owp9Ci8qIGxpbmUgNTUgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IHsKCW1hcmdpbi10b3A6IDEwcHg7Cn0KLyogbGluZSA1NyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkgewoJcGFkZGluZzogMTVweCAyMHB4IDE1cHggMDsKCXBvc2l0aW9uOiByZWxhdGl2ZTsKCWZvbnQtc2l6ZTogMjRweDsKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjY2NjOwoJKnpvb206IDE7CgljdXJzb3I6IG1vdmU7Cn0KLyogbGluZSAyMiwgL29wdC9yZWUvbGliL3J1YnkvZ2Vtcy8xLjgvZ2Vtcy9jb21wYXNzLTAuMTAuNS9mcmFtZXdvcmtzL2NvbXBhc3Mvc3R5bGVzaGVldHMvY29tcGFzcy91dGlsaXRpZXMvZ2VuZXJhbC9fY2xlYXJmaXguc2NzcyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGk6YWZ0ZXIgewoJY29udGVudDogIlwwMDIwIjsKCWRpc3BsYXk6IGJsb2NrOwoJaGVpZ2h0OiAwOwoJY2xlYXI6IGJvdGg7CglvdmVyZmxvdzogaGlkZGVuOwoJdmlzaWJpbGl0eTogaGlkZGVuOwp9Ci8qIGxpbmUgNjQgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpLmVkaXRpbmcgewoJcGFkZGluZzogMDsKCWJvcmRlci1ib3R0b206IDA7Cn0KLyogbGluZSA2NyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkuZWRpdGluZyAudG9kby1pbnB1dCB7CglkaXNwbGF5OiBibG9jazsKCXdpZHRoOiA0NjZweDsKCWZvbnQtc2l6ZTogMjRweDsKCWZvbnQtZmFtaWx5OiBpbmhlcml0OwoJbGluZS1oZWlnaHQ6IDEuNGVtOwoJYm9yZGVyOiAwOwoJb3V0bGluZTogbm9uZTsKCXBhZGRpbmc6IDZweDsKCWJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIDFweCAycHggMCBpbnNldDsKCS13ZWJraXQtYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0OwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgMXB4IDJweCAwIGluc2V0Owp9Ci8qIGxpbmUgNzkgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpLmVkaXRpbmcgLnRvZG8tY29udGVudCB7CglkaXNwbGF5OiBub25lOwp9Ci8qIGxpbmUgODEgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpLmVkaXRpbmcgLnRvZG8tY2hlY2sgewoJZGlzcGxheTogbm9uZTsKfQovKiBsaW5lIDgzICovCiN0b2RvYXBwIC5jb250ZW50IHVsI3RvZG8tbGlzdCBsaS5lZGl0aW5nIC50b2RvLWRlc3Ryb3kgewoJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9Ci8qIGxpbmUgODUgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpIC50b2RvLWlucHV0IHsKCWRpc3BsYXk6IG5vbmU7Cn0KLyogbGluZSA4NyAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGkgLnRvZG8tY2hlY2sgewoJcG9zaXRpb246IHJlbGF0aXZlOwoJdG9wOiA2cHg7CgltYXJnaW46IDAgMTBweCAwIDdweDsKCWZsb2F0OiBsZWZ0Owp9Ci8qIGxpbmUgOTMgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpLmRvbmUgLnRvZG8tY29udGVudCB7Cgl0ZXh0LWRlY29yYXRpb246IGxpbmUtdGhyb3VnaDsKCWNvbG9yOiAjNzc3Nzc3Owp9Ci8qIGxpbmUgOTYgKi8KI3RvZG9hcHAgLmNvbnRlbnQgdWwjdG9kby1saXN0IGxpIC50b2RvLWRlc3Ryb3kgewoJcG9zaXRpb246IGFic29sdXRlOwoJcmlnaHQ6IDBweDsKCXRvcDogMTZweDsKCWRpc3BsYXk6IG5vbmU7CgljdXJzb3I6IHBvaW50ZXI7Cgl3aWR0aDogMjBweDsKCWhlaWdodDogMjBweDsKfQovKiBsaW5lIDEwNiAqLwojdG9kb2FwcCAuY29udGVudCB1bCN0b2RvLWxpc3QgbGk6aG92ZXIgLnRvZG8tZGVzdHJveSB7CglkaXNwbGF5OiBibG9jazsKfQovKiBsaW5lIDEwOSAqLwojdG9kb2FwcCAjdG9kby1zdGF0cyB7Cgkqem9vbTogMTsKCW1hcmdpbi10b3A6IDEwcHg7Cgljb2xvcjogIzU1NTU1NTsKCS1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OiA1cHg7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCS1vLWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDVweDsKCS1tcy1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA1cHg7Cgkta2h0bWwtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNXB4OwoJLW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbXJpZ2h0OiA1cHg7Cgktd2Via2l0LWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7Cgktby1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNXB4OwoJLW1zLWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7Cgkta2h0bWwtYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDVweDsKCWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1cHg7CgliYWNrZ3JvdW5kOiAjZjRmY2U4OwoJYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZGVkZWQ7CglwYWRkaW5nOiAwIDIwcHg7CglsaW5lLWhlaWdodDogMzZweDsKfQovKiBsaW5lIDIyLCAvb3B0L3JlZS9saWIvcnVieS9nZW1zLzEuOC9nZW1zL2NvbXBhc3MtMC4xMC41L2ZyYW1ld29ya3MvY29tcGFzcy9zdHlsZXNoZWV0cy9jb21wYXNzL3V0aWxpdGllcy9nZW5lcmFsL19jbGVhcmZpeC5zY3NzICovCiN0b2RvYXBwICN0b2RvLXN0YXRzOmFmdGVyIHsKCWNvbnRlbnQ6ICJcMDAyMCI7CglkaXNwbGF5OiBibG9jazsKCWhlaWdodDogMDsKCWNsZWFyOiBib3RoOwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXZpc2liaWxpdHk6IGhpZGRlbjsKfQovKiBsaW5lIDExOCAqLwojdG9kb2FwcCAjdG9kby1zdGF0cyAudG9kby1jb3VudCB7CglmbG9hdDogbGVmdDsKfQovKiBsaW5lIDEyMCAqLwojdG9kb2FwcCAjdG9kby1zdGF0cyAudG9kby1jb3VudCAubnVtYmVyIHsKCWZvbnQtd2VpZ2h0OiBib2xkOwoJY29sb3I6ICM1NTU1NTU7Cn0KLyogbGluZSAxMjMgKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgewoJZmxvYXQ6IHJpZ2h0Owp9Ci8qIGxpbmUgMTI1ICovCiN0b2RvYXBwICN0b2RvLXN0YXRzIC50b2RvLWNsZWFyIGEgewoJZGlzcGxheTogYmxvY2s7CglsaW5lLWhlaWdodDogMjBweDsKCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKCS1tb3otYm9yZGVyLXJhZGl1czogMTJweDsKCS13ZWJraXQtYm9yZGVyLXJhZGl1czogMTJweDsKCS1vLWJvcmRlci1yYWRpdXM6IDEycHg7CgktbXMtYm9yZGVyLXJhZGl1czogMTJweDsKCS1raHRtbC1ib3JkZXItcmFkaXVzOiAxMnB4OwoJYm9yZGVyLXJhZGl1czogMTJweDsKCWJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4xKTsKCWNvbG9yOiAjNTU1NTU1OwoJZm9udC1zaXplOiAxMXB4OwoJbWFyZ2luLXRvcDogOHB4OwoJcGFkZGluZzogMCAxMHB4IDFweDsKCS1tb3otYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgLTFweCAwIDA7Cgktd2Via2l0LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4yKSAwIC0xcHggMCAwOwoJLW8tYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjIpIDAgLTFweCAwIDA7Cglib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMikgMCAtMXB4IDAgMDsKfQovKiBsaW5lIDEzNiAqLwojdG9kb2FwcCAjdG9kby1zdGF0cyAudG9kby1jbGVhciBhOmhvdmVyIHsKCWJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4xNSk7CgktbW96LWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4zKSAwIC0xcHggMCAwOwoJLXdlYmtpdC1ib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuMykgMCAtMXB4IDAgMDsKCS1vLWJveC1zaGFkb3c6IHJnYmEoMCwgMCwgMCwgMC4zKSAwIC0xcHggMCAwOwoJYm94LXNoYWRvdzogcmdiYSgwLCAwLCAwLCAwLjMpIDAgLTFweCAwIDA7Cn0KLyogbGluZSAxMzkgKi8KI3RvZG9hcHAgI3RvZG8tc3RhdHMgLnRvZG8tY2xlYXIgYTphY3RpdmUgewoJcG9zaXRpb246IHJlbGF0aXZlOwoJdG9wOiAxcHg7Cn0KCg==", "content_type": "text/css"}, "test/qunit/vendor/qunit.css": {"data": "LyoqCiAqIFFVbml0IDEuMi4wcHJlIC0gQSBKYXZhU2NyaXB0IFVuaXQgVGVzdGluZyBGcmFtZXdvcmsKICoKICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9RVW5pdAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTEgSm9obiBSZXNpZywgSsODwrZybiBaYWVmZmVyZXIKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpCiAqIG9yIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy4KICogUHVsbGVkIExpdmUgZnJvbSBHaXQgTW9uIE9jdCAzMSAxNDowMDowMiBVVEMgMjAxMQogKiBMYXN0IENvbW1pdDogZWUxNTY5MjNjZGIwMTgyMGUzNWU2YmI1NzlkNWNmNmJmNTU3MzZkNAogKi8KCi8qKiBGb250IEZhbWlseSBhbmQgU2l6ZXMgKi8KCiNxdW5pdC10ZXN0cywgI3F1bml0LWhlYWRlciwgI3F1bml0LWJhbm5lciwgI3F1bml0LXRlc3RydW5uZXItdG9vbGJhciwgI3F1bml0LXVzZXJBZ2VudCwgI3F1bml0LXRlc3RyZXN1bHQgewoJZm9udC1mYW1pbHk6ICJIZWx2ZXRpY2EgTmV1ZSBMaWdodCIsICJIZWx2ZXRpY2FOZXVlLUxpZ2h0IiwgIkhlbHZldGljYSBOZXVlIiwgQ2FsaWJyaSwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKfQoKI3F1bml0LXRlc3RydW5uZXItdG9vbGJhciwgI3F1bml0LXVzZXJBZ2VudCwgI3F1bml0LXRlc3RyZXN1bHQsICNxdW5pdC10ZXN0cyBsaSB7IGZvbnQtc2l6ZTogc21hbGw7IH0KI3F1bml0LXRlc3RzIHsgZm9udC1zaXplOiBzbWFsbGVyOyB9CgoKLyoqIFJlc2V0cyAqLwoKI3F1bml0LXRlc3RzLCAjcXVuaXQtdGVzdHMgb2wsICNxdW5pdC1oZWFkZXIsICNxdW5pdC1iYW5uZXIsICNxdW5pdC11c2VyQWdlbnQsICNxdW5pdC10ZXN0cmVzdWx0IHsKCW1hcmdpbjogMDsKCXBhZGRpbmc6IDA7Cn0KCgovKiogSGVhZGVyICovCgojcXVuaXQtaGVhZGVyIHsKCXBhZGRpbmc6IDAuNWVtIDAgMC41ZW0gMWVtOwoKCWNvbG9yOiAjODY5OWE0OwoJYmFja2dyb3VuZC1jb2xvcjogIzBkMzM0OTsKCglmb250LXNpemU6IDEuNWVtOwoJbGluZS1oZWlnaHQ6IDFlbTsKCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgoJYm9yZGVyLXJhZGl1czogMTVweCAxNXB4IDAgMDsKCS1tb3otYm9yZGVyLXJhZGl1czogMTVweCAxNXB4IDAgMDsKCS13ZWJraXQtYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDE1cHg7Cgktd2Via2l0LWJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDE1cHg7Cn0KCiNxdW5pdC1oZWFkZXIgYSB7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7Cgljb2xvcjogI2MyY2NkMTsKfQoKI3F1bml0LWhlYWRlciBhOmhvdmVyLAojcXVuaXQtaGVhZGVyIGE6Zm9jdXMgewoJY29sb3I6ICNmZmY7Cn0KCiNxdW5pdC1iYW5uZXIgewoJaGVpZ2h0OiA1cHg7Cn0KCiNxdW5pdC10ZXN0cnVubmVyLXRvb2xiYXIgewoJcGFkZGluZzogMC41ZW0gMCAwLjVlbSAyZW07Cgljb2xvcjogIzVFNzQwQjsKCWJhY2tncm91bmQtY29sb3I6ICNlZWU7Cn0KCiNxdW5pdC11c2VyQWdlbnQgewoJcGFkZGluZzogMC41ZW0gMCAwLjVlbSAyLjVlbTsKCWJhY2tncm91bmQtY29sb3I6ICMyYjgxYWY7Cgljb2xvcjogI2ZmZjsKCXRleHQtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuNSkgMnB4IDJweCAxcHg7Cn0KCgovKiogVGVzdHM6IFBhc3MvRmFpbCAqLwoKI3F1bml0LXRlc3RzIHsKCWxpc3Qtc3R5bGUtcG9zaXRpb246IGluc2lkZTsKfQoKI3F1bml0LXRlc3RzIGxpIHsKCXBhZGRpbmc6IDAuNGVtIDAuNWVtIDAuNGVtIDIuNWVtOwoJYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmZmY7CglsaXN0LXN0eWxlLXBvc2l0aW9uOiBpbnNpZGU7Cn0KCiNxdW5pdC10ZXN0cy5oaWRlcGFzcyBsaS5wYXNzLCAjcXVuaXQtdGVzdHMuaGlkZXBhc3MgbGkucnVubmluZyAgewoJZGlzcGxheTogbm9uZTsKfQoKI3F1bml0LXRlc3RzIGxpIHN0cm9uZyB7CgljdXJzb3I6IHBvaW50ZXI7Cn0KCiNxdW5pdC10ZXN0cyBsaSBhIHsKCXBhZGRpbmc6IDAuNWVtOwoJY29sb3I6ICNjMmNjZDE7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KI3F1bml0LXRlc3RzIGxpIGE6aG92ZXIsCiNxdW5pdC10ZXN0cyBsaSBhOmZvY3VzIHsKCWNvbG9yOiAjMDAwOwp9CgojcXVuaXQtdGVzdHMgb2wgewoJbWFyZ2luLXRvcDogMC41ZW07CglwYWRkaW5nOiAwLjVlbTsKCgliYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwoKCWJvcmRlci1yYWRpdXM6IDE1cHg7CgktbW96LWJvcmRlci1yYWRpdXM6IDE1cHg7Cgktd2Via2l0LWJvcmRlci1yYWRpdXM6IDE1cHg7CgoJYm94LXNoYWRvdzogaW5zZXQgMHB4IDJweCAxM3B4ICM5OTk7CgktbW96LWJveC1zaGFkb3c6IGluc2V0IDBweCAycHggMTNweCAjOTk5OwoJLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwcHggMnB4IDEzcHggIzk5OTsKfQoKI3F1bml0LXRlc3RzIHRhYmxlIHsKCWJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7CgltYXJnaW4tdG9wOiAuMmVtOwp9CgojcXVuaXQtdGVzdHMgdGggewoJdGV4dC1hbGlnbjogcmlnaHQ7Cgl2ZXJ0aWNhbC1hbGlnbjogdG9wOwoJcGFkZGluZzogMCAuNWVtIDAgMDsKfQoKI3F1bml0LXRlc3RzIHRkIHsKCXZlcnRpY2FsLWFsaWduOiB0b3A7Cn0KCiNxdW5pdC10ZXN0cyBwcmUgewoJbWFyZ2luOiAwOwoJd2hpdGUtc3BhY2U6IHByZS13cmFwOwoJd29yZC13cmFwOiBicmVhay13b3JkOwp9CgojcXVuaXQtdGVzdHMgZGVsIHsKCWJhY2tncm91bmQtY29sb3I6ICNlMGYyYmU7Cgljb2xvcjogIzM3NGUwYzsKCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQoKI3F1bml0LXRlc3RzIGlucyB7CgliYWNrZ3JvdW5kLWNvbG9yOiAjZmZjYWNhOwoJY29sb3I6ICM1MDA7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCi8qKiogVGVzdCBDb3VudHMgKi8KCiNxdW5pdC10ZXN0cyBiLmNvdW50cyAgICAgICAgICAgICAgICAgICAgICAgeyBjb2xvcjogYmxhY2s7IH0KI3F1bml0LXRlc3RzIGIucGFzc2VkICAgICAgICAgICAgICAgICAgICAgICB7IGNvbG9yOiAjNUU3NDBCOyB9CiNxdW5pdC10ZXN0cyBiLmZhaWxlZCAgICAgICAgICAgICAgICAgICAgICAgeyBjb2xvcjogIzcxMDkwOTsgfQoKI3F1bml0LXRlc3RzIGxpIGxpIHsKCW1hcmdpbjogMC41ZW07CglwYWRkaW5nOiAwLjRlbSAwLjVlbSAwLjRlbSAwLjVlbTsKCWJhY2tncm91bmQtY29sb3I6ICNmZmY7Cglib3JkZXItYm90dG9tOiBub25lOwoJbGlzdC1zdHlsZS1wb3NpdGlvbjogaW5zaWRlOwp9CgovKioqIFBhc3NpbmcgU3R5bGVzICovCgojcXVuaXQtdGVzdHMgbGkgbGkucGFzcyB7Cgljb2xvcjogIzVFNzQwQjsKCWJhY2tncm91bmQtY29sb3I6ICNmZmY7Cglib3JkZXItbGVmdDogMjZweCBzb2xpZCAjQzZFNzQ2Owp9CgojcXVuaXQtdGVzdHMgLnBhc3MgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY29sb3I6ICM1MjhDRTA7IGJhY2tncm91bmQtY29sb3I6ICNEMkUwRTY7IH0KI3F1bml0LXRlc3RzIC5wYXNzIC50ZXN0LW5hbWUgICAgICAgICAgICAgICB7IGNvbG9yOiAjMzY2MDk3OyB9CgojcXVuaXQtdGVzdHMgLnBhc3MgLnRlc3QtYWN0dWFsLAojcXVuaXQtdGVzdHMgLnBhc3MgLnRlc3QtZXhwZWN0ZWQgICAgICAgICAgIHsgY29sb3I6ICM5OTk5OTk7IH0KCiNxdW5pdC1iYW5uZXIucXVuaXQtcGFzcyAgICAgICAgICAgICAgICAgICAgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjQzZFNzQ2OyB9CgovKioqIEZhaWxpbmcgU3R5bGVzICovCgojcXVuaXQtdGVzdHMgbGkgbGkuZmFpbCB7Cgljb2xvcjogIzcxMDkwOTsKCWJhY2tncm91bmQtY29sb3I6ICNmZmY7Cglib3JkZXItbGVmdDogMjZweCBzb2xpZCAjRUU1NzU3OwoJd2hpdGUtc3BhY2U6IHByZTsKfQoKI3F1bml0LXRlc3RzID4gbGk6bGFzdC1jaGlsZCB7Cglib3JkZXItcmFkaXVzOiAwIDAgMTVweCAxNXB4OwoJLW1vei1ib3JkZXItcmFkaXVzOiAwIDAgMTVweCAxNXB4OwoJLXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMTVweDsKCS13ZWJraXQtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMTVweDsKfQoKI3F1bml0LXRlc3RzIC5mYWlsICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNvbG9yOiAjMDAwMDAwOyBiYWNrZ3JvdW5kLWNvbG9yOiAjRUU1NzU3OyB9CiNxdW5pdC10ZXN0cyAuZmFpbCAudGVzdC1uYW1lLAojcXVuaXQtdGVzdHMgLmZhaWwgLm1vZHVsZS1uYW1lICAgICAgICAgICAgIHsgY29sb3I6ICMwMDAwMDA7IH0KCiNxdW5pdC10ZXN0cyAuZmFpbCAudGVzdC1hY3R1YWwgICAgICAgICAgICAgeyBjb2xvcjogI0VFNTc1NzsgfQojcXVuaXQtdGVzdHMgLmZhaWwgLnRlc3QtZXhwZWN0ZWQgICAgICAgICAgIHsgY29sb3I6IGdyZWVuOyAgIH0KCiNxdW5pdC1iYW5uZXIucXVuaXQtZmFpbCAgICAgICAgICAgICAgICAgICAgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjRUU1NzU3OyB9CgoKLyoqIFJlc3VsdCAqLwoKI3F1bml0LXRlc3RyZXN1bHQgewoJcGFkZGluZzogMC41ZW0gMC41ZW0gMC41ZW0gMi41ZW07CgoJY29sb3I6ICMyYjgxYWY7CgliYWNrZ3JvdW5kLWNvbG9yOiAjRDJFMEU2OwoKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCB3aGl0ZTsKfQoKLyoqIEZpeHR1cmUgKi8KCiNxdW5pdC1maXh0dXJlIHsKCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCXRvcDogLTEwMDAwcHg7CglsZWZ0OiAtMTAwMDBweDsKfQo=", "content_type": "text/css"}, "app/main.js": {"data": "cmVxdWlyZShbCiAgIm5hbWVzcGFjZSIsCgogIC8vIExpYnMKICAianF1ZXJ5IiwKICAidXNlIWJhY2tib25lIiwKICAidXNlIWJhY2tib25lX2NvdWNoZGIiLAoKICAvLyBNb2R1bGVzCiAgLy8ibW9kdWxlcy9leGFtcGxlIiwKICAibW9kdWxlcy90b2RvIgpdLAoKZnVuY3Rpb24obmFtZXNwYWNlLCAkLCBCYWNrYm9uZSwgRXhhbXBsZSwgVG9kbykgewoJdmFyIFJvdXRlciA9IEJhY2tib25lLlJvdXRlci5leHRlbmQoewoJCXJvdXRlczogewoJCQkiIjogImluZGV4IiwKCQkJIjpoYXNoIjogImluZGV4IgoJCQkJLy8iOnR1dG9yaWFsIjogInR1dG9yaWFsIgoJCQkJLy8iLyI6ICJpbmRleCIsCgkJCQkvLyJjb3VjaGFiYi9fZGVzaWduL2NvdWNoYWJiL2luZGV4Lmh0bWwiOiAiaW5kZXgiCgkJfSwKCgkJaW5kZXg6IGZ1bmN0aW9uKGhhc2gpIHsKCQkJdmFyIHJvdXRlID0gdGhpczsKCQkJLy8qKiBDb25maWd1cmUgdGhlIGRhdGFiYXNlICoqLy8KCQkJRk9STVkuU3luY3BvaW50TG9jYWxEYiA9IG51bGw7CgkJCQoJCQl2YXIgZG9jVXJsID0gZG9jdW1lbnQuVVJMOwoJCSAgICBkb2NVcmwgPSBkb2NVcmwuc3BsaXQoIi8iKTsKCQkgICAgZG9jVXJsID0gZG9jVXJsLnNsaWNlKDMsIDQpOwoJCSAgICBjb25zb2xlLmxvZygiZG9jVXJsOiAiICsgZG9jVXJsICsgIiBkb2N1bWVudC5VUkw6ICIgKyBkb2N1bWVudC5VUkwpOwoJCSAgICAKCQkJQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lID0gZG9jVXJsOwoJCQlCYWNrYm9uZS5jb3VjaF9jb25uZWN0b3IuY29uZmlnLmRkb2NfbmFtZSA9ICJjb3VjaGFiYiI7CgkJCWNvbnNvbGUubG9nKCJJbml0IG9mIEJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZTogIiArIEJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZSk7CgkJCWNvbnNvbGUubG9nKCJJbml0IG9mIEJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGRvY19uYW1lOiAiICsgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kZG9jX25hbWUpOwoJCQkvLyQud2hlbiggZmluZFN5bmNwb2ludExvY2FsRGIoKSApLnRoZW4oCgoJCQl2YXIgaWQgPSBudWxsOwoJCQl2YXIgbG9jYWxfZGJfbmFtZSA9IG51bGw7CgkJCWlmIChkb2NVcmwgIT0gImNvdWNoYWJiIikgewoJCQkJdmFyIGpxeGhyID0gJC5nZXRKU09OKCcvc3BfY29udHJvbC9fZGVzaWduL2NvbnRyb2wvX3ZpZXcvYnlfdHlwZT9rZXk9JTIyaW5zdGFsbGF0aW9uJTIyJywgZnVuY3Rpb24oZGF0YSkgeyAKCQkJCQl2YXIgcmVjb3JkID0gbnVsbDsKCQkJCQkkLmVhY2goZGF0YSwgZnVuY3Rpb24oa2V5LCB2YWwpIHsKCQkJCQkJaWYgKGtleSA9PSAicm93cyIpIHsKCQkJCQkJCXJlY29yZCA9IHZhbDsKCQkJCQkJCWlkID0gcmVjb3JkWzBdLmlkOwoJCQkJCQkJY29uc29sZS5sb2coImlkOiAiICsgaWQpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSk7CgkJCQl9KS5jb21wbGV0ZSgKCQkJCQkJZnVuY3Rpb24oKSB7CgkJCQkJCQkvKmlmIChyZWNvcmQgIT0gbnVsbCkgewoJCQkJCQkJICAvL2NvbnNvbGUubG9nKCJyZWNvcmQ6ICIgKyBKU09OLnN0cmluZ2lmeShyZWNvcmQpKTsKCQkJCQkJCSAgY29uc29sZS5sb2coImlkOiAiICsgaWQpOyovCgkJCQkJCQl2YXIganF4aHIgPSAkLmdldEpTT04oJy9zcF9jb250cm9sLycgKyBpZCwgZnVuY3Rpb24oZGF0YSkgewoJCQkJCQkJCS8vY29uc29sZS5sb2coImRhdGE6ICIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7CgkJCQkJCQkJbG9jYWxfZGJfbmFtZSA9IGRhdGEubG9jYWxfZGJfbmFtZTsKCQkJCQkJCQlGT1JNWS5TeW5jcG9pbnRMb2NhbERiID0gbG9jYWxfZGJfbmFtZTsKCQkJCQkJCQljb25zb2xlLmxvZygibG9jYWxfZGJfbmFtZTogIiArIEZPUk1ZLlN5bmNwb2ludExvY2FsRGIpOwoJCQkJCQkJCUJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZSA9IEZPUk1ZLlN5bmNwb2ludExvY2FsRGI7CgkJCQkJCQkJY29uc29sZS5sb2coIlNldHRpbmcgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lLiAiKTsKCQkJCQkJCQljb25zb2xlLmxvZygiQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lOiAiICsgRk9STVkuU3luY3BvaW50TG9jYWxEYik7CgkJCQkJCQkJLy9yZXR1cm4gZGZkLnByb21pc2UoKTsKCQkJCQkJCX0pLmNvbXBsZXRlKAoJCQkJCQkJCQlmdW5jdGlvbigpIHsKCQkJCQkJCQkJCWxvYWRXZWJwYWdlKGhhc2gpOwoJCQkJCQkJCQl9CgkJCQkJCQkpOyAKCQkJCQkJfQoJCQkJCQkvKn0gZWxzZSB7CgkJCQkJCQkgIGNvbnNvbGUubG9nKCJTeW5jcG9pbnQgc2V0dXAgaW5jb21wbGV0ZTogQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lOiAiICsgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lKTsKCQkJCQkJCSAgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lID0gImNvdWNoYWJiIjsKCQkJCQkJICB9Ki8KCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQlsb2FkV2VicGFnZShoYXNoKTsKCQkJfQoJCQkKCQl9LAoJfSk7CiAgCgogIC8vIFNob3J0aGFuZCB0aGUgYXBwbGljYXRpb24gbmFtZXNwYWNlCiAgdmFyIGFwcCA9IG5hbWVzcGFjZS5hcHA7CiAgLy8gVHJlYXQgdGhlIGpRdWVyeSByZWFkeSBmdW5jdGlvbiBhcyB0aGUgZW50cnkgcG9pbnQgdG8gdGhlIGFwcGxpY2F0aW9uLgogIC8vIEluc2lkZSB0aGlzIGZ1bmN0aW9uLCBraWNrLW9mZiBhbGwgaW5pdGlhbGl6YXRpb24sIGV2ZXJ5dGhpbmcgdXAgdG8gdGhpcwogIC8vIHBvaW50IHNob3VsZCBiZSBkZWZpbml0aW9ucy4KICAkKGZ1bmN0aW9uKCkgewogICAgLy8gRGVmaW5lIHlvdXIgbWFzdGVyIHJvdXRlciBvbiB0aGUgYXBwbGljYXRpb24gbmFtZXNwYWNlIGFuZCB0cmlnZ2VyIGFsbAogICAgLy8gbmF2aWdhdGlvbiBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICBhcHAucm91dGVyID0gbmV3IFJvdXRlcigpOwogICAgLy8gVHJpZ2dlciB0aGUgaW5pdGlhbCByb3V0ZSBhbmQgZW5hYmxlIEhUTUw1IEhpc3RvcnkgQVBJIHN1cHBvcnQKICAgIC8vQmFja2JvbmUuaGlzdG9yeS5zdGFydCh7IHB1c2hTdGF0ZTogdHJ1ZSwgcm9vdDogIi8iICsgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lICsgIi9fZGVzaWduL2NvdWNoYWJiL2luZGV4Lmh0bWwiIH0pOwogICAgdmFyIGRvY1VybCA9IGRvY3VtZW50LlVSTDsKICAgIGRvY1VybCA9IGRvY1VybC5zcGxpdCgiLyIpOwogICAgZG9jVXJsID0gZG9jVXJsLnNsaWNlKDMsIDQpOwogICAgY29uc29sZS5sb2coImRvY1VybDogIiArIGRvY1VybCArICIgZG9jdW1lbnQuVVJMOiAiICsgZG9jdW1lbnQuVVJMKTsKICAgIEJhY2tib25lLmhpc3Rvcnkuc3RhcnQoeyBwdXNoU3RhdGU6IHRydWUsIHJvb3Q6ICIvIiArIGRvY1VybCArICIvX2Rlc2lnbi9jb3VjaGFiYi9pbmRleC5odG1sIiB9KTsKICB9KTsKCiAgLy8gQWxsIG5hdmlnYXRpb24gdGhhdCBpcyByZWxhdGl2ZSBzaG91bGQgYmUgcGFzc2VkIHRocm91Z2ggdGhlIG5hdmlnYXRlCiAgLy8gbWV0aG9kLCB0byBiZSBwcm9jZXNzZWQgYnkgdGhlIHJvdXRlci4gIElmIHRoZSBsaW5rIGhhcyBhIGRhdGEtYnlwYXNzCiAgLy8gYXR0cmlidXRlLCBieXBhc3MgdGhlIGRlbGVnYXRpb24gY29tcGxldGVseS4KICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiYTpub3QoW2RhdGEtYnlwYXNzXSkiLCBmdW5jdGlvbihldnQpIHsKICAgIC8vIEdldCB0aGUgYW5jaG9yIGhyZWYgYW5kIHByb3Rjb2wKICAgIHZhciBocmVmID0gJCh0aGlzKS5hdHRyKCJocmVmIik7CiAgICB2YXIgcHJvdG9jb2wgPSB0aGlzLnByb3RvY29sICsgIi8vIjsKCiAgICAvLyBFbnN1cmUgdGhlIHByb3RvY29sIGlzIG5vdCBwYXJ0IG9mIFVSTCwgbWVhbmluZyBpdHMgcmVsYXRpdmUuCiAgICBpZiAoaHJlZiAmJiBocmVmLnNsaWNlKDAsIHByb3RvY29sLmxlbmd0aCkgIT09IHByb3RvY29sICYmCiAgICAgICAgaHJlZi5pbmRleE9mKCJqYXZhc2NyaXB0OiIpICE9PSAwKSB7CiAgICAgIC8vIFN0b3AgdGhlIGRlZmF1bHQgZXZlbnQgdG8gZW5zdXJlIHRoZSBsaW5rIHdpbGwgbm90IGNhdXNlIGEgcGFnZQogICAgICAvLyByZWZyZXNoLgogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIC8vIGBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlYCBpcyBzdWZmaWNpZW50IGZvciBhbGwgUm91dGVycyBhbmQgd2lsbAogICAgICAvLyB0cmlnZ2VyIHRoZSBjb3JyZWN0IGV2ZW50cy4gIFRoZSBSb3V0ZXIncyBpbnRlcm5hbCBgbmF2aWdhdGVgIG1ldGhvZAogICAgICAvLyBjYWxscyB0aGlzIGFueXdheXMuCiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoaHJlZiwgdHJ1ZSk7CiAgICB9CiAgfSk7CiAgCiAgdmFyIEZPUk1ZID0ge307CiAgCiAgZnVuY3Rpb24gbG9hZFdlYnBhZ2UoaGFzaCkgewoJICAvLyBGZXRjaCB0aGUgdGVtcGxhdGUsIHJlbmRlciBpdCB0byB0aGUgVmlldyBlbGVtZW50IGFuZCBjYWxsIGRvbmUuCgkgIG5hbWVzcGFjZS5mZXRjaFRlbXBsYXRlKCJhcHAvdGVtcGxhdGVzL3RvZG9tdmMuaHRtbCIsIGZ1bmN0aW9uKHRtcGwpIHsKCQkgIGNvbnNvbGUubG9nKCJ3ZSBjYW4gcHJvY2VlZCBub3c6ICIgKyBCYWNrYm9uZS5jb3VjaF9jb25uZWN0b3IuY29uZmlnLmRiX25hbWUpOwoJCSAgdmFyIGh0bWxUZXh0ID0gdG1wbCgpOwoJCSAgLy90aGlzLiQoIiNtYWluIikuaW5uZXJIVE1MID0gaHRtbFRleHQ7CgkJICB0aGlzLiQoIiNtYWluIikuaHRtbChodG1sVGV4dCk7CgkJICBjb25zb2xlLmxvZygicmVuZGVyZWQgaW5kZXggdGVtcGxhdGUuICIpOwoJCSAgdmFyIHRvZG9WaWV3ID0gbmV3IFRvZG8uVmlld3MuVG9kb212YygpOwoJCSAgdG9kb1ZpZXcucmVuZGVyKAoJCQkJICBmdW5jdGlvbihlbCl7CgkJCQkJICAvLyQoIiNtYWluIikuaHRtbChlbCk7CgkJCQkJICAvL1RvZG8uVG9kb0NvbGxlY3Rpb24uZmV0Y2goKTsKCQkJCQkgIC8vIEZpeCBmb3IgaGFzaGVzIGluIHB1c2hTdGF0ZSBhbmQgaGFzaCBmcmFnbWVudAoJCQkJCSAgaWYgKGhhc2ggJiYgIXJvdXRlLl9hbHJlYWR5VHJpZ2dlcmVkKSB7CgkJCQkJCSAgLy8gUmVzZXQgdG8gaG9tZSwgcHVzaFN0YXRlIHN1cHBvcnQgYXV0b21hdGljYWxseSBjb252ZXJ0cyBoYXNoZXMKCQkJCQkJICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKCIiLCBmYWxzZSk7CgkJCQkJCSAgLy8gVHJpZ2dlciB0aGUgZGVmYXVsdCBicm93c2VyIGJlaGF2aW9yCgkJCQkJCSAgbG9jYXRpb24uaGFzaCA9IGhhc2g7CgkJCQkJCSAgLy8gU2V0IGFuIGludGVybmFsIGZsYWcgdG8gc3RvcCByZWN1cnNpdmUgbG9vcGluZwoJCQkJCQkgIHJvdXRlLl9hbHJlYWR5VHJpZ2dlcmVkID0gdHJ1ZTsKCQkJCQkgIH0KCQkJCSAgfSk7CgkgIH0pOwogIH0KICAKICBmdW5jdGlvbiBmaW5kU3luY3BvaW50TG9jYWxEYigpIHsKCSAgLy92YXIgZGZkID0gbmV3IGpRdWVyeS5EZWZlcnJlZCgpOwoJICB2YXIgaWQgPSBudWxsOwoJICB2YXIgbG9jYWxfZGJfbmFtZSA9IG51bGw7CgkgIHZhciBqcXhociA9ICQuZ2V0SlNPTignL3NwX2NvbnRyb2wvX2Rlc2lnbi9jb250cm9sL192aWV3L2J5X3R5cGU/a2V5PSUyMmluc3RhbGxhdGlvbiUyMicsIGZ1bmN0aW9uKGRhdGEpIHsgCgkJICB2YXIgcmVjb3JkID0gbnVsbDsKCQkgICQuZWFjaChkYXRhLCBmdW5jdGlvbihrZXksIHZhbCkgewoJCQkgIGlmIChrZXkgPT0gInJvd3MiKSB7CgkJCQkgIHJlY29yZCA9IHZhbDsKCQkJCSAgaWQgPSByZWNvcmRbMF0uaWQ7CgkJCQkgIGNvbnNvbGUubG9nKCJpZDogIiArIGlkKTsKCQkJICB9CgkJICB9CgkJICApOwoJICB9KS5jb21wbGV0ZSgKCQkJICBmdW5jdGlvbigpIHsKCQkJICAvKmlmIChyZWNvcmQgIT0gbnVsbCkgewoJCQkJCSAgLy9jb25zb2xlLmxvZygicmVjb3JkOiAiICsgSlNPTi5zdHJpbmdpZnkocmVjb3JkKSk7CgkJCQkJICBjb25zb2xlLmxvZygiaWQ6ICIgKyBpZCk7Ki8KCQkJICAkLmdldEpTT04oJy9zcF9jb250cm9sLycgKyBpZCwgZnVuY3Rpb24oZGF0YSkgewoJCQkJICAvL2NvbnNvbGUubG9nKCJkYXRhOiAiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwoJCQkJICBsb2NhbF9kYl9uYW1lID0gZGF0YS5sb2NhbF9kYl9uYW1lOwoJCQkJICBGT1JNWS5TeW5jcG9pbnRMb2NhbERiID0gbG9jYWxfZGJfbmFtZTsKCQkJCSAgY29uc29sZS5sb2coImxvY2FsX2RiX25hbWU6ICIgKyBGT1JNWS5TeW5jcG9pbnRMb2NhbERiKTsKCQkJCSAgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lID0gRk9STVkuU3luY3BvaW50TG9jYWxEYjsKCQkJCSAgY29uc29sZS5sb2coIkJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZTogIiArIEZPUk1ZLlN5bmNwb2ludExvY2FsRGIpOwoJCQkJICAvL3JldHVybiBkZmQucHJvbWlzZSgpOwoJCQkgIH0pOwoJCQkgIH0KCQkJICAvKn0gZWxzZSB7CgkJCQkJICBjb25zb2xlLmxvZygiU3luY3BvaW50IHNldHVwIGluY29tcGxldGU6IEJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZTogIiArIEJhY2tib25lLmNvdWNoX2Nvbm5lY3Rvci5jb25maWcuZGJfbmFtZSk7CgkJCQkJICBCYWNrYm9uZS5jb3VjaF9jb25uZWN0b3IuY29uZmlnLmRiX25hbWUgPSAiY291Y2hhYmIiOwoJCQkJICB9Ki8KCSAgKTsKCSAgLy9jb25zb2xlLmxvZygiYWZ0ZXIgaWYvZWxzZTogQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lOiAiICsgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lKTsKCSAgLy99KQoKCSAgLyogIC5lcnJvcigKCQkJICBjb25zb2xlLmxvZygiU3luY3BvaW50IG5vdCBzZXR1cDogQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lOiAiICsgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yLmNvbmZpZy5kYl9uYW1lKQoJICApOyovCgkgIHJldHVybiBqcXhocjsKICB9Cgp9KTsK", "content_type": "application/javascript"}, "test/qunit/tests/example.js": {"data": "dGVzdCgib25lIHRhdXRvbG9neSIsIGZ1bmN0aW9uKCkgewogIG9rKHRydWUpOwp9KTsKCm1vZHVsZSgic2ltcGxlIHRlc3RzIik7Cgp0ZXN0KCJpbmNyZW1lbnRzIiwgZnVuY3Rpb24oKSB7CiAgdmFyIG1pa2UgPSAwOwoKICBvayhtaWtlKysgPT09IDApOwogIG9rKG1pa2UgPT09IDEpOwp9KTsKCnRlc3QoImluY3JlbWVudHMgKGltcHJvdmVkKSIsIGZ1bmN0aW9uKCkgewogIHZhciBtaWtlID0gMDsKCiAgZXF1YWwobWlrZSsrLCAwKTsKICBlcXVhbChtaWtlLCAxKTsKfSk7CgoKbW9kdWxlKCJzZXRVcC90ZWFyRG93biIsIHsKICBzZXR1cDogZnVuY3Rpb24oKSB7CiAgICAvL2NvbnNvbGUubG9nKCJCZWZvcmUiKTsKICB9LAoKICB0ZWFyZG93bjogZnVuY3Rpb24oKSB7CiAgICAvL2NvbnNvbGUubG9nKCJBZnRlciIpOwogIH0KfSk7Cgp0ZXN0KCJleGFtcGxlIiwgZnVuY3Rpb24oKSB7CiAgLy9jb25zb2xlLmxvZygiRHVyaW5nIik7Cn0pOwoKbW9kdWxlKCJhc3luYyIpOwoKdGVzdCgibXVsdGlwbGUgYXN5bmMiLCBmdW5jdGlvbigpIHsKICBleHBlY3QoMik7CgogIHN0b3AoKTsKCiAgc2V0VGltZW91dCggZnVuY3Rpb24oICkgewogICAgb2sodHJ1ZSwgImFzeW5jIG9wZXJhdGlvbiBjb21wbGV0ZWQiKTsKICAgIHN0YXJ0KCk7CiAgfSwgNTAwKTsKCiAgc3RvcCgpOwoKICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgb2sodHJ1ZSwgImFzeW5jIG9wZXJhdGlvbiBjb21wbGV0ZWQiKTsKICAgIHN0YXJ0KCk7CiAgfSwgNTAwKTsKfSk7Cg==", "content_type": "application/javascript"}, "assets/js/plugins/backbone-localstorage.js": {"data": "Ly8gQSBzaW1wbGUgbW9kdWxlIHRvIHJlcGxhY2UgYEJhY2tib25lLnN5bmNgIHdpdGggKmxvY2FsU3RvcmFnZSotYmFzZWQKLy8gcGVyc2lzdGVuY2UuIE1vZGVscyBhcmUgZ2l2ZW4gR1VJRFMsIGFuZCBzYXZlZCBpbnRvIGEgSlNPTiBvYmplY3QuIFNpbXBsZQovLyBhcyB0aGF0LgoKLy8gR2VuZXJhdGUgZm91ciByYW5kb20gaGV4IGRpZ2l0cy4KZnVuY3Rpb24gUzQoKSB7CiAgIHJldHVybiAoKCgxK01hdGgucmFuZG9tKCkpKjB4MTAwMDApfDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7Cn07CgovLyBHZW5lcmF0ZSBhIHBzZXVkby1HVUlEIGJ5IGNvbmNhdGVuYXRpbmcgcmFuZG9tIGhleGFkZWNpbWFsLgpmdW5jdGlvbiBndWlkKCkgewogICByZXR1cm4gKFM0KCkrUzQoKSsiLSIrUzQoKSsiLSIrUzQoKSsiLSIrUzQoKSsiLSIrUzQoKStTNCgpK1M0KCkpOwp9OwoKLy8gT3VyIFN0b3JlIGlzIHJlcHJlc2VudGVkIGJ5IGEgc2luZ2xlIEpTIG9iamVjdCBpbiAqbG9jYWxTdG9yYWdlKi4gQ3JlYXRlIGl0Ci8vIHdpdGggYSBtZWFuaW5nZnVsIG5hbWUsIGxpa2UgdGhlIG5hbWUgeW91J2QgZ2l2ZSBhIHRhYmxlLgp2YXIgU3RvcmUgPSBmdW5jdGlvbihuYW1lKSB7CiAgdGhpcy5uYW1lID0gbmFtZTsKICB2YXIgc3RvcmUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm5hbWUpOwogIHRoaXMuZGF0YSA9IChzdG9yZSAmJiBKU09OLnBhcnNlKHN0b3JlKSkgfHwge307Cn07CgpfLmV4dGVuZChTdG9yZS5wcm90b3R5cGUsIHsKCiAgLy8gU2F2ZSB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgKipTdG9yZSoqIHRvICpsb2NhbFN0b3JhZ2UqLgogIHNhdmU6IGZ1bmN0aW9uKCkgewogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5uYW1lLCBKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGEpKTsKICB9LAoKICAvLyBBZGQgYSBtb2RlbCwgZ2l2aW5nIGl0IGEgKGhvcGVmdWxseSktdW5pcXVlIEdVSUQsIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeQogIC8vIGhhdmUgYW4gaWQgb2YgaXQncyBvd24uCiAgY3JlYXRlOiBmdW5jdGlvbihtb2RlbCkgewogICAgaWYgKCFtb2RlbC5pZCkgbW9kZWwuc2V0KG1vZGVsLmlkQXR0cmlidXRlLCBndWlkKCkpOwogICAgdGhpcy5kYXRhW21vZGVsLmlkXSA9IG1vZGVsOwogICAgdGhpcy5zYXZlKCk7CiAgICByZXR1cm4gbW9kZWw7CiAgfSwKCiAgLy8gVXBkYXRlIGEgbW9kZWwgYnkgcmVwbGFjaW5nIGl0cyBjb3B5IGluIGB0aGlzLmRhdGFgLgogIHVwZGF0ZTogZnVuY3Rpb24obW9kZWwpIHsKICAgIHRoaXMuZGF0YVttb2RlbC5pZF0gPSBtb2RlbDsKICAgIHRoaXMuc2F2ZSgpOwogICAgcmV0dXJuIG1vZGVsOwogIH0sCgogIC8vIFJldHJpZXZlIGEgbW9kZWwgZnJvbSBgdGhpcy5kYXRhYCBieSBpZC4KICBmaW5kOiBmdW5jdGlvbihtb2RlbCkgewogICAgcmV0dXJuIHRoaXMuZGF0YVttb2RlbC5pZF07CiAgfSwKCiAgLy8gUmV0dXJuIHRoZSBhcnJheSBvZiBhbGwgbW9kZWxzIGN1cnJlbnRseSBpbiBzdG9yYWdlLgogIGZpbmRBbGw6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIF8udmFsdWVzKHRoaXMuZGF0YSk7CiAgfSwKCiAgLy8gRGVsZXRlIGEgbW9kZWwgZnJvbSBgdGhpcy5kYXRhYCwgcmV0dXJuaW5nIGl0LgogIGRlc3Ryb3k6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICBkZWxldGUgdGhpcy5kYXRhW21vZGVsLmlkXTsKICAgIHRoaXMuc2F2ZSgpOwogICAgcmV0dXJuIG1vZGVsOwogIH0KCn0pOwoKLy8gT3ZlcnJpZGUgYEJhY2tib25lLnN5bmNgIHRvIHVzZSBkZWxlZ2F0ZSB0byB0aGUgbW9kZWwgb3IgY29sbGVjdGlvbidzCi8vICpsb2NhbFN0b3JhZ2UqIHByb3BlcnR5LCB3aGljaCBzaG91bGQgYmUgYW4gaW5zdGFuY2Ugb2YgYFN0b3JlYC4KQmFja2JvbmUuc3luYyA9IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdGlvbnMpIHsKCiAgdmFyIHJlc3A7CiAgdmFyIHN0b3JlID0gbW9kZWwubG9jYWxTdG9yYWdlIHx8IG1vZGVsLmNvbGxlY3Rpb24ubG9jYWxTdG9yYWdlOwoKICBzd2l0Y2ggKG1ldGhvZCkgewogICAgY2FzZSAicmVhZCI6ICAgIHJlc3AgPSBtb2RlbC5pZCA/IHN0b3JlLmZpbmQobW9kZWwpIDogc3RvcmUuZmluZEFsbCgpOyBicmVhazsKICAgIGNhc2UgImNyZWF0ZSI6ICByZXNwID0gc3RvcmUuY3JlYXRlKG1vZGVsKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICBjYXNlICJ1cGRhdGUiOiAgcmVzcCA9IHN0b3JlLnVwZGF0ZShtb2RlbCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgY2FzZSAiZGVsZXRlIjogIHJlc3AgPSBzdG9yZS5kZXN0cm95KG1vZGVsKTsgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICB9CgogIGlmIChyZXNwKSB7CiAgICBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgfSBlbHNlIHsKICAgIG9wdGlvbnMuZXJyb3IoIlJlY29yZCBub3QgZm91bmQiKTsKICB9Cn07", "content_type": "application/javascript"}, "assets/js/libs/syncpoint-utils.js": {"data": "dmFyIEZPUk1ZID0ge307CmZ1bmN0aW9uIGZpbmRTeW5jcG9pbnRMb2NhbERiKCkgewoJdmFyIGlkID0gbnVsbDsKCXZhciBsb2NhbF9kYl9uYW1lID0gbnVsbDsKCQoJJC5nZXRKU09OKCcvc3BfYWRtaW4vX2Rlc2lnbi9jb250cm9sL192aWV3L2J5X3R5cGU/a2V5PSUyMmluc3RhbGxhdGlvbiUyMicsIGZ1bmN0aW9uKGRhdGEpIHsgCgkJdmFyIHJlY29yZCA9IG51bGw7CgkJJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKGtleSwgdmFsKSB7CgkJCWlmIChrZXkgPT0gInJvd3MiKSB7CgkJCQlyZWNvcmQgPSB2YWw7CgkJCQlpZCA9IHJlY29yZFswXS5pZDsKCQkJfQoJCX0pOwoJCWlmIChyZWNvcmQgIT0gbnVsbCkgewoJCQkvL2NvbnNvbGUubG9nKCJyZWNvcmQ6ICIgKyBKU09OLnN0cmluZ2lmeShyZWNvcmQpKTsKCQkJY29uc29sZS5sb2coImlkOiAiICsgaWQpOwoJCQkkLmdldEpTT04oJy9zcF9hZG1pbi8nICsgaWQsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJCS8vY29uc29sZS5sb2coImRhdGE6ICIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7CgkJCQlsb2NhbF9kYl9uYW1lID0gZGF0YS5sb2NhbF9kYl9uYW1lOwoJCQkJRk9STVkuU3luY3BvaW50TG9jYWxEYiA9IGxvY2FsX2RiX25hbWU7CgkJCQljb25zb2xlLmxvZygibG9jYWxfZGJfbmFtZTogIiArIEZPUk1ZLlN5bmNwb2ludExvY2FsRGIpOwoJCQl9KTsKCQl9Cgl9KTsKfQ==", "content_type": "application/javascript"}, "assets/js/libs/jquery.couch.js": {"data": "Ly8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90Ci8vIHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mCi8vIHRoZSBMaWNlbnNlIGF0Ci8vCi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCi8vCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywgV0lUSE9VVAovLyBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUKLy8gTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIKLy8gdGhlIExpY2Vuc2UuCgooZnVuY3Rpb24oJCkgewogICQuY291Y2ggPSAkLmNvdWNoIHx8IHt9OwoKICBmdW5jdGlvbiBlbmNvZGVEb2NJZChkb2NJRCkgewogICAgdmFyIHBhcnRzID0gZG9jSUQuc3BsaXQoIi8iKTsKICAgIGlmIChwYXJ0c1swXSA9PSAiX2Rlc2lnbiIpIHsKICAgICAgcGFydHMuc2hpZnQoKTsKICAgICAgcmV0dXJuICJfZGVzaWduLyIgKyBlbmNvZGVVUklDb21wb25lbnQocGFydHMuam9pbignLycpKTsKICAgIH0KICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoZG9jSUQpOwogIH07CgogIHZhciB1dWlkQ2FjaGUgPSBbXTsKCiAgJC5leHRlbmQoJC5jb3VjaCwgewogICAgdXJsUHJlZml4OiAnJywKICAgIGFjdGl2ZVRhc2tzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGFqYXgoCiAgICAgICAge3VybDogdGhpcy51cmxQcmVmaXggKyAiL19hY3RpdmVfdGFza3MifSwKICAgICAgICBvcHRpb25zLAogICAgICAgICJBY3RpdmUgdGFzayBzdGF0dXMgY291bGQgbm90IGJlIHJldHJpZXZlZCIKICAgICAgKTsKICAgIH0sCgogICAgYWxsRGJzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGFqYXgoCiAgICAgICAge3VybDogdGhpcy51cmxQcmVmaXggKyAiL19hbGxfZGJzIn0sCiAgICAgICAgb3B0aW9ucywKICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgcmV0cmlldmluZyB0aGUgbGlzdCBvZiBhbGwgZGF0YWJhc2VzIgogICAgICApOwogICAgfSwKCiAgICBjb25maWc6IGZ1bmN0aW9uKG9wdGlvbnMsIHNlY3Rpb24sIG9wdGlvbiwgdmFsdWUpIHsKICAgICAgdmFyIHJlcSA9IHt1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fY29uZmlnLyJ9OwogICAgICBpZiAoc2VjdGlvbikgewogICAgICAgIHJlcS51cmwgKz0gZW5jb2RlVVJJQ29tcG9uZW50KHNlY3Rpb24pICsgIi8iOwogICAgICAgIGlmIChvcHRpb24pIHsKICAgICAgICAgIHJlcS51cmwgKz0gZW5jb2RlVVJJQ29tcG9uZW50KG9wdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHJlcS50eXBlID0gIkRFTEVURSI7ICAgICAgICAKICAgICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVxLnR5cGUgPSAiUFVUIjsKICAgICAgICByZXEuZGF0YSA9IHRvSlNPTih2YWx1ZSk7CiAgICAgICAgcmVxLmNvbnRlbnRUeXBlID0gImFwcGxpY2F0aW9uL2pzb24iOwogICAgICAgIHJlcS5wcm9jZXNzRGF0YSA9IGZhbHNlCiAgICAgIH0KCiAgICAgIGFqYXgocmVxLCBvcHRpb25zLAogICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCByZXRyaWV2aW5nL3VwZGF0aW5nIHRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbiIKICAgICAgKTsKICAgIH0sCiAgICAKICAgIHNlc3Npb246IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIkdFVCIsIHVybDogdGhpcy51cmxQcmVmaXggKyAiL19zZXNzaW9uIiwKICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICB2YXIgcmVzcCA9IGh0dHBEYXRhKHJlcSwgImpzb24iKTsKICAgICAgICAgIGlmIChyZXEuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgICAgb3B0aW9ucy5lcnJvcihyZXEuc3RhdHVzLCByZXNwLmVycm9yLCByZXNwLnJlYXNvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGVydCgiQW4gZXJyb3Igb2NjdXJyZWQgZ2V0dGluZyBzZXNzaW9uIGluZm86ICIgKyByZXNwLnJlYXNvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgdXNlckRiIDogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgJC5jb3VjaC5zZXNzaW9uKHsKICAgICAgICBzdWNjZXNzIDogZnVuY3Rpb24ocmVzcCkgewogICAgICAgICAgdmFyIHVzZXJEYiA9ICQuY291Y2guZGIocmVzcC5pbmZvLmF1dGhlbnRpY2F0aW9uX2RiKTsKICAgICAgICAgIGNhbGxiYWNrKHVzZXJEYik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgc2lnbnVwOiBmdW5jdGlvbih1c2VyX2RvYywgcGFzc3dvcmQsIG9wdGlvbnMpIHsgICAgICAKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIC8vIHByZXBhcmUgdXNlciBkb2MgYmFzZWQgb24gbmFtZSBhbmQgcGFzc3dvcmQKICAgICAgdXNlcl9kb2MgPSB0aGlzLnByZXBhcmVVc2VyRG9jKHVzZXJfZG9jLCBwYXNzd29yZCk7CiAgICAgICQuY291Y2gudXNlckRiKGZ1bmN0aW9uKGRiKSB7CiAgICAgICAgZGIuc2F2ZURvYyh1c2VyX2RvYywgb3B0aW9ucyk7CiAgICAgIH0pOwogICAgfSwKCiAgICBwcmVwYXJlVXNlckRvYzogZnVuY3Rpb24odXNlcl9kb2MsIG5ld19wYXNzd29yZCkgewogICAgICBpZiAodHlwZW9mIGhleF9zaGExID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgYWxlcnQoImNyZWF0aW5nIGEgdXNlciBkb2MgcmVxdWlyZXMgc2hhMS5qcyB0byBiZSBsb2FkZWQgaW4gdGhlIHBhZ2UiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHVzZXJfcHJlZml4ID0gIm9yZy5jb3VjaGRiLnVzZXI6IjsKICAgICAgdXNlcl9kb2MuX2lkID0gdXNlcl9kb2MuX2lkIHx8IHVzZXJfcHJlZml4ICsgdXNlcl9kb2MubmFtZTsKICAgICAgaWYgKG5ld19wYXNzd29yZCkgewogICAgICAgIC8vIGhhbmRsZSB0aGUgcGFzc3dvcmQgY3J5cHRvCiAgICAgICAgdXNlcl9kb2Muc2FsdCA9ICQuY291Y2gubmV3VVVJRCgpOwogICAgICAgIHVzZXJfZG9jLnBhc3N3b3JkX3NoYSA9IGhleF9zaGExKG5ld19wYXNzd29yZCArIHVzZXJfZG9jLnNhbHQpOwogICAgICB9CiAgICAgIHVzZXJfZG9jLnR5cGUgPSAidXNlciI7CiAgICAgIGlmICghdXNlcl9kb2Mucm9sZXMpIHsKICAgICAgICB1c2VyX2RvYy5yb2xlcyA9IFtdOwogICAgICB9CiAgICAgIHJldHVybiB1c2VyX2RvYzsKICAgIH0sCgogICAgbG9naW46IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIlBPU1QiLCB1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fc2Vzc2lvbiIsIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgZGF0YToge25hbWU6IG9wdGlvbnMubmFtZSwgcGFzc3dvcmQ6IG9wdGlvbnMucGFzc3dvcmR9LAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB9LAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZXEpIHsKICAgICAgICAgIHZhciByZXNwID0gaHR0cERhdGEocmVxLCAianNvbiIpOwogICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lcnJvcikgewogICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJBbiBlcnJvciBvY2N1cnJlZCBsb2dnaW5nIGluOiAiICsgcmVzcC5yZWFzb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbG9nb3V0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAkLmFqYXgoewogICAgICAgIHR5cGU6ICJERUxFVEUiLCB1cmw6IHRoaXMudXJsUHJlZml4ICsgIi9fc2Vzc2lvbiIsIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgdXNlcm5hbWUgOiAiXyIsIHBhc3N3b3JkIDogIl8iLAogICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB9LAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZXEpIHsKICAgICAgICAgIHZhciByZXNwID0gaHR0cERhdGEocmVxLCAianNvbiIpOwogICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lcnJvcikgewogICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJBbiBlcnJvciBvY2N1cnJlZCBsb2dnaW5nIG91dDogIiArIHJlc3AucmVhc29uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBkYjogZnVuY3Rpb24obmFtZSwgZGJfb3B0cykgewogICAgICBkYl9vcHRzID0gZGJfb3B0cyB8fCB7fTsKICAgICAgdmFyIHJhd0RvY3MgPSB7fTsKICAgICAgZnVuY3Rpb24gbWF5YmVBcHBseVZlcnNpb24oZG9jKSB7CiAgICAgICAgaWYgKGRvYy5faWQgJiYgZG9jLl9yZXYgJiYgcmF3RG9jc1tkb2MuX2lkXSAmJiByYXdEb2NzW2RvYy5faWRdLnJldiA9PSBkb2MuX3JldikgewogICAgICAgICAgLy8gdG9kbzogY2FuIHdlIHVzZSBjb21tb25qcyByZXF1aXJlIGhlcmU/CiAgICAgICAgICBpZiAodHlwZW9mIEJhc2U2NCA9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBhbGVydCgicGxlYXNlIGluY2x1ZGUgL191dGlscy9zY3JpcHQvYmFzZTY0LmpzIGluIHRoZSBwYWdlIGZvciBiYXNlNjQgc3VwcG9ydCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2MuX2F0dGFjaG1lbnRzID0gZG9jLl9hdHRhY2htZW50cyB8fCB7fTsKICAgICAgICAgICAgZG9jLl9hdHRhY2htZW50c1sicmV2LSIrZG9jLl9yZXYuc3BsaXQoIi0iKVswXV0gPSB7CiAgICAgICAgICAgICAgY29udGVudF90eXBlIDoiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICAgZGF0YSA6IEJhc2U2NC5lbmNvZGUocmF3RG9jc1tkb2MuX2lkXS5yYXcpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIHVyaTogdGhpcy51cmxQcmVmaXggKyAiLyIgKyBlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyAiLyIsCgogICAgICAgIGNvbXBhY3Q6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDJ9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwgdXJsOiB0aGlzLnVyaSArICJfY29tcGFjdCIsCiAgICAgICAgICAgICAgZGF0YTogIiIsIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRhdGFiYXNlIGNvdWxkIG5vdCBiZSBjb21wYWN0ZWQiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgdmlld0NsZWFudXA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDJ9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwgdXJsOiB0aGlzLnVyaSArICJfdmlld19jbGVhbnVwIiwKICAgICAgICAgICAgICBkYXRhOiAiIiwgcHJvY2Vzc0RhdGE6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgdmlld3MgY291bGQgbm90IGJlIGNsZWFuZWQgdXAiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgY29tcGFjdFZpZXc6IGZ1bmN0aW9uKGdyb3VwbmFtZSwgb3B0aW9ucykgewogICAgICAgICAgJC5leHRlbmQob3B0aW9ucywge3N1Y2Nlc3NTdGF0dXM6IDIwMn0pOwogICAgICAgICAgYWpheCh7CiAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLCB1cmw6IHRoaXMudXJpICsgIl9jb21wYWN0LyIgKyBncm91cG5hbWUsCiAgICAgICAgICAgICAgZGF0YTogIiIsIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIHZpZXcgY291bGQgbm90IGJlIGNvbXBhY3RlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDF9KTsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQVVQiLCB1cmw6IHRoaXMudXJpLCBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAgIGRhdGE6ICIiLCBwcm9jZXNzRGF0YTogZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIlRoZSBkYXRhYmFzZSBjb3VsZCBub3QgYmUgY3JlYXRlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBkcm9wOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICBhamF4KAogICAgICAgICAgICB7dHlwZTogIkRFTEVURSIsIHVybDogdGhpcy51cml9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRhdGFiYXNlIGNvdWxkIG5vdCBiZSBkZWxldGVkIgogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIGluZm86IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgIGFqYXgoCiAgICAgICAgICAgIHt1cmw6IHRoaXMudXJpfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIkRhdGFiYXNlIGluZm9ybWF0aW9uIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgY2hhbmdlczogZnVuY3Rpb24oc2luY2UsIG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgLy8gc2V0IHVwIHRoZSBwcm9taXNlIG9iamVjdCB3aXRoaW4gYSBjbG9zdXJlIGZvciB0aGlzIGhhbmRsZXIKICAgICAgICAgIHZhciB0aW1lb3V0ID0gMTAwLCBkYiA9IHRoaXMsIGFjdGl2ZSA9IHRydWUsCiAgICAgICAgICAgIGxpc3RlbmVycyA9IFtdLAogICAgICAgICAgICBwcm9taXNlID0gewogICAgICAgICAgICBvbkNoYW5nZSA6IGZ1bmN0aW9uKGZ1bikgewogICAgICAgICAgICAgIGxpc3RlbmVycy5wdXNoKGZ1bik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN0b3AgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIC8vIGNhbGwgZWFjaCBsaXN0ZW5lciB3aGVuIHRoZXJlIGlzIGEgY2hhbmdlCiAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyTGlzdGVuZXJzKHJlc3ApIHsKICAgICAgICAgICAgJC5lYWNoKGxpc3RlbmVycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcyhyZXNwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgLy8gd2hlbiB0aGVyZSBpcyBhIGNoYW5nZSwgY2FsbCBhbnkgbGlzdGVuZXJzLCB0aGVuIGNoZWNrIGZvciBhbm90aGVyIGNoYW5nZQogICAgICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgICAgICB0aW1lb3V0ID0gMTAwOwogICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgc2luY2UgPSByZXNwLmxhc3Rfc2VxOwogICAgICAgICAgICAgIHRyaWdnZXJMaXN0ZW5lcnMocmVzcCk7CiAgICAgICAgICAgICAgZ2V0Q2hhbmdlc1NpbmNlKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9OwogICAgICAgICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChnZXRDaGFuZ2VzU2luY2UsIHRpbWVvdXQpOwogICAgICAgICAgICAgIHRpbWVvdXQgPSB0aW1lb3V0ICogMjsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIC8vIGFjdHVhbGx5IG1ha2UgdGhlIGNoYW5nZXMgcmVxdWVzdAogICAgICAgICAgZnVuY3Rpb24gZ2V0Q2hhbmdlc1NpbmNlKCkgewogICAgICAgICAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHtoZWFydGJlYXQgOiAxMCAqIDEwMDB9LCBvcHRpb25zLCB7CiAgICAgICAgICAgICAgZmVlZCA6ICJsb25ncG9sbCIsCiAgICAgICAgICAgICAgc2luY2UgOiBzaW5jZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYWpheCgKICAgICAgICAgICAgICB7dXJsOiBkYi51cmkgKyAiX2NoYW5nZXMiK2VuY29kZU9wdGlvbnMob3B0cyl9LAogICAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICAgIkVycm9yIGNvbm5lY3RpbmcgdG8gIitkYi51cmkrIi9fY2hhbmdlcy4iCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBzdGFydCB0aGUgZmlyc3QgcmVxdWVzdAogICAgICAgICAgaWYgKHNpbmNlKSB7CiAgICAgICAgICAgIGdldENoYW5nZXNTaW5jZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGIuaW5mbyh7CiAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKGluZm8pIHsKICAgICAgICAgICAgICAgIHNpbmNlID0gaW5mby51cGRhdGVfc2VxOwogICAgICAgICAgICAgICAgZ2V0Q2hhbmdlc1NpbmNlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgYWxsRG9jczogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgdmFyIHR5cGUgPSAiR0VUIjsKICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgIGlmIChvcHRpb25zWyJrZXlzIl0pIHsKICAgICAgICAgICAgdHlwZSA9ICJQT1NUIjsKICAgICAgICAgICAgdmFyIGtleXMgPSBvcHRpb25zWyJrZXlzIl07CiAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zWyJrZXlzIl07CiAgICAgICAgICAgIGRhdGEgPSB0b0pTT04oeyAia2V5cyI6IGtleXMgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYWxsX2RvY3MiICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgcmV0cmlldmluZyBhIGxpc3Qgb2YgYWxsIGRvY3VtZW50cyIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBhbGxEZXNpZ25Eb2NzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICB0aGlzLmFsbERvY3MoJC5leHRlbmQoe3N0YXJ0a2V5OiJfZGVzaWduIiwgZW5ka2V5OiJfZGVzaWduMCJ9LCBvcHRpb25zKSk7CiAgICAgICAgfSwKICAgICAgICBhbGxBcHBzOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgIGlmIChvcHRpb25zLmVhY2hBcHApIHsKICAgICAgICAgICAgdGhpcy5hbGxEZXNpZ25Eb2NzKHsKICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgICAgICAgICAkLmVhY2gocmVzcC5yb3dzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgc2VsZi5vcGVuRG9jKHRoaXMuaWQsIHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkZG9jKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXgsIGFwcFBhdGgsIGFwcE5hbWUgPSBkZG9jLl9pZC5zcGxpdCgnLycpOwogICAgICAgICAgICAgICAgICAgICAgYXBwTmFtZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgICAgYXBwTmFtZSA9IGFwcE5hbWUuam9pbignLycpOwogICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBkZG9jLmNvdWNoYXBwICYmIGRkb2MuY291Y2hhcHAuaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwUGF0aCA9IFsnJywgbmFtZSwgZGRvYy5faWQsIGluZGV4XS5qb2luKCcvJyk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRkb2MuX2F0dGFjaG1lbnRzICYmIGRkb2MuX2F0dGFjaG1lbnRzWyJpbmRleC5odG1sIl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwUGF0aCA9IFsnJywgbmFtZSwgZGRvYy5faWQsICJpbmRleC5odG1sIl0uam9pbignLycpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcFBhdGgpIG9wdGlvbnMuZWFjaEFwcChhcHBOYW1lLCBhcHBQYXRoLCBkZG9jKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2UgcHJvdmlkZSBhbiBlYWNoQXBwIGZ1bmN0aW9uIGZvciBhbGxBcHBzKCkiKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9wZW5Eb2M6IGZ1bmN0aW9uKGRvY0lkLCBvcHRpb25zLCBhamF4T3B0aW9ucykgewogICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICBpZiAoZGJfb3B0cy5hdHRhY2hQcmV2UmV2IHx8IG9wdGlvbnMuYXR0YWNoUHJldlJldikgewogICAgICAgICAgICAkLmV4dGVuZChvcHRpb25zLCB7CiAgICAgICAgICAgICAgYmVmb3JlU3VjY2VzcyA6IGZ1bmN0aW9uKHJlcSwgZG9jKSB7CiAgICAgICAgICAgICAgICByYXdEb2NzW2RvYy5faWRdID0gewogICAgICAgICAgICAgICAgICByZXYgOiBkb2MuX3JldiwKICAgICAgICAgICAgICAgICAgcmF3IDogcmVxLnJlc3BvbnNlVGV4dAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJC5leHRlbmQob3B0aW9ucywgewogICAgICAgICAgICAgIGJlZm9yZVN1Y2Nlc3MgOiBmdW5jdGlvbihyZXEsIGRvYykgewogICAgICAgICAgICAgICAgaWYgKGRvY1sianF1ZXJ5LmNvdWNoLmF0dGFjaFByZXZSZXYiXSkgewogICAgICAgICAgICAgICAgICByYXdEb2NzW2RvYy5faWRdID0gewogICAgICAgICAgICAgICAgICAgIHJldiA6IGRvYy5fcmV2LAogICAgICAgICAgICAgICAgICAgIHJhdyA6IHJlcS5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYWpheCh7dXJsOiB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvY0lkKSArIGVuY29kZU9wdGlvbnMob3B0aW9ucyl9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHNhdmVEb2M6IGZ1bmN0aW9uKGRvYywgb3B0aW9ucykgewogICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICB2YXIgZGIgPSB0aGlzOwogICAgICAgICAgdmFyIGJlZm9yZVNlbmQgPSBmdWxsQ29tbWl0KG9wdGlvbnMpOwogICAgICAgICAgaWYgKGRvYy5faWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2YXIgbWV0aG9kID0gIlBPU1QiOwogICAgICAgICAgICB2YXIgdXJpID0gdGhpcy51cmk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWV0aG9kID0gIlBVVCI7CiAgICAgICAgICAgIHZhciB1cmkgPSB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvYy5faWQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHZlcnNpb25lZCA9IG1heWJlQXBwbHlWZXJzaW9uKGRvYyk7CiAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB0eXBlOiBtZXRob2QsIHVybDogdXJpICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKSwKICAgICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwgZGF0YTogdG9KU09OKGRvYyksCiAgICAgICAgICAgIGJlZm9yZVNlbmQgOiBiZWZvcmVTZW5kLAogICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3AgPSBodHRwRGF0YShyZXEsICJqc29uIik7CiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwIHx8IHJlcS5zdGF0dXMgPT0gMjAxIHx8IHJlcS5zdGF0dXMgPT0gMjAyKSB7CiAgICAgICAgICAgICAgICBkb2MuX2lkID0gcmVzcC5pZDsKICAgICAgICAgICAgICAgIGRvYy5fcmV2ID0gcmVzcC5yZXY7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbmVkKSB7CiAgICAgICAgICAgICAgICAgIGRiLm9wZW5Eb2MoZG9jLl9pZCwgewogICAgICAgICAgICAgICAgICAgIGF0dGFjaFByZXZSZXYgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICBkb2MuX2F0dGFjaG1lbnRzID0gZC5fYXR0YWNobWVudHM7CiAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IocmVxLnN0YXR1cywgcmVzcC5lcnJvciwgcmVzcC5yZWFzb24pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydCgiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSBzYXZlZDogIiArIHJlc3AucmVhc29uKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYnVsa1NhdmU6IGZ1bmN0aW9uKGRvY3MsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBiZWZvcmVTZW5kID0gZnVsbENvbW1pdChvcHRpb25zKTsKICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtzdWNjZXNzU3RhdHVzOiAyMDEsIGJlZm9yZVNlbmQgOiBiZWZvcmVTZW5kfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYnVsa19kb2NzIiArIGVuY29kZU9wdGlvbnMob3B0aW9ucyksCiAgICAgICAgICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwgZGF0YTogdG9KU09OKGRvY3MpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgZG9jdW1lbnRzIGNvdWxkIG5vdCBiZSBzYXZlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmVEb2M6IGZ1bmN0aW9uKGRvYywgb3B0aW9ucykgewogICAgICAgICAgYWpheCh7CiAgICAgICAgICAgICAgdHlwZTogIkRFTEVURSIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArCiAgICAgICAgICAgICAgICAgICBlbmNvZGVEb2NJZChkb2MuX2lkKSArCiAgICAgICAgICAgICAgICAgICBlbmNvZGVPcHRpb25zKHtyZXY6IGRvYy5fcmV2fSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIlRoZSBkb2N1bWVudCBjb3VsZCBub3QgYmUgZGVsZXRlZCIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBidWxrUmVtb3ZlOiBmdW5jdGlvbihkb2NzLCBvcHRpb25zKXsKICAgICAgICAgIGRvY3MuZG9jcyA9ICQuZWFjaCgKICAgICAgICAgICAgZG9jcy5kb2NzLCBmdW5jdGlvbihpLCBkb2MpewogICAgICAgICAgICAgIGRvYy5fZGVsZXRlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICk7CiAgICAgICAgICAkLmV4dGVuZChvcHRpb25zLCB7c3VjY2Vzc1N0YXR1czogMjAxfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfYnVsa19kb2NzIiArIGVuY29kZU9wdGlvbnMob3B0aW9ucyksCiAgICAgICAgICAgICAgZGF0YTogdG9KU09OKGRvY3MpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgICJUaGUgZG9jdW1lbnRzIGNvdWxkIG5vdCBiZSBkZWxldGVkIgogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIGNvcHlEb2M6IGZ1bmN0aW9uKGRvY0lkLCBvcHRpb25zLCBhamF4T3B0aW9ucykgewogICAgICAgICAgYWpheE9wdGlvbnMgPSAkLmV4dGVuZChhamF4T3B0aW9ucywgewogICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3AgPSBodHRwRGF0YShyZXEsICJqc29uIik7CiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAxKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmVycm9yKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmVycm9yKHJlcS5zdGF0dXMsIHJlc3AuZXJyb3IsIHJlc3AucmVhc29uKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWxlcnQoIlRoZSBkb2N1bWVudCBjb3VsZCBub3QgYmUgY29waWVkOiAiICsgcmVzcC5yZWFzb24pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiAiQ09QWSIsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArIGVuY29kZURvY0lkKGRvY0lkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIGRvY3VtZW50IGNvdWxkIG5vdCBiZSBjb3BpZWQiLAogICAgICAgICAgICBhamF4T3B0aW9ucwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHF1ZXJ5OiBmdW5jdGlvbihtYXBGdW4sIHJlZHVjZUZ1biwgbGFuZ3VhZ2UsIG9wdGlvbnMpIHsKICAgICAgICAgIGxhbmd1YWdlID0gbGFuZ3VhZ2UgfHwgImphdmFzY3JpcHQiOwogICAgICAgICAgaWYgKHR5cGVvZihtYXBGdW4pICE9PSAic3RyaW5nIikgewogICAgICAgICAgICBtYXBGdW4gPSBtYXBGdW4udG9Tb3VyY2UgPyBtYXBGdW4udG9Tb3VyY2UoKSA6ICIoIiArIG1hcEZ1bi50b1N0cmluZygpICsgIikiOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJvZHkgPSB7bGFuZ3VhZ2U6IGxhbmd1YWdlLCBtYXA6IG1hcEZ1bn07CiAgICAgICAgICBpZiAocmVkdWNlRnVuICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZihyZWR1Y2VGdW4pICE9PSAic3RyaW5nIikKICAgICAgICAgICAgICByZWR1Y2VGdW4gPSByZWR1Y2VGdW4udG9Tb3VyY2UgPyByZWR1Y2VGdW4udG9Tb3VyY2UoKSA6ICIoIiArIHJlZHVjZUZ1bi50b1N0cmluZygpICsgIikiOwogICAgICAgICAgICBib2R5LnJlZHVjZSA9IHJlZHVjZUZ1bjsKICAgICAgICAgIH0KICAgICAgICAgIGFqYXgoewogICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICB1cmw6IHRoaXMudXJpICsgIl90ZW1wX3ZpZXciICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKSwKICAgICAgICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLCBkYXRhOiB0b0pTT04oYm9keSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHF1ZXJ5aW5nIHRoZSBkYXRhYmFzZSIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBsaXN0OiBmdW5jdGlvbihsaXN0LCB2aWV3LCBvcHRpb25zKSB7CiAgICAgICAgICB2YXIgbGlzdCA9IGxpc3Quc3BsaXQoJy8nKTsKICAgICAgICAgIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIHZhciB0eXBlID0gJ0dFVCc7CiAgICAgICAgICB2YXIgZGF0YSA9IG51bGw7CiAgICAgICAgICBpZiAob3B0aW9uc1sna2V5cyddKSB7CiAgICAgICAgICAgIHR5cGUgPSAnUE9TVCc7CiAgICAgICAgICAgIHZhciBrZXlzID0gb3B0aW9uc1sna2V5cyddOwogICAgICAgICAgICBkZWxldGUgb3B0aW9uc1sna2V5cyddOwogICAgICAgICAgICBkYXRhID0gdG9KU09OKHsna2V5cyc6IGtleXMgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICdfZGVzaWduLycgKyBsaXN0WzBdICsKICAgICAgICAgICAgICAgICAgICcvX2xpc3QvJyArIGxpc3RbMV0gKyAnLycgKyB2aWV3ICsgZW5jb2RlT3B0aW9ucyhvcHRpb25zKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb3B0aW9ucywgJ0FuIGVycm9yIG9jY3VyZWQgYWNjZXNzaW5nIHRoZSBsaXN0JwogICAgICAgICAgKTsKICAgICAgICB9LAogICAgICAgIHZpZXc6IGZ1bmN0aW9uKG5hbWUsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBuYW1lID0gbmFtZS5zcGxpdCgnLycpOwogICAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIHR5cGUgPSAiR0VUIjsKICAgICAgICAgIHZhciBkYXRhPSBudWxsOwogICAgICAgICAgaWYgKG9wdGlvbnNbImtleXMiXSkgewogICAgICAgICAgICB0eXBlID0gIlBPU1QiOwogICAgICAgICAgICB2YXIga2V5cyA9IG9wdGlvbnNbImtleXMiXTsKICAgICAgICAgICAgZGVsZXRlIG9wdGlvbnNbImtleXMiXTsKICAgICAgICAgICAgZGF0YSA9IHRvSlNPTih7ICJrZXlzIjoga2V5cyB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhamF4KHsKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgdXJsOiB0aGlzLnVyaSArICJfZGVzaWduLyIgKyBuYW1lWzBdICsKICAgICAgICAgICAgICAgICAgICIvX3ZpZXcvIiArIG5hbWVbMV0gKyBlbmNvZGVPcHRpb25zKG9wdGlvbnMpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnMsICJBbiBlcnJvciBvY2N1cnJlZCBhY2Nlc3NpbmcgdGhlIHZpZXciCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgZ2V0RGJQcm9wZXJ0eTogZnVuY3Rpb24ocHJvcE5hbWUsIG9wdGlvbnMsIGFqYXhPcHRpb25zKSB7CiAgICAgICAgICBhamF4KHt1cmw6IHRoaXMudXJpICsgcHJvcE5hbWUgKyBlbmNvZGVPcHRpb25zKG9wdGlvbnMpfSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgIlRoZSBwcm9wZXJ0eSBjb3VsZCBub3QgYmUgcmV0cmlldmVkIiwKICAgICAgICAgICAgYWpheE9wdGlvbnMKICAgICAgICAgICk7CiAgICAgICAgfSwKCiAgICAgICAgc2V0RGJQcm9wZXJ0eTogZnVuY3Rpb24ocHJvcE5hbWUsIHByb3BWYWx1ZSwgb3B0aW9ucywgYWpheE9wdGlvbnMpIHsKICAgICAgICAgIGFqYXgoewogICAgICAgICAgICB0eXBlOiAiUFVUIiwgCiAgICAgICAgICAgIHVybDogdGhpcy51cmkgKyBwcm9wTmFtZSArIGVuY29kZU9wdGlvbnMob3B0aW9ucyksCiAgICAgICAgICAgIGRhdGEgOiBKU09OLnN0cmluZ2lmeShwcm9wVmFsdWUpCiAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICAiVGhlIHByb3BlcnR5IGNvdWxkIG5vdCBiZSB1cGRhdGVkIiwKICAgICAgICAgICAgYWpheE9wdGlvbnMKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwKCiAgICBlbmNvZGVEb2NJZDogZW5jb2RlRG9jSWQsIAoKICAgIGluZm86IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgYWpheCgKICAgICAgICB7dXJsOiB0aGlzLnVybFByZWZpeCArICIvIn0sCiAgICAgICAgb3B0aW9ucywKICAgICAgICAiU2VydmVyIGluZm9ybWF0aW9uIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQiCiAgICAgICk7CiAgICB9LAoKICAgIHJlcGxpY2F0ZTogZnVuY3Rpb24oc291cmNlLCB0YXJnZXQsIGFqYXhPcHRpb25zLCByZXBPcHRzKSB7CiAgICAgIHJlcE9wdHMgPSAkLmV4dGVuZCh7c291cmNlOiBzb3VyY2UsIHRhcmdldDogdGFyZ2V0fSwgcmVwT3B0cyk7CiAgICAgIGlmIChyZXBPcHRzLmNvbnRpbnVvdXMgJiYgIXJlcE9wdHMuY2FuY2VsKSB7CiAgICAgICAgYWpheE9wdGlvbnMuc3VjY2Vzc1N0YXR1cyA9IDIwMjsKICAgICAgfQogICAgICBhamF4KHsKICAgICAgICAgIHR5cGU6ICJQT1NUIiwgdXJsOiB0aGlzLnVybFByZWZpeCArICIvX3JlcGxpY2F0ZSIsCiAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXBPcHRzKSwKICAgICAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICB9LAogICAgICAgIGFqYXhPcHRpb25zLAogICAgICAgICJSZXBsaWNhdGlvbiBmYWlsZWQiCiAgICAgICk7CiAgICB9LAoKICAgIG5ld1VVSUQ6IGZ1bmN0aW9uKGNhY2hlTnVtKSB7CiAgICAgIGlmIChjYWNoZU51bSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY2FjaGVOdW0gPSAxOwogICAgICB9CiAgICAgIGlmICghdXVpZENhY2hlLmxlbmd0aCkgewogICAgICAgIGFqYXgoe3VybDogdGhpcy51cmxQcmVmaXggKyAiL191dWlkcyIsIGRhdGE6IHtjb3VudDogY2FjaGVOdW19LCBhc3luYzogZmFsc2V9LCB7CiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICAgICAgICB1dWlkQ2FjaGUgPSByZXNwLnV1aWRzOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgIkZhaWxlZCB0byByZXRyaWV2ZSBVVUlEIGJhdGNoLiIKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiB1dWlkQ2FjaGUuc2hpZnQoKTsKICAgIH0KICB9KTsKCiAgdmFyIGh0dHBEYXRhID0gJC5odHRwRGF0YSB8fCBmdW5jdGlvbiggeGhyLCB0eXBlLCBzICkgeyAvLyBsaWZ0ZWQgZnJvbSBqcTEuNC40CiAgICB2YXIgY3QgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoImNvbnRlbnQtdHlwZSIpIHx8ICIiLAogICAgICB4bWwgPSB0eXBlID09PSAieG1sIiB8fCAhdHlwZSAmJiBjdC5pbmRleE9mKCJ4bWwiKSA+PSAwLAogICAgICBkYXRhID0geG1sID8geGhyLnJlc3BvbnNlWE1MIDogeGhyLnJlc3BvbnNlVGV4dDsKCiAgICBpZiAoIHhtbCAmJiBkYXRhLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSA9PT0gInBhcnNlcmVycm9yIiApIHsKICAgICAgJC5lcnJvciggInBhcnNlcmVycm9yIiApOwogICAgfQogICAgaWYgKCBzICYmIHMuZGF0YUZpbHRlciApIHsKICAgICAgZGF0YSA9IHMuZGF0YUZpbHRlciggZGF0YSwgdHlwZSApOwogICAgfQogICAgaWYgKCB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgKSB7CiAgICAgIGlmICggdHlwZSA9PT0gImpzb24iIHx8ICF0eXBlICYmIGN0LmluZGV4T2YoImpzb24iKSA+PSAwICkgewogICAgICAgIGRhdGEgPSAkLnBhcnNlSlNPTiggZGF0YSApOwogICAgICB9IGVsc2UgaWYgKCB0eXBlID09PSAic2NyaXB0IiB8fCAhdHlwZSAmJiBjdC5pbmRleE9mKCJqYXZhc2NyaXB0IikgPj0gMCApIHsKICAgICAgICAkLmdsb2JhbEV2YWwoIGRhdGEgKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfTsKCiAgZnVuY3Rpb24gYWpheChvYmosIG9wdGlvbnMsIGVycm9yTWVzc2FnZSwgYWpheE9wdGlvbnMpIHsKCiAgICB2YXIgZGVmYXVsdEFqYXhPcHRzID0gewogICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICBoZWFkZXJzOnsiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24ifQogICAgfTsKCiAgICBvcHRpb25zID0gJC5leHRlbmQoe3N1Y2Nlc3NTdGF0dXM6IDIwMH0sIG9wdGlvbnMpOwogICAgYWpheE9wdGlvbnMgPSAkLmV4dGVuZChkZWZhdWx0QWpheE9wdHMsIGFqYXhPcHRpb25zKTsKICAgIGVycm9yTWVzc2FnZSA9IGVycm9yTWVzc2FnZSB8fCAiVW5rbm93biBlcnJvciI7CiAgICByZXR1cm4gJC5hamF4KCQuZXh0ZW5kKCQuZXh0ZW5kKHsKICAgICAgdHlwZTogIkdFVCIsIGRhdGFUeXBlOiAianNvbiIsIGNhY2hlIDogISQuYnJvd3Nlci5tc2llLAogICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbih4aHIpewogICAgICAgIGlmKGFqYXhPcHRpb25zICYmIGFqYXhPcHRpb25zLmhlYWRlcnMpewogICAgICAgICAgZm9yICh2YXIgaGVhZGVyIGluIGFqYXhPcHRpb25zLmhlYWRlcnMpewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIsIGFqYXhPcHRpb25zLmhlYWRlcnNbaGVhZGVyXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVxKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciByZXNwID0gaHR0cERhdGEocmVxLCAianNvbiIpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgaWYgKG9wdGlvbnMuZXJyb3IpIHsKICAgICAgICAgICAgb3B0aW9ucy5lcnJvcihyZXEuc3RhdHVzLCByZXEsIGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxlcnQoZXJyb3JNZXNzYWdlICsgIjogIiArIGUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5hamF4U3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuYWpheFN0YXJ0KHJlc3ApOwogICAgICAgIH0KICAgICAgICBpZiAocmVxLnN0YXR1cyA9PSBvcHRpb25zLnN1Y2Nlc3NTdGF0dXMpIHsKICAgICAgICAgIGlmIChvcHRpb25zLmJlZm9yZVN1Y2Nlc3MpIG9wdGlvbnMuYmVmb3JlU3VjY2VzcyhyZXEsIHJlc3ApOwogICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2Vzcykgb3B0aW9ucy5zdWNjZXNzKHJlc3ApOwogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5lcnJvcikgewogICAgICAgICAgb3B0aW9ucy5lcnJvcihyZXEuc3RhdHVzLCByZXNwICYmIHJlc3AuZXJyb3IgfHwgZXJyb3JNZXNzYWdlLCByZXNwICYmIHJlc3AucmVhc29uIHx8ICJubyByZXNwb25zZSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGVydChlcnJvck1lc3NhZ2UgKyAiOiAiICsgcmVzcC5yZWFzb24pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgb2JqKSwgYWpheE9wdGlvbnMpKTsKICB9CgogIGZ1bmN0aW9uIGZ1bGxDb21taXQob3B0aW9ucykgewogICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgaWYgKHR5cGVvZiBvcHRpb25zLmVuc3VyZV9mdWxsX2NvbW1pdCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgdmFyIGNvbW1pdCA9IG9wdGlvbnMuZW5zdXJlX2Z1bGxfY29tbWl0OwogICAgICBkZWxldGUgb3B0aW9ucy5lbnN1cmVfZnVsbF9jb21taXQ7CiAgICAgIHJldHVybiBmdW5jdGlvbih4aHIpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigiWC1Db3VjaC1GdWxsLUNvbW1pdCIsIGNvbW1pdC50b1N0cmluZygpKTsKICAgICAgfTsKICAgIH0KICB9OwoKICAvLyBDb252ZXJ0IGEgb3B0aW9ucyBvYmplY3QgdG8gYW4gdXJsIHF1ZXJ5IHN0cmluZy4KICAvLyBleDoge2tleTondmFsdWUnLGtleTI6J3ZhbHVlMid9IGJlY29tZXMgJz9rZXk9InZhbHVlIiZrZXkyPSJ2YWx1ZTIiJwogIGZ1bmN0aW9uIGVuY29kZU9wdGlvbnMob3B0aW9ucykgewogICAgdmFyIGJ1ZiA9IFtdOwogICAgaWYgKHR5cGVvZihvcHRpb25zKSA9PT0gIm9iamVjdCIgJiYgb3B0aW9ucyAhPT0gbnVsbCkgewogICAgICBmb3IgKHZhciBuYW1lIGluIG9wdGlvbnMpIHsKICAgICAgICBpZiAoJC5pbkFycmF5KG5hbWUsIFsiZXJyb3IiLCAic3VjY2VzcyIsICJiZWZvcmVTdWNjZXNzIiwgImFqYXhTdGFydCJdKSA+PSAwKQogICAgICAgICAgY29udGludWU7CiAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9uc1tuYW1lXTsKICAgICAgICBpZiAoJC5pbkFycmF5KG5hbWUsIFsia2V5IiwgInN0YXJ0a2V5IiwgImVuZGtleSJdKSA+PSAwKSB7CiAgICAgICAgICB2YWx1ZSA9IHRvSlNPTih2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJ1Zi5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChuYW1lKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYnVmLmxlbmd0aCA/ICI/IiArIGJ1Zi5qb2luKCImIikgOiAiIjsKICB9CgogIGZ1bmN0aW9uIHRvSlNPTihvYmopIHsKICAgIHJldHVybiBvYmogIT09IG51bGwgPyBKU09OLnN0cmluZ2lmeShvYmopIDogbnVsbDsKICB9Cgp9KShqUXVlcnkpOwo=", "content_type": "application/javascript"}, "app/templates/example.html": {"data": "PGhlYWRlcj4KICA8aW1nIHNyYz0iYXNzZXRzL2ltZy9iYWNrYm9uZS5wbmciPgogIDxocj4KICAKICA8ZGl2PgogICAgPGgyIGNsYXNzPSJjb25ncmF0cyI+Q29uZ3JhdHVsYXRpb25zITwvaDI+CiAgICA8aDI+U2VlaW5nIHRoaXMgbWVhbnMgeW91IGhhdmUgaW5zdGFsbGVkIEJhY2tib25lIEJvaWxlcnBsYXRlIGNvcnJlY3RseS48L2gyPgoKICAgIDxwPk5vdyB0aGF0IHlvdSBoYXZlIHRoZSBlYXNpZXN0IGFuZCBtb3N0LXBvd2VyZnVsIEJhY2tib25lIGJvaWxlcnBsYXRlIGF2YWlsYWJsZSwKICAgIHlvdSdyZSBwcm9iYWJseSB3b25kZXJpbmcgaG93IHRvIHVzZSBpdCB0byBzdGFydCBidWlsZGluZyBhcHBsaWNhdGlvbnMuLi48L3A+CiAgPC9kaXY+CjwvaGVhZGVyPgoKPHNlY3Rpb24gaWQ9InRvYyI+CiAgPGgxPkNvbnRlbnRzPC9oMT4KCiAgPHVsPgogICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiNvdmVydmlldyI+T3ZlcnZpZXc8L2E+CiAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2dldHRpbmctaGVscCI+R2V0dGluZyBoZWxwPC9hPgogICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiN3cml0aW5nLWFwcCI+V3JpdGluZyB5b3VyIGFwcGxpY2F0aW9uPC9hPgogICAgICA8dWwgY2xhc3M9Im5lc3RlZCI+CiAgICAgICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiNjbGVhbmluZyI+Q2xlYW5pbmcgb3V0IGRlZmF1bHQgZmlsZXMgYW5kIGNvZGU8L2E+CiAgICAgICAgPHVsIGNsYXNzPSJuZXN0ZWQiPgogICAgICAgICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiNnaXQtaGlzdG9yeSI+UmVtb3ZpbmcgdGhlIEdpdCBoaXN0b3J5PC9hPgogICAgICAgICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiN0ZXN0LWRpciI+UmVtb3ZpbmcgdGhlIHRlc3QgZGlyZWN0b3J5PC9hPgogICAgICAgICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiNidWlsZC1wcm9jZXNzIj5SZW1vdmluZyB0aGUgYnVpbGQgcHJvY2VzczwvYT4KICAgICAgICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjZmF2aWNvbiI+Q2hhbmdpbmcgdGhlIEZhdmljb248L2E+CiAgICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2FwcC1jb2RlIj5SZW1vdmluZyBkZWZhdWx0IGFwcGxpY2F0aW9uIGNvZGU8L2E+CiAgICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2RlZmF1bHQtcm91dGVzIj5SZW1vdmluZyB0aGUgZGVmYXVsdCByb3V0ZXM8L2E+CiAgICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2RlZmF1bHQtYXNzZXRzIj5SZW1vdmluZyBkZWZhdWx0IGFzc2V0czwvYT4KICAgICAgICA8L3VsPgogICAgICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjbmFtZXNwYWNlIj5OYW1lc3BhY2U8L2E+CiAgICAgICAgPGxpPjxhIGRhdGEtYnlwYXNzIGhyZWY9IiNtb2R1bGVzIj5DcmVhdGluZyBhIG1vZHVsZTwvYT4KICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI3RlbXBsYXRlcyI+V29ya2luZyB3aXRoIHRlbXBsYXRlczwvYT4KICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2V2ZW50cyI+V29ya2luZyB3aXRoIEFwcGxpY2F0aW9uIFdpZGUgRXZlbnRzPC9hPgogICAgICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjcGx1Z2lucyI+V29ya2luZyB3aXRoIGxpYnJhcmllcyBhbmQgcGx1Z2luczwvYT4KICAgICAgPC91bD4KICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjY3VzdG9tLWJ1aWxkIj5Vc2luZyB0aGUgYnVpbGQgdG9vbDwvYT4KICAgICAgPHVsIGNsYXNzPSJuZXN0ZWQiPgogICAgICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjcnVubmluZyI+UnVubmluZyB3aXRoIHRoZSBkZWZhdWx0czwvYT4KICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2N1c3RvbWl6aW5nIj5DdXN0b21pemluZyB0aGUgYnVpbGQgY29uZmlndXJhdGlvbjwvYT4KICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI3NlcnZlciI+VXNpbmcgdGhlIGRldmVsb3BtZW50IHNlcnZlcjwvYT4KICAgICAgICA8bGk+PGEgZGF0YS1ieXBhc3MgaHJlZj0iI2FkZGluZy10YXNrcyI+QWRkaW5nIG5ldyB0YXNrczwvYT4KICAgICAgPC91bD4KICAgIDxsaT48YSBkYXRhLWJ5cGFzcyBocmVmPSIjdXNlZnVsLXJlc291cmNlcyI+VXNlZnVsIFJlc291cmNlczwvYT4KICA8L3VsPgo8L3NlY3Rpb24+Cgo8c2VjdGlvbj4KICA8aDIgaWQ9Im92ZXJ2aWV3Ij5PdmVydmlldzwvaDI+CgogIDxwPkJhY2tib25lIEJvaWxlcnBsYXRlIGlzIHRoZSBwcm9kdWN0IG9mIG11Y2ggcmVzZWFyY2ggYW5kIGZydXN0cmF0aW9uLiBXaGlsZQogIGV4aXN0aW5nIGJvaWxlcnBsYXRlcyBmb3IgQmFja2JvbmUgZXhpc3QsIHRoZXkgd2lsbCBvZnRlbiBtb2RpZnkgdGhlIEJhY2tib25lCiAgY29yZSwgZG9uJ3QgaGF2ZSBhbiBpbnRlZ3JhdGVkIGJ1aWxkIHN5c3RlbSwgb3IgaW1wb3NlIHRvbyBtdWNoIG9uIHlvdXIKICBhcHBsaWNhdGlvbidzIHN0cnVjdHVyZS4gVGhpcyBib2lsZXJwbGF0ZSBhdHRlbXB0cyB0byBpbXByb3ZlIHRoYXQuCgogIE9yZ2FuaXplIHlvdXIgYXBwbGljYXRpb24gaW4gYSBsb2dpY2FsIGZpbGVzeXN0ZW0sIGFuZCBkZXZlbG9wIE1vZGVscywKICBDb2xsZWN0aW9ucywgVmlld3MsIGFuZCBSb3V0ZXJzIGluc2lkZSBtb2R1bGVzLiBCdWlsZCB5b3VyIGFwcGxpY2F0aW9uIGtub3dpbmcKICB5b3UgaGF2ZSBlZmZpY2llbnQsIGNvbXBhY3QgY29kZS4gQmFja2JvbmUgQm9pbGVycGxhdGUgZXh0ZW5kcyBvbiB0aGUKICB2ZXJzYXRpbGUgQmFja2JvbmUgY29yZSwgYW5kIGhlbHBzIGRldmVsb3BlcnMgbWFuYWdlIHRoZWlyIGFwcGxpY2F0aW9uLjwvcD4KCiAgPGgzIGlkPSJjb3JlLWZlYXR1cmVzIj5Db3JlIEZlYXR1cmVzPC9oMz4KICA8dWw+CiAgICA8bGk+PGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9oNWJwL2h0bWw1LWJvaWxlcnBsYXRlIj5IVE1MNSBCb2lsZXJwbGF0ZTwvYT4gaW5jbHVkZWQuCiAgICA8bGk+TWFuYWdlZCBmaWxlc3lzdGVtIHN0cnVjdHVyZSBmb3IgYXBwbGljYXRpb24gY29kZSwgYXNzZXRzLCB0ZXN0cywgYW5kIGRpc3RyaWJ1dGlvbi4KICAgIDxsaT5TbmlwcGV0cyB0byBtYWtlIGNvbW1vbiB0YXNrcyBlYXNpZXI6IG1vZHVsZXMsIEhUTUw1IEhpc3RvcnkgQVBJL0hhc2ggbmF2aWdhdGlvbiwgdGVtcGxhdGUgbG9hZGluZyBhbmQgYXBwbGljYXRpb24gZXZlbnRzLgogICAgPGxpPkZsZXhpYmxlIGFuZCBleHRlbmRhYmxlIGJ1aWxkIHN5c3RlbS4KICAgICAgPHVsIGNsYXNzPSJuZXN0ZWQiPgogICAgICAgIDxsaT5Db25jYXRlbmF0ZSBhbmQgbWluaWZ5IGFsbCB5b3VyIGxpYnJhcmllcywgYXBwbGljYXRpb24gY29kZSwgdGVtcGxhdGVzIGFuZCBDU1MgZG93biB0byByZWR1Y2UgdHJhbnNtaXNzaW9uIHRpbWUuCiAgICAgICAgPGxpPkNvbXBpbGUgdW5kZXJzY29yZSB0ZW1wbGF0ZXMgdG8gcHJldmVudCBwcmUtcHJvY2Vzc2luZyBvbiB0aGUgY2xpZW50LgogICAgICA8L3VsPgogIDwvdWw+Cjwvc2VjdGlvbj4KCjxzZWN0aW9uPgogIDxoMiBpZD0iZ2V0dGluZy1oZWxwIj5HZXR0aW5nIGhlbHA8L2gyPgoKICA8cD5JZiB5b3UncmUgZW5jb3VudGVyaW5nIGlzc3VlcywgbmVlZCBhc3Npc3RhbmNlLCBvciBoYXZlIGEgcXVlc3Rpb24gdGhhdCBoYXNuJ3QgYmVlbiBhbnN3ZXJlZCBpbiB0aGlzCiAgdHV0b3JpYWwgb3IgPGEgdGFyZ2V0PSJibGFuayIgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3RicmFueWVuL2JhY2tib25lLWJvaWxlcnBsYXRlIj50aGUgR2l0SHViIHByb2plY3QgcGFnZTwvYT4KICB5b3UgbWF5IGZpbmQgaGVscCBpbiBvbmUgb2YgdGhlc2UgcGxhY2VzOjwvcD4KCiAgPHVsPgogICAgPGxpPklSQyAtICNiYWNrYm9uZS1ib2lsZXJwbGF0ZSBvbiBpcmMuZnJlZW5vZGUubmV0CiAgICA8bGk+PGEgdGFyZ2V0PSJibGFuayIgaHJlZj0iaHR0cDovL2dpdGh1Yi5jb20vdGJyYW55ZW4vYmFja2JvbmUtYm9pbGVycGxhdGUvaXNzdWVzIj5HaXRIdWIgSXNzdWVzPC9hPiAtIFBsZWFzZSByZXBvcnQgaWYgeW91J3ZlIGZvdW5kIGFuIGlzc3VlLAogICAgYnVnLCBvciBjb250cm92ZXJzaWFsIHJlcXVlc3QuCiAgPC91bD4KCiAgPHA+SSB3YW50IHRoaXMgcHJvamVjdCB0byBiZSB0aGUgYmVzdCBpdCBwb3NzaWJseSBjYW4gYW5kIHJlcHJlc2VudCB0aGUgaW50ZXJlc3RzIG9mIHRoZSBjb21tdW5pdHksIDxiPnBsZWFzZTwvYj4KICBzdWJtaXQgaXNzdWVzIHdpdGggZmVhdHVyZXMgeW91IGZpbmQgdXNlZnVsIGFuZCBhbnl0aGluZyB0aGF0IHlvdSBxdWVzdGlvbi48L3A+Cjwvc2VjdGlvbj4KCjxzZWN0aW9uPgogIDxoMiBpZD0id3JpdGluZy1hcHAiPldyaXRpbmcgeW91ciBhcHBsaWNhdGlvbjwvaDI+CiAgPHA+WW91ciBhcHBsaWNhdGlvbiBtYXkgYmUgbWFkZSB1cCBvZiB0aGlyZC1wYXJ0eSBsaWJyYXJpZXMsIHBsdWdpbnMsIGFwcGxpY2F0aW9uIGNvZGUsIHRlbXBsYXRlcywgYW5kIGxvdHMgb2YgbG9naWMuICBBbGwgb2YgdGhpcyB3aWxsIG5lZWQKICB0byBiZSB3ZWxsIHN0cnVjdHVyZWQgdG8ga2VlcCBpdCBtYWludGFpbmFibGUgYW5kIGl0IGFsc28gbmVlZHMgdG8gYmUgY29tcGlsZWQgaWYgZGVwbG95ZWQgaW50byBwcm9kdWN0aW9uLiAgQmVmb3JlIHlvdSBjYW4gZ2V0IHN0YXJ0ZWQgeW91CiAgd2lsbCBuZWVkIHRvIGNsZWFuIG91dCBhbGwgdGhlIGV4aXN0aW5nIGRlZmF1bHRzIHRoYXQgYXJlIGluIHRoZSBib2lsZXJwbGF0ZSBhcmUgbmVjZXNzYXJ5IHRvIGRpc3BsYXkgdGhpcyB0dXRvcmlhbC4KICA8L3A+CgogIDxwIGNsYXNzPSJjbHVlcyI+PGI+U3Ryb25nbHkgcmVjb21tZW5kIHlvdSByZWFkIHRocm91Z2ggdGhpcyB0dXRvcmlhbCBiZWZvcmUgY2xlYW5pbmcgb3V0IGFueSBmaWxlcyB0aGF0IG1heSBob2xkIGNsdWVzIG9uIGhvdyB0byB1c2UgdGhlIEJvaWxlcnBsYXRlLjwvYj48L3A+CgogIDxoMyBpZD0iY2xlYW5pbmciPkNsZWFuaW5nIG91dCBkZWZhdWx0IGZpbGVzIGFuZCBjb2RlPC9oMz4KICA8cD5UaGVyZSBhcmUgc2V2ZXJhbCBwbGFjZXMgd2hlcmUgY3VzdG9taXphdGlvbiBtYXkgYmUgcmVxdWlyZWQuPC9wPgoKICA8dWw+CiAgICA8bGk+PGg0IGlkPSJnaXQtaGlzdG9yeSI+UmVtb3ZpbmcgdGhlIEdpdCBoaXN0b3J5PC9oND4KICAgICAgPHA+SWYgeW91IGNsb25lZCB0aGUgQmFja2JvbmUgQm9pbGVycGxhdGUgd2l0aCBHaXQsIHlvdSBzaG91bGQgZGVsZXRlIHRoZSBnaXQgZGlyZWN0b3J5IGFuZCB0aGVuIGluaXRpYWxpemUgeW91ciBvd24gR2l0IGhpc3Rvcnk6CgogICAgICA8cHJlPjxjb2RlPgogICAgJCBybSAtcmYgLmdpdAogICAgJCBnaXQgaW5pdAogICAgICA8L2NvZGU+PC9wcmU+CiAgICAgIDwvcD4KCiAgICA8bGk+PGg0IGlkPSJ0ZXN0LWRpciI+UmVtb3ZpbmcgdGhlIHRlc3QgZGlyZWN0b3J5PC9oND4KICAgICAgPHA+SWYgeW91IGFyZSBub3QgcGxhbm5pbmcgb24gdGVzdGluZyB5b3VyIGFwcGxpY2F0aW9uIHdpdGggUVVuaXQgeW91IHNob3VsZCBkZWxldGUgdGhpcyBkaXJlY3RvcnkuPC9wPgoKICAgIDxsaT48aDQgaWQ9ImJ1aWxkLXByb2Nlc3MiPlJlbW92aW5nIHRoZSBidWlsZCBwcm9jZXNzPC9oND4KICAgICAgPHA+SWYgeW91IGFyZSBub3QgcGxhbm5pbmcgb24gdXNpbmcgdGhlIGJ1aWxkIHRvb2wsIGRlbGV0ZSB0aGUKICAgICAgPGNvZGU+Z3J1bnQuanM8L2NvZGU+IGZpbGUuICBJdCBjb250YWlucyBjb25maWd1cmF0aW9uIHlvdSB3aWxsIG5vdCBuZWVkLgogICAgICA8L3A+CgogICAgPGxpPjxoNCBpZD0iZmF2aWNvbiI+Q2hhbmdpbmcgdGhlIEZhdmljb248L2g0PgogICAgICA8cD5BdCB0aGUgcm9vdCBsZXZlbCBvZiB0aGUgcHJvamVjdCBzaW1wbHkgY2hhbmdlIHRoZSA8Y29kZT5mYXZpY29uLmljbzwvY29kZT4gZmlsZSB0byBwb2ludCB0byB5b3VyIG93biBicmFuZGVkIGljb24uPC9wPgoKICAgIDxsaT48aDQgaWQ9ImFwcC1jb2RlIj5SZW1vdmluZyBkZWZhdWx0IGFwcGxpY2F0aW9uIGNvZGU8L2g0PgogICAgICA8cD5UaGlzIHR1dG9yaWFsIGlzIHJlbmRlcmVkIGluIHRoZSA8Y29kZT5hcHAvbW9kdWxlcy9leGFtcGxlLmpzPC9jb2RlPiBmaWxlIGFuZCB3cml0dGVuIGluIDxjb2RlPmFwcC90ZW1wbGF0ZXMvZXhhbXBsZS5odG1sPC9jb2RlPi4KICAgICAgQm90aCBvZiB0aGVzZSBmaWxlcyBhcmUgc2FmZSB0byByZW1vdmUuPC9wPgoKICAgIDxsaT48aDQgaWQ9ImRlZmF1bHQtcm91dGVzIj5SZW1vdmluZyB0aGUgZGVmYXVsdCByb3V0ZXM8L2g0PgogICAgICA8cD5Sb3V0ZXMgYXJlIGRlZmluZWQgaW4gdGhlIDxjb2RlPmFwcC9tYWluLmpzPC9jb2RlPiBmaWxlLiAgRmFtaWxpYXJpemUgeW91cnNlbGYgd2l0aCBpdCdzIGNvbnRlbnRzLiAgWW91J2xsIG5vdGljZSB0aGUgZGVmYXVsdCByb3V0ZXIgaGFzIHR3byBleGlzdGluZyByb3V0ZXMgYW5kIGNhbGxiYWNrIGRlZmluZWQsIHJlc2V0IGl0IHRvOgoKICAgICAgPHByZT48Y29kZT4KICAgIC8vIERlZmluaW5nIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXIsIHlvdSBjYW4gYXR0YWNoIHN1YiByb3V0ZXJzIGhlcmUuCiAgICB2YXIgUm91dGVyID0gQmFja2JvbmUuUm91dGVyLmV4dGVuZCh7CiAgICAgIHJvdXRlczogewogICAgICAgICIiOiAiaW5kZXgiLAogICAgICB9LAoKICAgICAgaW5kZXg6IGZ1bmN0aW9uKCkgewogICAgICAgIC8vIFB1dCB5b3VyIGhvbWVwYWdlIHJvdXRlIGxvZ2ljIGhlcmUKICAgICAgfQogICAgfSk7CiAgICAgIDwvY29kZT48L3ByZT4KICAgICAgPC9wPgoKCiAgICAgIDxwPkFib3ZlIHRoZSBSb3V0ZXIgZGVmaW5pdGlvbiB5b3UnbGwgc2VlIGEgcmVmZXJlbmNlIHRvIHRoZSBleGFtcGxlIG1vZHVsZSwKICAgICAgdGhpcyBpcyBzYWZlIHRvIGRlbGV0ZSBhcyB3ZWxsLgoKICAgICAgPHByZT48Y29kZT4KICAgIC8vIEluY2x1ZGUgdGhlIGV4YW1wbGUgbW9kdWxlCiAgICB2YXIgRXhhbXBsZSA9IG5hbWVzcGFjZS5tb2R1bGUoImV4YW1wbGUiKTsKICAgICAgPC9jb2RlPjwvcHJlPgogICAgICA8L3A+CiAgCiAgICA8bGk+PGg0IGlkPSJkZWZhdWx0LWFzc2V0cyI+UmVtb3ZpbmcgZGVmYXVsdCBhc3NldHM8L2g0PgogICAgICA8cD5UaGUgZGVmYXVsdCBzdHlsZXMgZm9yIHRoaXMgdHV0b3JpYWwgYXJlIHN0b3JlZCBpbiA8Y29kZT5hc3NldHMvY3NzL3N0eWxlLmNzczwvY29kZT4uICBZb3Ugd2lsbCBwcm9iYWJseSB3YW50IHRvIHJlbW92ZSB0aGVzZSBzaW5jZSB0aGV5IG9ubHkgbWFrZSBzZW5zZSBmb3IgdGhpcyBzcGVjaWZpYyBwYWdlLiAgVGhleSBzdGFydCBvbiA8Y29kZT5MaW5lIDIwOTwvY29kZT4uICBXaXRoIHRoZSBmb2xsb3dpbmcgSDVCUCBoZWFkZXI6CgogICAgICA8cHJlPjxjb2RlPgogICAgLyogPT18PT0gcHJpbWFyeSBzdHlsZXMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgIEF1dGhvcjogQmFja2JvbmUgQm9pbGVycGxhdGUgPENoYW5nZSB0byB5b3VyIE5hbWU+CiAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogICAgIDwvY29kZT48L3ByZT4KICAgICA8L3A+CgogICAgIDxwPllvdSBtYXkgYWxzbyB3YW50IHRvIGNoYW5nZSB0aGUgbmFtZSB0byB5b3VycywgaWYgeW91J3JlIHBsYW5uaW5nIG9uIHB1dHRpbmcgeW91ciBjdXN0b20gQ1NTIGhlcmUgYXMgd2VsbC48L3A+CgogICAgIDxwPllvdSBzaG91bGQgZGVsZXRlIHRoZSA8Y29kZT5hc3NldHMvaW1nL2JhY2tib25lLnBuZzwvY29kZT4gZmlsZSBpZiB5b3UgYXJlIG5vdCBwbGFubmluZyBvbiB1c2luZyBpdCBpbiB5b3VyIGFwcC48L3A+CiAgPC91bD4KCiAgPGgzIGlkPSJuYW1lc3BhY2UiPk5hbWVzcGFjZTwvaDM+CiAgPHA+VGhlIDxjb2RlPm5hbWVzcGFjZS5qczwvY29kZT4gZmlsZSBpcyB2ZXJ5IGltcG9ydGFudCBzaW5jZSBpdCBjb250YWlucyBsb2dpYyB0aGF0IHNob3VsZAogIGV4aXN0IGZvciBldmVyeSBtb2R1bGUgaW4geW91ciBhcHBsaWNhdGlvbi4gIFRoaXMgYWxzbyBjb250YWlucyB0aGUgPGNvZGU+bW9kdWxlPC9jb2RlPgogIHNob3J0Y3V0IGZ1bmN0aW9uIGFuZCA8Y29kZT5mZXRjaFRlbXBsYXRlPC9jb2RlPiBmdW5jdGlvbi48L3A+CiAgPC9wPgoKICA8aDMgaWQ9Im1vZHVsZXMiPkNyZWF0aW5nIGEgbW9kdWxlPC9oMz4KICA8cD5Gb2xsb3dpbmcgdGhlIEJvY291cCBwb3N0IG9uIDxhIGRhdGEtYnlwYXNzIHRhcmdldD0iX2JsYW5rIiBocmVmPSJodHRwOi8vd2VibG9nLmJvY291cC5jb20vb3JnYW5pemluZy15b3VyLWJhY2tib25lLWpzLWFwcGxpY2F0aW9uLXdpdGgtbW9kdWxlcyI+T3JnYW5pemluZyBZb3VyIEJhY2tib25lLmpzIEFwcGxpY2F0aW9uIFdpdGggTW9kdWxlczwvYT4gdGhpcyBib2lsZXJwbGF0ZSBwcm92aWRlcyB0aGUgc2FtZSBtb2R1bGUgZGVmaW5pdGlvbiBzdHJ1Y3R1cmUuCgogIE1vZHVsZXMgYXJlIHBsYWNlZCBpbiB0aGUgPGNvZGU+YXBwL21vZHVsZXMvPC9jb2RlPiBkaXJlY3RvcnkuICBUaGVyZSBpcyBhbiBleGFtcGxlIG1vZHVsZQogIHRoZXJlIG5hbWVkOiA8Y29kZT5leGFtcGxlLmpzPC9jb2RlPi4gIFRoZSBhY3R1YWwgbW9kdWxlIGRlZmluaXRpb24gZnVuY3Rpb24gaXMgbG9jYXRlZAogIGluc2lkZSB0aGUgPGNvZGU+YXBwL2luZGV4LmpzPC9jb2RlPiBmaWxlLiAgWW91IGNyZWF0ZSBhbmQgcmVmZXJlbmNlIG1vZHVsZXMgd2l0aCB0aGUgc2FtZQogIGZ1bmN0aW9uIGNhbGw6ICA8Y29kZT5uYW1lc3BhY2UubW9kdWxlKCZxdW90OyZsdDttb2R1bGVfbmFtZSZndDsmcXVvdDspPC9jb2RlPi4KCiAgVHlwaWNhbGx5IGEgbW9kdWxlIGNvbnRhaW5zIGEgc2luZ2xlIE1vZGVsL0NvbGxlY3Rpb24vUm91dGVyIGFuZCBtYW55IFZpZXdzLgogIFRoZXJlZm9yZSB0aGUgcmV0dXJuZWQgbW9kdWxlIG9iamVjdCBpcyBlbXB0eSBleGNlcHQgZm9yIGEgVmlld3Mgb2JqZWN0CiAgcHJvcGVydHkgdGhhdCBjYW4gYmUgdXNlZCB0byBhdHRhY2ggbWFueSBWaWV3cyB0bywgbGlrZToKCiAgPHByZT48Y29kZT4KICBNeU1vZHVsZS5WaWV3cy5EZXRhaWxlZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsgLyogLi4uICovIH0pOwoKICBNeU1vZHVsZS5WaWV3cy5NYWluID0gQmFja2JvbmUuVmlldy5leHRlbmQoeyAvKiAuLi4gKi8gfSk7CiAgPC9jb2RlPjwvcHJlPgogIDwvcD4KCiAgPHA+CiAgQXR0YWNoaW5nIE1vZGVscy9Db2xsZWN0aW9ucy9Sb3V0ZXJzIGhhcHBlbiBvbiB0aGUgc2FtZSBsZXZlbCBvZiB0aGUgbW9kdWxlLAogIGxpa2Ugc286CgogIDxwcmU+PGNvZGU+CiAgTXlNb2R1bGUuTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoeyAvKiAuLi4gKi8gfSk7CgogIE15TW9kdWxlLlJvdXRlciA9IEJhY2tib25lLlJvdXRlci5leHRlbmQoeyAvKiAuLi4gKi8gfSk7CiAgPC9jb2RlPjwvcHJlPgogIDwvcD4KCiAgPGgzIGlkPSJ0ZW1wbGF0ZXMiPldvcmtpbmcgd2l0aCB0ZW1wbGF0ZXM8L2gzPgogIDxwPlRlbXBsYXRlcyBhcmUgYSBzdXBlciB1c2VmdWwgd2F5IHRvIHNlcGFyYXRlIGNvbmNlcm5zIGluIHlvdXIgYXBwbGljYXRpb24uICBJbnN0ZWFkIG9mIGdlbmVyYXRpbmcgbWFya3VwIGZyb20gaW5zaWRlIHlvdXIgSmF2YVNjcmlwdAogIGFwcGxpY2F0aW9uLCB5b3UgaW5zdGVhZCBjcmVhdGUgaXQgaW4gYSBzZXBhcmF0ZSBmaWxlIGFuZCBsb2FkIGl0IGludG8geW91ciBhcHBsaWNhdGlvbi4gIFRoZXJlIGFyZSBudW1lcm91cyB3YXlzIG9mIGxvYWRpbmcgaW4gYQogIHRlbXBsYXRlLCBidXQgdGhpcyBib2lsZXJwbGF0ZSBoYXMgY2hvc2VuIHRoZSBtb3N0IHBlcmZvcm1hbnQgd2F5IHRvIGJ1aWxkIGFsbCB5b3VyIHRlbXBsYXRlcyBpbnRvIGEgc2luZ2xlIGZpbGUuPC9wPgoKICA8cD5UaGlzIHR1dG9yaWFsIGl0c2VsZiBpcyBhIHRlbXBsYXRlIHRoYXQgZXhpc3RzIGluIDxjb2RlPmFwcC90ZW1wbGF0ZXMvZXhhbXBsZS5odG1sPC9jb2RlPi4gIFlvdSBjYW4gZWRpdCB0aGlzIGZpbGUgYW5kIGhpdCByZWZyZXNoCiAgaW4gaGVyZSB0byBzZWUgdGhlIGNoYW5nZXMuICBUaGUgYm9pbGVycGxhdGUgY29tZXMgd2l0aCBhIGJ1aWx0IGluIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgbG9hZGluZyBvZiB0ZW1wbGF0ZXMuICBJdCdzIGNhbGxlZDoKICAKICA8cHJlPjxjb2RlPgogIG5hbWVzcGFjZS5mZXRjaFRlbXBsYXRlKCJhcHAvdGVtcGxhdGVzL25hbWUuaHRtbCIsIGZ1bmN0aW9uKHRlbXBsYXRlKSB7CiAgICAvLyBUZW1wbGF0ZSBoZXJlIGlzIGEgZnVuY3Rpb24sIHRoYXQgYWNjZXB0cyBhbiBvYmplY3QuICBJZGVudGljYWwgdG8gXy50ZW1wbGF0ZS4KICAgIGNvbnNvbGUubG9nKHRlbXBsYXRlKHsgLi4uIH0pKTsKICB9KTsKICA8L2NvZGU+PC9wcmU+CiAgPC9wPgoKICA8cD5CeSBkZWZpbmluZyBhIGN1c3RvbSBmdW5jdGlvbiB0aGlzIHdpbGwgZW5zdXJlIHRoYXQgaWYgeW91IHVzZSB0aGUgYnVpbGQgdG9vbCBvciBBSkFYLCB0aGF0IHlvdXIgdGVtcGxhdGVzIHdpbGwgbG9hZCBjb25zaXN0ZW50bHkuCiAgWW91IGNhbiBzZWUgaXQgaW4gYWN0aW9uIGluc2lkZSB0aGUgPGNvZGU+YXBwL21vZHVsZXMvZXhhbXBsZS5qczwvY29kZT4gbW9kdWxlLjwvcD4KCiAgPHA+SWYgeW91IHVzZSB0aGUgYnVpbGQgcHJvY2VzcyB0byBjb21waWxlIHlvdXIgdGVtcGxhdGVzLCBpdCB3aWxsIGF1dG9tYXRpY2FsbHkgZmluZCBhbGwgdGhlIEhUTUwgZmlsZXMgaW5zaWRlIHRoZSB0ZW1wbGF0ZXMKICBkaXJlY3RvcnkgYW5kIGNvbXBpbGUgdGhlbSBpbnRvIGEgdGVtcGxhdGVzLmpzIGZpbGUuICBUaGVzZSBhcmUgYWN0dWFsIEphdmFTY3JpcHQgdGVtcGxhdGUgZnVuY3Rpb25zIGJlaW5nIGNvbXBpbGVkIG9uIHRoZSBzZXJ2ZXIsIHdoaWNoCiAgaXMgZGlmZmVyZW50IGZyb20gSmFtbWl0IGFuZCBtb3N0IG90aGVyIHNlcnZlci1zaWRlIGJ1aWxkZXJzIHRoYXQganVzdCBpbnZva2UgZnVuY3Rpb25zIG9uIHBhZ2UgbG9hZC48L3A+CgogIDxwPllvdSBjYW4gYWNjZXNzIGEgY29tcGlsZWQgdGVtcGxhdGUgbGlrZSBzbzoKCiAgPHByZT48Y29kZT4KICB2YXIgdGVtcGxhdGUgPSB3aW5kb3cuSlNUWyJhcHAvbW9kdWxlcy9leGFtcGxlLmh0bWwiXTsKICB0ZW1wbGF0ZSh7IC4uLiB9KTsKICA8L2NvZGU+PC9wcmU+CiAgPC9wPgoKICA8aDMgaWQ9ImV2ZW50cyI+V29ya2luZyB3aXRoIEFwcGxpY2F0aW9uIFdpZGUgRXZlbnRzPC9oMz4KICA8cD5BcHBsaWNhdGlvbiB3aWRlIGV2ZW50cyBwcm92aWRlIGEgY29udmVuaWVudCB3YXkgZm9yIG1vZHVsZXMgdG8gY29tbXVuaWNhdGUgd2l0aCBlYWNoIG90aGVyLiA8Y29kZT5uYW1lc3BhY2UuYXBwPC9jb2RlPiByZWZlcmVuY2VzIGEgY29weSBvZiB0aGUgQmFja2JvbmUuRXZlbnRzIG9iamVjdC4gPGEgaHJlZj0iaHR0cDovL2RvY3VtZW50Y2xvdWQuZ2l0aHViLmNvbS9iYWNrYm9uZS8jRXZlbnRzIj5Nb3JlIGluZm9ybWF0aW9uIG9uIEJhY2tib25lIEV2ZW50czwvYT48L3A+CgogIDxwPgogIFRvIGJpbmQgYSBjYWxsYmFjayBmdW5jdGlvbiB0byBhbiBldmVudDoKCiAgPHByZT48Y29kZT4KICAvL2JpbmRpbmcgYW4gYW5ub255bW91cyBmdW5jdGlvbiB0byB0aGUgZXZlbnQgImFsbCIgd2l0aCBhIGNvbnRleHQgb2YgPGNvZGU+dGhpczwvY29kZT4uCiAgbmFtZXNwYWNlLmFwcC5vbigiYWxsIiwgZnVuY3Rpb24oKXsuLi59LCB0aGlzKTsKICA8L2NvZGU+PC9wcmU+CiAgPC9wPgoKICA8cD4KICBUbyByZW1vdmUgYSBjYWxsYmFjayBmdW5jdGlvbiAob3IgbWFueSkgZnJvbSBhbiBldmVudDoKCiAgPHByZT48Y29kZT4KICAvLyBSZW1vdmVzIGp1c3QgdGhlIGRvU29tZXRoaW5nIGNhbGxiYWNrLgogIG5hbWVzcGFjZS5hcHAub2ZmKCJjaGFuZ2UiLCBkb1NvbWV0aGluZyk7CiAgCiAgLy8gUmVtb3ZlcyBhbGwgImNoYW5nZSIgZXZlbnRzLgogIG5hbWVzcGFjZS5hcHAub2ZmKCJjaGFuZ2UiKTsKICAKICAvLyBSZW1vdmVzIGFsbCBldmVudHMgZnJvbSB0aGUgbmFtZXNwYWNlLmFwcCBvYmplY3QuIAogIG5hbWVzcGFjZS5hcHAub2ZmKCk7IAogIDwvY29kZT48L3ByZT4KICA8L3A+CgogIDxwPgogIFRvIHRyaWdnZXIgdGhlICJjaGFuZ2UiIGV2ZW50OgoKICA8cHJlPjxjb2RlPgogIG5hbWVzcGFjZS5hcHAudHJpZ2dlcigiY2hhbmdlIiwgWyphcmdzXSk7CiAgPC9jb2RlPjwvcHJlPgogIDwvcD4KCiAgPGgzIGlkPSJwbHVnaW5zIj5Xb3JraW5nIHdpdGggbGlicmFyaWVzIGFuZCBwbHVnaW5zPC9oMz4KICA8cD5MaWJyYXJpZXMgYW5kIHBsdWdpbnMgYXJlIGVhc2lseSBhZGRlZCB0byB0aGUgYXBwbGljYXRpb24sIGJ5IHBsYWNpbmcgdGhlbSBpbnNpZGUgdGhlIDxjb2RlPmFzc2V0cy9qcy9saWJzLzwvY29kZT4gZGlyZWN0b3J5LgogIElmIHlvdSBoYXZlIG1hbnkgcGx1Z2lucyBpbiB5b3VyIGFwcGxpY2F0aW9uLCBpdCBtYXkgbWFrZSBzZW5zZSB0byBjcmVhdGUgYSBzZXBhcmF0ZSBmb2xkZXIgc3VjaCBhcyA8Y29kZT5hc3NldHMvanMvcGx1Z2lucy88L2NvZGU+IAogIGZvciB0aGVtLjwvcD4KPC9zZWN0aW9uPgoKPHNlY3Rpb24+CiAgPGgyIGlkPSJjdXN0b20tYnVpbGQiPlVzaW5nIHRoZSBidWlsZCB0b29sPC9oMj4KICA8cD5UaGUgQmFja2JvbmUgQm9pbGVycGxhdGUgYnVpbGQgcHJvY2VzcyBpcyBhIHN0YXRlLW9mLXRoZS1hcnQgdGFzayBkcml2ZW4KICBOb2RlLmpzIGFwcGxpY2F0aW9uIHRoYXQgdXRpbGl6ZXMgQGNvd2JveSdzIGdydW50IHByb2plY3QuCgogIFRvIHJ1biB0aGUgZGVmYXVsdHMsIGV4ZWN1dGUgdGhlIGZvbGxvd2luZyBjb21tYW5kIGZyb20gdGhlIHByb2plY3Qgcm9vdCwKICBhbmQgKm5vdCBmcm9tIGluc2lkZSB0aGUgYnVpbGQgZm9sZGVyKi48L3A+CgogIDxoMyBpZD0icnVubmluZyI+UnVubmluZyB3aXRoIHRoZSBkZWZhdWx0czwvaDM+CiAgPHA+VG8gcnVuIHRoZSBkZWZhdWx0cywgZXhlY3V0ZSB0aGUgZm9sbG93aW5nIGNvbW1hbmQgZnJvbSB0aGUgcHJvamVjdCByb290LAogIGFuZCAqbm90IGZyb20gaW5zaWRlIHRoZSBidWlsZCBmb2xkZXIqLgoKICA8cHJlPjxjb2RlPgogIG5vZGUgYnVpbGQKICA8L2NvZGU+PC9wcmU+CiAgPC9wPgoKICA8cD4KICBUaGlzIHdpbGwgZG8gYSBudW1iZXIgb2YgdGhpbmdzIGZvciB5b3UuICBGaXJzdCBpdCB3aWxsIGNvbmNhdGVuYXRlIGFsbCB5b3VyCiAgbGlicywgYXBwIGNvZGUsIGFuZCB0ZW1wbGF0ZXMgaW50byBzZXBhcmF0ZSBmaWxlcyBpbnNpZGUgdGhlIGBkaXN0L2RlYnVnYAogIGZvbGRlci4gIEl0IHdpbGwgdGhlbiBtaW5pZnkgdGhvc2UgZmlsZXMgYW5kIHlvdXIgQ1NTIGludG8gcHJvZHVjdGlvbiByZWFkeQogIGZpbGVzIGluc2lkZSB0aGUgPGNvZGU+ZGlzdC9yZWxlYXNlPC9jb2RlPiBmb2xkZXIuPC9wPgoKICA8aDMgaWQ9ImN1c3RvbWl6aW5nIj5DdXN0b21pemluZyB0aGUgYnVpbGQgY29uZmlndXJhdGlvbjwvaDM+CiAgPHA+VG8gY3VzdG9taXplIGFuZCBjb25maWd1cmUgdGhlIGJ1aWxkIHRvb2wsIG9wZW4gYGJ1aWxkL2NvbmZpZy5qc2AgYW5kIHR3ZWFrCnRoZSBzZXR0aW5ncy48L3A+CgogIDxoMyBpZD0ic2VydmVyIj5Vc2luZyB0aGUgZGV2ZWxvcG1lbnQgc2VydmVyPC9oMz4KICA8cD4KICBXaGlsZSB3cml0aW5nIGFuIGFwcGxpY2F0aW9uIHRoYXQgbGV2ZXJhZ2VzIDxjb2RlPnB1c2hTdGF0ZTwvY29kZT4geW91IGNhbiBydW4gdGhlCiAgZm9sbG93aW5nIGNvbW1hbmQgdG8gcnVuIGEgc2VydmVyIHRoYXQgd2lsbCBhbHdheXMgcmVzb2x2ZSB0byB0aGUgPGNvZGU+aW5kZXguaHRtbDwvY29kZT4KCiAgPHByZT48Y29kZT4KICBub2RlIGJ1aWxkL3NlcnZlcgogIDwvY29kZT48L3ByZT4KICA8L3A+CgogIDxwPgogIFRoaXMgd2lsbCBzcGF3biB1cCBhbiBIVFRQIHNlcnZlciBvbiBwb3J0IDxjb2RlPjgwMDA8L2NvZGU+LiAgVGhpcyBzZXJ2ZXIgaXMgaW50ZW5kZWQKICBmb3IgZGV2ZWxvcG1lbnQgYW5kIG5vdCBwcm9kdWN0aW9uLiAgWW91IHNob3VsZCB1c2UgdXJsIHJld3JpdGluZyBvciBmb3J3YXJkaW5nCiAgYWxsIHJlcXVlc3RzIGluIHlvdXIgcHJvZHVjdGlvbiBzZXJ2ZXIgdG8gYWNoaWV2ZSB0aGlzIHNhbWUgZWZmZWN0LjwvcD4KCiAgPGg0PlNlcnZpbmcgdGhlIGJ1aWx0IGFzc2V0czwvaDQ+CgogIDxwPklmIHlvdSBhcmUgdXNpbmcgdGhlIGJ1aWxkIHRvb2wgaW4gY29uanVuY3Rpb24gd2l0aCB0aGlzIGRldmVsb3BtZW50IHNlcnZlcgogIHlvdSBjYW4gb3B0aW9uYWxseSB1cGRhdGUgdGhlIDxjb2RlPmluZGV4Lmh0bWw8L2NvZGU+IGZpbGUgdG8gcmVtb3ZlIHRoZSBleGlzdGluZyBzY3JpcHQKICB0YWdzIGFuZCB1bmNvbW1lbnQgb3V0IHRoZSBzY3JpcHRzIHRhZyBhdCB0aGUgYm90dG9tIHRvIGxvYWQgdGhlIDxjb2RlPmRpc3QvZGVidWc8L2NvZGU+CiAgb3IgPGNvZGU+ZGlzdC9yZWxlYXNlPC9jb2RlPiBhc3NldHMuICBZb3UgY2FuIGFjaGlldmUgdGhpcyBieSBzcGVjaWZ5aW5nIGVpdGhlciA8Yj5kZWJ1ZzwvYj4KICBvciA8Yj5yZWxlYXNlPC9iPiBhZnRlciB0aGUgc2VydmVyIGNvbW1hbmQsIGxpa2Ugc286CgogIDxwcmU+PGNvZGU+CiAgbm9kZSBidWlsZC9zZXJ2ZXIgcmVsZWFzZQogIDwvY29kZT48L3ByZT4KICA8L3A+CgogIDxoMyBpZD0iYWRkaW5nLXRhc2tzIj5BZGRpbmcgbmV3IHRhc2tzPC9oMz4KICA8cD5UbyBhZGQgYSBuZXcgdGFzayBpbnRvIHRoZSBidWlsZCBzeXN0ZW0sIHlvdSBzaW1wbHkgY29weSBhbmQgcGFzdGUgdGhlIHRhc2sgSmF2YVNjcmlwdCBmb2xkZXIvZmlsZSBpbnRvIHRoZSA8Y29kZT5idWlsZC90YXNrczwvY29kZT4gZm9sZGVyCiAgb3IgZXh0cmFjdCB0aGUgdGFzayBhcmNoaXZlIGludG8gdGhlIHNhbWUgZGlyZWN0b3J5LiAgQXQgdGhlIHZlcnkgbGVhc3QgaW4gb3JkZXIgdG8gcnVuIHRoaXMgdGFzaywgeW91J2xsIG5lZWQgdG8gYWRkIGl0IHRvIHRoZSA8Y29kZT5idWlsZC9jb25maWcuanM8L2NvZGU+CiAgZmlsZS4gIFRoZSBsYXN0IGxpbmUgc2hvdWxkIGxvb2sgc29tZXRoaW5nIGxpa2U6CgogIDxwcmU+PGNvZGU+CiAgdGFzay5yZWdpc3RlclRhc2soImRlZmF1bHQiLCAiY2xlYW4gbGludDpmaWxlcyBjb25jYXQganN0IG1pbiBtaW5jc3MgbmV3X21vZHVsZV9oZXJlIik7CiAgPC9jb2RlPjwvcHJlPgogIDwvcD4KCiAgSXQncyBwb3NzaWJsZSB0aGUgY3VzdG9tIHRhc2sgd2lsbCBoYXZlIGFkZGl0aW9uYWwgc2V0dXAgaW5zdHJ1Y3Rpb25zLCBzbyBtYWtlCiAgc3VyZSB5b3UgcmVhZCB0aGUgUkVBRE1FIGZvciBhbnkgdGFzay48L3A+Cjwvc2VjdGlvbj4KCjxzZWN0aW9uIGlkPSJ1c2VmdWwtcmVzb3VyY2VzIj4KICA8aDI+VXNlZnVsIHJlc291cmNlczwvaDI+CgogIDx1bD4KICAgIDxsaT48YSB0YXJnZXQ9ImJsYW5rIiBocmVmPSJodHRwOi8vYmFja2JvbmVqcy5vcmcvIj5CYWNrYm9uZSBkb2N1bWVudGF0aW9uPC9hPiAtIEZyYW1ld29yayBvbiB3aGljaCBCYWNrYm9uZSBCb2lsZXJwbGF0ZSBpcyBidWlsdC4KICAgIDxsaT48YSB0YXJnZXQ9ImJsYW5rIiBocmVmPSJodHRwOi8vZG9jdW1lbnRjbG91ZC5naXRodWIuY29tL3VuZGVyc2NvcmUvZG9jcy91bmRlcnNjb3JlLmh0bWwiPlVuZGVyc2NvcmUgZG9jdW1lbnRhdGlvbjwvYT4gLSBSZXF1aXJlZCBkZXBlbmRlbmN5IGZvciBCYWNrYm9uZS4KICA8L3VsPgo8L3NlY3Rpb24+Cg==", "content_type": "text/html"}, "app/modules/todo.js": {"data": "ZGVmaW5lKFsKICAibmFtZXNwYWNlIiwKCiAgLy8gTGlicwogICJ1c2UhYmFja2JvbmUiLAogICJ1c2UhYmFja2JvbmVfY291Y2hkYiIKCiAgLy8gTW9kdWxlcwoKICAvLyBQbHVnaW5zCiAgLy8idXNlIWxvY2Fsc3RvcmFnZSIKXSwKCmZ1bmN0aW9uKG5hbWVzcGFjZSwgQmFja2JvbmUpIHsKCiAgLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZQoJdmFyIFRvZG8gPSBuYW1lc3BhY2UubW9kdWxlKCk7CgoJLy8gVG9kbyBleHRlbmRpbmdzCgkvL1RvZG8uTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoeyAvKiAuLi4gKi8gfSk7CglUb2RvLk1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKCgkJLy8gRGVmYXVsdCBhdHRyaWJ1dGVzIGZvciB0aGUgdG9kby4KCQlkZWZhdWx0czogewoJCQljb250ZW50OiAiZW1wdHkgdG9kby4uLiIsCgkJCWRvbmU6IGZhbHNlCgkJfSwKCgkJLy8gRW5zdXJlIHRoYXQgZWFjaCB0b2RvIGNyZWF0ZWQgaGFzIGBjb250ZW50YC4KCQlpbml0aWFsaXplOiBmdW5jdGlvbigpIHsKCQkJaWYgKCF0aGlzLmdldCgiY29udGVudCIpKSB7CgkJCQl0aGlzLnNldCh7ImNvbnRlbnQiOiB0aGlzLmRlZmF1bHRzLmNvbnRlbnR9KTsKCQkJfQoJCX0sCgoJCS8vIFRvZ2dsZSB0aGUgYGRvbmVgIHN0YXRlIG9mIHRoaXMgdG9kbyBpdGVtLgoJCXRvZ2dsZTogZnVuY3Rpb24oKSB7CgkJCXRoaXMuc2F2ZSh7ZG9uZTogIXRoaXMuZ2V0KCJkb25lIil9KTsKCQl9LAoKCQkvLyBSZW1vdmUgdGhpcyBUb2RvIGZyb20gKmxvY2FsU3RvcmFnZSouCgkJY2xlYXI6IGZ1bmN0aW9uKCkgewoJCQl0aGlzLmRlc3Ryb3koKTsKCQl9CgoJfSk7CgogIFRvZG8uVG9kb0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CgoJICAgIC8vIFJlZmVyZW5jZSB0byB0aGlzIGNvbGxlY3Rpb24ncyBtb2RlbC4KCSAgICBtb2RlbDogVG9kby5Nb2RlbCwKCgkgICAgLy8gU2F2ZSBhbGwgb2YgdGhlIHRvZG8gaXRlbXMgdW5kZXIgdGhlIGAidG9kb3MiYCBuYW1lc3BhY2UuCgkgICAgLy9sb2NhbFN0b3JhZ2U6IG5ldyBTdG9yZSgiVG9kb3MiKSwKCgkgICAgLy8gRmlsdGVyIGRvd24gdGhlIGxpc3Qgb2YgYWxsIHRvZG8gaXRlbXMgdGhhdCBhcmUgZmluaXNoZWQuCgkgICAgZG9uZTogZnVuY3Rpb24oKSB7CgkgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24odG9kbyl7IHJldHVybiB0b2RvLmdldCgnZG9uZScpOyB9KTsKCSAgICB9LAoKCSAgICAvLyBGaWx0ZXIgZG93biB0aGUgbGlzdCB0byBvbmx5IHRvZG8gaXRlbXMgdGhhdCBhcmUgc3RpbGwgbm90IGZpbmlzaGVkLgoJICAgIHJlbWFpbmluZzogZnVuY3Rpb24oKSB7CgkgICAgICByZXR1cm4gdGhpcy53aXRob3V0LmFwcGx5KHRoaXMsIHRoaXMuZG9uZSgpKTsKCSAgICB9LAoKCSAgICAvLyBXZSBrZWVwIHRoZSBUb2RvcyBpbiBzZXF1ZW50aWFsIG9yZGVyLCBkZXNwaXRlIGJlaW5nIHNhdmVkIGJ5IHVub3JkZXJlZAoJICAgIC8vIEdVSUQgaW4gdGhlIGRhdGFiYXNlLiBUaGlzIGdlbmVyYXRlcyB0aGUgbmV4dCBvcmRlciBudW1iZXIgZm9yIG5ldyBpdGVtcy4KCSAgICBuZXh0T3JkZXI6IGZ1bmN0aW9uKCkgewoJICAgICAgaWYgKCF0aGlzLmxlbmd0aCkgcmV0dXJuIDE7CgkgICAgICByZXR1cm4gdGhpcy5sYXN0KCkuZ2V0KCdvcmRlcicpICsgMTsKCSAgICB9LAoKCSAgICAvLyBUb2RvcyBhcmUgc29ydGVkIGJ5IHRoZWlyIG9yaWdpbmFsIGluc2VydGlvbiBvcmRlci4KCSAgICBjb21wYXJhdG9yOiBmdW5jdGlvbih0b2RvKSB7CgkgICAgICByZXR1cm4gdG9kby5nZXQoJ29yZGVyJyk7CgkgICAgfSwKCSAgICB1cmwgOiAiL3RvZG8iLAoJICB9KTsKICBUb2RvLlRvZG9Db2xsZWN0aW9uID0gbmV3IFRvZG8uVG9kb0NvbGxlY3Rpb24oe21vZGVsOiBuZXcgVG9kby5Nb2RlbCgpfSk7CiAgLy9Ub2RvLlRvZG9Db2xsZWN0aW9uID0gbmV3IFRvZG8uVG9kb0NvbGxlY3Rpb24oeyBtb2RlbDpuZXcgVG9kbygpfSk7CiAgVG9kby5Sb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIuZXh0ZW5kKHsgLyogLi4uICovIH0pOwoKICAvLyBUaGlzIHdpbGwgZmV0Y2ggdGhlIFRvZG9tdmMgdGVtcGxhdGUgYW5kIHJlbmRlciBpdC4KICBUb2RvLlZpZXdzLlRvZG9tdmMgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CgoJICAvLyBJbnN0ZWFkIG9mIGdlbmVyYXRpbmcgYSBuZXcgZWxlbWVudCwgYmluZCB0byB0aGUgZXhpc3Rpbmcgc2tlbGV0b24gb2YKCSAgLy8gdGhlIEFwcCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIEhUTUwuCgkgIGVsOiAkKCIjbWFpbiIpLAoKCSAgdGVtcGxhdGU6ICJhcHAvdGVtcGxhdGVzL3RvZG9tdmMuaHRtbCIsCgkgIC8vIEluc3RlYWQgb2YgZ2VuZXJhdGluZyBhIG5ldyBlbGVtZW50LCBiaW5kIHRvIHRoZSBleGlzdGluZyBza2VsZXRvbiBvZgoJICAvLyB0aGUgQXBwIGFscmVhZHkgcHJlc2VudCBpbiB0aGUgSFRNTC4KCSAgLy9lbDogJCgiI3RvZG9hcHAiKSwKCgkgIC8vIE91ciB0ZW1wbGF0ZSBmb3IgdGhlIGxpbmUgb2Ygc3RhdGlzdGljcyBhdCB0aGUgYm90dG9tIG9mIHRoZSBhcHAuCgkgIC8vc3RhdHNUZW1wbGF0ZTogXy50ZW1wbGF0ZShzdGF0c1RlbXBsYXRlKSwKCgkgIC8vIERlbGVnYXRlZCBldmVudHMgZm9yIGNyZWF0aW5nIG5ldyBpdGVtcywgYW5kIGNsZWFyaW5nIGNvbXBsZXRlZCBvbmVzLgoJICBldmVudHM6IHsKCQkgICJrZXlwcmVzcyAjbmV3LXRvZG8iOiAgImNyZWF0ZU9uRW50ZXIiLAoJCSAgImtleXVwICNuZXctdG9kbyI6ICAgICAic2hvd1Rvb2x0aXAiLAoJCSAgImNsaWNrIC50b2RvLWNsZWFyIGEiOiAiY2xlYXJDb21wbGV0ZWQiLAoJCSAgImNsaWNrIC5tYXJrLWFsbC1kb25lIjogInRvZ2dsZUFsbENvbXBsZXRlIgoJICB9LAogICAgCiAgICAvLyBBdCBpbml0aWFsaXphdGlvbiB3ZSBiaW5kIHRvIHRoZSByZWxldmFudCBldmVudHMgb24gdGhlIGBUb2Rvc2AKICAgIC8vIGNvbGxlY3Rpb24sIHdoZW4gaXRlbXMgYXJlIGFkZGVkIG9yIGNoYW5nZWQuIEtpY2sgdGhpbmdzIG9mZiBieQogICAgLy8gbG9hZGluZyBhbnkgcHJlZXhpc3RpbmcgdG9kb3MgdGhhdCBtaWdodCBiZSBzYXZlZCBpbiAqbG9jYWxTdG9yYWdlKi4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkgewogICAgICBfLmJpbmRBbGwodGhpcywgJ2FkZE9uZScsICdhZGRBbGwnLCAncmVuZGVyJywgJ3RvZ2dsZUFsbENvbXBsZXRlJyk7CgogICAgICB0aGlzLmlucHV0ICAgID0gdGhpcy4kKCIjbmV3LXRvZG8iKTsKICAgICAgdGhpcy5hbGxDaGVja2JveCA9IHRoaXMuJCgiLm1hcmstYWxsLWRvbmUiKVswXTsKCiAgICAgIFRvZG8uVG9kb0NvbGxlY3Rpb24uYmluZCgnYWRkJywgICAgIHRoaXMuYWRkT25lKTsKICAgICAgVG9kby5Ub2RvQ29sbGVjdGlvbi5iaW5kKCdyZXNldCcsICAgdGhpcy5hZGRBbGwpOwogICAgICBUb2RvLlRvZG9Db2xsZWN0aW9uLmJpbmQoJ2FsbCcsICAgICB0aGlzLnJlbmRlcik7CiAgICAgIFRvZG8uVG9kb0NvbGxlY3Rpb24uZmV0Y2goKTsKICAgICAgLy90aGlzLmNvbGxlY3Rpb24gPSBUb2RvLlRvZG9Db2xsZWN0aW9uOwogICAgfSwKICAgIHJlbmRlcjogZnVuY3Rpb24oZG9uZSkgewogICAgCXZhciB2aWV3ID0gdGhpczsKCiAgICAJdmFyIHRvZG9zRG9uZSA9IFRvZG8uVG9kb0NvbGxlY3Rpb24uZG9uZSgpLmxlbmd0aDsKICAgIAl2YXIgcmVtYWluaW5nID0gVG9kby5Ub2RvQ29sbGVjdGlvbi5yZW1haW5pbmcoKS5sZW5ndGg7CiAgICAJLyp0aGlzLiQoJyN0b2RvLXN0YXRzJykuaHRtbCh0aGlzLnN0YXRzVGVtcGxhdGUoewogICAgICAgIHRvdGFsOiAgICAgIFRvZG8uVG9kb0NvbGxlY3Rpb24ubGVuZ3RoLAogICAgICAgIGRvbmU6ICAgICAgIHRvZG9zRG9uZSwKICAgICAgICByZW1haW5pbmc6ICByZW1haW5pbmcKICAgICAgfSkpOyovCiAgICAJbmFtZXNwYWNlLmZldGNoVGVtcGxhdGUoImFwcC90ZW1wbGF0ZXMvc3RhdHMuaHRtbCIsIGZ1bmN0aW9uKHRtcGwyKSB7CiAgICAJCXZhciBzdGF0c2pzb24gPSB7CiAgICAJICAgICAgICB0b3RhbDogICAgICBUb2RvLlRvZG9Db2xsZWN0aW9uLmxlbmd0aCwKICAgIAkgICAgICAgIGRvbmU6ICAgICAgIHRvZG9zRG9uZSwKICAgIAkgICAgICAgIHJlbWFpbmluZzogIHJlbWFpbmluZwogICAgCSAgICAgIH07CiAgICAJCXZhciBodG1sdGV4dCA9IHRtcGwyKHN0YXRzanNvbik7CiAgICAJCS8vKEpTT04uc3RyaW5naWZ5KGh0bWx0ZXh0KSk7CiAgICAJCS8vdmlldy5zdGF0c0VsID0gdmlldy4kKCcjdG9kby1zdGF0cycpOwogICAgCQkkKCcjdG9kby1zdGF0cycpLmh0bWwoaHRtbHRleHQpOwogICAgCX0pOwoKICAgIAkvLyBJZiBhIGRvbmUgZnVuY3Rpb24gaXMgcGFzc2VkLCBjYWxsIGl0IHdpdGggdGhlIGVsZW1lbnQKCQlpZiAoXy5pc0Z1bmN0aW9uKGRvbmUpKSB7CgkJCWRvbmUodmlldy5lbCk7CgkJCXZpZXcuaW5wdXQgICAgPSB2aWV3LiQoIiNuZXctdG9kbyIpOwoJCQl2aWV3LmFsbENoZWNrYm94ID0gdmlldy4kKCIubWFyay1hbGwtZG9uZSIpWzBdOwoJCQkvL3ZpZXcuYWxsQ2hlY2tib3guY2hlY2tlZCA9ICFyZW1haW5pbmc7CgkJfQoJCS8vdmlldy5hZGRBbGwoKTsKICAgIH0sIAogICAgCgogICAgLy8gQWRkIGEgc2luZ2xlIHRvZG8gaXRlbSB0byB0aGUgbGlzdCBieSBjcmVhdGluZyBhIHZpZXcgZm9yIGl0LCBhbmQKICAgIC8vIGFwcGVuZGluZyBpdHMgZWxlbWVudCB0byB0aGUgYDx1bD5gLgogICAgYWRkT25lOiBmdW5jdGlvbih0b2RvKSB7CiAgICAgIHZhciB2aWV3ID0gbmV3IFRvZG8uVmlld3MuVG9kb0l0ZW0oe21vZGVsOiB0b2RvfSk7CiAgICAgIC8vdmFyIHRvZG9JdGVtRWwgPSB2aWV3LnJlbmRlcigpLmVsOwogICAgICAvL3RoaXMuJCgiI3RvZG8tbGlzdCIpLmFwcGVuZCh0b2RvSXRlbUVsKTsKICAgICAgLy9jb25zb2xlLmxvZygiYWRkIG9uZTogIiArIEpTT04uc3RyaW5naWZ5KHRvZG8pKTsKICAgICAgdmlldy5yZW5kZXIoZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICQoJyN0b2RvLWxpc3QnKS5hcHBlbmQoZWwpOwogICAgICAgIH0pOwogICAgfSwKCiAgICAvLyBBZGQgYWxsIGl0ZW1zIGluIHRoZSAqKlRvZG8uVG9kb0NvbGxlY3Rpb24qKiBjb2xsZWN0aW9uIGF0IG9uY2UuCiAgICBhZGRBbGw6IGZ1bmN0aW9uKCkgewogICAgICBUb2RvLlRvZG9Db2xsZWN0aW9uLmVhY2godGhpcy5hZGRPbmUpOwogICAgfSwKCiAgICAvLyBHZW5lcmF0ZSB0aGUgYXR0cmlidXRlcyBmb3IgYSBuZXcgVG9kbyBpdGVtLgogICAgbmV3QXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAJLy9jb25zb2xlLmxvZygiaW5wdXQ6ICIgKyB0aGlzLmlucHV0LnZhbCgpKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBjb250ZW50OiB0aGlzLmlucHV0LnZhbCgpLAogICAgICAgIG9yZGVyOiAgIFRvZG8uVG9kb0NvbGxlY3Rpb24ubmV4dE9yZGVyKCksCiAgICAgICAgZG9uZTogICAgZmFsc2UKICAgICAgfTsKICAgIH0sCgogICAgLy8gSWYgeW91IGhpdCByZXR1cm4gaW4gdGhlIG1haW4gaW5wdXQgZmllbGQsIGNyZWF0ZSBuZXcgKipUb2RvKiogbW9kZWwsCiAgICAvLyBwZXJzaXN0aW5nIGl0IHRvICpsb2NhbFN0b3JhZ2UqLgogICAgY3JlYXRlT25FbnRlcjogZnVuY3Rpb24oZSkgewogICAgICBpZiAoZS5rZXlDb2RlICE9IDEzKSByZXR1cm47CiAgICAgIFRvZG8uVG9kb0NvbGxlY3Rpb24uY3JlYXRlKHRoaXMubmV3QXR0cmlidXRlcygpKTsKICAgICAgdGhpcy5pbnB1dC52YWwoJycpOwogICAgfSwKCiAgICAvLyBDbGVhciBhbGwgZG9uZSB0b2RvIGl0ZW1zLCBkZXN0cm95aW5nIHRoZWlyIG1vZGVscy4KICAgIGNsZWFyQ29tcGxldGVkOiBmdW5jdGlvbigpIHsKICAgICAgXy5lYWNoKFRvZG8uVG9kb0NvbGxlY3Rpb24uZG9uZSgpLCBmdW5jdGlvbih0b2RvKXsgdG9kby5jbGVhcigpOyB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvLyBMYXppbHkgc2hvdyB0aGUgdG9vbHRpcCB0aGF0IHRlbGxzIHlvdSB0byBwcmVzcyBgZW50ZXJgIHRvIHNhdmUKICAgIC8vIGEgbmV3IHRvZG8gaXRlbSwgYWZ0ZXIgb25lIHNlY29uZC4KICAgIHNob3dUb29sdGlwOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciB0b29sdGlwID0gdGhpcy4kKCIudWktdG9vbHRpcC10b3AiKTsKICAgICAgdmFyIHZhbCA9IHRoaXMuaW5wdXQudmFsKCk7CiAgICAgIHRvb2x0aXAuZmFkZU91dCgpOwogICAgICBpZiAodGhpcy50b29sdGlwVGltZW91dCkgY2xlYXJUaW1lb3V0KHRoaXMudG9vbHRpcFRpbWVvdXQpOwogICAgICBpZiAodmFsID09ICcnIHx8IHZhbCA9PSB0aGlzLmlucHV0LmF0dHIoJ3BsYWNlaG9sZGVyJykpIHJldHVybjsKICAgICAgdmFyIHNob3cgPSBmdW5jdGlvbigpeyB0b29sdGlwLnNob3coKS5mYWRlSW4oKTsgfTsKICAgICAgdGhpcy50b29sdGlwVGltZW91dCA9IF8uZGVsYXkoc2hvdywgMTAwMCk7CiAgICB9LAoKICAgIC8vIENoYW5nZSBlYWNoIHRvZG8gc28gdGhhdCBpdCdzIGBkb25lYCBzdGF0ZSBtYXRjaGVzIHRoZSBjaGVjayBhbGwKICAgIHRvZ2dsZUFsbENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBkb25lID0gdGhpcy5hbGxDaGVja2JveC5jaGVja2VkOwogICAgICBUb2RvLlRvZG9Db2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKHRvZG8pIHsgdG9kby5zYXZlKHsnZG9uZSc6IGRvbmV9KTsgfSk7CiAgICB9CiAgICAKICB9KTsKICAKICBUb2RvLlZpZXdzLlRvZG9JdGVtID0gQmFja2JvbmUuVmlldy5leHRlbmQoewoKCSAgICAvLy4uLiBpcyBhIGxpc3QgdGFnLgoJICAgIHRhZ05hbWU6ICAibGkiLAoKCSAgICAvLyBDYWNoZSB0aGUgdGVtcGxhdGUgZnVuY3Rpb24gZm9yIGEgc2luZ2xlIGl0ZW0uCgkgICAgLy90ZW1wbGF0ZTogXy50ZW1wbGF0ZSh0b2Rvc1RlbXBsYXRlKSwKCSAgICB0ZW1wbGF0ZTogImFwcC90ZW1wbGF0ZXMvdG9kb3MuaHRtbCIsCgoJICAgIC8vIFRoZSBET00gZXZlbnRzIHNwZWNpZmljIHRvIGFuIGl0ZW0uCgkgICAgZXZlbnRzOiB7CgkgICAgICAiY2xpY2sgLmNoZWNrIiAgICAgICAgICAgICAgOiAidG9nZ2xlRG9uZSIsCgkgICAgICAiZGJsY2xpY2sgZGl2LnRvZG8tY29udGVudCIgOiAiZWRpdCIsCgkgICAgICAiY2xpY2sgc3Bhbi50b2RvLWRlc3Ryb3kiICAgOiAiY2xlYXIiLAoJICAgICAgImtleXByZXNzIC50b2RvLWlucHV0IiAgICAgIDogInVwZGF0ZU9uRW50ZXIiLAoJICAgICAgImJsdXIgLnRvZG8taW5wdXQiICAgICAgICAgIDogImNsb3NlIgoJICAgIH0sCgoJICAgIC8vIFRoZSBUb2RvVmlldyBsaXN0ZW5zIGZvciBjaGFuZ2VzIHRvIGl0cyBtb2RlbCwgcmUtcmVuZGVyaW5nLiBTaW5jZSB0aGVyZSdzCgkgICAgLy8gYSBvbmUtdG8tb25lIGNvcnJlc3BvbmRlbmNlIGJldHdlZW4gYSAqKlRvZG8qKiBhbmQgYSAqKlRvZG9WaWV3KiogaW4gdGhpcwoJICAgIC8vIGFwcCwgd2Ugc2V0IGEgZGlyZWN0IHJlZmVyZW5jZSBvbiB0aGUgbW9kZWwgZm9yIGNvbnZlbmllbmNlLgoJICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkgewoJICAgICAgXy5iaW5kQWxsKHRoaXMsICdyZW5kZXInLCAnY2xvc2UnLCAncmVtb3ZlJyk7CgkgICAgICB0aGlzLm1vZGVsLmJpbmQoJ2NoYW5nZScsIHRoaXMucmVuZGVyKTsKCSAgICAgIHRoaXMubW9kZWwuYmluZCgnZGVzdHJveScsIHRoaXMucmVtb3ZlKTsKCSAgICB9LAoKCgkgICAgLy8gUmUtcmVuZGVyIHRoZSBjb250ZW50cyBvZiB0aGUgdG9kbyBpdGVtLgoJICAgIHJlbmRlcjogZnVuY3Rpb24oZG9uZSkgewoJICAgIAl2YXIgdmlldyA9IHRoaXM7CgkgICAgCXZhciBqc29uID0gdGhpcy5tb2RlbC50b0pTT04oKTsKCSAgICAJLy8kKHRoaXMuZWwpLmh0bWwodGhpcy50ZW1wbGF0ZShqc29uKSk7CgoJICAgIAkvLyBGZXRjaCB0aGUgdGVtcGxhdGUsIHJlbmRlciBpdCB0byB0aGUgVmlldyBlbGVtZW50IGFuZCBjYWxsIGRvbmUuCgkgICAgCW5hbWVzcGFjZS5mZXRjaFRlbXBsYXRlKHRoaXMudGVtcGxhdGUsIGZ1bmN0aW9uKHRtcGwpIHsKCSAgICAJCS8vdmFyIGpzb24gPSB0aGlzLm1vZGVsLnRvSlNPTigpOwoJICAgIAkJdmFyIHRleHR0bXBsID0gdG1wbChqc29uKTsKCSAgICAJCXZpZXcuZWwuaW5uZXJIVE1MID0gdGV4dHRtcGw7CgkgICAgCQl2aWV3LmlucHV0ID0gdmlldy4kKCcudG9kby1pbnB1dCcpOwoJICAgIAkJLy8gSWYgYSBkb25lIGZ1bmN0aW9uIGlzIHBhc3NlZCwgY2FsbCBpdCB3aXRoIHRoZSBlbGVtZW50CgkgICAgCQlpZiAoXy5pc0Z1bmN0aW9uKGRvbmUpKSB7CgkgICAgCQkJZG9uZSh2aWV3LmVsKTsKCSAgICAJCX0KCSAgICAJCS8vY29uc29sZS5sb2coImZpcnN0IHJldHVybiBvZiAiICsgSlNPTi5zdHJpbmdpZnkoanNvbikpOwoJICAgIAkJLy9yZXR1cm4gdmlldy5lbDsKCSAgICAJfSk7CgkgICAgCS8vY29uc29sZS5sb2coInNlY29uZCByZXR1cm4gb2YgIiArIEpTT04uc3RyaW5naWZ5KGpzb24pKTsKCSAgICAJLy9yZXR1cm4gdmlldy5lbDsKCSAgICB9LAoKCSAgICAvLyBUb2dnbGUgdGhlIGAiZG9uZSJgIHN0YXRlIG9mIHRoZSBtb2RlbC4KCSAgICB0b2dnbGVEb25lOiBmdW5jdGlvbigpIHsKCSAgICAgIHRoaXMubW9kZWwudG9nZ2xlKCk7CgkgICAgfSwKCgkgICAgLy8gU3dpdGNoIHRoaXMgdmlldyBpbnRvIGAiZWRpdGluZyJgIG1vZGUsIGRpc3BsYXlpbmcgdGhlIGlucHV0IGZpZWxkLgoJICAgIGVkaXQ6IGZ1bmN0aW9uKCkgewoJICAgICAgJCh0aGlzLmVsKS5hZGRDbGFzcygiZWRpdGluZyIpOwoJICAgICAgdGhpcy5pbnB1dC5mb2N1cygpOwoJICAgIH0sCgoJICAgIC8vIENsb3NlIHRoZSBgImVkaXRpbmciYCBtb2RlLCBzYXZpbmcgY2hhbmdlcyB0byB0aGUgdG9kby4KCSAgICBjbG9zZTogZnVuY3Rpb24oKSB7CgkgICAgICB0aGlzLm1vZGVsLnNhdmUoe2NvbnRlbnQ6IHRoaXMuaW5wdXQudmFsKCl9KTsKCSAgICAgICQodGhpcy5lbCkucmVtb3ZlQ2xhc3MoImVkaXRpbmciKTsKCSAgICB9LAoKCSAgICAvLyBJZiB5b3UgaGl0IGBlbnRlcmAsIHdlJ3JlIHRocm91Z2ggZWRpdGluZyB0aGUgaXRlbS4KCSAgICB1cGRhdGVPbkVudGVyOiBmdW5jdGlvbihlKSB7CgkgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB0aGlzLmNsb3NlKCk7CgkgICAgfSwKCgkgICAgLy8gUmVtb3ZlIHRoZSBpdGVtLCBkZXN0cm95IHRoZSBtb2RlbC4KCSAgICBjbGVhcjogZnVuY3Rpb24oKSB7CgkgICAgCXRoaXMubW9kZWwuY2xlYXIoKTsKCSAgICB9CgoJICB9KTsKCiAgLy8gUmVxdWlyZWQsIHJldHVybiB0aGUgbW9kdWxlIGZvciBBTUQgY29tcGxpYW5jZQogIHJldHVybiBUb2RvOwoKfSk7Cg==", "content_type": "application/javascript"}, "app/templates/todos.html": {"data": "ICAgICAgPGRpdiBjbGFzcz0idG9kbyA8JT0gZG9uZSA/ICdkb25lJyA6ICcnICU+Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJkaXNwbGF5Ij4KICAgICAgICAgIDxpbnB1dCBjbGFzcz0iY2hlY2siIHR5cGU9ImNoZWNrYm94IiA8JT0gZG9uZSA/ICdjaGVja2VkPSJjaGVja2VkIicgOiAnJyAlPiAvPgogICAgICAgICAgPGRpdiBjbGFzcz0idG9kby1jb250ZW50Ij48JT0gY29udGVudCAlPjwvZGl2PgogICAgICAgICAgPHNwYW4gY2xhc3M9InRvZG8tZGVzdHJveSI+PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImVkaXQiPgogICAgICAgICAgPGlucHV0IGNsYXNzPSJ0b2RvLWlucHV0IiB0eXBlPSJ0ZXh0IiB2YWx1ZT0iPCU9IGNvbnRlbnQgJT4iIC8+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2Pgo=", "content_type": "text/html"}, "assets/js/libs/require.js": {"data": "LyoqIHZpbTogZXQ6dHM9NDpzdz00OnN0cz00CiAqIEBsaWNlbnNlIFJlcXVpcmVKUyAxLjAuNyBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMiwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzIGZvciBkZXRhaWxzCiAqLwovKmpzbGludCBzdHJpY3Q6IGZhbHNlLCBwbHVzcGx1czogZmFsc2UsIHN1YjogdHJ1ZSAqLwovKmdsb2JhbCB3aW5kb3csIG5hdmlnYXRvciwgZG9jdW1lbnQsIGltcG9ydFNjcmlwdHMsIGpRdWVyeSwgc2V0VGltZW91dCwgb3BlcmEgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICgpIHsKICAgIC8vQ2hhbmdlIHRoaXMgdmVyc2lvbiBudW1iZXIgZm9yIGVhY2ggcmVsZWFzZS4KICAgIHZhciB2ZXJzaW9uID0gIjEuMC43IiwKICAgICAgICBjb21tZW50UmVnRXhwID0gLyhcL1wqKFtcc1xTXSo/KVwqXC98KFteOl18XilcL1wvKC4qKSQpL21nLAogICAgICAgIGNqc1JlcXVpcmVSZWdFeHAgPSAvcmVxdWlyZVwoXHMqWyInXShbXiciXHNdKylbIiddXHMqXCkvZywKICAgICAgICBjdXJyRGlyUmVnRXhwID0gL15cLlwvLywKICAgICAgICBqc1N1ZmZpeFJlZ0V4cCA9IC9cLmpzJC8sCiAgICAgICAgb3N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsCiAgICAgICAgYXAgPSBBcnJheS5wcm90b3R5cGUsCiAgICAgICAgYXBzID0gYXAuc2xpY2UsCiAgICAgICAgYXBzcCA9IGFwLnNwbGljZSwKICAgICAgICBpc0Jyb3dzZXIgPSAhISh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiBuYXZpZ2F0b3IgJiYgZG9jdW1lbnQpLAogICAgICAgIGlzV2ViV29ya2VyID0gIWlzQnJvd3NlciAmJiB0eXBlb2YgaW1wb3J0U2NyaXB0cyAhPT0gInVuZGVmaW5lZCIsCiAgICAgICAgLy9QUzMgaW5kaWNhdGVzIGxvYWRlZCBhbmQgY29tcGxldGUsIGJ1dCBuZWVkIHRvIHdhaXQgZm9yIGNvbXBsZXRlCiAgICAgICAgLy9zcGVjaWZpY2FsbHkuIFNlcXVlbmNlIGlzICJsb2FkaW5nIiwgImxvYWRlZCIsIGV4ZWN1dGlvbiwKICAgICAgICAvLyB0aGVuICJjb21wbGV0ZSIuIFRoZSBVQSBjaGVjayBpcyB1bmZvcnR1bmF0ZSwgYnV0IG5vdCBzdXJlIGhvdwogICAgICAgIC8vdG8gZmVhdHVyZSB0ZXN0IHcvbyBjYXVzaW5nIHBlcmYgaXNzdWVzLgogICAgICAgIHJlYWR5UmVnRXhwID0gaXNCcm93c2VyICYmIG5hdmlnYXRvci5wbGF0Zm9ybSA9PT0gJ1BMQVlTVEFUSU9OIDMnID8KICAgICAgICAgICAgICAgICAgICAgIC9eY29tcGxldGUkLyA6IC9eKGNvbXBsZXRlfGxvYWRlZCkkLywKICAgICAgICBkZWZDb250ZXh0TmFtZSA9ICJfIiwKICAgICAgICAvL09oIHRoZSB0cmFnZWR5LCBkZXRlY3Rpbmcgb3BlcmEuIFNlZSB0aGUgdXNhZ2Ugb2YgaXNPcGVyYSBmb3IgcmVhc29uLgogICAgICAgIGlzT3BlcmEgPSB0eXBlb2Ygb3BlcmEgIT09ICJ1bmRlZmluZWQiICYmIG9wZXJhLnRvU3RyaW5nKCkgPT09ICJbb2JqZWN0IE9wZXJhXSIsCiAgICAgICAgZW1wdHkgPSB7fSwKICAgICAgICBjb250ZXh0cyA9IHt9LAogICAgICAgIGdsb2JhbERlZlF1ZXVlID0gW10sCiAgICAgICAgaW50ZXJhY3RpdmVTY3JpcHQgPSBudWxsLAogICAgICAgIGNoZWNrTG9hZGVkRGVwdGggPSAwLAogICAgICAgIHVzZUludGVyYWN0aXZlID0gZmFsc2UsCiAgICAgICAgcmVzZXJ2ZWREZXBlbmRlbmNpZXMgPSB7CiAgICAgICAgICAgIHJlcXVpcmU6IHRydWUsCiAgICAgICAgICAgIG1vZHVsZTogdHJ1ZSwKICAgICAgICAgICAgZXhwb3J0czogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgcmVxLCBjZmcgPSB7fSwgY3VycmVudGx5QWRkaW5nU2NyaXB0LCBzLCBoZWFkLCBiYXNlRWxlbWVudCwgc2NyaXB0cywgc2NyaXB0LAogICAgICAgIHNyYywgc3ViUGF0aCwgbWFpblNjcmlwdCwgZGF0YU1haW4sIGdsb2JhbEksIGN0eCwgalF1ZXJ5Q2hlY2ssIGNoZWNrTG9hZGVkVGltZW91dElkOwoKICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gb3N0cmluZy5jYWxsKGl0KSA9PT0gIltvYmplY3QgRnVuY3Rpb25dIjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0FycmF5KGl0KSB7CiAgICAgICAgcmV0dXJuIG9zdHJpbmcuY2FsbChpdCkgPT09ICJbb2JqZWN0IEFycmF5XSI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaW1wbGUgZnVuY3Rpb24gdG8gbWl4IGluIHByb3BlcnRpZXMgZnJvbSBzb3VyY2UgaW50byB0YXJnZXQsCiAgICAgKiBidXQgb25seSBpZiB0YXJnZXQgZG9lcyBub3QgYWxyZWFkeSBoYXZlIGEgcHJvcGVydHkgb2YgdGhlIHNhbWUgbmFtZS4KICAgICAqIFRoaXMgaXMgbm90IHJvYnVzdCBpbiBJRSBmb3IgdHJhbnNmZXJyaW5nIG1ldGhvZHMgdGhhdCBtYXRjaAogICAgICogT2JqZWN0LnByb3RvdHlwZSBuYW1lcywgYnV0IHRoZSB1c2VzIG9mIG1peGluIGhlcmUgc2VlbSB1bmxpa2VseSB0bwogICAgICogdHJpZ2dlciBhIHByb2JsZW0gcmVsYXRlZCB0byB0aGF0LgogICAgICovCiAgICBmdW5jdGlvbiBtaXhpbih0YXJnZXQsIHNvdXJjZSwgZm9yY2UpIHsKICAgICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgewogICAgICAgICAgICBpZiAoIShwcm9wIGluIGVtcHR5KSAmJiAoIShwcm9wIGluIHRhcmdldCkgfHwgZm9yY2UpKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0gPSBzb3VyY2VbcHJvcF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdHMgYW4gZXJyb3Igd2l0aCBhIHBvaW50ZXIgdG8gYW4gVVJMIHdpdGggbW9yZSBpbmZvcm1hdGlvbi4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZCB0aGUgZXJyb3IgSUQgdGhhdCBtYXBzIHRvIGFuIElEIG9uIGEgd2ViIHBhZ2UuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBodW1hbiByZWFkYWJsZSBlcnJvci4KICAgICAqIEBwYXJhbSB7RXJyb3J9IFtlcnJdIHRoZSBvcmlnaW5hbCBlcnJvciwgaWYgdGhlcmUgaXMgb25lLgogICAgICoKICAgICAqIEByZXR1cm5zIHtFcnJvcn0KICAgICAqLwogICAgZnVuY3Rpb24gbWFrZUVycm9yKGlkLCBtc2csIGVycikgewogICAgICAgIHZhciBlID0gbmV3IEVycm9yKG1zZyArICdcbmh0dHA6Ly9yZXF1aXJlanMub3JnL2RvY3MvZXJyb3JzLmh0bWwjJyArIGlkKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIGUub3JpZ2luYWxFcnJvciA9IGVycjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIHRvIHNldCB1cCBwYWNrYWdlIHBhdGhzIGZyb20gYSBwYWNrYWdlUGF0aHMgb3IgcGFja2FnZXMgY29uZmlnIG9iamVjdC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwa2dzIHRoZSBvYmplY3QgdG8gc3RvcmUgdGhlIG5ldyBwYWNrYWdlIGNvbmZpZwogICAgICogQHBhcmFtIHtBcnJheX0gY3VycmVudFBhY2thZ2VzIGFuIGFycmF5IG9mIHBhY2thZ2VzIHRvIGNvbmZpZ3VyZQogICAgICogQHBhcmFtIHtTdHJpbmd9IFtkaXJdIGEgcHJlZml4IGRpciB0byB1c2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVBhY2thZ2VEaXIocGtncywgY3VycmVudFBhY2thZ2VzLCBkaXIpIHsKICAgICAgICB2YXIgaSwgbG9jYXRpb24sIHBrZ09iajsKCiAgICAgICAgZm9yIChpID0gMDsgKHBrZ09iaiA9IGN1cnJlbnRQYWNrYWdlc1tpXSk7IGkrKykgewogICAgICAgICAgICBwa2dPYmogPSB0eXBlb2YgcGtnT2JqID09PSAic3RyaW5nIiA/IHsgbmFtZTogcGtnT2JqIH0gOiBwa2dPYmo7CiAgICAgICAgICAgIGxvY2F0aW9uID0gcGtnT2JqLmxvY2F0aW9uOwoKICAgICAgICAgICAgLy9BZGQgZGlyIHRvIHRoZSBwYXRoLCBidXQgYXZvaWQgcGF0aHMgdGhhdCBzdGFydCB3aXRoIGEgc2xhc2gKICAgICAgICAgICAgLy9vciBoYXZlIGEgY29sb24gKGluZGljYXRlcyBhIHByb3RvY29sKQogICAgICAgICAgICBpZiAoZGlyICYmICghbG9jYXRpb24gfHwgKGxvY2F0aW9uLmluZGV4T2YoIi8iKSAhPT0gMCAmJiBsb2NhdGlvbi5pbmRleE9mKCI6IikgPT09IC0xKSkpIHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gZGlyICsgIi8iICsgKGxvY2F0aW9uIHx8IHBrZ09iai5uYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9DcmVhdGUgYSBicmFuZCBuZXcgb2JqZWN0IG9uIHBrZ3MsIHNpbmNlIGN1cnJlbnRQYWNrYWdlcyBjYW4KICAgICAgICAgICAgLy9iZSBwYXNzZWQgaW4gYWdhaW4sIGFuZCBjb25maWcucGtncyBpcyB0aGUgaW50ZXJuYWwgdHJhbnNmb3JtZWQKICAgICAgICAgICAgLy9zdGF0ZSBmb3IgYWxsIHBhY2thZ2UgY29uZmlncy4KICAgICAgICAgICAgcGtnc1twa2dPYmoubmFtZV0gPSB7CiAgICAgICAgICAgICAgICBuYW1lOiBwa2dPYmoubmFtZSwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiB8fCBwa2dPYmoubmFtZSwKICAgICAgICAgICAgICAgIC8vUmVtb3ZlIGxlYWRpbmcgZG90IGluIG1haW4sIHNvIG1haW4gcGF0aHMgYXJlIG5vcm1hbGl6ZWQsCiAgICAgICAgICAgICAgICAvL2FuZCByZW1vdmUgYW55IHRyYWlsaW5nIC5qcywgc2luY2UgZGlmZmVyZW50IHBhY2thZ2UKICAgICAgICAgICAgICAgIC8vZW52cyBoYXZlIGRpZmZlcmVudCBjb252ZW50aW9uczogc29tZSB1c2UgYSBtb2R1bGUgbmFtZSwKICAgICAgICAgICAgICAgIC8vc29tZSB1c2UgYSBmaWxlIG5hbWUuCiAgICAgICAgICAgICAgICBtYWluOiAocGtnT2JqLm1haW4gfHwgIm1haW4iKQogICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoY3VyckRpclJlZ0V4cCwgJycpCiAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZShqc1N1ZmZpeFJlZ0V4cCwgJycpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogalF1ZXJ5IDEuNC4zLTEuNS54IHVzZSBhIHJlYWR5V2FpdC9yZWFkeSgpIHBhaXJpbmcgdG8gaG9sZCBET00KICAgICAqIHJlYWR5IGNhbGxiYWNrcywgYnV0IGpRdWVyeSAxLjYgc3VwcG9ydHMgYSBob2xkUmVhZHkoKSBBUEkgaW5zdGVhZC4KICAgICAqIEF0IHNvbWUgcG9pbnQgcmVtb3ZlIHRoZSByZWFkeVdhaXQvcmVhZHkoKSBzdXBwb3J0IGFuZCBqdXN0IHN0aWNrCiAgICAgKiB3aXRoIHVzaW5nIGhvbGRSZWFkeS4KICAgICAqLwogICAgZnVuY3Rpb24galF1ZXJ5SG9sZFJlYWR5KCQsIHNob3VsZEhvbGQpIHsKICAgICAgICBpZiAoJC5ob2xkUmVhZHkpIHsKICAgICAgICAgICAgJC5ob2xkUmVhZHkoc2hvdWxkSG9sZCk7CiAgICAgICAgfSBlbHNlIGlmIChzaG91bGRIb2xkKSB7CiAgICAgICAgICAgICQucmVhZHlXYWl0ICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJC5yZWFkeSh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHR5cGVvZiBkZWZpbmUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgLy9JZiBhIGRlZmluZSBpcyBhbHJlYWR5IGluIHBsYXkgdmlhIGFub3RoZXIgQU1EIGxvYWRlciwKICAgICAgICAvL2RvIG5vdCBvdmVyd3JpdGUuCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICh0eXBlb2YgcmVxdWlyZWpzICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGlmIChpc0Z1bmN0aW9uKHJlcXVpcmVqcykpIHsKICAgICAgICAgICAgLy9EbyBub3Qgb3ZlcndyaXRlIGFuZCBleGlzdGluZyByZXF1aXJlanMgaW5zdGFuY2UuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjZmcgPSByZXF1aXJlanM7CiAgICAgICAgICAgIHJlcXVpcmVqcyA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICB9CgogICAgLy9BbGxvdyBmb3IgYSByZXF1aXJlIGNvbmZpZyBvYmplY3QKICAgIGlmICh0eXBlb2YgcmVxdWlyZSAhPT0gInVuZGVmaW5lZCIgJiYgIWlzRnVuY3Rpb24ocmVxdWlyZSkpIHsKICAgICAgICAvL2Fzc3VtZSBpdCBpcyBhIGNvbmZpZyBvYmplY3QuCiAgICAgICAgY2ZnID0gcmVxdWlyZTsKICAgICAgICByZXF1aXJlID0gdW5kZWZpbmVkOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIG5ldyBjb250ZXh0IGZvciB1c2UgaW4gcmVxdWlyZSBhbmQgZGVmaW5lIGNhbGxzLgogICAgICogSGFuZGxlIG1vc3Qgb2YgdGhlIGhlYXZ5IGxpZnRpbmcuIERvIG5vdCB3YW50IHRvIHVzZSBhbiBvYmplY3QKICAgICAqIHdpdGggcHJvdG90eXBlIGhlcmUgdG8gYXZvaWQgdXNpbmcgInRoaXMiIGluIHJlcXVpcmUsIGluIGNhc2UgaXQKICAgICAqIG5lZWRzIHRvIGJlIHVzZWQgaW4gbW9yZSBzdXBlciBzZWN1cmUgZW52cyB0aGF0IGRvIG5vdCB3YW50IHRoaXMuCiAgICAgKiBBbHNvIHRoZXJlIHNob3VsZCBub3QgYmUgdGhhdCBtYW55IGNvbnRleHRzIGluIHRoZSBwYWdlLiBVc3VhbGx5IGp1c3QKICAgICAqIG9uZSBmb3IgdGhlIGRlZmF1bHQgY29udGV4dCwgYnV0IGNvdWxkIGJlIGV4dHJhIGZvciBtdWx0aXZlcnNpb24gY2FzZXMKICAgICAqIG9yIGlmIGEgcGFja2FnZSBuZWVkcyBhIHNwZWNpYWwgY29udGV4dCBmb3IgYSBkZXBlbmRlbmN5IHRoYXQgY29uZmxpY3RzCiAgICAgKiB3aXRoIHRoZSBzdGFuZGFyZCBjb250ZXh0LgogICAgICovCiAgICBmdW5jdGlvbiBuZXdDb250ZXh0KGNvbnRleHROYW1lKSB7CiAgICAgICAgdmFyIGNvbnRleHQsIHJlc3VtZSwKICAgICAgICAgICAgY29uZmlnID0gewogICAgICAgICAgICAgICAgd2FpdFNlY29uZHM6IDcsCiAgICAgICAgICAgICAgICBiYXNlVXJsOiAiLi8iLAogICAgICAgICAgICAgICAgcGF0aHM6IHt9LAogICAgICAgICAgICAgICAgcGtnczoge30sCiAgICAgICAgICAgICAgICBjYXRjaEVycm9yOiB7fQogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZRdWV1ZSA9IFtdLAogICAgICAgICAgICBzcGVjaWZpZWQgPSB7CiAgICAgICAgICAgICAgICAicmVxdWlyZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZXhwb3J0cyI6IHRydWUsCiAgICAgICAgICAgICAgICAibW9kdWxlIjogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB1cmxNYXAgPSB7fSwKICAgICAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgICAgICBsb2FkZWQgPSB7fSwKICAgICAgICAgICAgd2FpdGluZyA9IHt9LAogICAgICAgICAgICB3YWl0QXJ5ID0gW10sCiAgICAgICAgICAgIHVybEZldGNoZWQgPSB7fSwKICAgICAgICAgICAgbWFuYWdlckNvdW50ZXIgPSAwLAogICAgICAgICAgICBtYW5hZ2VyQ2FsbGJhY2tzID0ge30sCiAgICAgICAgICAgIHBsdWdpbnMgPSB7fSwKICAgICAgICAgICAgLy9Vc2VkIHRvIGluZGljYXRlIHdoaWNoIG1vZHVsZXMgaW4gYSBidWlsZCBzY2VuYXJpbwogICAgICAgICAgICAvL25lZWQgdG8gYmUgZnVsbCBleGVjdXRlZC4KICAgICAgICAgICAgbmVlZEZ1bGxFeGVjID0ge30sCiAgICAgICAgICAgIGZ1bGxFeGVjID0ge30sCiAgICAgICAgICAgIHJlc3VtZURlcHRoID0gMDsKCiAgICAgICAgLyoqCiAgICAgICAgICogVHJpbXMgdGhlIC4gYW5kIC4uIGZyb20gYW4gYXJyYXkgb2YgcGF0aCBzZWdtZW50cy4KICAgICAgICAgKiBJdCB3aWxsIGtlZXAgYSBsZWFkaW5nIHBhdGggc2VnbWVudCBpZiBhIC4uIHdpbGwgYmVjb21lCiAgICAgICAgICogdGhlIGZpcnN0IHBhdGggc2VnbWVudCwgdG8gaGVscCB3aXRoIG1vZHVsZSBuYW1lIGxvb2t1cHMsCiAgICAgICAgICogd2hpY2ggYWN0IGxpa2UgcGF0aHMsIGJ1dCBjYW4gYmUgcmVtYXBwZWQuIEJ1dCB0aGUgZW5kIHJlc3VsdCwKICAgICAgICAgKiBhbGwgcGF0aHMgdGhhdCB1c2UgdGhpcyBmdW5jdGlvbiBzaG91bGQgbG9vayBub3JtYWxpemVkLgogICAgICAgICAqIE5PVEU6IHRoaXMgbWV0aG9kIE1PRElGSUVTIHRoZSBpbnB1dCBhcnJheS4KICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnkgdGhlIGFycmF5IG9mIHBhdGggc2VnbWVudHMuCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gdHJpbURvdHMoYXJ5KSB7CiAgICAgICAgICAgIHZhciBpLCBwYXJ0OwogICAgICAgICAgICBmb3IgKGkgPSAwOyAocGFydCA9IGFyeVtpXSk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09ICIuIikgewogICAgICAgICAgICAgICAgICAgIGFyeS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgaSAtPSAxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0ID09PSAiLi4iKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKGFyeVsyXSA9PT0gJy4uJyB8fCBhcnlbMF0gPT09ICcuLicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90CiAgICAgICAgICAgICAgICAgICAgICAgIC8vcGF0aCBzZWdtZW50IGF0IHRoZSBmcm9udCBzbyBpdCBjYW4gYmUgbWFwcGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29ycmVjdGx5IHRvIGRpc2suIE90aGVyd2lzZSwgdGhlcmUgaXMgbGlrZWx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLgogICAgICAgICAgICAgICAgICAgICAgICAvL1RoaXMgY2FuIHN0aWxsIGZhaWwsIGJ1dCBjYXRjaGVzIHRoZSBtb3N0IHJlYXNvbmFibGUKICAgICAgICAgICAgICAgICAgICAgICAgLy91c2VzIG9mIC4uCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXJ5LnNwbGljZShpIC0gMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEdpdmVuIGEgcmVsYXRpdmUgbW9kdWxlIG5hbWUsIGxpa2UgLi9zb21ldGhpbmcsIG5vcm1hbGl6ZSBpdCB0bwogICAgICAgICAqIGEgcmVhbCBuYW1lIHRoYXQgY2FuIGJlIG1hcHBlZCB0byBhIHBhdGguCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIHJlbGF0aXZlIG5hbWUKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgYSByZWFsIG5hbWUgdGhhdCB0aGUgbmFtZSBhcmcgaXMgcmVsYXRpdmUKICAgICAgICAgKiB0by4KICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBub3JtYWxpemVkIG5hbWUKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBub3JtYWxpemUobmFtZSwgYmFzZU5hbWUpIHsKICAgICAgICAgICAgdmFyIHBrZ05hbWUsIHBrZ0NvbmZpZzsKCiAgICAgICAgICAgIC8vQWRqdXN0IGFueSByZWxhdGl2ZSBwYXRocy4KICAgICAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAgICAgLy9JZiBoYXZlIGEgYmFzZSBuYW1lLCB0cnkgdG8gbm9ybWFsaXplIGFnYWluc3QgaXQsCiAgICAgICAgICAgICAgICAvL290aGVyd2lzZSwgYXNzdW1lIGl0IGlzIGEgdG9wLWxldmVsIHJlcXVpcmUgdGhhdCB3aWxsCiAgICAgICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgICAgIGlmIChiYXNlTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcucGtnc1tiYXNlTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGUgYmFzZU5hbWUgaXMgYSBwYWNrYWdlIG5hbWUsIHRoZW4ganVzdCB0cmVhdCBpdCBhcyBvbmUKICAgICAgICAgICAgICAgICAgICAgICAgLy9uYW1lIHRvIGNvbmNhdCB0aGUgbmFtZSB3aXRoLgogICAgICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZSA9IFtiYXNlTmFtZV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9Db252ZXJ0IGJhc2VOYW1lIHRvIGFycmF5LCBhbmQgbG9wIG9mZiB0aGUgbGFzdCBwYXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbW9kdWxlLiBGb3IgaW5zdGFuY2UsIGJhc2VOYW1lIG9mICJvbmUvdHdvL3RocmVlIiwgbWFwcyB0bwogICAgICAgICAgICAgICAgICAgICAgICAvLyJvbmUvdHdvL3RocmVlLmpzIiwgYnV0IHdlIHdhbnQgdGhlIGRpcmVjdG9yeSwgIm9uZS90d28iIGZvcgogICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgYmFzZU5hbWUgPSBiYXNlTmFtZS5zcGxpdCgiLyIpOwogICAgICAgICAgICAgICAgICAgICAgICBiYXNlTmFtZSA9IGJhc2VOYW1lLnNsaWNlKDAsIGJhc2VOYW1lLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VOYW1lLmNvbmNhdChuYW1lLnNwbGl0KCIvIikpOwogICAgICAgICAgICAgICAgICAgIHRyaW1Eb3RzKG5hbWUpOwoKICAgICAgICAgICAgICAgICAgICAvL1NvbWUgdXNlIG9mIHBhY2thZ2VzIG1heSB1c2UgYSAuIHBhdGggdG8gcmVmZXJlbmNlIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIm1haW4iIG1vZHVsZSBuYW1lLCBzbyBub3JtYWxpemUgZm9yIHRoYXQuCiAgICAgICAgICAgICAgICAgICAgcGtnQ29uZmlnID0gY29uZmlnLnBrZ3NbKHBrZ05hbWUgPSBuYW1lWzBdKV07CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuam9pbigiLyIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2dDb25maWcgJiYgbmFtZSA9PT0gcGtnTmFtZSArICcvJyArIHBrZ0NvbmZpZy5tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBwa2dOYW1lOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5pbmRleE9mKCIuLyIpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm8gYmFzZU5hbWUsIHNvIHRoaXMgaXMgSUQgaXMgcmVzb2x2ZWQgcmVsYXRpdmUKICAgICAgICAgICAgICAgICAgICAvLyB0byBiYXNlVXJsLCBwdWxsIG9mZiB0aGUgbGVhZGluZyBkb3QuCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIG1vZHVsZSBtYXBwaW5nIHRoYXQgaW5jbHVkZXMgcGx1Z2luIHByZWZpeCwgbW9kdWxlCiAgICAgICAgICogbmFtZSwgYW5kIHBhdGguIElmIHBhcmVudE1vZHVsZU1hcCBpcyBwcm92aWRlZCBpdCB3aWxsCiAgICAgICAgICogYWxzbyBub3JtYWxpemUgdGhlIG5hbWUgdmlhIHJlcXVpcmUubm9ybWFsaXplKCkKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSBtb2R1bGUgbmFtZQogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFyZW50TW9kdWxlTWFwXSBwYXJlbnQgbW9kdWxlIG1hcAogICAgICAgICAqIGZvciB0aGUgbW9kdWxlIG5hbWUsIHVzZWQgdG8gcmVzb2x2ZSByZWxhdGl2ZSBuYW1lcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gbWFrZU1vZHVsZU1hcChuYW1lLCBwYXJlbnRNb2R1bGVNYXApIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gbmFtZSA/IG5hbWUuaW5kZXhPZigiISIpIDogLTEsCiAgICAgICAgICAgICAgICBwcmVmaXggPSBudWxsLAogICAgICAgICAgICAgICAgcGFyZW50TmFtZSA9IHBhcmVudE1vZHVsZU1hcCA/IHBhcmVudE1vZHVsZU1hcC5uYW1lIDogbnVsbCwKICAgICAgICAgICAgICAgIG9yaWdpbmFsTmFtZSA9IG5hbWUsCiAgICAgICAgICAgICAgICBub3JtYWxpemVkTmFtZSwgdXJsLCBwbHVnaW5Nb2R1bGU7CgogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoaW5kZXggKyAxLCBuYW1lLmxlbmd0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgICAgICAgIHByZWZpeCA9IG5vcm1hbGl6ZShwcmVmaXgsIHBhcmVudE5hbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0FjY291bnQgZm9yIHJlbGF0aXZlIHBhdGhzIGlmIHRoZXJlIGlzIGEgYmFzZSBuYW1lLgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgICAgIHBsdWdpbk1vZHVsZSA9IGRlZmluZWRbcHJlZml4XTsKICAgICAgICAgICAgICAgICAgICBpZiAocGx1Z2luTW9kdWxlICYmIHBsdWdpbk1vZHVsZS5ub3JtYWxpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9QbHVnaW4gaXMgbG9hZGVkLCB1c2UgaXRzIG5vcm1hbGl6ZSBtZXRob2QuCiAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWROYW1lID0gcGx1Z2luTW9kdWxlLm5vcm1hbGl6ZShuYW1lLCBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCBwYXJlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZE5hbWUgPSBub3JtYWxpemUobmFtZSwgcGFyZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL0EgcmVndWxhciBtb2R1bGUuCiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZE5hbWUgPSBub3JtYWxpemUobmFtZSwgcGFyZW50TmFtZSk7CgogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybE1hcFtub3JtYWxpemVkTmFtZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9DYWxjdWxhdGUgdXJsIGZvciB0aGUgbW9kdWxlLCBpZiBpdCBoYXMgYSBuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICAvL1VzZSBuYW1lIGhlcmUgc2luY2UgbmFtZVRvVXJsIGFsc28gY2FsbHMgbm9ybWFsaXplLAogICAgICAgICAgICAgICAgICAgICAgICAvL2FuZCBmb3IgcmVsYXRpdmUgbmFtZXMgdGhhdCBhcmUgb3V0c2lkZSB0aGUgYmFzZVVybAogICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMgY2F1c2VzIGhhdm9jLiBXYXMgdGhpbmtpbmcgb2YganVzdCByZW1vdmluZwogICAgICAgICAgICAgICAgICAgICAgICAvL3BhcmVudE1vZHVsZU1hcCB0byBhdm9pZCBleHRyYSBub3JtYWxpemF0aW9uLCBidXQKICAgICAgICAgICAgICAgICAgICAgICAgLy9ub3JtYWxpemUoKSBzdGlsbCBkb2VzIGEgZG90IHJlbW92YWwgYmVjYXVzZSBvZgogICAgICAgICAgICAgICAgICAgICAgICAvL2lzc3VlICMxNDIsIHNvIGp1c3QgcGFzcyBpbiBuYW1lIGhlcmUgYW5kIHJlZG8KICAgICAgICAgICAgICAgICAgICAgICAgLy90aGUgbm9ybWFsaXphdGlvbi4gUGF0aHMgb3V0c2lkZSBiYXNlVXJsIGFyZSBqdXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vbWVzc3kgdG8gc3VwcG9ydC4KICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gY29udGV4dC5uYW1lVG9VcmwobmFtZSwgbnVsbCwgcGFyZW50TW9kdWxlTWFwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RvcmUgdGhlIFVSTCBtYXBwaW5nIGZvciBsYXRlci4KICAgICAgICAgICAgICAgICAgICAgICAgdXJsTWFwW25vcm1hbGl6ZWROYW1lXSA9IHVybDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwcmVmaXg6IHByZWZpeCwKICAgICAgICAgICAgICAgIG5hbWU6IG5vcm1hbGl6ZWROYW1lLAogICAgICAgICAgICAgICAgcGFyZW50TWFwOiBwYXJlbnRNb2R1bGVNYXAsCiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIG9yaWdpbmFsTmFtZTogb3JpZ2luYWxOYW1lLAogICAgICAgICAgICAgICAgZnVsbE5hbWU6IHByZWZpeCA/IHByZWZpeCArICIhIiArIChub3JtYWxpemVkTmFtZSB8fCAnJykgOiBub3JtYWxpemVkTmFtZQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGV0ZXJtaW5lIGlmIHByaW9yaXR5IGxvYWRpbmcgaXMgZG9uZS4gSWYgc28gY2xlYXIgdGhlIHByaW9yaXR5V2FpdAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGlzUHJpb3JpdHlEb25lKCkgewogICAgICAgICAgICB2YXIgcHJpb3JpdHlEb25lID0gdHJ1ZSwKICAgICAgICAgICAgICAgIHByaW9yaXR5V2FpdCA9IGNvbmZpZy5wcmlvcml0eVdhaXQsCiAgICAgICAgICAgICAgICBwcmlvcml0eU5hbWUsIGk7CiAgICAgICAgICAgIGlmIChwcmlvcml0eVdhaXQpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IChwcmlvcml0eU5hbWUgPSBwcmlvcml0eVdhaXRbaV0pOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxvYWRlZFtwcmlvcml0eU5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5RG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocHJpb3JpdHlEb25lKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5wcmlvcml0eVdhaXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHByaW9yaXR5RG9uZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG1ha2VDb250ZXh0TW9kdWxlRnVuYyhmdW5jLCByZWxNb2R1bGVNYXAsIGVuYWJsZUJ1aWxkQ2FsbGJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vQSB2ZXJzaW9uIG9mIGEgcmVxdWlyZSBmdW5jdGlvbiB0aGF0IHBhc3NlcyBhIG1vZHVsZU5hbWUKICAgICAgICAgICAgICAgIC8vdmFsdWUgZm9yIGl0ZW1zIHRoYXQgbWF5IG5lZWQgdG8KICAgICAgICAgICAgICAgIC8vbG9vayB1cCBwYXRocyByZWxhdGl2ZSB0byB0aGUgbW9kdWxlTmFtZQogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcHMuY2FsbChhcmd1bWVudHMsIDApLCBsYXN0QXJnOwogICAgICAgICAgICAgICAgaWYgKGVuYWJsZUJ1aWxkQ2FsbGJhY2sgJiYKICAgICAgICAgICAgICAgICAgICBpc0Z1bmN0aW9uKChsYXN0QXJnID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdKSkpIHsKICAgICAgICAgICAgICAgICAgICBsYXN0QXJnLl9fcmVxdWlyZUpzQnVpbGQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXJncy5wdXNoKHJlbE1vZHVsZU1hcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShudWxsLCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEhlbHBlciBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSByZXF1aXJlIGZ1bmN0aW9uIG9iamVjdCB0byBnaXZlIHRvCiAgICAgICAgICogbW9kdWxlcyB0aGF0IGFzayBmb3IgaXQgYXMgYSBkZXBlbmRlbmN5LiBJdCBuZWVkcyB0byBiZSBzcGVjaWZpYwogICAgICAgICAqIHBlciBtb2R1bGUgYmVjYXVzZSBvZiB0aGUgaW1wbGljYXRpb24gb2YgcGF0aCBtYXBwaW5ncyB0aGF0IG1heQogICAgICAgICAqIG5lZWQgdG8gYmUgcmVsYXRpdmUgdG8gdGhlIG1vZHVsZSBuYW1lLgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG1ha2VSZXF1aXJlKHJlbE1vZHVsZU1hcCwgZW5hYmxlQnVpbGRDYWxsYmFjaywgYWx0UmVxdWlyZSkgewogICAgICAgICAgICB2YXIgbW9kUmVxdWlyZSA9IG1ha2VDb250ZXh0TW9kdWxlRnVuYyhhbHRSZXF1aXJlIHx8IGNvbnRleHQucmVxdWlyZSwgcmVsTW9kdWxlTWFwLCBlbmFibGVCdWlsZENhbGxiYWNrKTsKCiAgICAgICAgICAgIG1peGluKG1vZFJlcXVpcmUsIHsKICAgICAgICAgICAgICAgIG5hbWVUb1VybDogbWFrZUNvbnRleHRNb2R1bGVGdW5jKGNvbnRleHQubmFtZVRvVXJsLCByZWxNb2R1bGVNYXApLAogICAgICAgICAgICAgICAgdG9Vcmw6IG1ha2VDb250ZXh0TW9kdWxlRnVuYyhjb250ZXh0LnRvVXJsLCByZWxNb2R1bGVNYXApLAogICAgICAgICAgICAgICAgZGVmaW5lZDogbWFrZUNvbnRleHRNb2R1bGVGdW5jKGNvbnRleHQucmVxdWlyZURlZmluZWQsIHJlbE1vZHVsZU1hcCksCiAgICAgICAgICAgICAgICBzcGVjaWZpZWQ6IG1ha2VDb250ZXh0TW9kdWxlRnVuYyhjb250ZXh0LnJlcXVpcmVTcGVjaWZpZWQsIHJlbE1vZHVsZU1hcCksCiAgICAgICAgICAgICAgICBpc0Jyb3dzZXI6IHJlcS5pc0Jyb3dzZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBtb2RSZXF1aXJlOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgKiBRdWV1ZXMgYSBkZXBlbmRlbmN5IGZvciBjaGVja2luZyBhZnRlciB0aGUgbG9hZGVyIGlzIG91dCBvZiBhCiAgICAgICAgICogInBhdXNlZCIgc3RhdGUsIGZvciBleGFtcGxlIHdoaWxlIGEgc2NyaXB0IGZpbGUgaXMgYmVpbmcgbG9hZGVkCiAgICAgICAgICogaW4gdGhlIGJyb3dzZXIsIHdoZXJlIGl0IG1heSBoYXZlIG1hbnkgbW9kdWxlcyBkZWZpbmVkIGluIGl0LgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHF1ZXVlRGVwZW5kZW5jeShtYW5hZ2VyKSB7CiAgICAgICAgICAgIGNvbnRleHQucGF1c2VkLnB1c2gobWFuYWdlcik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleGVjTWFuYWdlcihtYW5hZ2VyKSB7CiAgICAgICAgICAgIHZhciBpLCByZXQsIGVyciwgZXJyRmlsZSwgZXJyTW9kdWxlVHJlZSwKICAgICAgICAgICAgICAgIGNiID0gbWFuYWdlci5jYWxsYmFjaywKICAgICAgICAgICAgICAgIG1hcCA9IG1hbmFnZXIubWFwLAogICAgICAgICAgICAgICAgZnVsbE5hbWUgPSBtYXAuZnVsbE5hbWUsCiAgICAgICAgICAgICAgICBhcmdzID0gbWFuYWdlci5kZXBzLAogICAgICAgICAgICAgICAgbGlzdGVuZXJzID0gbWFuYWdlci5saXN0ZW5lcnMsCiAgICAgICAgICAgICAgICBjanNNb2R1bGU7CgogICAgICAgICAgICAvL0NhbGwgdGhlIGNhbGxiYWNrIHRvIGRlZmluZSB0aGUgbW9kdWxlLCBpZiBuZWNlc3NhcnkuCiAgICAgICAgICAgIGlmIChjYiAmJiBpc0Z1bmN0aW9uKGNiKSkgewogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5jYXRjaEVycm9yLmRlZmluZSkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHJlcS5leGVjQ2IoZnVsbE5hbWUsIG1hbmFnZXIuY2FsbGJhY2ssIGFyZ3MsIGRlZmluZWRbZnVsbE5hbWVdKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXQgPSByZXEuZXhlY0NiKGZ1bGxOYW1lLCBtYW5hZ2VyLmNhbGxiYWNrLCBhcmdzLCBkZWZpbmVkW2Z1bGxOYW1lXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGZ1bGxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAgICAgLy9mYXZvciB0aGF0IG92ZXIgcmV0dXJuIHZhbHVlIGFuZCBleHBvcnRzLiBBZnRlciB0aGF0LAogICAgICAgICAgICAgICAgICAgIC8vZmF2b3IgYSBub24tdW5kZWZpbmVkIHJldHVybiB2YWx1ZSBvdmVyIGV4cG9ydHMgdXNlLgogICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZSA9IG1hbmFnZXIuY2pzTW9kdWxlOwogICAgICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgICAgICAgICAgICAvL01ha2Ugc3VyZSBpdCBpcyBub3QgYWxyZWFkeSB0aGUgZXhwb3J0cyB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUuZXhwb3J0cyAhPT0gZGVmaW5lZFtmdWxsTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZGVmaW5lZFtmdWxsTmFtZV0gPSBtYW5hZ2VyLmNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0ID09PSB1bmRlZmluZWQgJiYgbWFuYWdlci51c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9leHBvcnRzIGFscmVhZHkgc2V0IHRoZSBkZWZpbmVkIHZhbHVlLgogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBkZWZpbmVkW2Z1bGxOYW1lXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVkW2Z1bGxOYW1lXSA9IHJldDsKICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB0aGlzIG1vZHVsZSBuZWVkZWQgZnVsbCBleGVjdXRpb24gaW4gYSBidWlsZAogICAgICAgICAgICAgICAgICAgICAgICAvL2Vudmlyb25tZW50LCBtYXJrIHRoYXQgbm93LgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVlZEZ1bGxFeGVjW2Z1bGxOYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbEV4ZWNbZnVsbE5hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChmdWxsTmFtZSkgewogICAgICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAgICAgLy93b3JyeSBhYm91dCBkZWZpbmluZyBpZiBoYXZlIGEgbW9kdWxlIG5hbWUuCiAgICAgICAgICAgICAgICByZXQgPSBkZWZpbmVkW2Z1bGxOYW1lXSA9IGNiOwoKICAgICAgICAgICAgICAgIC8vSWYgdGhpcyBtb2R1bGUgbmVlZGVkIGZ1bGwgZXhlY3V0aW9uIGluIGEgYnVpbGQKICAgICAgICAgICAgICAgIC8vZW52aXJvbm1lbnQsIG1hcmsgdGhhdCBub3cuCiAgICAgICAgICAgICAgICBpZiAobmVlZEZ1bGxFeGVjW2Z1bGxOYW1lXSkgewogICAgICAgICAgICAgICAgICAgIGZ1bGxFeGVjW2Z1bGxOYW1lXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vQ2xlYW4gdXAgd2FpdGluZy4gRG8gdGhpcyBiZWZvcmUgZXJyb3IgY2FsbHMsIGFuZCBiZWZvcmUKICAgICAgICAgICAgLy9jYWxsaW5nIGJhY2sgbGlzdGVuZXJzLCBzbyB0aGF0IGJvb2trZWVwaW5nIGlzIGNvcnJlY3QKICAgICAgICAgICAgLy9pbiB0aGUgZXZlbnQgb2YgYW4gZXJyb3IgYW5kIGVycm9yIGlzIHJlcG9ydGVkIGluIGNvcnJlY3Qgb3JkZXIsCiAgICAgICAgICAgIC8vc2luY2UgdGhlIGxpc3RlbmVycyB3aWxsIGxpa2VseSBoYXZlIGVycm9ycyBpZiB0aGUKICAgICAgICAgICAgLy9vbkVycm9yIGZ1bmN0aW9uIGRvZXMgbm90IHRocm93LgogICAgICAgICAgICBpZiAod2FpdGluZ1ttYW5hZ2VyLmlkXSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbWFuYWdlci5pZF07CiAgICAgICAgICAgICAgICBtYW5hZ2VyLmlzRG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICBjb250ZXh0LndhaXRDb3VudCAtPSAxOwogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQud2FpdENvdW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy9DbGVhciB0aGUgd2FpdCBhcnJheSB1c2VkIGZvciBjeWNsZXMuCiAgICAgICAgICAgICAgICAgICAgd2FpdEFyeSA9IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0RvIG5vdCBuZWVkIHRvIHRyYWNrIG1hbmFnZXIgY2FsbGJhY2sgbm93IHRoYXQgaXQgaXMgZGVmaW5lZC4KICAgICAgICAgICAgZGVsZXRlIG1hbmFnZXJDYWxsYmFja3NbZnVsbE5hbWVdOwoKICAgICAgICAgICAgLy9BbGxvdyBpbnN0cnVtZW50YXRpb24gbGlrZSB0aGUgb3B0aW1pemVyIHRvIGtub3cgdGhlIG9yZGVyCiAgICAgICAgICAgIC8vb2YgbW9kdWxlcyBleGVjdXRlZCBhbmQgdGhlaXIgZGVwZW5kZW5jaWVzLgogICAgICAgICAgICBpZiAocmVxLm9uUmVzb3VyY2VMb2FkICYmICFtYW5hZ2VyLnBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgICAgICByZXEub25SZXNvdXJjZUxvYWQoY29udGV4dCwgbWFwLCBtYW5hZ2VyLmRlcEFycmF5KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgZXJyRmlsZSA9IChmdWxsTmFtZSA/IG1ha2VNb2R1bGVNYXAoZnVsbE5hbWUpLnVybCA6ICcnKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBlcnIuZmlsZU5hbWUgfHwgZXJyLnNvdXJjZVVSTDsKICAgICAgICAgICAgICAgIGVyck1vZHVsZVRyZWUgPSBlcnIubW9kdWxlVHJlZTsKICAgICAgICAgICAgICAgIGVyciA9IG1ha2VFcnJvcignZGVmaW5lZXJyb3InLCAnRXJyb3IgZXZhbHVhdGluZyAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kdWxlICInICsgZnVsbE5hbWUgKyAnIiBhdCBsb2NhdGlvbiAiJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyRmlsZSArICciOlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyICsgJ1xuZmlsZU5hbWU6JyArIGVyckZpbGUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcbmxpbmVOdW1iZXI6ICcgKyAoZXJyLmxpbmVOdW1iZXIgfHwgZXJyLmxpbmUpLCBlcnIpOwogICAgICAgICAgICAgICAgZXJyLm1vZHVsZU5hbWUgPSBmdWxsTmFtZTsKICAgICAgICAgICAgICAgIGVyci5tb2R1bGVUcmVlID0gZXJyTW9kdWxlVHJlZTsKICAgICAgICAgICAgICAgIHJldHVybiByZXEub25FcnJvcihlcnIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0xldCBsaXN0ZW5lcnMga25vdyBvZiB0aGlzIG1hbmFnZXIncyB2YWx1ZS4KICAgICAgICAgICAgZm9yIChpID0gMDsgKGNiID0gbGlzdGVuZXJzW2ldKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjYihyZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSGVscGVyIHRoYXQgY3JlYXRlcyBhIGNhbGxhY2sgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIGRlcGVuZGVuY3kKICAgICAgICAgKiBpcyByZWFkeSwgYW5kIHNldHMgdGhlIGktdGggZGVwZW5kZW5jeSBmb3IgdGhlIG1hbmFnZXIgYXMgdGhlCiAgICAgICAgICogdmFsdWUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjayBnZW5lcmF0ZWQgYnkgdGhpcyBmdW5jdGlvbi4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBtYWtlQXJnQ2FsbGJhY2sobWFuYWdlciwgaSkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvL09ubHkgZG8gdGhlIHdvcmsgaWYgaXQgaGFzIG5vdCBiZWVuIGRvbmUKICAgICAgICAgICAgICAgIC8vYWxyZWFkeSBmb3IgYSBkZXBlbmRlbmN5LiBDeWNsZSBicmVha2luZwogICAgICAgICAgICAgICAgLy9sb2dpYyBpbiBmb3JjZUV4ZWMgY291bGQgbWVhbiB0aGlzIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAvL2lzIGNhbGxlZCBtb3JlIHRoYW4gb25jZSBmb3IgYSBnaXZlbiBkZXBlbmRlbmN5LgogICAgICAgICAgICAgICAgaWYgKCFtYW5hZ2VyLmRlcERvbmVbaV0pIHsKICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLmRlcERvbmVbaV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG1hbmFnZXIuZGVwc1tpXSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIG1hbmFnZXIuZGVwQ291bnQgLT0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1hbmFnZXIuZGVwQ291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9BbGwgZG9uZSwgZXhlY3V0ZSEKICAgICAgICAgICAgICAgICAgICAgICAgZXhlY01hbmFnZXIobWFuYWdlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2FsbFBsdWdpbihwbHVnaW5OYW1lLCBkZXBNYW5hZ2VyKSB7CiAgICAgICAgICAgIHZhciBtYXAgPSBkZXBNYW5hZ2VyLm1hcCwKICAgICAgICAgICAgICAgIGZ1bGxOYW1lID0gbWFwLmZ1bGxOYW1lLAogICAgICAgICAgICAgICAgbmFtZSA9IG1hcC5uYW1lLAogICAgICAgICAgICAgICAgcGx1Z2luID0gcGx1Z2luc1twbHVnaW5OYW1lXSB8fAogICAgICAgICAgICAgICAgICAgICAgICAocGx1Z2luc1twbHVnaW5OYW1lXSA9IGRlZmluZWRbcGx1Z2luTmFtZV0pLAogICAgICAgICAgICAgICAgbG9hZDsKCiAgICAgICAgICAgIC8vTm8gbmVlZCB0byBjb250aW51ZSBpZiB0aGUgbWFuYWdlciBpcyBhbHJlYWR5CiAgICAgICAgICAgIC8vaW4gdGhlIHByb2Nlc3Mgb2YgbG9hZGluZy4KICAgICAgICAgICAgaWYgKGRlcE1hbmFnZXIubG9hZGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlcE1hbmFnZXIubG9hZGluZyA9IHRydWU7CgogICAgICAgICAgICBsb2FkID0gZnVuY3Rpb24gKHJldCkgewogICAgICAgICAgICAgICAgZGVwTWFuYWdlci5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGV4ZWNNYW5hZ2VyKGRlcE1hbmFnZXIpOwoKICAgICAgICAgICAgICAgIGxvYWRlZFtkZXBNYW5hZ2VyLmlkXSA9IHRydWU7CgogICAgICAgICAgICAgICAgLy9UaGUgbG9hZGluZyBvZiB0aGlzIHBsdWdpbgogICAgICAgICAgICAgICAgLy9taWdodCBoYXZlIHBsYWNlZCBvdGhlciB0aGluZ3MKICAgICAgICAgICAgICAgIC8vaW4gdGhlIHBhdXNlZCBxdWV1ZS4gSW4gcGFydGljdWxhciwKICAgICAgICAgICAgICAgIC8vYSBsb2FkZXIgcGx1Z2luIHRoYXQgZGVwZW5kcyBvbgogICAgICAgICAgICAgICAgLy9hIGRpZmZlcmVudCBwbHVnaW4gbG9hZGVkIHJlc291cmNlLgogICAgICAgICAgICAgICAgcmVzdW1lKCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvL0FsbG93IHBsdWdpbnMgdG8gbG9hZCBvdGhlciBjb2RlIHdpdGhvdXQgaGF2aW5nIHRvIGtub3cgdGhlCiAgICAgICAgICAgIC8vY29udGV4dCBvciBob3cgdG8gImNvbXBsZXRlIiB0aGUgbG9hZC4KICAgICAgICAgICAgbG9hZC5mcm9tVGV4dCA9IGZ1bmN0aW9uIChtb2R1bGVOYW1lLCB0ZXh0KSB7CiAgICAgICAgICAgICAgICAvKmpzbGludCBldmlsOiB0cnVlICovCiAgICAgICAgICAgICAgICB2YXIgaGFzSW50ZXJhY3RpdmUgPSB1c2VJbnRlcmFjdGl2ZTsKCiAgICAgICAgICAgICAgICAvL0luZGljYXRlIGEgdGhlIG1vZHVsZSBpcyBpbiBwcm9jZXNzIG9mIGxvYWRpbmcuCiAgICAgICAgICAgICAgICBsb2FkZWRbbW9kdWxlTmFtZV0gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnRleHQuc2NyaXB0Q291bnQgKz0gMTsKCiAgICAgICAgICAgICAgICAvL0luZGljYXRlIHRoaXMgaXMgbm90IGEgInJlYWwiIG1vZHVsZSwgc28gZG8gbm90IHRyYWNrIGl0CiAgICAgICAgICAgICAgICAvL2ZvciBidWlsZHMsIGl0IGRvZXMgbm90IG1hcCB0byBhIHJlYWwgZmlsZS4KICAgICAgICAgICAgICAgIGNvbnRleHQuZmFrZVttb2R1bGVOYW1lXSA9IHRydWU7CgogICAgICAgICAgICAgICAgLy9UdXJuIG9mZiBpbnRlcmFjdGl2ZSBzY3JpcHQgbWF0Y2hpbmcgZm9yIElFIGZvciBhbnkgZGVmaW5lCiAgICAgICAgICAgICAgICAvL2NhbGxzIGluIHRoZSB0ZXh0LCB0aGVuIHR1cm4gaXQgYmFjayBvbiBhdCB0aGUgZW5kLgogICAgICAgICAgICAgICAgaWYgKGhhc0ludGVyYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlSW50ZXJhY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXEuZXhlYyh0ZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoaGFzSW50ZXJhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICB1c2VJbnRlcmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9TdXBwb3J0IGFub255bW91cyBtb2R1bGVzLgogICAgICAgICAgICAgICAgY29udGV4dC5jb21wbGV0ZUxvYWQobW9kdWxlTmFtZSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvL05vIG5lZWQgdG8gY29udGludWUgaWYgdGhlIHBsdWdpbiB2YWx1ZSBoYXMgYWxyZWFkeSBiZWVuCiAgICAgICAgICAgIC8vZGVmaW5lZCBieSBhIGJ1aWxkLgogICAgICAgICAgICBpZiAoZnVsbE5hbWUgaW4gZGVmaW5lZCkgewogICAgICAgICAgICAgICAgbG9hZChkZWZpbmVkW2Z1bGxOYW1lXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvL1VzZSBwYXJlbnROYW1lIGhlcmUgc2luY2UgdGhlIHBsdWdpbidzIG5hbWUgaXMgbm90IHJlbGlhYmxlLAogICAgICAgICAgICAgICAgLy9jb3VsZCBiZSBzb21lIHdlaXJkIHN0cmluZyB3aXRoIG5vIHBhdGggdGhhdCBhY3R1YWxseSB3YW50cyB0bwogICAgICAgICAgICAgICAgLy9yZWZlcmVuY2UgdGhlIHBhcmVudE5hbWUncyBwYXRoLgogICAgICAgICAgICAgICAgcGx1Z2luLmxvYWQobmFtZSwgbWFrZVJlcXVpcmUobWFwLnBhcmVudE1hcCwgdHJ1ZSwgZnVuY3Rpb24gKGRlcHMsIGNiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZHVsZURlcHMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgaSwgZGVwLCBkZXBNYXA7CiAgICAgICAgICAgICAgICAgICAgLy9Db252ZXJ0IGRlcHMgdG8gZnVsbCBuYW1lcyBhbmQgaG9sZCBvbiB0byB0aGVtCiAgICAgICAgICAgICAgICAgICAgLy9mb3IgcmVmZXJlbmNlIGxhdGVyLCB3aGVuIGZpZ3VyaW5nIG91dCBpZiB0aGV5CiAgICAgICAgICAgICAgICAgICAgLy9hcmUgYmxvY2tlZCBieSBhIGNpcmN1bGFyIGRlcGVuZGVuY3kuCiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgKGRlcCA9IGRlcHNbaV0pOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVwTWFwID0gbWFrZU1vZHVsZU1hcChkZXAsIG1hcC5wYXJlbnRNYXApOwogICAgICAgICAgICAgICAgICAgICAgICBkZXBzW2ldID0gZGVwTWFwLmZ1bGxOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRlcE1hcC5wcmVmaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZURlcHMucHVzaChkZXBzW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkZXBNYW5hZ2VyLm1vZHVsZURlcHMgPSAoZGVwTWFuYWdlci5tb2R1bGVEZXBzIHx8IFtdKS5jb25jYXQobW9kdWxlRGVwcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucmVxdWlyZShkZXBzLCBjYik7CiAgICAgICAgICAgICAgICB9KSwgbG9hZCwgY29uZmlnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkcyB0aGUgbWFuYWdlciB0byB0aGUgd2FpdGluZyBxdWV1ZS4gT25seSBmdWxseQogICAgICAgICAqIHJlc29sdmVkIGl0ZW1zIHNob3VsZCBiZSBpbiB0aGUgd2FpdGluZyBxdWV1ZS4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBhZGRXYWl0KG1hbmFnZXIpIHsKICAgICAgICAgICAgaWYgKCF3YWl0aW5nW21hbmFnZXIuaWRdKSB7CiAgICAgICAgICAgICAgICB3YWl0aW5nW21hbmFnZXIuaWRdID0gbWFuYWdlcjsKICAgICAgICAgICAgICAgIHdhaXRBcnkucHVzaChtYW5hZ2VyKTsKICAgICAgICAgICAgICAgIGNvbnRleHQud2FpdENvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEZ1bmN0aW9uIGFkZGVkIHRvIGV2ZXJ5IG1hbmFnZXIgb2JqZWN0LiBDcmVhdGVkIG91dCBoZXJlCiAgICAgICAgICogdG8gYXZvaWQgbmV3IGZ1bmN0aW9uIGNyZWF0aW9uIGZvciBlYWNoIG1hbmFnZXIgaW5zdGFuY2UuCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gbWFuYWdlckFkZChjYikgewogICAgICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGNiKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldE1hbmFnZXIobWFwLCBzaG91bGRRdWV1ZSkgewogICAgICAgICAgICB2YXIgZnVsbE5hbWUgPSBtYXAuZnVsbE5hbWUsCiAgICAgICAgICAgICAgICBwcmVmaXggPSBtYXAucHJlZml4LAogICAgICAgICAgICAgICAgcGx1Z2luID0gcHJlZml4ID8gcGx1Z2luc1twcmVmaXhdIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBsdWdpbnNbcHJlZml4XSA9IGRlZmluZWRbcHJlZml4XSkgOiBudWxsLAogICAgICAgICAgICAgICAgbWFuYWdlciwgY3JlYXRlZCwgcGx1Z2luTWFuYWdlciwgcHJlZml4TWFwOwoKICAgICAgICAgICAgaWYgKGZ1bGxOYW1lKSB7CiAgICAgICAgICAgICAgICBtYW5hZ2VyID0gbWFuYWdlckNhbGxiYWNrc1tmdWxsTmFtZV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghbWFuYWdlcikgewogICAgICAgICAgICAgICAgY3JlYXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBtYW5hZ2VyID0gewogICAgICAgICAgICAgICAgICAgIC8vSUQgaXMganVzdCB0aGUgZnVsbCBuYW1lLCBidXQgaWYgaXQgaXMgYSBwbHVnaW4gcmVzb3VyY2UKICAgICAgICAgICAgICAgICAgICAvL2ZvciBhIHBsdWdpbiB0aGF0IGhhcyBub3QgYmVlbiBsb2FkZWQsCiAgICAgICAgICAgICAgICAgICAgLy90aGVuIGFkZCBhbiBJRCBjb3VudGVyIHRvIGl0LgogICAgICAgICAgICAgICAgICAgIGlkOiAocHJlZml4ICYmICFwbHVnaW4gPwogICAgICAgICAgICAgICAgICAgICAgICAobWFuYWdlckNvdW50ZXIrKykgKyAnX19wQDonIDogJycpICsKICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bGxOYW1lIHx8ICdfX3JAJyArIChtYW5hZ2VyQ291bnRlcisrKSksCiAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsCiAgICAgICAgICAgICAgICAgICAgZGVwQ291bnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgZGVwRG9uZTogW10sCiAgICAgICAgICAgICAgICAgICAgZGVwQ2FsbGJhY2tzOiBbXSwKICAgICAgICAgICAgICAgICAgICBkZXBzOiBbXSwKICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnM6IFtdLAogICAgICAgICAgICAgICAgICAgIGFkZDogbWFuYWdlckFkZAogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBzcGVjaWZpZWRbbWFuYWdlci5pZF0gPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8vT25seSB0cmFjayB0aGUgbWFuYWdlci9yZXVzZSBpdCBpZiB0aGlzIGlzIGEgbm9uLXBsdWdpbgogICAgICAgICAgICAgICAgLy9yZXNvdXJjZS4gQWxzbyBvbmx5IHRyYWNrIHBsdWdpbiByZXNvdXJjZXMgb25jZQogICAgICAgICAgICAgICAgLy90aGUgcGx1Z2luIGhhcyBiZWVuIGxvYWRlZCwgYW5kIHNvIHRoZSBmdWxsTmFtZSBpcyB0aGUKICAgICAgICAgICAgICAgIC8vdHJ1ZSBub3JtYWxpemVkIHZhbHVlLgogICAgICAgICAgICAgICAgaWYgKGZ1bGxOYW1lICYmICghcHJlZml4IHx8IHBsdWdpbnNbcHJlZml4XSkpIHsKICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyQ2FsbGJhY2tzW2Z1bGxOYW1lXSA9IG1hbmFnZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vSWYgdGhlcmUgaXMgYSBwbHVnaW4gbmVlZGVkLCBidXQgaXQgaXMgbm90IGxvYWRlZCwKICAgICAgICAgICAgLy9maXJzdCBsb2FkIHRoZSBwbHVnaW4sIHRoZW4gY29udGludWUgb24uCiAgICAgICAgICAgIGlmIChwcmVmaXggJiYgIXBsdWdpbikgewogICAgICAgICAgICAgICAgcHJlZml4TWFwID0gbWFrZU1vZHVsZU1hcChwcmVmaXgpOwoKICAgICAgICAgICAgICAgIC8vQ2xlYXIgb3V0IGRlZmluZWQgYW5kIHVybEZldGNoZWQgaWYgdGhlIHBsdWdpbiB3YXMgcHJldmlvdXNseQogICAgICAgICAgICAgICAgLy9sb2FkZWQvZGVmaW5lZCwgYnV0IG5vdCBhcyBmdWxsIG1vZHVsZSAoYXMgaW4gYSBidWlsZAogICAgICAgICAgICAgICAgLy9zaXR1YXRpb24pLiBIb3dldmVyLCBvbmx5IGRvIHRoaXMgd29yayBpZiB0aGUgcGx1Z2luIGlzIGluCiAgICAgICAgICAgICAgICAvL2RlZmluZWQgYnV0IGRvZXMgbm90IGhhdmUgYSBtb2R1bGUgZXhwb3J0IHZhbHVlLgogICAgICAgICAgICAgICAgaWYgKHByZWZpeCBpbiBkZWZpbmVkICYmICFkZWZpbmVkW3ByZWZpeF0pIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgZGVmaW5lZFtwcmVmaXhdOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB1cmxGZXRjaGVkW3ByZWZpeE1hcC51cmxdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHBsdWdpbk1hbmFnZXIgPSBnZXRNYW5hZ2VyKHByZWZpeE1hcCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBwbHVnaW5NYW5hZ2VyLmFkZChmdW5jdGlvbiAocGx1Z2luKSB7CiAgICAgICAgICAgICAgICAgICAgLy9DcmVhdGUgYSBuZXcgbWFuYWdlciBmb3IgdGhlIG5vcm1hbGl6ZWQKICAgICAgICAgICAgICAgICAgICAvL3Jlc291cmNlIElEIGFuZCBoYXZlIGl0IGNhbGwgdGhpcyBtYW5hZ2VyIHdoZW4KICAgICAgICAgICAgICAgICAgICAvL2RvbmUuCiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld01hcCA9IG1ha2VNb2R1bGVNYXAobWFwLm9yaWdpbmFsTmFtZSwgbWFwLnBhcmVudE1hcCksCiAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRNYW5hZ2VyID0gZ2V0TWFuYWdlcihuZXdNYXAsIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAvL0luZGljYXRlIHRoaXMgbWFuYWdlciBpcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUgcmVhbCwKICAgICAgICAgICAgICAgICAgICAvL25vcm1hbGl6ZWQgdGhpbmcuIEltcG9ydGFudCBmb3Igd2hlbiB0cnlpbmcgdG8gbWFwCiAgICAgICAgICAgICAgICAgICAgLy9tb2R1bGVzIGFuZCBkZXBlbmRlbmNpZXMsIGZvciBpbnN0YW5jZSwgaW4gYSBidWlsZC4KICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLnBsYWNlaG9sZGVyID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZE1hbmFnZXIuYWRkKGZ1bmN0aW9uIChyZXNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlOwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBleGVjTWFuYWdlcihtYW5hZ2VyKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNyZWF0ZWQgJiYgc2hvdWxkUXVldWUpIHsKICAgICAgICAgICAgICAgIC8vSW5kaWNhdGUgdGhlIHJlc291cmNlIGlzIG5vdCBsb2FkZWQgeWV0IGlmIGl0IGlzIHRvIGJlCiAgICAgICAgICAgICAgICAvL3F1ZXVlZC4KICAgICAgICAgICAgICAgIGxvYWRlZFttYW5hZ2VyLmlkXSA9IGZhbHNlOwogICAgICAgICAgICAgICAgcXVldWVEZXBlbmRlbmN5KG1hbmFnZXIpOwogICAgICAgICAgICAgICAgYWRkV2FpdChtYW5hZ2VyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXI7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtYWluKGluTmFtZSwgZGVwQXJyYXksIGNhbGxiYWNrLCByZWxNb2R1bGVNYXApIHsKICAgICAgICAgICAgdmFyIG1vZHVsZU1hcCA9IG1ha2VNb2R1bGVNYXAoaW5OYW1lLCByZWxNb2R1bGVNYXApLAogICAgICAgICAgICAgICAgbmFtZSA9IG1vZHVsZU1hcC5uYW1lLAogICAgICAgICAgICAgICAgZnVsbE5hbWUgPSBtb2R1bGVNYXAuZnVsbE5hbWUsCiAgICAgICAgICAgICAgICBtYW5hZ2VyID0gZ2V0TWFuYWdlcihtb2R1bGVNYXApLAogICAgICAgICAgICAgICAgaWQgPSBtYW5hZ2VyLmlkLAogICAgICAgICAgICAgICAgZGVwcyA9IG1hbmFnZXIuZGVwcywKICAgICAgICAgICAgICAgIGksIGRlcEFyZywgZGVwTmFtZSwgZGVwUHJlZml4LCBjanNNb2Q7CgogICAgICAgICAgICBpZiAoZnVsbE5hbWUpIHsKICAgICAgICAgICAgICAgIC8vSWYgbW9kdWxlIGFscmVhZHkgZGVmaW5lZCBmb3IgY29udGV4dCwgb3IgYWxyZWFkeSBsb2FkZWQsCiAgICAgICAgICAgICAgICAvL3RoZW4gbGVhdmUuIEFsc28gbGVhdmUgaWYgalF1ZXJ5IGlzIHJlZ2lzdGVyaW5nIGJ1dCBpdCBkb2VzCiAgICAgICAgICAgICAgICAvL25vdCBtYXRjaCB0aGUgZGVzaXJlZCB2ZXJzaW9uIG51bWJlciBpbiB0aGUgY29uZmlnLgogICAgICAgICAgICAgICAgaWYgKGZ1bGxOYW1lIGluIGRlZmluZWQgfHwgbG9hZGVkW2lkXSA9PT0gdHJ1ZSB8fAogICAgICAgICAgICAgICAgICAgIChmdWxsTmFtZSA9PT0gImpxdWVyeSIgJiYgY29uZmlnLmpRdWVyeSAmJgogICAgICAgICAgICAgICAgICAgICBjb25maWcualF1ZXJ5ICE9PSBjYWxsYmFjaygpLmZuLmpxdWVyeSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9TZXQgc3BlY2lmaWVkL2xvYWRlZCBoZXJlIGZvciBtb2R1bGVzIHRoYXQgYXJlIGFsc28gbG9hZGVkCiAgICAgICAgICAgICAgICAvL2FzIHBhcnQgb2YgYSBsYXllciwgd2hlcmUgb25TY3JpcHRMb2FkIGlzIG5vdCBmaXJlZAogICAgICAgICAgICAgICAgLy9mb3IgdGhvc2UgY2FzZXMuIERvIHRoaXMgYWZ0ZXIgdGhlIGlubGluZSBkZWZpbmUgYW5kCiAgICAgICAgICAgICAgICAvL2RlcGVuZGVuY3kgdHJhY2luZyBpcyBkb25lLgogICAgICAgICAgICAgICAgc3BlY2lmaWVkW2lkXSA9IHRydWU7CiAgICAgICAgICAgICAgICBsb2FkZWRbaWRdID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAvL0lmIG1vZHVsZSBpcyBqUXVlcnkgc2V0IHVwIGRlbGF5aW5nIGl0cyBkb20gcmVhZHkgbGlzdGVuZXJzLgogICAgICAgICAgICAgICAgaWYgKGZ1bGxOYW1lID09PSAianF1ZXJ5IiAmJiBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGpRdWVyeUNoZWNrKGNhbGxiYWNrKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0F0dGFjaCByZWFsIGRlcEFycmF5IGFuZCBjYWxsYmFjayB0byB0aGUgbWFuYWdlci4gRG8gdGhpcwogICAgICAgICAgICAvL29ubHkgaWYgdGhlIG1vZHVsZSBoYXMgbm90IGJlZW4gZGVmaW5lZCBhbHJlYWR5LCBzbyBkbyB0aGlzIGFmdGVyCiAgICAgICAgICAgIC8vdGhlIGZ1bGxOYW1lIGNoZWNrcyBhYm92ZS4gSUUgY2FuIGNhbGwgbWFpbigpIG1vcmUgdGhhbiBvbmNlCiAgICAgICAgICAgIC8vZm9yIGEgbW9kdWxlLgogICAgICAgICAgICBtYW5hZ2VyLmRlcEFycmF5ID0gZGVwQXJyYXk7CiAgICAgICAgICAgIG1hbmFnZXIuY2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAgICAgICAgIC8vQWRkIHRoZSBkZXBlbmRlbmNpZXMgdG8gdGhlIGRlcHMgZmllbGQsIGFuZCByZWdpc3RlciBmb3IgY2FsbGJhY2tzCiAgICAgICAgICAgIC8vb24gdGhlIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRlcEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBkZXBBcmcgPSBkZXBBcnJheVtpXTsKICAgICAgICAgICAgICAgIC8vVGhlcmUgY291bGQgYmUgY2FzZXMgbGlrZSBpbiBJRSwgd2hlcmUgYSB0cmFpbGluZyBjb21tYSB3aWxsCiAgICAgICAgICAgICAgICAvL2ludHJvZHVjZSBhIG51bGwgZGVwZW5kZW5jeSwgc28gb25seSB0cmVhdCBhIHJlYWwgZGVwZW5kZW5jeQogICAgICAgICAgICAgICAgLy92YWx1ZSBhcyBhIGRlcGVuZGVuY3kuCiAgICAgICAgICAgICAgICBpZiAoZGVwQXJnKSB7CiAgICAgICAgICAgICAgICAgICAgLy9TcGxpdCB0aGUgZGVwZW5kZW5jeSBuYW1lIGludG8gcGx1Z2luIGFuZCBuYW1lIHBhcnRzCiAgICAgICAgICAgICAgICAgICAgZGVwQXJnID0gbWFrZU1vZHVsZU1hcChkZXBBcmcsIChuYW1lID8gbW9kdWxlTWFwIDogcmVsTW9kdWxlTWFwKSk7CiAgICAgICAgICAgICAgICAgICAgZGVwTmFtZSA9IGRlcEFyZy5mdWxsTmFtZTsKICAgICAgICAgICAgICAgICAgICBkZXBQcmVmaXggPSBkZXBBcmcucHJlZml4OwoKICAgICAgICAgICAgICAgICAgICAvL0ZpeCB0aGUgbmFtZSBpbiBkZXBBcnJheSB0byBiZSBqdXN0IHRoZSBuYW1lLCBzaW5jZQogICAgICAgICAgICAgICAgICAgIC8vdGhhdCBpcyBob3cgaXQgd2lsbCBiZSBjYWxsZWQgYmFjayBsYXRlci4KICAgICAgICAgICAgICAgICAgICBkZXBBcnJheVtpXSA9IGRlcE5hbWU7CgogICAgICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgICAgICBpZiAoZGVwTmFtZSA9PT0gInJlcXVpcmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHNbaV0gPSBtYWtlUmVxdWlyZShtb2R1bGVNYXApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHNbaV0gPSBkZWZpbmVkW2Z1bGxOYW1lXSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLnVzaW5nRXhwb3J0cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgICAgICAgICAvL0NvbW1vbkpTIG1vZHVsZSBzcGVjIDEuMQogICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLmNqc01vZHVsZSA9IGNqc01vZCA9IGRlcHNbaV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVyaTogbmFtZSA/IGNvbnRleHQubmFtZVRvVXJsKG5hbWUsIG51bGwsIHJlbE1vZHVsZU1hcCkgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzOiBkZWZpbmVkW2Z1bGxOYW1lXQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSBpbiBkZWZpbmVkICYmICEoZGVwTmFtZSBpbiB3YWl0aW5nKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCEoZnVsbE5hbWUgaW4gbmVlZEZ1bGxFeGVjKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdWxsTmFtZSBpbiBuZWVkRnVsbEV4ZWMgJiYgZnVsbEV4ZWNbZGVwTmFtZV0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvL01vZHVsZSBhbHJlYWR5IGRlZmluZWQsIGFuZCBub3QgaW4gYSBidWlsZCBzaXR1YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgLy93aGVyZSB0aGUgbW9kdWxlIGlzIGEgc29tZXRoaW5nIHRoYXQgbmVlZHMgZnVsbAogICAgICAgICAgICAgICAgICAgICAgICAvL2V4ZWN1dGlvbiBhbmQgdGhpcyBkZXBlbmRlbmN5IGhhcyBub3QgYmVlbiBmdWxseQogICAgICAgICAgICAgICAgICAgICAgICAvL2V4ZWN1dGVkLiBTZWUgci5qcydzIHJlcXVpcmVQYXRjaC5qcyBmb3IgbW9yZSBpbmZvCiAgICAgICAgICAgICAgICAgICAgICAgIC8vb24gZnVsbEV4ZWMuCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHNbaV0gPSBkZWZpbmVkW2RlcE5hbWVdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vTWFyayB0aGlzIGRlcGVuZGVuY3kgYXMgbmVlZGluZyBmdWxsIGV4ZWMgaWYKICAgICAgICAgICAgICAgICAgICAgICAgLy90aGUgY3VycmVudCBtb2R1bGUgbmVlZHMgZnVsbCBleGVjLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVsbE5hbWUgaW4gbmVlZEZ1bGxFeGVjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkRnVsbEV4ZWNbZGVwTmFtZV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9SZXNldCBzdGF0ZSBzbyBmdWxseSBleGVjdXRlZCBjb2RlIHdpbGwgZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BpY2tlZCB1cCBjb3JyZWN0bHkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZGVmaW5lZFtkZXBOYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybEZldGNoZWRbZGVwQXJnLnVybF0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9FaXRoZXIgYSByZXNvdXJjZSB0aGF0IGlzIG5vdCBsb2FkZWQgeWV0LCBvciBhIHBsdWdpbgogICAgICAgICAgICAgICAgICAgICAgICAvL3Jlc291cmNlIGZvciBlaXRoZXIgYSBwbHVnaW4gdGhhdCBoYXMgbm90CiAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9hZGVkIHlldC4KICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdlci5kZXBDb3VudCArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLmRlcENhbGxiYWNrc1tpXSA9IG1ha2VBcmdDYWxsYmFjayhtYW5hZ2VyLCBpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWFuYWdlcihkZXBBcmcsIHRydWUpLmFkZChtYW5hZ2VyLmRlcENhbGxiYWNrc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0RvIG5vdCBib3RoZXIgdHJhY2tpbmcgdGhlIG1hbmFnZXIgaWYgaXQgaXMgYWxsIGRvbmUuCiAgICAgICAgICAgIGlmICghbWFuYWdlci5kZXBDb3VudCkgewogICAgICAgICAgICAgICAgLy9BbGwgZG9uZSwgZXhlY3V0ZSEKICAgICAgICAgICAgICAgIGV4ZWNNYW5hZ2VyKG1hbmFnZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkV2FpdChtYW5hZ2VyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIGNhbGwgbWFpbiBmb3IgYSBkZWZpbmUgY2FsbCB0aGF0IHdhcyBwdXQgb24KICAgICAgICAgKiBob2xkIGluIHRoZSBkZWZRdWV1ZS4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjYWxsRGVmTWFpbihhcmdzKSB7CiAgICAgICAgICAgIG1haW4uYXBwbHkobnVsbCwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBqUXVlcnkgMS40LjMrIHN1cHBvcnRzIHdheXMgdG8gaG9sZCBvZmYgY2FsbGluZwogICAgICAgICAqIGNhbGxpbmcgalF1ZXJ5IHJlYWR5IGNhbGxiYWNrcyB1bnRpbCBhbGwgc2NyaXB0cyBhcmUgbG9hZGVkLiBCZSBzdXJlCiAgICAgICAgICogdG8gdHJhY2sgaXQgaWYgdGhlIGNhcGFiaWxpdHkgZXhpc3RzLi4gQWxzbywgc2luY2UgalF1ZXJ5IDEuNC4zIGRvZXMKICAgICAgICAgKiBub3QgcmVnaXN0ZXIgYXMgYSBtb2R1bGUsIG5lZWQgdG8gZG8gc29tZSBnbG9iYWwgaW5mZXJlbmNlIGNoZWNraW5nLgogICAgICAgICAqIEV2ZW4gaWYgaXQgZG9lcyByZWdpc3RlciBhcyBhIG1vZHVsZSwgbm90IGd1YXJhbnRlZWQgdG8gYmUgdGhlIHByZWNpc2UKICAgICAgICAgKiBuYW1lIG9mIHRoZSBnbG9iYWwuIElmIGEgalF1ZXJ5IGlzIHRyYWNrZWQgZm9yIHRoaXMgY29udGV4dCwgdGhlbiBnbwogICAgICAgICAqIGFoZWFkIGFuZCByZWdpc3RlciBpdCBhcyBhIG1vZHVsZSB0b28sIGlmIG5vdCBhbHJlYWR5IGluIHByb2Nlc3MuCiAgICAgICAgICovCiAgICAgICAgalF1ZXJ5Q2hlY2sgPSBmdW5jdGlvbiAoanFDYW5kaWRhdGUpIHsKICAgICAgICAgICAgaWYgKCFjb250ZXh0LmpRdWVyeSkgewogICAgICAgICAgICAgICAgdmFyICQgPSBqcUNhbmRpZGF0ZSB8fCAodHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIgPyBqUXVlcnkgOiBudWxsKTsKCiAgICAgICAgICAgICAgICBpZiAoJCkgewogICAgICAgICAgICAgICAgICAgIC8vSWYgYSBzcGVjaWZpYyB2ZXJzaW9uIG9mIGpRdWVyeSBpcyB3YW50ZWQsIG1ha2Ugc3VyZSB0byBvbmx5CiAgICAgICAgICAgICAgICAgICAgLy91c2UgdGhpcyBqUXVlcnkgaWYgaXQgbWF0Y2hlcy4KICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmpRdWVyeSAmJiAkLmZuLmpxdWVyeSAhPT0gY29uZmlnLmpRdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoImhvbGRSZWFkeSIgaW4gJCB8fCAicmVhZHlXYWl0IiBpbiAkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQualF1ZXJ5ID0gJDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vTWFudWFsbHkgY3JlYXRlIGEgImpxdWVyeSIgbW9kdWxlIGVudHJ5IGlmIG5vdCBvbmUgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAvL29yIGluIHByb2Nlc3MuIE5vdGUgdGhpcyBjb3VsZCB0cmlnZ2VyIGFuIGF0dGVtcHQgYXQKICAgICAgICAgICAgICAgICAgICAgICAgLy9hIHNlY29uZCBqUXVlcnkgcmVnaXN0cmF0aW9uLCBidXQgZG9lcyBubyBoYXJtIHNpbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhlIGZpcnN0IG9uZSB3aW5zLCBhbmQgaXQgaXMgdGhlIHNhbWUgdmFsdWUgYW55d2F5LgogICAgICAgICAgICAgICAgICAgICAgICBjYWxsRGVmTWFpbihbImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5OwogICAgICAgICAgICAgICAgICAgICAgICB9XSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvL0FzayBqUXVlcnkgdG8gaG9sZCBET00gcmVhZHkgY2FsbGJhY2tzLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5zY3JpcHRDb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5SG9sZFJlYWR5KCQsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5qUXVlcnlJbmNyZW1lbnRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBmaW5kQ3ljbGUobWFuYWdlciwgdHJhY2VkKSB7CiAgICAgICAgICAgIHZhciBmdWxsTmFtZSA9IG1hbmFnZXIubWFwLmZ1bGxOYW1lLAogICAgICAgICAgICAgICAgZGVwQXJyYXkgPSBtYW5hZ2VyLmRlcEFycmF5LAogICAgICAgICAgICAgICAgZnVsbHlMb2FkZWQgPSB0cnVlLAogICAgICAgICAgICAgICAgaSwgZGVwTmFtZSwgZGVwTWFuYWdlciwgcmVzdWx0OwoKICAgICAgICAgICAgaWYgKG1hbmFnZXIuaXNEb25lIHx8ICFmdWxsTmFtZSB8fCAhbG9hZGVkW2Z1bGxOYW1lXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9Gb3VuZCB0aGUgY3ljbGUuCiAgICAgICAgICAgIGlmICh0cmFjZWRbZnVsbE5hbWVdKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFuYWdlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhY2VkW2Z1bGxOYW1lXSA9IHRydWU7CgogICAgICAgICAgICAvL1RyYWNlIHRocm91Z2ggdGhlIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgaWYgKGRlcEFycmF5KSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAvL1NvbWUgYXJyYXkgbWVtYmVycyBtYXkgYmUgbnVsbCwgbGlrZSBpZiBhIHRyYWlsaW5nIGNvbW1hCiAgICAgICAgICAgICAgICAgICAgLy9JRSwgc28gZG8gdGhlIGV4cGxpY2l0IFtpXSBhY2Nlc3MgYW5kIGNoZWNrIGlmIGl0IGhhcyBhIHZhbHVlLgogICAgICAgICAgICAgICAgICAgIGRlcE5hbWUgPSBkZXBBcnJheVtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxvYWRlZFtkZXBOYW1lXSAmJiAhcmVzZXJ2ZWREZXBlbmRlbmNpZXNbZGVwTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVsbHlMb2FkZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlcE1hbmFnZXIgPSB3YWl0aW5nW2RlcE5hbWVdOwogICAgICAgICAgICAgICAgICAgIGlmIChkZXBNYW5hZ2VyICYmICFkZXBNYW5hZ2VyLmlzRG9uZSAmJiBsb2FkZWRbZGVwTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmluZEN5Y2xlKGRlcE1hbmFnZXIsIHRyYWNlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFmdWxseUxvYWRlZCkgewogICAgICAgICAgICAgICAgICAgIC8vRGlzY2FyZCB0aGUgY3ljbGUgdGhhdCB3YXMgZm91bmQsIHNpbmNlIGl0IGNhbm5vdAogICAgICAgICAgICAgICAgICAgIC8vYmUgZm9yY2VkIHlldC4gQWxzbyBjbGVhciB0aGlzIG1vZHVsZSBmcm9tIHRyYWNlZC4KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRyYWNlZFtmdWxsTmFtZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmb3JjZUV4ZWMobWFuYWdlciwgdHJhY2VkKSB7CiAgICAgICAgICAgIHZhciBmdWxsTmFtZSA9IG1hbmFnZXIubWFwLmZ1bGxOYW1lLAogICAgICAgICAgICAgICAgZGVwQXJyYXkgPSBtYW5hZ2VyLmRlcEFycmF5LAogICAgICAgICAgICAgICAgaSwgZGVwTmFtZSwgZGVwTWFuYWdlciwgcHJlZml4LCBwcmVmaXhNYW5hZ2VyLCB2YWx1ZTsKCgogICAgICAgICAgICBpZiAobWFuYWdlci5pc0RvbmUgfHwgIWZ1bGxOYW1lIHx8ICFsb2FkZWRbZnVsbE5hbWVdKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZnVsbE5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh0cmFjZWRbZnVsbE5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmluZWRbZnVsbE5hbWVdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyYWNlZFtmdWxsTmFtZV0gPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1RyYWNlIHRocm91Z2ggdGhlIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgaWYgKGRlcEFycmF5KSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAvL1NvbWUgYXJyYXkgbWVtYmVycyBtYXkgYmUgbnVsbCwgbGlrZSBpZiBhIHRyYWlsaW5nIGNvbW1hCiAgICAgICAgICAgICAgICAgICAgLy9JRSwgc28gZG8gdGhlIGV4cGxpY2l0IFtpXSBhY2Nlc3MgYW5kIGNoZWNrIGlmIGl0IGhhcyBhIHZhbHVlLgogICAgICAgICAgICAgICAgICAgIGRlcE5hbWUgPSBkZXBBcnJheVtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVwTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvL0ZpcnN0LCBtYWtlIHN1cmUgaWYgaXQgaXMgYSBwbHVnaW4gcmVzb3VyY2UgdGhhdCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy9wbHVnaW4gaXMgbm90IGJsb2NrZWQuCiAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeCA9IG1ha2VNb2R1bGVNYXAoZGVwTmFtZSkucHJlZml4OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJlZml4ICYmIChwcmVmaXhNYW5hZ2VyID0gd2FpdGluZ1twcmVmaXhdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VFeGVjKHByZWZpeE1hbmFnZXIsIHRyYWNlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGVwTWFuYWdlciA9IHdhaXRpbmdbZGVwTmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXBNYW5hZ2VyICYmICFkZXBNYW5hZ2VyLmlzRG9uZSAmJiBsb2FkZWRbZGVwTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9yY2VFeGVjKGRlcE1hbmFnZXIsIHRyYWNlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyLmRlcENhbGxiYWNrc1tpXSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkZWZpbmVkW2Z1bGxOYW1lXTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiBhbGwgbW9kdWxlcyBmb3IgYSBjb250ZXh0IGFyZSBsb2FkZWQsIGFuZCBpZiBzbywgZXZhbHVhdGVzIHRoZQogICAgICAgICAqIG5ldyBvbmVzIGluIHJpZ2h0IGRlcGVuZGVuY3kgb3JkZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNoZWNrTG9hZGVkKCkgewogICAgICAgICAgICB2YXIgd2FpdEludGVydmFsID0gY29uZmlnLndhaXRTZWNvbmRzICogMTAwMCwKICAgICAgICAgICAgICAgIC8vSXQgaXMgcG9zc2libGUgdG8gZGlzYWJsZSB0aGUgd2FpdCBpbnRlcnZhbCBieSB1c2luZyB3YWl0U2Vjb25kcyBvZiAwLgogICAgICAgICAgICAgICAgZXhwaXJlZCA9IHdhaXRJbnRlcnZhbCAmJiAoY29udGV4dC5zdGFydFRpbWUgKyB3YWl0SW50ZXJ2YWwpIDwgbmV3IERhdGUoKS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgICBub0xvYWRzID0gIiIsIGhhc0xvYWRlZFByb3AgPSBmYWxzZSwgc3RpbGxMb2FkaW5nID0gZmFsc2UsCiAgICAgICAgICAgICAgICBjeWNsZURlcHMgPSBbXSwKICAgICAgICAgICAgICAgIGksIHByb3AsIGVyciwgbWFuYWdlciwgY3ljbGVNYW5hZ2VyLCBtb2R1bGVEZXBzOwoKICAgICAgICAgICAgLy9JZiB0aGVyZSBhcmUgaXRlbXMgc3RpbGwgaW4gdGhlIHBhdXNlZCBxdWV1ZSBwcm9jZXNzaW5nIHdhaXQuCiAgICAgICAgICAgIC8vVGhpcyBpcyBwYXJ0aWN1bGFybHkgaW1wb3J0YW50IGluIHRoZSBzeW5jIGNhc2Ugd2hlcmUgZWFjaCBwYXVzZWQKICAgICAgICAgICAgLy9pdGVtIGlzIHByb2Nlc3NlZCByaWdodCBhd2F5IGJ1dCB0aGVyZSBtYXkgYmUgbW9yZSB3YWl0aW5nLgogICAgICAgICAgICBpZiAoY29udGV4dC5wYXVzZWRDb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vRGV0ZXJtaW5lIGlmIHByaW9yaXR5IGxvYWRpbmcgaXMgZG9uZS4gSWYgc28gY2xlYXIgdGhlIHByaW9yaXR5LiBJZgogICAgICAgICAgICAvL25vdCwgdGhlbiBkbyBub3QgY2hlY2sKICAgICAgICAgICAgaWYgKGNvbmZpZy5wcmlvcml0eVdhaXQpIHsKICAgICAgICAgICAgICAgIGlmIChpc1ByaW9yaXR5RG9uZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9DYWxsIHJlc3VtZSwgc2luY2UgaXQgY291bGQgaGF2ZQogICAgICAgICAgICAgICAgICAgIC8vc29tZSB3YWl0aW5nIGRlcGVuZGVuY2llcyB0byB0cmFjZS4KICAgICAgICAgICAgICAgICAgICByZXN1bWUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9TZWUgaWYgYW55dGhpbmcgaXMgc3RpbGwgaW4gZmxpZ2h0LgogICAgICAgICAgICBmb3IgKHByb3AgaW4gbG9hZGVkKSB7CiAgICAgICAgICAgICAgICBpZiAoIShwcm9wIGluIGVtcHR5KSkgewogICAgICAgICAgICAgICAgICAgIGhhc0xvYWRlZFByb3AgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZGVkW3Byb3BdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBpcmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0xvYWRzICs9IHByb3AgKyAiICI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGlsbExvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3AuaW5kZXhPZignIScpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vTm8gcmVhc29uIHRvIGtlZXAgbG9va2luZyBmb3IgdW5maW5pc2hlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9hZGluZy4gSWYgdGhlIG9ubHkgc3RpbGxMb2FkaW5nIGlzIGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BsdWdpbiByZXNvdXJjZSB0aG91Z2gsIGtlZXAgZ29pbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9iZWNhdXNlIGl0IG1heSBiZSB0aGF0IGEgcGx1Z2luIHJlc291cmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pcyB3YWl0aW5nIG9uIGEgbm9uLXBsdWdpbiBjeWNsZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjeWNsZURlcHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlRGVwcyA9IG1hbmFnZXJDYWxsYmFja3NbcHJvcF0gJiYgbWFuYWdlckNhbGxiYWNrc1twcm9wXS5tb2R1bGVEZXBzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVEZXBzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN5Y2xlRGVwcy5wdXNoLmFwcGx5KGN5Y2xlRGVwcywgbW9kdWxlRGVwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0NoZWNrIGZvciBleGl0IGNvbmRpdGlvbnMuCiAgICAgICAgICAgIGlmICghaGFzTG9hZGVkUHJvcCAmJiAhY29udGV4dC53YWl0Q291bnQpIHsKICAgICAgICAgICAgICAgIC8vSWYgdGhlIGxvYWRlZCBvYmplY3QgaGFkIG5vIGl0ZW1zLCB0aGVuIHRoZSByZXN0IG9mCiAgICAgICAgICAgICAgICAvL3RoZSB3b3JrIGJlbG93IGRvZXMgbm90IG5lZWQgdG8gYmUgZG9uZS4KICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGV4cGlyZWQgJiYgbm9Mb2FkcykgewogICAgICAgICAgICAgICAgLy9JZiB3YWl0IHRpbWUgZXhwaXJlZCwgdGhyb3cgZXJyb3Igb2YgdW5sb2FkZWQgbW9kdWxlcy4KICAgICAgICAgICAgICAgIGVyciA9IG1ha2VFcnJvcigidGltZW91dCIsICJMb2FkIHRpbWVvdXQgZm9yIG1vZHVsZXM6ICIgKyBub0xvYWRzKTsKICAgICAgICAgICAgICAgIGVyci5yZXF1aXJlVHlwZSA9ICJ0aW1lb3V0IjsKICAgICAgICAgICAgICAgIGVyci5yZXF1aXJlTW9kdWxlcyA9IG5vTG9hZHM7CiAgICAgICAgICAgICAgICBlcnIuY29udGV4dE5hbWUgPSBjb250ZXh0LmNvbnRleHROYW1lOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcS5vbkVycm9yKGVycik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vSWYgc3RpbGwgbG9hZGluZyBidXQgYSBwbHVnaW4gaXMgd2FpdGluZyBvbiBhIHJlZ3VsYXIgbW9kdWxlIGN5Y2xlCiAgICAgICAgICAgIC8vYnJlYWsgdGhlIGN5Y2xlLgogICAgICAgICAgICBpZiAoc3RpbGxMb2FkaW5nICYmIGN5Y2xlRGVwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IChtYW5hZ2VyID0gd2FpdGluZ1tjeWNsZURlcHNbaV1dKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChjeWNsZU1hbmFnZXIgPSBmaW5kQ3ljbGUobWFuYWdlciwge30pKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JjZUV4ZWMoY3ljbGVNYW5hZ2VyLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vSWYgc3RpbGwgd2FpdGluZyBvbiBsb2FkcywgYW5kIHRoZSB3YWl0aW5nIGxvYWQgaXMgc29tZXRoaW5nCiAgICAgICAgICAgIC8vb3RoZXIgdGhhbiBhIHBsdWdpbiByZXNvdXJjZSwgb3IgdGhlcmUgYXJlIHN0aWxsIG91dHN0YW5kaW5nCiAgICAgICAgICAgIC8vc2NyaXB0cywgdGhlbiBqdXN0IHRyeSBiYWNrIGxhdGVyLgogICAgICAgICAgICBpZiAoIWV4cGlyZWQgJiYgKHN0aWxsTG9hZGluZyB8fCBjb250ZXh0LnNjcmlwdENvdW50KSkgewogICAgICAgICAgICAgICAgLy9Tb21ldGhpbmcgaXMgc3RpbGwgd2FpdGluZyB0byBsb2FkLiBXYWl0IGZvciBpdCwgYnV0IG9ubHkKICAgICAgICAgICAgICAgIC8vaWYgYSB0aW1lb3V0IGlzIG5vdCBhbHJlYWR5IGluIGVmZmVjdC4KICAgICAgICAgICAgICAgIGlmICgoaXNCcm93c2VyIHx8IGlzV2ViV29ya2VyKSAmJiAhY2hlY2tMb2FkZWRUaW1lb3V0SWQpIHsKICAgICAgICAgICAgICAgICAgICBjaGVja0xvYWRlZFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjaGVja0xvYWRlZFRpbWVvdXRJZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrTG9hZGVkKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9JZiBzdGlsbCBoYXZlIGl0ZW1zIGluIHRoZSB3YWl0aW5nIGN1ZSwgYnV0IGFsbCBtb2R1bGVzIGhhdmUKICAgICAgICAgICAgLy9iZWVuIGxvYWRlZCwgdGhlbiBpdCBtZWFucyB0aGVyZSBhcmUgc29tZSBjaXJjdWxhciBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgLy90aGF0IG5lZWQgdG8gYmUgYnJva2VuLgogICAgICAgICAgICAvL0hvd2V2ZXIsIGFzIGEgd2FpdGluZyB0aGluZyBpcyBmaXJlZCwgdGhlbiBpdCBjYW4gYWRkIGl0ZW1zIHRvCiAgICAgICAgICAgIC8vdGhlIHdhaXRpbmcgY3VlLCBhbmQgdGhvc2UgaXRlbXMgc2hvdWxkIG5vdCBiZSBmaXJlZCB5ZXQsIHNvCiAgICAgICAgICAgIC8vbWFrZSBzdXJlIHRvIHJlZG8gdGhlIGNoZWNrTG9hZGVkIGNhbGwgYWZ0ZXIgYnJlYWtpbmcgYSBzaW5nbGUKICAgICAgICAgICAgLy9jeWNsZSwgaWYgbm90aGluZyBlbHNlIGxvYWRlZCB0aGVuIHRoaXMgbG9naWMgd2lsbCBwaWNrIGl0IHVwCiAgICAgICAgICAgIC8vYWdhaW4uCiAgICAgICAgICAgIGlmIChjb250ZXh0LndhaXRDb3VudCkgewogICAgICAgICAgICAgICAgLy9DeWNsZSB0aHJvdWdoIHRoZSB3YWl0QXJ5LCBhbmQgY2FsbCBpdGVtcyBpbiBzZXF1ZW5jZS4KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IChtYW5hZ2VyID0gd2FpdEFyeVtpXSk7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZvcmNlRXhlYyhtYW5hZ2VyLCB7fSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9JZiBhbnl0aGluZyBnb3QgcGxhY2VkIGluIHRoZSBwYXVzZWQgcXVldWUsIHJ1biBpdCBkb3duLgogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQucGF1c2VkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJlc3VtZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vT25seSBhbGxvdyB0aGlzIHJlY3Vyc2lvbiB0byBhIGNlcnRhaW4gZGVwdGguIE9ubHkKICAgICAgICAgICAgICAgIC8vdHJpZ2dlcmVkIGJ5IGVycm9ycyBpbiBjYWxsaW5nIGEgbW9kdWxlIGluIHdoaWNoIGl0cwogICAgICAgICAgICAgICAgLy9tb2R1bGVzIHdhaXRpbmcgb24gaXQgY2Fubm90IGZpbmlzaCBsb2FkaW5nLCBvciBzb21lIGNpcmN1bGFyCiAgICAgICAgICAgICAgICAvL2RlcGVuZGVuY2llcyB0aGF0IHRoZW4gbWF5IGFkZCBtb3JlIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgIC8vVGhlIHZhbHVlIG9mIDUgaXMgYSBiaXQgYXJiaXRyYXJ5LiBIb3BlZnVsbHkganVzdCBvbmUgZXh0cmEKICAgICAgICAgICAgICAgIC8vcGFzcywgb3IgdHdvIGZvciB0aGUgY2FzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgZ2VuZXJhdGluZwogICAgICAgICAgICAgICAgLy9tb3JlIHdvcmsgdGhhdCBnZXRzIHJlc29sdmVkIGluIHRoZSBzeW5jIG5vZGUgY2FzZS4KICAgICAgICAgICAgICAgIGlmIChjaGVja0xvYWRlZERlcHRoIDwgNSkgewogICAgICAgICAgICAgICAgICAgIGNoZWNrTG9hZGVkRGVwdGggKz0gMTsKICAgICAgICAgICAgICAgICAgICBjaGVja0xvYWRlZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjaGVja0xvYWRlZERlcHRoID0gMDsKCiAgICAgICAgICAgIC8vQ2hlY2sgZm9yIERPTSByZWFkeSwgYW5kIG5vdGhpbmcgaXMgd2FpdGluZyBhY3Jvc3MgY29udGV4dHMuCiAgICAgICAgICAgIHJlcS5jaGVja1JlYWR5U3RhdGUoKTsKCiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXN1bWVzIHRyYWNpbmcgb2YgZGVwZW5kZW5jaWVzIGFuZCB0aGVuIGNoZWNrcyBpZiBldmVyeXRoaW5nIGlzIGxvYWRlZC4KICAgICAgICAgKi8KICAgICAgICByZXN1bWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBtYW5hZ2VyLCBtYXAsIHVybCwgaSwgcCwgYXJncywgZnVsbE5hbWU7CgogICAgICAgICAgICAvL0FueSBkZWZpbmVkIG1vZHVsZXMgaW4gdGhlIGdsb2JhbCBxdWV1ZSwgaW50YWtlIHRoZW0gbm93LgogICAgICAgICAgICBjb250ZXh0LnRha2VHbG9iYWxRdWV1ZSgpOwoKICAgICAgICAgICAgcmVzdW1lRGVwdGggKz0gMTsKCiAgICAgICAgICAgIGlmIChjb250ZXh0LnNjcmlwdENvdW50IDw9IDApIHsKICAgICAgICAgICAgICAgIC8vU3luY2hyb25vdXMgZW52cyB3aWxsIHB1c2ggdGhlIG51bWJlciBiZWxvdyB6ZXJvIHdpdGggdGhlCiAgICAgICAgICAgICAgICAvL2RlY3JlbWVudCBhYm92ZSwgYmUgc3VyZSB0byBzZXQgaXQgYmFjayB0byB6ZXJvIGZvciBnb29kIG1lYXN1cmUuCiAgICAgICAgICAgICAgICAvL3JlcXVpcmUoKSBjYWxscyB0aGF0IGFsc28gZG8gbm90IGVuZCB1cCBsb2FkaW5nIHNjcmlwdHMgY291bGQKICAgICAgICAgICAgICAgIC8vcHVzaCB0aGUgbnVtYmVyIG5lZ2F0aXZlIHRvby4KICAgICAgICAgICAgICAgIGNvbnRleHQuc2NyaXB0Q291bnQgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL01ha2Ugc3VyZSBhbnkgcmVtYWluaW5nIGRlZlF1ZXVlIGl0ZW1zIGdldCBwcm9wZXJseSBwcm9jZXNzZWQuCiAgICAgICAgICAgIHdoaWxlIChkZWZRdWV1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBkZWZRdWV1ZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgaWYgKGFyZ3NbMF0gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxLm9uRXJyb3IobWFrZUVycm9yKCdtaXNtYXRjaCcsICdNaXNtYXRjaGVkIGFub255bW91cyBkZWZpbmUoKSBtb2R1bGU6ICcgKyBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbERlZk1haW4oYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vU2tpcCB0aGUgcmVzdW1lIG9mIHBhdXNlZCBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgLy9pZiBjdXJyZW50IGNvbnRleHQgaXMgaW4gcHJpb3JpdHkgd2FpdC4KICAgICAgICAgICAgaWYgKCFjb25maWcucHJpb3JpdHlXYWl0IHx8IGlzUHJpb3JpdHlEb25lKCkpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChjb250ZXh0LnBhdXNlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBwID0gY29udGV4dC5wYXVzZWQ7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5wYXVzZWRDb3VudCArPSBwLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAvL1Jlc2V0IHBhdXNlZCBsaXN0CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5wYXVzZWQgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgKG1hbmFnZXIgPSBwW2ldKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcCA9IG1hbmFnZXIubWFwOwogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBtYXAudXJsOwogICAgICAgICAgICAgICAgICAgICAgICBmdWxsTmFtZSA9IG1hcC5mdWxsTmFtZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlIG1hbmFnZXIgaXMgZm9yIGEgcGx1Z2luIG1hbmFnZWQgcmVzb3VyY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vYXNrIHRoZSBwbHVnaW4gdG8gbG9hZCBpdCBub3cuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXAucHJlZml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsUGx1Z2luKG1hcC5wcmVmaXgsIG1hbmFnZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWd1bGFyIGRlcGVuZGVuY3kuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVybEZldGNoZWRbdXJsXSAmJiAhbG9hZGVkW2Z1bGxOYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5sb2FkKGNvbnRleHQsIGZ1bGxOYW1lLCB1cmwpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01hcmsgdGhlIFVSTCBhcyBmZXRjaGVkLCBidXQgb25seSBpZiBpdCBpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm90IGFuIGVtcHR5OiBVUkwsIHVzZWQgYnkgdGhlIG9wdGltaXplci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0luIHRoYXQgY2FzZSB3ZSBuZWVkIHRvIGJlIHN1cmUgdG8gY2FsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9hZCgpIGZvciBlYWNoIG1vZHVsZSB0aGF0IGlzIG1hcHBlZCB0bwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZW1wdHk6IHNvIHRoYXQgZGVwZW5kZW5jaWVzIGFyZSBzYXRpc2ZpZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvcnJlY3RseS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoJ2VtcHR5OicpICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybEZldGNoZWRbdXJsXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvL01vdmUgdGhlIHN0YXJ0IHRpbWUgZm9yIHRpbWVvdXQgZm9yd2FyZC4KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnN0YXJ0VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5wYXVzZWRDb3VudCAtPSBwLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9Pbmx5IGNoZWNrIGlmIGxvYWRlZCB3aGVuIHJlc3VtZSBkZXB0aCBpcyAxLiBJdCBpcyBsaWtlbHkgdGhhdAogICAgICAgICAgICAvL2l0IGlzIG9ubHkgZ3JlYXRlciB0aGFuIDEgaW4gc3luYyBlbnZpcm9ubWVudHMgd2hlcmUgYSBmYWN0b3J5CiAgICAgICAgICAgIC8vZnVuY3Rpb24gYWxzbyB0aGVuIGNhbGxzIHRoZSBjYWxsYmFjay1zdHlsZSByZXF1aXJlLiBJbiB0aG9zZQogICAgICAgICAgICAvL2Nhc2VzLCB0aGUgY2hlY2tMb2FkZWQgc2hvdWxkIG5vdCBvY2N1ciB1bnRpbCB0aGUgcmVzdW1lCiAgICAgICAgICAgIC8vZGVwdGggaXMgYmFjayBhdCB0aGUgdG9wIGxldmVsLgogICAgICAgICAgICBpZiAocmVzdW1lRGVwdGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGNoZWNrTG9hZGVkKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc3VtZURlcHRoIC09IDE7CgogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH07CgogICAgICAgIC8vRGVmaW5lIHRoZSBjb250ZXh0IG9iamVjdC4gTWFueSBvZiB0aGVzZSBmaWVsZHMgYXJlIG9uIGhlcmUKICAgICAgICAvL2p1c3QgdG8gbWFrZSBkZWJ1Z2dpbmcgZWFzaWVyLgogICAgICAgIGNvbnRleHQgPSB7CiAgICAgICAgICAgIGNvbnRleHROYW1lOiBjb250ZXh0TmFtZSwKICAgICAgICAgICAgY29uZmlnOiBjb25maWcsCiAgICAgICAgICAgIGRlZlF1ZXVlOiBkZWZRdWV1ZSwKICAgICAgICAgICAgd2FpdGluZzogd2FpdGluZywKICAgICAgICAgICAgd2FpdENvdW50OiAwLAogICAgICAgICAgICBzcGVjaWZpZWQ6IHNwZWNpZmllZCwKICAgICAgICAgICAgbG9hZGVkOiBsb2FkZWQsCiAgICAgICAgICAgIHVybE1hcDogdXJsTWFwLAogICAgICAgICAgICB1cmxGZXRjaGVkOiB1cmxGZXRjaGVkLAogICAgICAgICAgICBzY3JpcHRDb3VudDogMCwKICAgICAgICAgICAgZGVmaW5lZDogZGVmaW5lZCwKICAgICAgICAgICAgcGF1c2VkOiBbXSwKICAgICAgICAgICAgcGF1c2VkQ291bnQ6IDAsCiAgICAgICAgICAgIHBsdWdpbnM6IHBsdWdpbnMsCiAgICAgICAgICAgIG5lZWRGdWxsRXhlYzogbmVlZEZ1bGxFeGVjLAogICAgICAgICAgICBmYWtlOiB7fSwKICAgICAgICAgICAgZnVsbEV4ZWM6IGZ1bGxFeGVjLAogICAgICAgICAgICBtYW5hZ2VyQ2FsbGJhY2tzOiBtYW5hZ2VyQ2FsbGJhY2tzLAogICAgICAgICAgICBtYWtlTW9kdWxlTWFwOiBtYWtlTW9kdWxlTWFwLAogICAgICAgICAgICBub3JtYWxpemU6IG5vcm1hbGl6ZSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFNldCBhIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBjb250ZXh0LgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZyBvYmplY3QgdG8gaW50ZWdyYXRlLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgY29uZmlndXJlOiBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aHMsIHByb3AsIHBhY2thZ2VzLCBwa2dzLCBwYWNrYWdlUGF0aHMsIHJlcXVpcmVXYWl0OwoKICAgICAgICAgICAgICAgIC8vTWFrZSBzdXJlIHRoZSBiYXNlVXJsIGVuZHMgaW4gYSBzbGFzaC4KICAgICAgICAgICAgICAgIGlmIChjZmcuYmFzZVVybCkgewogICAgICAgICAgICAgICAgICAgIGlmIChjZmcuYmFzZVVybC5jaGFyQXQoY2ZnLmJhc2VVcmwubGVuZ3RoIC0gMSkgIT09ICIvIikgewogICAgICAgICAgICAgICAgICAgICAgICBjZmcuYmFzZVVybCArPSAiLyI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vU2F2ZSBvZmYgdGhlIHBhdGhzIGFuZCBwYWNrYWdlcyBzaW5jZSB0aGV5IHJlcXVpcmUgc3BlY2lhbCBwcm9jZXNzaW5nLAogICAgICAgICAgICAgICAgLy90aGV5IGFyZSBhZGRpdGl2ZS4KICAgICAgICAgICAgICAgIHBhdGhzID0gY29uZmlnLnBhdGhzOwogICAgICAgICAgICAgICAgcGFja2FnZXMgPSBjb25maWcucGFja2FnZXM7CiAgICAgICAgICAgICAgICBwa2dzID0gY29uZmlnLnBrZ3M7CgogICAgICAgICAgICAgICAgLy9NaXggaW4gdGhlIGNvbmZpZyB2YWx1ZXMsIGZhdm9yaW5nIHRoZSBuZXcgdmFsdWVzIG92ZXIKICAgICAgICAgICAgICAgIC8vZXhpc3Rpbmcgb25lcyBpbiBjb250ZXh0LmNvbmZpZy4KICAgICAgICAgICAgICAgIG1peGluKGNvbmZpZywgY2ZnLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAvL0FkanVzdCBwYXRocyBpZiBuZWNlc3NhcnkuCiAgICAgICAgICAgICAgICBpZiAoY2ZnLnBhdGhzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChwcm9wIGluIGNmZy5wYXRocykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShwcm9wIGluIGVtcHR5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHNbcHJvcF0gPSBjZmcucGF0aHNbcHJvcF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnBhdGhzID0gcGF0aHM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcGFja2FnZVBhdGhzID0gY2ZnLnBhY2thZ2VQYXRoczsKICAgICAgICAgICAgICAgIGlmIChwYWNrYWdlUGF0aHMgfHwgY2ZnLnBhY2thZ2VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db252ZXJ0IHBhY2thZ2VQYXRocyBpbnRvIGEgcGFja2FnZXMgY29uZmlnLgogICAgICAgICAgICAgICAgICAgIGlmIChwYWNrYWdlUGF0aHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChwcm9wIGluIHBhY2thZ2VQYXRocykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocHJvcCBpbiBlbXB0eSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmVQYWNrYWdlRGlyKHBrZ3MsIHBhY2thZ2VQYXRoc1twcm9wXSwgcHJvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vQWRqdXN0IHBhY2thZ2VzIGlmIG5lY2Vzc2FyeS4KICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnLnBhY2thZ2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyZVBhY2thZ2VEaXIocGtncywgY2ZnLnBhY2thZ2VzKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vRG9uZSB3aXRoIG1vZGlmaWNhdGlvbnMsIGFzc2luZyBwYWNrYWdlcyBiYWNrIHRvIGNvbnRleHQgY29uZmlnCiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnBrZ3MgPSBwa2dzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vSWYgcHJpb3JpdHkgbG9hZGluZyBpcyBpbiBlZmZlY3QsIHRyaWdnZXIgdGhlIGxvYWRzIG5vdwogICAgICAgICAgICAgICAgaWYgKGNmZy5wcmlvcml0eSkgewogICAgICAgICAgICAgICAgICAgIC8vSG9sZCBvbiB0byByZXF1aXJlV2FpdCB2YWx1ZSwgYW5kIHJlc2V0IGl0IGFmdGVyIGRvbmUKICAgICAgICAgICAgICAgICAgICByZXF1aXJlV2FpdCA9IGNvbnRleHQucmVxdWlyZVdhaXQ7CgogICAgICAgICAgICAgICAgICAgIC8vQWxsb3cgdHJhY2luZyBzb21lIHJlcXVpcmUgY2FsbHMgdG8gYWxsb3cgdGhlIGZldGNoaW5nCiAgICAgICAgICAgICAgICAgICAgLy9vZiB0aGUgcHJpb3JpdHkgY29uZmlnLgogICAgICAgICAgICAgICAgICAgIGNvbnRleHQucmVxdWlyZVdhaXQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAvL0J1dCBmaXJzdCwgY2FsbCByZXN1bWUgdG8gcmVnaXN0ZXIgYW55IGRlZmluZWQgbW9kdWxlcyB0aGF0IG1heQogICAgICAgICAgICAgICAgICAgIC8vYmUgaW4gYSBkYXRhLW1haW4gYnVpbHQgZmlsZSBiZWZvcmUgdGhlIHByaW9yaXR5IGNvbmZpZwogICAgICAgICAgICAgICAgICAgIC8vY2FsbC4KICAgICAgICAgICAgICAgICAgICByZXN1bWUoKTsKCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5yZXF1aXJlKGNmZy5wcmlvcml0eSk7CgogICAgICAgICAgICAgICAgICAgIC8vVHJpZ2dlciBhIHJlc3VtZSByaWdodCBhd2F5LCBmb3IgdGhlIGNhc2Ugd2hlbgogICAgICAgICAgICAgICAgICAgIC8vdGhlIHNjcmlwdCB3aXRoIHRoZSBwcmlvcml0eSBsb2FkIGlzIGRvbmUgYXMgcGFydAogICAgICAgICAgICAgICAgICAgIC8vb2YgYSBkYXRhLW1haW4gY2FsbC4gSW4gdGhhdCBjYXNlIHRoZSBub3JtYWwgcmVzdW1lCiAgICAgICAgICAgICAgICAgICAgLy9jYWxsIHdpbGwgbm90IGhhcHBlbiBiZWNhdXNlIHRoZSBzY3JpcHRDb3VudCB3aWxsIGJlCiAgICAgICAgICAgICAgICAgICAgLy9hdCAxLCBzaW5jZSB0aGUgc2NyaXB0IGZvciBkYXRhLW1haW4gaXMgYmVpbmcgcHJvY2Vzc2VkLgogICAgICAgICAgICAgICAgICAgIHJlc3VtZSgpOwoKICAgICAgICAgICAgICAgICAgICAvL1Jlc3RvcmUgcHJldmlvdXMgc3RhdGUuCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5yZXF1aXJlV2FpdCA9IHJlcXVpcmVXYWl0OwogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5wcmlvcml0eVdhaXQgPSBjZmcucHJpb3JpdHk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9JZiBhIGRlcHMgYXJyYXkgb3IgYSBjb25maWcgY2FsbGJhY2sgaXMgc3BlY2lmaWVkLCB0aGVuIGNhbGwKICAgICAgICAgICAgICAgIC8vcmVxdWlyZSB3aXRoIHRob3NlIGFyZ3MuIFRoaXMgaXMgdXNlZnVsIHdoZW4gcmVxdWlyZSBpcyBkZWZpbmVkIGFzIGEKICAgICAgICAgICAgICAgIC8vY29uZmlnIG9iamVjdCBiZWZvcmUgcmVxdWlyZS5qcyBpcyBsb2FkZWQuCiAgICAgICAgICAgICAgICBpZiAoY2ZnLmRlcHMgfHwgY2ZnLmNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5yZXF1aXJlKGNmZy5kZXBzIHx8IFtdLCBjZmcuY2FsbGJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVxdWlyZURlZmluZWQ6IGZ1bmN0aW9uIChtb2R1bGVOYW1lLCByZWxNb2R1bGVNYXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYWtlTW9kdWxlTWFwKG1vZHVsZU5hbWUsIHJlbE1vZHVsZU1hcCkuZnVsbE5hbWUgaW4gZGVmaW5lZDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlcXVpcmVTcGVjaWZpZWQ6IGZ1bmN0aW9uIChtb2R1bGVOYW1lLCByZWxNb2R1bGVNYXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYWtlTW9kdWxlTWFwKG1vZHVsZU5hbWUsIHJlbE1vZHVsZU1hcCkuZnVsbE5hbWUgaW4gc3BlY2lmaWVkOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKGRlcHMsIGNhbGxiYWNrLCByZWxNb2R1bGVNYXApIHsKICAgICAgICAgICAgICAgIHZhciBtb2R1bGVOYW1lLCBmdWxsTmFtZSwgbW9kdWxlTWFwOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkZXBzID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKGNhbGxiYWNrKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvL0ludmFsaWQgY2FsbAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxLm9uRXJyb3IobWFrZUVycm9yKCJyZXF1aXJlYXJncyIsICJJbnZhbGlkIHJlcXVpcmUgY2FsbCIpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vU3luY2hyb25vdXMgYWNjZXNzIHRvIG9uZSBtb2R1bGUuIElmIHJlcXVpcmUuZ2V0IGlzCiAgICAgICAgICAgICAgICAgICAgLy9hdmFpbGFibGUgKGFzIGluIHRoZSBOb2RlIGFkYXB0ZXIpLCBwcmVmZXIgdGhhdC4KICAgICAgICAgICAgICAgICAgICAvL0luIHRoaXMgY2FzZSBkZXBzIGlzIHRoZSBtb2R1bGVOYW1lIGFuZCBjYWxsYmFjayBpcwogICAgICAgICAgICAgICAgICAgIC8vdGhlIHJlbE1vZHVsZU1hcAogICAgICAgICAgICAgICAgICAgIGlmIChyZXEuZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXEuZ2V0KGNvbnRleHQsIGRlcHMsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vSnVzdCByZXR1cm4gdGhlIG1vZHVsZSB3YW50ZWQuIEluIHRoaXMgc2NlbmFyaW8sIHRoZQogICAgICAgICAgICAgICAgICAgIC8vc2Vjb25kIGFyZyAoaWYgcGFzc2VkKSBpcyBqdXN0IHRoZSByZWxNb2R1bGVNYXAuCiAgICAgICAgICAgICAgICAgICAgbW9kdWxlTmFtZSA9IGRlcHM7CiAgICAgICAgICAgICAgICAgICAgcmVsTW9kdWxlTWFwID0gY2FsbGJhY2s7CgogICAgICAgICAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgICAgICAgICAgbW9kdWxlTWFwID0gbWFrZU1vZHVsZU1hcChtb2R1bGVOYW1lLCByZWxNb2R1bGVNYXApOwogICAgICAgICAgICAgICAgICAgIGZ1bGxOYW1lID0gbW9kdWxlTWFwLmZ1bGxOYW1lOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIShmdWxsTmFtZSBpbiBkZWZpbmVkKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxLm9uRXJyb3IobWFrZUVycm9yKCJub3Rsb2FkZWQiLCAiTW9kdWxlIG5hbWUgJyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVNYXAuZnVsbE5hbWUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJyBoYXMgbm90IGJlZW4gbG9hZGVkIHlldCBmb3IgY29udGV4dDogIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHROYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZpbmVkW2Z1bGxOYW1lXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0NhbGwgbWFpbiBidXQgb25seSBpZiB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzIG9yCiAgICAgICAgICAgICAgICAvL2EgY2FsbGJhY2sgdG8gY2FsbC4KICAgICAgICAgICAgICAgIGlmIChkZXBzICYmIGRlcHMubGVuZ3RoIHx8IGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgbWFpbihudWxsLCBkZXBzLCBjYWxsYmFjaywgcmVsTW9kdWxlTWFwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0lmIHRoZSByZXF1aXJlIGNhbGwgZG9lcyBub3QgdHJpZ2dlciBhbnl0aGluZyBuZXcgdG8gbG9hZCwKICAgICAgICAgICAgICAgIC8vdGhlbiByZXN1bWUgdGhlIGRlcGVuZGVuY3kgcHJvY2Vzc2luZy4KICAgICAgICAgICAgICAgIGlmICghY29udGV4dC5yZXF1aXJlV2FpdCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICghY29udGV4dC5zY3JpcHRDb3VudCAmJiBjb250ZXh0LnBhdXNlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdW1lKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucmVxdWlyZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gdHJhbnNmZXIgZ2xvYmFsUXVldWUgaXRlbXMgdG8gdGhpcyBjb250ZXh0J3MKICAgICAgICAgICAgICogZGVmUXVldWUuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0YWtlR2xvYmFsUXVldWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vUHVzaCBhbGwgdGhlIGdsb2JhbERlZlF1ZXVlIGl0ZW1zIGludG8gdGhlIGNvbnRleHQncyBkZWZRdWV1ZQogICAgICAgICAgICAgICAgaWYgKGdsb2JhbERlZlF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIC8vQXJyYXkgc3BsaWNlIGluIHRoZSB2YWx1ZXMgc2luY2UgdGhlIGNvbnRleHQgY29kZSBoYXMgYQogICAgICAgICAgICAgICAgICAgIC8vbG9jYWwgdmFyIHJlZiB0byBkZWZRdWV1ZSwgc28gY2Fubm90IGp1c3QgcmVhc3NpZ24gdGhlIG9uZQogICAgICAgICAgICAgICAgICAgIC8vb24gY29udGV4dC4KICAgICAgICAgICAgICAgICAgICBhcHNwLmFwcGx5KGNvbnRleHQuZGVmUXVldWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29udGV4dC5kZWZRdWV1ZS5sZW5ndGggLSAxLCAwXS5jb25jYXQoZ2xvYmFsRGVmUXVldWUpKTsKICAgICAgICAgICAgICAgICAgICBnbG9iYWxEZWZRdWV1ZSA9IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEludGVybmFsIG1ldGhvZCB1c2VkIGJ5IGVudmlyb25tZW50IGFkYXB0ZXJzIHRvIGNvbXBsZXRlIGEgbG9hZCBldmVudC4KICAgICAgICAgICAgICogQSBsb2FkIGV2ZW50IGNvdWxkIGJlIGEgc2NyaXB0IGxvYWQgb3IganVzdCBhIGxvYWQgcGFzcyBmcm9tIGEgc3luY2hyb25vdXMKICAgICAgICAgICAgICogbG9hZCBjYWxsLgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbW9kdWxlTmFtZSB0aGUgbmFtZSBvZiB0aGUgbW9kdWxlIHRvIHBvdGVudGlhbGx5IGNvbXBsZXRlLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgY29tcGxldGVMb2FkOiBmdW5jdGlvbiAobW9kdWxlTmFtZSkgewogICAgICAgICAgICAgICAgdmFyIGFyZ3M7CgogICAgICAgICAgICAgICAgY29udGV4dC50YWtlR2xvYmFsUXVldWUoKTsKCiAgICAgICAgICAgICAgICB3aGlsZSAoZGVmUXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgYXJncyA9IGRlZlF1ZXVlLnNoaWZ0KCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzWzBdID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbMF0gPSBtb2R1bGVOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ3NbMF0gPT09IG1vZHVsZU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9Gb3VuZCBtYXRjaGluZyBkZWZpbmUgY2FsbCBmb3IgdGhpcyBzY3JpcHQhCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vU29tZSBvdGhlciBuYW1lZCBkZWZpbmUgY2FsbCwgbW9zdCBsaWtlbHkgdGhlIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAvL29mIGEgYnVpbGQgbGF5ZXIgdGhhdCBpbmNsdWRlZCBtYW55IGRlZmluZSBjYWxscy4KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbERlZk1haW4oYXJncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhcmdzKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbERlZk1haW4oYXJncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vQSBzY3JpcHQgdGhhdCBkb2VzIG5vdCBjYWxsIGRlZmluZSgpLCBzbyBqdXN0IHNpbXVsYXRlCiAgICAgICAgICAgICAgICAgICAgLy90aGUgY2FsbCBmb3IgaXQuIFNwZWNpYWwgZXhjZXB0aW9uIGZvciBqUXVlcnkgZHluYW1pYyBsb2FkLgogICAgICAgICAgICAgICAgICAgIGNhbGxEZWZNYWluKFttb2R1bGVOYW1lLCBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVOYW1lID09PSAianF1ZXJ5IiAmJiB0eXBlb2YgalF1ZXJ5ICE9PSAidW5kZWZpbmVkIiA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBudWxsXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9Eb2luZyB0aGlzIHNjcmlwdENvdW50IGRlY3JlbWVudCBicmFuY2hpbmcgYmVjYXVzZSBzeW5jIGVudnMKICAgICAgICAgICAgICAgIC8vbmVlZCB0byBkZWNyZW1lbnQgYWZ0ZXIgcmVzdW1lLCBvdGhlcndpc2UgaXQgbG9va3MgbGlrZQogICAgICAgICAgICAgICAgLy9sb2FkaW5nIGlzIGNvbXBsZXRlIGFmdGVyIHRoZSBmaXJzdCBkZXBlbmRlbmN5IGlzIGZldGNoZWQuCiAgICAgICAgICAgICAgICAvL0ZvciBicm93c2VycywgaXQgd29ya3MgZmluZSB0byBkZWNyZW1lbnQgYWZ0ZXIsIGJ1dCBpdCBtZWFucwogICAgICAgICAgICAgICAgLy90aGUgY2hlY2tMb2FkZWQgc2V0VGltZW91dCA1MCBtcyBjb3N0IGlzIHRha2VuLiBUbyBhdm9pZAogICAgICAgICAgICAgICAgLy90aGF0IGNvc3QsIGRlY3JlbWVudCBiZWZvcmVoYW5kLgogICAgICAgICAgICAgICAgaWYgKHJlcS5pc0FzeW5jKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zY3JpcHRDb3VudCAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdW1lKCk7CiAgICAgICAgICAgICAgICBpZiAoIXJlcS5pc0FzeW5jKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zY3JpcHRDb3VudCAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIENvbnZlcnRzIGEgbW9kdWxlIG5hbWUgKyAuZXh0ZW5zaW9uIGludG8gYW4gVVJMIHBhdGguCiAgICAgICAgICAgICAqICpSZXF1aXJlcyogdGhlIHVzZSBvZiBhIG1vZHVsZSBuYW1lLiBJdCBkb2VzIG5vdCBzdXBwb3J0IHVzaW5nCiAgICAgICAgICAgICAqIHBsYWluIFVSTHMgbGlrZSBuYW1lVG9VcmwuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0b1VybDogZnVuY3Rpb24gKG1vZHVsZU5hbWVQbHVzRXh0LCByZWxNb2R1bGVNYXApIHsKICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IG1vZHVsZU5hbWVQbHVzRXh0Lmxhc3RJbmRleE9mKCIuIiksCiAgICAgICAgICAgICAgICAgICAgZXh0ID0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZXh0ID0gbW9kdWxlTmFtZVBsdXNFeHQuc3Vic3RyaW5nKGluZGV4LCBtb2R1bGVOYW1lUGx1c0V4dC5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIG1vZHVsZU5hbWVQbHVzRXh0ID0gbW9kdWxlTmFtZVBsdXNFeHQuc3Vic3RyaW5nKDAsIGluZGV4KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5uYW1lVG9VcmwobW9kdWxlTmFtZVBsdXNFeHQsIGV4dCwgcmVsTW9kdWxlTWFwKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBDb252ZXJ0cyBhIG1vZHVsZSBuYW1lIHRvIGEgZmlsZSBwYXRoLiBTdXBwb3J0cyBjYXNlcyB3aGVyZQogICAgICAgICAgICAgKiBtb2R1bGVOYW1lIG1heSBhY3R1YWxseSBiZSBqdXN0IGFuIFVSTC4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIG5hbWVUb1VybDogZnVuY3Rpb24gKG1vZHVsZU5hbWUsIGV4dCwgcmVsTW9kdWxlTWFwKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aHMsIHBrZ3MsIHBrZywgcGtnUGF0aCwgc3ltcywgaSwgcGFyZW50TW9kdWxlLCB1cmwsCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0gY29udGV4dC5jb25maWc7CgogICAgICAgICAgICAgICAgLy9Ob3JtYWxpemUgbW9kdWxlIG5hbWUgaWYgaGF2ZSBhIGJhc2UgcmVsYXRpdmUgbW9kdWxlIG5hbWUgdG8gd29yayBmcm9tLgogICAgICAgICAgICAgICAgbW9kdWxlTmFtZSA9IG5vcm1hbGl6ZShtb2R1bGVOYW1lLCByZWxNb2R1bGVNYXAgJiYgcmVsTW9kdWxlTWFwLmZ1bGxOYW1lKTsKCiAgICAgICAgICAgICAgICAvL0lmIGEgY29sb24gaXMgaW4gdGhlIFVSTCwgaXQgaW5kaWNhdGVzIGEgcHJvdG9jb2wgaXMgdXNlZCBhbmQgaXQgaXMganVzdAogICAgICAgICAgICAgICAgLy9hbiBVUkwgdG8gYSBmaWxlLCBvciBpZiBpdCBzdGFydHMgd2l0aCBhIHNsYXNoIG9yIGVuZHMgd2l0aCAuanMsIGl0IGlzIGp1c3QgYSBwbGFpbiBmaWxlLgogICAgICAgICAgICAgICAgLy9UaGUgc2xhc2ggaXMgaW1wb3J0YW50IGZvciBwcm90b2NvbC1sZXNzIFVSTHMgYXMgd2VsbCBhcyBmdWxsIHBhdGhzLgogICAgICAgICAgICAgICAgaWYgKHJlcS5qc0V4dFJlZ0V4cC50ZXN0KG1vZHVsZU5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9KdXN0IGEgcGxhaW4gcGF0aCwgbm90IG1vZHVsZSBuYW1lIGxvb2t1cCwgc28ganVzdCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgLy9BZGQgZXh0ZW5zaW9uIGlmIGl0IGlzIGluY2x1ZGVkLiBUaGlzIGlzIGEgYml0IHdvbmt5LCBvbmx5IG5vbi0uanMgdGhpbmdzIHBhc3MKICAgICAgICAgICAgICAgICAgICAvL2FuIGV4dGVuc2lvbiwgdGhpcyBtZXRob2QgcHJvYmFibHkgbmVlZHMgdG8gYmUgcmV3b3JrZWQuCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbW9kdWxlTmFtZSArIChleHQgPyBleHQgOiAiIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vQSBtb2R1bGUgdGhhdCBuZWVkcyB0byBiZSBjb252ZXJ0ZWQgdG8gYSBwYXRoLgogICAgICAgICAgICAgICAgICAgIHBhdGhzID0gY29uZmlnLnBhdGhzOwogICAgICAgICAgICAgICAgICAgIHBrZ3MgPSBjb25maWcucGtnczsKCiAgICAgICAgICAgICAgICAgICAgc3ltcyA9IG1vZHVsZU5hbWUuc3BsaXQoIi8iKTsKICAgICAgICAgICAgICAgICAgICAvL0ZvciBlYWNoIG1vZHVsZSBuYW1lIHNlZ21lbnQsIHNlZSBpZiB0aGVyZSBpcyBhIHBhdGgKICAgICAgICAgICAgICAgICAgICAvL3JlZ2lzdGVyZWQgZm9yIGl0LiBTdGFydCB3aXRoIG1vc3Qgc3BlY2lmaWMgbmFtZQogICAgICAgICAgICAgICAgICAgIC8vYW5kIHdvcmsgdXAgZnJvbSBpdC4KICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBzeW1zLmxlbmd0aDsgaSA+IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRNb2R1bGUgPSBzeW1zLnNsaWNlKDAsIGkpLmpvaW4oIi8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGhzW3BhcmVudE1vZHVsZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bXMuc3BsaWNlKDAsIGksIHBhdGhzW3BhcmVudE1vZHVsZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKHBrZyA9IHBrZ3NbcGFyZW50TW9kdWxlXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgbW9kdWxlIG5hbWUgaXMganVzdCB0aGUgcGFja2FnZSBuYW1lLCB0aGVuIGxvb2tpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZm9yIHRoZSBtYWluIG1vZHVsZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGVOYW1lID09PSBwa2cubmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrZ1BhdGggPSBwa2cubG9jYXRpb24gKyAnLycgKyBwa2cubWFpbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGtnUGF0aCA9IHBrZy5sb2NhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bXMuc3BsaWNlKDAsIGksIHBrZ1BhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vSm9pbiB0aGUgcGF0aCBwYXJ0cyB0b2dldGhlciwgdGhlbiBmaWd1cmUgb3V0IGlmIGJhc2VVcmwgaXMgbmVlZGVkLgogICAgICAgICAgICAgICAgICAgIHVybCA9IHN5bXMuam9pbigiLyIpICsgKGV4dCB8fCAiLmpzIik7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gKHVybC5jaGFyQXQoMCkgPT09ICcvJyB8fCB1cmwubWF0Y2goL15cdys6LykgPyAiIiA6IGNvbmZpZy5iYXNlVXJsKSArIHVybDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLnVybEFyZ3MgPyB1cmwgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCh1cmwuaW5kZXhPZignPycpID09PSAtMSA/ICc/JyA6ICcmJykgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy51cmxBcmdzKSA6IHVybDsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vTWFrZSB0aGVzZSB2aXNpYmxlIG9uIHRoZSBjb250ZXh0IHNvIGNhbiBiZSBjYWxsZWQgYXQgdGhlIHZlcnkKICAgICAgICAvL2VuZCBvZiB0aGUgZmlsZSB0byBib290c3RyYXAKICAgICAgICBjb250ZXh0LmpRdWVyeUNoZWNrID0galF1ZXJ5Q2hlY2s7CiAgICAgICAgY29udGV4dC5yZXN1bWUgPSByZXN1bWU7CgogICAgICAgIHJldHVybiBjb250ZXh0OwogICAgfQoKICAgIC8qKgogICAgICogTWFpbiBlbnRyeSBwb2ludC4KICAgICAqCiAgICAgKiBJZiB0aGUgb25seSBhcmd1bWVudCB0byByZXF1aXJlIGlzIGEgc3RyaW5nLCB0aGVuIHRoZSBtb2R1bGUgdGhhdAogICAgICogaXMgcmVwcmVzZW50ZWQgYnkgdGhhdCBzdHJpbmcgaXMgZmV0Y2hlZCBmb3IgdGhlIGFwcHJvcHJpYXRlIGNvbnRleHQuCiAgICAgKgogICAgICogSWYgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGFuIGFycmF5LCB0aGVuIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhbiBhcnJheQogICAgICogb2YgZGVwZW5kZW5jeSBzdHJpbmcgbmFtZXMgdG8gZmV0Y2guIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIGNhbGxiYWNrIGNhbgogICAgICogYmUgc3BlY2lmaWVkIHRvIGV4ZWN1dGUgd2hlbiBhbGwgb2YgdGhvc2UgZGVwZW5kZW5jaWVzIGFyZSBhdmFpbGFibGUuCiAgICAgKgogICAgICogTWFrZSBhIGxvY2FsIHJlcSB2YXJpYWJsZSB0byBoZWxwIENhamEgY29tcGxpYW5jZSAoaXQgYXNzdW1lcyB0aGluZ3MKICAgICAqIG9uIGEgcmVxdWlyZSB0aGF0IGFyZSBub3Qgc3RhbmRhcmRpemVkKSwgYW5kIHRvIGdpdmUgYSBzaG9ydAogICAgICogbmFtZSBmb3IgbWluaWZpY2F0aW9uL2xvY2FsIHNjb3BlIHVzZS4KICAgICAqLwogICAgcmVxID0gcmVxdWlyZWpzID0gZnVuY3Rpb24gKGRlcHMsIGNhbGxiYWNrKSB7CgogICAgICAgIC8vRmluZCB0aGUgcmlnaHQgY29udGV4dCwgdXNlIGRlZmF1bHQKICAgICAgICB2YXIgY29udGV4dE5hbWUgPSBkZWZDb250ZXh0TmFtZSwKICAgICAgICAgICAgY29udGV4dCwgY29uZmlnOwoKICAgICAgICAvLyBEZXRlcm1pbmUgaWYgaGF2ZSBjb25maWcgb2JqZWN0IGluIHRoZSBjYWxsLgogICAgICAgIGlmICghaXNBcnJheShkZXBzKSAmJiB0eXBlb2YgZGVwcyAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgLy8gZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QKICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGlzQXJyYXkoY2FsbGJhY2spKSB7CiAgICAgICAgICAgICAgICAvLyBBZGp1c3QgYXJncyBpZiB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAgICAgICAgICAgICAgICBkZXBzID0gY2FsbGJhY2s7CiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGFyZ3VtZW50c1syXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuY29udGV4dCkgewogICAgICAgICAgICBjb250ZXh0TmFtZSA9IGNvbmZpZy5jb250ZXh0OwogICAgICAgIH0KCiAgICAgICAgY29udGV4dCA9IGNvbnRleHRzW2NvbnRleHROYW1lXSB8fAogICAgICAgICAgICAgICAgICAoY29udGV4dHNbY29udGV4dE5hbWVdID0gbmV3Q29udGV4dChjb250ZXh0TmFtZSkpOwoKICAgICAgICBpZiAoY29uZmlnKSB7CiAgICAgICAgICAgIGNvbnRleHQuY29uZmlndXJlKGNvbmZpZyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY29udGV4dC5yZXF1aXJlKGRlcHMsIGNhbGxiYWNrKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IHJlcXVpcmUuY29uZmlnKCkgdG8gbWFrZSBpdCBlYXNpZXIgdG8gY29vcGVyYXRlIHdpdGggb3RoZXIKICAgICAqIEFNRCBsb2FkZXJzIG9uIGdsb2JhbGx5IGFncmVlZCBuYW1lcy4KICAgICAqLwogICAgcmVxLmNvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICByZXR1cm4gcmVxKGNvbmZpZyk7CiAgICB9OwoKICAgIC8qKgogICAgICogRXhwb3J0IHJlcXVpcmUgYXMgYSBnbG9iYWwsIGJ1dCBvbmx5IGlmIGl0IGRvZXMgbm90IGFscmVhZHkgZXhpc3QuCiAgICAgKi8KICAgIGlmICghcmVxdWlyZSkgewogICAgICAgIHJlcXVpcmUgPSByZXE7CiAgICB9CgogICAgLyoqCiAgICAgKiBHbG9iYWwgcmVxdWlyZS50b1VybCgpLCB0byBtYXRjaCBnbG9iYWwgcmVxdWlyZSwgbW9zdGx5IHVzZWZ1bAogICAgICogZm9yIGRlYnVnZ2luZy93b3JrIGluIHRoZSBnbG9iYWwgc3BhY2UuCiAgICAgKi8KICAgIHJlcS50b1VybCA9IGZ1bmN0aW9uIChtb2R1bGVOYW1lUGx1c0V4dCkgewogICAgICAgIHJldHVybiBjb250ZXh0c1tkZWZDb250ZXh0TmFtZV0udG9VcmwobW9kdWxlTmFtZVBsdXNFeHQpOwogICAgfTsKCiAgICByZXEudmVyc2lvbiA9IHZlcnNpb247CgogICAgLy9Vc2VkIHRvIGZpbHRlciBvdXQgZGVwZW5kZW5jaWVzIHRoYXQgYXJlIGFscmVhZHkgcGF0aHMuCiAgICByZXEuanNFeHRSZWdFeHAgPSAvXlwvfDp8XD98XC5qcyQvOwogICAgcyA9IHJlcS5zID0gewogICAgICAgIGNvbnRleHRzOiBjb250ZXh0cywKICAgICAgICAvL1N0b3JlcyBhIGxpc3Qgb2YgVVJMcyB0aGF0IHNob3VsZCBub3QgZ2V0IGFzeW5jIHNjcmlwdCB0YWcgdHJlYXRtZW50LgogICAgICAgIHNraXBBc3luYzoge30KICAgIH07CgogICAgcmVxLmlzQXN5bmMgPSByZXEuaXNCcm93c2VyID0gaXNCcm93c2VyOwogICAgaWYgKGlzQnJvd3NlcikgewogICAgICAgIGhlYWQgPSBzLmhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOwogICAgICAgIC8vSWYgQkFTRSB0YWcgaXMgaW4gcGxheSwgdXNpbmcgYXBwZW5kQ2hpbGQgaXMgYSBwcm9ibGVtIGZvciBJRTYuCiAgICAgICAgLy9XaGVuIHRoYXQgYnJvd3NlciBkaWVzLCB0aGlzIGNhbiBiZSByZW1vdmVkLiBEZXRhaWxzIGluIHRoaXMgalF1ZXJ5IGJ1ZzoKICAgICAgICAvL2h0dHA6Ly9kZXYuanF1ZXJ5LmNvbS90aWNrZXQvMjcwOQogICAgICAgIGJhc2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJhc2UiKVswXTsKICAgICAgICBpZiAoYmFzZUVsZW1lbnQpIHsKICAgICAgICAgICAgaGVhZCA9IHMuaGVhZCA9IGJhc2VFbGVtZW50LnBhcmVudE5vZGU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQW55IGVycm9ycyB0aGF0IHJlcXVpcmUgZXhwbGljaXRseSBnZW5lcmF0ZXMgd2lsbCBiZSBwYXNzZWQgdG8gdGhpcwogICAgICogZnVuY3Rpb24uIEludGVyY2VwdC9vdmVycmlkZSBpdCBpZiB5b3Ugd2FudCBjdXN0b20gZXJyb3IgaGFuZGxpbmcuCiAgICAgKiBAcGFyYW0ge0Vycm9yfSBlcnIgdGhlIGVycm9yIG9iamVjdC4KICAgICAqLwogICAgcmVxLm9uRXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgdGhyb3cgZXJyOwogICAgfTsKCiAgICAvKioKICAgICAqIERvZXMgdGhlIHJlcXVlc3QgdG8gbG9hZCBhIG1vZHVsZSBmb3IgdGhlIGJyb3dzZXIgY2FzZS4KICAgICAqIE1ha2UgdGhpcyBhIHNlcGFyYXRlIGZ1bmN0aW9uIHRvIGFsbG93IG90aGVyIGVudmlyb25tZW50cwogICAgICogdG8gb3ZlcnJpZGUgaXQuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQgdGhlIHJlcXVpcmUgY29udGV4dCB0byBmaW5kIHN0YXRlLgogICAgICogQHBhcmFtIHtTdHJpbmd9IG1vZHVsZU5hbWUgdGhlIG5hbWUgb2YgdGhlIG1vZHVsZS4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSB1cmwgdGhlIFVSTCB0byB0aGUgbW9kdWxlLgogICAgICovCiAgICByZXEubG9hZCA9IGZ1bmN0aW9uIChjb250ZXh0LCBtb2R1bGVOYW1lLCB1cmwpIHsKICAgICAgICByZXEucmVzb3VyY2VzUmVhZHkoZmFsc2UpOwoKICAgICAgICBjb250ZXh0LnNjcmlwdENvdW50ICs9IDE7CiAgICAgICAgcmVxLmF0dGFjaCh1cmwsIGNvbnRleHQsIG1vZHVsZU5hbWUpOwoKICAgICAgICAvL0lmIHRyYWNraW5nIGEgalF1ZXJ5LCB0aGVuIG1ha2Ugc3VyZSBpdHMgcmVhZHkgY2FsbGJhY2tzCiAgICAgICAgLy9hcmUgcHV0IG9uIGhvbGQgdG8gcHJldmVudCBpdHMgcmVhZHkgY2FsbGJhY2tzIGZyb20KICAgICAgICAvL3RyaWdnZXJpbmcgdG9vIHNvb24uCiAgICAgICAgaWYgKGNvbnRleHQualF1ZXJ5ICYmICFjb250ZXh0LmpRdWVyeUluY3JlbWVudGVkKSB7CiAgICAgICAgICAgIGpRdWVyeUhvbGRSZWFkeShjb250ZXh0LmpRdWVyeSwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnRleHQualF1ZXJ5SW5jcmVtZW50ZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gZ2V0SW50ZXJhY3RpdmVTY3JpcHQoKSB7CiAgICAgICAgdmFyIHNjcmlwdHMsIGksIHNjcmlwdDsKICAgICAgICBpZiAoaW50ZXJhY3RpdmVTY3JpcHQgJiYgaW50ZXJhY3RpdmVTY3JpcHQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJykgewogICAgICAgICAgICByZXR1cm4gaW50ZXJhY3RpdmVTY3JpcHQ7CiAgICAgICAgfQoKICAgICAgICBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpOwogICAgICAgIGZvciAoaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTsgaSA+IC0xICYmIChzY3JpcHQgPSBzY3JpcHRzW2ldKTsgaS0tKSB7CiAgICAgICAgICAgIGlmIChzY3JpcHQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJykgewogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlcmFjdGl2ZVNjcmlwdCA9IHNjcmlwdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyBkZWZpbml0aW9ucyBvZiBtb2R1bGVzLiBEaWZmZXJzIGZyb20KICAgICAqIHJlcXVpcmUoKSBpbiB0aGF0IGEgc3RyaW5nIGZvciB0aGUgbW9kdWxlIHNob3VsZCBiZSB0aGUgZmlyc3QgYXJndW1lbnQsCiAgICAgKiBhbmQgdGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgYWZ0ZXIgZGVwZW5kZW5jaWVzIGFyZSBsb2FkZWQgc2hvdWxkCiAgICAgKiByZXR1cm4gYSB2YWx1ZSB0byBkZWZpbmUgdGhlIG1vZHVsZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBmaXJzdCBhcmd1bWVudCdzCiAgICAgKiBuYW1lLgogICAgICovCiAgICBkZWZpbmUgPSBmdW5jdGlvbiAobmFtZSwgZGVwcywgY2FsbGJhY2spIHsKICAgICAgICB2YXIgbm9kZSwgY29udGV4dDsKCiAgICAgICAgLy9BbGxvdyBmb3IgYW5vbnltb3VzIGZ1bmN0aW9ucwogICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgLy9BZGp1c3QgYXJncyBhcHByb3ByaWF0ZWx5CiAgICAgICAgICAgIGNhbGxiYWNrID0gZGVwczsKICAgICAgICAgICAgZGVwcyA9IG5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy9UaGlzIG1vZHVsZSBtYXkgbm90IGhhdmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKCFpc0FycmF5KGRlcHMpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrID0gZGVwczsKICAgICAgICAgICAgZGVwcyA9IFtdOwogICAgICAgIH0KCiAgICAgICAgLy9JZiBubyBuYW1lLCBhbmQgY2FsbGJhY2sgaXMgYSBmdW5jdGlvbiwgdGhlbiBmaWd1cmUgb3V0IGlmIGl0IGEKICAgICAgICAvL0NvbW1vbkpTIHRoaW5nIHdpdGggZGVwZW5kZW5jaWVzLgogICAgICAgIGlmICghZGVwcy5sZW5ndGggJiYgaXNGdW5jdGlvbihjYWxsYmFjaykpIHsKICAgICAgICAgICAgLy9SZW1vdmUgY29tbWVudHMgZnJvbSB0aGUgY2FsbGJhY2sgc3RyaW5nLAogICAgICAgICAgICAvL2xvb2sgZm9yIHJlcXVpcmUgY2FsbHMsIGFuZCBwdWxsIHRoZW0gaW50byB0aGUgZGVwZW5kZW5jaWVzLAogICAgICAgICAgICAvL2J1dCBvbmx5IGlmIHRoZXJlIGFyZSBmdW5jdGlvbiBhcmdzLgogICAgICAgICAgICBpZiAoY2FsbGJhY2subGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjawogICAgICAgICAgICAgICAgICAgIC50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoY29tbWVudFJlZ0V4cCwgIiIpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoY2pzUmVxdWlyZVJlZ0V4cCwgZnVuY3Rpb24gKG1hdGNoLCBkZXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVwcy5wdXNoKGRlcCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy9NYXkgYmUgYSBDb21tb25KUyB0aGluZyBldmVuIHdpdGhvdXQgcmVxdWlyZSBjYWxscywgYnV0IHN0aWxsCiAgICAgICAgICAgICAgICAvL2NvdWxkIHVzZSBleHBvcnRzLCBhbmQgbW9kdWxlLiBBdm9pZCBkb2luZyBleHBvcnRzIGFuZCBtb2R1bGUKICAgICAgICAgICAgICAgIC8vd29yayB0aG91Z2ggaWYgaXQganVzdCBuZWVkcyByZXF1aXJlLgogICAgICAgICAgICAgICAgLy9SRVFVSVJFUyB0aGUgZnVuY3Rpb24gdG8gZXhwZWN0IHRoZSBDb21tb25KUyB2YXJpYWJsZXMgaW4gdGhlCiAgICAgICAgICAgICAgICAvL29yZGVyIGxpc3RlZCBiZWxvdy4KICAgICAgICAgICAgICAgIGRlcHMgPSAoY2FsbGJhY2subGVuZ3RoID09PSAxID8gWyJyZXF1aXJlIl0gOiBbInJlcXVpcmUiLCAiZXhwb3J0cyIsICJtb2R1bGUiXSkuY29uY2F0KGRlcHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL0lmIGluIElFIDYtOCBhbmQgaGl0IGFuIGFub255bW91cyBkZWZpbmUoKSBjYWxsLCBkbyB0aGUgaW50ZXJhY3RpdmUKICAgICAgICAvL3dvcmsuCiAgICAgICAgaWYgKHVzZUludGVyYWN0aXZlKSB7CiAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50bHlBZGRpbmdTY3JpcHQgfHwgZ2V0SW50ZXJhY3RpdmVTY3JpcHQoKTsKICAgICAgICAgICAgaWYgKG5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICghbmFtZSkgewogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBub2RlLmdldEF0dHJpYnV0ZSgiZGF0YS1yZXF1aXJlbW9kdWxlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dHNbbm9kZS5nZXRBdHRyaWJ1dGUoImRhdGEtcmVxdWlyZWNvbnRleHQiKV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vQWx3YXlzIHNhdmUgb2ZmIGV2YWx1YXRpbmcgdGhlIGRlZiBjYWxsIHVudGlsIHRoZSBzY3JpcHQgb25sb2FkIGhhbmRsZXIuCiAgICAgICAgLy9UaGlzIGFsbG93cyBtdWx0aXBsZSBtb2R1bGVzIHRvIGJlIGluIGEgZmlsZSB3aXRob3V0IHByZW1hdHVyZWx5CiAgICAgICAgLy90cmFjaW5nIGRlcGVuZGVuY2llcywgYW5kIGFsbG93cyBmb3IgYW5vbnltb3VzIG1vZHVsZSBzdXBwb3J0LAogICAgICAgIC8vd2hlcmUgdGhlIG1vZHVsZSBuYW1lIGlzIG5vdCBrbm93biB1bnRpbCB0aGUgc2NyaXB0IG9ubG9hZCBldmVudAogICAgICAgIC8vb2NjdXJzLiBJZiBubyBjb250ZXh0LCB1c2UgdGhlIGdsb2JhbCBxdWV1ZSwgYW5kIGdldCBpdCBwcm9jZXNzZWQKICAgICAgICAvL2luIHRoZSBvbnNjcmlwdCBsb2FkIGNhbGxiYWNrLgogICAgICAgIChjb250ZXh0ID8gY29udGV4dC5kZWZRdWV1ZSA6IGdsb2JhbERlZlF1ZXVlKS5wdXNoKFtuYW1lLCBkZXBzLCBjYWxsYmFja10pOwoKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfTsKCiAgICBkZWZpbmUuYW1kID0gewogICAgICAgIG11bHRpdmVyc2lvbjogdHJ1ZSwKICAgICAgICBwbHVnaW5zOiB0cnVlLAogICAgICAgIGpRdWVyeTogdHJ1ZQogICAgfTsKCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSB0ZXh0LiBOb3JtYWxseSBqdXN0IHVzZXMgZXZhbCwgYnV0IGNhbiBiZSBtb2RpZmllZAogICAgICogdG8gdXNlIGEgbW9yZSBlbnZpcm9ubWVudCBzcGVjaWZpYyBjYWxsLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgdGhlIHRleHQgdG8gZXhlY3V0ZS9ldmFsdWF0ZS4KICAgICAqLwogICAgcmVxLmV4ZWMgPSBmdW5jdGlvbiAodGV4dCkgewogICAgICAgIHJldHVybiBldmFsKHRleHQpOwogICAgfTsKCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIGEgbW9kdWxlIGNhbGxhY2sgZnVuY3Rpb24uIEJyb2tlbiBvdXQgYXMgYSBzZXBhcmF0ZSBmdW5jdGlvbgogICAgICogc29sZWx5IHRvIGFsbG93IHRoZSBidWlsZCBzeXN0ZW0gdG8gc2VxdWVuY2UgdGhlIGZpbGVzIGluIHRoZSBidWlsdAogICAgICogbGF5ZXIgaW4gdGhlIHJpZ2h0IHNlcXVlbmNlLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIHJlcS5leGVjQ2IgPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2ssIGFyZ3MsIGV4cG9ydHMpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2suYXBwbHkoZXhwb3J0cywgYXJncyk7CiAgICB9OwoKCiAgICAvKioKICAgICAqIEFkZHMgYSBub2RlIHRvIHRoZSBET00uIFB1YmxpYyBmdW5jdGlvbiBzaW5jZSB1c2VkIGJ5IHRoZSBvcmRlciBwbHVnaW4uCiAgICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgbm90IG5vcm1hbGx5IGJlIGNhbGxlZCBieSBvdXRzaWRlIGNvZGUuCiAgICAgKi8KICAgIHJlcS5hZGRTY3JpcHRUb0RvbSA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgLy9Gb3Igc29tZSBjYWNoZSBjYXNlcyBpbiBJRSA2LTgsIHRoZSBzY3JpcHQgZXhlY3V0ZXMgYmVmb3JlIHRoZSBlbmQKICAgICAgICAvL29mIHRoZSBhcHBlbmRDaGlsZCBleGVjdXRpb24sIHNvIHRvIHRpZSBhbiBhbm9ueW1vdXMgZGVmaW5lCiAgICAgICAgLy9jYWxsIHRvIHRoZSBtb2R1bGUgbmFtZSAod2hpY2ggaXMgc3RvcmVkIG9uIHRoZSBub2RlKSwgaG9sZCBvbgogICAgICAgIC8vdG8gYSByZWZlcmVuY2UgdG8gdGhpcyBub2RlLCBidXQgY2xlYXIgYWZ0ZXIgdGhlIERPTSBpbnNlcnRpb24uCiAgICAgICAgY3VycmVudGx5QWRkaW5nU2NyaXB0ID0gbm9kZTsKICAgICAgICBpZiAoYmFzZUVsZW1lbnQpIHsKICAgICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUobm9kZSwgYmFzZUVsZW1lbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRseUFkZGluZ1NjcmlwdCA9IG51bGw7CiAgICB9OwoKICAgIC8qKgogICAgICogY2FsbGJhY2sgZm9yIHNjcmlwdCBsb2FkcywgdXNlZCB0byBjaGVjayBzdGF0dXMgb2YgbG9hZGluZy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldnQgdGhlIGV2ZW50IGZyb20gdGhlIGJyb3dzZXIgZm9yIHRoZSBzY3JpcHQKICAgICAqIHRoYXQgd2FzIGxvYWRlZC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICByZXEub25TY3JpcHRMb2FkID0gZnVuY3Rpb24gKGV2dCkgewogICAgICAgIC8vVXNpbmcgY3VycmVudFRhcmdldCBpbnN0ZWFkIG9mIHRhcmdldCBmb3IgRmlyZWZveCAyLjAncyBzYWtlLiBOb3QKICAgICAgICAvL2FsbCBvbGQgYnJvd3NlcnMgd2lsbCBiZSBzdXBwb3J0ZWQsIGJ1dCB0aGlzIG9uZSB3YXMgZWFzeSBlbm91Z2gKICAgICAgICAvL3RvIHN1cHBvcnQgYW5kIHN0aWxsIG1ha2VzIHNlbnNlLgogICAgICAgIHZhciBub2RlID0gZXZ0LmN1cnJlbnRUYXJnZXQgfHwgZXZ0LnNyY0VsZW1lbnQsIGNvbnRleHROYW1lLCBtb2R1bGVOYW1lLAogICAgICAgICAgICBjb250ZXh0OwoKICAgICAgICBpZiAoZXZ0LnR5cGUgPT09ICJsb2FkIiB8fCAobm9kZSAmJiByZWFkeVJlZ0V4cC50ZXN0KG5vZGUucmVhZHlTdGF0ZSkpKSB7CiAgICAgICAgICAgIC8vUmVzZXQgaW50ZXJhY3RpdmUgc2NyaXB0IHNvIGEgc2NyaXB0IG5vZGUgaXMgbm90IGhlbGQgb250byBmb3IKICAgICAgICAgICAgLy90byBsb25nLgogICAgICAgICAgICBpbnRlcmFjdGl2ZVNjcmlwdCA9IG51bGw7CgogICAgICAgICAgICAvL1B1bGwgb3V0IHRoZSBuYW1lIG9mIHRoZSBtb2R1bGUgYW5kIHRoZSBjb250ZXh0LgogICAgICAgICAgICBjb250ZXh0TmFtZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCJkYXRhLXJlcXVpcmVjb250ZXh0Iik7CiAgICAgICAgICAgIG1vZHVsZU5hbWUgPSBub2RlLmdldEF0dHJpYnV0ZSgiZGF0YS1yZXF1aXJlbW9kdWxlIik7CiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0c1tjb250ZXh0TmFtZV07CgogICAgICAgICAgICBjb250ZXh0c1tjb250ZXh0TmFtZV0uY29tcGxldGVMb2FkKG1vZHVsZU5hbWUpOwoKICAgICAgICAgICAgLy9DbGVhbiB1cCBzY3JpcHQgYmluZGluZy4gRmF2b3IgZGV0YWNoRXZlbnQgYmVjYXVzZSBvZiBJRTkKICAgICAgICAgICAgLy9pc3N1ZSwgc2VlIGF0dGFjaEV2ZW50L2FkZEV2ZW50TGlzdGVuZXIgY29tbWVudCBlbHNld2hlcmUKICAgICAgICAgICAgLy9pbiB0aGlzIGZpbGUuCiAgICAgICAgICAgIGlmIChub2RlLmRldGFjaEV2ZW50ICYmICFpc09wZXJhKSB7CiAgICAgICAgICAgICAgICAvL1Byb2JhYmx5IElFLiBJZiBub3QgaXQgd2lsbCB0aHJvdyBhbiBlcnJvciwgd2hpY2ggd2lsbCBiZQogICAgICAgICAgICAgICAgLy91c2VmdWwgdG8ga25vdy4KICAgICAgICAgICAgICAgIG5vZGUuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIHJlcS5vblNjcmlwdExvYWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgcmVxLm9uU2NyaXB0TG9hZCwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIEF0dGFjaGVzIHRoZSBzY3JpcHQgcmVwcmVzZW50ZWQgYnkgdGhlIFVSTCB0byB0aGUgY3VycmVudAogICAgICogZW52aXJvbm1lbnQuIFJpZ2h0IG5vdyBvbmx5IHN1cHBvcnRzIGJyb3dzZXIgbG9hZGluZywKICAgICAqIGJ1dCBjYW4gYmUgcmVkZWZpbmVkIGluIG90aGVyIGVudmlyb25tZW50cyB0byBkbyB0aGUgcmlnaHQgdGhpbmcuCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIHRoZSB1cmwgb2YgdGhlIHNjcmlwdCB0byBhdHRhY2guCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dCB0aGUgY29udGV4dCB0aGF0IHdhbnRzIHRoZSBzY3JpcHQuCiAgICAgKiBAcGFyYW0ge21vZHVsZU5hbWV9IHRoZSBuYW1lIG9mIHRoZSBtb2R1bGUgdGhhdCBpcyBhc3NvY2lhdGVkIHdpdGggdGhlIHNjcmlwdC4KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gb3B0aW9uYWwgY2FsbGJhY2ssIGRlZmF1bHRzIHRvIHJlcXVpcmUub25TY3JpcHRMb2FkCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3R5cGVdIG9wdGlvbmFsIHR5cGUsIGRlZmF1bHRzIHRvIHRleHQvamF2YXNjcmlwdAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2ZldGNoT25seUZ1bmN0aW9uXSBvcHRpb25hbCBmdW5jdGlvbiB0byBpbmRpY2F0ZSB0aGUgc2NyaXB0IG5vZGUKICAgICAqIHNob3VsZCBiZSBzZXQgdXAgdG8gZmV0Y2ggdGhlIHNjcmlwdCBidXQgZG8gbm90IGF0dGFjaCBpdCB0byB0aGUgRE9NCiAgICAgKiBzbyB0aGF0IGl0IGNhbiBsYXRlciBiZSBhdHRhY2hlZCB0byBleGVjdXRlIGl0LiBUaGlzIGlzIGEgd2F5IGZvciB0aGUKICAgICAqIG9yZGVyIHBsdWdpbiB0byBzdXBwb3J0IG9yZGVyZWQgbG9hZGluZyBpbiBJRS4gT25jZSB0aGUgc2NyaXB0IGlzIGZldGNoZWQsCiAgICAgKiBidXQgbm90IGV4ZWN1dGVkLCB0aGUgZmV0Y2hPbmx5RnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQuCiAgICAgKi8KICAgIHJlcS5hdHRhY2ggPSBmdW5jdGlvbiAodXJsLCBjb250ZXh0LCBtb2R1bGVOYW1lLCBjYWxsYmFjaywgdHlwZSwgZmV0Y2hPbmx5RnVuY3Rpb24pIHsKICAgICAgICB2YXIgbm9kZTsKICAgICAgICBpZiAoaXNCcm93c2VyKSB7CiAgICAgICAgICAgIC8vSW4gdGhlIGJyb3dzZXIgc28gdXNlIGEgc2NyaXB0IHRhZwogICAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IHJlcS5vblNjcmlwdExvYWQ7CiAgICAgICAgICAgIG5vZGUgPSBjb250ZXh0ICYmIGNvbnRleHQuY29uZmlnICYmIGNvbnRleHQuY29uZmlnLnhodG1sID8KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLCAiaHRtbDpzY3JpcHQiKSA6CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICAgIG5vZGUudHlwZSA9IHR5cGUgfHwgKGNvbnRleHQgJiYgY29udGV4dC5jb25maWcuc2NyaXB0VHlwZSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgInRleHQvamF2YXNjcmlwdCI7CiAgICAgICAgICAgIG5vZGUuY2hhcnNldCA9ICJ1dGYtOCI7CiAgICAgICAgICAgIC8vVXNlIGFzeW5jIHNvIEdlY2tvIGRvZXMgbm90IGJsb2NrIG9uIGV4ZWN1dGluZyB0aGUgc2NyaXB0IGlmIHNvbWV0aGluZwogICAgICAgICAgICAvL2xpa2UgYSBsb25nLXBvbGxpbmcgY29tZXQgdGFnIGlzIGJlaW5nIHJ1biBmaXJzdC4gR2Vja28gbGlrZXMKICAgICAgICAgICAgLy90byBldmFsdWF0ZSBzY3JpcHRzIGluIERPTSBvcmRlciwgZXZlbiBmb3IgZHluYW1pYyBzY3JpcHRzLgogICAgICAgICAgICAvL0l0IHdpbGwgZmV0Y2ggdGhlbSBhc3luYywgYnV0IG9ubHkgZXZhbHVhdGUgdGhlIGNvbnRlbnRzIGluIERPTQogICAgICAgICAgICAvL29yZGVyLCBzbyBhIGxvbmctcG9sbGluZyBzY3JpcHQgdGFnIGNhbiBkZWxheSBleGVjdXRpb24gb2Ygc2NyaXB0cwogICAgICAgICAgICAvL2FmdGVyIGl0LiBCdXQgdGVsbGluZyBHZWNrbyB3ZSBleHBlY3QgYXN5bmMgZ2V0cyB1cyB0aGUgYmVoYXZpb3IKICAgICAgICAgICAgLy93ZSB3YW50IC0tIGV4ZWN1dGUgaXQgd2hlbmV2ZXIgaXQgaXMgZmluaXNoZWQgZG93bmxvYWRpbmcuIE9ubHkKICAgICAgICAgICAgLy9IZWxwcyBGaXJlZm94IDMuNisKICAgICAgICAgICAgLy9BbGxvdyBzb21lIFVSTHMgdG8gbm90IGJlIGZldGNoZWQgYXN5bmMuIE1vc3RseSBoZWxwcyB0aGUgb3JkZXIhCiAgICAgICAgICAgIC8vcGx1Z2luCiAgICAgICAgICAgIG5vZGUuYXN5bmMgPSAhcy5za2lwQXN5bmNbdXJsXTsKCiAgICAgICAgICAgIGlmIChjb250ZXh0KSB7CiAgICAgICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgiZGF0YS1yZXF1aXJlY29udGV4dCIsIGNvbnRleHQuY29udGV4dE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJkYXRhLXJlcXVpcmVtb2R1bGUiLCBtb2R1bGVOYW1lKTsKCiAgICAgICAgICAgIC8vU2V0IHVwIGxvYWQgbGlzdGVuZXIuIFRlc3QgYXR0YWNoRXZlbnQgZmlyc3QgYmVjYXVzZSBJRTkgaGFzCiAgICAgICAgICAgIC8vYSBzdWJ0bGUgaXNzdWUgaW4gaXRzIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHNjcmlwdCBvbmxvYWQgZmlyaW5ncwogICAgICAgICAgICAvL3RoYXQgZG8gbm90IG1hdGNoIHRoZSBiZWhhdmlvciBvZiBhbGwgb3RoZXIgYnJvd3NlcnMgd2l0aAogICAgICAgICAgICAvL2FkZEV2ZW50TGlzdGVuZXIgc3VwcG9ydCwgd2hpY2ggZmlyZSB0aGUgb25sb2FkIGV2ZW50IGZvciBhCiAgICAgICAgICAgIC8vc2NyaXB0IHJpZ2h0IGFmdGVyIHRoZSBzY3JpcHQgZXhlY3V0aW9uLiBTZWU6CiAgICAgICAgICAgIC8vaHR0cHM6Ly9jb25uZWN0Lm1pY3Jvc29mdC5jb20vSUUvZmVlZGJhY2svZGV0YWlscy82NDgwNTcvc2NyaXB0LW9ubG9hZC1ldmVudC1pcy1ub3QtZmlyZWQtaW1tZWRpYXRlbHktYWZ0ZXItc2NyaXB0LWV4ZWN1dGlvbgogICAgICAgICAgICAvL1VORk9SVFVOQVRFTFkgT3BlcmEgaW1wbGVtZW50cyBhdHRhY2hFdmVudCBidXQgZG9lcyBub3QgZm9sbG93IHRoZSBzY3JpcHQKICAgICAgICAgICAgLy9zY3JpcHQgZXhlY3V0aW9uIG1vZGUuCiAgICAgICAgICAgIGlmIChub2RlLmF0dGFjaEV2ZW50ICYmICFpc09wZXJhKSB7CiAgICAgICAgICAgICAgICAvL1Byb2JhYmx5IElFLiBJRSAoYXQgbGVhc3QgNi04KSBkbyBub3QgZmlyZQogICAgICAgICAgICAgICAgLy9zY3JpcHQgb25sb2FkIHJpZ2h0IGFmdGVyIGV4ZWN1dGluZyB0aGUgc2NyaXB0LCBzbwogICAgICAgICAgICAgICAgLy93ZSBjYW5ub3QgdGllIHRoZSBhbm9ueW1vdXMgZGVmaW5lIGNhbGwgdG8gYSBuYW1lLgogICAgICAgICAgICAgICAgLy9Ib3dldmVyLCBJRSByZXBvcnRzIHRoZSBzY3JpcHQgYXMgYmVpbmcgaW4gImludGVyYWN0aXZlIgogICAgICAgICAgICAgICAgLy9yZWFkeVN0YXRlIGF0IHRoZSB0aW1lIG9mIHRoZSBkZWZpbmUgY2FsbC4KICAgICAgICAgICAgICAgIHVzZUludGVyYWN0aXZlID0gdHJ1ZTsKCgogICAgICAgICAgICAgICAgaWYgKGZldGNoT25seUZ1bmN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgLy9OZWVkIHRvIHVzZSBvbGQgc2Nob29sIG9ucmVhZHlzdGF0ZSBoZXJlIHNpbmNlCiAgICAgICAgICAgICAgICAgICAgLy93aGVuIHRoZSBldmVudCBmaXJlcyBhbmQgdGhlIG5vZGUgaXMgbm90IGF0dGFjaGVkCiAgICAgICAgICAgICAgICAgICAgLy90byB0aGUgRE9NLCB0aGUgZXZ0LnNyY0VsZW1lbnQgaXMgbnVsbCwgc28gdXNlCiAgICAgICAgICAgICAgICAgICAgLy9hIGNsb3N1cmUgdG8gcmVtZW1iZXIgdGhlIG5vZGUuCiAgICAgICAgICAgICAgICAgICAgbm9kZS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vU2NyaXB0IGxvYWRlZCBidXQgbm90IGV4ZWN1dGVkLgogICAgICAgICAgICAgICAgICAgICAgICAvL0NsZWFyIGxvYWRlZCBoYW5kbGVyLCBzZXQgdGhlIHJlYWwgb25lIHRoYXQKICAgICAgICAgICAgICAgICAgICAgICAgLy93YWl0cyBmb3Igc2NyaXB0IGV4ZWN1dGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUucmVhZHlTdGF0ZSA9PT0gJ2xvYWRlZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoT25seUZ1bmN0aW9uKG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgY2FsbGJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgY2FsbGJhY2ssIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBub2RlLnNyYyA9IHVybDsKCiAgICAgICAgICAgIC8vRmV0Y2ggb25seSBtZWFucyB3YWl0aW5nIHRvIGF0dGFjaCB0byBET00gYWZ0ZXIgbG9hZGVkLgogICAgICAgICAgICBpZiAoIWZldGNoT25seUZ1bmN0aW9uKSB7CiAgICAgICAgICAgICAgICByZXEuYWRkU2NyaXB0VG9Eb20obm9kZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgIH0gZWxzZSBpZiAoaXNXZWJXb3JrZXIpIHsKICAgICAgICAgICAgLy9JbiBhIHdlYiB3b3JrZXIsIHVzZSBpbXBvcnRTY3JpcHRzLiBUaGlzIGlzIG5vdCBhIHZlcnkKICAgICAgICAgICAgLy9lZmZpY2llbnQgdXNlIG9mIGltcG9ydFNjcmlwdHMsIGltcG9ydFNjcmlwdHMgd2lsbCBibG9jayB1bnRpbAogICAgICAgICAgICAvL2l0cyBzY3JpcHQgaXMgZG93bmxvYWRlZCBhbmQgZXZhbHVhdGVkLiBIb3dldmVyLCBpZiB3ZWIgd29ya2VycwogICAgICAgICAgICAvL2FyZSBpbiBwbGF5LCB0aGUgZXhwZWN0YXRpb24gdGhhdCBhIGJ1aWxkIGhhcyBiZWVuIGRvbmUgc28gdGhhdAogICAgICAgICAgICAvL29ubHkgb25lIHNjcmlwdCBuZWVkcyB0byBiZSBsb2FkZWQgYW55d2F5LiBUaGlzIG1heSBuZWVkIHRvIGJlCiAgICAgICAgICAgIC8vcmVldmFsdWF0ZWQgaWYgb3RoZXIgdXNlIGNhc2VzIGJlY29tZSBjb21tb24uCiAgICAgICAgICAgIGltcG9ydFNjcmlwdHModXJsKTsKCiAgICAgICAgICAgIC8vQWNjb3VudCBmb3IgYW5vbnltb3VzIG1vZHVsZXMKICAgICAgICAgICAgY29udGV4dC5jb21wbGV0ZUxvYWQobW9kdWxlTmFtZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKCiAgICAvL0xvb2sgZm9yIGEgZGF0YS1tYWluIHNjcmlwdCBhdHRyaWJ1dGUsIHdoaWNoIGNvdWxkIGFsc28gYWRqdXN0IHRoZSBiYXNlVXJsLgogICAgaWYgKGlzQnJvd3NlcikgewogICAgICAgIC8vRmlndXJlIG91dCBiYXNlVXJsLiBHZXQgaXQgZnJvbSB0aGUgc2NyaXB0IHRhZyB3aXRoIHJlcXVpcmUuanMgaW4gaXQuCiAgICAgICAgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKTsKCiAgICAgICAgZm9yIChnbG9iYWxJID0gc2NyaXB0cy5sZW5ndGggLSAxOyBnbG9iYWxJID4gLTEgJiYgKHNjcmlwdCA9IHNjcmlwdHNbZ2xvYmFsSV0pOyBnbG9iYWxJLS0pIHsKICAgICAgICAgICAgLy9TZXQgdGhlICJoZWFkIiB3aGVyZSB3ZSBjYW4gYXBwZW5kIGNoaWxkcmVuIGJ5CiAgICAgICAgICAgIC8vdXNpbmcgdGhlIHNjcmlwdCdzIHBhcmVudC4KICAgICAgICAgICAgaWYgKCFoZWFkKSB7CiAgICAgICAgICAgICAgICBoZWFkID0gc2NyaXB0LnBhcmVudE5vZGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vTG9vayBmb3IgYSBkYXRhLW1haW4gYXR0cmlidXRlIHRvIHNldCBtYWluIHNjcmlwdCBmb3IgdGhlIHBhZ2UKICAgICAgICAgICAgLy90byBsb2FkLiBJZiBpdCBpcyB0aGVyZSwgdGhlIHBhdGggdG8gZGF0YSBtYWluIGJlY29tZXMgdGhlCiAgICAgICAgICAgIC8vYmFzZVVybCwgaWYgaXQgaXMgbm90IGFscmVhZHkgc2V0LgogICAgICAgICAgICBpZiAoKGRhdGFNYWluID0gc2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS1tYWluJykpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNmZy5iYXNlVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgLy9QdWxsIG9mZiB0aGUgZGlyZWN0b3J5IG9mIGRhdGEtbWFpbiBmb3IgdXNlIGFzIHRoZQogICAgICAgICAgICAgICAgICAgIC8vYmFzZVVybC4KICAgICAgICAgICAgICAgICAgICBzcmMgPSBkYXRhTWFpbi5zcGxpdCgnLycpOwogICAgICAgICAgICAgICAgICAgIG1haW5TY3JpcHQgPSBzcmMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgc3ViUGF0aCA9IHNyYy5sZW5ndGggPyBzcmMuam9pbignLycpICArICcvJyA6ICcuLyc7CgogICAgICAgICAgICAgICAgICAgIC8vU2V0IGZpbmFsIGNvbmZpZy4KICAgICAgICAgICAgICAgICAgICBjZmcuYmFzZVVybCA9IHN1YlBhdGg7CiAgICAgICAgICAgICAgICAgICAgLy9TdHJpcCBvZmYgYW55IHRyYWlsaW5nIC5qcyBzaW5jZSBkYXRhTWFpbiBpcyBub3cKICAgICAgICAgICAgICAgICAgICAvL2xpa2UgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgICAgICAgICBkYXRhTWFpbiA9IG1haW5TY3JpcHQucmVwbGFjZShqc1N1ZmZpeFJlZ0V4cCwgJycpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vUHV0IHRoZSBkYXRhLW1haW4gc2NyaXB0IGluIHRoZSBmaWxlcyB0byBsb2FkLgogICAgICAgICAgICAgICAgY2ZnLmRlcHMgPSBjZmcuZGVwcyA/IGNmZy5kZXBzLmNvbmNhdChkYXRhTWFpbikgOiBbZGF0YU1haW5dOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vU2VlIGlmIHRoZXJlIGlzIG5vdGhpbmcgd2FpdGluZyBhY3Jvc3MgY29udGV4dHMsIGFuZCBpZiBub3QsIHRyaWdnZXIKICAgIC8vcmVzb3VyY2VzUmVhZHkuCiAgICByZXEuY2hlY2tSZWFkeVN0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb250ZXh0cyA9IHMuY29udGV4dHMsIHByb3A7CiAgICAgICAgZm9yIChwcm9wIGluIGNvbnRleHRzKSB7CiAgICAgICAgICAgIGlmICghKHByb3AgaW4gZW1wdHkpKSB7CiAgICAgICAgICAgICAgICBpZiAoY29udGV4dHNbcHJvcF0ud2FpdENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlcS5yZXNvdXJjZXNSZWFkeSh0cnVlKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbiB0aGF0IGlzIHRyaWdnZXJlZCB3aGVuZXZlciBhbGwgc2NyaXB0cy9yZXNvdXJjZXMKICAgICAqIGhhdmUgYmVlbiBsb2FkZWQgYnkgdGhlIGxvYWRlci4gQ2FuIGJlIG92ZXJyaWRkZW4gYnkgb3RoZXIsIGZvcgogICAgICogaW5zdGFuY2UgdGhlIGRvbVJlYWR5IHBsdWdpbiwgd2hpY2ggd2FudHMgdG8ga25vdyB3aGVuIGFsbCByZXNvdXJjZXMKICAgICAqIGFyZSBsb2FkZWQuCiAgICAgKi8KICAgIHJlcS5yZXNvdXJjZXNSZWFkeSA9IGZ1bmN0aW9uIChpc1JlYWR5KSB7CiAgICAgICAgdmFyIGNvbnRleHRzLCBjb250ZXh0LCBwcm9wOwoKICAgICAgICAvL0ZpcnN0LCBzZXQgdGhlIHB1YmxpYyB2YXJpYWJsZSBpbmRpY2F0aW5nIHRoYXQgcmVzb3VyY2VzIGFyZSBsb2FkaW5nLgogICAgICAgIHJlcS5yZXNvdXJjZXNEb25lID0gaXNSZWFkeTsKCiAgICAgICAgaWYgKHJlcS5yZXNvdXJjZXNEb25lKSB7CiAgICAgICAgICAgIC8vSWYgalF1ZXJ5IHdpdGggRE9NIHJlYWR5IGRlbGF5ZWQsIHJlbGVhc2UgaXQgbm93LgogICAgICAgICAgICBjb250ZXh0cyA9IHMuY29udGV4dHM7CiAgICAgICAgICAgIGZvciAocHJvcCBpbiBjb250ZXh0cykgewogICAgICAgICAgICAgICAgaWYgKCEocHJvcCBpbiBlbXB0eSkpIHsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dHNbcHJvcF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQualF1ZXJ5SW5jcmVtZW50ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5SG9sZFJlYWR5KGNvbnRleHQualF1ZXJ5LCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQualF1ZXJ5SW5jcmVtZW50ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8vRkYgPCAzLjYgcmVhZHlTdGF0ZSBmaXguIE5lZWRlZCBzbyB0aGF0IGRvbVJlYWR5IHBsdWdpbgogICAgLy93b3JrcyB3ZWxsIGluIHRoYXQgZW52aXJvbm1lbnQsIHNpbmNlIHJlcXVpcmUuanMgaXMgbm9ybWFsbHkKICAgIC8vbG9hZGVkIHZpYSBhbiBIVE1MIHNjcmlwdCB0YWcgc28gaXQgd2lsbCBiZSB0aGVyZSBiZWZvcmUgd2luZG93IGxvYWQsCiAgICAvL3doZXJlIHRoZSBkb21SZWFkeSBwbHVnaW4gaXMgbW9yZSBsaWtlbHkgdG8gYmUgbG9hZGVkIGFmdGVyIHdpbmRvdyBsb2FkLgogICAgcmVxLnBhZ2VMb2FkZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgIT09ICJjb21wbGV0ZSIpIHsKICAgICAgICAgICAgZG9jdW1lbnQucmVhZHlTdGF0ZSA9ICJjb21wbGV0ZSI7CiAgICAgICAgfQogICAgfTsKICAgIGlmIChpc0Jyb3dzZXIpIHsKICAgICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICBpZiAoIWRvY3VtZW50LnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlYWR5U3RhdGUgPSAibG9hZGluZyI7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIHJlcS5wYWdlTG9hZGVkLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy9TZXQgdXAgZGVmYXVsdCBjb250ZXh0LiBJZiByZXF1aXJlIHdhcyBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0LCB1c2UgdGhhdCBhcyBiYXNlIGNvbmZpZy4KICAgIHJlcShjZmcpOwoKICAgIC8vSWYgbW9kdWxlcyBhcmUgYnVpbHQgaW50byByZXF1aXJlLmpzLCB0aGVuIG5lZWQgdG8gbWFrZSBzdXJlIGRlcGVuZGVuY2llcyBhcmUKICAgIC8vdHJhY2VkLiBVc2UgYSBzZXRUaW1lb3V0IGluIHRoZSBicm93c2VyIHdvcmxkLCB0byBhbGxvdyBhbGwgdGhlIG1vZHVsZXMgdG8gcmVnaXN0ZXIKICAgIC8vdGhlbXNlbHZlcy4gSW4gYSBub24tYnJvd3NlciBlbnYsIGFzc3VtZSB0aGF0IG1vZHVsZXMgYXJlIG5vdCBidWlsdCBpbnRvIHJlcXVpcmUuanMsCiAgICAvL3doaWNoIHNlZW1zIG9kZCB0byBkbyBvbiB0aGUgc2VydmVyLgogICAgaWYgKHJlcS5pc0FzeW5jICYmIHR5cGVvZiBzZXRUaW1lb3V0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGN0eCA9IHMuY29udGV4dHNbKGNmZy5jb250ZXh0IHx8IGRlZkNvbnRleHROYW1lKV07CiAgICAgICAgLy9JbmRpY2F0ZSB0aGF0IHRoZSBzY3JpcHQgdGhhdCBpbmNsdWRlcyByZXF1aXJlKCkgaXMgc3RpbGwgbG9hZGluZywKICAgICAgICAvL3NvIHRoYXQgcmVxdWlyZSgpJ2QgZGVwZW5kZW5jaWVzIGFyZSBub3QgdHJhY2VkIHVudGlsIHRoZSBlbmQgb2YgdGhlCiAgICAgICAgLy9maWxlIGlzIHBhcnNlZCAoYXBwcm94aW1hdGVkIHZpYSB0aGUgc2V0VGltZW91dCBjYWxsKS4KICAgICAgICBjdHgucmVxdWlyZVdhaXQgPSB0cnVlOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjdHgucmVxdWlyZVdhaXQgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmICghY3R4LnNjcmlwdENvdW50KSB7CiAgICAgICAgICAgICAgICBjdHgucmVzdW1lKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxLmNoZWNrUmVhZHlTdGF0ZSgpOwogICAgICAgIH0sIDApOwogICAgfQp9KCkpOwo=", "content_type": "application/javascript"}, "assets/js/plugins/use.js": {"data": "KGZ1bmN0aW9uKCkgewoKdmFyIGJ1aWxkTWFwID0ge307CgovKiBSZXF1aXJlSlMgVXNlIFBsdWdpbiB2MC4xLjAKICogQ29weXJpZ2h0IDIwMTIsIFRpbSBCcmFueWVuIChAdGJyYW55ZW4pCiAqIHVzZS5qcyBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICovCmRlZmluZSh7CiAgdmVyc2lvbjogIjAuMi4wIiwKCiAgLy8gSW52b2tlZCBieSB0aGUgQU1EIGJ1aWxkZXIsIHBhc3NlZCB0aGUgcGF0aCB0byByZXNvbHZlLCB0aGUgcmVxdWlyZQogIC8vIGZ1bmN0aW9uLCBkb25lIGNhbGxiYWNrLCBhbmQgdGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4KICAvLwogIC8vIENvbmZpZ3VyYXRpb24gZm9ybWF0CiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLwogIC8vIFRoZSBzdHJpbmcgcHJvcGVydHkgdXNlZCBpbiBhdHRhY2ggd2lsbCByZXNvbHZlIHRvIHdpbmRvd1tzdHJpbmdQcm9wXQogIC8vIEZ1bmN0aW9ucyBhcmUgZXZhbHVhdGVkIGluIHRoZSBzY29wZSBvZiB0aGUgd2luZG93IGFuZCBwYXNzZWQgYWxsCiAgLy8gYXJndW1lbnRzLgogIC8vCiAgLy8gcmVxdWlyZS5jb25maWcoewogIC8vICAgdXNlOiB7CiAgLy8gICAgICJsaWJzL3VuZGVyc2NvcmUiOiB7CiAgLy8gICAgICAgYXR0YWNoOiAiXyIKICAvLyAgICAgfSwKICAvLyAgCiAgLy8gICAgICJsaWJzL2JhY2tib25lIjogewogIC8vICAgICAgIGRlcHM6IFsidXNlIXVuZGVyc2NvcmUiLCAianF1ZXJ5Il0sCiAgLy8gICAgICAgYXR0YWNoOiBmdW5jdGlvbihfLCAkKSB7CiAgLy8gICAgICAgICByZXR1cm4gdGhpcy5CYWNrYm9uZS5ub0NvbmZsaWN0KCk7CiAgLy8gICAgICAgfQogIC8vICAgICB9CiAgLy8gICB9CiAgLy8gfSk7CiAgLy8KICBsb2FkOiBmdW5jdGlvbihuYW1lLCByZXEsIGxvYWQsIGNvbmZpZykgewogICAgdmFyIG1vZHVsZSA9IGNvbmZpZy51c2UgJiYgY29uZmlnLnVzZVtuYW1lXTsKCiAgICAvLyBObyBtb2R1bGUgdG8gbG9hZCBzbyByZXR1cm4gZWFybHkuCiAgICBpZiAoIW1vZHVsZSkgewogICAgICByZXR1cm4gbG9hZCgpOwogICAgfQoKICAgIC8vIEF0dGFjaCB0byB0aGUgYnVpbGQgbWFwIGZvciB1c2UgaW4gdGhlIHdyaXRlIG1ldGhvZCBiZWxvdy4KICAgIGJ1aWxkTWFwW25hbWVdID0geyBkZXBzOiBtb2R1bGUuZGVwcyB8fCBbXSwgYXR0YWNoOiBtb2R1bGUuYXR0YWNoIH07CgogICAgLy8gUmVhZCB0aGUgY3VycmVudCBtb2R1bGUgY29uZmlndXJhdGlvbiBmb3IgYW55IGRlcGVuZGVuY2llcyB0aGF0IGFyZQogICAgLy8gcmVxdWlyZWQgdG8gcnVuIHRoaXMgcGFydGljdWxhciBub24tQU1EIG1vZHVsZS4KICAgIHJlcShtb2R1bGUuZGVwcyB8fCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIC8vIFJlcXVpcmUgdGhpcyBtb2R1bGUKICAgICAgcmVxKFtuYW1lXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gQXR0YWNoIHByb3BlcnR5CiAgICAgICAgYXR0YWNoID0gbW9kdWxlLmF0dGFjaDsKCiAgICAgICAgLy8gSWYgZG9pbmcgYSBidWlsZCBkb24ndCBjYXJlIGFib3V0IGxvYWRpbmcKICAgICAgICBpZiAoY29uZmlnLmlzQnVpbGQpIHsgCiAgICAgICAgICByZXR1cm4gbG9hZCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuIHRoZSBjb3JyZWN0IGF0dGFjaGVkIG9iamVjdAogICAgICAgIGlmICh0eXBlb2YgYXR0YWNoID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHJldHVybiBsb2FkKGF0dGFjaC5hcHBseSh3aW5kb3csIGFyZ3VtZW50cykpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXNlIHdpbmRvdyBmb3Igbm93IChtYXliZSB0aGlzPykKICAgICAgICByZXR1cm4gbG9hZCh3aW5kb3dbYXR0YWNoXSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKCiAgd3JpdGU6IGZ1bmN0aW9uKHBsdWdpbk5hbWUsIG1vZHVsZU5hbWUsIHdyaXRlKSB7CiAgICB2YXIgbW9kdWxlID0gYnVpbGRNYXBbbW9kdWxlTmFtZV07CiAgICB2YXIgbm9ybWFsaXplID0geyBhdHRhY2g6IG51bGwsIGRlcHM6ICIiIH07CgogICAgLy8gTm9ybWFsaXplIHRoZSBhdHRhY2ggdG8gd2luZG93W25hbWVdIG9yIGZ1bmN0aW9uKCkgeyB9CiAgICBpZiAodHlwZW9mIGF0dGFjaCA9PSAiZnVuY3Rpb24iKSB7CiAgICAgIG5vcm1hbGl6ZS5hdHRhY2ggPSAicmV0dXJuICIgKyBtb2R1bGUuYXR0YWNoLnRvU3RyaW5nKCkgKyAiOyI7CiAgICB9IGVsc2UgewogICAgICBub3JtYWxpemUuYXR0YWNoID0gInJldHVybiB3aW5kb3dbJyIgKyBtb2R1bGUuYXR0YWNoICsgIiddOyI7CiAgICB9CgogICAgLy8gTm9ybWFsaXplIHRoZSBkZXBlbmRlbmNpZXMgdG8gaGF2ZSBwcm9wZXIgc3RyaW5nIGNoYXJhY3RlcnMKICAgIGlmIChtb2R1bGUuZGVwcy5sZW5ndGgpIHsKICAgICAgbm9ybWFsaXplLmRlcHMgPSAiJyIgKyBtb2R1bGUuZGVwcy50b1N0cmluZygpLnNwbGl0KCIsIikuam9pbigiJywnIikgKyAiJyI7CiAgICB9CgogICAgLy8gV3JpdGUgb3V0IHRoZSBhY3R1YWwgZGVmaW5pdGlvbgogICAgd3JpdGUoWwogICAgICAiZGVmaW5lKCciLCBwbHVnaW5OYW1lLCAiISIsIG1vZHVsZU5hbWUsICInLCAiLAogICAgICAgICJbIiwgbm9ybWFsaXplLmRlcHMsICJdLCIsCgogICAgICAgICJmdW5jdGlvbigpIHsiLAogICAgICAgICAgbm9ybWFsaXplLmF0dGFjaCwKICAgICAgICAifSIsCgogICAgICAiKTtcbiIKICAgIF0uam9pbigiIikpOwogIH0KfSk7Cgp9KSgpOwo=", "content_type": "application/javascript"}, "readme.md": {"data": "QmFja2JvbmUgQm9pbGVycGxhdGUKPT09PT09PT09PT09PT09PT09PT0KClRoaXMgYm9pbGVycGxhdGUgaXMgdGhlIHByb2R1Y3Qgb2YgbXVjaCByZXNlYXJjaCBhbmQgZnJ1c3RyYXRpb24uICBFeGlzdGluZwpib2lsZXJwbGF0ZXMgZnJlZWx5IG1vZGlmeSBCYWNrYm9uZSBjb3JlLCBsYWNrIGEgYnVpbGQgcHJvY2VzcywgYW5kIGFyZQp2ZXJ5IHByZXNjcmlwdGl2ZTsgdGhpcyBib2lsZXJwbGF0ZSBjaGFuZ2VzIHRoYXQuCgpPcmdhbml6ZSB5b3VyIGFwcGxpY2F0aW9uIGluIGEgbG9naWNhbCBmaWxlc3lzdGVtLCBkZXZlbG9wIHlvdXIKTW9kZWxzL0NvbGxlY3Rpb25zL1ZpZXdzL1JvdXRlcnMgaW5zaWRlIG1vZHVsZXMsIGFuZCBidWlsZCBrbm93aW5nIHlvdSBoYXZlCmVmZmljaWVudCBjb2RlIHRoYXQgd2lsbCBub3QgYm90dGxlbmVjayB5b3VyIHVzZXJzLgoKVGhhbmtzIHRvIG91cgpbQ29udHJpYnV0b3JzXShodHRwczovL2dpdGh1Yi5jb20vdGJyYW55ZW4vYmFja2JvbmUtYm9pbGVycGxhdGUvY29udHJpYnV0b3JzKSEKClNwZWNpYWwgVGhhbmtzIHRvOiBbY293Ym95XShodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kpLApbaXJvc10oaHR0cDovL2dpdGh1Yi5jb20vaXJvcyksIFtuaW1idXBhbmldKGh0dHA6Ly9naXRodWIuY29tL25pbWJ1cGFuaSksClt3b29raWVoYW5nb3Zlcl0oaHR0cDovL2dpdGh1Yi5jb20vd29va2llaGFuZ292ZXIpLCBhbmQKW2p1Z2dsaW5taWtlXShodHRwOi8vZ2l0aHViLmNvbS9qdWdnbGlubWlrZSkKCiMjIERvY3VtZW50YXRpb24gIyMKClZpZXcgdGhlIEJhY2tib25lIEJvaWxlcnBsYXRlIGRvY3VtZW50YXRpb24gaGVyZToKCltHaXRIdWIgV2lraV0oaHR0cHM6Ly9naXRodWIuY29tL3RicmFueWVuL2JhY2tib25lLWJvaWxlcnBsYXRlL3dpa2kpCgojIyBCdWlsZCBwcm9jZXNzICMjCgpUbyB1c2UgdGhlIG5ldyBhbmQgaW1wcm92ZWQgYnVpbGQgcHJvY2VzcywgcGxlYXNlIHZpc2l0IHRoZSAKW2dydW50LWJiYl0oaHR0cHM6Ly9naXRodWIuY29tL2JhY2tib25lLWJvaWxlcnBsYXRlL2dydW50LWJiYikKcGx1Z2luIHJlcG8gYW5kIGZvbGxvdyB0aGUgaW5zdHJ1Y3Rpb25zIHRvIGluc3RhbGwuICBCYXNpbmcgeW91ciBwcm9qZWN0IG9mZgp0aGlzIHJlcG8gd2lsbCBhbGxvdyB0aGUgYGJiYmAgY29tbWFuZHMgdG8gd29yayBvdXQtb2YtdGhlLWJveC4K", "content_type": ""}, "assets/js/libs/underscore.js": {"data": "Ly8gICAgIFVuZGVyc2NvcmUuanMgMS4zLjEKLy8gICAgIChjKSAyMDA5LTIwMTIgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIEluYy4KLy8gICAgIFVuZGVyc2NvcmUgaXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgUG9ydGlvbnMgb2YgVW5kZXJzY29yZSBhcmUgaW5zcGlyZWQgb3IgYm9ycm93ZWQgZnJvbSBQcm90b3R5cGUsCi8vICAgICBPbGl2ZXIgU3RlZWxlJ3MgRnVuY3Rpb25hbCwgYW5kIEpvaG4gUmVzaWcncyBNaWNyby1UZW1wbGF0aW5nLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2RvY3VtZW50Y2xvdWQuZ2l0aHViLmNvbS91bmRlcnNjb3JlCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBnbG9iYWxgIG9uIHRoZSBzZXJ2ZXIuCiAgdmFyIHJvb3QgPSB0aGlzOwoKICAvLyBTYXZlIHRoZSBwcmV2aW91cyB2YWx1ZSBvZiB0aGUgYF9gIHZhcmlhYmxlLgogIHZhciBwcmV2aW91c1VuZGVyc2NvcmUgPSByb290Ll87CgogIC8vIEVzdGFibGlzaCB0aGUgb2JqZWN0IHRoYXQgZ2V0cyByZXR1cm5lZCB0byBicmVhayBvdXQgb2YgYSBsb29wIGl0ZXJhdGlvbi4KICB2YXIgYnJlYWtlciA9IHt9OwoKICAvLyBTYXZlIGJ5dGVzIGluIHRoZSBtaW5pZmllZCAoYnV0IG5vdCBnemlwcGVkKSB2ZXJzaW9uOgogIHZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlLCBPYmpQcm90byA9IE9iamVjdC5wcm90b3R5cGUsIEZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTsKCiAgLy8gQ3JlYXRlIHF1aWNrIHJlZmVyZW5jZSB2YXJpYWJsZXMgZm9yIHNwZWVkIGFjY2VzcyB0byBjb3JlIHByb3RvdHlwZXMuCiAgdmFyIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgICB1bnNoaWZ0ICAgICAgICAgID0gQXJyYXlQcm90by51bnNoaWZ0LAogICAgICB0b1N0cmluZyAgICAgICAgID0gT2JqUHJvdG8udG9TdHJpbmcsCiAgICAgIGhhc093blByb3BlcnR5ICAgPSBPYmpQcm90by5oYXNPd25Qcm9wZXJ0eTsKCiAgLy8gQWxsICoqRUNNQVNjcmlwdCA1KiogbmF0aXZlIGZ1bmN0aW9uIGltcGxlbWVudGF0aW9ucyB0aGF0IHdlIGhvcGUgdG8gdXNlCiAgLy8gYXJlIGRlY2xhcmVkIGhlcmUuCiAgdmFyCiAgICBuYXRpdmVGb3JFYWNoICAgICAgPSBBcnJheVByb3RvLmZvckVhY2gsCiAgICBuYXRpdmVNYXAgICAgICAgICAgPSBBcnJheVByb3RvLm1hcCwKICAgIG5hdGl2ZVJlZHVjZSAgICAgICA9IEFycmF5UHJvdG8ucmVkdWNlLAogICAgbmF0aXZlUmVkdWNlUmlnaHQgID0gQXJyYXlQcm90by5yZWR1Y2VSaWdodCwKICAgIG5hdGl2ZUZpbHRlciAgICAgICA9IEFycmF5UHJvdG8uZmlsdGVyLAogICAgbmF0aXZlRXZlcnkgICAgICAgID0gQXJyYXlQcm90by5ldmVyeSwKICAgIG5hdGl2ZVNvbWUgICAgICAgICA9IEFycmF5UHJvdG8uc29tZSwKICAgIG5hdGl2ZUluZGV4T2YgICAgICA9IEFycmF5UHJvdG8uaW5kZXhPZiwKICAgIG5hdGl2ZUxhc3RJbmRleE9mICA9IEFycmF5UHJvdG8ubGFzdEluZGV4T2YsCiAgICBuYXRpdmVJc0FycmF5ICAgICAgPSBBcnJheS5pc0FycmF5LAogICAgbmF0aXZlS2V5cyAgICAgICAgID0gT2JqZWN0LmtleXMsCiAgICBuYXRpdmVCaW5kICAgICAgICAgPSBGdW5jUHJvdG8uYmluZDsKCiAgLy8gQ3JlYXRlIGEgc2FmZSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciB1c2UgYmVsb3cuCiAgdmFyIF8gPSBmdW5jdGlvbihvYmopIHsgcmV0dXJuIG5ldyB3cmFwcGVyKG9iaik7IH07CgogIC8vIEV4cG9ydCB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yICoqTm9kZS5qcyoqLCB3aXRoCiAgLy8gYmFja3dhcmRzLWNvbXBhdGliaWxpdHkgZm9yIHRoZSBvbGQgYHJlcXVpcmUoKWAgQVBJLiBJZiB3ZSdyZSBpbgogIC8vIHRoZSBicm93c2VyLCBhZGQgYF9gIGFzIGEgZ2xvYmFsIG9iamVjdCB2aWEgYSBzdHJpbmcgaWRlbnRpZmllciwKICAvLyBmb3IgQ2xvc3VyZSBDb21waWxlciAiYWR2YW5jZWQiIG1vZGUuCiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IF87CiAgICB9CiAgICBleHBvcnRzLl8gPSBfOwogIH0gZWxzZSB7CiAgICByb290WydfJ10gPSBfOwogIH0KCiAgLy8gQ3VycmVudCB2ZXJzaW9uLgogIF8uVkVSU0lPTiA9ICcxLjMuMSc7CgogIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCiAgLy8gSGFuZGxlcyBvYmplY3RzIHdpdGggdGhlIGJ1aWx0LWluIGBmb3JFYWNoYCwgYXJyYXlzLCBhbmQgcmF3IG9iamVjdHMuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGZvckVhY2hgIGlmIGF2YWlsYWJsZS4KICB2YXIgZWFjaCA9IF8uZWFjaCA9IF8uZm9yRWFjaCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuOwogICAgaWYgKG5hdGl2ZUZvckVhY2ggJiYgb2JqLmZvckVhY2ggPT09IG5hdGl2ZUZvckVhY2gpIHsKICAgICAgb2JqLmZvckVhY2goaXRlcmF0b3IsIGNvbnRleHQpOwogICAgfSBlbHNlIGlmIChvYmoubGVuZ3RoID09PSArb2JqLmxlbmd0aCkgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG9iai5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAoaSBpbiBvYmogJiYgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChfLmhhcyhvYmosIGtleSkpIHsKICAgICAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpOwogICAgfSk7CiAgICBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHJlc3VsdHMubGVuZ3RoID0gb2JqLmxlbmd0aDsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlJyk7CiAgICByZXR1cm4gbWVtbzsKICB9OwoKICAvLyBUaGUgcmlnaHQtYXNzb2NpYXRpdmUgdmVyc2lvbiBvZiByZWR1Y2UsIGFsc28ga25vd24gYXMgYGZvbGRyYC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlUmlnaHRgIGlmIGF2YWlsYWJsZS4KICBfLnJlZHVjZVJpZ2h0ID0gXy5mb2xkciA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIG1lbW8sIGNvbnRleHQpIHsKICAgIHZhciBpbml0aWFsID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CiAgICBpZiAob2JqID09IG51bGwpIG9iaiA9IFtdOwogICAgaWYgKG5hdGl2ZVJlZHVjZVJpZ2h0ICYmIG9iai5yZWR1Y2VSaWdodCA9PT0gbmF0aXZlUmVkdWNlUmlnaHQpIHsKICAgICAgaWYgKGNvbnRleHQpIGl0ZXJhdG9yID0gXy5iaW5kKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgICAgcmV0dXJuIGluaXRpYWwgPyBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IsIG1lbW8pIDogb2JqLnJlZHVjZVJpZ2h0KGl0ZXJhdG9yKTsKICAgIH0KICAgIHZhciByZXZlcnNlZCA9IF8udG9BcnJheShvYmopLnJldmVyc2UoKTsKICAgIGlmIChjb250ZXh0ICYmICFpbml0aWFsKSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICByZXR1cm4gaW5pdGlhbCA/IF8ucmVkdWNlKHJldmVyc2VkLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgOiBfLnJlZHVjZShyZXZlcnNlZCwgaXRlcmF0b3IpOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQ7CiAgICBhbnkob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkgewogICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgdGhhdCBwYXNzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgZmlsdGVyYCBpZiBhdmFpbGFibGUuCiAgLy8gQWxpYXNlZCBhcyBgc2VsZWN0YC4KICBfLmZpbHRlciA9IF8uc2VsZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSByZXN1bHRzW3Jlc3VsdHMubGVuZ3RoXSA9IHZhbHVlOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBmb3Igd2hpY2ggYSB0cnV0aCB0ZXN0IGZhaWxzLgogIF8ucmVqZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSByZXN1bHRzW3Jlc3VsdHMubGVuZ3RoXSA9IHZhbHVlOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBEZXRlcm1pbmUgd2hldGhlciBhbGwgb2YgdGhlIGVsZW1lbnRzIG1hdGNoIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgZXZlcnlgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBhbGxgLgogIF8uZXZlcnkgPSBfLmFsbCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0OwogICAgaWYgKG5hdGl2ZUV2ZXJ5ICYmIG9iai5ldmVyeSA9PT0gbmF0aXZlRXZlcnkpIHJldHVybiBvYmouZXZlcnkoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoIShyZXN1bHQgPSByZXN1bHQgJiYgaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIGlmIGF0IGxlYXN0IG9uZSBlbGVtZW50IGluIHRoZSBvYmplY3QgbWF0Y2hlcyBhIHRydXRoIHRlc3QuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYHNvbWVgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBhbnlgLgogIHZhciBhbnkgPSBfLnNvbWUgPSBfLmFueSA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGl0ZXJhdG9yIHx8IChpdGVyYXRvciA9IF8uaWRlbnRpdHkpOwogICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0OwogICAgaWYgKG5hdGl2ZVNvbWUgJiYgb2JqLnNvbWUgPT09IG5hdGl2ZVNvbWUpIHJldHVybiBvYmouc29tZShpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkpIHJldHVybiBicmVha2VyOwogICAgfSk7CiAgICByZXR1cm4gISFyZXN1bHQ7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIGlmIGEgZ2l2ZW4gdmFsdWUgaXMgaW5jbHVkZWQgaW4gdGhlIGFycmF5IG9yIG9iamVjdCB1c2luZyBgPT09YC4KICAvLyBBbGlhc2VkIGFzIGBjb250YWluc2AuCiAgXy5pbmNsdWRlID0gXy5jb250YWlucyA9IGZ1bmN0aW9uKG9iaiwgdGFyZ2V0KSB7CiAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZvdW5kOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgZm91bmQgPSBhbnkob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWUgPT09IHRhcmdldDsKICAgIH0pOwogICAgcmV0dXJuIGZvdW5kOwogIH07CgogIC8vIEludm9rZSBhIG1ldGhvZCAod2l0aCBhcmd1bWVudHMpIG9uIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLgogIF8uaW52b2tlID0gZnVuY3Rpb24ob2JqLCBtZXRob2QpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuIChfLmlzRnVuY3Rpb24obWV0aG9kKSA/IG1ldGhvZCB8fCB2YWx1ZSA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiB2YWx1ZVtrZXldOyB9KTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5tYXggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopKSByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0VtcHR5KG9iaikpIHJldHVybiAtSW5maW5pdHk7CiAgICB2YXIgcmVzdWx0ID0ge2NvbXB1dGVkIDogLUluZmluaXR5fTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgY29tcHV0ZWQgPj0gcmVzdWx0LmNvbXB1dGVkICYmIChyZXN1bHQgPSB7dmFsdWUgOiB2YWx1ZSwgY29tcHV0ZWQgOiBjb21wdXRlZH0pOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0LnZhbHVlOwogIH07CgogIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1pbiA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikpIHJldHVybiBNYXRoLm1pbi5hcHBseShNYXRoLCBvYmopOwogICAgaWYgKCFpdGVyYXRvciAmJiBfLmlzRW1wdHkob2JqKSkgcmV0dXJuIEluZmluaXR5OwogICAgdmFyIHJlc3VsdCA9IHtjb21wdXRlZCA6IEluZmluaXR5fTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgY29tcHV0ZWQgPCByZXN1bHQuY29tcHV0ZWQgJiYgKHJlc3VsdCA9IHt2YWx1ZSA6IHZhbHVlLCBjb21wdXRlZCA6IGNvbXB1dGVkfSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQudmFsdWU7CiAgfTsKCiAgLy8gU2h1ZmZsZSBhbiBhcnJheS4KICBfLnNodWZmbGUgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBzaHVmZmxlZCA9IFtdLCByYW5kOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgIHNodWZmbGVkWzBdID0gdmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpbmRleCArIDEpKTsKICAgICAgICBzaHVmZmxlZFtpbmRleF0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgICBzaHVmZmxlZFtyYW5kXSA9IHZhbHVlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBzaHVmZmxlZDsKICB9OwoKICAvLyBTb3J0IHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0b3IuCiAgXy5zb3J0QnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlIDogdmFsdWUsCiAgICAgICAgY3JpdGVyaWEgOiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkKICAgICAgfTsKICAgIH0pLnNvcnQoZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsKICAgICAgdmFyIGEgPSBsZWZ0LmNyaXRlcmlhLCBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDsKICAgIH0pLCAndmFsdWUnKTsKICB9OwoKICAvLyBHcm91cHMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbi4gUGFzcyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlCiAgLy8gdG8gZ3JvdXAgYnksIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBjcml0ZXJpb24uCiAgXy5ncm91cEJ5ID0gZnVuY3Rpb24ob2JqLCB2YWwpIHsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIHZhciBpdGVyYXRvciA9IF8uaXNGdW5jdGlvbih2YWwpID8gdmFsIDogZnVuY3Rpb24ob2JqKSB7IHJldHVybiBvYmpbdmFsXTsgfTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsKICAgICAgdmFyIGtleSA9IGl0ZXJhdG9yKHZhbHVlLCBpbmRleCk7CiAgICAgIChyZXN1bHRba2V5XSB8fCAocmVzdWx0W2tleV0gPSBbXSkpLnB1c2godmFsdWUpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCBhdCB3aGF0IGluZGV4IGFuIG9iamVjdCBzaG91bGQKICAvLyBiZSBpbnNlcnRlZCBzbyBhcyB0byBtYWludGFpbiBvcmRlci4gVXNlcyBiaW5hcnkgc2VhcmNoLgogIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRvcikgewogICAgaXRlcmF0b3IgfHwgKGl0ZXJhdG9yID0gXy5pZGVudGl0eSk7CiAgICB2YXIgbG93ID0gMCwgaGlnaCA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7CiAgICAgIHZhciBtaWQgPSAobG93ICsgaGlnaCkgPj4gMTsKICAgICAgaXRlcmF0b3IoYXJyYXlbbWlkXSkgPCBpdGVyYXRvcihvYmopID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjb252ZXJ0IGFueXRoaW5nIGl0ZXJhYmxlIGludG8gYSByZWFsLCBsaXZlIGFycmF5LgogIF8udG9BcnJheSA9IGZ1bmN0aW9uKGl0ZXJhYmxlKSB7CiAgICBpZiAoIWl0ZXJhYmxlKSAgICAgICAgICAgICAgICByZXR1cm4gW107CiAgICBpZiAoaXRlcmFibGUudG9BcnJheSkgICAgICAgICByZXR1cm4gaXRlcmFibGUudG9BcnJheSgpOwogICAgaWYgKF8uaXNBcnJheShpdGVyYWJsZSkpICAgICAgcmV0dXJuIHNsaWNlLmNhbGwoaXRlcmFibGUpOwogICAgaWYgKF8uaXNBcmd1bWVudHMoaXRlcmFibGUpKSAgcmV0dXJuIHNsaWNlLmNhbGwoaXRlcmFibGUpOwogICAgcmV0dXJuIF8udmFsdWVzKGl0ZXJhYmxlKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiBhbiBvYmplY3QuCiAgXy5zaXplID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gXy50b0FycmF5KG9iaikubGVuZ3RoOwogIH07CgogIC8vIEFycmF5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBHZXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGZpcnN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBBbGlhc2VkIGFzIGBoZWFkYC4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yawogIC8vIHdpdGggYF8ubWFwYC4KICBfLmZpcnN0ID0gXy5oZWFkID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7CiAgICByZXR1cm4gKG4gIT0gbnVsbCkgJiYgIWd1YXJkID8gc2xpY2UuY2FsbChhcnJheSwgMCwgbikgOiBhcnJheVswXTsKICB9OwoKICAvLyBSZXR1cm5zIGV2ZXJ5dGhpbmcgYnV0IHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBhcnJheS4gRXNwZWNjaWFseSB1c2VmdWwgb24KICAvLyB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiBhbGwgdGhlIHZhbHVlcyBpbgogIC8vIHRoZSBhcnJheSwgZXhjbHVkaW5nIHRoZSBsYXN0IE4uIFRoZSAqKmd1YXJkKiogY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aAogIC8vIGBfLm1hcGAuCiAgXy5pbml0aWFsID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgMCwgYXJyYXkubGVuZ3RoIC0gKChuID09IG51bGwpIHx8IGd1YXJkID8gMSA6IG4pKTsKICB9OwoKICAvLyBHZXQgdGhlIGxhc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgbGFzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5sYXN0ID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7CiAgICBpZiAoKG4gIT0gbnVsbCkgJiYgIWd1YXJkKSB7CiAgICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCBNYXRoLm1heChhcnJheS5sZW5ndGggLSBuLCAwKSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICB9CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIGFycmF5LiBBbGlhc2VkIGFzIGB0YWlsYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKmluZGV4Kiogd2lsbCByZXR1cm4KICAvLyB0aGUgcmVzdCBvZiB0aGUgdmFsdWVzIGluIHRoZSBhcnJheSBmcm9tIHRoYXQgaW5kZXggb253YXJkLiBUaGUgKipndWFyZCoqCiAgLy8gY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8ucmVzdCA9IF8udGFpbCA9IGZ1bmN0aW9uKGFycmF5LCBpbmRleCwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAoaW5kZXggPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogaW5kZXgpOwogIH07CgogIC8vIFRyaW0gb3V0IGFsbCBmYWxzeSB2YWx1ZXMgZnJvbSBhbiBhcnJheS4KICBfLmNvbXBhY3QgPSBmdW5jdGlvbihhcnJheSkgewogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhIXZhbHVlOyB9KTsKICB9OwoKICAvLyBSZXR1cm4gYSBjb21wbGV0ZWx5IGZsYXR0ZW5lZCB2ZXJzaW9uIG9mIGFuIGFycmF5LgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gXy5yZWR1Y2UoYXJyYXksIGZ1bmN0aW9uKG1lbW8sIHZhbHVlKSB7CiAgICAgIGlmIChfLmlzQXJyYXkodmFsdWUpKSByZXR1cm4gbWVtby5jb25jYXQoc2hhbGxvdyA/IHZhbHVlIDogXy5mbGF0dGVuKHZhbHVlKSk7CiAgICAgIG1lbW9bbWVtby5sZW5ndGhdID0gdmFsdWU7CiAgICAgIHJldHVybiBtZW1vOwogICAgfSwgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yKSB7CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yKSA6IGFycmF5OwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgXy5yZWR1Y2UoaW5pdGlhbCwgZnVuY3Rpb24obWVtbywgZWwsIGkpIHsKICAgICAgaWYgKDAgPT0gaSB8fCAoaXNTb3J0ZWQgPT09IHRydWUgPyBfLmxhc3QobWVtbykgIT0gZWwgOiAhXy5pbmNsdWRlKG1lbW8sIGVsKSkpIHsKICAgICAgICBtZW1vW21lbW8ubGVuZ3RoXSA9IGVsOwogICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IGFycmF5W2ldOwogICAgICB9CiAgICAgIHJldHVybiBtZW1vOwogICAgfSwgW10pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4gKEFsaWFzZWQgYXMgImludGVyc2VjdCIgZm9yIGJhY2stY29tcGF0LikKICBfLmludGVyc2VjdGlvbiA9IF8uaW50ZXJzZWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciByZXN0ID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIF8uZmlsdGVyKF8udW5pcShhcnJheSksIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgcmV0dXJuIF8uZXZlcnkocmVzdCwgZnVuY3Rpb24ob3RoZXIpIHsKICAgICAgICByZXR1cm4gXy5pbmRleE9mKG90aGVyLCBpdGVtKSA+PSAwOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IF8uZmxhdHRlbihzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5pbmNsdWRlKHJlc3QsIHZhbHVlKTsgfSk7CiAgfTsKCiAgLy8gWmlwIHRvZ2V0aGVyIG11bHRpcGxlIGxpc3RzIGludG8gYSBzaW5nbGUgYXJyYXkgLS0gZWxlbWVudHMgdGhhdCBzaGFyZQogIC8vIGFuIGluZGV4IGdvIHRvZ2V0aGVyLgogIF8uemlwID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIHZhciBsZW5ndGggPSBfLm1heChfLnBsdWNrKGFyZ3MsICdsZW5ndGgnKSk7CiAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgcmVzdWx0c1tpXSA9IF8ucGx1Y2soYXJncywgIiIgKyBpKTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcGx5IHVzIHdpdGggaW5kZXhPZiAoSSdtIGxvb2tpbmcgYXQgeW91LCAqKk1TSUUqKiksCiAgLy8gd2UgbmVlZCB0aGlzIGZ1bmN0aW9uLiBSZXR1cm4gdGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGFuCiAgLy8gaXRlbSBpbiBhbiBhcnJheSwgb3IgLTEgaWYgdGhlIGl0ZW0gaXMgbm90IGluY2x1ZGVkIGluIHRoZSBhcnJheS4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgaW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIC8vIElmIHRoZSBhcnJheSBpcyBsYXJnZSBhbmQgYWxyZWFkeSBpbiBzb3J0IG9yZGVyLCBwYXNzIGB0cnVlYAogIC8vIGZvciAqKmlzU29ydGVkKiogdG8gdXNlIGJpbmFyeSBzZWFyY2guCiAgXy5pbmRleE9mID0gZnVuY3Rpb24oYXJyYXksIGl0ZW0sIGlzU29ydGVkKSB7CiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIC0xOwogICAgdmFyIGksIGw7CiAgICBpZiAoaXNTb3J0ZWQpIHsKICAgICAgaSA9IF8uc29ydGVkSW5kZXgoYXJyYXksIGl0ZW0pOwogICAgICByZXR1cm4gYXJyYXlbaV0gPT09IGl0ZW0gPyBpIDogLTE7CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtKTsKICAgIGZvciAoaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIGlmIChpIGluIGFycmF5ICYmIGFycmF5W2ldID09PSBpdGVtKSByZXR1cm4gaTsKICAgIHJldHVybiAtMTsKICB9OwoKICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbGFzdEluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICBfLmxhc3RJbmRleE9mID0gZnVuY3Rpb24oYXJyYXksIGl0ZW0pIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gLTE7CiAgICBpZiAobmF0aXZlTGFzdEluZGV4T2YgJiYgYXJyYXkubGFzdEluZGV4T2YgPT09IG5hdGl2ZUxhc3RJbmRleE9mKSByZXR1cm4gYXJyYXkubGFzdEluZGV4T2YoaXRlbSk7CiAgICB2YXIgaSA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIGlmIChpIGluIGFycmF5ICYmIGFycmF5W2ldID09PSBpdGVtKSByZXR1cm4gaTsKICAgIHJldHVybiAtMTsKICB9OwoKICAvLyBHZW5lcmF0ZSBhbiBpbnRlZ2VyIEFycmF5IGNvbnRhaW5pbmcgYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi4gQSBwb3J0IG9mCiAgLy8gdGhlIG5hdGl2ZSBQeXRob24gYHJhbmdlKClgIGZ1bmN0aW9uLiBTZWUKICAvLyBbdGhlIFB5dGhvbiBkb2N1bWVudGF0aW9uXShodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UpLgogIF8ucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPD0gMSkgewogICAgICBzdG9wID0gc3RhcnQgfHwgMDsKICAgICAgc3RhcnQgPSAwOwogICAgfQogICAgc3RlcCA9IGFyZ3VtZW50c1syXSB8fCAxOwoKICAgIHZhciBsZW4gPSBNYXRoLm1heChNYXRoLmNlaWwoKHN0b3AgLSBzdGFydCkgLyBzdGVwKSwgMCk7CiAgICB2YXIgaWR4ID0gMDsKICAgIHZhciByYW5nZSA9IG5ldyBBcnJheShsZW4pOwoKICAgIHdoaWxlKGlkeCA8IGxlbikgewogICAgICByYW5nZVtpZHgrK10gPSBzdGFydDsKICAgICAgc3RhcnQgKz0gc3RlcDsKICAgIH0KCiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKCiAgLy8gRnVuY3Rpb24gKGFoZW0pIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXVzYWJsZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgcHJvdG90eXBlIHNldHRpbmcuCiAgdmFyIGN0b3IgPSBmdW5jdGlvbigpe307CgogIC8vIENyZWF0ZSBhIGZ1bmN0aW9uIGJvdW5kIHRvIGEgZ2l2ZW4gb2JqZWN0IChhc3NpZ25pbmcgYHRoaXNgLCBhbmQgYXJndW1lbnRzLAogIC8vIG9wdGlvbmFsbHkpLiBCaW5kaW5nIHdpdGggYXJndW1lbnRzIGlzIGFsc28ga25vd24gYXMgYGN1cnJ5YC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgRnVuY3Rpb24uYmluZGAgaWYgYXZhaWxhYmxlLgogIC8vIFdlIGNoZWNrIGZvciBgZnVuYy5iaW5kYCBmaXJzdCwgdG8gZmFpbCBmYXN0IHdoZW4gYGZ1bmNgIGlzIHVuZGVmaW5lZC4KICBfLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGZ1bmMsIGNvbnRleHQpIHsKICAgIHZhciBib3VuZCwgYXJnczsKICAgIGlmIChmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQgJiYgbmF0aXZlQmluZCkgcmV0dXJuIG5hdGl2ZUJpbmQuYXBwbHkoZnVuYywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yOwogICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBib3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgYm91bmQpKSByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgY3Rvci5wcm90b3R5cGUgPSBmdW5jLnByb3RvdHlwZTsKICAgICAgdmFyIHNlbGYgPSBuZXcgY3RvcjsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gQmluZCBhbGwgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gVXNlZnVsIGZvciBlbnN1cmluZyB0aGF0CiAgLy8gYWxsIGNhbGxiYWNrcyBkZWZpbmVkIG9uIGFuIG9iamVjdCBiZWxvbmcgdG8gaXQuCiAgXy5iaW5kQWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgZnVuY3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICBpZiAoZnVuY3MubGVuZ3RoID09IDApIGZ1bmNzID0gXy5mdW5jdGlvbnMob2JqKTsKICAgIGVhY2goZnVuY3MsIGZ1bmN0aW9uKGYpIHsgb2JqW2ZdID0gXy5iaW5kKG9ialtmXSwgb2JqKTsgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIE1lbW9pemUgYW4gZXhwZW5zaXZlIGZ1bmN0aW9uIGJ5IHN0b3JpbmcgaXRzIHJlc3VsdHMuCiAgXy5tZW1vaXplID0gZnVuY3Rpb24oZnVuYywgaGFzaGVyKSB7CiAgICB2YXIgbWVtbyA9IHt9OwogICAgaGFzaGVyIHx8IChoYXNoZXIgPSBfLmlkZW50aXR5KTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGtleSA9IGhhc2hlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gXy5oYXMobWVtbywga2V5KSA/IG1lbW9ba2V5XSA6IChtZW1vW2tleV0gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgfTsKICB9OwoKICAvLyBEZWxheXMgYSBmdW5jdGlvbiBmb3IgdGhlIGdpdmVuIG51bWJlciBvZiBtaWxsaXNlY29uZHMsIGFuZCB0aGVuIGNhbGxzCiAgLy8gaXQgd2l0aCB0aGUgYXJndW1lbnRzIHN1cHBsaWVkLgogIF8uZGVsYXkgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHJldHVybiBmdW5jLmFwcGx5KGZ1bmMsIGFyZ3MpOyB9LCB3YWl0KTsKICB9OwoKICAvLyBEZWZlcnMgYSBmdW5jdGlvbiwgc2NoZWR1bGluZyBpdCB0byBydW4gYWZ0ZXIgdGhlIGN1cnJlbnQgY2FsbCBzdGFjayBoYXMKICAvLyBjbGVhcmVkLgogIF8uZGVmZXIgPSBmdW5jdGlvbihmdW5jKSB7CiAgICByZXR1cm4gXy5kZWxheS5hcHBseShfLCBbZnVuYywgMV0uY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpOwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiwgdGhhdCwgd2hlbiBpbnZva2VkLCB3aWxsIG9ubHkgYmUgdHJpZ2dlcmVkIGF0IG1vc3Qgb25jZQogIC8vIGR1cmluZyBhIGdpdmVuIHdpbmRvdyBvZiB0aW1lLgogIF8udGhyb3R0bGUgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICB2YXIgY29udGV4dCwgYXJncywgdGltZW91dCwgdGhyb3R0bGluZywgbW9yZTsKICAgIHZhciB3aGVuRG9uZSA9IF8uZGVib3VuY2UoZnVuY3Rpb24oKXsgbW9yZSA9IHRocm90dGxpbmcgPSBmYWxzZTsgfSwgd2FpdCk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGNvbnRleHQgPSB0aGlzOyBhcmdzID0gYXJndW1lbnRzOwogICAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBpZiAobW9yZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICB3aGVuRG9uZSgpOwogICAgICB9OwogICAgICBpZiAoIXRpbWVvdXQpIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgaWYgKHRocm90dGxpbmcpIHsKICAgICAgICBtb3JlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICB9CiAgICAgIHdoZW5Eb25lKCk7CiAgICAgIHRocm90dGxpbmcgPSB0cnVlOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLgogIF8uZGVib3VuY2UgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICB2YXIgdGltZW91dDsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOwogICAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICB9OwogICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICByZXR1cm4gbWVtbyA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgZnVuY3Rpb24gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBzZWNvbmQsCiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZAogIC8vIGNvbmRpdGlvbmFsbHkgZXhlY3V0ZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uCiAgXy53cmFwID0gZnVuY3Rpb24oZnVuYywgd3JhcHBlcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IFtmdW5jXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgcmV0dXJuIHdyYXBwZXIuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGlzIHRoZSBjb21wb3NpdGlvbiBvZiBhIGxpc3Qgb2YgZnVuY3Rpb25zLCBlYWNoCiAgLy8gY29uc3VtaW5nIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIHRoYXQgZm9sbG93cy4KICBfLmNvbXBvc2UgPSBmdW5jdGlvbigpIHsKICAgIHZhciBmdW5jcyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIGZvciAodmFyIGkgPSBmdW5jcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIGFyZ3MgPSBbZnVuY3NbaV0uYXBwbHkodGhpcywgYXJncyldOwogICAgICB9CiAgICAgIHJldHVybiBhcmdzWzBdOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgYWZ0ZXIgYmVpbmcgY2FsbGVkIE4gdGltZXMuCiAgXy5hZnRlciA9IGZ1bmN0aW9uKHRpbWVzLCBmdW5jKSB7CiAgICBpZiAodGltZXMgPD0gMCkgcmV0dXJuIGZ1bmMoKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7IHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0KICAgIH07CiAgfTsKCiAgLy8gT2JqZWN0IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gUmV0cmlldmUgdGhlIG5hbWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYE9iamVjdC5rZXlzYAogIF8ua2V5cyA9IG5hdGl2ZUtleXMgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAob2JqICE9PSBPYmplY3Qob2JqKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBvYmplY3QnKTsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSBrZXlzW2tleXMubGVuZ3RoXSA9IGtleTsKICAgIHJldHVybiBrZXlzOwogIH07CgogIC8vIFJldHJpZXZlIHRoZSB2YWx1ZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICBfLnZhbHVlcyA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ubWFwKG9iaiwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgewogICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIEZpbGwgaW4gYSBnaXZlbiBvYmplY3Qgd2l0aCBkZWZhdWx0IHByb3BlcnRpZXMuCiAgXy5kZWZhdWx0cyA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgewogICAgICAgIGlmIChvYmpbcHJvcF0gPT0gbnVsbCkgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LgogIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gb2JqOwogICAgcmV0dXJuIF8uaXNBcnJheShvYmopID8gb2JqLnNsaWNlKCkgOiBfLmV4dGVuZCh7fSwgb2JqKTsKICB9OwoKICAvLyBJbnZva2VzIGludGVyY2VwdG9yIHdpdGggdGhlIG9iaiwgYW5kIHRoZW4gcmV0dXJucyBvYmouCiAgLy8gVGhlIHByaW1hcnkgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0byAidGFwIGludG8iIGEgbWV0aG9kIGNoYWluLCBpbgogIC8vIG9yZGVyIHRvIHBlcmZvcm0gb3BlcmF0aW9ucyBvbiBpbnRlcm1lZGlhdGUgcmVzdWx0cyB3aXRoaW4gdGhlIGNoYWluLgogIF8udGFwID0gZnVuY3Rpb24ob2JqLCBpbnRlcmNlcHRvcikgewogICAgaW50ZXJjZXB0b3Iob2JqKTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gSW50ZXJuYWwgcmVjdXJzaXZlIGNvbXBhcmlzb24gZnVuY3Rpb24uCiAgZnVuY3Rpb24gZXEoYSwgYiwgc3RhY2spIHsKICAgIC8vIElkZW50aWNhbCBvYmplY3RzIGFyZSBlcXVhbC4gYDAgPT09IC0wYCwgYnV0IHRoZXkgYXJlbid0IGlkZW50aWNhbC4KICAgIC8vIFNlZSB0aGUgSGFybW9ueSBgZWdhbGAgcHJvcG9zYWw6IGh0dHA6Ly93aWtpLmVjbWFzY3JpcHQub3JnL2Rva3UucGhwP2lkPWhhcm1vbnk6ZWdhbC4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEuX2NoYWluKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiLl9jaGFpbikgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBJbnZva2UgYSBjdXN0b20gYGlzRXF1YWxgIG1ldGhvZCBpZiBvbmUgaXMgcHJvdmlkZWQuCiAgICBpZiAoYS5pc0VxdWFsICYmIF8uaXNGdW5jdGlvbihhLmlzRXF1YWwpKSByZXR1cm4gYS5pc0VxdWFsKGIpOwogICAgaWYgKGIuaXNFcXVhbCAmJiBfLmlzRnVuY3Rpb24oYi5pc0VxdWFsKSkgcmV0dXJuIGIuaXNFcXVhbChhKTsKICAgIC8vIENvbXBhcmUgYFtbQ2xhc3NdXWAgbmFtZXMuCiAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbChhKTsKICAgIGlmIChjbGFzc05hbWUgIT0gdG9TdHJpbmcuY2FsbChiKSkgcmV0dXJuIGZhbHNlOwogICAgc3dpdGNoIChjbGFzc05hbWUpIHsKICAgICAgLy8gU3RyaW5ncywgbnVtYmVycywgZGF0ZXMsIGFuZCBib29sZWFucyBhcmUgY29tcGFyZWQgYnkgdmFsdWUuCiAgICAgIGNhc2UgJ1tvYmplY3QgU3RyaW5nXSc6CiAgICAgICAgLy8gUHJpbWl0aXZlcyBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBvYmplY3Qgd3JhcHBlcnMgYXJlIGVxdWl2YWxlbnQ7IHRodXMsIGAiNSJgIGlzCiAgICAgICAgLy8gZXF1aXZhbGVudCB0byBgbmV3IFN0cmluZygiNSIpYC4KICAgICAgICByZXR1cm4gYSA9PSBTdHJpbmcoYik7CiAgICAgIGNhc2UgJ1tvYmplY3QgTnVtYmVyXSc6CiAgICAgICAgLy8gYE5hTmBzIGFyZSBlcXVpdmFsZW50LCBidXQgbm9uLXJlZmxleGl2ZS4gQW4gYGVnYWxgIGNvbXBhcmlzb24gaXMgcGVyZm9ybWVkIGZvcgogICAgICAgIC8vIG90aGVyIG51bWVyaWMgdmFsdWVzLgogICAgICAgIHJldHVybiBhICE9ICthID8gYiAhPSArYiA6IChhID09IDAgPyAxIC8gYSA9PSAxIC8gYiA6IGEgPT0gK2IpOwogICAgICBjYXNlICdbb2JqZWN0IERhdGVdJzoKICAgICAgY2FzZSAnW29iamVjdCBCb29sZWFuXSc6CiAgICAgICAgLy8gQ29lcmNlIGRhdGVzIGFuZCBib29sZWFucyB0byBudW1lcmljIHByaW1pdGl2ZSB2YWx1ZXMuIERhdGVzIGFyZSBjb21wYXJlZCBieSB0aGVpcgogICAgICAgIC8vIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9ucy4gTm90ZSB0aGF0IGludmFsaWQgZGF0ZXMgd2l0aCBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMKICAgICAgICAvLyBvZiBgTmFOYCBhcmUgbm90IGVxdWl2YWxlbnQuCiAgICAgICAgcmV0dXJuICthID09ICtiOwogICAgICAvLyBSZWdFeHBzIGFyZSBjb21wYXJlZCBieSB0aGVpciBzb3VyY2UgcGF0dGVybnMgYW5kIGZsYWdzLgogICAgICBjYXNlICdbb2JqZWN0IFJlZ0V4cF0nOgogICAgICAgIHJldHVybiBhLnNvdXJjZSA9PSBiLnNvdXJjZSAmJgogICAgICAgICAgICAgICBhLmdsb2JhbCA9PSBiLmdsb2JhbCAmJgogICAgICAgICAgICAgICBhLm11bHRpbGluZSA9PSBiLm11bHRpbGluZSAmJgogICAgICAgICAgICAgICBhLmlnbm9yZUNhc2UgPT0gYi5pZ25vcmVDYXNlOwogICAgfQogICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7CiAgICAvLyBBc3N1bWUgZXF1YWxpdHkgZm9yIGN5Y2xpYyBzdHJ1Y3R1cmVzLiBUaGUgYWxnb3JpdGhtIGZvciBkZXRlY3RpbmcgY3ljbGljCiAgICAvLyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjEgc2VjdGlvbiAxNS4xMi4zLCBhYnN0cmFjdCBvcGVyYXRpb24gYEpPYC4KICAgIHZhciBsZW5ndGggPSBzdGFjay5sZW5ndGg7CiAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgLy8gTGluZWFyIHNlYXJjaC4gUGVyZm9ybWFuY2UgaXMgaW52ZXJzZWx5IHByb3BvcnRpb25hbCB0byB0aGUgbnVtYmVyIG9mCiAgICAgIC8vIHVuaXF1ZSBuZXN0ZWQgc3RydWN0dXJlcy4KICAgICAgaWYgKHN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvLyBBZGQgdGhlIGZpcnN0IG9iamVjdCB0byB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBzdGFjay5wdXNoKGEpOwogICAgdmFyIHNpemUgPSAwLCByZXN1bHQgPSB0cnVlOwogICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMuCiAgICBpZiAoY2xhc3NOYW1lID09ICdbb2JqZWN0IEFycmF5XScpIHsKICAgICAgLy8gQ29tcGFyZSBhcnJheSBsZW5ndGhzIHRvIGRldGVybWluZSBpZiBhIGRlZXAgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnkuCiAgICAgIHNpemUgPSBhLmxlbmd0aDsKICAgICAgcmVzdWx0ID0gc2l6ZSA9PSBiLmxlbmd0aDsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIC8vIERlZXAgY29tcGFyZSB0aGUgY29udGVudHMsIGlnbm9yaW5nIG5vbi1udW1lcmljIHByb3BlcnRpZXMuCiAgICAgICAgd2hpbGUgKHNpemUtLSkgewogICAgICAgICAgLy8gRW5zdXJlIGNvbW11dGF0aXZlIGVxdWFsaXR5IGZvciBzcGFyc2UgYXJyYXlzLgogICAgICAgICAgaWYgKCEocmVzdWx0ID0gc2l6ZSBpbiBhID09IHNpemUgaW4gYiAmJiBlcShhW3NpemVdLCBiW3NpemVdLCBzdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudC4KICAgICAgaWYgKCdjb25zdHJ1Y3RvcicgaW4gYSAhPSAnY29uc3RydWN0b3InIGluIGIgfHwgYS5jb25zdHJ1Y3RvciAhPSBiLmNvbnN0cnVjdG9yKSByZXR1cm4gZmFsc2U7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBzdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBzdGFjay5wb3AoKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvLyBQZXJmb3JtIGEgZGVlcCBjb21wYXJpc29uIHRvIGNoZWNrIGlmIHR3byBvYmplY3RzIGFyZSBlcXVhbC4KICBfLmlzRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gZXEoYSwgYiwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKF8uaXNBcnJheShvYmopIHx8IF8uaXNTdHJpbmcob2JqKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgRE9NIGVsZW1lbnQ/CiAgXy5pc0VsZW1lbnQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLm5vZGVUeXBlID09IDEpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/CiAgLy8gRGVsZWdhdGVzIHRvIEVDTUE1J3MgbmF0aXZlIEFycmF5LmlzQXJyYXkKICBfLmlzQXJyYXkgPSBuYXRpdmVJc0FycmF5IHx8IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBBcnJheV0nOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgYW4gb2JqZWN0PwogIF8uaXNPYmplY3QgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IE9iamVjdChvYmopOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgYW4gYXJndW1lbnRzIG9iamVjdD8KICBfLmlzQXJndW1lbnRzID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFyZ3VtZW50c10nOwogIH07CiAgaWYgKCFfLmlzQXJndW1lbnRzKGFyZ3VtZW50cykpIHsKICAgIF8uaXNBcmd1bWVudHMgPSBmdW5jdGlvbihvYmopIHsKICAgICAgcmV0dXJuICEhKG9iaiAmJiBfLmhhcyhvYmosICdjYWxsZWUnKSk7CiAgICB9OwogIH0KCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGZ1bmN0aW9uPwogIF8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBGdW5jdGlvbl0nOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBzdHJpbmc/CiAgXy5pc1N0cmluZyA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBTdHJpbmddJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgbnVtYmVyPwogIF8uaXNOdW1iZXIgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgTnVtYmVyXSc7CiAgfTsKCiAgLy8gSXMgdGhlIGdpdmVuIHZhbHVlIGBOYU5gPwogIF8uaXNOYU4gPSBmdW5jdGlvbihvYmopIHsKICAgIC8vIGBOYU5gIGlzIHRoZSBvbmx5IHZhbHVlIGZvciB3aGljaCBgPT09YCBpcyBub3QgcmVmbGV4aXZlLgogICAgcmV0dXJuIG9iaiAhPT0gb2JqOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBib29sZWFuPwogIF8uaXNCb29sZWFuID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSB0cnVlIHx8IG9iaiA9PT0gZmFsc2UgfHwgdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEJvb2xlYW5dJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgZGF0ZT8KICBfLmlzRGF0ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBEYXRlXSc7CiAgfTsKCiAgLy8gSXMgdGhlIGdpdmVuIHZhbHVlIGEgcmVndWxhciBleHByZXNzaW9uPwogIF8uaXNSZWdFeHAgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgUmVnRXhwXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBIYXMgb3duIHByb3BlcnR5PwogIF8uaGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICAvLyBVdGlsaXR5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJ1biBVbmRlcnNjb3JlLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBfYCB2YXJpYWJsZSB0byBpdHMKICAvLyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuCiAgXy5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290Ll8gPSBwcmV2aW91c1VuZGVyc2NvcmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBLZWVwIHRoZSBpZGVudGl0eSBmdW5jdGlvbiBhcm91bmQgZm9yIGRlZmF1bHQgaXRlcmF0b3JzLgogIF8uaWRlbnRpdHkgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH07CgogIC8vIFJ1biBhIGZ1bmN0aW9uICoqbioqIHRpbWVzLgogIF8udGltZXMgPSBmdW5jdGlvbiAobiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIGkpOwogIH07CgogIC8vIEVzY2FwZSBhIHN0cmluZyBmb3IgSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZXNjYXBlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICByZXR1cm4gKCcnK3N0cmluZykucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpLnJlcGxhY2UoLyIvZywgJyZxdW90OycpLnJlcGxhY2UoLycvZywgJyYjeDI3OycpLnJlcGxhY2UoL1wvL2csJyYjeDJGOycpOwogIH07CgogIC8vIEFkZCB5b3VyIG93biBjdXN0b20gZnVuY3Rpb25zIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdCwgZW5zdXJpbmcgdGhhdAogIC8vIHRoZXkncmUgY29ycmVjdGx5IGFkZGVkIHRvIHRoZSBPT1Agd3JhcHBlciBhcyB3ZWxsLgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSl7CiAgICAgIGFkZFRvV3JhcHBlcihuYW1lLCBfW25hbWVdID0gb2JqW25hbWVdKTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSBpZENvdW50ZXIrKzsKICAgIHJldHVybiBwcmVmaXggPyBwcmVmaXggKyBpZCA6IGlkOwogIH07CgogIC8vIEJ5IGRlZmF1bHQsIFVuZGVyc2NvcmUgdXNlcyBFUkItc3R5bGUgdGVtcGxhdGUgZGVsaW1pdGVycywgY2hhbmdlIHRoZQogIC8vIGZvbGxvd2luZyB0ZW1wbGF0ZSBzZXR0aW5ncyB0byB1c2UgYWx0ZXJuYXRpdmUgZGVsaW1pdGVycy4KICBfLnRlbXBsYXRlU2V0dGluZ3MgPSB7CiAgICBldmFsdWF0ZSAgICA6IC88JShbXHNcU10rPyklPi9nLAogICAgaW50ZXJwb2xhdGUgOiAvPCU9KFtcc1xTXSs/KSU+L2csCiAgICBlc2NhcGUgICAgICA6IC88JS0oW1xzXFNdKz8pJT4vZwogIH07CgogIC8vIFdoZW4gY3VzdG9taXppbmcgYHRlbXBsYXRlU2V0dGluZ3NgLCBpZiB5b3UgZG9uJ3Qgd2FudCB0byBkZWZpbmUgYW4KICAvLyBpbnRlcnBvbGF0aW9uLCBldmFsdWF0aW9uIG9yIGVzY2FwaW5nIHJlZ2V4LCB3ZSBuZWVkIG9uZSB0aGF0IGlzCiAgLy8gZ3VhcmFudGVlZCBub3QgdG8gbWF0Y2guCiAgdmFyIG5vTWF0Y2ggPSAvLl4vOwoKICAvLyBXaXRoaW4gYW4gaW50ZXJwb2xhdGlvbiwgZXZhbHVhdGlvbiwgb3IgZXNjYXBpbmcsIHJlbW92ZSBIVE1MIGVzY2FwaW5nCiAgLy8gdGhhdCBoYWQgYmVlbiBwcmV2aW91c2x5IGFkZGVkLgogIHZhciB1bmVzY2FwZSA9IGZ1bmN0aW9uKGNvZGUpIHsKICAgIHJldHVybiBjb2RlLnJlcGxhY2UoL1xcXFwvZywgJ1xcJykucmVwbGFjZSgvXFwnL2csICInIik7CiAgfTsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHN0ciwgZGF0YSkgewogICAgdmFyIGMgID0gXy50ZW1wbGF0ZVNldHRpbmdzOwogICAgdmFyIHRtcGwgPSAndmFyIF9fcD1bXSxwcmludD1mdW5jdGlvbigpe19fcC5wdXNoLmFwcGx5KF9fcCxhcmd1bWVudHMpO307JyArCiAgICAgICd3aXRoKG9ianx8e30pe19fcC5wdXNoKFwnJyArCiAgICAgIHN0ci5yZXBsYWNlKC9cXC9nLCAnXFxcXCcpCiAgICAgICAgIC5yZXBsYWNlKC8nL2csICJcXCciKQogICAgICAgICAucmVwbGFjZShjLmVzY2FwZSB8fCBub01hdGNoLCBmdW5jdGlvbihtYXRjaCwgY29kZSkgewogICAgICAgICAgIHJldHVybiAiJyxfLmVzY2FwZSgiICsgdW5lc2NhcGUoY29kZSkgKyAiKSwnIjsKICAgICAgICAgfSkKICAgICAgICAgLnJlcGxhY2UoYy5pbnRlcnBvbGF0ZSB8fCBub01hdGNoLCBmdW5jdGlvbihtYXRjaCwgY29kZSkgewogICAgICAgICAgIHJldHVybiAiJywiICsgdW5lc2NhcGUoY29kZSkgKyAiLCciOwogICAgICAgICB9KQogICAgICAgICAucmVwbGFjZShjLmV2YWx1YXRlIHx8IG5vTWF0Y2gsIGZ1bmN0aW9uKG1hdGNoLCBjb2RlKSB7CiAgICAgICAgICAgcmV0dXJuICInKTsiICsgdW5lc2NhcGUoY29kZSkucmVwbGFjZSgvW1xyXG5cdF0vZywgJyAnKSArICI7X19wLnB1c2goJyI7CiAgICAgICAgIH0pCiAgICAgICAgIC5yZXBsYWNlKC9cci9nLCAnXFxyJykKICAgICAgICAgLnJlcGxhY2UoL1xuL2csICdcXG4nKQogICAgICAgICAucmVwbGFjZSgvXHQvZywgJ1xcdCcpCiAgICAgICAgICsgIicpO31yZXR1cm4gX19wLmpvaW4oJycpOyI7CiAgICB2YXIgZnVuYyA9IG5ldyBGdW5jdGlvbignb2JqJywgJ18nLCB0bXBsKTsKICAgIGlmIChkYXRhKSByZXR1cm4gZnVuYyhkYXRhLCBfKTsKICAgIHJldHVybiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpcywgZGF0YSwgXyk7CiAgICB9OwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIFRoZSBPT1AgV3JhcHBlcgogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBJZiBVbmRlcnNjb3JlIGlzIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLCBpdCByZXR1cm5zIGEgd3JhcHBlZCBvYmplY3QgdGhhdAogIC8vIGNhbiBiZSB1c2VkIE9PLXN0eWxlLiBUaGlzIHdyYXBwZXIgaG9sZHMgYWx0ZXJlZCB2ZXJzaW9ucyBvZiBhbGwgdGhlCiAgLy8gdW5kZXJzY29yZSBmdW5jdGlvbnMuIFdyYXBwZWQgb2JqZWN0cyBtYXkgYmUgY2hhaW5lZC4KICB2YXIgd3JhcHBlciA9IGZ1bmN0aW9uKG9iaikgeyB0aGlzLl93cmFwcGVkID0gb2JqOyB9OwoKICAvLyBFeHBvc2UgYHdyYXBwZXIucHJvdG90eXBlYCBhcyBgXy5wcm90b3R5cGVgCiAgXy5wcm90b3R5cGUgPSB3cmFwcGVyLnByb3RvdHlwZTsKCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnRpbnVlIGNoYWluaW5nIGludGVybWVkaWF0ZSByZXN1bHRzLgogIHZhciByZXN1bHQgPSBmdW5jdGlvbihvYmosIGNoYWluKSB7CiAgICByZXR1cm4gY2hhaW4gPyBfKG9iaikuY2hhaW4oKSA6IG9iajsKICB9OwoKICAvLyBBIG1ldGhvZCB0byBlYXNpbHkgYWRkIGZ1bmN0aW9ucyB0byB0aGUgT09QIHdyYXBwZXIuCiAgdmFyIGFkZFRvV3JhcHBlciA9IGZ1bmN0aW9uKG5hbWUsIGZ1bmMpIHsKICAgIHdyYXBwZXIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICB1bnNoaWZ0LmNhbGwoYXJncywgdGhpcy5fd3JhcHBlZCk7CiAgICAgIHJldHVybiByZXN1bHQoZnVuYy5hcHBseShfLCBhcmdzKSwgdGhpcy5fY2hhaW4pOwogICAgfTsKICB9OwoKICAvLyBBZGQgYWxsIG9mIHRoZSBVbmRlcnNjb3JlIGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlciBvYmplY3QuCiAgXy5taXhpbihfKTsKCiAgLy8gQWRkIGFsbCBtdXRhdG9yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBlYWNoKFsncG9wJywgJ3B1c2gnLCAncmV2ZXJzZScsICdzaGlmdCcsICdzb3J0JywgJ3NwbGljZScsICd1bnNoaWZ0J10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIHZhciBtZXRob2QgPSBBcnJheVByb3RvW25hbWVdOwogICAgd3JhcHBlci5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHdyYXBwZWQgPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkod3JhcHBlZCwgYXJndW1lbnRzKTsKICAgICAgdmFyIGxlbmd0aCA9IHdyYXBwZWQubGVuZ3RoOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBsZW5ndGggPT09IDApIGRlbGV0ZSB3cmFwcGVkWzBdOwogICAgICByZXR1cm4gcmVzdWx0KHdyYXBwZWQsIHRoaXMuX2NoYWluKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIHdyYXBwZXIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQobWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsIGFyZ3VtZW50cyksIHRoaXMuX2NoYWluKTsKICAgIH07CiAgfSk7CgogIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICB3cmFwcGVyLnByb3RvdHlwZS5jaGFpbiA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgd3JhcHBlci5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogIH07Cgp9KS5jYWxsKHRoaXMpOwo=", "content_type": "application/javascript"}, "assets/css/index.css": {"data": "QGltcG9ydCAic3R5bGUuY3NzIjsK", "content_type": "text/css"}, "test/jasmine/spec/example.js": {"data": "ZGVzY3JpYmUoIm9uZSB0YXV0b2xvZ3kiLCBmdW5jdGlvbigpIHsKICBpdCgiaXMgYSB0YXV0b2xvZ3kiLCBmdW5jdGlvbigpIHsKICAgIGV4cGVjdCh0cnVlKS50b0JlVHJ1dGh5KCk7CiAgfSk7CgogIGRlc2NyaWJlKCJpcyBhd2Vzb21lIiwgZnVuY3Rpb24oKSB7CiAgICBpdCgiaXMgYXdlc29tZSIsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoMSkudG9CZSgxKTsKICAgIH0pOwogIH0pOwp9KTsKCmRlc2NyaWJlKCJzaW1wbGUgdGVzdHMiLCBmdW5jdGlvbigpIHsKICBpdCgiaW5jcmVtZW50cyIsIGZ1bmN0aW9uKCkgewogICAgdmFyIG1pa2UgPSAwOwoKICAgIGV4cGVjdChtaWtlKysgPT09IDApLnRvQmVUcnV0aHkoKTsKICAgIGV4cGVjdChtaWtlID09PSAxKS50b0JlVHJ1dGh5KCk7CiAgfSk7CgogIGl0KCJpbmNyZW1lbnRzIChpbXByb3ZlZCkiLCBmdW5jdGlvbigpIHsKICAgIHZhciBtaWtlID0gMDsKCiAgICBleHBlY3QobWlrZSsrKS50b0JlKDApOwogICAgZXhwZWN0KG1pa2UpLnRvQmUoMSk7CiAgfSk7Cn0pOwoKZGVzY3JpYmUoInNldFVwL3RlYXJEb3duIiwgZnVuY3Rpb24oKSB7CiAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUubG9nKCJCZWZvcmUiKTsKICB9KTsKCiAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5sb2coIkFmdGVyIik7CiAgfSk7CgogIGl0KCJleGFtcGxlIiwgZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmxvZygiRHVyaW5nIik7CiAgfSk7CgogIGRlc2NyaWJlKCJzZXRVcC90ZWFyRG93biIsIGZ1bmN0aW9uKCkgewogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgY29uc29sZS5sb2coIkJlZm9yZTIiKTsKICAgIH0pOwoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgY29uc29sZS5sb2coIkFmdGVyMiIpOwogICAgfSk7CgogICAgaXQoImV4YW1wbGUiLCBmdW5jdGlvbigpIHsKICAgICAgY29uc29sZS5sb2coIkR1cmluZyBOZXN0ZWQiKTsKICAgIH0pOwogIH0pOwp9KTsKCmRlc2NyaWJlKCJhc3luYyIsIGZ1bmN0aW9uKCkgewogIGl0KCJtdWx0aXBsZSBhc3luYyIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHNlbWFwaG9yZSA9IDI7CgogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KHRydWUpLnRvQmVUcnV0aHkoKTsKICAgICAgc2VtYXBob3JlLS07CiAgICB9LCA1MDApOwoKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdCh0cnVlKS50b0JlVHJ1dGh5KCk7CiAgICAgIHNlbWFwaG9yZS0tOwogICAgfSwgNTAwKTsKCiAgICB3YWl0c0ZvcihmdW5jdGlvbigpIHsgcmV0dXJuIHNlbWFwaG9yZSA9PT0gMCB9KTsKICB9KTsKfSk7Cg==", "content_type": "application/javascript"}, "index.html": {"data": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9ZWRnZSxjaHJvbWU9MSI+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiPgoKICA8dGl0bGU+VG9kb01WQyB3aXRoIEJhY2tib25lIEJvaWxlcnBsYXRlPC90aXRsZT4KCiAgPCEtLSBBcHBsaWNhdGlvbiBzdHlsZXMgLS0+CjwhLS0gICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImFzc2V0cy9jc3MvdG9kb3MuY3NzIj4gLS0+CiAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJhc3NldHMvY3NzL2luZGV4LmNzcyI+CjwvaGVhZD4KCjxib2R5PgogIDwhLS0gTWFpbiBjb250YWluZXIgLS0+CiAgPGRpdiByb2xlPSJtYWluIiBpZD0ibWFpbiI+PC9kaXY+CgogIDwhLS0gQXBwbGljYXRpb24gc291cmNlIC0tPgogIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBjaGFyc2V0PSJ1dGYtOCIgc3JjPSJhc3NldHMvanMvbGlicy9jb3Jkb3ZhLTIuMC4wLmpzIj48L3NjcmlwdD4KICA8IS0tIDxzY3JpcHQgc3JjPSJodHRwOi8vMTkyLjE2OC4xNi4xMTA6ODA4MS90YXJnZXQvdGFyZ2V0LXNjcmlwdC1taW4uanMjYW5vbnltb3VzIj48L3NjcmlwdD4gIC0tPgogIDxzY3JpcHQgZGF0YS1tYWluPSJhcHAvY29uZmlnLmpzIiBzcmM9ImFzc2V0cy9qcy9saWJzL3JlcXVpcmUuanMiPjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K", "content_type": "text/html"}, "test/jasmine/vendor/MIT.LICENSE": {"data": "Q29weXJpZ2h0IChjKSAyMDA4LTIwMTEgUGl2b3RhbCBMYWJzCgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcKYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlCiJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLApkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8KcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCnRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlCmluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCkVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgpNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORApOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFCkxJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04KT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OCldJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgo=", "content_type": ""}, "assets/js/libs/backbone-couchdb.js": {"data": "LyoKKGMpIDIwMTEgSmFuIE1vbnNjaGtlCnYxLjEKYmFja2JvbmUtY291Y2hkYi5qcyBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiovCihmdW5jdGlvbigpIHsKICB2YXIgY29uLAogICAgX19oYXNQcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3I7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07CiAgQmFja2JvbmUuY291Y2hfY29ubmVjdG9yID0gY29uID0gewogICAgY29uZmlnOiB7CiAgICAgIGRiX25hbWU6ICJiYWNrYm9uZV9jb25uZWN0IiwKICAgICAgZGRvY19uYW1lOiAiYmFja2JvbmVfZXhhbXBsZSIsCiAgICAgIHZpZXdfbmFtZTogImJ5Q29sbGVjdGlvbiIsCiAgICAgIGxpc3RfbmFtZTogbnVsbCwKICAgICAgZ2xvYmFsX2NoYW5nZXM6IGZhbHNlLAogICAgICBiYXNlX3VybDogbnVsbAogICAgfSwKICAgIGhlbHBlcnM6IHsKICAgICAgZXh0cmFjdF9jb2xsZWN0aW9uX25hbWU6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgdmFyIF9uYW1lLCBfc3BsaXR0ZWQ7CiAgICAgICAgaWYgKG1vZGVsID09IG51bGwpIHRocm93IG5ldyBFcnJvcigiTm8gbW9kZWwgaGFzIGJlZW4gcGFzc2VkIik7CiAgICAgICAgaWYgKCEoKChtb2RlbC5jb2xsZWN0aW9uICE9IG51bGwpICYmIChtb2RlbC5jb2xsZWN0aW9uLnVybCAhPSBudWxsKSkgfHwgKG1vZGVsLnVybCAhPSBudWxsKSkpIHsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICAgICAgaWYgKG1vZGVsLnVybCAhPSBudWxsKSB7CiAgICAgICAgICBfbmFtZSA9IF8uaXNGdW5jdGlvbihtb2RlbC51cmwpID8gbW9kZWwudXJsKCkgOiBtb2RlbC51cmw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9uYW1lID0gXy5pc0Z1bmN0aW9uKG1vZGVsLmNvbGxlY3Rpb24udXJsKSA/IG1vZGVsLmNvbGxlY3Rpb24udXJsKCkgOiBtb2RlbC5jb2xsZWN0aW9uLnVybDsKICAgICAgICB9CiAgICAgICAgaWYgKF9uYW1lWzBdID09PSAiLyIpIF9uYW1lID0gX25hbWUuc2xpY2UoMSwgX25hbWUubGVuZ3RoKTsKICAgICAgICBfc3BsaXR0ZWQgPSBfbmFtZS5zcGxpdCgiLyIpOwogICAgICAgIF9uYW1lID0gX3NwbGl0dGVkLmxlbmd0aCA+IDAgPyBfc3BsaXR0ZWRbMF0gOiBfbmFtZTsKICAgICAgICBfbmFtZSA9IF9uYW1lLnJlcGxhY2UoIi8iLCAiIik7CiAgICAgICAgcmV0dXJuIF9uYW1lOwogICAgICB9LAogICAgICBtYWtlX2RiOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGI7CiAgICAgICAgZGIgPSAkLmNvdWNoLmRiKGNvbi5jb25maWcuZGJfbmFtZSk7CiAgICAgICAgaWYgKGNvbi5jb25maWcuYmFzZV91cmwgIT0gbnVsbCkgewogICAgICAgICAgZGIudXJpID0gIiIgKyBjb24uY29uZmlnLmJhc2VfdXJsICsgIi8iICsgY29uLmNvbmZpZy5kYl9uYW1lICsgIi8iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGI7CiAgICAgIH0KICAgIH0sCiAgICByZWFkOiBmdW5jdGlvbihtb2RlbCwgb3B0cykgewogICAgICBpZiAobW9kZWwubW9kZWxzKSB7CiAgICAgICAgcmV0dXJuIGNvbi5yZWFkX2NvbGxlY3Rpb24obW9kZWwsIG9wdHMpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjb24ucmVhZF9tb2RlbChtb2RlbCwgb3B0cyk7CiAgICAgIH0KICAgIH0sCiAgICByZWFkX2NvbGxlY3Rpb246IGZ1bmN0aW9uKGNvbGwsIG9wdHMpIHsKICAgICAgdmFyIGtleXMsIF9vcHRzLCBfdmlldywgX2Rkb2MsIF9saXN0CiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICBfdmlldyA9IHRoaXMuY29uZmlnLnZpZXdfbmFtZTsKICAgICAgX2Rkb2MgPSB0aGlzLmNvbmZpZy5kZG9jX25hbWU7CiAgICAgIF9saXN0ID0gdGhpcy5jb25maWcubGlzdF9uYW1lOwogICAgICBrZXlzID0gW3RoaXMuaGVscGVycy5leHRyYWN0X2NvbGxlY3Rpb25fbmFtZShjb2xsKV07CiAgICAgIGlmIChjb2xsLmRiICE9IG51bGwpIHsKICAgICAgICBpZiAoY29sbC5kYi5jaGFuZ2VzIHx8IHRoaXMuY29uZmlnLmdsb2JhbF9jaGFuZ2VzKSB7CiAgICAgICAgICBjb2xsLmxpc3Rlbl90b19jaGFuZ2VzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChjb2xsLmRiLnZpZXcgIT0gbnVsbCkgX3ZpZXcgPSBjb2xsLmRiLnZpZXc7CiAgICAgICAgaWYgKGNvbGwuZGIuZGRvYyAhPSBudWxsKSBfZGRvYyA9IGNvbGwuZGIuZGRvYzsKICAgICAgICBpZiAoY29sbC5kYi5rZXlzICE9IG51bGwpIGtleXMgPSBjb2xsLmRiLmtleXM7CiAgICAgICAgaWYgKGNvbGwuZGIubGlzdCAhPSBudWxsKSBfbGlzdCA9IGNvbGwuZGIubGlzdDsKICAgICAgfQogICAgICBfb3B0cyA9IHsKICAgICAgICBrZXlzOiBrZXlzLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHZhciBkb2MsIF9pLCBfbGVuLCBfcmVmLCBfdGVtcDsKICAgICAgICAgIF90ZW1wID0gW107CiAgICAgICAgICBfcmVmID0gZGF0YS5yb3dzOwogICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAgIGRvYyA9IF9yZWZbX2ldOwogICAgICAgICAgICAoZG9jLnZhbHVlKSA/IF90ZW1wLnB1c2goZG9jLnZhbHVlKSA6IF90ZW1wLnB1c2goZG9jLmRvYyk7CiAgICAgICAgICB9CiAgICAgICAgICBvcHRzLnN1Y2Nlc3MoX3RlbXApOwogICAgICAgICAgcmV0dXJuIG9wdHMuY29tcGxldGUoKTsKICAgICAgICB9LAogICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgIG9wdHMuZXJyb3IoKTsKICAgICAgICAgIHJldHVybiBvcHRzLmNvbXBsZXRlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBpZiAob3B0cy5saW1pdCAhPSBudWxsKSBfb3B0cy5saW1pdCA9IG9wdHMubGltaXQ7CiAgICAgIGlmIChvcHRzLnNraXAgIT0gbnVsbCkgX29wdHMuc2tpcCA9IG9wdHMuc2tpcDsKICAgICAgaWYgKG9wdHMuaW5jbHVkZV9kb2NzICE9IG51bGwpIF9vcHRzLmluY2x1ZGVfZG9jcyA9IG9wdHMuaW5jbHVkZV9kb2NzOwogICAgICBpZiAob3B0cy5zdGFydGtleSAhPSBudWxsKSBfb3B0cy5zdGFydGtleSA9IG9wdHMuc3RhcnRrZXk7CiAgICAgIGlmIChvcHRzLmVuZGtleSAhPSBudWxsKSBfb3B0cy5lbmRrZXkgPSBvcHRzLmVuZGtleTsKICAgICAgaWYgKG9wdHMuc3RhcnRrZXlfZG9jaWQgIT0gbnVsbCkgX29wdHMuc3RhcnRrZXlfZG9jaWQgPSBvcHRzLnN0YXJ0a2V5X2RvY2lkOwogICAgICBpZiAob3B0cy5lbmRrZXlfZG9jaWQgIT0gbnVsbCkgX29wdHMuZW5ka2V5X2RvY2lkID0gb3B0cy5lbmRrZXlfZG9jaWQ7CiAgICAgIGlmIChvcHRzLmRhdGFUeXBlICE9IG51bGwpIF9vcHRzLmRhdGFUeXBlID0gb3B0cy5kYXRhVHlwZTsKICAgICAgaWYgKChjb2xsLmRiICE9IG51bGwpICYmIChjb2xsLmRiLnZpZXcgIT0gbnVsbCkgJiYgIShjb2xsLmRiLmtleXMgIT0gbnVsbCkpIHsKICAgICAgICBkZWxldGUgX29wdHMua2V5czsKICAgICAgfQogICAgICBpZiAoX2xpc3QgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0aGlzLmhlbHBlcnMubWFrZV9kYigpLmxpc3QoIiIgKyBfZGRvYyArICIvIiArIF9saXN0LCAiIiArIF92aWV3LCBfb3B0cyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGVscGVycy5tYWtlX2RiKCkudmlldygiIiArIF9kZG9jICsgIi8iICsgX3ZpZXcsIF9vcHRzKTsKICAgICAgfQogICAgfSwKICAgIHJlYWRfbW9kZWw6IGZ1bmN0aW9uKG1vZGVsLCBvcHRzKSB7CiAgICAgIGlmICghbW9kZWwuaWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBtb2RlbCBoYXMgbm8gaWQgcHJvcGVydHksIHNvIGl0IGNhbid0IGdldCBmZXRjaGVkIGZyb20gdGhlIGRhdGFiYXNlIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuaGVscGVycy5tYWtlX2RiKCkub3BlbkRvYyhtb2RlbC5pZCwgewogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRvYykgewogICAgICAgICAgb3B0cy5zdWNjZXNzKGRvYyk7CiAgICAgICAgICByZXR1cm4gb3B0cy5jb21wbGV0ZSgpOwogICAgICAgIH0sCiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgewogICAgICAgICAgb3B0cy5lcnJvcigpOwogICAgICAgICAgcmV0dXJuIG9wdHMuY29tcGxldGUoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNyZWF0ZTogZnVuY3Rpb24obW9kZWwsIG9wdHMpIHsKICAgICAgdmFyIGNvbGwsIHZhbHM7CiAgICAgIHZhbHMgPSBtb2RlbC50b0pTT04oKTsKICAgICAgY29sbCA9IHRoaXMuaGVscGVycy5leHRyYWN0X2NvbGxlY3Rpb25fbmFtZShtb2RlbCk7CiAgICAgIGlmIChjb2xsLmxlbmd0aCA+IDApIHZhbHMuY29sbGVjdGlvbiA9IGNvbGw7CiAgICAgIHJldHVybiB0aGlzLmhlbHBlcnMubWFrZV9kYigpLnNhdmVEb2ModmFscywgewogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRvYykgewogICAgICAgICAgb3B0cy5zdWNjZXNzKHsKICAgICAgICAgICAgX2lkOiBkb2MuaWQsCiAgICAgICAgICAgIF9yZXY6IGRvYy5yZXYKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIG9wdHMuY29tcGxldGUoKTsKICAgICAgICB9LAogICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgIG9wdHMuZXJyb3IoKTsKICAgICAgICAgIHJldHVybiBvcHRzLmNvbXBsZXRlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRzKSB7CiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZShtb2RlbCwgb3B0cyk7CiAgICB9LAogICAgZGVsOiBmdW5jdGlvbihtb2RlbCwgb3B0cykgewogICAgICByZXR1cm4gdGhpcy5oZWxwZXJzLm1ha2VfZGIoKS5yZW1vdmVEb2MobW9kZWwudG9KU09OKCksIHsKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBvcHRzLnN1Y2Nlc3MoKTsKICAgICAgICB9LAogICAgICAgIGVycm9yOiBmdW5jdGlvbihuciwgcmVxLCBlKSB7CiAgICAgICAgICBpZiAoZSA9PT0gImRlbGV0ZWQiKSB7CiAgICAgICAgICAgIG9wdHMuc3VjY2VzcygpOwogICAgICAgICAgICByZXR1cm4gb3B0cy5jb21wbGV0ZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3B0cy5lcnJvcigpOwogICAgICAgICAgICByZXR1cm4gb3B0cy5jb21wbGV0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgQmFja2JvbmUuc3luYyA9IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdHMpIHsKICAgIGlmIChvcHRzLnN1Y2Nlc3MgPT0gbnVsbCkgb3B0cy5zdWNjZXNzID0gZnVuY3Rpb24oKSB7fTsKICAgIGlmIChvcHRzLmVycm9yID09IG51bGwpIG9wdHMuZXJyb3IgPSBmdW5jdGlvbigpIHt9OwogICAgaWYgKG9wdHMuY29tcGxldGUgPT0gbnVsbCkgb3B0cy5jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge307CiAgICBzd2l0Y2ggKG1ldGhvZCkgewogICAgICBjYXNlICJyZWFkIjoKICAgICAgICByZXR1cm4gY29uLnJlYWQobW9kZWwsIG9wdHMpOwogICAgICBjYXNlICJjcmVhdGUiOgogICAgICAgIHJldHVybiBjb24uY3JlYXRlKG1vZGVsLCBvcHRzKTsKICAgICAgY2FzZSAidXBkYXRlIjoKICAgICAgICByZXR1cm4gY29uLnVwZGF0ZShtb2RlbCwgb3B0cyk7CiAgICAgIGNhc2UgImRlbGV0ZSI6CiAgICAgICAgcmV0dXJuIGNvbi5kZWwobW9kZWwsIG9wdHMpOwogICAgfQogIH07CgogIEJhY2tib25lLk1vZGVsID0gKGZ1bmN0aW9uKF9zdXBlcikgewoKICAgIF9fZXh0ZW5kcyhNb2RlbCwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBNb2RlbCgpIHsKICAgICAgTW9kZWwuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgTW9kZWwucHJvdG90eXBlLmlkQXR0cmlidXRlID0gIl9pZCI7CgogICAgTW9kZWwucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBuZXdfbW9kZWw7CiAgICAgIG5ld19tb2RlbCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMpOwogICAgICBpZiAobmV3X21vZGVsLmF0dHJpYnV0ZXMuX2lkKSBkZWxldGUgbmV3X21vZGVsLmF0dHJpYnV0ZXMuX2lkOwogICAgICBpZiAobmV3X21vZGVsLmF0dHJpYnV0ZXMuX3JldikgZGVsZXRlIG5ld19tb2RlbC5hdHRyaWJ1dGVzLl9yZXY7CiAgICAgIHJldHVybiBuZXdfbW9kZWw7CiAgICB9OwoKICAgIHJldHVybiBNb2RlbDsKCiAgfSkoQmFja2JvbmUuTW9kZWwpOwoKICBCYWNrYm9uZS5Db2xsZWN0aW9uID0gKGZ1bmN0aW9uKF9zdXBlcikgewoKICAgIF9fZXh0ZW5kcyhDb2xsZWN0aW9uLCBfc3VwZXIpOwoKICAgIGZ1bmN0aW9uIENvbGxlY3Rpb24oKSB7CiAgICAgIHRoaXMuX2RiX29uX2NoYW5nZSA9IF9fYmluZCh0aGlzLl9kYl9vbl9jaGFuZ2UsIHRoaXMpOwogICAgICB0aGlzLl9kYl9wcmVwYXJlZF9mb3JfY2hhbmdlcyA9IF9fYmluZCh0aGlzLl9kYl9wcmVwYXJlZF9mb3JfY2hhbmdlcywgdGhpcyk7CiAgICAgIENvbGxlY3Rpb24uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgQ29sbGVjdGlvbi5wcm90b3R5cGUubW9kZWwgPSBCYWNrYm9uZS5Nb2RlbDsKCiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghdGhpcy5fZGJfY2hhbmdlc19lbmFibGVkICYmICgodGhpcy5kYiAmJiB0aGlzLmRiLmNoYW5nZXMpIHx8IGNvbi5jb25maWcuZ2xvYmFsX2NoYW5nZXMpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuX3RvX2NoYW5nZXMoKTsKICAgICAgfQogICAgfTsKCiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5saXN0ZW5fdG9fY2hhbmdlcyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuX2RiX2NoYW5nZXNfZW5hYmxlZCkgewogICAgICAgIHRoaXMuX2RiX2NoYW5nZXNfZW5hYmxlZCA9IHRydWU7CiAgICAgICAgaWYgKCF0aGlzLl9kYl9pbnN0KSB0aGlzLl9kYl9pbnN0ID0gY29uLmhlbHBlcnMubWFrZV9kYigpOwogICAgICAgIHJldHVybiB0aGlzLl9kYl9pbnN0LmluZm8oewogICAgICAgICAgInN1Y2Nlc3MiOiB0aGlzLl9kYl9wcmVwYXJlZF9mb3JfY2hhbmdlcwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLnN0b3BfY2hhbmdlcyA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9kYl9jaGFuZ2VzX2VuYWJsZWQgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuX2RiX2NoYW5nZXNfaGFuZGxlciAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5fZGJfY2hhbmdlc19oYW5kbGVyLnN0b3AoKTsKICAgICAgICByZXR1cm4gdGhpcy5fZGJfY2hhbmdlc19oYW5kbGVyID0gbnVsbDsKICAgICAgfQogICAgfTsKCiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5fZGJfcHJlcGFyZWRfZm9yX2NoYW5nZXMgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBvcHRzLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5fZGJfdXBkYXRlX3NlcSA9IGRhdGEudXBkYXRlX3NlcSB8fCAwOwogICAgICBvcHRzID0gewogICAgICAgIGluY2x1ZGVfZG9jczogdHJ1ZSwKICAgICAgICBjb2xsZWN0aW9uOiBjb24uaGVscGVycy5leHRyYWN0X2NvbGxlY3Rpb25fbmFtZSh0aGlzKSwKICAgICAgICBmaWx0ZXI6ICIiICsgY29uLmNvbmZpZy5kZG9jX25hbWUgKyAiL2J5X2NvbGxlY3Rpb24iCiAgICAgIH07CiAgICAgIF8uZXh0ZW5kKG9wdHMsIHRoaXMuZGIpOwogICAgICByZXR1cm4gXy5kZWZlcihmdW5jdGlvbigpIHsKICAgICAgICBfdGhpcy5fZGJfY2hhbmdlc19oYW5kbGVyID0gX3RoaXMuX2RiX2luc3QuY2hhbmdlcyhfdGhpcy5fZGJfdXBkYXRlX3NlcSwgb3B0cyk7CiAgICAgICAgcmV0dXJuIF90aGlzLl9kYl9jaGFuZ2VzX2hhbmRsZXIub25DaGFuZ2UoX3RoaXMuX2RiX29uX2NoYW5nZSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5fZGJfb25fY2hhbmdlID0gZnVuY3Rpb24oY2hhbmdlcykgewogICAgICB2YXIgb2JqLCBfZG9jLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIF9yZWYgPSBjaGFuZ2VzLnJlc3VsdHM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIF9kb2MgPSBfcmVmW19pXTsKICAgICAgICBvYmogPSB0aGlzLmdldChfZG9jLmlkKTsKICAgICAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgICAgIGlmIChfZG9jLmRlbGV0ZWQpIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLnJlbW92ZShvYmopKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChvYmouZ2V0KCJfcmV2IikgIT09IF9kb2MuZG9jLl9yZXYpIHsKICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG9iai5zZXQoX2RvYy5kb2MpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCFfZG9jLmRlbGV0ZWQpIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLmFkZChfZG9jLmRvYykpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIHJldHVybiBDb2xsZWN0aW9uOwoKICB9KShCYWNrYm9uZS5Db2xsZWN0aW9uKTsKCn0pLmNhbGwodGhpcyk7Cg==", "content_type": "application/javascript"}, "test/jasmine/vendor/jasmine_favicon.png": {"data": "iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAuBJREFUOMulkktIVGEYht//nP+cGU9z8zgXS6JUtMjxkpeMMosi0loEQS2E7gRF0KZNixbRphsVBQUtoiKiC0VR0T0No9IaLZkyR8dyxjKdGtMZz+jonP9vURNSuIie1fvB9718N4JfTE63T1+/qWZ3e1uH5/69uotabGQQAAyylDK/omzFtKzMAgKu64mx+NUrt09qseEIxpPvzq187WvU2j69jR07se9Gbs60IomK0tZt6/Z6PzRFggNd/NNggF+/c9Frs5qcyTqaFIXFBfPSnE4jlSRhzYZ1K6dnZ2Xfunr99radO7bbXelmxhhEUYTf19EWjWr9fxmMxkc1zhnhADhjKKuY786YmuE2WyzgnIMQgthQNPH0ybMHOuOJZJ2QFLWP66/V3rlfLxACQggAQDGZwcEBAJwzNDe+7HjV4KkbP7qYFLHYSLT93fu3s4vzl9lU1cYwhveRJ/gYbYJFdiIW1kApNRSVFJamWk2uYKDbPzwS134bOB3q1IoF5cuLSormyZJkYVRHJNGLltBDWI0OZLoKoTochty8WZmVSxYuHY1pcsMLzyNqMilqVfXimrWb124pLCvJNxhTCGMMBAQZJA85qT2YYprxcwwAeiIB2WDEkuqlVefPXjoqzikrWL5rz66DxXPLs4hICeccgiCA6ToEXUK2vRQyU9D/NcRlg0wopRAEAmWSYvU2NbeKfX3fAm88zR6HXc1yuZzpnDES6u0d+ODzRWypqsmQooBSimBnZ+j4/iMHGp83NLW2eN+1tnhb/O2dbSS5gzTV6spzzyxXlBSl62Ow010wq/LwqWOHqCQTQRDQ5feHVlWtrvzyJeQbf4XffxDuH+yrr2+8mYzNFrNNGxqK29Q0IwiBruucAAR/IGACgoHu9s+B7h6RUuiJMdTefXAvHP4e+DOPTmTwLTzQ42l49VK1p9kunD535vzZy0fio2PD+BdKS/IXV1cv2kjIxJ3+Nz8AZ9spJvY2PKEAAAAASUVORK5CYII=", "content_type": "image/png"}, "assets/css/destroy.png": {"data": "iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAc1JREFUeNrMVsFKw0AQTWIR+gdCrwUFQZSEgv5CQRAEwYPgKfdCC4JHvRTsR3gTAoLQn5AEvSgKxZwEv6EQ0jdlLJtld5OYFfrgHTqbebubmcyrG8exo8AGeAyegtvgPsdfwU8wAp/ATE5sKcRI4B7sKdZ85jn4DF7wBit4UsIAfNGIyejxswOd4Bi8A9tOdbQ5ZywLnoFD5+8YssZScJN3aYob0vK4kh3VE77vV4oxuqRFgn2TmCigiknou+jDD26VyqdJkkQnmNIJt3SrqkSDGKHjOXYxJ8Ef3WrNohC+STApE6Nrilc1iCYkODW9P1FIFZMwpSpTY79xHzVBCu7QCefgtYWCXP0WhfAAThqITVijMG1GfNJ5nTbhnJFqfNH0vQX3eHiWgZ454JzMNLFpAh+BJzw4ujylHW6xlK/3qLSAMAx1J8iEhEy65uq37Enr5ylBENj3FIja9xSILj3FxYdOn96XzgZqYAbuGj2FNqwYK/cUIdEtiRU8xROaVkYuCbmaNRGHRk/RJObr4yk1i2L2FMU7yyuI6j1FEMhLYgVP8fjf6MxCUWisRVY9BaPMnqdA7H88paXwlMgwYGVPucTJ3ssmdiNPWQgwAJAGndsKbcIpAAAAAElFTkSuQmCC", "content_type": "image/png"}, "test/qunit/vendor/qunit.js": {"data": "LyoqCiAqIFFVbml0IDEuMi4wcHJlIC0gQSBKYXZhU2NyaXB0IFVuaXQgVGVzdGluZyBGcmFtZXdvcmsKICoKICogaHR0cDovL2RvY3MuanF1ZXJ5LmNvbS9RVW5pdAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTEgSm9obiBSZXNpZywgSsO2cm4gWmFlZmZlcmVyCiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCAoTUlULUxJQ0VOU0UudHh0KQogKiBvciBHUEwgKEdQTC1MSUNFTlNFLnR4dCkgbGljZW5zZXMuCiAqIFB1bGxlZCBMaXZlIGZyb20gR2l0IE1vbiBPY3QgMzEgMTQ6MDA6MDIgVVRDIDIwMTEKICogTGFzdCBDb21taXQ6IGVlMTU2OTIzY2RiMDE4MjBlMzVlNmJiNTc5ZDVjZjZiZjU1NzM2ZDQKICovCgooZnVuY3Rpb24od2luZG93KSB7Cgp2YXIgZGVmaW5lZCA9IHsKCXNldFRpbWVvdXQ6IHR5cGVvZiB3aW5kb3cuc2V0VGltZW91dCAhPT0gInVuZGVmaW5lZCIsCglzZXNzaW9uU3RvcmFnZTogKGZ1bmN0aW9uKCkgewoJCXRyeSB7CgkJCXJldHVybiAhIXNlc3Npb25TdG9yYWdlLmdldEl0ZW07CgkJfSBjYXRjaChlKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9KSgpCn07Cgp2YXIJdGVzdElkID0gMCwKCXRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCWhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7Cgp2YXIgVGVzdCA9IGZ1bmN0aW9uKG5hbWUsIHRlc3ROYW1lLCBleHBlY3RlZCwgdGVzdEVudmlyb25tZW50QXJnLCBhc3luYywgY2FsbGJhY2spIHsKCXRoaXMubmFtZSA9IG5hbWU7Cgl0aGlzLnRlc3ROYW1lID0gdGVzdE5hbWU7Cgl0aGlzLmV4cGVjdGVkID0gZXhwZWN0ZWQ7Cgl0aGlzLnRlc3RFbnZpcm9ubWVudEFyZyA9IHRlc3RFbnZpcm9ubWVudEFyZzsKCXRoaXMuYXN5bmMgPSBhc3luYzsKCXRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKCXRoaXMuYXNzZXJ0aW9ucyA9IFtdOwp9OwpUZXN0LnByb3RvdHlwZSA9IHsKCWluaXQ6IGZ1bmN0aW9uKCkgewoJCXZhciB0ZXN0cyA9IGlkKCJxdW5pdC10ZXN0cyIpOwoJCWlmICh0ZXN0cykgewoJCQl2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIpOwoJCQkJYi5pbm5lckhUTUwgPSAiUnVubmluZyAiICsgdGhpcy5uYW1lOwoJCQl2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOwoJCQkJbGkuYXBwZW5kQ2hpbGQoIGIgKTsKCQkJCWxpLmNsYXNzTmFtZSA9ICJydW5uaW5nIjsKCQkJCWxpLmlkID0gdGhpcy5pZCA9ICJ0ZXN0LW91dHB1dCIgKyB0ZXN0SWQrKzsKCQkJdGVzdHMuYXBwZW5kQ2hpbGQoIGxpICk7CgkJfQoJfSwKCXNldHVwOiBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5tb2R1bGUgIT0gY29uZmlnLnByZXZpb3VzTW9kdWxlKSB7CgkJCWlmICggY29uZmlnLnByZXZpb3VzTW9kdWxlICkgewoJCQkJcnVuTG9nZ2luZ0NhbGxiYWNrcygnbW9kdWxlRG9uZScsIFFVbml0LCB7CgkJCQkJbmFtZTogY29uZmlnLnByZXZpb3VzTW9kdWxlLAoJCQkJCWZhaWxlZDogY29uZmlnLm1vZHVsZVN0YXRzLmJhZCwKCQkJCQlwYXNzZWQ6IGNvbmZpZy5tb2R1bGVTdGF0cy5hbGwgLSBjb25maWcubW9kdWxlU3RhdHMuYmFkLAoJCQkJCXRvdGFsOiBjb25maWcubW9kdWxlU3RhdHMuYWxsCgkJCQl9ICk7CgkJCX0KCQkJY29uZmlnLnByZXZpb3VzTW9kdWxlID0gdGhpcy5tb2R1bGU7CgkJCWNvbmZpZy5tb2R1bGVTdGF0cyA9IHsgYWxsOiAwLCBiYWQ6IDAgfTsKCQkJcnVuTG9nZ2luZ0NhbGxiYWNrcyggJ21vZHVsZVN0YXJ0JywgUVVuaXQsIHsKCQkJCW5hbWU6IHRoaXMubW9kdWxlCgkJCX0gKTsKCQl9CgoJCWNvbmZpZy5jdXJyZW50ID0gdGhpczsKCQl0aGlzLnRlc3RFbnZpcm9ubWVudCA9IGV4dGVuZCh7CgkJCXNldHVwOiBmdW5jdGlvbigpIHt9LAoJCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7fQoJCX0sIHRoaXMubW9kdWxlVGVzdEVudmlyb25tZW50KTsKCQlpZiAodGhpcy50ZXN0RW52aXJvbm1lbnRBcmcpIHsKCQkJZXh0ZW5kKHRoaXMudGVzdEVudmlyb25tZW50LCB0aGlzLnRlc3RFbnZpcm9ubWVudEFyZyk7CgkJfQoKCQlydW5Mb2dnaW5nQ2FsbGJhY2tzKCAndGVzdFN0YXJ0JywgUVVuaXQsIHsKCQkJbmFtZTogdGhpcy50ZXN0TmFtZSwKCQkJbW9kdWxlOiB0aGlzLm1vZHVsZQoJCX0pOwoKCQkvLyBhbGxvdyB1dGlsaXR5IGZ1bmN0aW9ucyB0byBhY2Nlc3MgdGhlIGN1cnJlbnQgdGVzdCBlbnZpcm9ubWVudAoJCS8vIFRPRE8gd2h5Pz8KCQlRVW5pdC5jdXJyZW50X3Rlc3RFbnZpcm9ubWVudCA9IHRoaXMudGVzdEVudmlyb25tZW50OwoKCQl0cnkgewoJCQlpZiAoICFjb25maWcucG9sbHV0aW9uICkgewoJCQkJc2F2ZUdsb2JhbCgpOwoJCQl9CgoJCQl0aGlzLnRlc3RFbnZpcm9ubWVudC5zZXR1cC5jYWxsKHRoaXMudGVzdEVudmlyb25tZW50KTsKCQl9IGNhdGNoKGUpIHsKCQkJUVVuaXQub2soIGZhbHNlLCAiU2V0dXAgZmFpbGVkIG9uICIgKyB0aGlzLnRlc3ROYW1lICsgIjogIiArIGUubWVzc2FnZSApOwoJCX0KCX0sCglydW46IGZ1bmN0aW9uKCkgewoJCWNvbmZpZy5jdXJyZW50ID0gdGhpczsKCQlpZiAoIHRoaXMuYXN5bmMgKSB7CgkJCVFVbml0LnN0b3AoKTsKCQl9CgoJCWlmICggY29uZmlnLm5vdHJ5Y2F0Y2ggKSB7CgkJCXRoaXMuY2FsbGJhY2suY2FsbCh0aGlzLnRlc3RFbnZpcm9ubWVudCk7CgkJCXJldHVybjsKCQl9CgkJdHJ5IHsKCQkJdGhpcy5jYWxsYmFjay5jYWxsKHRoaXMudGVzdEVudmlyb25tZW50KTsKCQl9IGNhdGNoKGUpIHsKCQkJZmFpbCgiVGVzdCAiICsgdGhpcy50ZXN0TmFtZSArICIgZGllZCwgZXhjZXB0aW9uIGFuZCB0ZXN0IGZvbGxvd3MiLCBlLCB0aGlzLmNhbGxiYWNrKTsKCQkJUVVuaXQub2soIGZhbHNlLCAiRGllZCBvbiB0ZXN0ICMiICsgKHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGggKyAxKSArICI6ICIgKyBlLm1lc3NhZ2UgKyAiIC0gIiArIFFVbml0LmpzRHVtcC5wYXJzZShlKSApOwoJCQkvLyBlbHNlIG5leHQgdGVzdCB3aWxsIGNhcnJ5IHRoZSByZXNwb25zaWJpbGl0eQoJCQlzYXZlR2xvYmFsKCk7CgoJCQkvLyBSZXN0YXJ0IHRoZSB0ZXN0cyBpZiB0aGV5J3JlIGJsb2NraW5nCgkJCWlmICggY29uZmlnLmJsb2NraW5nICkgewoJCQkJUVVuaXQuc3RhcnQoKTsKCQkJfQoJCX0KCX0sCgl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJY29uZmlnLmN1cnJlbnQgPSB0aGlzOwoJCXRyeSB7CgkJCXRoaXMudGVzdEVudmlyb25tZW50LnRlYXJkb3duLmNhbGwodGhpcy50ZXN0RW52aXJvbm1lbnQpOwoJCQljaGVja1BvbGx1dGlvbigpOwoJCX0gY2F0Y2goZSkgewoJCQlRVW5pdC5vayggZmFsc2UsICJUZWFyZG93biBmYWlsZWQgb24gIiArIHRoaXMudGVzdE5hbWUgKyAiOiAiICsgZS5tZXNzYWdlICk7CgkJfQoJfSwKCWZpbmlzaDogZnVuY3Rpb24oKSB7CgkJY29uZmlnLmN1cnJlbnQgPSB0aGlzOwoJCWlmICggdGhpcy5leHBlY3RlZCAhPSBudWxsICYmIHRoaXMuZXhwZWN0ZWQgIT0gdGhpcy5hc3NlcnRpb25zLmxlbmd0aCApIHsKCQkJUVVuaXQub2soIGZhbHNlLCAiRXhwZWN0ZWQgIiArIHRoaXMuZXhwZWN0ZWQgKyAiIGFzc2VydGlvbnMsIGJ1dCAiICsgdGhpcy5hc3NlcnRpb25zLmxlbmd0aCArICIgd2VyZSBydW4iICk7CgkJfQoKCQl2YXIgZ29vZCA9IDAsIGJhZCA9IDAsCgkJCXRlc3RzID0gaWQoInF1bml0LXRlc3RzIik7CgoJCWNvbmZpZy5zdGF0cy5hbGwgKz0gdGhpcy5hc3NlcnRpb25zLmxlbmd0aDsKCQljb25maWcubW9kdWxlU3RhdHMuYWxsICs9IHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGg7CgoJCWlmICggdGVzdHMgKSB7CgkJCXZhciBvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9sIik7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLmFzc2VydGlvbnMubGVuZ3RoOyBpKysgKSB7CgkJCQl2YXIgYXNzZXJ0aW9uID0gdGhpcy5hc3NlcnRpb25zW2ldOwoKCQkJCXZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7CgkJCQlsaS5jbGFzc05hbWUgPSBhc3NlcnRpb24ucmVzdWx0ID8gInBhc3MiIDogImZhaWwiOwoJCQkJbGkuaW5uZXJIVE1MID0gYXNzZXJ0aW9uLm1lc3NhZ2UgfHwgKGFzc2VydGlvbi5yZXN1bHQgPyAib2theSIgOiAiZmFpbGVkIik7CgkJCQlvbC5hcHBlbmRDaGlsZCggbGkgKTsKCgkJCQlpZiAoIGFzc2VydGlvbi5yZXN1bHQgKSB7CgkJCQkJZ29vZCsrOwoJCQkJfSBlbHNlIHsKCQkJCQliYWQrKzsKCQkJCQljb25maWcuc3RhdHMuYmFkKys7CgkJCQkJY29uZmlnLm1vZHVsZVN0YXRzLmJhZCsrOwoJCQkJfQoJCQl9CgoJCQkvLyBzdG9yZSByZXN1bHQgd2hlbiBwb3NzaWJsZQoJCQlpZiAoIFFVbml0LmNvbmZpZy5yZW9yZGVyICYmIGRlZmluZWQuc2Vzc2lvblN0b3JhZ2UgKSB7CgkJCQlpZiAoYmFkKSB7CgkJCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgicXVuaXQtIiArIHRoaXMubW9kdWxlICsgIi0iICsgdGhpcy50ZXN0TmFtZSwgYmFkKTsKCQkJCX0gZWxzZSB7CgkJCQkJc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgicXVuaXQtIiArIHRoaXMubW9kdWxlICsgIi0iICsgdGhpcy50ZXN0TmFtZSk7CgkJCQl9CgkJCX0KCgkJCWlmIChiYWQgPT0gMCkgewoJCQkJb2wuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfQoKCQkJdmFyIGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHJvbmciKTsKCQkJYi5pbm5lckhUTUwgPSB0aGlzLm5hbWUgKyAiIDxiIGNsYXNzPSdjb3VudHMnPig8YiBjbGFzcz0nZmFpbGVkJz4iICsgYmFkICsgIjwvYj4sIDxiIGNsYXNzPSdwYXNzZWQnPiIgKyBnb29kICsgIjwvYj4sICIgKyB0aGlzLmFzc2VydGlvbnMubGVuZ3RoICsgIik8L2I+IjsKCgkJCXZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwoJCQlhLmlubmVySFRNTCA9ICJSZXJ1biI7CgkJCWEuaHJlZiA9IFFVbml0LnVybCh7IGZpbHRlcjogZ2V0VGV4dChbYl0pLnJlcGxhY2UoL1woW14pXStcKSQvLCAiIikucmVwbGFjZSgvKF5ccyp8XHMqJCkvZywgIiIpIH0pOwoKCQkJYWRkRXZlbnQoYiwgImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkJCQl2YXIgbmV4dCA9IGIubmV4dFNpYmxpbmcubmV4dFNpYmxpbmcsCgkJCQkJZGlzcGxheSA9IG5leHQuc3R5bGUuZGlzcGxheTsKCQkJCW5leHQuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXkgPT09ICJub25lIiA/ICJibG9jayIgOiAibm9uZSI7CgkJCX0pOwoKCQkJYWRkRXZlbnQoYiwgImRibGNsaWNrIiwgZnVuY3Rpb24oZSkgewoJCQkJdmFyIHRhcmdldCA9IGUgJiYgZS50YXJnZXQgPyBlLnRhcmdldCA6IHdpbmRvdy5ldmVudC5zcmNFbGVtZW50OwoJCQkJaWYgKCB0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSAic3BhbiIgfHwgdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImIiICkgewoJCQkJCXRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwoJCQkJfQoJCQkJaWYgKCB3aW5kb3cubG9jYXRpb24gJiYgdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzdHJvbmciICkgewoJCQkJCXdpbmRvdy5sb2NhdGlvbiA9IFFVbml0LnVybCh7IGZpbHRlcjogZ2V0VGV4dChbdGFyZ2V0XSkucmVwbGFjZSgvXChbXildK1wpJC8sICIiKS5yZXBsYWNlKC8oXlxzKnxccyokKS9nLCAiIikgfSk7CgkJCQl9CgkJCX0pOwoKCQkJdmFyIGxpID0gaWQodGhpcy5pZCk7CgkJCWxpLmNsYXNzTmFtZSA9IGJhZCA/ICJmYWlsIiA6ICJwYXNzIjsKCQkJbGkucmVtb3ZlQ2hpbGQoIGxpLmZpcnN0Q2hpbGQgKTsKCQkJbGkuYXBwZW5kQ2hpbGQoIGIgKTsKCQkJbGkuYXBwZW5kQ2hpbGQoIGEgKTsKCQkJbGkuYXBwZW5kQ2hpbGQoIG9sICk7CgoJCX0gZWxzZSB7CgkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGg7IGkrKyApIHsKCQkJCWlmICggIXRoaXMuYXNzZXJ0aW9uc1tpXS5yZXN1bHQgKSB7CgkJCQkJYmFkKys7CgkJCQkJY29uZmlnLnN0YXRzLmJhZCsrOwoJCQkJCWNvbmZpZy5tb2R1bGVTdGF0cy5iYWQrKzsKCQkJCX0KCQkJfQoJCX0KCgkJdHJ5IHsKCQkJUVVuaXQucmVzZXQoKTsKCQl9IGNhdGNoKGUpIHsKCQkJZmFpbCgicmVzZXQoKSBmYWlsZWQsIGZvbGxvd2luZyBUZXN0ICIgKyB0aGlzLnRlc3ROYW1lICsgIiwgZXhjZXB0aW9uIGFuZCByZXNldCBmbiBmb2xsb3dzIiwgZSwgUVVuaXQucmVzZXQpOwoJCX0KCgkJcnVuTG9nZ2luZ0NhbGxiYWNrcyggJ3Rlc3REb25lJywgUVVuaXQsIHsKCQkJbmFtZTogdGhpcy50ZXN0TmFtZSwKCQkJbW9kdWxlOiB0aGlzLm1vZHVsZSwKCQkJZmFpbGVkOiBiYWQsCgkJCXBhc3NlZDogdGhpcy5hc3NlcnRpb25zLmxlbmd0aCAtIGJhZCwKCQkJdG90YWw6IHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGgKCQl9ICk7Cgl9LAoKCXF1ZXVlOiBmdW5jdGlvbigpIHsKCQl2YXIgdGVzdCA9IHRoaXM7CgkJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJCXRlc3QuaW5pdCgpOwoJCX0pOwoJCWZ1bmN0aW9uIHJ1bigpIHsKCQkJLy8gZWFjaCBvZiB0aGVzZSBjYW4gYnkgYXN5bmMKCQkJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJCQl0ZXN0LnNldHVwKCk7CgkJCX0pOwoJCQlzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQkJCXRlc3QucnVuKCk7CgkJCX0pOwoJCQlzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQkJCXRlc3QudGVhcmRvd24oKTsKCQkJfSk7CgkJCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCQkJdGVzdC5maW5pc2goKTsKCQkJfSk7CgkJfQoJCS8vIGRlZmVyIHdoZW4gcHJldmlvdXMgdGVzdCBydW4gcGFzc2VkLCBpZiBzdG9yYWdlIGlzIGF2YWlsYWJsZQoJCXZhciBiYWQgPSBRVW5pdC5jb25maWcucmVvcmRlciAmJiBkZWZpbmVkLnNlc3Npb25TdG9yYWdlICYmICtzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJxdW5pdC0iICsgdGhpcy5tb2R1bGUgKyAiLSIgKyB0aGlzLnRlc3ROYW1lKTsKCQlpZiAoYmFkKSB7CgkJCXJ1bigpOwoJCX0gZWxzZSB7CgkJCXN5bmNocm9uaXplKHJ1biwgdHJ1ZSk7CgkJfTsKCX0KCn07Cgp2YXIgUVVuaXQgPSB7CgoJLy8gY2FsbCBvbiBzdGFydCBvZiBtb2R1bGUgdGVzdCB0byBwcmVwZW5kIG5hbWUgdG8gYWxsIHRlc3RzCgltb2R1bGU6IGZ1bmN0aW9uKG5hbWUsIHRlc3RFbnZpcm9ubWVudCkgewoJCWNvbmZpZy5jdXJyZW50TW9kdWxlID0gbmFtZTsKCQljb25maWcuY3VycmVudE1vZHVsZVRlc3RFbnZpcm9tZW50ID0gdGVzdEVudmlyb25tZW50OwoJfSwKCglhc3luY1Rlc3Q6IGZ1bmN0aW9uKHRlc3ROYW1lLCBleHBlY3RlZCwgY2FsbGJhY2spIHsKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDIgKSB7CgkJCWNhbGxiYWNrID0gZXhwZWN0ZWQ7CgkJCWV4cGVjdGVkID0gbnVsbDsKCQl9CgoJCVFVbml0LnRlc3QodGVzdE5hbWUsIGV4cGVjdGVkLCBjYWxsYmFjaywgdHJ1ZSk7Cgl9LAoKCXRlc3Q6IGZ1bmN0aW9uKHRlc3ROYW1lLCBleHBlY3RlZCwgY2FsbGJhY2ssIGFzeW5jKSB7CgkJdmFyIG5hbWUgPSAnPHNwYW4gY2xhc3M9InRlc3QtbmFtZSI+JyArIHRlc3ROYW1lICsgJzwvc3Bhbj4nLCB0ZXN0RW52aXJvbm1lbnRBcmc7CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMiApIHsKCQkJY2FsbGJhY2sgPSBleHBlY3RlZDsKCQkJZXhwZWN0ZWQgPSBudWxsOwoJCX0KCQkvLyBpcyAybmQgYXJndW1lbnQgYSB0ZXN0RW52aXJvbm1lbnQ/CgkJaWYgKCBleHBlY3RlZCAmJiB0eXBlb2YgZXhwZWN0ZWQgPT09ICdvYmplY3QnKSB7CgkJCXRlc3RFbnZpcm9ubWVudEFyZyA9IGV4cGVjdGVkOwoJCQlleHBlY3RlZCA9IG51bGw7CgkJfQoKCQlpZiAoIGNvbmZpZy5jdXJyZW50TW9kdWxlICkgewoJCQluYW1lID0gJzxzcGFuIGNsYXNzPSJtb2R1bGUtbmFtZSI+JyArIGNvbmZpZy5jdXJyZW50TW9kdWxlICsgIjwvc3Bhbj46ICIgKyBuYW1lOwoJCX0KCgkJaWYgKCAhdmFsaWRUZXN0KGNvbmZpZy5jdXJyZW50TW9kdWxlICsgIjogIiArIHRlc3ROYW1lKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHRlc3QgPSBuZXcgVGVzdChuYW1lLCB0ZXN0TmFtZSwgZXhwZWN0ZWQsIHRlc3RFbnZpcm9ubWVudEFyZywgYXN5bmMsIGNhbGxiYWNrKTsKCQl0ZXN0Lm1vZHVsZSA9IGNvbmZpZy5jdXJyZW50TW9kdWxlOwoJCXRlc3QubW9kdWxlVGVzdEVudmlyb25tZW50ID0gY29uZmlnLmN1cnJlbnRNb2R1bGVUZXN0RW52aXJvbWVudDsKCQl0ZXN0LnF1ZXVlKCk7Cgl9LAoKCS8qKgoJICogU3BlY2lmeSB0aGUgbnVtYmVyIG9mIGV4cGVjdGVkIGFzc2VydGlvbnMgdG8gZ3VyYW50ZWUgdGhhdCBmYWlsZWQgdGVzdCAobm8gYXNzZXJ0aW9ucyBhcmUgcnVuIGF0IGFsbCkgZG9uJ3Qgc2xpcCB0aHJvdWdoLgoJICovCglleHBlY3Q6IGZ1bmN0aW9uKGFzc2VydHMpIHsKCQljb25maWcuY3VycmVudC5leHBlY3RlZCA9IGFzc2VydHM7Cgl9LAoKCS8qKgoJICogQXNzZXJ0cyB0cnVlLgoJICogQGV4YW1wbGUgb2soICJhc2RmYXNkZiIubGVuZ3RoID4gNSwgIlRoZXJlIG11c3QgYmUgYXQgbGVhc3QgNSBjaGFycyIgKTsKCSAqLwoJb2s6IGZ1bmN0aW9uKGEsIG1zZykgewoJCWEgPSAhIWE7CgkJdmFyIGRldGFpbHMgPSB7CgkJCXJlc3VsdDogYSwKCQkJbWVzc2FnZTogbXNnCgkJfTsKCQltc2cgPSBlc2NhcGVJbm5lclRleHQobXNnKTsKCQlydW5Mb2dnaW5nQ2FsbGJhY2tzKCAnbG9nJywgUVVuaXQsIGRldGFpbHMgKTsKCQljb25maWcuY3VycmVudC5hc3NlcnRpb25zLnB1c2goewoJCQlyZXN1bHQ6IGEsCgkJCW1lc3NhZ2U6IG1zZwoJCX0pOwoJfSwKCgkvKioKCSAqIENoZWNrcyB0aGF0IHRoZSBmaXJzdCB0d28gYXJndW1lbnRzIGFyZSBlcXVhbCwgd2l0aCBhbiBvcHRpb25hbCBtZXNzYWdlLgoJICogUHJpbnRzIG91dCBib3RoIGFjdHVhbCBhbmQgZXhwZWN0ZWQgdmFsdWVzLgoJICoKCSAqIFByZWZlcmVkIHRvIG9rKCBhY3R1YWwgPT0gZXhwZWN0ZWQsIG1lc3NhZ2UgKQoJICoKCSAqIEBleGFtcGxlIGVxdWFsKCBmb3JtYXQoIlJlY2VpdmVkIHswfSBieXRlcy4iLCAyKSwgIlJlY2VpdmVkIDIgYnl0ZXMuIiApOwoJICoKCSAqIEBwYXJhbSBPYmplY3QgYWN0dWFsCgkgKiBAcGFyYW0gT2JqZWN0IGV4cGVjdGVkCgkgKiBAcGFyYW0gU3RyaW5nIG1lc3NhZ2UgKG9wdGlvbmFsKQoJICovCgllcXVhbDogZnVuY3Rpb24oYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJCVFVbml0LnB1c2goZXhwZWN0ZWQgPT0gYWN0dWFsLCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKTsKCX0sCgoJbm90RXF1YWw6IGZ1bmN0aW9uKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHsKCQlRVW5pdC5wdXNoKGV4cGVjdGVkICE9IGFjdHVhbCwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSk7Cgl9LAoKCWRlZXBFcXVhbDogZnVuY3Rpb24oYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJCVFVbml0LnB1c2goUVVuaXQuZXF1aXYoYWN0dWFsLCBleHBlY3RlZCksIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpOwoJfSwKCglub3REZWVwRXF1YWw6IGZ1bmN0aW9uKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHsKCQlRVW5pdC5wdXNoKCFRVW5pdC5lcXVpdihhY3R1YWwsIGV4cGVjdGVkKSwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSk7Cgl9LAoKCXN0cmljdEVxdWFsOiBmdW5jdGlvbihhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7CgkJUVVuaXQucHVzaChleHBlY3RlZCA9PT0gYWN0dWFsLCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKTsKCX0sCgoJbm90U3RyaWN0RXF1YWw6IGZ1bmN0aW9uKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHsKCQlRVW5pdC5wdXNoKGV4cGVjdGVkICE9PSBhY3R1YWwsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpOwoJfSwKCglyYWlzZXM6IGZ1bmN0aW9uKGJsb2NrLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJCXZhciBhY3R1YWwsIG9rID0gZmFsc2U7CgoJCWlmICh0eXBlb2YgZXhwZWN0ZWQgPT09ICdzdHJpbmcnKSB7CgkJCW1lc3NhZ2UgPSBleHBlY3RlZDsKCQkJZXhwZWN0ZWQgPSBudWxsOwoJCX0KCgkJdHJ5IHsKCQkJYmxvY2soKTsKCQl9IGNhdGNoIChlKSB7CgkJCWFjdHVhbCA9IGU7CgkJfQoKCQlpZiAoYWN0dWFsKSB7CgkJCS8vIHdlIGRvbid0IHdhbnQgdG8gdmFsaWRhdGUgdGhyb3duIGVycm9yCgkJCWlmICghZXhwZWN0ZWQpIHsKCQkJCW9rID0gdHJ1ZTsKCQkJLy8gZXhwZWN0ZWQgaXMgYSByZWdleHAKCQkJfSBlbHNlIGlmIChRVW5pdC5vYmplY3RUeXBlKGV4cGVjdGVkKSA9PT0gInJlZ2V4cCIpIHsKCQkJCW9rID0gZXhwZWN0ZWQudGVzdChhY3R1YWwpOwoJCQkvLyBleHBlY3RlZCBpcyBhIGNvbnN0cnVjdG9yCgkJCX0gZWxzZSBpZiAoYWN0dWFsIGluc3RhbmNlb2YgZXhwZWN0ZWQpIHsKCQkJCW9rID0gdHJ1ZTsKCQkJLy8gZXhwZWN0ZWQgaXMgYSB2YWxpZGF0aW9uIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdHJ1ZSBpcyB2YWxpZGF0aW9uIHBhc3NlZAoJCQl9IGVsc2UgaWYgKGV4cGVjdGVkLmNhbGwoe30sIGFjdHVhbCkgPT09IHRydWUpIHsKCQkJCW9rID0gdHJ1ZTsKCQkJfQoJCX0KCgkJUVVuaXQub2sob2ssIG1lc3NhZ2UpOwoJfSwKCglzdGFydDogZnVuY3Rpb24oY291bnQpIHsKCQljb25maWcuc2VtYXBob3JlIC09IGNvdW50IHx8IDE7CgkJaWYgKGNvbmZpZy5zZW1hcGhvcmUgPiAwKSB7CgkJCS8vIGRvbid0IHN0YXJ0IHVudGlsIGVxdWFsIG51bWJlciBvZiBzdG9wLWNhbGxzCgkJCXJldHVybjsKCQl9CgkJaWYgKGNvbmZpZy5zZW1hcGhvcmUgPCAwKSB7CgkJCS8vIGlnbm9yZSBpZiBzdGFydCBpcyBjYWxsZWQgbW9yZSBvZnRlbiB0aGVuIHN0b3AKCQkJY29uZmlnLnNlbWFwaG9yZSA9IDA7CgkJfQoJCS8vIEEgc2xpZ2h0IGRlbGF5LCB0byBhdm9pZCBhbnkgY3VycmVudCBjYWxsYmFja3MKCQlpZiAoIGRlZmluZWQuc2V0VGltZW91dCApIHsKCQkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlpZiAoY29uZmlnLnNlbWFwaG9yZSA+IDApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZiAoIGNvbmZpZy50aW1lb3V0ICkgewoJCQkJCWNsZWFyVGltZW91dChjb25maWcudGltZW91dCk7CgkJCQl9CgoJCQkJY29uZmlnLmJsb2NraW5nID0gZmFsc2U7CgkJCQlwcm9jZXNzKHRydWUpOwoJCQl9LCAxMyk7CgkJfSBlbHNlIHsKCQkJY29uZmlnLmJsb2NraW5nID0gZmFsc2U7CgkJCXByb2Nlc3ModHJ1ZSk7CgkJfQoJfSwKCglzdG9wOiBmdW5jdGlvbihjb3VudCkgewoJCWNvbmZpZy5zZW1hcGhvcmUgKz0gY291bnQgfHwgMTsKCQljb25maWcuYmxvY2tpbmcgPSB0cnVlOwoKCQlpZiAoIGNvbmZpZy50ZXN0VGltZW91dCAmJiBkZWZpbmVkLnNldFRpbWVvdXQgKSB7CgkJCWNsZWFyVGltZW91dChjb25maWcudGltZW91dCk7CgkJCWNvbmZpZy50aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlRVW5pdC5vayggZmFsc2UsICJUZXN0IHRpbWVkIG91dCIgKTsKCQkJCWNvbmZpZy5zZW1hcGhvcmUgPSAxOwoJCQkJUVVuaXQuc3RhcnQoKTsKCQkJfSwgY29uZmlnLnRlc3RUaW1lb3V0KTsKCQl9Cgl9Cn07CgovL1dlIHdhbnQgYWNjZXNzIHRvIHRoZSBjb25zdHJ1Y3RvcidzIHByb3RvdHlwZQooZnVuY3Rpb24oKSB7CglmdW5jdGlvbiBGKCl7fTsKCUYucHJvdG90eXBlID0gUVVuaXQ7CglRVW5pdCA9IG5ldyBGKCk7CgkvL01ha2UgRiBRVW5pdCdzIGNvbnN0cnVjdG9yIHNvIHRoYXQgd2UgY2FuIGFkZCB0byB0aGUgcHJvdG90eXBlIGxhdGVyCglRVW5pdC5jb25zdHJ1Y3RvciA9IEY7Cn0pKCk7CgovLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSwgZGVwcmVjYXRlZApRVW5pdC5lcXVhbHMgPSBRVW5pdC5lcXVhbDsKUVVuaXQuc2FtZSA9IFFVbml0LmRlZXBFcXVhbDsKCi8vIE1haW50YWluIGludGVybmFsIHN0YXRlCnZhciBjb25maWcgPSB7CgkvLyBUaGUgcXVldWUgb2YgdGVzdHMgdG8gcnVuCglxdWV1ZTogW10sCgoJLy8gYmxvY2sgdW50aWwgZG9jdW1lbnQgcmVhZHkKCWJsb2NraW5nOiB0cnVlLAoKCS8vIHdoZW4gZW5hYmxlZCwgc2hvdyBvbmx5IGZhaWxpbmcgdGVzdHMKCS8vIGdldHMgcGVyc2lzdGVkIHRocm91Z2ggc2Vzc2lvblN0b3JhZ2UgYW5kIGNhbiBiZSBjaGFuZ2VkIGluIFVJIHZpYSBjaGVja2JveAoJaGlkZXBhc3NlZDogZmFsc2UsCgoJLy8gYnkgZGVmYXVsdCwgcnVuIHByZXZpb3VzbHkgZmFpbGVkIHRlc3RzIGZpcnN0CgkvLyB2ZXJ5IHVzZWZ1bCBpbiBjb21iaW5hdGlvbiB3aXRoICJIaWRlIHBhc3NlZCB0ZXN0cyIgY2hlY2tlZAoJcmVvcmRlcjogdHJ1ZSwKCgkvLyBieSBkZWZhdWx0LCBtb2RpZnkgZG9jdW1lbnQudGl0bGUgd2hlbiBzdWl0ZSBpcyBkb25lCglhbHRlcnRpdGxlOiB0cnVlLAoKCXVybENvbmZpZzogWydub2dsb2JhbHMnLCAnbm90cnljYXRjaCddLAoKCS8vbG9nZ2luZyBjYWxsYmFjayBxdWV1ZXMKCWJlZ2luOiBbXSwKCWRvbmU6IFtdLAoJbG9nOiBbXSwKCXRlc3RTdGFydDogW10sCgl0ZXN0RG9uZTogW10sCgltb2R1bGVTdGFydDogW10sCgltb2R1bGVEb25lOiBbXQp9OwoKLy8gTG9hZCBwYXJhbWF0ZXJzCihmdW5jdGlvbigpIHsKCXZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiB8fCB7IHNlYXJjaDogIiIsIHByb3RvY29sOiAiZmlsZToiIH0sCgkJcGFyYW1zID0gbG9jYXRpb24uc2VhcmNoLnNsaWNlKCAxICkuc3BsaXQoICImIiApLAoJCWxlbmd0aCA9IHBhcmFtcy5sZW5ndGgsCgkJdXJsUGFyYW1zID0ge30sCgkJY3VycmVudDsKCglpZiAoIHBhcmFtc1sgMCBdICkgewoJCWZvciAoIHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQljdXJyZW50ID0gcGFyYW1zWyBpIF0uc3BsaXQoICI9IiApOwoJCQljdXJyZW50WyAwIF0gPSBkZWNvZGVVUklDb21wb25lbnQoIGN1cnJlbnRbIDAgXSApOwoJCQkvLyBhbGxvdyBqdXN0IGEga2V5IHRvIHR1cm4gb24gYSBmbGFnLCBlLmcuLCB0ZXN0Lmh0bWw/bm9nbG9iYWxzCgkJCWN1cnJlbnRbIDEgXSA9IGN1cnJlbnRbIDEgXSA/IGRlY29kZVVSSUNvbXBvbmVudCggY3VycmVudFsgMSBdICkgOiB0cnVlOwoJCQl1cmxQYXJhbXNbIGN1cnJlbnRbIDAgXSBdID0gY3VycmVudFsgMSBdOwoJCX0KCX0KCglRVW5pdC51cmxQYXJhbXMgPSB1cmxQYXJhbXM7Cgljb25maWcuZmlsdGVyID0gdXJsUGFyYW1zLmZpbHRlcjsKCgkvLyBGaWd1cmUgb3V0IGlmIHdlJ3JlIHJ1bm5pbmcgdGhlIHRlc3RzIGZyb20gYSBzZXJ2ZXIgb3Igbm90CglRVW5pdC5pc0xvY2FsID0gISEobG9jYXRpb24ucHJvdG9jb2wgPT09ICdmaWxlOicpOwp9KSgpOwoKLy8gRXhwb3NlIHRoZSBBUEkgYXMgZ2xvYmFsIHZhcmlhYmxlcywgdW5sZXNzIGFuICdleHBvcnRzJwovLyBvYmplY3QgZXhpc3RzLCBpbiB0aGF0IGNhc2Ugd2UgYXNzdW1lIHdlJ3JlIGluIENvbW1vbkpTCmlmICggdHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiByZXF1aXJlID09PSAidW5kZWZpbmVkIiApIHsKCWV4dGVuZCh3aW5kb3csIFFVbml0KTsKCXdpbmRvdy5RVW5pdCA9IFFVbml0Owp9IGVsc2UgewoJZXh0ZW5kKGV4cG9ydHMsIFFVbml0KTsKCWV4cG9ydHMuUVVuaXQgPSBRVW5pdDsKfQoKLy8gZGVmaW5lIHRoZXNlIGFmdGVyIGV4cG9zaW5nIGdsb2JhbHMgdG8ga2VlcCB0aGVtIGluIHRoZXNlIFFVbml0IG5hbWVzcGFjZSBvbmx5CmV4dGVuZChRVW5pdCwgewoJY29uZmlnOiBjb25maWcsCgoJLy8gSW5pdGlhbGl6ZSB0aGUgY29uZmlndXJhdGlvbiBvcHRpb25zCglpbml0OiBmdW5jdGlvbigpIHsKCQlleHRlbmQoY29uZmlnLCB7CgkJCXN0YXRzOiB7IGFsbDogMCwgYmFkOiAwIH0sCgkJCW1vZHVsZVN0YXRzOiB7IGFsbDogMCwgYmFkOiAwIH0sCgkJCXN0YXJ0ZWQ6ICtuZXcgRGF0ZSwKCQkJdXBkYXRlUmF0ZTogMTAwMCwKCQkJYmxvY2tpbmc6IGZhbHNlLAoJCQlhdXRvc3RhcnQ6IHRydWUsCgkJCWF1dG9ydW46IGZhbHNlLAoJCQlmaWx0ZXI6ICIiLAoJCQlxdWV1ZTogW10sCgkJCXNlbWFwaG9yZTogMAoJCX0pOwoKCQl2YXIgdGVzdHMgPSBpZCggInF1bml0LXRlc3RzIiApLAoJCQliYW5uZXIgPSBpZCggInF1bml0LWJhbm5lciIgKSwKCQkJcmVzdWx0ID0gaWQoICJxdW5pdC10ZXN0cmVzdWx0IiApOwoKCQlpZiAoIHRlc3RzICkgewoJCQl0ZXN0cy5pbm5lckhUTUwgPSAiIjsKCQl9CgoJCWlmICggYmFubmVyICkgewoJCQliYW5uZXIuY2xhc3NOYW1lID0gIiI7CgkJfQoKCQlpZiAoIHJlc3VsdCApIHsKCQkJcmVzdWx0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHJlc3VsdCApOwoJCX0KCgkJaWYgKCB0ZXN0cyApIHsKCQkJcmVzdWx0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInAiICk7CgkJCXJlc3VsdC5pZCA9ICJxdW5pdC10ZXN0cmVzdWx0IjsKCQkJcmVzdWx0LmNsYXNzTmFtZSA9ICJyZXN1bHQiOwoJCQl0ZXN0cy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggcmVzdWx0LCB0ZXN0cyApOwoJCQlyZXN1bHQuaW5uZXJIVE1MID0gJ1J1bm5pbmcuLi48YnIvPiZuYnNwOyc7CgkJfQoJfSwKCgkvKioKCSAqIFJlc2V0cyB0aGUgdGVzdCBzZXR1cC4gVXNlZnVsIGZvciB0ZXN0cyB0aGF0IG1vZGlmeSB0aGUgRE9NLgoJICoKCSAqIElmIGpRdWVyeSBpcyBhdmFpbGFibGUsIHVzZXMgalF1ZXJ5J3MgaHRtbCgpLCBvdGhlcndpc2UganVzdCBpbm5lckhUTUwuCgkgKi8KCXJlc2V0OiBmdW5jdGlvbigpIHsKCQlpZiAoIHdpbmRvdy5qUXVlcnkgKSB7CgkJCWpRdWVyeSggIiNxdW5pdC1maXh0dXJlIiApLmh0bWwoIGNvbmZpZy5maXh0dXJlICk7CgkJfSBlbHNlIHsKCQkJdmFyIG1haW4gPSBpZCggJ3F1bml0LWZpeHR1cmUnICk7CgkJCWlmICggbWFpbiApIHsKCQkJCW1haW4uaW5uZXJIVE1MID0gY29uZmlnLmZpeHR1cmU7CgkJCX0KCQl9Cgl9LAoKCS8qKgoJICogVHJpZ2dlciBhbiBldmVudCBvbiBhbiBlbGVtZW50LgoJICoKCSAqIEBleGFtcGxlIHRyaWdnZXJFdmVudCggZG9jdW1lbnQuYm9keSwgImNsaWNrIiApOwoJICoKCSAqIEBwYXJhbSBET01FbGVtZW50IGVsZW0KCSAqIEBwYXJhbSBTdHJpbmcgdHlwZQoJICovCgl0cmlnZ2VyRXZlbnQ6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBldmVudCApIHsKCQlpZiAoIGRvY3VtZW50LmNyZWF0ZUV2ZW50ICkgewoJCQlldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpOwoJCQlldmVudC5pbml0TW91c2VFdmVudCh0eXBlLCB0cnVlLCB0cnVlLCBlbGVtLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcsCgkJCQkwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7CgkJCWVsZW0uZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCgkJfSBlbHNlIGlmICggZWxlbS5maXJlRXZlbnQgKSB7CgkJCWVsZW0uZmlyZUV2ZW50KCJvbiIrdHlwZSk7CgkJfQoJfSwKCgkvLyBTYWZlIG9iamVjdCB0eXBlIGNoZWNraW5nCglpczogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQlyZXR1cm4gUVVuaXQub2JqZWN0VHlwZSggb2JqICkgPT0gdHlwZTsKCX0sCgoJb2JqZWN0VHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAodHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCXJldHVybiAidW5kZWZpbmVkIjsKCgkJLy8gY29uc2lkZXI6IHR5cGVvZiBudWxsID09PSBvYmplY3QKCQl9CgkJaWYgKG9iaiA9PT0gbnVsbCkgewoJCQkJcmV0dXJuICJudWxsIjsKCQl9CgoJCXZhciB0eXBlID0gdG9TdHJpbmcuY2FsbCggb2JqICkubWF0Y2goL15cW29iamVjdFxzKC4qKVxdJC8pWzFdIHx8ICcnOwoKCQlzd2l0Y2ggKHR5cGUpIHsKCQkJCWNhc2UgJ051bWJlcic6CgkJCQkJCWlmIChpc05hTihvYmopKSB7CgkJCQkJCQkJcmV0dXJuICJuYW4iOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXJldHVybiAibnVtYmVyIjsKCQkJCQkJfQoJCQkJY2FzZSAnU3RyaW5nJzoKCQkJCWNhc2UgJ0Jvb2xlYW4nOgoJCQkJY2FzZSAnQXJyYXknOgoJCQkJY2FzZSAnRGF0ZSc6CgkJCQljYXNlICdSZWdFeHAnOgoJCQkJY2FzZSAnRnVuY3Rpb24nOgoJCQkJCQlyZXR1cm4gdHlwZS50b0xvd2VyQ2FzZSgpOwoJCX0KCQlpZiAodHlwZW9mIG9iaiA9PT0gIm9iamVjdCIpIHsKCQkJCXJldHVybiAib2JqZWN0IjsKCQl9CgkJcmV0dXJuIHVuZGVmaW5lZDsKCX0sCgoJcHVzaDogZnVuY3Rpb24ocmVzdWx0LCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7CgkJdmFyIGRldGFpbHMgPSB7CgkJCXJlc3VsdDogcmVzdWx0LAoJCQltZXNzYWdlOiBtZXNzYWdlLAoJCQlhY3R1YWw6IGFjdHVhbCwKCQkJZXhwZWN0ZWQ6IGV4cGVjdGVkCgkJfTsKCgkJbWVzc2FnZSA9IGVzY2FwZUlubmVyVGV4dChtZXNzYWdlKSB8fCAocmVzdWx0ID8gIm9rYXkiIDogImZhaWxlZCIpOwoJCW1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9InRlc3QtbWVzc2FnZSI+JyArIG1lc3NhZ2UgKyAiPC9zcGFuPiI7CgkJZXhwZWN0ZWQgPSBlc2NhcGVJbm5lclRleHQoUVVuaXQuanNEdW1wLnBhcnNlKGV4cGVjdGVkKSk7CgkJYWN0dWFsID0gZXNjYXBlSW5uZXJUZXh0KFFVbml0LmpzRHVtcC5wYXJzZShhY3R1YWwpKTsKCQl2YXIgb3V0cHV0ID0gbWVzc2FnZSArICc8dGFibGU+PHRyIGNsYXNzPSJ0ZXN0LWV4cGVjdGVkIj48dGg+RXhwZWN0ZWQ6IDwvdGg+PHRkPjxwcmU+JyArIGV4cGVjdGVkICsgJzwvcHJlPjwvdGQ+PC90cj4nOwoJCWlmIChhY3R1YWwgIT0gZXhwZWN0ZWQpIHsKCQkJb3V0cHV0ICs9ICc8dHIgY2xhc3M9InRlc3QtYWN0dWFsIj48dGg+UmVzdWx0OiA8L3RoPjx0ZD48cHJlPicgKyBhY3R1YWwgKyAnPC9wcmU+PC90ZD48L3RyPic7CgkJCW91dHB1dCArPSAnPHRyIGNsYXNzPSJ0ZXN0LWRpZmYiPjx0aD5EaWZmOiA8L3RoPjx0ZD48cHJlPicgKyBRVW5pdC5kaWZmKGV4cGVjdGVkLCBhY3R1YWwpICsnPC9wcmU+PC90ZD48L3RyPic7CgkJfQoJCWlmICghcmVzdWx0KSB7CgkJCXZhciBzb3VyY2UgPSBzb3VyY2VGcm9tU3RhY2t0cmFjZSgpOwoJCQlpZiAoc291cmNlKSB7CgkJCQlkZXRhaWxzLnNvdXJjZSA9IHNvdXJjZTsKCQkJCW91dHB1dCArPSAnPHRyIGNsYXNzPSJ0ZXN0LXNvdXJjZSI+PHRoPlNvdXJjZTogPC90aD48dGQ+PHByZT4nICsgZXNjYXBlSW5uZXJUZXh0KHNvdXJjZSkgKyAnPC9wcmU+PC90ZD48L3RyPic7CgkJCX0KCQl9CgkJb3V0cHV0ICs9ICI8L3RhYmxlPiI7CgoJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICdsb2cnLCBRVW5pdCwgZGV0YWlscyApOwoKCQljb25maWcuY3VycmVudC5hc3NlcnRpb25zLnB1c2goewoJCQlyZXN1bHQ6ICEhcmVzdWx0LAoJCQltZXNzYWdlOiBvdXRwdXQKCQl9KTsKCX0sCgoJdXJsOiBmdW5jdGlvbiggcGFyYW1zICkgewoJCXBhcmFtcyA9IGV4dGVuZCggZXh0ZW5kKCB7fSwgUVVuaXQudXJsUGFyYW1zICksIHBhcmFtcyApOwoJCXZhciBxdWVyeXN0cmluZyA9ICI/IiwKCQkJa2V5OwoJCWZvciAoIGtleSBpbiBwYXJhbXMgKSB7CgkJCWlmICggIWhhc093bi5jYWxsKCBwYXJhbXMsIGtleSApICkgewoJCQkJY29udGludWU7CgkJCX0KCQkJcXVlcnlzdHJpbmcgKz0gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXkgKSArICI9IiArCgkJCQllbmNvZGVVUklDb21wb25lbnQoIHBhcmFtc1sga2V5IF0gKSArICImIjsKCQl9CgkJcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHF1ZXJ5c3RyaW5nLnNsaWNlKCAwLCAtMSApOwoJfSwKCglleHRlbmQ6IGV4dGVuZCwKCWlkOiBpZCwKCWFkZEV2ZW50OiBhZGRFdmVudAp9KTsKCi8vUVVuaXQuY29uc3RydWN0b3IgaXMgc2V0IHRvIHRoZSBlbXB0eSBGKCkgYWJvdmUgc28gdGhhdCB3ZSBjYW4gYWRkIHRvIGl0J3MgcHJvdG90eXBlIGxhdGVyCi8vRG9pbmcgdGhpcyBhbGxvd3MgdXMgdG8gdGVsbCBpZiB0aGUgZm9sbG93aW5nIG1ldGhvZHMgaGF2ZSBiZWVuIG92ZXJ3cml0dGVuIG9uIHRoZSBhY3R1YWwKLy9RVW5pdCBvYmplY3QsIHdoaWNoIGlzIGEgZGVwcmVjYXRlZCB3YXkgb2YgdXNpbmcgdGhlIGNhbGxiYWNrcy4KZXh0ZW5kKFFVbml0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgewoJLy8gTG9nZ2luZyBjYWxsYmFja3M7IGFsbCByZWNlaXZlIGEgc2luZ2xlIGFyZ3VtZW50IHdpdGggdGhlIGxpc3RlZCBwcm9wZXJ0aWVzCgkvLyBydW4gdGVzdC9sb2dzLmh0bWwgZm9yIGFueSByZWxhdGVkIGNoYW5nZXMKCWJlZ2luOiByZWdpc3RlckxvZ2dpbmdDYWxsYmFjaygnYmVnaW4nKSwKCS8vIGRvbmU6IHsgZmFpbGVkLCBwYXNzZWQsIHRvdGFsLCBydW50aW1lIH0KCWRvbmU6IHJlZ2lzdGVyTG9nZ2luZ0NhbGxiYWNrKCdkb25lJyksCgkvLyBsb2c6IHsgcmVzdWx0LCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlIH0KCWxvZzogcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soJ2xvZycpLAoJLy8gdGVzdFN0YXJ0OiB7IG5hbWUgfQoJdGVzdFN0YXJ0OiByZWdpc3RlckxvZ2dpbmdDYWxsYmFjaygndGVzdFN0YXJ0JyksCgkvLyB0ZXN0RG9uZTogeyBuYW1lLCBmYWlsZWQsIHBhc3NlZCwgdG90YWwgfQoJdGVzdERvbmU6IHJlZ2lzdGVyTG9nZ2luZ0NhbGxiYWNrKCd0ZXN0RG9uZScpLAoJLy8gbW9kdWxlU3RhcnQ6IHsgbmFtZSB9Cgltb2R1bGVTdGFydDogcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soJ21vZHVsZVN0YXJ0JyksCgkvLyBtb2R1bGVEb25lOiB7IG5hbWUsIGZhaWxlZCwgcGFzc2VkLCB0b3RhbCB9Cgltb2R1bGVEb25lOiByZWdpc3RlckxvZ2dpbmdDYWxsYmFjaygnbW9kdWxlRG9uZScpCn0pOwoKaWYgKCB0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgKSB7Cgljb25maWcuYXV0b3J1biA9IHRydWU7Cn0KClFVbml0LmxvYWQgPSBmdW5jdGlvbigpIHsKCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICdiZWdpbicsIFFVbml0LCB7fSApOwoKCS8vIEluaXRpYWxpemUgdGhlIGNvbmZpZywgc2F2aW5nIHRoZSBleGVjdXRpb24gcXVldWUKCXZhciBvbGRjb25maWcgPSBleHRlbmQoe30sIGNvbmZpZyk7CglRVW5pdC5pbml0KCk7CglleHRlbmQoY29uZmlnLCBvbGRjb25maWcpOwoKCWNvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoKCXZhciB1cmxDb25maWdIdG1sID0gJycsIGxlbiA9IGNvbmZpZy51cmxDb25maWcubGVuZ3RoOwoJZm9yICggdmFyIGkgPSAwLCB2YWw7IGkgPCBsZW4sIHZhbCA9IGNvbmZpZy51cmxDb25maWdbaV07IGkrKyApIHsKCQljb25maWdbdmFsXSA9IFFVbml0LnVybFBhcmFtc1t2YWxdOwoJCXVybENvbmZpZ0h0bWwgKz0gJzxsYWJlbD48aW5wdXQgbmFtZT0iJyArIHZhbCArICciIHR5cGU9ImNoZWNrYm94IicgKyAoIGNvbmZpZ1t2YWxdID8gJyBjaGVja2VkPSJjaGVja2VkIicgOiAnJyApICsgJz4nICsgdmFsICsgJzwvbGFiZWw+JzsKCX0KCgl2YXIgdXNlckFnZW50ID0gaWQoInF1bml0LXVzZXJBZ2VudCIpOwoJaWYgKCB1c2VyQWdlbnQgKSB7CgkJdXNlckFnZW50LmlubmVySFRNTCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7Cgl9Cgl2YXIgYmFubmVyID0gaWQoInF1bml0LWhlYWRlciIpOwoJaWYgKCBiYW5uZXIgKSB7CgkJYmFubmVyLmlubmVySFRNTCA9ICc8YSBocmVmPSInICsgUVVuaXQudXJsKHsgZmlsdGVyOiB1bmRlZmluZWQgfSkgKyAnIj4gJyArIGJhbm5lci5pbm5lckhUTUwgKyAnPC9hPiAnICsgdXJsQ29uZmlnSHRtbDsKCQlhZGRFdmVudCggYmFubmVyLCAiY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgcGFyYW1zID0ge307CgkJCXBhcmFtc1sgZXZlbnQudGFyZ2V0Lm5hbWUgXSA9IGV2ZW50LnRhcmdldC5jaGVja2VkID8gdHJ1ZSA6IHVuZGVmaW5lZDsKCQkJd2luZG93LmxvY2F0aW9uID0gUVVuaXQudXJsKCBwYXJhbXMgKTsKCQl9KTsKCX0KCgl2YXIgdG9vbGJhciA9IGlkKCJxdW5pdC10ZXN0cnVubmVyLXRvb2xiYXIiKTsKCWlmICggdG9vbGJhciApIHsKCQl2YXIgZmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCQlmaWx0ZXIudHlwZSA9ICJjaGVja2JveCI7CgkJZmlsdGVyLmlkID0gInF1bml0LWZpbHRlci1wYXNzIjsKCQlhZGRFdmVudCggZmlsdGVyLCAiY2xpY2siLCBmdW5jdGlvbigpIHsKCQkJdmFyIG9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInF1bml0LXRlc3RzIik7CgkJCWlmICggZmlsdGVyLmNoZWNrZWQgKSB7CgkJCQlvbC5jbGFzc05hbWUgPSBvbC5jbGFzc05hbWUgKyAiIGhpZGVwYXNzIjsKCQkJfSBlbHNlIHsKCQkJCXZhciB0bXAgPSAiICIgKyBvbC5jbGFzc05hbWUucmVwbGFjZSggL1tcblx0XHJdL2csICIgIiApICsgIiAiOwoJCQkJb2wuY2xhc3NOYW1lID0gdG1wLnJlcGxhY2UoLyBoaWRlcGFzcyAvLCAiICIpOwoJCQl9CgkJCWlmICggZGVmaW5lZC5zZXNzaW9uU3RvcmFnZSApIHsKCQkJCWlmIChmaWx0ZXIuY2hlY2tlZCkgewoJCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInF1bml0LWZpbHRlci1wYXNzZWQtdGVzdHMiLCAidHJ1ZSIpOwoJCQkJfSBlbHNlIHsKCQkJCQlzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCJxdW5pdC1maWx0ZXItcGFzc2VkLXRlc3RzIik7CgkJCQl9CgkJCX0KCQl9KTsKCQlpZiAoIGNvbmZpZy5oaWRlcGFzc2VkIHx8IGRlZmluZWQuc2Vzc2lvblN0b3JhZ2UgJiYgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgicXVuaXQtZmlsdGVyLXBhc3NlZC10ZXN0cyIpICkgewoJCQlmaWx0ZXIuY2hlY2tlZCA9IHRydWU7CgkJCXZhciBvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxdW5pdC10ZXN0cyIpOwoJCQlvbC5jbGFzc05hbWUgPSBvbC5jbGFzc05hbWUgKyAiIGhpZGVwYXNzIjsKCQl9CgkJdG9vbGJhci5hcHBlbmRDaGlsZCggZmlsdGVyICk7CgoJCXZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CgkJbGFiZWwuc2V0QXR0cmlidXRlKCJmb3IiLCAicXVuaXQtZmlsdGVyLXBhc3MiKTsKCQlsYWJlbC5pbm5lckhUTUwgPSAiSGlkZSBwYXNzZWQgdGVzdHMiOwoJCXRvb2xiYXIuYXBwZW5kQ2hpbGQoIGxhYmVsICk7Cgl9CgoJdmFyIG1haW4gPSBpZCgncXVuaXQtZml4dHVyZScpOwoJaWYgKCBtYWluICkgewoJCWNvbmZpZy5maXh0dXJlID0gbWFpbi5pbm5lckhUTUw7Cgl9CgoJaWYgKGNvbmZpZy5hdXRvc3RhcnQpIHsKCQlRVW5pdC5zdGFydCgpOwoJfQp9OwoKYWRkRXZlbnQod2luZG93LCAibG9hZCIsIFFVbml0LmxvYWQpOwoKLy8gYWRkRXZlbnQod2luZG93LCAiZXJyb3IiKSBnaXZlcyB1cyBhIHVzZWxlc3MgZXZlbnQgb2JqZWN0CndpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24oIG1lc3NhZ2UsIGZpbGUsIGxpbmUgKSB7CglpZiAoIFFVbml0LmNvbmZpZy5jdXJyZW50ICkgewoJCW9rKCBmYWxzZSwgbWVzc2FnZSArICIsICIgKyBmaWxlICsgIjoiICsgbGluZSApOwoJfSBlbHNlIHsKCQl0ZXN0KCAiZ2xvYmFsIGZhaWx1cmUiLCBmdW5jdGlvbigpIHsKCQkJb2soIGZhbHNlLCBtZXNzYWdlICsgIiwgIiArIGZpbGUgKyAiOiIgKyBsaW5lICk7CgkJfSk7Cgl9Cn07CgpmdW5jdGlvbiBkb25lKCkgewoJY29uZmlnLmF1dG9ydW4gPSB0cnVlOwoKCS8vIExvZyB0aGUgbGFzdCBtb2R1bGUgcmVzdWx0cwoJaWYgKCBjb25maWcuY3VycmVudE1vZHVsZSApIHsKCQlydW5Mb2dnaW5nQ2FsbGJhY2tzKCAnbW9kdWxlRG9uZScsIFFVbml0LCB7CgkJCW5hbWU6IGNvbmZpZy5jdXJyZW50TW9kdWxlLAoJCQlmYWlsZWQ6IGNvbmZpZy5tb2R1bGVTdGF0cy5iYWQsCgkJCXBhc3NlZDogY29uZmlnLm1vZHVsZVN0YXRzLmFsbCAtIGNvbmZpZy5tb2R1bGVTdGF0cy5iYWQsCgkJCXRvdGFsOiBjb25maWcubW9kdWxlU3RhdHMuYWxsCgkJfSApOwoJfQoKCXZhciBiYW5uZXIgPSBpZCgicXVuaXQtYmFubmVyIiksCgkJdGVzdHMgPSBpZCgicXVuaXQtdGVzdHMiKSwKCQlydW50aW1lID0gK25ldyBEYXRlIC0gY29uZmlnLnN0YXJ0ZWQsCgkJcGFzc2VkID0gY29uZmlnLnN0YXRzLmFsbCAtIGNvbmZpZy5zdGF0cy5iYWQsCgkJaHRtbCA9IFsKCQkJJ1Rlc3RzIGNvbXBsZXRlZCBpbiAnLAoJCQlydW50aW1lLAoJCQknIG1pbGxpc2Vjb25kcy48YnIvPicsCgkJCSc8c3BhbiBjbGFzcz0icGFzc2VkIj4nLAoJCQlwYXNzZWQsCgkJCSc8L3NwYW4+IHRlc3RzIG9mIDxzcGFuIGNsYXNzPSJ0b3RhbCI+JywKCQkJY29uZmlnLnN0YXRzLmFsbCwKCQkJJzwvc3Bhbj4gcGFzc2VkLCA8c3BhbiBjbGFzcz0iZmFpbGVkIj4nLAoJCQljb25maWcuc3RhdHMuYmFkLAoJCQknPC9zcGFuPiBmYWlsZWQuJwoJCV0uam9pbignJyk7CgoJaWYgKCBiYW5uZXIgKSB7CgkJYmFubmVyLmNsYXNzTmFtZSA9IChjb25maWcuc3RhdHMuYmFkID8gInF1bml0LWZhaWwiIDogInF1bml0LXBhc3MiKTsKCX0KCglpZiAoIHRlc3RzICkgewoJCWlkKCAicXVuaXQtdGVzdHJlc3VsdCIgKS5pbm5lckhUTUwgPSBodG1sOwoJfQoKCWlmICggY29uZmlnLmFsdGVydGl0bGUgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudC50aXRsZSApIHsKCQkvLyBzaG93IOKcliBmb3IgZ29vZCwg4pyUIGZvciBiYWQgc3VpdGUgcmVzdWx0IGluIHRpdGxlCgkJLy8gdXNlIGVzY2FwZSBzZXF1ZW5jZXMgaW4gY2FzZSBmaWxlIGdldHMgbG9hZGVkIHdpdGggbm9uLXV0Zi04LWNoYXJzZXQKCQlkb2N1bWVudC50aXRsZSA9IFsKCQkJKGNvbmZpZy5zdGF0cy5iYWQgPyAiXHUyNzE2IiA6ICJcdTI3MTQiKSwKCQkJZG9jdW1lbnQudGl0bGUucmVwbGFjZSgvXltcdTI3MTRcdTI3MTZdIC9pLCAiIikKCQldLmpvaW4oIiAiKTsKCX0KCglydW5Mb2dnaW5nQ2FsbGJhY2tzKCAnZG9uZScsIFFVbml0LCB7CgkJZmFpbGVkOiBjb25maWcuc3RhdHMuYmFkLAoJCXBhc3NlZDogcGFzc2VkLAoJCXRvdGFsOiBjb25maWcuc3RhdHMuYWxsLAoJCXJ1bnRpbWU6IHJ1bnRpbWUKCX0gKTsKfQoKZnVuY3Rpb24gdmFsaWRUZXN0KCBuYW1lICkgewoJdmFyIGZpbHRlciA9IGNvbmZpZy5maWx0ZXIsCgkJcnVuID0gZmFsc2U7CgoJaWYgKCAhZmlsdGVyICkgewoJCXJldHVybiB0cnVlOwoJfQoKCXZhciBub3QgPSBmaWx0ZXIuY2hhckF0KCAwICkgPT09ICIhIjsKCWlmICggbm90ICkgewoJCWZpbHRlciA9IGZpbHRlci5zbGljZSggMSApOwoJfQoKCWlmICggbmFtZS5pbmRleE9mKCBmaWx0ZXIgKSAhPT0gLTEgKSB7CgkJcmV0dXJuICFub3Q7Cgl9CgoJaWYgKCBub3QgKSB7CgkJcnVuID0gdHJ1ZTsKCX0KCglyZXR1cm4gcnVuOwp9CgovLyBzbyBmYXIgc3VwcG9ydHMgb25seSBGaXJlZm94LCBDaHJvbWUgYW5kIE9wZXJhIChidWdneSkKLy8gY291bGQgYmUgZXh0ZW5kZWQgaW4gdGhlIGZ1dHVyZSB0byB1c2Ugc29tZXRoaW5nIGxpa2UgaHR0cHM6Ly9naXRodWIuY29tL2Nzbm92ZXIvVHJhY2VLaXQKZnVuY3Rpb24gc291cmNlRnJvbVN0YWNrdHJhY2UoKSB7Cgl0cnkgewoJCXRocm93IG5ldyBFcnJvcigpOwoJfSBjYXRjaCAoIGUgKSB7CgkJaWYgKGUuc3RhY2t0cmFjZSkgewoJCQkvLyBPcGVyYQoJCQlyZXR1cm4gZS5zdGFja3RyYWNlLnNwbGl0KCJcbiIpWzZdOwoJCX0gZWxzZSBpZiAoZS5zdGFjaykgewoJCQkvLyBGaXJlZm94LCBDaHJvbWUKCQkJcmV0dXJuIGUuc3RhY2suc3BsaXQoIlxuIilbNF07CgkJfSBlbHNlIGlmIChlLnNvdXJjZVVSTCkgewoJCQkvLyBTYWZhcmksIFBoYW50b21KUwoJCQkvLyBUT0RPIHNvdXJjZVVSTCBwb2ludHMgYXQgdGhlICd0aHJvdyBuZXcgRXJyb3InIGxpbmUgYWJvdmUsIHVzZWxlc3MKCQkJLy9yZXR1cm4gZS5zb3VyY2VVUkwgKyAiOiIgKyBlLmxpbmU7CgkJfQoJfQp9CgpmdW5jdGlvbiBlc2NhcGVJbm5lclRleHQocykgewoJaWYgKCFzKSB7CgkJcmV0dXJuICIiOwoJfQoJcyA9IHMgKyAiIjsKCXJldHVybiBzLnJlcGxhY2UoL1tcJjw+XS9nLCBmdW5jdGlvbihzKSB7CgkJc3dpdGNoKHMpIHsKCQkJY2FzZSAiJiI6IHJldHVybiAiJmFtcDsiOwoJCQljYXNlICI8IjogcmV0dXJuICImbHQ7IjsKCQkJY2FzZSAiPiI6IHJldHVybiAiJmd0OyI7CgkJCWRlZmF1bHQ6IHJldHVybiBzOwoJCX0KCX0pOwp9CgpmdW5jdGlvbiBzeW5jaHJvbml6ZSggY2FsbGJhY2ssIGxhc3QgKSB7Cgljb25maWcucXVldWUucHVzaCggY2FsbGJhY2sgKTsKCglpZiAoIGNvbmZpZy5hdXRvcnVuICYmICFjb25maWcuYmxvY2tpbmcgKSB7CgkJcHJvY2VzcyhsYXN0KTsKCX0KfQoKZnVuY3Rpb24gcHJvY2VzcyggbGFzdCApIHsKCXZhciBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoJY29uZmlnLmRlcHRoID0gY29uZmlnLmRlcHRoID8gY29uZmlnLmRlcHRoICsgMSA6IDE7CgoJd2hpbGUgKCBjb25maWcucXVldWUubGVuZ3RoICYmICFjb25maWcuYmxvY2tpbmcgKSB7CgkJaWYgKCAhZGVmaW5lZC5zZXRUaW1lb3V0IHx8IGNvbmZpZy51cGRhdGVSYXRlIDw9IDAgfHwgKCAoIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhcnQgKSA8IGNvbmZpZy51cGRhdGVSYXRlICkgKSB7CgkJCWNvbmZpZy5xdWV1ZS5zaGlmdCgpKCk7CgkJfSBlbHNlIHsKCQkJd2luZG93LnNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7CgkJCQlwcm9jZXNzKCBsYXN0ICk7CgkJCX0sIDEzICk7CgkJCWJyZWFrOwoJCX0KCX0KCWNvbmZpZy5kZXB0aC0tOwoJaWYgKCBsYXN0ICYmICFjb25maWcuYmxvY2tpbmcgJiYgIWNvbmZpZy5xdWV1ZS5sZW5ndGggJiYgY29uZmlnLmRlcHRoID09PSAwICkgewoJCWRvbmUoKTsKCX0KfQoKZnVuY3Rpb24gc2F2ZUdsb2JhbCgpIHsKCWNvbmZpZy5wb2xsdXRpb24gPSBbXTsKCglpZiAoIGNvbmZpZy5ub2dsb2JhbHMgKSB7CgkJZm9yICggdmFyIGtleSBpbiB3aW5kb3cgKSB7CgkJCWlmICggIWhhc093bi5jYWxsKCB3aW5kb3csIGtleSApICkgewoJCQkJY29udGludWU7CgkJCX0KCQkJY29uZmlnLnBvbGx1dGlvbi5wdXNoKCBrZXkgKTsKCQl9Cgl9Cn0KCmZ1bmN0aW9uIGNoZWNrUG9sbHV0aW9uKCBuYW1lICkgewoJdmFyIG9sZCA9IGNvbmZpZy5wb2xsdXRpb247CglzYXZlR2xvYmFsKCk7CgoJdmFyIG5ld0dsb2JhbHMgPSBkaWZmKCBjb25maWcucG9sbHV0aW9uLCBvbGQgKTsKCWlmICggbmV3R2xvYmFscy5sZW5ndGggPiAwICkgewoJCW9rKCBmYWxzZSwgIkludHJvZHVjZWQgZ2xvYmFsIHZhcmlhYmxlKHMpOiAiICsgbmV3R2xvYmFscy5qb2luKCIsICIpICk7Cgl9CgoJdmFyIGRlbGV0ZWRHbG9iYWxzID0gZGlmZiggb2xkLCBjb25maWcucG9sbHV0aW9uICk7CglpZiAoIGRlbGV0ZWRHbG9iYWxzLmxlbmd0aCA+IDAgKSB7CgkJb2soIGZhbHNlLCAiRGVsZXRlZCBnbG9iYWwgdmFyaWFibGUocyk6ICIgKyBkZWxldGVkR2xvYmFscy5qb2luKCIsICIpICk7Cgl9Cn0KCi8vIHJldHVybnMgYSBuZXcgQXJyYXkgd2l0aCB0aGUgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBidXQgbm90IGluIGIKZnVuY3Rpb24gZGlmZiggYSwgYiApIHsKCXZhciByZXN1bHQgPSBhLnNsaWNlKCk7Cglmb3IgKCB2YXIgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKysgKSB7CgkJZm9yICggdmFyIGogPSAwOyBqIDwgYi5sZW5ndGg7IGorKyApIHsKCQkJaWYgKCByZXN1bHRbaV0gPT09IGJbal0gKSB7CgkJCQlyZXN1bHQuc3BsaWNlKGksIDEpOwoJCQkJaS0tOwoJCQkJYnJlYWs7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBmYWlsKG1lc3NhZ2UsIGV4Y2VwdGlvbiwgY2FsbGJhY2spIHsKCWlmICggdHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiICYmIGNvbnNvbGUuZXJyb3IgJiYgY29uc29sZS53YXJuICkgewoJCWNvbnNvbGUuZXJyb3IobWVzc2FnZSk7CgkJY29uc29sZS5lcnJvcihleGNlcHRpb24pOwoJCWNvbnNvbGUud2FybihjYWxsYmFjay50b1N0cmluZygpKTsKCgl9IGVsc2UgaWYgKCB3aW5kb3cub3BlcmEgJiYgb3BlcmEucG9zdEVycm9yICkgewoJCW9wZXJhLnBvc3RFcnJvcihtZXNzYWdlLCBleGNlcHRpb24sIGNhbGxiYWNrLnRvU3RyaW5nKTsKCX0KfQoKZnVuY3Rpb24gZXh0ZW5kKGEsIGIpIHsKCWZvciAoIHZhciBwcm9wIGluIGIgKSB7CgkJaWYgKCBiW3Byb3BdID09PSB1bmRlZmluZWQgKSB7CgkJCWRlbGV0ZSBhW3Byb3BdOwoKCQkvLyBBdm9pZCAiTWVtYmVyIG5vdCBmb3VuZCIgZXJyb3IgaW4gSUU4IGNhdXNlZCBieSBzZXR0aW5nIHdpbmRvdy5jb25zdHJ1Y3RvcgoJCX0gZWxzZSBpZiAoIHByb3AgIT09ICJjb25zdHJ1Y3RvciIgfHwgYSAhPT0gd2luZG93ICkgewoJCQlhW3Byb3BdID0gYltwcm9wXTsKCQl9Cgl9CgoJcmV0dXJuIGE7Cn0KCmZ1bmN0aW9uIGFkZEV2ZW50KGVsZW0sIHR5cGUsIGZuKSB7CglpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsKCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGZuLCBmYWxzZSApOwoJfSBlbHNlIGlmICggZWxlbS5hdHRhY2hFdmVudCApIHsKCQllbGVtLmF0dGFjaEV2ZW50KCAib24iICsgdHlwZSwgZm4gKTsKCX0gZWxzZSB7CgkJZm4oKTsKCX0KfQoKZnVuY3Rpb24gaWQobmFtZSkgewoJcmV0dXJuICEhKHR5cGVvZiBkb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgZG9jdW1lbnQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQpICYmCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG5hbWUgKTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soa2V5KXsKCXJldHVybiBmdW5jdGlvbihjYWxsYmFjayl7CgkJY29uZmlnW2tleV0ucHVzaCggY2FsbGJhY2sgKTsKCX07Cn0KCi8vIFN1cHBvcnRzIGRlcHJlY2F0ZWQgbWV0aG9kIG9mIGNvbXBsZXRlbHkgb3ZlcndyaXRpbmcgbG9nZ2luZyBjYWxsYmFja3MKZnVuY3Rpb24gcnVuTG9nZ2luZ0NhbGxiYWNrcyhrZXksIHNjb3BlLCBhcmdzKSB7CgkvL2RlYnVnZ2VyOwoJdmFyIGNhbGxiYWNrczsKCWlmICggUVVuaXQuaGFzT3duUHJvcGVydHkoa2V5KSApIHsKCQlRVW5pdFtrZXldLmNhbGwoc2NvcGUsIGFyZ3MpOwoJfSBlbHNlIHsKCQljYWxsYmFja3MgPSBjb25maWdba2V5XTsKCQlmb3IoIHZhciBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKyApIHsKCQkJY2FsbGJhY2tzW2ldLmNhbGwoIHNjb3BlLCBhcmdzICk7CgkJfQoJfQp9CgovLyBUZXN0IGZvciBlcXVhbGl0eSBhbnkgSmF2YVNjcmlwdCB0eXBlLgovLyBBdXRob3I6IFBoaWxpcHBlIFJhdGjDqSA8cHJhdGhlQGdtYWlsLmNvbT4KUVVuaXQuZXF1aXYgPSBmdW5jdGlvbiAoKSB7CgoJdmFyIGlubmVyRXF1aXY7IC8vIHRoZSByZWFsIGVxdWl2IGZ1bmN0aW9uCgl2YXIgY2FsbGVycyA9IFtdOyAvLyBzdGFjayB0byBkZWNpZGUgYmV0d2VlbiBza2lwL2Fib3J0IGZ1bmN0aW9ucwoJdmFyIHBhcmVudHMgPSBbXTsgLy8gc3RhY2sgdG8gYXZvaWRpbmcgbG9vcHMgZnJvbSBjaXJjdWxhciByZWZlcmVuY2luZwoKCS8vIENhbGwgdGhlIG8gcmVsYXRlZCBjYWxsYmFjayB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMuCglmdW5jdGlvbiBiaW5kQ2FsbGJhY2tzKG8sIGNhbGxiYWNrcywgYXJncykgewoJCXZhciBwcm9wID0gUVVuaXQub2JqZWN0VHlwZShvKTsKCQlpZiAocHJvcCkgewoJCQlpZiAoUVVuaXQub2JqZWN0VHlwZShjYWxsYmFja3NbcHJvcF0pID09PSAiZnVuY3Rpb24iKSB7CgkJCQlyZXR1cm4gY2FsbGJhY2tzW3Byb3BdLmFwcGx5KGNhbGxiYWNrcywgYXJncyk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gY2FsbGJhY2tzW3Byb3BdOyAvLyBvciB1bmRlZmluZWQKCQkJfQoJCX0KCX0KCgl2YXIgY2FsbGJhY2tzID0gZnVuY3Rpb24gKCkgewoKCQkvLyBmb3Igc3RyaW5nLCBib29sZWFuLCBudW1iZXIgYW5kIG51bGwKCQlmdW5jdGlvbiB1c2VTdHJpY3RFcXVhbGl0eShiLCBhKSB7CgkJCWlmIChiIGluc3RhbmNlb2YgYS5jb25zdHJ1Y3RvciB8fCBhIGluc3RhbmNlb2YgYi5jb25zdHJ1Y3RvcikgewoJCQkJLy8gdG8gY2F0Y2ggc2hvcnQgYW5ub3RhaW9uIFZTICduZXcnIGFubm90YXRpb24gb2YgYQoJCQkJLy8gZGVjbGFyYXRpb24KCQkJCS8vIGUuZy4gdmFyIGkgPSAxOwoJCQkJLy8gdmFyIGogPSBuZXcgTnVtYmVyKDEpOwoJCQkJcmV0dXJuIGEgPT0gYjsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBhID09PSBiOwoJCQl9CgkJfQoKCQlyZXR1cm4gewoJCQkic3RyaW5nIiA6IHVzZVN0cmljdEVxdWFsaXR5LAoJCQkiYm9vbGVhbiIgOiB1c2VTdHJpY3RFcXVhbGl0eSwKCQkJIm51bWJlciIgOiB1c2VTdHJpY3RFcXVhbGl0eSwKCQkJIm51bGwiIDogdXNlU3RyaWN0RXF1YWxpdHksCgkJCSJ1bmRlZmluZWQiIDogdXNlU3RyaWN0RXF1YWxpdHksCgoJCQkibmFuIiA6IGZ1bmN0aW9uKGIpIHsKCQkJCXJldHVybiBpc05hTihiKTsKCQkJfSwKCgkJCSJkYXRlIiA6IGZ1bmN0aW9uKGIsIGEpIHsKCQkJCXJldHVybiBRVW5pdC5vYmplY3RUeXBlKGIpID09PSAiZGF0ZSIKCQkJCQkJJiYgYS52YWx1ZU9mKCkgPT09IGIudmFsdWVPZigpOwoJCQl9LAoKCQkJInJlZ2V4cCIgOiBmdW5jdGlvbihiLCBhKSB7CgkJCQlyZXR1cm4gUVVuaXQub2JqZWN0VHlwZShiKSA9PT0gInJlZ2V4cCIKCQkJCQkJJiYgYS5zb3VyY2UgPT09IGIuc291cmNlICYmIC8vIHRoZSByZWdleCBpdHNlbGYKCQkJCQkJYS5nbG9iYWwgPT09IGIuZ2xvYmFsICYmIC8vIGFuZCBpdHMgbW9kaWZlcnMKCQkJCQkJCQkJCQkJCS8vIChnbWkpIC4uLgoJCQkJCQlhLmlnbm9yZUNhc2UgPT09IGIuaWdub3JlQ2FzZQoJCQkJCQkmJiBhLm11bHRpbGluZSA9PT0gYi5tdWx0aWxpbmU7CgkJCX0sCgoJCQkvLyAtIHNraXAgd2hlbiB0aGUgcHJvcGVydHkgaXMgYSBtZXRob2Qgb2YgYW4gaW5zdGFuY2UgKE9PUCkKCQkJLy8gLSBhYm9ydCBvdGhlcndpc2UsCgkJCS8vIGluaXRpYWwgPT09IHdvdWxkIGhhdmUgY2F0Y2ggaWRlbnRpY2FsIHJlZmVyZW5jZXMgYW55d2F5CgkJCSJmdW5jdGlvbiIgOiBmdW5jdGlvbigpIHsKCQkJCXZhciBjYWxsZXIgPSBjYWxsZXJzW2NhbGxlcnMubGVuZ3RoIC0gMV07CgkJCQlyZXR1cm4gY2FsbGVyICE9PSBPYmplY3QgJiYgdHlwZW9mIGNhbGxlciAhPT0gInVuZGVmaW5lZCI7CgkJCX0sCgoJCQkiYXJyYXkiIDogZnVuY3Rpb24oYiwgYSkgewoJCQkJdmFyIGksIGosIGxvb3A7CgkJCQl2YXIgbGVuOwoKCQkJCS8vIGIgY291bGQgYmUgYW4gb2JqZWN0IGxpdGVyYWwgaGVyZQoJCQkJaWYgKCEoUVVuaXQub2JqZWN0VHlwZShiKSA9PT0gImFycmF5IikpIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJbGVuID0gYS5sZW5ndGg7CgkJCQlpZiAobGVuICE9PSBiLmxlbmd0aCkgeyAvLyBzYWZlIGFuZCBmYXN0ZXIKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJLy8gdHJhY2sgcmVmZXJlbmNlIHRvIGF2b2lkIGNpcmN1bGFyIHJlZmVyZW5jZXMKCQkJCXBhcmVudHMucHVzaChhKTsKCQkJCWZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewoJCQkJCWxvb3AgPSBmYWxzZTsKCQkJCQlmb3IgKGogPSAwOyBqIDwgcGFyZW50cy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAocGFyZW50c1tqXSA9PT0gYVtpXSkgewoJCQkJCQkJbG9vcCA9IHRydWU7Ly8gZG9udCByZXdhbGsgYXJyYXkKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIWxvb3AgJiYgIWlubmVyRXF1aXYoYVtpXSwgYltpXSkpIHsKCQkJCQkJcGFyZW50cy5wb3AoKTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJCXBhcmVudHMucG9wKCk7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSwKCgkJCSJvYmplY3QiIDogZnVuY3Rpb24oYiwgYSkgewoJCQkJdmFyIGksIGosIGxvb3A7CgkJCQl2YXIgZXEgPSB0cnVlOyAvLyB1bmxlc3Mgd2UgY2FuIHByb292ZSBpdAoJCQkJdmFyIGFQcm9wZXJ0aWVzID0gW10sIGJQcm9wZXJ0aWVzID0gW107IC8vIGNvbGxlY3Rpb24gb2YKCQkJCQkJCQkJCQkJCQkvLyBzdHJpbmdzCgoJCQkJLy8gY29tcGFyaW5nIGNvbnN0cnVjdG9ycyBpcyBtb3JlIHN0cmljdCB0aGFuIHVzaW5nCgkJCQkvLyBpbnN0YW5jZW9mCgkJCQlpZiAoYS5jb25zdHJ1Y3RvciAhPT0gYi5jb25zdHJ1Y3RvcikgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCgkJCQkvLyBzdGFjayBjb25zdHJ1Y3RvciBiZWZvcmUgdHJhdmVyc2luZyBwcm9wZXJ0aWVzCgkJCQljYWxsZXJzLnB1c2goYS5jb25zdHJ1Y3Rvcik7CgkJCQkvLyB0cmFjayByZWZlcmVuY2UgdG8gYXZvaWQgY2lyY3VsYXIgcmVmZXJlbmNlcwoJCQkJcGFyZW50cy5wdXNoKGEpOwoKCQkJCWZvciAoaSBpbiBhKSB7IC8vIGJlIHN0cmljdDogZG9uJ3QgZW5zdXJlcyBoYXNPd25Qcm9wZXJ0eQoJCQkJCQkJCS8vIGFuZCBnbyBkZWVwCgkJCQkJbG9vcCA9IGZhbHNlOwoJCQkJCWZvciAoaiA9IDA7IGogPCBwYXJlbnRzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChwYXJlbnRzW2pdID09PSBhW2ldKQoJCQkJCQkJbG9vcCA9IHRydWU7IC8vIGRvbid0IGdvIGRvd24gdGhlIHNhbWUgcGF0aAoJCQkJCQkJCQkJCS8vIHR3aWNlCgkJCQkJfQoJCQkJCWFQcm9wZXJ0aWVzLnB1c2goaSk7IC8vIGNvbGxlY3QgYSdzIHByb3BlcnRpZXMKCgkJCQkJaWYgKCFsb29wICYmICFpbm5lckVxdWl2KGFbaV0sIGJbaV0pKSB7CgkJCQkJCWVxID0gZmFsc2U7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCgkJCQljYWxsZXJzLnBvcCgpOyAvLyB1bnN0YWNrLCB3ZSBhcmUgZG9uZQoJCQkJcGFyZW50cy5wb3AoKTsKCgkJCQlmb3IgKGkgaW4gYikgewoJCQkJCWJQcm9wZXJ0aWVzLnB1c2goaSk7IC8vIGNvbGxlY3QgYidzIHByb3BlcnRpZXMKCQkJCX0KCgkJCQkvLyBFbnN1cmVzIGlkZW50aWNhbCBwcm9wZXJ0aWVzIG5hbWUKCQkJCXJldHVybiBlcQoJCQkJCQkmJiBpbm5lckVxdWl2KGFQcm9wZXJ0aWVzLnNvcnQoKSwgYlByb3BlcnRpZXMKCQkJCQkJCQkuc29ydCgpKTsKCQkJfQoJCX07Cgl9KCk7CgoJaW5uZXJFcXVpdiA9IGZ1bmN0aW9uKCkgeyAvLyBjYW4gdGFrZSBtdWx0aXBsZSBhcmd1bWVudHMKCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpOwoJCWlmIChhcmdzLmxlbmd0aCA8IDIpIHsKCQkJcmV0dXJuIHRydWU7IC8vIGVuZCB0cmFuc2l0aW9uCgkJfQoKCQlyZXR1cm4gKGZ1bmN0aW9uKGEsIGIpIHsKCQkJaWYgKGEgPT09IGIpIHsKCQkJCXJldHVybiB0cnVlOyAvLyBjYXRjaCB0aGUgbW9zdCB5b3UgY2FuCgkJCX0gZWxzZSBpZiAoYSA9PT0gbnVsbCB8fCBiID09PSBudWxsIHx8IHR5cGVvZiBhID09PSAidW5kZWZpbmVkIgoJCQkJCXx8IHR5cGVvZiBiID09PSAidW5kZWZpbmVkIgoJCQkJCXx8IFFVbml0Lm9iamVjdFR5cGUoYSkgIT09IFFVbml0Lm9iamVjdFR5cGUoYikpIHsKCQkJCXJldHVybiBmYWxzZTsgLy8gZG9uJ3QgbG9zZSB0aW1lIHdpdGggZXJyb3IgcHJvbmUgY2FzZXMKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBiaW5kQ2FsbGJhY2tzKGEsIGNhbGxiYWNrcywgWyBiLCBhIF0pOwoJCQl9CgoJCQkvLyBhcHBseSB0cmFuc2l0aW9uIHdpdGggKDEuLm4pIGFyZ3VtZW50cwoJCX0pKGFyZ3NbMF0sIGFyZ3NbMV0pCgkJCQkmJiBhcmd1bWVudHMuY2FsbGVlLmFwcGx5KHRoaXMsIGFyZ3Muc3BsaWNlKDEsCgkJCQkJCWFyZ3MubGVuZ3RoIC0gMSkpOwoJfTsKCglyZXR1cm4gaW5uZXJFcXVpdjsKCn0oKTsKCi8qKgogKiBqc0R1bXAgQ29weXJpZ2h0IChjKSAyMDA4IEFyaWVsIEZsZXNsZXIgLSBhZmxlc2xlcihhdClnbWFpbChkb3QpY29tIHwKICogaHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tIExpY2Vuc2VkIHVuZGVyIEJTRAogKiAoaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9ic2QtbGljZW5zZS5waHApIERhdGU6IDUvMTUvMjAwOAogKgogKiBAcHJvamVjdERlc2NyaXB0aW9uIEFkdmFuY2VkIGFuZCBleHRlbnNpYmxlIGRhdGEgZHVtcGluZyBmb3IgSmF2YXNjcmlwdC4KICogQHZlcnNpb24gMS4wLjAKICogQGF1dGhvciBBcmllbCBGbGVzbGVyCiAqIEBsaW5rIHtodHRwOi8vZmxlc2xlci5ibG9nc3BvdC5jb20vMjAwOC8wNS9qc2R1bXAtcHJldHR5LWR1bXAtb2YtYW55LWphdmFzY3JpcHQuaHRtbH0KICovClFVbml0LmpzRHVtcCA9IChmdW5jdGlvbigpIHsKCWZ1bmN0aW9uIHF1b3RlKCBzdHIgKSB7CgkJcmV0dXJuICciJyArIHN0ci50b1N0cmluZygpLnJlcGxhY2UoLyIvZywgJ1xcIicpICsgJyInOwoJfTsKCWZ1bmN0aW9uIGxpdGVyYWwoIG8gKSB7CgkJcmV0dXJuIG8gKyAnJzsKCX07CglmdW5jdGlvbiBqb2luKCBwcmUsIGFyciwgcG9zdCApIHsKCQl2YXIgcyA9IGpzRHVtcC5zZXBhcmF0b3IoKSwKCQkJYmFzZSA9IGpzRHVtcC5pbmRlbnQoKSwKCQkJaW5uZXIgPSBqc0R1bXAuaW5kZW50KDEpOwoJCWlmICggYXJyLmpvaW4gKQoJCQlhcnIgPSBhcnIuam9pbiggJywnICsgcyArIGlubmVyICk7CgkJaWYgKCAhYXJyICkKCQkJcmV0dXJuIHByZSArIHBvc3Q7CgkJcmV0dXJuIFsgcHJlLCBpbm5lciArIGFyciwgYmFzZSArIHBvc3QgXS5qb2luKHMpOwoJfTsKCWZ1bmN0aW9uIGFycmF5KCBhcnIsIHN0YWNrICkgewoJCXZhciBpID0gYXJyLmxlbmd0aCwgcmV0ID0gQXJyYXkoaSk7CgkJdGhpcy51cCgpOwoJCXdoaWxlICggaS0tICkKCQkJcmV0W2ldID0gdGhpcy5wYXJzZSggYXJyW2ldICwgdW5kZWZpbmVkICwgc3RhY2spOwoJCXRoaXMuZG93bigpOwoJCXJldHVybiBqb2luKCAnWycsIHJldCwgJ10nICk7Cgl9OwoKCXZhciByZU5hbWUgPSAvXmZ1bmN0aW9uIChcdyspLzsKCgl2YXIganNEdW1wID0gewoJCXBhcnNlOmZ1bmN0aW9uKCBvYmosIHR5cGUsIHN0YWNrICkgeyAvL3R5cGUgaXMgdXNlZCBtb3N0bHkgaW50ZXJuYWxseSwgeW91IGNhbiBmaXggYSAoY3VzdG9tKXR5cGUgaW4gYWR2YW5jZQoJCQlzdGFjayA9IHN0YWNrIHx8IFsgXTsKCQkJdmFyIHBhcnNlciA9IHRoaXMucGFyc2Vyc1sgdHlwZSB8fCB0aGlzLnR5cGVPZihvYmopIF07CgkJCXR5cGUgPSB0eXBlb2YgcGFyc2VyOwoJCQl2YXIgaW5TdGFjayA9IGluQXJyYXkob2JqLCBzdGFjayk7CgkJCWlmIChpblN0YWNrICE9IC0xKSB7CgkJCQlyZXR1cm4gJ3JlY3Vyc2lvbignKyhpblN0YWNrIC0gc3RhY2subGVuZ3RoKSsnKSc7CgkJCX0KCQkJLy9lbHNlCgkJCWlmICh0eXBlID09ICdmdW5jdGlvbicpICB7CgkJCQkJc3RhY2sucHVzaChvYmopOwoJCQkJCXZhciByZXMgPSBwYXJzZXIuY2FsbCggdGhpcywgb2JqLCBzdGFjayApOwoJCQkJCXN0YWNrLnBvcCgpOwoJCQkJCXJldHVybiByZXM7CgkJCX0KCQkJLy8gZWxzZQoJCQlyZXR1cm4gKHR5cGUgPT0gJ3N0cmluZycpID8gcGFyc2VyIDogdGhpcy5wYXJzZXJzLmVycm9yOwoJCX0sCgkJdHlwZU9mOmZ1bmN0aW9uKCBvYmogKSB7CgkJCXZhciB0eXBlOwoJCQlpZiAoIG9iaiA9PT0gbnVsbCApIHsKCQkJCXR5cGUgPSAibnVsbCI7CgkJCX0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCXR5cGUgPSAidW5kZWZpbmVkIjsKCQkJfSBlbHNlIGlmIChRVW5pdC5pcygiUmVnRXhwIiwgb2JqKSkgewoJCQkJdHlwZSA9ICJyZWdleHAiOwoJCQl9IGVsc2UgaWYgKFFVbml0LmlzKCJEYXRlIiwgb2JqKSkgewoJCQkJdHlwZSA9ICJkYXRlIjsKCQkJfSBlbHNlIGlmIChRVW5pdC5pcygiRnVuY3Rpb24iLCBvYmopKSB7CgkJCQl0eXBlID0gImZ1bmN0aW9uIjsKCQkJfSBlbHNlIGlmICh0eXBlb2Ygb2JqLnNldEludGVydmFsICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG9iai5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIG9iai5ub2RlVHlwZSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCXR5cGUgPSAid2luZG93IjsKCQkJfSBlbHNlIGlmIChvYmoubm9kZVR5cGUgPT09IDkpIHsKCQkJCXR5cGUgPSAiZG9jdW1lbnQiOwoJCQl9IGVsc2UgaWYgKG9iai5ub2RlVHlwZSkgewoJCQkJdHlwZSA9ICJub2RlIjsKCQkJfSBlbHNlIGlmICgKCQkJCS8vIG5hdGl2ZSBhcnJheXMKCQkJCXRvU3RyaW5nLmNhbGwoIG9iaiApID09PSAiW29iamVjdCBBcnJheV0iIHx8CgkJCQkvLyBOb2RlTGlzdCBvYmplY3RzCgkJCQkoIHR5cGVvZiBvYmoubGVuZ3RoID09PSAibnVtYmVyIiAmJiB0eXBlb2Ygb2JqLml0ZW0gIT09ICJ1bmRlZmluZWQiICYmICggb2JqLmxlbmd0aCA/IG9iai5pdGVtKDApID09PSBvYmpbMF0gOiAoIG9iai5pdGVtKCAwICkgPT09IG51bGwgJiYgdHlwZW9mIG9ialswXSA9PT0gInVuZGVmaW5lZCIgKSApICkKCQkJKSB7CgkJCQl0eXBlID0gImFycmF5IjsKCQkJfSBlbHNlIHsKCQkJCXR5cGUgPSB0eXBlb2Ygb2JqOwoJCQl9CgkJCXJldHVybiB0eXBlOwoJCX0sCgkJc2VwYXJhdG9yOmZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gdGhpcy5tdWx0aWxpbmUgPwl0aGlzLkhUTUwgPyAnPGJyIC8+JyA6ICdcbicgOiB0aGlzLkhUTUwgPyAnJm5ic3A7JyA6ICcgJzsKCQl9LAoJCWluZGVudDpmdW5jdGlvbiggZXh0cmEgKSB7Ly8gZXh0cmEgY2FuIGJlIGEgbnVtYmVyLCBzaG9ydGN1dCBmb3IgaW5jcmVhc2luZy1jYWxsaW5nLWRlY3JlYXNpbmcKCQkJaWYgKCAhdGhpcy5tdWx0aWxpbmUgKQoJCQkJcmV0dXJuICcnOwoJCQl2YXIgY2hyID0gdGhpcy5pbmRlbnRDaGFyOwoJCQlpZiAoIHRoaXMuSFRNTCApCgkJCQljaHIgPSBjaHIucmVwbGFjZSgvXHQvZywnICAgJykucmVwbGFjZSgvIC9nLCcmbmJzcDsnKTsKCQkJcmV0dXJuIEFycmF5KCB0aGlzLl9kZXB0aF8gKyAoZXh0cmF8fDApICkuam9pbihjaHIpOwoJCX0sCgkJdXA6ZnVuY3Rpb24oIGEgKSB7CgkJCXRoaXMuX2RlcHRoXyArPSBhIHx8IDE7CgkJfSwKCQlkb3duOmZ1bmN0aW9uKCBhICkgewoJCQl0aGlzLl9kZXB0aF8gLT0gYSB8fCAxOwoJCX0sCgkJc2V0UGFyc2VyOmZ1bmN0aW9uKCBuYW1lLCBwYXJzZXIgKSB7CgkJCXRoaXMucGFyc2Vyc1tuYW1lXSA9IHBhcnNlcjsKCQl9LAoJCS8vIFRoZSBuZXh0IDMgYXJlIGV4cG9zZWQgc28geW91IGNhbiB1c2UgdGhlbQoJCXF1b3RlOnF1b3RlLAoJCWxpdGVyYWw6bGl0ZXJhbCwKCQlqb2luOmpvaW4sCgkJLy8KCQlfZGVwdGhfOiAxLAoJCS8vIFRoaXMgaXMgdGhlIGxpc3Qgb2YgcGFyc2VycywgdG8gbW9kaWZ5IHRoZW0sIHVzZSBqc0R1bXAuc2V0UGFyc2VyCgkJcGFyc2Vyczp7CgkJCXdpbmRvdzogJ1tXaW5kb3ddJywKCQkJZG9jdW1lbnQ6ICdbRG9jdW1lbnRdJywKCQkJZXJyb3I6J1tFUlJPUl0nLCAvL3doZW4gbm8gcGFyc2VyIGlzIGZvdW5kLCBzaG91bGRuJ3QgaGFwcGVuCgkJCXVua25vd246ICdbVW5rbm93bl0nLAoJCQknbnVsbCc6J251bGwnLAoJCQkndW5kZWZpbmVkJzondW5kZWZpbmVkJywKCQkJJ2Z1bmN0aW9uJzpmdW5jdGlvbiggZm4gKSB7CgkJCQl2YXIgcmV0ID0gJ2Z1bmN0aW9uJywKCQkJCQluYW1lID0gJ25hbWUnIGluIGZuID8gZm4ubmFtZSA6IChyZU5hbWUuZXhlYyhmbil8fFtdKVsxXTsvL2Z1bmN0aW9ucyBuZXZlciBoYXZlIG5hbWUgaW4gSUUKCQkJCWlmICggbmFtZSApCgkJCQkJcmV0ICs9ICcgJyArIG5hbWU7CgkJCQlyZXQgKz0gJygnOwoKCQkJCXJldCA9IFsgcmV0LCBRVW5pdC5qc0R1bXAucGFyc2UoIGZuLCAnZnVuY3Rpb25BcmdzJyApLCAnKXsnXS5qb2luKCcnKTsKCQkJCXJldHVybiBqb2luKCByZXQsIFFVbml0LmpzRHVtcC5wYXJzZShmbiwnZnVuY3Rpb25Db2RlJyksICd9JyApOwoJCQl9LAoJCQlhcnJheTogYXJyYXksCgkJCW5vZGVsaXN0OiBhcnJheSwKCQkJYXJndW1lbnRzOiBhcnJheSwKCQkJb2JqZWN0OmZ1bmN0aW9uKCBtYXAsIHN0YWNrICkgewoJCQkJdmFyIHJldCA9IFsgXTsKCQkJCVFVbml0LmpzRHVtcC51cCgpOwoJCQkJZm9yICggdmFyIGtleSBpbiBtYXAgKSB7CgkJCQkgICAgdmFyIHZhbCA9IG1hcFtrZXldOwoJCQkJCXJldC5wdXNoKCBRVW5pdC5qc0R1bXAucGFyc2Uoa2V5LCdrZXknKSArICc6ICcgKyBRVW5pdC5qc0R1bXAucGFyc2UodmFsLCB1bmRlZmluZWQsIHN0YWNrKSk7CiAgICAgICAgICAgICAgICB9CgkJCQlRVW5pdC5qc0R1bXAuZG93bigpOwoJCQkJcmV0dXJuIGpvaW4oICd7JywgcmV0LCAnfScgKTsKCQkJfSwKCQkJbm9kZTpmdW5jdGlvbiggbm9kZSApIHsKCQkJCXZhciBvcGVuID0gUVVuaXQuanNEdW1wLkhUTUwgPyAnJmx0OycgOiAnPCcsCgkJCQkJY2xvc2UgPSBRVW5pdC5qc0R1bXAuSFRNTCA/ICcmZ3Q7JyA6ICc+JzsKCgkJCQl2YXIgdGFnID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCXJldCA9IG9wZW4gKyB0YWc7CgoJCQkJZm9yICggdmFyIGEgaW4gUVVuaXQuanNEdW1wLkRPTUF0dHJzICkgewoJCQkJCXZhciB2YWwgPSBub2RlW1FVbml0LmpzRHVtcC5ET01BdHRyc1thXV07CgkJCQkJaWYgKCB2YWwgKQoJCQkJCQlyZXQgKz0gJyAnICsgYSArICc9JyArIFFVbml0LmpzRHVtcC5wYXJzZSggdmFsLCAnYXR0cmlidXRlJyApOwoJCQkJfQoJCQkJcmV0dXJuIHJldCArIGNsb3NlICsgb3BlbiArICcvJyArIHRhZyArIGNsb3NlOwoJCQl9LAoJCQlmdW5jdGlvbkFyZ3M6ZnVuY3Rpb24oIGZuICkgey8vZnVuY3Rpb24gY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyB0aGUgYXJndW1lbnRzIHBhcnQgb2YgdGhlIGZ1bmN0aW9uCgkJCQl2YXIgbCA9IGZuLmxlbmd0aDsKCQkJCWlmICggIWwgKSByZXR1cm4gJyc7CgoJCQkJdmFyIGFyZ3MgPSBBcnJheShsKTsKCQkJCXdoaWxlICggbC0tICkKCQkJCQlhcmdzW2xdID0gU3RyaW5nLmZyb21DaGFyQ29kZSg5NytsKTsvLzk3IGlzICdhJwoJCQkJcmV0dXJuICcgJyArIGFyZ3Muam9pbignLCAnKSArICcgJzsKCQkJfSwKCQkJa2V5OnF1b3RlLCAvL29iamVjdCBjYWxscyBpdCBpbnRlcm5hbGx5LCB0aGUga2V5IHBhcnQgb2YgYW4gaXRlbSBpbiBhIG1hcAoJCQlmdW5jdGlvbkNvZGU6J1tjb2RlXScsIC8vZnVuY3Rpb24gY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyB0aGUgY29udGVudCBvZiB0aGUgZnVuY3Rpb24KCQkJYXR0cmlidXRlOnF1b3RlLCAvL25vZGUgY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyBhbiBodG1sIGF0dHJpYnV0ZSB2YWx1ZQoJCQlzdHJpbmc6cXVvdGUsCgkJCWRhdGU6cXVvdGUsCgkJCXJlZ2V4cDpsaXRlcmFsLCAvL3JlZ2V4CgkJCW51bWJlcjpsaXRlcmFsLAoJCQknYm9vbGVhbic6bGl0ZXJhbAoJCX0sCgkJRE9NQXR0cnM6ey8vYXR0cmlidXRlcyB0byBkdW1wIGZyb20gbm9kZXMsIG5hbWU9PnJlYWxOYW1lCgkJCWlkOidpZCcsCgkJCW5hbWU6J25hbWUnLAoJCQknY2xhc3MnOidjbGFzc05hbWUnCgkJfSwKCQlIVE1MOmZhbHNlLC8vaWYgdHJ1ZSwgZW50aXRpZXMgYXJlIGVzY2FwZWQgKCA8LCA+LCBcdCwgc3BhY2UgYW5kIFxuICkKCQlpbmRlbnRDaGFyOicgICcsLy9pbmRlbnRhdGlvbiB1bml0CgkJbXVsdGlsaW5lOnRydWUgLy9pZiB0cnVlLCBpdGVtcyBpbiBhIGNvbGxlY3Rpb24sIGFyZSBzZXBhcmF0ZWQgYnkgYSBcbiwgZWxzZSBqdXN0IGEgc3BhY2UuCgl9OwoKCXJldHVybiBqc0R1bXA7Cn0pKCk7CgovLyBmcm9tIFNpenpsZS5qcwpmdW5jdGlvbiBnZXRUZXh0KCBlbGVtcyApIHsKCXZhciByZXQgPSAiIiwgZWxlbTsKCglmb3IgKCB2YXIgaSA9IDA7IGVsZW1zW2ldOyBpKysgKSB7CgkJZWxlbSA9IGVsZW1zW2ldOwoKCQkvLyBHZXQgdGhlIHRleHQgZnJvbSB0ZXh0IG5vZGVzIGFuZCBDREFUQSBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA0ICkgewoJCQlyZXQgKz0gZWxlbS5ub2RlVmFsdWU7CgoJCS8vIFRyYXZlcnNlIGV2ZXJ5dGhpbmcgZWxzZSwgZXhjZXB0IGNvbW1lbnQgbm9kZXMKCQl9IGVsc2UgaWYgKCBlbGVtLm5vZGVUeXBlICE9PSA4ICkgewoJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbS5jaGlsZE5vZGVzICk7CgkJfQoJfQoKCXJldHVybiByZXQ7Cn07CgovL2Zyb20ganF1ZXJ5LmpzCmZ1bmN0aW9uIGluQXJyYXkoIGVsZW0sIGFycmF5ICkgewoJaWYgKCBhcnJheS5pbmRleE9mICkgewoJCXJldHVybiBhcnJheS5pbmRleE9mKCBlbGVtICk7Cgl9CgoJZm9yICggdmFyIGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQlpZiAoIGFycmF5WyBpIF0gPT09IGVsZW0gKSB7CgkJCXJldHVybiBpOwoJCX0KCX0KCglyZXR1cm4gLTE7Cn0KCi8qCiAqIEphdmFzY3JpcHQgRGlmZiBBbGdvcml0aG0KICogIEJ5IEpvaG4gUmVzaWcgKGh0dHA6Ly9lam9obi5vcmcvKQogKiAgTW9kaWZpZWQgYnkgQ2h1IEFsYW4gInNwcml0ZSIKICoKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKgogKiBNb3JlIEluZm86CiAqICBodHRwOi8vZWpvaG4ub3JnL3Byb2plY3RzL2phdmFzY3JpcHQtZGlmZi1hbGdvcml0aG0vCiAqCiAqIFVzYWdlOiBRVW5pdC5kaWZmKGV4cGVjdGVkLCBhY3R1YWwpCiAqCiAqIFFVbml0LmRpZmYoInRoZSBxdWljayBicm93biBmb3gganVtcGVkIG92ZXIiLCAidGhlIHF1aWNrIGZveCBqdW1wcyBvdmVyIikgPT0gInRoZSAgcXVpY2sgPGRlbD5icm93biA8L2RlbD4gZm94IDxkZWw+anVtcGVkIDwvZGVsPjxpbnM+anVtcHMgPC9pbnM+IG92ZXIiCiAqLwpRVW5pdC5kaWZmID0gKGZ1bmN0aW9uKCkgewoJZnVuY3Rpb24gZGlmZihvLCBuKSB7CgkJdmFyIG5zID0ge307CgkJdmFyIG9zID0ge307CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgbi5sZW5ndGg7IGkrKykgewoJCQlpZiAobnNbbltpXV0gPT0gbnVsbCkKCQkJCW5zW25baV1dID0gewoJCQkJCXJvd3M6IFtdLAoJCQkJCW86IG51bGwKCQkJCX07CgkJCW5zW25baV1dLnJvd3MucHVzaChpKTsKCQl9CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgby5sZW5ndGg7IGkrKykgewoJCQlpZiAob3Nbb1tpXV0gPT0gbnVsbCkKCQkJCW9zW29baV1dID0gewoJCQkJCXJvd3M6IFtdLAoJCQkJCW46IG51bGwKCQkJCX07CgkJCW9zW29baV1dLnJvd3MucHVzaChpKTsKCQl9CgoJCWZvciAodmFyIGkgaW4gbnMpIHsKCQkJaWYgKCAhaGFzT3duLmNhbGwoIG5zLCBpICkgKSB7CgkJCQljb250aW51ZTsKCQkJfQoJCQlpZiAobnNbaV0ucm93cy5sZW5ndGggPT0gMSAmJiB0eXBlb2Yob3NbaV0pICE9ICJ1bmRlZmluZWQiICYmIG9zW2ldLnJvd3MubGVuZ3RoID09IDEpIHsKCQkJCW5bbnNbaV0ucm93c1swXV0gPSB7CgkJCQkJdGV4dDogbltuc1tpXS5yb3dzWzBdXSwKCQkJCQlyb3c6IG9zW2ldLnJvd3NbMF0KCQkJCX07CgkJCQlvW29zW2ldLnJvd3NbMF1dID0gewoJCQkJCXRleHQ6IG9bb3NbaV0ucm93c1swXV0sCgkJCQkJcm93OiBuc1tpXS5yb3dzWzBdCgkJCQl9OwoJCQl9CgkJfQoKCQlmb3IgKHZhciBpID0gMDsgaSA8IG4ubGVuZ3RoIC0gMTsgaSsrKSB7CgkJCWlmIChuW2ldLnRleHQgIT0gbnVsbCAmJiBuW2kgKyAxXS50ZXh0ID09IG51bGwgJiYgbltpXS5yb3cgKyAxIDwgby5sZW5ndGggJiYgb1tuW2ldLnJvdyArIDFdLnRleHQgPT0gbnVsbCAmJgoJCQluW2kgKyAxXSA9PSBvW25baV0ucm93ICsgMV0pIHsKCQkJCW5baSArIDFdID0gewoJCQkJCXRleHQ6IG5baSArIDFdLAoJCQkJCXJvdzogbltpXS5yb3cgKyAxCgkJCQl9OwoJCQkJb1tuW2ldLnJvdyArIDFdID0gewoJCQkJCXRleHQ6IG9bbltpXS5yb3cgKyAxXSwKCQkJCQlyb3c6IGkgKyAxCgkJCQl9OwoJCQl9CgkJfQoKCQlmb3IgKHZhciBpID0gbi5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7CgkJCWlmIChuW2ldLnRleHQgIT0gbnVsbCAmJiBuW2kgLSAxXS50ZXh0ID09IG51bGwgJiYgbltpXS5yb3cgPiAwICYmIG9bbltpXS5yb3cgLSAxXS50ZXh0ID09IG51bGwgJiYKCQkJbltpIC0gMV0gPT0gb1tuW2ldLnJvdyAtIDFdKSB7CgkJCQluW2kgLSAxXSA9IHsKCQkJCQl0ZXh0OiBuW2kgLSAxXSwKCQkJCQlyb3c6IG5baV0ucm93IC0gMQoJCQkJfTsKCQkJCW9bbltpXS5yb3cgLSAxXSA9IHsKCQkJCQl0ZXh0OiBvW25baV0ucm93IC0gMV0sCgkJCQkJcm93OiBpIC0gMQoJCQkJfTsKCQkJfQoJCX0KCgkJcmV0dXJuIHsKCQkJbzogbywKCQkJbjogbgoJCX07Cgl9CgoJcmV0dXJuIGZ1bmN0aW9uKG8sIG4pIHsKCQlvID0gby5yZXBsYWNlKC9ccyskLywgJycpOwoJCW4gPSBuLnJlcGxhY2UoL1xzKyQvLCAnJyk7CgkJdmFyIG91dCA9IGRpZmYobyA9PSAiIiA/IFtdIDogby5zcGxpdCgvXHMrLyksIG4gPT0gIiIgPyBbXSA6IG4uc3BsaXQoL1xzKy8pKTsKCgkJdmFyIHN0ciA9ICIiOwoKCQl2YXIgb1NwYWNlID0gby5tYXRjaCgvXHMrL2cpOwoJCWlmIChvU3BhY2UgPT0gbnVsbCkgewoJCQlvU3BhY2UgPSBbIiAiXTsKCQl9CgkJZWxzZSB7CgkJCW9TcGFjZS5wdXNoKCIgIik7CgkJfQoJCXZhciBuU3BhY2UgPSBuLm1hdGNoKC9ccysvZyk7CgkJaWYgKG5TcGFjZSA9PSBudWxsKSB7CgkJCW5TcGFjZSA9IFsiICJdOwoJCX0KCQllbHNlIHsKCQkJblNwYWNlLnB1c2goIiAiKTsKCQl9CgoJCWlmIChvdXQubi5sZW5ndGggPT0gMCkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IG91dC5vLmxlbmd0aDsgaSsrKSB7CgkJCQlzdHIgKz0gJzxkZWw+JyArIG91dC5vW2ldICsgb1NwYWNlW2ldICsgIjwvZGVsPiI7CgkJCX0KCQl9CgkJZWxzZSB7CgkJCWlmIChvdXQublswXS50ZXh0ID09IG51bGwpIHsKCQkJCWZvciAobiA9IDA7IG4gPCBvdXQuby5sZW5ndGggJiYgb3V0Lm9bbl0udGV4dCA9PSBudWxsOyBuKyspIHsKCQkJCQlzdHIgKz0gJzxkZWw+JyArIG91dC5vW25dICsgb1NwYWNlW25dICsgIjwvZGVsPiI7CgkJCQl9CgkJCX0KCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3V0Lm4ubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChvdXQubltpXS50ZXh0ID09IG51bGwpIHsKCQkJCQlzdHIgKz0gJzxpbnM+JyArIG91dC5uW2ldICsgblNwYWNlW2ldICsgIjwvaW5zPiI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQl2YXIgcHJlID0gIiI7CgoJCQkJCWZvciAobiA9IG91dC5uW2ldLnJvdyArIDE7IG4gPCBvdXQuby5sZW5ndGggJiYgb3V0Lm9bbl0udGV4dCA9PSBudWxsOyBuKyspIHsKCQkJCQkJcHJlICs9ICc8ZGVsPicgKyBvdXQub1tuXSArIG9TcGFjZVtuXSArICI8L2RlbD4iOwoJCQkJCX0KCQkJCQlzdHIgKz0gIiAiICsgb3V0Lm5baV0udGV4dCArIG5TcGFjZVtpXSArIHByZTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHN0cjsKCX07Cn0pKCk7Cgp9KSh0aGlzKTsK", "content_type": "application/javascript"}, "assets/js/plugins/localstorage.js": {"data": "ZGVmaW5lKFsndW5kZXJzY29yZScsICdiYWNrYm9uZSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSl7CgovLyBBIHNpbXBsZSBtb2R1bGUgdG8gcmVwbGFjZSBgQmFja2JvbmUuc3luY2Agd2l0aCAqbG9jYWxTdG9yYWdlKi1iYXNlZAovLyBwZXJzaXN0ZW5jZS4gTW9kZWxzIGFyZSBnaXZlbiBHVUlEUywgYW5kIHNhdmVkIGludG8gYSBKU09OIG9iamVjdC4gU2ltcGxlCi8vIGFzIHRoYXQuCgovLyBHZW5lcmF0ZSBmb3VyIHJhbmRvbSBoZXggZGlnaXRzLgpmdW5jdGlvbiBTNCgpIHsKICAgcmV0dXJuICgoKDErTWF0aC5yYW5kb20oKSkqMHgxMDAwMCl8MCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTsKfTsKCi8vIEdlbmVyYXRlIGEgcHNldWRvLUdVSUQgYnkgY29uY2F0ZW5hdGluZyByYW5kb20gaGV4YWRlY2ltYWwuCmZ1bmN0aW9uIGd1aWQoKSB7CiAgIHJldHVybiAoUzQoKStTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpK1M0KCkrUzQoKSk7Cn07CgovLyBPdXIgU3RvcmUgaXMgcmVwcmVzZW50ZWQgYnkgYSBzaW5nbGUgSlMgb2JqZWN0IGluICpsb2NhbFN0b3JhZ2UqLiBDcmVhdGUgaXQKLy8gd2l0aCBhIG1lYW5pbmdmdWwgbmFtZSwgbGlrZSB0aGUgbmFtZSB5b3UnZCBnaXZlIGEgdGFibGUuCnZhciBTdG9yZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICB0aGlzLm5hbWUgPSBuYW1lOwogIHZhciBzdG9yZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubmFtZSk7CiAgdGhpcy5kYXRhID0gKHN0b3JlICYmIEpTT04ucGFyc2Uoc3RvcmUpKSB8fCB7fTsKfTsKCl8uZXh0ZW5kKFN0b3JlLnByb3RvdHlwZSwgewoKICAvLyBTYXZlIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSAqKlN0b3JlKiogdG8gKmxvY2FsU3RvcmFnZSouCiAgc2F2ZTogZnVuY3Rpb24oKSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm5hbWUsIEpTT04uc3RyaW5naWZ5KHRoaXMuZGF0YSkpOwogIH0sCgogIC8vIEFkZCBhIG1vZGVsLCBnaXZpbmcgaXQgYSAoaG9wZWZ1bGx5KS11bmlxdWUgR1VJRCwgaWYgaXQgZG9lc24ndCBhbHJlYWR5CiAgLy8gaGF2ZSBhbiBpZCBvZiBpdCdzIG93bi4KICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICBpZiAoIW1vZGVsLmlkKSBtb2RlbC5pZCA9IG1vZGVsLmF0dHJpYnV0ZXMuaWQgPSBndWlkKCk7CiAgICB0aGlzLmRhdGFbbW9kZWwuaWRdID0gbW9kZWw7CiAgICB0aGlzLnNhdmUoKTsKICAgIHJldHVybiBtb2RlbDsKICB9LAoKICAvLyBVcGRhdGUgYSBtb2RlbCBieSByZXBsYWNpbmcgaXRzIGNvcHkgaW4gYHRoaXMuZGF0YWAuCiAgdXBkYXRlOiBmdW5jdGlvbihtb2RlbCkgewogICAgdGhpcy5kYXRhW21vZGVsLmlkXSA9IG1vZGVsOwogICAgdGhpcy5zYXZlKCk7CiAgICByZXR1cm4gbW9kZWw7CiAgfSwKCiAgLy8gUmV0cmlldmUgYSBtb2RlbCBmcm9tIGB0aGlzLmRhdGFgIGJ5IGlkLgogIGZpbmQ6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhW21vZGVsLmlkXTsKICB9LAoKICAvLyBSZXR1cm4gdGhlIGFycmF5IG9mIGFsbCBtb2RlbHMgY3VycmVudGx5IGluIHN0b3JhZ2UuCiAgZmluZEFsbDogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy52YWx1ZXModGhpcy5kYXRhKTsKICB9LAoKICAvLyBEZWxldGUgYSBtb2RlbCBmcm9tIGB0aGlzLmRhdGFgLCByZXR1cm5pbmcgaXQuCiAgZGVzdHJveTogZnVuY3Rpb24obW9kZWwpIHsKICAgIGRlbGV0ZSB0aGlzLmRhdGFbbW9kZWwuaWRdOwogICAgdGhpcy5zYXZlKCk7CiAgICByZXR1cm4gbW9kZWw7CiAgfQoKfSk7CgovLyBPdmVycmlkZSBgQmFja2JvbmUuc3luY2AgdG8gdXNlIGRlbGVnYXRlIHRvIHRoZSBtb2RlbCBvciBjb2xsZWN0aW9uJ3MKLy8gKmxvY2FsU3RvcmFnZSogcHJvcGVydHksIHdoaWNoIHNob3VsZCBiZSBhbiBpbnN0YW5jZSBvZiBgU3RvcmVgLgpCYWNrYm9uZS5zeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykgewoKICB2YXIgcmVzcDsKICB2YXIgc3RvcmUgPSBtb2RlbC5sb2NhbFN0b3JhZ2UgfHwgbW9kZWwuY29sbGVjdGlvbi5sb2NhbFN0b3JhZ2U7CgogIHN3aXRjaCAobWV0aG9kKSB7CiAgICBjYXNlICJyZWFkIjogICAgcmVzcCA9IG1vZGVsLmlkID8gc3RvcmUuZmluZChtb2RlbCkgOiBzdG9yZS5maW5kQWxsKCk7IGJyZWFrOwogICAgY2FzZSAiY3JlYXRlIjogIHJlc3AgPSBzdG9yZS5jcmVhdGUobW9kZWwpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgIGNhc2UgInVwZGF0ZSI6ICByZXNwID0gc3RvcmUudXBkYXRlKG1vZGVsKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICBjYXNlICJkZWxldGUiOiAgcmVzcCA9IHN0b3JlLmRlc3Ryb3kobW9kZWwpOyAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogIH0KCiAgaWYgKHJlc3ApIHsKICAgIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICB9IGVsc2UgewogICAgb3B0aW9ucy5lcnJvcigiUmVjb3JkIG5vdCBmb3VuZCIpOwogIH0KfTsKcmV0dXJuIFN0b3JlOwp9KTsK", "content_type": "application/javascript"}, "assets/js/libs/cordova-2.0.0.js": {"data": "Ly8gY29tbWl0IDExNGNmNTMwNGE3NGZmOGY3YzlmZjFkMjFjZjU2NTIyOThhZjA0YjAKCi8vIEZpbGUgZ2VuZXJhdGVkIGF0IDo6IFdlZCBKdWwgMTggMjAxMiAxNDo0NDozMyBHTVQtMDcwMCAoUERUKQoKLyoKIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24KIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKIAogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogCiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwoKOyhmdW5jdGlvbigpIHsKCi8vIGZpbGU6IGxpYi9zY3JpcHRzL3JlcXVpcmUuanMKdmFyIHJlcXVpcmUsCiAgICBkZWZpbmU7CgooZnVuY3Rpb24gKCkgewogICAgdmFyIG1vZHVsZXMgPSB7fTsKCiAgICBmdW5jdGlvbiBidWlsZChtb2R1bGUpIHsKICAgICAgICB2YXIgZmFjdG9yeSA9IG1vZHVsZS5mYWN0b3J5OwogICAgICAgIG1vZHVsZS5leHBvcnRzID0ge307CiAgICAgICAgZGVsZXRlIG1vZHVsZS5mYWN0b3J5OwogICAgICAgIGZhY3RvcnkocmVxdWlyZSwgbW9kdWxlLmV4cG9ydHMsIG1vZHVsZSk7CiAgICAgICAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgfQoKICAgIHJlcXVpcmUgPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICBpZiAoIW1vZHVsZXNbaWRdKSB7CiAgICAgICAgICAgIHRocm93ICJtb2R1bGUgIiArIGlkICsgIiBub3QgZm91bmQiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kdWxlc1tpZF0uZmFjdG9yeSA/IGJ1aWxkKG1vZHVsZXNbaWRdKSA6IG1vZHVsZXNbaWRdLmV4cG9ydHM7CiAgICB9OwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChpZCwgZmFjdG9yeSkgewogICAgICAgIGlmIChtb2R1bGVzW2lkXSkgewogICAgICAgICAgICB0aHJvdyAibW9kdWxlICIgKyBpZCArICIgYWxyZWFkeSBkZWZpbmVkIjsKICAgICAgICB9CgogICAgICAgIG1vZHVsZXNbaWRdID0gewogICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgIGZhY3Rvcnk6IGZhY3RvcnkKICAgICAgICB9OwogICAgfTsKCiAgICBkZWZpbmUucmVtb3ZlID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgZGVsZXRlIG1vZHVsZXNbaWRdOwogICAgfTsKCn0pKCk7Ci8vRXhwb3J0IGZvciB1c2UgaW4gbm9kZQppZiAodHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIHJlcXVpcmUgPT09ICJmdW5jdGlvbiIpIHsKICAgIG1vZHVsZS5leHBvcnRzLnJlcXVpcmUgPSByZXF1aXJlOwogICAgbW9kdWxlLmV4cG9ydHMuZGVmaW5lID0gZGVmaW5lOwp9Ci8vIGZpbGU6IGxpYi9jb3Jkb3ZhLmpzCmRlZmluZSgiY29yZG92YSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgY2hhbm5lbCA9IHJlcXVpcmUoJ2NvcmRvdmEvY2hhbm5lbCcpOwoKLyoqCiAqIExpc3RlbiBmb3IgRE9NQ29udGVudExvYWRlZCBhbmQgbm90aWZ5IG91ciBjaGFubmVsIHN1YnNjcmliZXJzLgogKi8KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgY2hhbm5lbC5vbkRPTUNvbnRlbnRMb2FkZWQuZmlyZSgpOwp9LCBmYWxzZSk7CmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PSAnaW50ZXJhY3RpdmUnKSB7CiAgICBjaGFubmVsLm9uRE9NQ29udGVudExvYWRlZC5maXJlKCk7Cn0KCi8qKgogKiBJbnRlcmNlcHQgY2FsbHMgdG8gYWRkRXZlbnRMaXN0ZW5lciArIHJlbW92ZUV2ZW50TGlzdGVuZXIgYW5kIGhhbmRsZSBkZXZpY2VyZWFkeSwKICogcmVzdW1lLCBhbmQgcGF1c2UgZXZlbnRzLgogKi8KdmFyIG1fZG9jdW1lbnRfYWRkRXZlbnRMaXN0ZW5lciA9IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXI7CnZhciBtX2RvY3VtZW50X3JlbW92ZUV2ZW50TGlzdGVuZXIgPSBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyOwp2YXIgbV93aW5kb3dfYWRkRXZlbnRMaXN0ZW5lciA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwp2YXIgbV93aW5kb3dfcmVtb3ZlRXZlbnRMaXN0ZW5lciA9IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyOwoKLyoqCiAqIEhvdXNlcyBjdXN0b20gZXZlbnQgaGFuZGxlcnMgdG8gaW50ZXJjZXB0IG9uIGRvY3VtZW50ICsgd2luZG93IGV2ZW50IGxpc3RlbmVycy4KICovCnZhciBkb2N1bWVudEV2ZW50SGFuZGxlcnMgPSB7fSwKICAgIHdpbmRvd0V2ZW50SGFuZGxlcnMgPSB7fTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBlID0gZXZ0LnRvTG93ZXJDYXNlKCk7CiAgICBpZiAodHlwZW9mIGRvY3VtZW50RXZlbnRIYW5kbGVyc1tlXSAhPSAndW5kZWZpbmVkJykgewogICAgICAgIGlmIChldnQgPT09ICdkZXZpY2VyZWFkeScpIHsKICAgICAgICAgICAgZG9jdW1lbnRFdmVudEhhbmRsZXJzW2VdLnN1YnNjcmliZU9uY2UoaGFuZGxlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnRFdmVudEhhbmRsZXJzW2VdLnN1YnNjcmliZShoYW5kbGVyKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIG1fZG9jdW1lbnRfYWRkRXZlbnRMaXN0ZW5lci5jYWxsKGRvY3VtZW50LCBldnQsIGhhbmRsZXIsIGNhcHR1cmUpOwogICAgfQp9OwoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBlID0gZXZ0LnRvTG93ZXJDYXNlKCk7CiAgICBpZiAodHlwZW9mIHdpbmRvd0V2ZW50SGFuZGxlcnNbZV0gIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB3aW5kb3dFdmVudEhhbmRsZXJzW2VdLnN1YnNjcmliZShoYW5kbGVyKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbV93aW5kb3dfYWRkRXZlbnRMaXN0ZW5lci5jYWxsKHdpbmRvdywgZXZ0LCBoYW5kbGVyLCBjYXB0dXJlKTsKICAgIH0KfTsKCmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBlID0gZXZ0LnRvTG93ZXJDYXNlKCk7CiAgICAvLyBJZiB1bnN1YmNyaWJpbmcgZnJvbSBhbiBldmVudCB0aGF0IGlzIGhhbmRsZWQgYnkgYSBwbHVnaW4KICAgIGlmICh0eXBlb2YgZG9jdW1lbnRFdmVudEhhbmRsZXJzW2VdICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgZG9jdW1lbnRFdmVudEhhbmRsZXJzW2VdLnVuc3Vic2NyaWJlKGhhbmRsZXIpOwogICAgfSBlbHNlIHsKICAgICAgICBtX2RvY3VtZW50X3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbChkb2N1bWVudCwgZXZ0LCBoYW5kbGVyLCBjYXB0dXJlKTsKICAgIH0KfTsKCndpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZ0LCBoYW5kbGVyLCBjYXB0dXJlKSB7CiAgICB2YXIgZSA9IGV2dC50b0xvd2VyQ2FzZSgpOwogICAgLy8gSWYgdW5zdWJjcmliaW5nIGZyb20gYW4gZXZlbnQgdGhhdCBpcyBoYW5kbGVkIGJ5IGEgcGx1Z2luCiAgICBpZiAodHlwZW9mIHdpbmRvd0V2ZW50SGFuZGxlcnNbZV0gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICB3aW5kb3dFdmVudEhhbmRsZXJzW2VdLnVuc3Vic2NyaWJlKGhhbmRsZXIpOwogICAgfSBlbHNlIHsKICAgICAgICBtX3dpbmRvd19yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwod2luZG93LCBldnQsIGhhbmRsZXIsIGNhcHR1cmUpOwogICAgfQp9OwoKZnVuY3Rpb24gY3JlYXRlRXZlbnQodHlwZSwgZGF0YSkgewogICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50cycpOwogICAgZXZlbnQuaW5pdEV2ZW50KHR5cGUsIGZhbHNlLCBmYWxzZSk7CiAgICBpZiAoZGF0YSkgewogICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgZXZlbnRbaV0gPSBkYXRhW2ldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGV2ZW50Owp9CgppZih0eXBlb2Ygd2luZG93LmNvbnNvbGUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICB3aW5kb3cuY29uc29sZSA9IHsKICAgICAgICBsb2c6ZnVuY3Rpb24oKXt9CiAgICB9Owp9Cgp2YXIgY29yZG92YSA9IHsKICAgIGRlZmluZTpkZWZpbmUsCiAgICByZXF1aXJlOnJlcXVpcmUsCiAgICAvKioKICAgICAqIE1ldGhvZHMgdG8gYWRkL3JlbW92ZSB5b3VyIG93biBhZGRFdmVudExpc3RlbmVyIGhpamFja2luZyBvbiBkb2N1bWVudCArIHdpbmRvdy4KICAgICAqLwogICAgYWRkV2luZG93RXZlbnRIYW5kbGVyOmZ1bmN0aW9uKGV2ZW50LCBvcHRzKSB7CiAgICAgICAgcmV0dXJuICh3aW5kb3dFdmVudEhhbmRsZXJzW2V2ZW50XSA9IGNoYW5uZWwuY3JlYXRlKGV2ZW50LCBvcHRzKSk7CiAgICB9LAogICAgYWRkRG9jdW1lbnRFdmVudEhhbmRsZXI6ZnVuY3Rpb24oZXZlbnQsIG9wdHMpIHsKICAgICAgICByZXR1cm4gKGRvY3VtZW50RXZlbnRIYW5kbGVyc1tldmVudF0gPSBjaGFubmVsLmNyZWF0ZShldmVudCwgb3B0cykpOwogICAgfSwKICAgIHJlbW92ZVdpbmRvd0V2ZW50SGFuZGxlcjpmdW5jdGlvbihldmVudCkgewogICAgICAgIGRlbGV0ZSB3aW5kb3dFdmVudEhhbmRsZXJzW2V2ZW50XTsKICAgIH0sCiAgICByZW1vdmVEb2N1bWVudEV2ZW50SGFuZGxlcjpmdW5jdGlvbihldmVudCkgewogICAgICAgIGRlbGV0ZSBkb2N1bWVudEV2ZW50SGFuZGxlcnNbZXZlbnRdOwogICAgfSwKICAgIC8qKgogICAgICogUmV0cmVpdmUgb3JpZ2luYWwgZXZlbnQgaGFuZGxlcnMgdGhhdCB3ZXJlIHJlcGxhY2VkIGJ5IENvcmRvdmEKICAgICAqCiAgICAgKiBAcmV0dXJuIG9iamVjdAogICAgICovCiAgICBnZXRPcmlnaW5hbEhhbmRsZXJzOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4geydkb2N1bWVudCc6IHsnYWRkRXZlbnRMaXN0ZW5lcic6IG1fZG9jdW1lbnRfYWRkRXZlbnRMaXN0ZW5lciwgJ3JlbW92ZUV2ZW50TGlzdGVuZXInOiBtX2RvY3VtZW50X3JlbW92ZUV2ZW50TGlzdGVuZXJ9LAogICAgICAgICd3aW5kb3cnOiB7J2FkZEV2ZW50TGlzdGVuZXInOiBtX3dpbmRvd19hZGRFdmVudExpc3RlbmVyLCAncmVtb3ZlRXZlbnRMaXN0ZW5lcic6IG1fd2luZG93X3JlbW92ZUV2ZW50TGlzdGVuZXJ9fTsKICAgIH0sCiAgICAvKioKICAgICAqIE1ldGhvZCB0byBmaXJlIGV2ZW50IGZyb20gbmF0aXZlIGNvZGUKICAgICAqLwogICAgZmlyZURvY3VtZW50RXZlbnQ6IGZ1bmN0aW9uKHR5cGUsIGRhdGEpIHsKICAgICAgICB2YXIgZXZ0ID0gY3JlYXRlRXZlbnQodHlwZSwgZGF0YSk7CiAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudEV2ZW50SGFuZGxlcnNbdHlwZV0gIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50RXZlbnRIYW5kbGVyc1t0eXBlXS5maXJlKGV2dCk7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZXZ0KTsKICAgICAgICB9CiAgICB9LAogICAgZmlyZVdpbmRvd0V2ZW50OiBmdW5jdGlvbih0eXBlLCBkYXRhKSB7CiAgICAgICAgdmFyIGV2dCA9IGNyZWF0ZUV2ZW50KHR5cGUsZGF0YSk7CiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3dFdmVudEhhbmRsZXJzW3R5cGVdICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB3aW5kb3dFdmVudEhhbmRsZXJzW3R5cGVdLmZpcmUoZXZ0KTsKICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZ0KTsKICAgICAgICB9CiAgICB9LAogICAgLy8gVE9ETzogdGhpcyBpcyBBbmRyb2lkIG9ubHk7IHRoaW5rIGFib3V0IGhvdyB0byBkbyB0aGlzIGJldHRlcgogICAgc2h1dHRpbmdEb3duOmZhbHNlLAogICAgVXNlUG9sbGluZzpmYWxzZSwKICAgIC8vIEVORCBUT0RPCgogICAgLy8gVE9ETzogaU9TIG9ubHkKICAgIC8vIFRoaXMgcXVldWUgaG9sZHMgdGhlIGN1cnJlbnRseSBleGVjdXRpbmcgY29tbWFuZCBhbmQgYWxsIHBlbmRpbmcKICAgIC8vIGNvbW1hbmRzIGV4ZWN1dGVkIHdpdGggY29yZG92YS5leGVjKCkuCiAgICBjb21tYW5kUXVldWU6W10sCiAgICAvLyBJbmRpY2F0ZXMgaWYgd2UncmUgY3VycmVudGx5IGluIHRoZSBtaWRkbGUgb2YgZmx1c2hpbmcgdGhlIGNvbW1hbmQKICAgIC8vIHF1ZXVlIG9uIHRoZSBuYXRpdmUgc2lkZS4KICAgIGNvbW1hbmRRdWV1ZUZsdXNoaW5nOmZhbHNlLAogICAgLy8gRU5EIFRPRE8KICAgIC8qKgogICAgICogUGx1Z2luIGNhbGxiYWNrIG1lY2hhbmlzbS4KICAgICAqLwogICAgY2FsbGJhY2tJZDogMCwKICAgIGNhbGxiYWNrczogIHt9LAogICAgY2FsbGJhY2tTdGF0dXM6IHsKICAgICAgICBOT19SRVNVTFQ6IDAsCiAgICAgICAgT0s6IDEsCiAgICAgICAgQ0xBU1NfTk9UX0ZPVU5EX0VYQ0VQVElPTjogMiwKICAgICAgICBJTExFR0FMX0FDQ0VTU19FWENFUFRJT046IDMsCiAgICAgICAgSU5TVEFOVElBVElPTl9FWENFUFRJT046IDQsCiAgICAgICAgTUFMRk9STUVEX1VSTF9FWENFUFRJT046IDUsCiAgICAgICAgSU9fRVhDRVBUSU9OOiA2LAogICAgICAgIElOVkFMSURfQUNUSU9OOiA3LAogICAgICAgIEpTT05fRVhDRVBUSU9OOiA4LAogICAgICAgIEVSUk9SOiA5CiAgICB9LAoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IG5hdGl2ZSBjb2RlIHdoZW4gcmV0dXJuaW5nIHN1Y2Nlc3NmdWwgcmVzdWx0IGZyb20gYW4gYWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjYWxsYmFja0lkCiAgICAgKiBAcGFyYW0gYXJncwogICAgICovCiAgICBjYWxsYmFja1N1Y2Nlc3M6IGZ1bmN0aW9uKGNhbGxiYWNrSWQsIGFyZ3MpIHsKICAgICAgICBpZiAoY29yZG92YS5jYWxsYmFja3NbY2FsbGJhY2tJZF0pIHsKCiAgICAgICAgICAgIC8vIElmIHJlc3VsdCBpcyB0byBiZSBzZW50IHRvIGNhbGxiYWNrCiAgICAgICAgICAgIGlmIChhcmdzLnN0YXR1cyA9PSBjb3Jkb3ZhLmNhbGxiYWNrU3RhdHVzLk9LKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb3Jkb3ZhLmNhbGxiYWNrc1tjYWxsYmFja0lkXS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLnN1Y2Nlc3MoYXJncy5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciBpbiBzdWNjZXNzIGNhbGxiYWNrOiAiK2NhbGxiYWNrSWQrIiA9ICIrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENsZWFyIGNhbGxiYWNrIGlmIG5vdCBleHBlY3RpbmcgYW55IG1vcmUgcmVzdWx0cwogICAgICAgICAgICBpZiAoIWFyZ3Mua2VlcENhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgY29yZG92YS5jYWxsYmFja3NbY2FsbGJhY2tJZF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IG5hdGl2ZSBjb2RlIHdoZW4gcmV0dXJuaW5nIGVycm9yIHJlc3VsdCBmcm9tIGFuIGFjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY2FsbGJhY2tJZAogICAgICogQHBhcmFtIGFyZ3MKICAgICAqLwogICAgY2FsbGJhY2tFcnJvcjogZnVuY3Rpb24oY2FsbGJhY2tJZCwgYXJncykgewogICAgICAgIGlmIChjb3Jkb3ZhLmNhbGxiYWNrc1tjYWxsYmFja0lkXSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLmZhaWwpIHsKICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLmNhbGxiYWNrc1tjYWxsYmFja0lkXS5mYWlsKGFyZ3MubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciBpbiBlcnJvciBjYWxsYmFjazogIitjYWxsYmFja0lkKyIgPSAiK2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDbGVhciBjYWxsYmFjayBpZiBub3QgZXhwZWN0aW5nIGFueSBtb3JlIHJlc3VsdHMKICAgICAgICAgICAgaWYgKCFhcmdzLmtlZXBDYWxsYmFjaykgewogICAgICAgICAgICAgICAgZGVsZXRlIGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGFkZENvbnN0cnVjdG9yOiBmdW5jdGlvbihmdW5jKSB7CiAgICAgICAgY2hhbm5lbC5vbkNvcmRvdmFSZWFkeS5zdWJzY3JpYmVPbmNlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZnVuYygpOwogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgdG8gcnVuIGNvbnN0cnVjdG9yOiAiICsgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KfTsKCi8vIFJlZ2lzdGVyIHBhdXNlLCByZXN1bWUgYW5kIGRldmljZXJlYWR5IGNoYW5uZWxzIGFzIGV2ZW50cyBvbiBkb2N1bWVudC4KY2hhbm5lbC5vblBhdXNlID0gY29yZG92YS5hZGREb2N1bWVudEV2ZW50SGFuZGxlcigncGF1c2UnKTsKY2hhbm5lbC5vblJlc3VtZSA9IGNvcmRvdmEuYWRkRG9jdW1lbnRFdmVudEhhbmRsZXIoJ3Jlc3VtZScpOwpjaGFubmVsLm9uRGV2aWNlUmVhZHkgPSBjb3Jkb3ZhLmFkZERvY3VtZW50RXZlbnRIYW5kbGVyKCdkZXZpY2VyZWFkeScpOwoKbW9kdWxlLmV4cG9ydHMgPSBjb3Jkb3ZhOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL2J1aWxkZXIuanMKZGVmaW5lKCJjb3Jkb3ZhL2J1aWxkZXIiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIHV0aWxzID0gcmVxdWlyZSgnY29yZG92YS91dGlscycpOwoKZnVuY3Rpb24gZWFjaChvYmplY3RzLCBmdW5jLCBjb250ZXh0KSB7CiAgICBmb3IgKHZhciBwcm9wIGluIG9iamVjdHMpIHsKICAgICAgICBpZiAob2JqZWN0cy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIFtvYmplY3RzW3Byb3BdLCBwcm9wXSk7CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBpbmNsdWRlKHBhcmVudCwgb2JqZWN0cywgY2xvYmJlciwgbWVyZ2UpIHsKICAgIGVhY2gob2JqZWN0cywgZnVuY3Rpb24gKG9iaiwga2V5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciByZXN1bHQgPSBvYmoucGF0aCA/IHJlcXVpcmUob2JqLnBhdGgpIDoge307CgogICAgICAgICAgaWYgKGNsb2JiZXIpIHsKICAgICAgICAgICAgICAvLyBDbG9iYmVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QuCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJlbnRba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgcGFyZW50W2tleV0gPSByZXN1bHQ7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqLnBhdGggIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgIC8vIElmIG1lcmdpbmcsIG1lcmdlIHByb3BlcnRpZXMgb250byBwYXJlbnQsIG90aGVyd2lzZSwgY2xvYmJlci4KICAgICAgICAgICAgICAgICAgaWYgKG1lcmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVNZXJnZShwYXJlbnRba2V5XSwgcmVzdWx0KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFtrZXldID0gcmVzdWx0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJlc3VsdCA9IHBhcmVudFtrZXldOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gT3ZlcndyaXRlIGlmIG5vdCBjdXJyZW50bHkgZGVmaW5lZC4KICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJlbnRba2V5XSA9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIHBhcmVudFtrZXldID0gcmVzdWx0OwogICAgICAgICAgICB9IGVsc2UgaWYgKG1lcmdlICYmIHR5cGVvZiBvYmoucGF0aCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAvLyBJZiBtZXJnaW5nLCBtZXJnZSBwYXJlbnQgb250byByZXN1bHQKICAgICAgICAgICAgICByZWN1cnNpdmVNZXJnZShyZXN1bHQsIHBhcmVudFtrZXldKTsKICAgICAgICAgICAgICBwYXJlbnRba2V5XSA9IHJlc3VsdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBTZXQgcmVzdWx0IHRvIHdoYXQgYWxyZWFkeSBleGlzdHMsIHNvIHdlIGNhbiBidWlsZCBjaGlsZHJlbiBpbnRvIGl0IGlmIHRoZXkgZXhpc3QuCiAgICAgICAgICAgICAgcmVzdWx0ID0gcGFyZW50W2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob2JqLmNoaWxkcmVuKSB7CiAgICAgICAgICAgIGluY2x1ZGUocmVzdWx0LCBvYmouY2hpbGRyZW4sIGNsb2JiZXIsIG1lcmdlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgIHV0aWxzLmFsZXJ0KCdFeGNlcHRpb24gYnVpbGRpbmcgY29yZG92YSBKUyBnbG9iYWxzOiAnICsgZSArICcgZm9yIGtleSAiJyArIGtleSArICciJyk7CiAgICAgICAgfQogICAgfSk7Cn0KCi8qKgogKiBNZXJnZSBwcm9wZXJ0aWVzIGZyb20gb25lIG9iamVjdCBvbnRvIGFub3RoZXIgcmVjdXJzaXZlbHkuICBQcm9wZXJ0aWVzIGZyb20KICogdGhlIHNyYyBvYmplY3Qgd2lsbCBvdmVyd3JpdGUgZXhpc3RpbmcgdGFyZ2V0IHByb3BlcnR5LgogKgogKiBAcGFyYW0gdGFyZ2V0IE9iamVjdCB0byBtZXJnZSBwcm9wZXJ0aWVzIGludG8uCiAqIEBwYXJhbSBzcmMgT2JqZWN0IHRvIG1lcmdlIHByb3BlcnRpZXMgZnJvbS4KICovCmZ1bmN0aW9uIHJlY3Vyc2l2ZU1lcmdlKHRhcmdldCwgc3JjKSB7CiAgICBmb3IgKHZhciBwcm9wIGluIHNyYykgewogICAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0YXJnZXQucHJvdG90eXBlICE9PSAndW5kZWZpbmVkJyAmJiB0YXJnZXQucHJvdG90eXBlLmNvbnN0cnVjdG9yID09PSB0YXJnZXQpIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0YXJnZXQgb2JqZWN0IGlzIGEgY29uc3RydWN0b3Igb3ZlcnJpZGUgb2ZmIHByb3RvdHlwZS4KICAgICAgICAgICAgICAgIHRhcmdldC5wcm90b3R5cGVbcHJvcF0gPSBzcmNbcHJvcF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0gPSB0eXBlb2Ygc3JjW3Byb3BdID09PSAnb2JqZWN0JyA/IHJlY3Vyc2l2ZU1lcmdlKAogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0sIHNyY1twcm9wXSkgOiBzcmNbcHJvcF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdGFyZ2V0Owp9Cgptb2R1bGUuZXhwb3J0cyA9IHsKICAgIGJ1aWxkOiBmdW5jdGlvbiAob2JqZWN0cykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGludG9CdXREb250Q2xvYmJlcjogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgICAgICAgaW5jbHVkZSh0YXJnZXQsIG9iamVjdHMsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGludG9BbmRDbG9iYmVyOiBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGluY2x1ZGUodGFyZ2V0LCBvYmplY3RzLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGludG9BbmRNZXJnZTogZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBpbmNsdWRlKHRhcmdldCwgb2JqZWN0cywgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQp9OwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL2NoYW5uZWwuanMKZGVmaW5lKCJjb3Jkb3ZhL2NoYW5uZWwiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIHV0aWxzID0gcmVxdWlyZSgnY29yZG92YS91dGlscycpOwoKLyoqCiAqIEN1c3RvbSBwdWItc3ViICJjaGFubmVsIiB0aGF0IGNhbiBoYXZlIGZ1bmN0aW9ucyBzdWJzY3JpYmVkIHRvIGl0CiAqIFRoaXMgb2JqZWN0IGlzIHVzZWQgdG8gZGVmaW5lIGFuZCBjb250cm9sIGZpcmluZyBvZiBldmVudHMgZm9yCiAqIGNvcmRvdmEgaW5pdGlhbGl6YXRpb24uCiAqCiAqIFRoZSBvcmRlciBvZiBldmVudHMgZHVyaW5nIHBhZ2UgbG9hZCBhbmQgQ29yZG92YSBzdGFydHVwIGlzIGFzIGZvbGxvd3M6CiAqCiAqIG9uRE9NQ29udGVudExvYWRlZCAgICAgICAgIEludGVybmFsIGV2ZW50IHRoYXQgaXMgcmVjZWl2ZWQgd2hlbiB0aGUgd2ViIHBhZ2UgaXMgbG9hZGVkIGFuZCBwYXJzZWQuCiAqIG9uTmF0aXZlUmVhZHkgICAgICAgICAgICAgIEludGVybmFsIGV2ZW50IHRoYXQgaW5kaWNhdGVzIHRoZSBDb3Jkb3ZhIG5hdGl2ZSBzaWRlIGlzIHJlYWR5LgogKiBvbkNvcmRvdmFSZWFkeSAgICAgICAgICAgICBJbnRlcm5hbCBldmVudCBmaXJlZCB3aGVuIGFsbCBDb3Jkb3ZhIEphdmFTY3JpcHQgb2JqZWN0cyBoYXZlIGJlZW4gY3JlYXRlZC4KICogb25Db3Jkb3ZhSW5mb1JlYWR5ICAgICAgICAgSW50ZXJuYWwgZXZlbnQgZmlyZWQgd2hlbiBkZXZpY2UgcHJvcGVydGllcyBhcmUgYXZhaWxhYmxlLgogKiBvbkNvcmRvdmFDb25uZWN0aW9uUmVhZHkgICBJbnRlcm5hbCBldmVudCBmaXJlZCB3aGVuIHRoZSBjb25uZWN0aW9uIHByb3BlcnR5IGhhcyBiZWVuIHNldC4KICogb25EZXZpY2VSZWFkeSAgICAgICAgICAgICAgVXNlciBldmVudCBmaXJlZCB0byBpbmRpY2F0ZSB0aGF0IENvcmRvdmEgaXMgcmVhZHkKICogb25SZXN1bWUgICAgICAgICAgICAgICAgICAgVXNlciBldmVudCBmaXJlZCB0byBpbmRpY2F0ZSBhIHN0YXJ0L3Jlc3VtZSBsaWZlY3ljbGUgZXZlbnQKICogb25QYXVzZSAgICAgICAgICAgICAgICAgICAgVXNlciBldmVudCBmaXJlZCB0byBpbmRpY2F0ZSBhIHBhdXNlIGxpZmVjeWNsZSBldmVudAogKiBvbkRlc3Ryb3kgICAgICAgICAgICAgICAgICBJbnRlcm5hbCBldmVudCBmaXJlZCB3aGVuIGFwcCBpcyBiZWluZyBkZXN0cm95ZWQgKFVzZXIgc2hvdWxkIHVzZSB3aW5kb3cub251bmxvYWQgZXZlbnQsIG5vdCB0aGlzIG9uZSkuCiAqCiAqIFRoZSBvbmx5IENvcmRvdmEgZXZlbnRzIHRoYXQgdXNlciBjb2RlIHNob3VsZCByZWdpc3RlciBmb3IgYXJlOgogKiAgICAgIGRldmljZXJlYWR5ICAgICAgICAgICBDb3Jkb3ZhIG5hdGl2ZSBjb2RlIGlzIGluaXRpYWxpemVkIGFuZCBDb3Jkb3ZhIEFQSXMgY2FuIGJlIGNhbGxlZCBmcm9tIEphdmFTY3JpcHQKICogICAgICBwYXVzZSAgICAgICAgICAgICAgICAgQXBwIGhhcyBtb3ZlZCB0byBiYWNrZ3JvdW5kCiAqICAgICAgcmVzdW1lICAgICAgICAgICAgICAgIEFwcCBoYXMgcmV0dXJuZWQgdG8gZm9yZWdyb3VuZAogKgogKiBMaXN0ZW5lcnMgY2FuIGJlIHJlZ2lzdGVyZWQgYXM6CiAqICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZGV2aWNlcmVhZHkiLCBteURldmljZVJlYWR5TGlzdGVuZXIsIGZhbHNlKTsKICogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJyZXN1bWUiLCBteVJlc3VtZUxpc3RlbmVyLCBmYWxzZSk7CiAqICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicGF1c2UiLCBteVBhdXNlTGlzdGVuZXIsIGZhbHNlKTsKICoKICogVGhlIERPTSBsaWZlY3ljbGUgZXZlbnRzIHNob3VsZCBiZSB1c2VkIGZvciBzYXZpbmcgYW5kIHJlc3RvcmluZyBzdGF0ZQogKiAgICAgIHdpbmRvdy5vbmxvYWQKICogICAgICB3aW5kb3cub251bmxvYWQKICoKICovCgovKioKICogQ2hhbm5lbAogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHR5cGUgIFN0cmluZyB0aGUgY2hhbm5lbCBuYW1lCiAqIEBwYXJhbSBvcHRzICBPYmplY3Qgb3B0aW9ucyB0byBwYXNzIGludG8gdGhlIGNoYW5uZWwsIGN1cnJlbnRseQogKiAgICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzOgogKiAgICAgICAgICAgICAgICAgICAgIG9uU3Vic2NyaWJlOiBjYWxsYmFjayB0aGF0IGZpcmVzIHdoZW4KICogICAgICAgICAgICAgICAgICAgICAgIHNvbWV0aGluZyBzdWJzY3JpYmVzIHRvIHRoZSBDaGFubmVsLiBTZXRzCiAqICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0IHRvIHRoZSBDaGFubmVsLgogKiAgICAgICAgICAgICAgICAgICAgIG9uVW5zdWJzY3JpYmU6IGNhbGxiYWNrIHRoYXQgZmlyZXMgd2hlbgogKiAgICAgICAgICAgICAgICAgICAgICAgc29tZXRoaW5nIHVuc3Vic2NyaWJlcyB0byB0aGUgQ2hhbm5lbC4gU2V0cwogKiAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCB0byB0aGUgQ2hhbm5lbC4KICovCnZhciBDaGFubmVsID0gZnVuY3Rpb24odHlwZSwgb3B0cykgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuaGFuZGxlcnMgPSB7fTsKICAgIHRoaXMubnVtSGFuZGxlcnMgPSAwOwogICAgdGhpcy5ndWlkID0gMTsKICAgIHRoaXMuZmlyZWQgPSBmYWxzZTsKICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7CiAgICB0aGlzLmV2ZW50cyA9IHsKICAgICAgICBvblN1YnNjcmliZTpudWxsLAogICAgICAgIG9uVW5zdWJzY3JpYmU6bnVsbAogICAgfTsKICAgIGlmIChvcHRzKSB7CiAgICAgICAgaWYgKG9wdHMub25TdWJzY3JpYmUpIHRoaXMuZXZlbnRzLm9uU3Vic2NyaWJlID0gb3B0cy5vblN1YnNjcmliZTsKICAgICAgICBpZiAob3B0cy5vblVuc3Vic2NyaWJlKSB0aGlzLmV2ZW50cy5vblVuc3Vic2NyaWJlID0gb3B0cy5vblVuc3Vic2NyaWJlOwogICAgfQp9LAogICAgY2hhbm5lbCA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBDYWxscyB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gb25seSBhZnRlciBhbGwgb2YgdGhlIGNoYW5uZWxzIHNwZWNpZmllZAogICAgICAgICAqIGhhdmUgYmVlbiBmaXJlZC4KICAgICAgICAgKi8KICAgICAgICBqb2luOiBmdW5jdGlvbiAoaCwgYykgewogICAgICAgICAgICB2YXIgaSA9IGMubGVuZ3RoOwogICAgICAgICAgICB2YXIgbGVuID0gaTsKICAgICAgICAgICAgdmFyIGYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICghKC0taSkpIGgoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZm9yICh2YXIgaj0wOyBqPGxlbjsgaisrKSB7CiAgICAgICAgICAgICAgICAhY1tqXS5maXJlZD9jW2pdLnN1YnNjcmliZU9uY2UoZik6aS0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghaSkgaCgpOwogICAgICAgIH0sCiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAodHlwZSwgb3B0cykgewogICAgICAgICAgICBjaGFubmVsW3R5cGVdID0gbmV3IENoYW5uZWwodHlwZSwgb3B0cyk7CiAgICAgICAgICAgIHJldHVybiBjaGFubmVsW3R5cGVdOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGNvcmRvdmEgQ2hhbm5lbHMgdGhhdCBtdXN0IGZpcmUgYmVmb3JlICJkZXZpY2VyZWFkeSIgaXMgZmlyZWQuCiAgICAgICAgICovCiAgICAgICAgZGV2aWNlUmVhZHlDaGFubmVsc0FycmF5OiBbXSwKICAgICAgICBkZXZpY2VSZWFkeUNoYW5uZWxzTWFwOiB7fSwKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5kaWNhdGUgdGhhdCBhIGZlYXR1cmUgbmVlZHMgdG8gYmUgaW5pdGlhbGl6ZWQgYmVmb3JlIGl0IGlzIHJlYWR5IHRvIGJlIHVzZWQuCiAgICAgICAgICogVGhpcyBob2xkcyB1cCBDb3Jkb3ZhJ3MgImRldmljZXJlYWR5IiBldmVudCB1bnRpbCB0aGUgZmVhdHVyZSBoYXMgYmVlbiBpbml0aWFsaXplZAogICAgICAgICAqIGFuZCBDb3Jkb3ZhLmluaXRDb21wbGV0ZShmZWF0dXJlKSBpcyBjYWxsZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZmVhdHVyZSB7U3RyaW5nfSAgICAgVGhlIHVuaXF1ZSBmZWF0dXJlIG5hbWUKICAgICAgICAgKi8KICAgICAgICB3YWl0Rm9ySW5pdGlhbGl6YXRpb246IGZ1bmN0aW9uKGZlYXR1cmUpIHsKICAgICAgICAgICAgaWYgKGZlYXR1cmUpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICh0aGlzW2ZlYXR1cmVdKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXNbZmVhdHVyZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5jcmVhdGUoZmVhdHVyZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmRldmljZVJlYWR5Q2hhbm5lbHNNYXBbZmVhdHVyZV0gPSBjOwogICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VSZWFkeUNoYW5uZWxzQXJyYXkucHVzaChjKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEluZGljYXRlIHRoYXQgaW5pdGlhbGl6YXRpb24gY29kZSBoYXMgY29tcGxldGVkIGFuZCB0aGUgZmVhdHVyZSBpcyByZWFkeSB0byBiZSB1c2VkLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGZlYXR1cmUge1N0cmluZ30gICAgIFRoZSB1bmlxdWUgZmVhdHVyZSBuYW1lCiAgICAgICAgICovCiAgICAgICAgaW5pdGlhbGl6YXRpb25Db21wbGV0ZTogZnVuY3Rpb24oZmVhdHVyZSkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuZGV2aWNlUmVhZHlDaGFubmVsc01hcFtmZWF0dXJlXTsKICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgIGMuZmlyZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCmZ1bmN0aW9uIGZvcmNlRnVuY3Rpb24oZikgewogICAgaWYgKGYgPT09IG51bGwgfHwgZiA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBmICE9ICdmdW5jdGlvbicpIHRocm93ICJGdW5jdGlvbiByZXF1aXJlZCBhcyBmaXJzdCBhcmd1bWVudCEiOwp9CgovKioKICogU3Vic2NyaWJlcyB0aGUgZ2l2ZW4gZnVuY3Rpb24gdG8gdGhlIGNoYW5uZWwuIEFueSB0aW1lIHRoYXQKICogQ2hhbm5lbC5maXJlIGlzIGNhbGxlZCBzbyB0b28gd2lsbCB0aGUgZnVuY3Rpb24uCiAqIE9wdGlvbmFsbHkgc3BlY2lmeSBhbiBleGVjdXRpb24gY29udGV4dCBmb3IgdGhlIGZ1bmN0aW9uCiAqIGFuZCBhIGd1aWQgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9wIHN1YnNjcmliaW5nIHRvIHRoZSBjaGFubmVsLgogKiBSZXR1cm5zIHRoZSBndWlkLgogKi8KQ2hhbm5lbC5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24oZiwgYywgZykgewogICAgLy8gbmVlZCBhIGZ1bmN0aW9uIHRvIGNhbGwKICAgIGZvcmNlRnVuY3Rpb24oZik7CgogICAgdmFyIGZ1bmMgPSBmOwogICAgaWYgKHR5cGVvZiBjID09ICJvYmplY3QiKSB7IGZ1bmMgPSB1dGlscy5jbG9zZShjLCBmKTsgfQoKICAgIGcgPSBnIHx8IGZ1bmMub2JzZXJ2ZXJfZ3VpZCB8fCBmLm9ic2VydmVyX2d1aWQ7CiAgICBpZiAoIWcpIHsKICAgICAgICAvLyBmaXJzdCB0aW1lIHdlJ3ZlIHNlZW4gdGhpcyBzdWJzY3JpYmVyCiAgICAgICAgZyA9IHRoaXMuZ3VpZCsrOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgLy8gc3Vic2NyaWJlciBhbHJlYWR5IGhhbmRsZWQ7IGRvbnQgc2V0IGl0IHR3aWNlCiAgICAgICAgcmV0dXJuIGc7CiAgICB9CiAgICBmdW5jLm9ic2VydmVyX2d1aWQgPSBnOwogICAgZi5vYnNlcnZlcl9ndWlkID0gZzsKICAgIHRoaXMuaGFuZGxlcnNbZ10gPSBmdW5jOwogICAgdGhpcy5udW1IYW5kbGVycysrOwogICAgaWYgKHRoaXMuZXZlbnRzLm9uU3Vic2NyaWJlKSB0aGlzLmV2ZW50cy5vblN1YnNjcmliZS5jYWxsKHRoaXMpOwogICAgaWYgKHRoaXMuZmlyZWQpIGZ1bmMuY2FsbCh0aGlzKTsKICAgIHJldHVybiBnOwp9OwoKLyoqCiAqIExpa2Ugc3Vic2NyaWJlIGJ1dCB0aGUgZnVuY3Rpb24gaXMgb25seSBjYWxsZWQgb25jZSBhbmQgdGhlbiBpdAogKiBhdXRvLXVuc3Vic2NyaWJlcyBpdHNlbGYuCiAqLwpDaGFubmVsLnByb3RvdHlwZS5zdWJzY3JpYmVPbmNlID0gZnVuY3Rpb24oZiwgYykgewogICAgLy8gbmVlZCBhIGZ1bmN0aW9uIHRvIGNhbGwKICAgIGZvcmNlRnVuY3Rpb24oZik7CgogICAgdmFyIGcgPSBudWxsOwogICAgdmFyIF90aGlzID0gdGhpczsKICAgIHZhciBtID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZi5hcHBseShjIHx8IG51bGwsIGFyZ3VtZW50cyk7CiAgICAgICAgX3RoaXMudW5zdWJzY3JpYmUoZyk7CiAgICB9OwogICAgaWYgKHRoaXMuZmlyZWQpIHsKICAgICAgICBpZiAodHlwZW9mIGMgPT0gIm9iamVjdCIpIHsgZiA9IHV0aWxzLmNsb3NlKGMsIGYpOyB9CiAgICAgICAgZi5hcHBseSh0aGlzLCB0aGlzLmZpcmVBcmdzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZyA9IHRoaXMuc3Vic2NyaWJlKG0pOwogICAgfQogICAgcmV0dXJuIGc7Cn07CgovKioKICogVW5zdWJzY3JpYmVzIHRoZSBmdW5jdGlvbiB3aXRoIHRoZSBnaXZlbiBndWlkIGZyb20gdGhlIGNoYW5uZWwuCiAqLwpDaGFubmVsLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uKGcpIHsKICAgIC8vIG5lZWQgYSBmdW5jdGlvbiB0byB1bnN1YnNjcmliZQogICAgaWYgKGcgPT09IG51bGwgfHwgZyA9PT0gdW5kZWZpbmVkKSB7IHRocm93ICJZb3UgbXVzdCBwYXNzIF9zb21ldGhpbmdfIGludG8gQ2hhbm5lbC51bnN1YnNjcmliZSI7IH0KCiAgICBpZiAodHlwZW9mIGcgPT0gJ2Z1bmN0aW9uJykgeyBnID0gZy5vYnNlcnZlcl9ndWlkOyB9CiAgICB2YXIgaGFuZGxlciA9IHRoaXMuaGFuZGxlcnNbZ107CiAgICBpZiAoaGFuZGxlcikgewogICAgICAgIGlmIChoYW5kbGVyLm9ic2VydmVyX2d1aWQpIGhhbmRsZXIub2JzZXJ2ZXJfZ3VpZD1udWxsOwogICAgICAgIHRoaXMuaGFuZGxlcnNbZ10gPSBudWxsOwogICAgICAgIGRlbGV0ZSB0aGlzLmhhbmRsZXJzW2ddOwogICAgICAgIHRoaXMubnVtSGFuZGxlcnMtLTsKICAgICAgICBpZiAodGhpcy5ldmVudHMub25VbnN1YnNjcmliZSkgdGhpcy5ldmVudHMub25VbnN1YnNjcmliZS5jYWxsKHRoaXMpOwogICAgfQp9OwoKLyoqCiAqIENhbGxzIGFsbCBmdW5jdGlvbnMgc3Vic2NyaWJlZCB0byB0aGlzIGNoYW5uZWwuCiAqLwpDaGFubmVsLnByb3RvdHlwZS5maXJlID0gZnVuY3Rpb24oZSkgewogICAgaWYgKHRoaXMuZW5hYmxlZCkgewogICAgICAgIHZhciBmYWlsID0gZmFsc2U7CiAgICAgICAgdGhpcy5maXJlZCA9IHRydWU7CiAgICAgICAgZm9yICh2YXIgaXRlbSBpbiB0aGlzLmhhbmRsZXJzKSB7CiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5oYW5kbGVyc1tpdGVtXTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHZhciBydiA9IChoYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk9PT1mYWxzZSk7CiAgICAgICAgICAgICAgICBmYWlsID0gZmFpbCB8fCBydjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmZpcmVBcmdzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiAhZmFpbDsKICAgIH0KICAgIHJldHVybiB0cnVlOwp9OwoKLy8gZGVmaW5pbmcgdGhlbSBoZXJlIHNvIHRoZXkgYXJlIHJlYWR5IHN1cGVyIGZhc3QhCi8vIERPTSBldmVudCB0aGF0IGlzIHJlY2VpdmVkIHdoZW4gdGhlIHdlYiBwYWdlIGlzIGxvYWRlZCBhbmQgcGFyc2VkLgpjaGFubmVsLmNyZWF0ZSgnb25ET01Db250ZW50TG9hZGVkJyk7CgovLyBFdmVudCB0byBpbmRpY2F0ZSB0aGUgQ29yZG92YSBuYXRpdmUgc2lkZSBpcyByZWFkeS4KY2hhbm5lbC5jcmVhdGUoJ29uTmF0aXZlUmVhZHknKTsKCi8vIEV2ZW50IHRvIGluZGljYXRlIHRoYXQgYWxsIENvcmRvdmEgSmF2YVNjcmlwdCBvYmplY3RzIGhhdmUgYmVlbiBjcmVhdGVkCi8vIGFuZCBpdCdzIHRpbWUgdG8gcnVuIHBsdWdpbiBjb25zdHJ1Y3RvcnMuCmNoYW5uZWwuY3JlYXRlKCdvbkNvcmRvdmFSZWFkeScpOwoKLy8gRXZlbnQgdG8gaW5kaWNhdGUgdGhhdCBkZXZpY2UgcHJvcGVydGllcyBhcmUgYXZhaWxhYmxlCmNoYW5uZWwuY3JlYXRlKCdvbkNvcmRvdmFJbmZvUmVhZHknKTsKCi8vIEV2ZW50IHRvIGluZGljYXRlIHRoYXQgdGhlIGNvbm5lY3Rpb24gcHJvcGVydHkgaGFzIGJlZW4gc2V0LgpjaGFubmVsLmNyZWF0ZSgnb25Db3Jkb3ZhQ29ubmVjdGlvblJlYWR5Jyk7CgovLyBFdmVudCB0byBpbmRpY2F0ZSB0aGF0IENvcmRvdmEgaXMgcmVhZHkKY2hhbm5lbC5jcmVhdGUoJ29uRGV2aWNlUmVhZHknKTsKCi8vIEV2ZW50IHRvIGluZGljYXRlIGEgcmVzdW1lIGxpZmVjeWNsZSBldmVudApjaGFubmVsLmNyZWF0ZSgnb25SZXN1bWUnKTsKCi8vIEV2ZW50IHRvIGluZGljYXRlIGEgcGF1c2UgbGlmZWN5Y2xlIGV2ZW50CmNoYW5uZWwuY3JlYXRlKCdvblBhdXNlJyk7CgovLyBFdmVudCB0byBpbmRpY2F0ZSBhIGRlc3Ryb3kgbGlmZWN5Y2xlIGV2ZW50CmNoYW5uZWwuY3JlYXRlKCdvbkRlc3Ryb3knKTsKCi8vIENoYW5uZWxzIHRoYXQgbXVzdCBmaXJlIGJlZm9yZSAiZGV2aWNlcmVhZHkiIGlzIGZpcmVkLgpjaGFubmVsLndhaXRGb3JJbml0aWFsaXphdGlvbignb25Db3Jkb3ZhUmVhZHknKTsKY2hhbm5lbC53YWl0Rm9ySW5pdGlhbGl6YXRpb24oJ29uQ29yZG92YUNvbm5lY3Rpb25SZWFkeScpOwoKbW9kdWxlLmV4cG9ydHMgPSBjaGFubmVsOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL2NvbW1vbi5qcwpkZWZpbmUoImNvcmRvdmEvY29tbW9uIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Cm1vZHVsZS5leHBvcnRzID0gewogICAgb2JqZWN0czogewogICAgICAgIGNvcmRvdmE6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEnLAogICAgICAgICAgICBjaGlsZHJlbjogewogICAgICAgICAgICAgICAgZXhlYzogewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL2V4ZWMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9nZ2VyOiB7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL2xvZ2dlcicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgQ29yZG92YTogewogICAgICAgICAgICBjaGlsZHJlbjogewogICAgICAgICAgICAgICAgZXhlYzogewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL2V4ZWMnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIFBob25lR2FwOnsKICAgICAgICAgICAgY2hpbGRyZW46IHsKICAgICAgICAgICAgICAgIGV4ZWM6IHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAnY29yZG92YS9leGVjJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBuYXZpZ2F0b3I6IHsKICAgICAgICAgICAgY2hpbGRyZW46IHsKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbjogewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9ub3RpZmljYXRpb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWNjZWxlcm9tZXRlcjogewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9hY2NlbGVyb21ldGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJhdHRlcnk6IHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vYmF0dGVyeScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYW1lcmE6ewogICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9DYW1lcmEnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29tcGFzczp7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL2NvbXBhc3MnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29udGFjdHM6IHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vY29udGFjdHMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGV2aWNlOnsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjp7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9jYXB0dXJlJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdlb2xvY2F0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL2dlb2xvY2F0aW9uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG5ldHdvcms6IHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogewogICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vbmV0d29yaycKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzcGxhc2hzY3JlZW46IHsKICAgICAgICAgICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vc3BsYXNoc2NyZWVuJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBBY2NlbGVyYXRpb246IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0FjY2VsZXJhdGlvbicKICAgICAgICB9LAogICAgICAgIENhbWVyYTp7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9DYW1lcmFDb25zdGFudHMnCiAgICAgICAgfSwKICAgICAgICBDYW1lcmFQb3BvdmVyT3B0aW9uczogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ2FtZXJhUG9wb3Zlck9wdGlvbnMnCiAgICAgICAgfSwKICAgICAgICBDYXB0dXJlRXJyb3I6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0NhcHR1cmVFcnJvcicKICAgICAgICB9LAogICAgICAgIENhcHR1cmVBdWRpb09wdGlvbnM6ewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ2FwdHVyZUF1ZGlvT3B0aW9ucycKICAgICAgICB9LAogICAgICAgIENhcHR1cmVJbWFnZU9wdGlvbnM6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0NhcHR1cmVJbWFnZU9wdGlvbnMnCiAgICAgICAgfSwKICAgICAgICBDYXB0dXJlVmlkZW9PcHRpb25zOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9DYXB0dXJlVmlkZW9PcHRpb25zJwogICAgICAgIH0sCiAgICAgICAgQ29tcGFzc0hlYWRpbmc6ewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29tcGFzc0hlYWRpbmcnCiAgICAgICAgfSwKICAgICAgICBDb21wYXNzRXJyb3I6ewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29tcGFzc0Vycm9yJwogICAgICAgIH0sCiAgICAgICAgQ29uZmlndXJhdGlvbkRhdGE6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0NvbmZpZ3VyYXRpb25EYXRhJwogICAgICAgIH0sCiAgICAgICAgQ29ubmVjdGlvbjogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29ubmVjdGlvbicKICAgICAgICB9LAogICAgICAgIENvbnRhY3Q6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0NvbnRhY3QnCiAgICAgICAgfSwKICAgICAgICBDb250YWN0QWRkcmVzczogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29udGFjdEFkZHJlc3MnCiAgICAgICAgfSwKICAgICAgICBDb250YWN0RXJyb3I6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0NvbnRhY3RFcnJvcicKICAgICAgICB9LAogICAgICAgIENvbnRhY3RGaWVsZDogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29udGFjdEZpZWxkJwogICAgICAgIH0sCiAgICAgICAgQ29udGFjdEZpbmRPcHRpb25zOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9Db250YWN0RmluZE9wdGlvbnMnCiAgICAgICAgfSwKICAgICAgICBDb250YWN0TmFtZTogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vQ29udGFjdE5hbWUnCiAgICAgICAgfSwKICAgICAgICBDb250YWN0T3JnYW5pemF0aW9uOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9Db250YWN0T3JnYW5pemF0aW9uJwogICAgICAgIH0sCiAgICAgICAgQ29vcmRpbmF0ZXM6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0Nvb3JkaW5hdGVzJwogICAgICAgIH0sCiAgICAgICAgZGV2aWNlOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9kZXZpY2UnCiAgICAgICAgfSwKICAgICAgICBEaXJlY3RvcnlFbnRyeTogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnknCiAgICAgICAgfSwKICAgICAgICBEaXJlY3RvcnlSZWFkZXI6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0RpcmVjdG9yeVJlYWRlcicKICAgICAgICB9LAogICAgICAgIEVudHJ5OiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9FbnRyeScKICAgICAgICB9LAogICAgICAgIEZpbGU6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZpbGUnCiAgICAgICAgfSwKICAgICAgICBGaWxlRW50cnk6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFbnRyeScKICAgICAgICB9LAogICAgICAgIEZpbGVFcnJvcjogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJwogICAgICAgIH0sCiAgICAgICAgRmlsZVJlYWRlcjogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vRmlsZVJlYWRlcicKICAgICAgICB9LAogICAgICAgIEZpbGVTeXN0ZW06IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZpbGVTeXN0ZW0nCiAgICAgICAgfSwKICAgICAgICBGaWxlVHJhbnNmZXI6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZpbGVUcmFuc2ZlcicKICAgICAgICB9LAogICAgICAgIEZpbGVUcmFuc2ZlckVycm9yOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9GaWxlVHJhbnNmZXJFcnJvcicKICAgICAgICB9LAogICAgICAgIEZpbGVVcGxvYWRPcHRpb25zOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9GaWxlVXBsb2FkT3B0aW9ucycKICAgICAgICB9LAogICAgICAgIEZpbGVVcGxvYWRSZXN1bHQ6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZpbGVVcGxvYWRSZXN1bHQnCiAgICAgICAgfSwKICAgICAgICBGaWxlV3JpdGVyOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9GaWxlV3JpdGVyJwogICAgICAgIH0sCiAgICAgICAgRmxhZ3M6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL0ZsYWdzJwogICAgICAgIH0sCiAgICAgICAgTG9jYWxGaWxlU3lzdGVtOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9Mb2NhbEZpbGVTeXN0ZW0nCiAgICAgICAgfSwKICAgICAgICBNZWRpYTogewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vTWVkaWEnCiAgICAgICAgfSwKICAgICAgICBNZWRpYUVycm9yOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9NZWRpYUVycm9yJwogICAgICAgIH0sCiAgICAgICAgTWVkaWFGaWxlOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9NZWRpYUZpbGUnCiAgICAgICAgfSwKICAgICAgICBNZWRpYUZpbGVEYXRhOnsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL01lZGlhRmlsZURhdGEnCiAgICAgICAgfSwKICAgICAgICBNZXRhZGF0YTp7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9NZXRhZGF0YScKICAgICAgICB9LAogICAgICAgIFBvc2l0aW9uOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9Qb3NpdGlvbicKICAgICAgICB9LAogICAgICAgIFBvc2l0aW9uRXJyb3I6IHsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL1Bvc2l0aW9uRXJyb3InCiAgICAgICAgfSwKICAgICAgICBQcm9ncmVzc0V2ZW50OiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9Qcm9ncmVzc0V2ZW50JwogICAgICAgIH0sCiAgICAgICAgcmVxdWVzdEZpbGVTeXN0ZW06ewogICAgICAgICAgICBwYXRoOiAnY29yZG92YS9wbHVnaW4vcmVxdWVzdEZpbGVTeXN0ZW0nCiAgICAgICAgfSwKICAgICAgICByZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJOnsKICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL3Jlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkknCiAgICAgICAgfQogICAgfQp9OwoKfSk7CgovLyBmaWxlOiBsaWIvYW5kcm9pZC9leGVjLmpzCmRlZmluZSgiY29yZG92YS9leGVjIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBFeGVjdXRlIGEgY29yZG92YSBjb21tYW5kLiAgSXQgaXMgdXAgdG8gdGhlIG5hdGl2ZSBzaWRlIHdoZXRoZXIgdGhpcyBhY3Rpb24KICogaXMgc3luY2hyb25vdXMgb3IgYXN5bmNocm9ub3VzLiAgVGhlIG5hdGl2ZSBzaWRlIGNhbiByZXR1cm46CiAqICAgICAgU3luY2hyb25vdXM6IFBsdWdpblJlc3VsdCBvYmplY3QgYXMgYSBKU09OIHN0cmluZwogKiAgICAgIEFzeW5jaHJvdW5vdXM6IEVtcHR5IHN0cmluZyAiIgogKiBJZiBhc3luYywgdGhlIG5hdGl2ZSBzaWRlIHdpbGwgY29yZG92YS5jYWxsYmFja1N1Y2Nlc3Mgb3IgY29yZG92YS5jYWxsYmFja0Vycm9yLAogKiBkZXBlbmRpbmcgdXBvbiB0aGUgcmVzdWx0IG9mIHRoZSBhY3Rpb24uCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3MgICAgVGhlIHN1Y2Nlc3MgY2FsbGJhY2sKICogQHBhcmFtIHtGdW5jdGlvbn0gZmFpbCAgICAgICBUaGUgZmFpbCBjYWxsYmFjawogKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZSAgICAgIFRoZSBuYW1lIG9mIHRoZSBzZXJ2aWNlIHRvIHVzZQogKiBAcGFyYW0ge1N0cmluZ30gYWN0aW9uICAgICAgIEFjdGlvbiB0byBiZSBydW4gaW4gY29yZG92YQogKiBAcGFyYW0ge1N0cmluZ1tdfSBbYXJnc10gICAgIFplcm8gb3IgbW9yZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kCiAqLwp2YXIgY29yZG92YSA9IHJlcXVpcmUoJ2NvcmRvdmEnKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oc3VjY2VzcywgZmFpbCwgc2VydmljZSwgYWN0aW9uLCBhcmdzKSB7CiAgdHJ5IHsKICAgIHZhciBjYWxsYmFja0lkID0gc2VydmljZSArIGNvcmRvdmEuY2FsbGJhY2tJZCsrOwogICAgaWYgKHN1Y2Nlc3MgfHwgZmFpbCkgewogICAgICAgIGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdID0ge3N1Y2Nlc3M6c3VjY2VzcywgZmFpbDpmYWlsfTsKICAgIH0KCiAgICB2YXIgciA9IHByb21wdChKU09OLnN0cmluZ2lmeShhcmdzKSwgImdhcDoiK0pTT04uc3RyaW5naWZ5KFtzZXJ2aWNlLCBhY3Rpb24sIGNhbGxiYWNrSWQsIHRydWVdKSk7CgogICAgLy8gSWYgYSByZXN1bHQgd2FzIHJldHVybmVkCiAgICBpZiAoci5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHYgPSBKU09OLnBhcnNlKHIpOwoKICAgICAgICAvLyBJZiBzdGF0dXMgaXMgT0ssIHRoZW4gcmV0dXJuIHZhbHVlIGJhY2sgdG8gY2FsbGVyCiAgICAgICAgaWYgKHYuc3RhdHVzID09PSBjb3Jkb3ZhLmNhbGxiYWNrU3RhdHVzLk9LKSB7CgogICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIHN1Y2Nlc3MgY2FsbGJhY2ssIHRoZW4gY2FsbCBpdCBub3cgd2l0aAogICAgICAgICAgICAvLyByZXR1cm5lZCB2YWx1ZQogICAgICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHYubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkVycm9yIGluIHN1Y2Nlc3MgY2FsbGJhY2s6ICIgKyBjYWxsYmFja0lkICArICIgPSAiICsgZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ2xlYXIgY2FsbGJhY2sgaWYgbm90IGV4cGVjdGluZyBhbnkgbW9yZSByZXN1bHRzCiAgICAgICAgICAgICAgICBpZiAoIXYua2VlcENhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2Lm1lc3NhZ2U7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBubyByZXN1bHQKICAgICAgICBlbHNlIGlmICh2LnN0YXR1cyA9PT0gY29yZG92YS5jYWxsYmFja1N0YXR1cy5OT19SRVNVTFQpIHsKICAgICAgICAgICAgLy8gQ2xlYXIgY2FsbGJhY2sgaWYgbm90IGV4cGVjdGluZyBhbnkgbW9yZSByZXN1bHRzCiAgICAgICAgICAgIGlmICghdi5rZWVwQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjb3Jkb3ZhLmNhbGxiYWNrc1tjYWxsYmFja0lkXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSWYgZXJyb3IsIHRoZW4gZGlzcGxheSBlcnJvcgogICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3I6IFN0YXR1cz0iK3Yuc3RhdHVzKyIgTWVzc2FnZT0iK3YubWVzc2FnZSk7CgogICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIGZhaWwgY2FsbGJhY2ssIHRoZW4gY2FsbCBpdCBub3cgd2l0aCByZXR1cm5lZCB2YWx1ZQogICAgICAgICAgICBpZiAoZmFpbCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBmYWlsKHYubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZTEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW4gZXJyb3IgY2FsbGJhY2s6ICIrY2FsbGJhY2tJZCsiID0gIitlMSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ2xlYXIgY2FsbGJhY2sgaWYgbm90IGV4cGVjdGluZyBhbnkgbW9yZSByZXN1bHRzCiAgICAgICAgICAgICAgICBpZiAoIXYua2VlcENhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvcmRvdmEuY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KICB9IGNhdGNoIChlMikgewogICAgY29uc29sZS5sb2coIkVycm9yOiAiK2UyKTsKICB9Cn07Cgp9KTsKCi8vIGZpbGU6IGxpYi9hbmRyb2lkL3BsYXRmb3JtLmpzCmRlZmluZSgiY29yZG92YS9wbGF0Zm9ybSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewptb2R1bGUuZXhwb3J0cyA9IHsKICAgIGlkOiAiYW5kcm9pZCIsCiAgICBpbml0aWFsaXplOmZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjaGFubmVsID0gcmVxdWlyZSgiY29yZG92YS9jaGFubmVsIiksCiAgICAgICAgICAgIGNvcmRvdmEgPSByZXF1aXJlKCdjb3Jkb3ZhJyksCiAgICAgICAgICAgIGNhbGxiYWNrID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vYW5kcm9pZC9jYWxsYmFjaycpLAogICAgICAgICAgICBwb2xsaW5nID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vYW5kcm9pZC9wb2xsaW5nJyksCiAgICAgICAgICAgIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKCiAgICAgICAgY2hhbm5lbC5vbkRlc3Ryb3kuc3Vic2NyaWJlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjb3Jkb3ZhLnNodXR0aW5nRG93biA9IHRydWU7CiAgICAgICAgfSk7CgogICAgICAgIC8vIFN0YXJ0IGxpc3RlbmluZyBmb3IgWEhSIGNhbGxiYWNrcwogICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggYnJpZGdlIGFwcHJvYWNoIHdpbGwgd29yayBvbiB0aGlzIEFuZHJvaWQKICAgICAgICAvLyBkZXZpY2U6IHBvbGxpbmcgb3IgWEhSLWJhc2VkIGNhbGxiYWNrcwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChjb3Jkb3ZhLlVzZVBvbGxpbmcpIHsKICAgICAgICAgICAgICAgIHBvbGxpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBpc1BvbGxpbmcgPSBwcm9tcHQoInVzZVBvbGxpbmciLCAiZ2FwX2NhbGxiYWNrU2VydmVyOiIpOwogICAgICAgICAgICAgICAgY29yZG92YS5Vc2VQb2xsaW5nID0gaXNQb2xsaW5nOwogICAgICAgICAgICAgICAgaWYgKGlzUG9sbGluZyA9PSAidHJ1ZSIpIHsKICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLlVzZVBvbGxpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHBvbGxpbmcoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5Vc2VQb2xsaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIDEpOwoKICAgICAgICAvLyBJbmplY3QgYSBsaXN0ZW5lciBmb3IgdGhlIGJhY2tidXR0b24gb24gdGhlIGRvY3VtZW50LgogICAgICAgIHZhciBiYWNrQnV0dG9uQ2hhbm5lbCA9IGNvcmRvdmEuYWRkRG9jdW1lbnRFdmVudEhhbmRsZXIoJ2JhY2tidXR0b24nLCB7CiAgICAgICAgICAgIG9uU3Vic2NyaWJlOmZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gSWYgd2UganVzdCBhdHRhY2hlZCB0aGUgZmlyc3QgaGFuZGxlciwgbGV0IG5hdGl2ZSBrbm93IHdlIG5lZWQgdG8gb3ZlcnJpZGUgdGhlIGJhY2sgYnV0dG9uLgogICAgICAgICAgICAgICAgaWYgKHRoaXMubnVtSGFuZGxlcnMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBleGVjKG51bGwsIG51bGwsICJBcHAiLCAib3ZlcnJpZGVCYWNrYnV0dG9uIiwgW3RydWVdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25VbnN1YnNjcmliZTpmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIElmIHdlIGp1c3QgZGV0YWNoZWQgdGhlIGxhc3QgaGFuZGxlciwgbGV0IG5hdGl2ZSBrbm93IHdlIG5vIGxvbmdlciBvdmVycmlkZSB0aGUgYmFjayBidXR0b24uCiAgICAgICAgICAgICAgICBpZiAodGhpcy5udW1IYW5kbGVycyA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgIkFwcCIsICJvdmVycmlkZUJhY2tidXR0b24iLCBbZmFsc2VdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBBZGQgaGFyZHdhcmUgTUVOVSBhbmQgU0VBUkNIIGJ1dHRvbiBoYW5kbGVycwogICAgICAgIGNvcmRvdmEuYWRkRG9jdW1lbnRFdmVudEhhbmRsZXIoJ21lbnVidXR0b24nKTsKICAgICAgICBjb3Jkb3ZhLmFkZERvY3VtZW50RXZlbnRIYW5kbGVyKCdzZWFyY2hidXR0b24nKTsKCiAgICAgICAgLy8gRmlndXJlIG91dCBpZiB3ZSBuZWVkIHRvIHNoaW0taW4gbG9jYWxTdG9yYWdlIGFuZCBXZWJTUUwKICAgICAgICAvLyBzdXBwb3J0IGZyb20gdGhlIG5hdGl2ZSBzaWRlLgogICAgICAgIHZhciBzdG9yYWdlID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vYW5kcm9pZC9zdG9yYWdlJyk7CgogICAgICAgIC8vIEZpcnN0IHBhdGNoIFdlYlNRTCBpZiBuZWNlc3NhcnkKICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5vcGVuRGF0YWJhc2UgPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgLy8gTm90IGRlZmluZWQsIGNyZWF0ZSBhbiBvcGVuRGF0YWJhc2UgZnVuY3Rpb24gZm9yIGFsbCB0byB1c2UhCiAgICAgICAgICAgIHdpbmRvdy5vcGVuRGF0YWJhc2UgPSBzdG9yYWdlLm9wZW5EYXRhYmFzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBEZWZpbmVkLCBidXQgc29tZSBBbmRyb2lkIGRldmljZXMgd2lsbCB0aHJvdyBhIFNFQ1VSSVRZX0VSUiAtCiAgICAgICAgICAgIC8vIHNvIHdlIHdyYXAgdGhlIHdob2xlIHRoaW5nIGluIGEgdHJ5LWNhdGNoIGFuZCBzaGltIGluIG91ciBvd24KICAgICAgICAgICAgLy8gaWYgdGhlIGRldmljZSBoYXMgQW5kcm9pZCBidWcgMTYxNzUuCiAgICAgICAgICAgIHZhciBvcmlnaW5hbE9wZW5EYXRhYmFzZSA9IHdpbmRvdy5vcGVuRGF0YWJhc2U7CiAgICAgICAgICAgIHdpbmRvdy5vcGVuRGF0YWJhc2UgPSBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCBkZXNjLCBzaXplKSB7CiAgICAgICAgICAgICAgICB2YXIgZGIgPSBudWxsOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBkYiA9IG9yaWdpbmFsT3BlbkRhdGFiYXNlKG5hbWUsIHZlcnNpb24sIGRlc2MsIHNpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4LmNvZGUgPT09IDE4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRiID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGRiID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0b3JhZ2Uub3BlbkRhdGFiYXNlKG5hbWUsIHZlcnNpb24sIGRlc2MsIHNpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIC8vIFBhdGNoIGxvY2FsU3RvcmFnZSBpZiBuZWNlc3NhcnkKICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5sb2NhbFN0b3JhZ2UgPT0gJ3VuZGVmaW5lZCcgfHwgd2luZG93LmxvY2FsU3RvcmFnZSA9PT0gbnVsbCkgewogICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlID0gbmV3IHN0b3JhZ2UuQ3VwY2FrZUxvY2FsU3RvcmFnZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gTGV0IG5hdGl2ZSBjb2RlIGtub3cgd2UgYXJlIGFsbCBkb25lIG9uIHRoZSBKUyBzaWRlLgogICAgICAgIC8vIE5hdGl2ZSBjb2RlIHdpbGwgdGhlbiB1bi1oaWRlIHRoZSBXZWJWaWV3LgogICAgICAgIGNoYW5uZWwuam9pbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgZXhlYyhudWxsLCBudWxsLCAiQXBwIiwgInNob3ciLCBbXSk7CiAgICAgICAgfSwgW2NoYW5uZWwub25Db3Jkb3ZhUmVhZHldKTsKICAgIH0sCiAgICBvYmplY3RzOiB7CiAgICAgICAgY29yZG92YTogewogICAgICAgICAgICBjaGlsZHJlbjogewogICAgICAgICAgICAgICAgSlNDYWxsYmFjazp7CiAgICAgICAgICAgICAgICAgICAgcGF0aDoiY29yZG92YS9wbHVnaW4vYW5kcm9pZC9jYWxsYmFjayIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBKU0NhbGxiYWNrUG9sbGluZzp7CiAgICAgICAgICAgICAgICAgICAgcGF0aDoiY29yZG92YS9wbHVnaW4vYW5kcm9pZC9wb2xsaW5nIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBuYXZpZ2F0b3I6IHsKICAgICAgICAgICAgY2hpbGRyZW46IHsKICAgICAgICAgICAgICAgIGFwcDp7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogImNvcmRvdmEvcGx1Z2luL2FuZHJvaWQvYXBwIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBGaWxlOiB7IC8vIGV4aXN0cyBuYXRpdmVseSBvbiBBbmRyb2lkIFdlYlZpZXcsIG92ZXJyaWRlCiAgICAgICAgICAgIHBhdGg6ICJjb3Jkb3ZhL3BsdWdpbi9GaWxlIgogICAgICAgIH0sCiAgICAgICAgRmlsZVJlYWRlcjogeyAvLyBleGlzdHMgbmF0aXZlbHkgb24gQW5kcm9pZCBXZWJWaWV3LCBvdmVycmlkZQogICAgICAgICAgICBwYXRoOiAiY29yZG92YS9wbHVnaW4vRmlsZVJlYWRlciIKICAgICAgICB9LAogICAgICAgIEZpbGVFcnJvcjogeyAvL2V4aXN0cyBuYXRpdmVseSBvbiBBbmRyb2lkIFdlYlZpZXcgb24gQW5kcm9pZCA0LngKICAgICAgICAgICAgcGF0aDogImNvcmRvdmEvcGx1Z2luL0ZpbGVFcnJvciIKICAgICAgICB9LAogICAgICAgIE1lZGlhRXJyb3I6IHsgLy8gZXhpc3RzIG5hdGl2ZWx5IG9uIEFuZHJvaWQgV2ViVmlldyBvbiBBbmRyb2lkIDQueAogICAgICAgICAgICBwYXRoOiAiY29yZG92YS9wbHVnaW4vTWVkaWFFcnJvciIKICAgICAgICB9CiAgICB9LAogICAgbWVyZ2VzOiB7CiAgICAgICAgZGV2aWNlOiB7CiAgICAgICAgICAgIHBhdGg6ICdjb3Jkb3ZhL3BsdWdpbi9hbmRyb2lkL2RldmljZScKICAgICAgICB9LAogICAgICAgIG5hdmlnYXRvcjogewogICAgICAgICAgICBjaGlsZHJlbjogewogICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ2NvcmRvdmEvcGx1Z2luL2FuZHJvaWQvbm90aWZpY2F0aW9uJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9BY2NlbGVyYXRpb24uanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9BY2NlbGVyYXRpb24iLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIEFjY2VsZXJhdGlvbiA9IGZ1bmN0aW9uKHgsIHksIHosIHRpbWVzdGFtcCkgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLnogPSB6OwogICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXAgfHwgKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gQWNjZWxlcmF0aW9uOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9DYW1lcmEuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9DYW1lcmEiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIENhbWVyYSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0NhbWVyYUNvbnN0YW50cycpOwoKdmFyIGNhbWVyYUV4cG9ydCA9IHt9OwoKLy8gVGFjayBvbiB0aGUgQ2FtZXJhIENvbnN0YW50cyB0byB0aGUgYmFzZSBjYW1lcmEgcGx1Z2luLgpmb3IgKHZhciBrZXkgaW4gQ2FtZXJhKSB7CiAgICBjYW1lcmFFeHBvcnRba2V5XSA9IENhbWVyYVtrZXldOwp9CgovKioKICogR2V0cyBhIHBpY3R1cmUgZnJvbSBzb3VyY2UgZGVmaW5lZCBieSAib3B0aW9ucy5zb3VyY2VUeXBlIiwgYW5kIHJldHVybnMgdGhlCiAqIGltYWdlIGFzIGRlZmluZWQgYnkgdGhlICJvcHRpb25zLmRlc3RpbmF0aW9uVHlwZSIgb3B0aW9uLgoKICogVGhlIGRlZmF1bHRzIGFyZSBzb3VyY2VUeXBlPUNBTUVSQSBhbmQgZGVzdGluYXRpb25UeXBlPUZJTEVfVVJJLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjawogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKi8KY2FtZXJhRXhwb3J0LmdldFBpY3R1cmUgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUubG9nKCJDYW1lcmEgRXJyb3I6IHN1Y2Nlc3NDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBlcnJvckNhbGxiYWNrIG9wdGlvbmFsCiAgICBpZiAoZXJyb3JDYWxsYmFjayAmJiAodHlwZW9mIGVycm9yQ2FsbGJhY2sgIT0gImZ1bmN0aW9uIikpIHsKICAgICAgICBjb25zb2xlLmxvZygiQ2FtZXJhIEVycm9yOiBlcnJvckNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBxdWFsaXR5ID0gNTA7CiAgICBpZiAob3B0aW9ucyAmJiB0eXBlb2Ygb3B0aW9ucy5xdWFsaXR5ID09ICJudW1iZXIiKSB7CiAgICAgICAgcXVhbGl0eSA9IG9wdGlvbnMucXVhbGl0eTsKICAgIH0gZWxzZSBpZiAob3B0aW9ucyAmJiB0eXBlb2Ygb3B0aW9ucy5xdWFsaXR5ID09ICJzdHJpbmciKSB7CiAgICAgICAgdmFyIHFsaXR5ID0gcGFyc2VJbnQob3B0aW9ucy5xdWFsaXR5LCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKHFsaXR5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcXVhbGl0eSA9IHFsaXR5LnZhbHVlT2YoKTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIGRlc3RpbmF0aW9uVHlwZSA9IENhbWVyYS5EZXN0aW5hdGlvblR5cGUuRklMRV9VUkk7CiAgICBpZiAodHlwZW9mIG9wdGlvbnMuZGVzdGluYXRpb25UeXBlID09ICJudW1iZXIiKSB7CiAgICAgICAgZGVzdGluYXRpb25UeXBlID0gb3B0aW9ucy5kZXN0aW5hdGlvblR5cGU7CiAgICB9CgogICAgdmFyIHNvdXJjZVR5cGUgPSBDYW1lcmEuUGljdHVyZVNvdXJjZVR5cGUuQ0FNRVJBOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLnNvdXJjZVR5cGUgPT0gIm51bWJlciIpIHsKICAgICAgICBzb3VyY2VUeXBlID0gb3B0aW9ucy5zb3VyY2VUeXBlOwogICAgfQoKICAgIHZhciB0YXJnZXRXaWR0aCA9IC0xOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLnRhcmdldFdpZHRoID09ICJudW1iZXIiKSB7CiAgICAgICAgdGFyZ2V0V2lkdGggPSBvcHRpb25zLnRhcmdldFdpZHRoOwogICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy50YXJnZXRXaWR0aCA9PSAic3RyaW5nIikgewogICAgICAgIHZhciB3aWR0aCA9IHBhcnNlSW50KG9wdGlvbnMudGFyZ2V0V2lkdGgsIDEwKTsKICAgICAgICBpZiAoaXNOYU4od2lkdGgpID09PSBmYWxzZSkgewogICAgICAgICAgICB0YXJnZXRXaWR0aCA9IHdpZHRoLnZhbHVlT2YoKTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIHRhcmdldEhlaWdodCA9IC0xOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLnRhcmdldEhlaWdodCA9PSAibnVtYmVyIikgewogICAgICAgIHRhcmdldEhlaWdodCA9IG9wdGlvbnMudGFyZ2V0SGVpZ2h0OwogICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy50YXJnZXRIZWlnaHQgPT0gInN0cmluZyIpIHsKICAgICAgICB2YXIgaGVpZ2h0ID0gcGFyc2VJbnQob3B0aW9ucy50YXJnZXRIZWlnaHQsIDEwKTsKICAgICAgICBpZiAoaXNOYU4oaGVpZ2h0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gaGVpZ2h0LnZhbHVlT2YoKTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIGVuY29kaW5nVHlwZSA9IENhbWVyYS5FbmNvZGluZ1R5cGUuSlBFRzsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5lbmNvZGluZ1R5cGUgPT0gIm51bWJlciIpIHsKICAgICAgICBlbmNvZGluZ1R5cGUgPSBvcHRpb25zLmVuY29kaW5nVHlwZTsKICAgIH0KCiAgICB2YXIgbWVkaWFUeXBlID0gQ2FtZXJhLk1lZGlhVHlwZS5QSUNUVVJFOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLm1lZGlhVHlwZSA9PSAibnVtYmVyIikgewogICAgICAgIG1lZGlhVHlwZSA9IG9wdGlvbnMubWVkaWFUeXBlOwogICAgfQogICAgdmFyIGFsbG93RWRpdCA9IGZhbHNlOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLmFsbG93RWRpdCA9PSAiYm9vbGVhbiIpIHsKICAgICAgICBhbGxvd0VkaXQgPSBvcHRpb25zLmFsbG93RWRpdDsKICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMuYWxsb3dFZGl0ID09ICJudW1iZXIiKSB7CiAgICAgICAgYWxsb3dFZGl0ID0gb3B0aW9ucy5hbGxvd0VkaXQgPD0gMCA/IGZhbHNlIDogdHJ1ZTsKICAgIH0KICAgIHZhciBjb3JyZWN0T3JpZW50YXRpb24gPSBmYWxzZTsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5jb3JyZWN0T3JpZW50YXRpb24gPT0gImJvb2xlYW4iKSB7CiAgICAgICAgY29ycmVjdE9yaWVudGF0aW9uID0gb3B0aW9ucy5jb3JyZWN0T3JpZW50YXRpb247CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLmNvcnJlY3RPcmllbnRhdGlvbiA9PSAibnVtYmVyIikgewogICAgICAgIGNvcnJlY3RPcmllbnRhdGlvbiA9IG9wdGlvbnMuY29ycmVjdE9yaWVudGF0aW9uIDw9MCA/IGZhbHNlIDogdHJ1ZTsKICAgIH0KICAgIHZhciBzYXZlVG9QaG90b0FsYnVtID0gZmFsc2U7CiAgICBpZiAodHlwZW9mIG9wdGlvbnMuc2F2ZVRvUGhvdG9BbGJ1bSA9PSAiYm9vbGVhbiIpIHsKICAgICAgICBzYXZlVG9QaG90b0FsYnVtID0gb3B0aW9ucy5zYXZlVG9QaG90b0FsYnVtOwogICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy5zYXZlVG9QaG90b0FsYnVtID09ICJudW1iZXIiKSB7CiAgICAgICAgc2F2ZVRvUGhvdG9BbGJ1bSA9IG9wdGlvbnMuc2F2ZVRvUGhvdG9BbGJ1bSA8PTAgPyBmYWxzZSA6IHRydWU7CiAgICB9CiAgICB2YXIgcG9wb3Zlck9wdGlvbnMgPSBudWxsOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLnBvcG92ZXJPcHRpb25zID09ICJvYmplY3QiKSB7CiAgICAgICAgcG9wb3Zlck9wdGlvbnMgPSBvcHRpb25zLnBvcG92ZXJPcHRpb25zOwogICAgfQoKICAgIHZhciBhcmdzID0gW3F1YWxpdHksIGRlc3RpbmF0aW9uVHlwZSwgc291cmNlVHlwZSwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCwgZW5jb2RpbmdUeXBlLAogICAgICAgICAgICAgICAgbWVkaWFUeXBlLCBhbGxvd0VkaXQsIGNvcnJlY3RPcmllbnRhdGlvbiwgc2F2ZVRvUGhvdG9BbGJ1bSwgcG9wb3Zlck9wdGlvbnNdOwoKICAgIGV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ2FtZXJhIiwgInRha2VQaWN0dXJlIiwgYXJncyk7Cn07CgpjYW1lcmFFeHBvcnQuY2xlYW51cCA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJDYW1lcmEiLCAiY2xlYW51cCIsIFtdKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gY2FtZXJhRXhwb3J0Owp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NhbWVyYUNvbnN0YW50cy5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0NhbWVyYUNvbnN0YW50cyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewptb2R1bGUuZXhwb3J0cyA9IHsKICBEZXN0aW5hdGlvblR5cGU6ewogICAgREFUQV9VUkw6IDAsICAgICAgICAgLy8gUmV0dXJuIGJhc2U2NCBlbmNvZGVkIHN0cmluZwogICAgRklMRV9VUkk6IDEgICAgICAgICAgLy8gUmV0dXJuIGZpbGUgdXJpIChjb250ZW50Oi8vbWVkaWEvZXh0ZXJuYWwvaW1hZ2VzL21lZGlhLzIgZm9yIEFuZHJvaWQpCiAgfSwKICBFbmNvZGluZ1R5cGU6ewogICAgSlBFRzogMCwgICAgICAgICAgICAgLy8gUmV0dXJuIEpQRUcgZW5jb2RlZCBpbWFnZQogICAgUE5HOiAxICAgICAgICAgICAgICAgLy8gUmV0dXJuIFBORyBlbmNvZGVkIGltYWdlCiAgfSwKICBNZWRpYVR5cGU6ewogICAgUElDVFVSRTogMCwgICAgICAgICAgLy8gYWxsb3cgc2VsZWN0aW9uIG9mIHN0aWxsIHBpY3R1cmVzIG9ubHkuIERFRkFVTFQuIFdpbGwgcmV0dXJuIGZvcm1hdCBzcGVjaWZpZWQgdmlhIERlc3RpbmF0aW9uVHlwZQogICAgVklERU86IDEsICAgICAgICAgICAgLy8gYWxsb3cgc2VsZWN0aW9uIG9mIHZpZGVvIG9ubHksIE9OTFkgUkVUVVJOUyBVUkwKICAgIEFMTE1FRElBIDogMiAgICAgICAgIC8vIGFsbG93IHNlbGVjdGlvbiBmcm9tIGFsbCBtZWRpYSB0eXBlcwogIH0sCiAgUGljdHVyZVNvdXJjZVR5cGU6ewogICAgUEhPVE9MSUJSQVJZIDogMCwgICAgLy8gQ2hvb3NlIGltYWdlIGZyb20gcGljdHVyZSBsaWJyYXJ5IChzYW1lIGFzIFNBVkVEUEhPVE9BTEJVTSBmb3IgQW5kcm9pZCkKICAgIENBTUVSQSA6IDEsICAgICAgICAgIC8vIFRha2UgcGljdHVyZSBmcm9tIGNhbWVyYQogICAgU0FWRURQSE9UT0FMQlVNIDogMiAgLy8gQ2hvb3NlIGltYWdlIGZyb20gcGljdHVyZSBsaWJyYXJ5IChzYW1lIGFzIFBIT1RPTElCUkFSWSBmb3IgQW5kcm9pZCkKICB9LAogIFBvcG92ZXJBcnJvd0RpcmVjdGlvbjp7CiAgICAgIEFSUk9XX1VQIDogMSwgICAgICAgIC8vIG1hdGNoZXMgaU9TIFVJUG9wb3ZlckFycm93RGlyZWN0aW9uIGNvbnN0YW50cyB0byBzcGVjaWZ5IGFycm93IGxvY2F0aW9uIG9uIHBvcG92ZXIKICAgICAgQVJST1dfRE9XTiA6IDIsCiAgICAgIEFSUk9XX0xFRlQgOiA0LAogICAgICBBUlJPV19SSUdIVCA6IDgsCiAgICAgIEFSUk9XX0FOWSA6IDE1CiAgfQp9Owp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NhbWVyYVBvcG92ZXJPcHRpb25zLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ2FtZXJhUG9wb3Zlck9wdGlvbnMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIENhbWVyYSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0NhbWVyYUNvbnN0YW50cycpOwoKLyoqCiAqIEVuY2Fwc3VsYXRlcyBvcHRpb25zIGZvciBpT1MgUG9wb3ZlciBpbWFnZSBwaWNrZXIKICovCnZhciBDYW1lcmFQb3BvdmVyT3B0aW9ucyA9IGZ1bmN0aW9uKHgseSx3aWR0aCxoZWlnaHQsYXJyb3dEaXIpewogICAgLy8gaW5mb3JtYXRpb24gb2YgcmVjdGFuZ2xlIHRoYXQgcG9wb3ZlciBzaG91bGQgYmUgYW5jaG9yZWQgdG8KICAgIHRoaXMueCA9IHggfHwgMDsKICAgIHRoaXMueSA9IHkgfHwgMzI7CiAgICB0aGlzLndpZHRoID0gd2lkdGggfHwgMzIwOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQgfHwgNDgwOwogICAgLy8gVGhlIGRpcmVjdGlvbiBvZiB0aGUgcG9wb3ZlciBhcnJvdwogICAgdGhpcy5hcnJvd0RpciA9IGFycm93RGlyIHx8IENhbWVyYS5Qb3BvdmVyQXJyb3dEaXJlY3Rpb24uQVJST1dfQU5ZOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBDYW1lcmFQb3BvdmVyT3B0aW9uczsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9DYXB0dXJlQXVkaW9PcHRpb25zLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ2FwdHVyZUF1ZGlvT3B0aW9ucyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogRW5jYXBzdWxhdGVzIGFsbCBhdWRpbyBjYXB0dXJlIG9wZXJhdGlvbiBjb25maWd1cmF0aW9uIG9wdGlvbnMuCiAqLwp2YXIgQ2FwdHVyZUF1ZGlvT3B0aW9ucyA9IGZ1bmN0aW9uKCl7CiAgICAvLyBVcHBlciBsaW1pdCBvZiBzb3VuZCBjbGlwcyB1c2VyIGNhbiByZWNvcmQuIFZhbHVlIG11c3QgYmUgZXF1YWwgb3IgZ3JlYXRlciB0aGFuIDEuCiAgICB0aGlzLmxpbWl0ID0gMTsKICAgIC8vIE1heGltdW0gZHVyYXRpb24gb2YgYSBzaW5nbGUgc291bmQgY2xpcCBpbiBzZWNvbmRzLgogICAgdGhpcy5kdXJhdGlvbiA9IDA7CiAgICAvLyBUaGUgc2VsZWN0ZWQgYXVkaW8gbW9kZS4gTXVzdCBtYXRjaCB3aXRoIG9uZSBvZiB0aGUgZWxlbWVudHMgaW4gc3VwcG9ydGVkQXVkaW9Nb2RlcyBhcnJheS4KICAgIHRoaXMubW9kZSA9IG51bGw7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IENhcHR1cmVBdWRpb09wdGlvbnM7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vQ2FwdHVyZUVycm9yLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ2FwdHVyZUVycm9yIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBUaGUgQ2FwdHVyZUVycm9yIGludGVyZmFjZSBlbmNhcHN1bGF0ZXMgYWxsIGVycm9ycyBpbiB0aGUgQ2FwdHVyZSBBUEkuCiAqLwp2YXIgQ2FwdHVyZUVycm9yID0gZnVuY3Rpb24oYykgewogICB0aGlzLmNvZGUgPSBjIHx8IG51bGw7Cn07CgovLyBDYW1lcmEgb3IgbWljcm9waG9uZSBmYWlsZWQgdG8gY2FwdHVyZSBpbWFnZSBvciBzb3VuZC4KQ2FwdHVyZUVycm9yLkNBUFRVUkVfSU5URVJOQUxfRVJSID0gMDsKLy8gQ2FtZXJhIGFwcGxpY2F0aW9uIG9yIGF1ZGlvIGNhcHR1cmUgYXBwbGljYXRpb24gaXMgY3VycmVudGx5IHNlcnZpbmcgb3RoZXIgY2FwdHVyZSByZXF1ZXN0LgpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9BUFBMSUNBVElPTl9CVVNZID0gMTsKLy8gSW52YWxpZCB1c2Ugb2YgdGhlIEFQSSAoZS5nLiBsaW1pdCBwYXJhbWV0ZXIgaGFzIHZhbHVlIGxlc3MgdGhhbiBvbmUpLgpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9JTlZBTElEX0FSR1VNRU5UID0gMjsKLy8gVXNlciBleGl0ZWQgY2FtZXJhIGFwcGxpY2F0aW9uIG9yIGF1ZGlvIGNhcHR1cmUgYXBwbGljYXRpb24gYmVmb3JlIGNhcHR1cmluZyBhbnl0aGluZy4KQ2FwdHVyZUVycm9yLkNBUFRVUkVfTk9fTUVESUFfRklMRVMgPSAzOwovLyBUaGUgcmVxdWVzdGVkIGNhcHR1cmUgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQuCkNhcHR1cmVFcnJvci5DQVBUVVJFX05PVF9TVVBQT1JURUQgPSAyMDsKCm1vZHVsZS5leHBvcnRzID0gQ2FwdHVyZUVycm9yOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NhcHR1cmVJbWFnZU9wdGlvbnMuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9DYXB0dXJlSW1hZ2VPcHRpb25zIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBFbmNhcHN1bGF0ZXMgYWxsIGltYWdlIGNhcHR1cmUgb3BlcmF0aW9uIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4KICovCnZhciBDYXB0dXJlSW1hZ2VPcHRpb25zID0gZnVuY3Rpb24oKXsKICAgIC8vIFVwcGVyIGxpbWl0IG9mIGltYWdlcyB1c2VyIGNhbiB0YWtlLiBWYWx1ZSBtdXN0IGJlIGVxdWFsIG9yIGdyZWF0ZXIgdGhhbiAxLgogICAgdGhpcy5saW1pdCA9IDE7CiAgICAvLyBUaGUgc2VsZWN0ZWQgaW1hZ2UgbW9kZS4gTXVzdCBtYXRjaCB3aXRoIG9uZSBvZiB0aGUgZWxlbWVudHMgaW4gc3VwcG9ydGVkSW1hZ2VNb2RlcyBhcnJheS4KICAgIHRoaXMubW9kZSA9IG51bGw7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IENhcHR1cmVJbWFnZU9wdGlvbnM7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vQ2FwdHVyZVZpZGVvT3B0aW9ucy5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0NhcHR1cmVWaWRlb09wdGlvbnMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIEVuY2Fwc3VsYXRlcyBhbGwgdmlkZW8gY2FwdHVyZSBvcGVyYXRpb24gY29uZmlndXJhdGlvbiBvcHRpb25zLgogKi8KdmFyIENhcHR1cmVWaWRlb09wdGlvbnMgPSBmdW5jdGlvbigpewogICAgLy8gVXBwZXIgbGltaXQgb2YgdmlkZW9zIHVzZXIgY2FuIHJlY29yZC4gVmFsdWUgbXVzdCBiZSBlcXVhbCBvciBncmVhdGVyIHRoYW4gMS4KICAgIHRoaXMubGltaXQgPSAxOwogICAgLy8gTWF4aW11bSBkdXJhdGlvbiBvZiBhIHNpbmdsZSB2aWRlbyBjbGlwIGluIHNlY29uZHMuCiAgICB0aGlzLmR1cmF0aW9uID0gMDsKICAgIC8vIFRoZSBzZWxlY3RlZCB2aWRlbyBtb2RlLiBNdXN0IG1hdGNoIHdpdGggb25lIG9mIHRoZSBlbGVtZW50cyBpbiBzdXBwb3J0ZWRWaWRlb01vZGVzIGFycmF5LgogICAgdGhpcy5tb2RlID0gbnVsbDsKfTsKCm1vZHVsZS5leHBvcnRzID0gQ2FwdHVyZVZpZGVvT3B0aW9uczsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Db21wYXNzRXJyb3IuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9Db21wYXNzRXJyb3IiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqICBDb21wYXNzRXJyb3IuCiAqICBBbiBlcnJvciBjb2RlIGFzc2lnbmVkIGJ5IGFuIGltcGxlbWVudGF0aW9uIHdoZW4gYW4gZXJyb3IgaGFzIG9jY3VyZWQKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgQ29tcGFzc0Vycm9yID0gZnVuY3Rpb24oZXJyKSB7CiAgICB0aGlzLmNvZGUgPSAoZXJyICE9PSB1bmRlZmluZWQgPyBlcnIgOiBudWxsKTsKfTsKCkNvbXBhc3NFcnJvci5DT01QQVNTX0lOVEVSTkFMX0VSUiA9IDA7CkNvbXBhc3NFcnJvci5DT01QQVNTX05PVF9TVVBQT1JURUQgPSAyMDsKCm1vZHVsZS5leHBvcnRzID0gQ29tcGFzc0Vycm9yOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NvbXBhc3NIZWFkaW5nLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ29tcGFzc0hlYWRpbmciLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIENvbXBhc3NIZWFkaW5nID0gZnVuY3Rpb24obWFnbmV0aWNIZWFkaW5nLCB0cnVlSGVhZGluZywgaGVhZGluZ0FjY3VyYWN5LCB0aW1lc3RhbXApIHsKICB0aGlzLm1hZ25ldGljSGVhZGluZyA9IChtYWduZXRpY0hlYWRpbmcgIT09IHVuZGVmaW5lZCA/IG1hZ25ldGljSGVhZGluZyA6IG51bGwpOwogIHRoaXMudHJ1ZUhlYWRpbmcgPSAodHJ1ZUhlYWRpbmcgIT09IHVuZGVmaW5lZCA/IHRydWVIZWFkaW5nIDogbnVsbCk7CiAgdGhpcy5oZWFkaW5nQWNjdXJhY3kgPSAoaGVhZGluZ0FjY3VyYWN5ICE9PSB1bmRlZmluZWQgPyBoZWFkaW5nQWNjdXJhY3kgOiBudWxsKTsKICB0aGlzLnRpbWVzdGFtcCA9ICh0aW1lc3RhbXAgIT09IHVuZGVmaW5lZCA/IHRpbWVzdGFtcCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gQ29tcGFzc0hlYWRpbmc7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vQ29uZmlndXJhdGlvbkRhdGEuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9Db25maWd1cmF0aW9uRGF0YSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogRW5jYXBzdWxhdGVzIGEgc2V0IG9mIHBhcmFtZXRlcnMgdGhhdCB0aGUgY2FwdHVyZSBkZXZpY2Ugc3VwcG9ydHMuCiAqLwpmdW5jdGlvbiBDb25maWd1cmF0aW9uRGF0YSgpIHsKICAgIC8vIFRoZSBBU0NJSS1lbmNvZGVkIHN0cmluZyBpbiBsb3dlciBjYXNlIHJlcHJlc2VudGluZyB0aGUgbWVkaWEgdHlwZS4KICAgIHRoaXMudHlwZSA9IG51bGw7CiAgICAvLyBUaGUgaGVpZ2h0IGF0dHJpYnV0ZSByZXByZXNlbnRzIGhlaWdodCBvZiB0aGUgaW1hZ2Ugb3IgdmlkZW8gaW4gcGl4ZWxzLgogICAgLy8gSW4gdGhlIGNhc2Ugb2YgYSBzb3VuZCBjbGlwIHRoaXMgYXR0cmlidXRlIGhhcyB2YWx1ZSAwLgogICAgdGhpcy5oZWlnaHQgPSAwOwogICAgLy8gVGhlIHdpZHRoIGF0dHJpYnV0ZSByZXByZXNlbnRzIHdpZHRoIG9mIHRoZSBpbWFnZSBvciB2aWRlbyBpbiBwaXhlbHMuCiAgICAvLyBJbiB0aGUgY2FzZSBvZiBhIHNvdW5kIGNsaXAgdGhpcyBhdHRyaWJ1dGUgaGFzIHZhbHVlIDAKICAgIHRoaXMud2lkdGggPSAwOwp9Cgptb2R1bGUuZXhwb3J0cyA9IENvbmZpZ3VyYXRpb25EYXRhOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0Nvbm5lY3Rpb24uanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9Db25uZWN0aW9uIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBOZXR3b3JrIHN0YXR1cwogKi8KbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgVU5LTk9XTjogInVua25vd24iLAogICAgICAgIEVUSEVSTkVUOiAiZXRoZXJuZXQiLAogICAgICAgIFdJRkk6ICJ3aWZpIiwKICAgICAgICBDRUxMXzJHOiAiMmciLAogICAgICAgIENFTExfM0c6ICIzZyIsCiAgICAgICAgQ0VMTF80RzogIjRnIiwKICAgICAgICBOT05FOiAibm9uZSIKfTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Db250YWN0LmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ29udGFjdCIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgQ29udGFjdEVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vQ29udGFjdEVycm9yJyksCiAgICB1dGlscyA9IHJlcXVpcmUoJ2NvcmRvdmEvdXRpbHMnKTsKCi8qKgoqIENvbnZlcnRzIHByaW1pdGl2ZXMgaW50byBDb21wbGV4IE9iamVjdAoqIEN1cnJlbnRseSBvbmx5IHVzZWQgZm9yIERhdGUgZmllbGRzCiovCmZ1bmN0aW9uIGNvbnZlcnRJbihjb250YWN0KSB7CiAgICB2YXIgdmFsdWUgPSBjb250YWN0LmJpcnRoZGF5OwogICAgdHJ5IHsKICAgICAgY29udGFjdC5iaXJ0aGRheSA9IG5ldyBEYXRlKHBhcnNlRmxvYXQodmFsdWUpKTsKICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbil7CiAgICAgIGNvbnNvbGUubG9nKCJDb3Jkb3ZhIENvbnRhY3QgY29udmVydEluIGVycm9yOiBleGNlcHRpb24gY3JlYXRpbmcgZGF0ZS4iKTsKICAgIH0KICAgIHJldHVybiBjb250YWN0Owp9CgovKioKKiBDb252ZXJ0cyBDb21wbGV4IG9iamVjdHMgaW50byBwcmltaXRpdmVzCiogT25seSBjb252ZXJzaW9uIGF0IHByZXNlbnQgaXMgZm9yIERhdGVzLgoqKi8KCmZ1bmN0aW9uIGNvbnZlcnRPdXQoY29udGFjdCkgewogICAgdmFyIHZhbHVlID0gY29udGFjdC5iaXJ0aGRheTsKICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgIC8vIHRyeSB0byBtYWtlIGl0IGEgRGF0ZSBvYmplY3QgaWYgaXQgaXMgbm90IGFscmVhZHkKICAgICAgICBpZiAoIXV0aWxzLmlzRGF0ZSh2YWx1ZSkpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFsdWUgPSBuZXcgRGF0ZSh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2goZXhjZXB0aW9uKXsKICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodXRpbHMuaXNEYXRlKHZhbHVlKSl7CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudmFsdWVPZigpOyAvLyBjb252ZXJ0IHRvIG1pbGxpc2Vjb25kcwogICAgICAgIH0KICAgICAgICBjb250YWN0LmJpcnRoZGF5ID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gY29udGFjdDsKfQoKLyoqCiogQ29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgYSBzaW5nbGUgY29udGFjdC4KKiBAY29uc3RydWN0b3IKKiBAcGFyYW0ge0RPTVN0cmluZ30gaWQgdW5pcXVlIGlkZW50aWZpZXIKKiBAcGFyYW0ge0RPTVN0cmluZ30gZGlzcGxheU5hbWUKKiBAcGFyYW0ge0NvbnRhY3ROYW1lfSBuYW1lCiogQHBhcmFtIHtET01TdHJpbmd9IG5pY2tuYW1lCiogQHBhcmFtIHtBcnJheS48Q29udGFjdEZpZWxkPn0gcGhvbmVOdW1iZXJzIGFycmF5IG9mIHBob25lIG51bWJlcnMKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0RmllbGQ+fSBlbWFpbHMgYXJyYXkgb2YgZW1haWwgYWRkcmVzc2VzCiogQHBhcmFtIHtBcnJheS48Q29udGFjdEFkZHJlc3M+fSBhZGRyZXNzZXMgYXJyYXkgb2YgYWRkcmVzc2VzCiogQHBhcmFtIHtBcnJheS48Q29udGFjdEZpZWxkPn0gaW1zIGluc3RhbnQgbWVzc2FnaW5nIHVzZXIgaWRzCiogQHBhcmFtIHtBcnJheS48Q29udGFjdE9yZ2FuaXphdGlvbj59IG9yZ2FuaXphdGlvbnMKKiBAcGFyYW0ge0RPTVN0cmluZ30gYmlydGhkYXkgY29udGFjdCdzIGJpcnRoZGF5CiogQHBhcmFtIHtET01TdHJpbmd9IG5vdGUgdXNlciBub3RlcyBhYm91dCBjb250YWN0CiogQHBhcmFtIHtBcnJheS48Q29udGFjdEZpZWxkPn0gcGhvdG9zCiogQHBhcmFtIHtBcnJheS48Q29udGFjdEZpZWxkPn0gY2F0ZWdvcmllcwoqIEBwYXJhbSB7QXJyYXkuPENvbnRhY3RGaWVsZD59IHVybHMgY29udGFjdCdzIHdlYiBzaXRlcwoqLwp2YXIgQ29udGFjdCA9IGZ1bmN0aW9uIChpZCwgZGlzcGxheU5hbWUsIG5hbWUsIG5pY2tuYW1lLCBwaG9uZU51bWJlcnMsIGVtYWlscywgYWRkcmVzc2VzLAogICAgaW1zLCBvcmdhbml6YXRpb25zLCBiaXJ0aGRheSwgbm90ZSwgcGhvdG9zLCBjYXRlZ29yaWVzLCB1cmxzKSB7CiAgICB0aGlzLmlkID0gaWQgfHwgbnVsbDsKICAgIHRoaXMucmF3SWQgPSBudWxsOwogICAgdGhpcy5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lIHx8IG51bGw7CiAgICB0aGlzLm5hbWUgPSBuYW1lIHx8IG51bGw7IC8vIENvbnRhY3ROYW1lCiAgICB0aGlzLm5pY2tuYW1lID0gbmlja25hbWUgfHwgbnVsbDsKICAgIHRoaXMucGhvbmVOdW1iZXJzID0gcGhvbmVOdW1iZXJzIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCiAgICB0aGlzLmVtYWlscyA9IGVtYWlscyB8fCBudWxsOyAvLyBDb250YWN0RmllbGRbXQogICAgdGhpcy5hZGRyZXNzZXMgPSBhZGRyZXNzZXMgfHwgbnVsbDsgLy8gQ29udGFjdEFkZHJlc3NbXQogICAgdGhpcy5pbXMgPSBpbXMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMub3JnYW5pemF0aW9ucyA9IG9yZ2FuaXphdGlvbnMgfHwgbnVsbDsgLy8gQ29udGFjdE9yZ2FuaXphdGlvbltdCiAgICB0aGlzLmJpcnRoZGF5ID0gYmlydGhkYXkgfHwgbnVsbDsKICAgIHRoaXMubm90ZSA9IG5vdGUgfHwgbnVsbDsKICAgIHRoaXMucGhvdG9zID0gcGhvdG9zIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCiAgICB0aGlzLmNhdGVnb3JpZXMgPSBjYXRlZ29yaWVzIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCiAgICB0aGlzLnVybHMgPSB1cmxzIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCn07CgovKioKKiBSZW1vdmVzIGNvbnRhY3QgZnJvbSBkZXZpY2Ugc3RvcmFnZS4KKiBAcGFyYW0gc3VjY2Vzc0NCIHN1Y2Nlc3MgY2FsbGJhY2sKKiBAcGFyYW0gZXJyb3JDQiBlcnJvciBjYWxsYmFjawoqLwpDb250YWN0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihzdWNjZXNzQ0IsIGVycm9yQ0IpIHsKICAgIHZhciBmYWlsID0gZnVuY3Rpb24oY29kZSkgewogICAgICAgIGVycm9yQ0IobmV3IENvbnRhY3RFcnJvcihjb2RlKSk7CiAgICB9OwogICAgaWYgKHRoaXMuaWQgPT09IG51bGwpIHsKICAgICAgICBmYWlsKENvbnRhY3RFcnJvci5VTktOT1dOX0VSUk9SKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGV4ZWMoc3VjY2Vzc0NCLCBmYWlsLCAiQ29udGFjdHMiLCAicmVtb3ZlIiwgW3RoaXMuaWRdKTsKICAgIH0KfTsKCi8qKgoqIENyZWF0ZXMgYSBkZWVwIGNvcHkgb2YgdGhpcyBDb250YWN0LgoqIFdpdGggdGhlIGNvbnRhY3QgSUQgc2V0IHRvIG51bGwuCiogQHJldHVybiBjb3B5IG9mIHRoaXMgQ29udGFjdAoqLwpDb250YWN0LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGNsb25lZENvbnRhY3QgPSB1dGlscy5jbG9uZSh0aGlzKTsKICAgIHZhciBpOwogICAgY2xvbmVkQ29udGFjdC5pZCA9IG51bGw7CiAgICBjbG9uZWRDb250YWN0LnJhd0lkID0gbnVsbDsKICAgIC8vIExvb3AgdGhyb3VnaCBhbmQgY2xlYXIgb3V0IGFueSBpZCdzIGluIHBob25lcywgZW1haWxzLCBldGMuCiAgICBpZiAoY2xvbmVkQ29udGFjdC5waG9uZU51bWJlcnMpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC5waG9uZU51bWJlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5waG9uZU51bWJlcnNbaV0uaWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LmVtYWlscykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0LmVtYWlscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbG9uZWRDb250YWN0LmVtYWlsc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QuYWRkcmVzc2VzKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNsb25lZENvbnRhY3QuYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNsb25lZENvbnRhY3QuYWRkcmVzc2VzW2ldLmlkID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC5pbXMpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC5pbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5pbXNbaV0uaWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0Lm9yZ2FuaXphdGlvbnMpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC5vcmdhbml6YXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNsb25lZENvbnRhY3Qub3JnYW5pemF0aW9uc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QuY2F0ZWdvcmllcykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0LmNhdGVnb3JpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5jYXRlZ29yaWVzW2ldLmlkID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC5waG90b3MpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC5waG90b3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5waG90b3NbaV0uaWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LnVybHMpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC51cmxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNsb25lZENvbnRhY3QudXJsc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGNsb25lZENvbnRhY3Q7Cn07CgovKioKKiBQZXJzaXN0cyBjb250YWN0IHRvIGRldmljZSBzdG9yYWdlLgoqIEBwYXJhbSBzdWNjZXNzQ0Igc3VjY2VzcyBjYWxsYmFjawoqIEBwYXJhbSBlcnJvckNCIGVycm9yIGNhbGxiYWNrCiovCkNvbnRhY3QucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbihzdWNjZXNzQ0IsIGVycm9yQ0IpIHsKICB2YXIgZmFpbCA9IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgZXJyb3JDQihuZXcgQ29udGFjdEVycm9yKGNvZGUpKTsKICB9OwogICAgdmFyIHN1Y2Nlc3MgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgaWYgKHR5cGVvZiBzdWNjZXNzQ0IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICB2YXIgZnVsbENvbnRhY3QgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9jb250YWN0cycpLmNyZWF0ZShyZXN1bHQpOwogICAgICAgICAgICAgIHN1Y2Nlc3NDQihjb252ZXJ0SW4oZnVsbENvbnRhY3QpKTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICAgIC8vIG5vIEVudHJ5IG9iamVjdCByZXR1cm5lZAogICAgICAgICAgZmFpbChDb250YWN0RXJyb3IuVU5LTk9XTl9FUlJPUik7CiAgICAgIH0KICB9OwogICAgdmFyIGR1cENvbnRhY3QgPSBjb252ZXJ0T3V0KHV0aWxzLmNsb25lKHRoaXMpKTsKICAgIGV4ZWMoc3VjY2VzcywgZmFpbCwgIkNvbnRhY3RzIiwgInNhdmUiLCBbZHVwQ29udGFjdF0pOwp9OwoKCm1vZHVsZS5leHBvcnRzID0gQ29udGFjdDsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vQ29udGFjdEFkZHJlc3MuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9Db250YWN0QWRkcmVzcyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKKiBDb250YWN0IGFkZHJlc3MuCiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtET01TdHJpbmd9IGlkIHVuaXF1ZSBpZGVudGlmaWVyLCBzaG91bGQgb25seSBiZSBzZXQgYnkgbmF0aXZlIGNvZGUKKiBAcGFyYW0gZm9ybWF0dGVkIC8vIE5PVEU6IG5vdCBhIFczQyBzdGFuZGFyZAoqIEBwYXJhbSBzdHJlZXRBZGRyZXNzCiogQHBhcmFtIGxvY2FsaXR5CiogQHBhcmFtIHJlZ2lvbgoqIEBwYXJhbSBwb3N0YWxDb2RlCiogQHBhcmFtIGNvdW50cnkKKi8KCnZhciBDb250YWN0QWRkcmVzcyA9IGZ1bmN0aW9uKHByZWYsIHR5cGUsIGZvcm1hdHRlZCwgc3RyZWV0QWRkcmVzcywgbG9jYWxpdHksIHJlZ2lvbiwgcG9zdGFsQ29kZSwgY291bnRyeSkgewogICAgdGhpcy5pZCA9IG51bGw7CiAgICB0aGlzLnByZWYgPSAodHlwZW9mIHByZWYgIT0gJ3VuZGVmaW5lZCcgPyBwcmVmIDogZmFsc2UpOwogICAgdGhpcy50eXBlID0gdHlwZSB8fCBudWxsOwogICAgdGhpcy5mb3JtYXR0ZWQgPSBmb3JtYXR0ZWQgfHwgbnVsbDsKICAgIHRoaXMuc3RyZWV0QWRkcmVzcyA9IHN0cmVldEFkZHJlc3MgfHwgbnVsbDsKICAgIHRoaXMubG9jYWxpdHkgPSBsb2NhbGl0eSB8fCBudWxsOwogICAgdGhpcy5yZWdpb24gPSByZWdpb24gfHwgbnVsbDsKICAgIHRoaXMucG9zdGFsQ29kZSA9IHBvc3RhbENvZGUgfHwgbnVsbDsKICAgIHRoaXMuY291bnRyeSA9IGNvdW50cnkgfHwgbnVsbDsKfTsKCm1vZHVsZS5leHBvcnRzID0gQ29udGFjdEFkZHJlc3M7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vQ29udGFjdEVycm9yLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ29udGFjdEVycm9yIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiAgQ29udGFjdEVycm9yLgogKiAgQW4gZXJyb3IgY29kZSBhc3NpZ25lZCBieSBhbiBpbXBsZW1lbnRhdGlvbiB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cmVkCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIENvbnRhY3RFcnJvciA9IGZ1bmN0aW9uKGVycikgewogICAgdGhpcy5jb2RlID0gKHR5cGVvZiBlcnIgIT0gJ3VuZGVmaW5lZCcgPyBlcnIgOiBudWxsKTsKfTsKCi8qKgogKiBFcnJvciBjb2RlcwogKi8KQ29udGFjdEVycm9yLlVOS05PV05fRVJST1IgPSAwOwpDb250YWN0RXJyb3IuSU5WQUxJRF9BUkdVTUVOVF9FUlJPUiA9IDE7CkNvbnRhY3RFcnJvci5USU1FT1VUX0VSUk9SID0gMjsKQ29udGFjdEVycm9yLlBFTkRJTkdfT1BFUkFUSU9OX0VSUk9SID0gMzsKQ29udGFjdEVycm9yLklPX0VSUk9SID0gNDsKQ29udGFjdEVycm9yLk5PVF9TVVBQT1JURURfRVJST1IgPSA1OwpDb250YWN0RXJyb3IuUEVSTUlTU0lPTl9ERU5JRURfRVJST1IgPSAyMDsKCm1vZHVsZS5leHBvcnRzID0gQ29udGFjdEVycm9yOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NvbnRhY3RGaWVsZC5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0NvbnRhY3RGaWVsZCIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKKiBHZW5lcmljIGNvbnRhY3QgZmllbGQuCiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtET01TdHJpbmd9IGlkIHVuaXF1ZSBpZGVudGlmaWVyLCBzaG91bGQgb25seSBiZSBzZXQgYnkgbmF0aXZlIGNvZGUgLy8gTk9URTogbm90IGEgVzNDIHN0YW5kYXJkCiogQHBhcmFtIHR5cGUKKiBAcGFyYW0gdmFsdWUKKiBAcGFyYW0gcHJlZgoqLwp2YXIgQ29udGFjdEZpZWxkID0gZnVuY3Rpb24odHlwZSwgdmFsdWUsIHByZWYpIHsKICAgIHRoaXMuaWQgPSBudWxsOwogICAgdGhpcy50eXBlID0gKHR5cGUgJiYgdHlwZS50b1N0cmluZygpKSB8fCBudWxsOwogICAgdGhpcy52YWx1ZSA9ICh2YWx1ZSAmJiB2YWx1ZS50b1N0cmluZygpKSB8fCBudWxsOwogICAgdGhpcy5wcmVmID0gKHR5cGVvZiBwcmVmICE9ICd1bmRlZmluZWQnID8gcHJlZiA6IGZhbHNlKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gQ29udGFjdEZpZWxkOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0NvbnRhY3RGaW5kT3B0aW9ucy5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0NvbnRhY3RGaW5kT3B0aW9ucyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogQ29udGFjdEZpbmRPcHRpb25zLgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIGZpbHRlciB1c2VkIHRvIG1hdGNoIGNvbnRhY3RzIGFnYWluc3QKICogQHBhcmFtIG11bHRpcGxlIGJvb2xlYW4gdXNlZCB0byBkZXRlcm1pbmUgaWYgbW9yZSB0aGFuIG9uZSBjb250YWN0IHNob3VsZCBiZSByZXR1cm5lZAogKi8KCnZhciBDb250YWN0RmluZE9wdGlvbnMgPSBmdW5jdGlvbihmaWx0ZXIsIG11bHRpcGxlKSB7CiAgICB0aGlzLmZpbHRlciA9IGZpbHRlciB8fCAnJzsKICAgIHRoaXMubXVsdGlwbGUgPSAodHlwZW9mIG11bHRpcGxlICE9ICd1bmRlZmluZWQnID8gbXVsdGlwbGUgOiBmYWxzZSk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IENvbnRhY3RGaW5kT3B0aW9uczsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Db250YWN0TmFtZS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0NvbnRhY3ROYW1lIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgoqIENvbnRhY3QgbmFtZS4KKiBAY29uc3RydWN0b3IKKiBAcGFyYW0gZm9ybWF0dGVkIC8vIE5PVEU6IG5vdCBwYXJ0IG9mIFczQyBzdGFuZGFyZAoqIEBwYXJhbSBmYW1pbHlOYW1lCiogQHBhcmFtIGdpdmVuTmFtZQoqIEBwYXJhbSBtaWRkbGUKKiBAcGFyYW0gcHJlZml4CiogQHBhcmFtIHN1ZmZpeAoqLwp2YXIgQ29udGFjdE5hbWUgPSBmdW5jdGlvbihmb3JtYXR0ZWQsIGZhbWlseU5hbWUsIGdpdmVuTmFtZSwgbWlkZGxlLCBwcmVmaXgsIHN1ZmZpeCkgewogICAgdGhpcy5mb3JtYXR0ZWQgPSBmb3JtYXR0ZWQgfHwgbnVsbDsKICAgIHRoaXMuZmFtaWx5TmFtZSA9IGZhbWlseU5hbWUgfHwgbnVsbDsKICAgIHRoaXMuZ2l2ZW5OYW1lID0gZ2l2ZW5OYW1lIHx8IG51bGw7CiAgICB0aGlzLm1pZGRsZU5hbWUgPSBtaWRkbGUgfHwgbnVsbDsKICAgIHRoaXMuaG9ub3JpZmljUHJlZml4ID0gcHJlZml4IHx8IG51bGw7CiAgICB0aGlzLmhvbm9yaWZpY1N1ZmZpeCA9IHN1ZmZpeCB8fCBudWxsOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBDb250YWN0TmFtZTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Db250YWN0T3JnYW5pemF0aW9uLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ29udGFjdE9yZ2FuaXphdGlvbiIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKKiBDb250YWN0IG9yZ2FuaXphdGlvbi4KKiBAY29uc3RydWN0b3IKKiBAcGFyYW0ge0RPTVN0cmluZ30gaWQgdW5pcXVlIGlkZW50aWZpZXIsIHNob3VsZCBvbmx5IGJlIHNldCBieSBuYXRpdmUgY29kZSAvLyBOT1RFOiBub3QgYSBXM0Mgc3RhbmRhcmQKKiBAcGFyYW0gbmFtZQoqIEBwYXJhbSBkZXB0CiogQHBhcmFtIHRpdGxlCiogQHBhcmFtIHN0YXJ0RGF0ZQoqIEBwYXJhbSBlbmREYXRlCiogQHBhcmFtIGxvY2F0aW9uCiogQHBhcmFtIGRlc2MKKi8KCnZhciBDb250YWN0T3JnYW5pemF0aW9uID0gZnVuY3Rpb24ocHJlZiwgdHlwZSwgbmFtZSwgZGVwdCwgdGl0bGUpIHsKICAgIHRoaXMuaWQgPSBudWxsOwogICAgdGhpcy5wcmVmID0gKHR5cGVvZiBwcmVmICE9ICd1bmRlZmluZWQnID8gcHJlZiA6IGZhbHNlKTsKICAgIHRoaXMudHlwZSA9IHR5cGUgfHwgbnVsbDsKICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgbnVsbDsKICAgIHRoaXMuZGVwYXJ0bWVudCA9IGRlcHQgfHwgbnVsbDsKICAgIHRoaXMudGl0bGUgPSB0aXRsZSB8fCBudWxsOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBDb250YWN0T3JnYW5pemF0aW9uOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0Nvb3JkaW5hdGVzLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vQ29vcmRpbmF0ZXMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIFRoaXMgY2xhc3MgY29udGFpbnMgcG9zaXRpb24gaW5mb3JtYXRpb24uCiAqIEBwYXJhbSB7T2JqZWN0fSBsYXQKICogQHBhcmFtIHtPYmplY3R9IGxuZwogKiBAcGFyYW0ge09iamVjdH0gYWx0CiAqIEBwYXJhbSB7T2JqZWN0fSBhY2MKICogQHBhcmFtIHtPYmplY3R9IGhlYWQKICogQHBhcmFtIHtPYmplY3R9IHZlbAogKiBAcGFyYW0ge09iamVjdH0gYWx0YWNjCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIENvb3JkaW5hdGVzID0gZnVuY3Rpb24obGF0LCBsbmcsIGFsdCwgYWNjLCBoZWFkLCB2ZWwsIGFsdGFjYykgewogICAgLyoqCiAgICAgKiBUaGUgbGF0aXR1ZGUgb2YgdGhlIHBvc2l0aW9uLgogICAgICovCiAgICB0aGlzLmxhdGl0dWRlID0gbGF0OwogICAgLyoqCiAgICAgKiBUaGUgbG9uZ2l0dWRlIG9mIHRoZSBwb3NpdGlvbiwKICAgICAqLwogICAgdGhpcy5sb25naXR1ZGUgPSBsbmc7CiAgICAvKioKICAgICAqIFRoZSBhY2N1cmFjeSBvZiB0aGUgcG9zaXRpb24uCiAgICAgKi8KICAgIHRoaXMuYWNjdXJhY3kgPSBhY2M7CiAgICAvKioKICAgICAqIFRoZSBhbHRpdHVkZSBvZiB0aGUgcG9zaXRpb24uCiAgICAgKi8KICAgIHRoaXMuYWx0aXR1ZGUgPSAoYWx0ICE9PSB1bmRlZmluZWQgPyBhbHQgOiBudWxsKTsKICAgIC8qKgogICAgICogVGhlIGRpcmVjdGlvbiB0aGUgZGV2aWNlIGlzIG1vdmluZyBhdCB0aGUgcG9zaXRpb24uCiAgICAgKi8KICAgIHRoaXMuaGVhZGluZyA9IChoZWFkICE9PSB1bmRlZmluZWQgPyBoZWFkIDogbnVsbCk7CiAgICAvKioKICAgICAqIFRoZSB2ZWxvY2l0eSB3aXRoIHdoaWNoIHRoZSBkZXZpY2UgaXMgbW92aW5nIGF0IHRoZSBwb3NpdGlvbi4KICAgICAqLwogICAgdGhpcy5zcGVlZCA9ICh2ZWwgIT09IHVuZGVmaW5lZCA/IHZlbCA6IG51bGwpOwoKICAgIGlmICh0aGlzLnNwZWVkID09PSAwIHx8IHRoaXMuc3BlZWQgPT09IG51bGwpIHsKICAgICAgICB0aGlzLmhlYWRpbmcgPSBOYU47CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYWx0aXR1ZGUgYWNjdXJhY3kgb2YgdGhlIHBvc2l0aW9uLgogICAgICovCiAgICB0aGlzLmFsdGl0dWRlQWNjdXJhY3kgPSAoYWx0YWNjICE9PSB1bmRlZmluZWQpID8gYWx0YWNjIDogbnVsbDsKfTsKCm1vZHVsZS5leHBvcnRzID0gQ29vcmRpbmF0ZXM7Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0RpcmVjdG9yeUVudHJ5LmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnkiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIHV0aWxzID0gcmVxdWlyZSgnY29yZG92YS91dGlscycpLAogICAgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgRW50cnkgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9FbnRyeScpLAogICAgRmlsZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJyksCiAgICBEaXJlY3RvcnlSZWFkZXIgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9EaXJlY3RvcnlSZWFkZXInKTsKCi8qKgogKiBBbiBpbnRlcmZhY2UgcmVwcmVzZW50aW5nIGEgZGlyZWN0b3J5IG9uIHRoZSBmaWxlIHN5c3RlbS4KICoKICoge2Jvb2xlYW59IGlzRmlsZSBhbHdheXMgZmFsc2UgKHJlYWRvbmx5KQogKiB7Ym9vbGVhbn0gaXNEaXJlY3RvcnkgYWx3YXlzIHRydWUgKHJlYWRvbmx5KQogKiB7RE9NU3RyaW5nfSBuYW1lIG9mIHRoZSBkaXJlY3RvcnksIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IChyZWFkb25seSkKICogVE9ETzogaW1wbGVtZW50IHRoaXMhISEge0ZpbGVTeXN0ZW19IGZpbGVzeXN0ZW0gb24gd2hpY2ggdGhlIGRpcmVjdG9yeSByZXNpZGVzIChyZWFkb25seSkKICovCnZhciBEaXJlY3RvcnlFbnRyeSA9IGZ1bmN0aW9uKG5hbWUsIGZ1bGxQYXRoKSB7CiAgICAgRGlyZWN0b3J5RW50cnkuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIFtmYWxzZSwgdHJ1ZSwgbmFtZSwgZnVsbFBhdGhdKTsKfTsKCnV0aWxzLmV4dGVuZChEaXJlY3RvcnlFbnRyeSwgRW50cnkpOwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgRGlyZWN0b3J5UmVhZGVyIHRvIHJlYWQgZW50cmllcyBmcm9tIHRoaXMgZGlyZWN0b3J5CiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuY3JlYXRlUmVhZGVyID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IERpcmVjdG9yeVJlYWRlcih0aGlzLmZ1bGxQYXRoKTsKfTsKCi8qKgogKiBDcmVhdGVzIG9yIGxvb2tzIHVwIGEgZGlyZWN0b3J5CiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBwYXRoIGVpdGhlciBhIHJlbGF0aXZlIG9yIGFic29sdXRlIHBhdGggZnJvbSB0aGlzIGRpcmVjdG9yeSBpbiB3aGljaCB0byBsb29rIHVwIG9yIGNyZWF0ZSBhIGRpcmVjdG9yeQogKiBAcGFyYW0ge0ZsYWdzfSBvcHRpb25zIHRvIGNyZWF0ZSBvciBleGNsdWl2ZWx5IGNyZWF0ZSB0aGUgZGlyZWN0b3J5CiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IGVudHJ5CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXREaXJlY3RvcnkgPSBmdW5jdGlvbihwYXRoLCBvcHRpb25zLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHZhciB3aW4gPSB0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgIHZhciBlbnRyeSA9IG5ldyBEaXJlY3RvcnlFbnRyeShyZXN1bHQubmFtZSwgcmVzdWx0LmZ1bGxQYXRoKTsKICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZW50cnkpOwogICAgfTsKICAgIHZhciBmYWlsID0gdHlwZW9mIGVycm9yQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24oY29kZSkgewogICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihjb2RlKSk7CiAgICB9OwogICAgZXhlYyh3aW4sIGZhaWwsICJGaWxlIiwgImdldERpcmVjdG9yeSIsIFt0aGlzLmZ1bGxQYXRoLCBwYXRoLCBvcHRpb25zXSk7Cn07CgovKioKICogRGVsZXRlcyBhIGRpcmVjdG9yeSBhbmQgYWxsIG9mIGl0J3MgY29udGVudHMKICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIG5vIHBhcmFtZXRlcnMKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLnJlbW92ZVJlY3Vyc2l2ZWx5ID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICB2YXIgZmFpbCA9IHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgICBlcnJvckNhbGxiYWNrKG5ldyBGaWxlRXJyb3IoY29kZSkpOwogICAgfTsKICAgIGV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBmYWlsLCAiRmlsZSIsICJyZW1vdmVSZWN1cnNpdmVseSIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogQ3JlYXRlcyBvciBsb29rcyB1cCBhIGZpbGUKICoKICogQHBhcmFtIHtET01TdHJpbmd9IHBhdGggZWl0aGVyIGEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCBmcm9tIHRoaXMgZGlyZWN0b3J5IGluIHdoaWNoIHRvIGxvb2sgdXAgb3IgY3JlYXRlIGEgZmlsZQogKiBAcGFyYW0ge0ZsYWdzfSBvcHRpb25zIHRvIGNyZWF0ZSBvciBleGNsdWl2ZWx5IGNyZWF0ZSB0aGUgZmlsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuZ2V0RmlsZSA9IGZ1bmN0aW9uKHBhdGgsIG9wdGlvbnMsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIHdpbiA9IHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgdmFyIEZpbGVFbnRyeSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFbnRyeScpOwogICAgICAgIHZhciBlbnRyeSA9IG5ldyBGaWxlRW50cnkocmVzdWx0Lm5hbWUsIHJlc3VsdC5mdWxsUGF0aCk7CiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGVudHJ5KTsKICAgIH07CiAgICB2YXIgZmFpbCA9IHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgICBlcnJvckNhbGxiYWNrKG5ldyBGaWxlRXJyb3IoY29kZSkpOwogICAgfTsKICAgIGV4ZWMod2luLCBmYWlsLCAiRmlsZSIsICJnZXRGaWxlIiwgW3RoaXMuZnVsbFBhdGgsIHBhdGgsIG9wdGlvbnNdKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gRGlyZWN0b3J5RW50cnk7Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0RpcmVjdG9yeVJlYWRlci5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0RpcmVjdG9yeVJlYWRlciIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgRmlsZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJykgOwoKLyoqCiAqIEFuIGludGVyZmFjZSB0aGF0IGxpc3RzIHRoZSBmaWxlcyBhbmQgZGlyZWN0b3JpZXMgaW4gYSBkaXJlY3RvcnkuCiAqLwpmdW5jdGlvbiBEaXJlY3RvcnlSZWFkZXIocGF0aCkgewogICAgdGhpcy5wYXRoID0gcGF0aCB8fCBudWxsOwp9CgovKioKICogUmV0dXJucyBhIGxpc3Qgb2YgZW50cmllcyBmcm9tIGEgZGlyZWN0b3J5LgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBsaXN0IG9mIGVudHJpZXMKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5UmVhZGVyLnByb3RvdHlwZS5yZWFkRW50cmllcyA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIHdpbiA9IHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgdmFyIHJldFZhbCA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MDsgaTxyZXN1bHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHJlc3VsdFtpXS5pc0RpcmVjdG9yeSkgewogICAgICAgICAgICAgICAgZW50cnkgPSBuZXcgKHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0RpcmVjdG9yeUVudHJ5JykpKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0W2ldLmlzRmlsZSkgewogICAgICAgICAgICAgICAgZW50cnkgPSBuZXcgKHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFbnRyeScpKSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVudHJ5LmlzRGlyZWN0b3J5ID0gcmVzdWx0W2ldLmlzRGlyZWN0b3J5OwogICAgICAgICAgICBlbnRyeS5pc0ZpbGUgPSByZXN1bHRbaV0uaXNGaWxlOwogICAgICAgICAgICBlbnRyeS5uYW1lID0gcmVzdWx0W2ldLm5hbWU7CiAgICAgICAgICAgIGVudHJ5LmZ1bGxQYXRoID0gcmVzdWx0W2ldLmZ1bGxQYXRoOwogICAgICAgICAgICByZXRWYWwucHVzaChlbnRyeSk7CiAgICAgICAgfQogICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXRWYWwpOwogICAgfTsKICAgIHZhciBmYWlsID0gdHlwZW9mIGVycm9yQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24oY29kZSkgewogICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihjb2RlKSk7CiAgICB9OwogICAgZXhlYyh3aW4sIGZhaWwsICJGaWxlIiwgInJlYWRFbnRyaWVzIiwgW3RoaXMucGF0aF0pOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBEaXJlY3RvcnlSZWFkZXI7Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0VudHJ5LmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRW50cnkiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIEZpbGVFcnJvciA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFcnJvcicpLAogICAgTWV0YWRhdGEgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9NZXRhZGF0YScpOwoKLyoqCiAqIFJlcHJlc2VudHMgYSBmaWxlIG9yIGRpcmVjdG9yeSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0uCiAqCiAqIEBwYXJhbSBpc0ZpbGUKICogICAgICAgICAgICB7Ym9vbGVhbn0gdHJ1ZSBpZiBFbnRyeSBpcyBhIGZpbGUgKHJlYWRvbmx5KQogKiBAcGFyYW0gaXNEaXJlY3RvcnkKICogICAgICAgICAgICB7Ym9vbGVhbn0gdHJ1ZSBpZiBFbnRyeSBpcyBhIGRpcmVjdG9yeSAocmVhZG9ubHkpCiAqIEBwYXJhbSBuYW1lCiAqICAgICAgICAgICAge0RPTVN0cmluZ30gbmFtZSBvZiB0aGUgZmlsZSBvciBkaXJlY3RvcnksIGV4Y2x1ZGluZyB0aGUgcGF0aAogKiAgICAgICAgICAgIGxlYWRpbmcgdG8gaXQgKHJlYWRvbmx5KQogKiBAcGFyYW0gZnVsbFBhdGgKICogICAgICAgICAgICB7RE9NU3RyaW5nfSB0aGUgYWJzb2x1dGUgZnVsbCBwYXRoIHRvIHRoZSBmaWxlIG9yIGRpcmVjdG9yeQogKiAgICAgICAgICAgIChyZWFkb25seSkKICovCmZ1bmN0aW9uIEVudHJ5KGlzRmlsZSwgaXNEaXJlY3RvcnksIG5hbWUsIGZ1bGxQYXRoLCBmaWxlU3lzdGVtKSB7CiAgICB0aGlzLmlzRmlsZSA9ICh0eXBlb2YgaXNGaWxlICE9ICd1bmRlZmluZWQnP2lzRmlsZTpmYWxzZSk7CiAgICB0aGlzLmlzRGlyZWN0b3J5ID0gKHR5cGVvZiBpc0RpcmVjdG9yeSAhPSAndW5kZWZpbmVkJz9pc0RpcmVjdG9yeTpmYWxzZSk7CiAgICB0aGlzLm5hbWUgPSBuYW1lIHx8ICcnOwogICAgdGhpcy5mdWxsUGF0aCA9IGZ1bGxQYXRoIHx8ICcnOwogICAgdGhpcy5maWxlc3lzdGVtID0gZmlsZVN5c3RlbSB8fCBudWxsOwp9CgovKioKICogTG9vayB1cCB0aGUgbWV0YWRhdGEgb2YgdGhlIGVudHJ5LgogKgogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrCiAqICAgICAgICAgICAge0Z1bmN0aW9ufSBpcyBjYWxsZWQgd2l0aCBhIE1ldGFkYXRhIG9iamVjdAogKiBAcGFyYW0gZXJyb3JDYWxsYmFjawogKiAgICAgICAgICAgIHtGdW5jdGlvbn0gaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkVudHJ5LnByb3RvdHlwZS5nZXRNZXRhZGF0YSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogIHZhciBzdWNjZXNzID0gdHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJyA/IG51bGwgOiBmdW5jdGlvbihsYXN0TW9kaWZpZWQpIHsKICAgICAgdmFyIG1ldGFkYXRhID0gbmV3IE1ldGFkYXRhKGxhc3RNb2RpZmllZCk7CiAgICAgIHN1Y2Nlc3NDYWxsYmFjayhtZXRhZGF0YSk7CiAgfTsKICB2YXIgZmFpbCA9IHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgZXJyb3JDYWxsYmFjayhuZXcgRmlsZUVycm9yKGNvZGUpKTsKICB9OwoKICBleGVjKHN1Y2Nlc3MsIGZhaWwsICJGaWxlIiwgImdldE1ldGFkYXRhIiwgW3RoaXMuZnVsbFBhdGhdKTsKfTsKCi8qKgogKiBTZXQgdGhlIG1ldGFkYXRhIG9mIHRoZSBlbnRyeS4KICoKICogQHBhcmFtIHN1Y2Nlc3NDYWxsYmFjawogKiAgICAgICAgICAgIHtGdW5jdGlvbn0gaXMgY2FsbGVkIHdpdGggYSBNZXRhZGF0YSBvYmplY3QKICogQHBhcmFtIGVycm9yQ2FsbGJhY2sKICogICAgICAgICAgICB7RnVuY3Rpb259IGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqIEBwYXJhbSBtZXRhZGF0YU9iamVjdAogKiAgICAgICAgICAgIHtPYmplY3R9IGtleXMgYW5kIHZhbHVlcyB0byBzZXQKICovCkVudHJ5LnByb3RvdHlwZS5zZXRNZXRhZGF0YSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgbWV0YWRhdGFPYmplY3QpIHsKCiAgZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgInNldE1ldGFkYXRhIiwgW3RoaXMuZnVsbFBhdGgsIG1ldGFkYXRhT2JqZWN0XSk7Cn07CgovKioKICogTW92ZSBhIGZpbGUgb3IgZGlyZWN0b3J5IHRvIGEgbmV3IGxvY2F0aW9uLgogKgogKiBAcGFyYW0gcGFyZW50CiAqICAgICAgICAgICAge0RpcmVjdG9yeUVudHJ5fSB0aGUgZGlyZWN0b3J5IHRvIHdoaWNoIHRvIG1vdmUgdGhpcyBlbnRyeQogKiBAcGFyYW0gbmV3TmFtZQogKiAgICAgICAgICAgIHtET01TdHJpbmd9IG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrCiAqICAgICAgICAgICAge0Z1bmN0aW9ufSBjYWxsZWQgd2l0aCB0aGUgbmV3IERpcmVjdG9yeUVudHJ5IG9iamVjdAogKiBAcGFyYW0gZXJyb3JDYWxsYmFjawogKiAgICAgICAgICAgIHtGdW5jdGlvbn0gY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkVudHJ5LnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbihwYXJlbnQsIG5ld05hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIGZhaWwgPSBmdW5jdGlvbihjb2RlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlcnJvckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihjb2RlKSk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIHVzZXIgbXVzdCBzcGVjaWZ5IHBhcmVudCBFbnRyeQogICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICBmYWlsKEZpbGVFcnJvci5OT1RfRk9VTkRfRVJSKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAvLyBzb3VyY2UgcGF0aAogICAgdmFyIHNyY1BhdGggPSB0aGlzLmZ1bGxQYXRoLAogICAgICAgIC8vIGVudHJ5IG5hbWUKICAgICAgICBuYW1lID0gbmV3TmFtZSB8fCB0aGlzLm5hbWUsCiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uKGVudHJ5KSB7CiAgICAgICAgICAgIGlmIChlbnRyeSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYXBwcm9wcmlhdGUgRW50cnkgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IChlbnRyeS5pc0RpcmVjdG9yeSkgPyBuZXcgKHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0RpcmVjdG9yeUVudHJ5JykpKGVudHJ5Lm5hbWUsIGVudHJ5LmZ1bGxQYXRoKSA6IG5ldyAocmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVudHJ5JykpKGVudHJ5Lm5hbWUsIGVudHJ5LmZ1bGxQYXRoKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGludm9raW5nIGNhbGxiYWNrOiAnICsgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gbm8gRW50cnkgb2JqZWN0IHJldHVybmVkCiAgICAgICAgICAgICAgICBmYWlsKEZpbGVFcnJvci5OT1RfRk9VTkRfRVJSKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgLy8gY29weQogICAgZXhlYyhzdWNjZXNzLCBmYWlsLCAiRmlsZSIsICJtb3ZlVG8iLCBbc3JjUGF0aCwgcGFyZW50LmZ1bGxQYXRoLCBuYW1lXSk7Cn07CgovKioKICogQ29weSBhIGRpcmVjdG9yeSB0byBhIGRpZmZlcmVudCBsb2NhdGlvbi4KICoKICogQHBhcmFtIHBhcmVudAogKiAgICAgICAgICAgIHtEaXJlY3RvcnlFbnRyeX0gdGhlIGRpcmVjdG9yeSB0byB3aGljaCB0byBjb3B5IHRoZSBlbnRyeQogKiBAcGFyYW0gbmV3TmFtZQogKiAgICAgICAgICAgIHtET01TdHJpbmd9IG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrCiAqICAgICAgICAgICAge0Z1bmN0aW9ufSBjYWxsZWQgd2l0aCB0aGUgbmV3IEVudHJ5IG9iamVjdAogKiBAcGFyYW0gZXJyb3JDYWxsYmFjawogKiAgICAgICAgICAgIHtGdW5jdGlvbn0gY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkVudHJ5LnByb3RvdHlwZS5jb3B5VG8gPSBmdW5jdGlvbihwYXJlbnQsIG5ld05hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIGZhaWwgPSBmdW5jdGlvbihjb2RlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlcnJvckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihjb2RlKSk7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyB1c2VyIG11c3Qgc3BlY2lmeSBwYXJlbnQgRW50cnkKICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgZmFpbChGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICAgICAvLyBzb3VyY2UgcGF0aAogICAgdmFyIHNyY1BhdGggPSB0aGlzLmZ1bGxQYXRoLAogICAgICAgIC8vIGVudHJ5IG5hbWUKICAgICAgICBuYW1lID0gbmV3TmFtZSB8fCB0aGlzLm5hbWUsCiAgICAgICAgLy8gc3VjY2VzcyBjYWxsYmFjawogICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbihlbnRyeSkgewogICAgICAgICAgICBpZiAoZW50cnkpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGFwcHJvcHJpYXRlIEVudHJ5IG9iamVjdAogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAoZW50cnkuaXNEaXJlY3RvcnkpID8gbmV3IChyZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9EaXJlY3RvcnlFbnRyeScpKShlbnRyeS5uYW1lLCBlbnRyeS5mdWxsUGF0aCkgOiBuZXcgKHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFbnRyeScpKShlbnRyeS5uYW1lLCBlbnRyeS5mdWxsUGF0aCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbnZva2luZyBjYWxsYmFjazogJyArIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG5vIEVudHJ5IG9iamVjdCByZXR1cm5lZAogICAgICAgICAgICAgICAgZmFpbChGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgIC8vIGNvcHkKICAgIGV4ZWMoc3VjY2VzcywgZmFpbCwgIkZpbGUiLCAiY29weVRvIiwgW3NyY1BhdGgsIHBhcmVudC5mdWxsUGF0aCwgbmFtZV0pOwp9OwoKLyoqCiAqIFJldHVybiBhIFVSTCB0aGF0IGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5IHRoaXMgZW50cnkuCiAqLwpFbnRyeS5wcm90b3R5cGUudG9VUkwgPSBmdW5jdGlvbigpIHsKICAgIC8vIGZ1bGxQYXRoIGF0dHJpYnV0ZSBjb250YWlucyB0aGUgZnVsbCBVUkwKICAgIHJldHVybiB0aGlzLmZ1bGxQYXRoOwp9OwoKLyoqCiAqIFJldHVybnMgYSBVUkkgdGhhdCBjYW4gYmUgdXNlZCB0byBpZGVudGlmeSB0aGlzIGVudHJ5LgogKgogKiBAcGFyYW0ge0RPTVN0cmluZ30gbWltZVR5cGUgZm9yIGEgRmlsZUVudHJ5LCB0aGUgbWltZSB0eXBlIHRvIGJlIHVzZWQgdG8gaW50ZXJwcmV0IHRoZSBmaWxlLCB3aGVuIGxvYWRlZCB0aHJvdWdoIHRoaXMgVVJJLgogKiBAcmV0dXJuIHVyaQogKi8KRW50cnkucHJvdG90eXBlLnRvVVJJID0gZnVuY3Rpb24obWltZVR5cGUpIHsKICAgIGNvbnNvbGUubG9nKCJERVBSRUNBVEVEOiBVcGRhdGUgeW91ciBjb2RlIHRvIHVzZSAndG9VUkwnIik7CiAgICAvLyBmdWxsUGF0aCBhdHRyaWJ1dGUgY29udGFpbnMgdGhlIGZ1bGwgVVJJCiAgICByZXR1cm4gdGhpcy50b1VSTCgpOwp9OwoKLyoqCiAqIFJlbW92ZSBhIGZpbGUgb3IgZGlyZWN0b3J5LiBJdCBpcyBhbiBlcnJvciB0byBhdHRlbXB0IHRvIGRlbGV0ZSBhCiAqIGRpcmVjdG9yeSB0aGF0IGlzIG5vdCBlbXB0eS4gSXQgaXMgYW4gZXJyb3IgdG8gYXR0ZW1wdCB0byBkZWxldGUgYQogKiByb290IGRpcmVjdG9yeSBvZiBhIGZpbGUgc3lzdGVtLgogKgogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIHtGdW5jdGlvbn0gY2FsbGVkIHdpdGggbm8gcGFyYW1ldGVycwogKiBAcGFyYW0gZXJyb3JDYWxsYmFjayB7RnVuY3Rpb259IGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpFbnRyeS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICB2YXIgZmFpbCA9IHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgICBlcnJvckNhbGxiYWNrKG5ldyBGaWxlRXJyb3IoY29kZSkpOwogICAgfTsKICAgIGV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBmYWlsLCAiRmlsZSIsICJyZW1vdmUiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIExvb2sgdXAgdGhlIHBhcmVudCBEaXJlY3RvcnlFbnRyeSBvZiB0aGlzIGVudHJ5LgogKgogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIHtGdW5jdGlvbn0gY2FsbGVkIHdpdGggdGhlIHBhcmVudCBEaXJlY3RvcnlFbnRyeSBvYmplY3QKICogQHBhcmFtIGVycm9yQ2FsbGJhY2sge0Z1bmN0aW9ufSBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRW50cnkucHJvdG90eXBlLmdldFBhcmVudCA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIHdpbiA9IHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgdmFyIERpcmVjdG9yeUVudHJ5ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnknKTsKICAgICAgICB2YXIgZW50cnkgPSBuZXcgRGlyZWN0b3J5RW50cnkocmVzdWx0Lm5hbWUsIHJlc3VsdC5mdWxsUGF0aCk7CiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGVudHJ5KTsKICAgIH07CiAgICB2YXIgZmFpbCA9IHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAnZnVuY3Rpb24nID8gbnVsbCA6IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgICBlcnJvckNhbGxiYWNrKG5ldyBGaWxlRXJyb3IoY29kZSkpOwogICAgfTsKICAgIGV4ZWMod2luLCBmYWlsLCAiRmlsZSIsICJnZXRQYXJlbnQiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBFbnRyeTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9GaWxlLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRmlsZSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogQ29uc3RydWN0b3IuCiAqIG5hbWUge0RPTVN0cmluZ30gbmFtZSBvZiB0aGUgZmlsZSwgd2l0aG91dCBwYXRoIGluZm9ybWF0aW9uCiAqIGZ1bGxQYXRoIHtET01TdHJpbmd9IHRoZSBmdWxsIHBhdGggb2YgdGhlIGZpbGUsIGluY2x1ZGluZyB0aGUgbmFtZQogKiB0eXBlIHtET01TdHJpbmd9IG1pbWUgdHlwZQogKiBsYXN0TW9kaWZpZWREYXRlIHtEYXRlfSBsYXN0IG1vZGlmaWVkIGRhdGUKICogc2l6ZSB7TnVtYmVyfSBzaXplIG9mIHRoZSBmaWxlIGluIGJ5dGVzCiAqLwoKdmFyIEZpbGUgPSBmdW5jdGlvbihuYW1lLCBmdWxsUGF0aCwgdHlwZSwgbGFzdE1vZGlmaWVkRGF0ZSwgc2l6ZSl7CiAgICB0aGlzLm5hbWUgPSBuYW1lIHx8ICcnOwogICAgdGhpcy5mdWxsUGF0aCA9IGZ1bGxQYXRoIHx8IG51bGw7CiAgICB0aGlzLnR5cGUgPSB0eXBlIHx8IG51bGw7CiAgICB0aGlzLmxhc3RNb2RpZmllZERhdGUgPSBsYXN0TW9kaWZpZWREYXRlIHx8IG51bGw7CiAgICB0aGlzLnNpemUgPSBzaXplIHx8IDA7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IEZpbGU7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vRmlsZUVudHJ5LmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRmlsZUVudHJ5IiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciB1dGlscyA9IHJlcXVpcmUoJ2NvcmRvdmEvdXRpbHMnKSwKICAgIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIEVudHJ5ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRW50cnknKSwKICAgIEZpbGVXcml0ZXIgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9GaWxlV3JpdGVyJyksCiAgICBGaWxlID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZScpLAogICAgRmlsZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJyk7CgovKioKICogQW4gaW50ZXJmYWNlIHJlcHJlc2VudGluZyBhIGZpbGUgb24gdGhlIGZpbGUgc3lzdGVtLgogKgogKiB7Ym9vbGVhbn0gaXNGaWxlIGFsd2F5cyB0cnVlIChyZWFkb25seSkKICoge2Jvb2xlYW59IGlzRGlyZWN0b3J5IGFsd2F5cyBmYWxzZSAocmVhZG9ubHkpCiAqIHtET01TdHJpbmd9IG5hbWUgb2YgdGhlIGZpbGUsIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZSAocmVhZG9ubHkpCiAqIHtGaWxlU3lzdGVtfSBmaWxlc3lzdGVtIG9uIHdoaWNoIHRoZSBmaWxlIHJlc2lkZXMgKHJlYWRvbmx5KQogKi8KdmFyIEZpbGVFbnRyeSA9IGZ1bmN0aW9uKG5hbWUsIGZ1bGxQYXRoKSB7CiAgICAgRmlsZUVudHJ5Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBbdHJ1ZSwgZmFsc2UsIG5hbWUsIGZ1bGxQYXRoXSk7Cn07Cgp1dGlscy5leHRlbmQoRmlsZUVudHJ5LCBFbnRyeSk7CgovKioKICogQ3JlYXRlcyBhIG5ldyBGaWxlV3JpdGVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgZmlsZSB0aGF0IHRoaXMgRmlsZUVudHJ5IHJlcHJlc2VudHMuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IEZpbGVXcml0ZXIKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5jcmVhdGVXcml0ZXIgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHRoaXMuZmlsZShmdW5jdGlvbihmaWxlUG9pbnRlcikgewogICAgICAgIHZhciB3cml0ZXIgPSBuZXcgRmlsZVdyaXRlcihmaWxlUG9pbnRlcik7CgogICAgICAgIGlmICh3cml0ZXIuZmlsZU5hbWUgPT09IG51bGwgfHwgd3JpdGVyLmZpbGVOYW1lID09PSAiIikgewogICAgICAgICAgICBpZiAodHlwZW9mIGVycm9yQ2FsbGJhY2sgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2sod3JpdGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sIGVycm9yQ2FsbGJhY2spOwp9OwoKLyoqCiAqIFJldHVybnMgYSBGaWxlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZmlsZSB0aGF0IHRoaXMgRmlsZUVudHJ5IHJlcHJlc2VudHMuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IEZpbGUgb2JqZWN0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkZpbGVFbnRyeS5wcm90b3R5cGUuZmlsZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgdmFyIHdpbiA9IHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicgPyBudWxsIDogZnVuY3Rpb24oZikgewogICAgICAgIHZhciBmaWxlID0gbmV3IEZpbGUoZi5uYW1lLCBmLmZ1bGxQYXRoLCBmLnR5cGUsIGYubGFzdE1vZGlmaWVkRGF0ZSwgZi5zaXplKTsKICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZmlsZSk7CiAgICB9OwogICAgdmFyIGZhaWwgPSB0eXBlb2YgZXJyb3JDYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJyA/IG51bGwgOiBmdW5jdGlvbihjb2RlKSB7CiAgICAgICAgZXJyb3JDYWxsYmFjayhuZXcgRmlsZUVycm9yKGNvZGUpKTsKICAgIH07CiAgICBleGVjKHdpbiwgZmFpbCwgIkZpbGUiLCAiZ2V0RmlsZU1ldGFkYXRhIiwgW3RoaXMuZnVsbFBhdGhdKTsKfTsKCgptb2R1bGUuZXhwb3J0cyA9IEZpbGVFbnRyeTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9GaWxlRXJyb3IuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9GaWxlRXJyb3IiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIEZpbGVFcnJvcgogKi8KZnVuY3Rpb24gRmlsZUVycm9yKGVycm9yKSB7CiAgdGhpcy5jb2RlID0gZXJyb3IgfHwgbnVsbDsKfQoKLy8gRmlsZSBlcnJvciBjb2RlcwovLyBGb3VuZCBpbiBET01FeGNlcHRpb24KRmlsZUVycm9yLk5PVF9GT1VORF9FUlIgPSAxOwpGaWxlRXJyb3IuU0VDVVJJVFlfRVJSID0gMjsKRmlsZUVycm9yLkFCT1JUX0VSUiA9IDM7CgovLyBBZGRlZCBieSBGaWxlIEFQSSBzcGVjaWZpY2F0aW9uCkZpbGVFcnJvci5OT1RfUkVBREFCTEVfRVJSID0gNDsKRmlsZUVycm9yLkVOQ09ESU5HX0VSUiA9IDU7CkZpbGVFcnJvci5OT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIgPSA2OwpGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlIgPSA3OwpGaWxlRXJyb3IuU1lOVEFYX0VSUiA9IDg7CkZpbGVFcnJvci5JTlZBTElEX01PRElGSUNBVElPTl9FUlIgPSA5OwpGaWxlRXJyb3IuUVVPVEFfRVhDRUVERURfRVJSID0gMTA7CkZpbGVFcnJvci5UWVBFX01JU01BVENIX0VSUiA9IDExOwpGaWxlRXJyb3IuUEFUSF9FWElTVFNfRVJSID0gMTI7Cgptb2R1bGUuZXhwb3J0cyA9IEZpbGVFcnJvcjsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9GaWxlUmVhZGVyLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRmlsZVJlYWRlciIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgRmlsZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJyksCiAgICBQcm9ncmVzc0V2ZW50ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vUHJvZ3Jlc3NFdmVudCcpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcmVhZHMgdGhlIG1vYmlsZSBkZXZpY2UgZmlsZSBzeXN0ZW0uCiAqCiAqIEZvciBBbmRyb2lkOgogKiAgICAgIFRoZSByb290IGRpcmVjdG9yeSBpcyB0aGUgcm9vdCBvZiB0aGUgZmlsZSBzeXN0ZW0uCiAqICAgICAgVG8gcmVhZCBmcm9tIHRoZSBTRCBjYXJkLCB0aGUgZmlsZSBuYW1lIGlzICJzZGNhcmQvbXlfZmlsZS50eHQiCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEZpbGVSZWFkZXIgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuZmlsZU5hbWUgPSAiIjsKCiAgICB0aGlzLnJlYWR5U3RhdGUgPSAwOyAvLyBGaWxlUmVhZGVyLkVNUFRZCgogICAgLy8gRmlsZSBkYXRhCiAgICB0aGlzLnJlc3VsdCA9IG51bGw7CgogICAgLy8gRXJyb3IKICAgIHRoaXMuZXJyb3IgPSBudWxsOwoKICAgIC8vIEV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLm9ubG9hZHN0YXJ0ID0gbnVsbDsgICAgLy8gV2hlbiB0aGUgcmVhZCBzdGFydHMuCiAgICB0aGlzLm9ucHJvZ3Jlc3MgPSBudWxsOyAgICAgLy8gV2hpbGUgcmVhZGluZyAoYW5kIGRlY29kaW5nKSBmaWxlIG9yIGZpbGVCbG9iIGRhdGEsIGFuZCByZXBvcnRpbmcgcGFydGlhbCBmaWxlIGRhdGEgKHByb2dlc3MubG9hZGVkL3Byb2dyZXNzLnRvdGFsKQogICAgdGhpcy5vbmxvYWQgPSBudWxsOyAgICAgICAgIC8vIFdoZW4gdGhlIHJlYWQgaGFzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuCiAgICB0aGlzLm9uZXJyb3IgPSBudWxsOyAgICAgICAgLy8gV2hlbiB0aGUgcmVhZCBoYXMgZmFpbGVkIChzZWUgZXJyb3JzKS4KICAgIHRoaXMub25sb2FkZW5kID0gbnVsbDsgICAgICAvLyBXaGVuIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQgKGVpdGhlciBpbiBzdWNjZXNzIG9yIGZhaWx1cmUpLgogICAgdGhpcy5vbmFib3J0ID0gbnVsbDsgICAgICAgIC8vIFdoZW4gdGhlIHJlYWQgaGFzIGJlZW4gYWJvcnRlZC4gRm9yIGluc3RhbmNlLCBieSBpbnZva2luZyB0aGUgYWJvcnQoKSBtZXRob2QuCn07CgovLyBTdGF0ZXMKRmlsZVJlYWRlci5FTVBUWSA9IDA7CkZpbGVSZWFkZXIuTE9BRElORyA9IDE7CkZpbGVSZWFkZXIuRE9ORSA9IDI7CgovKioKICogQWJvcnQgcmVhZGluZyBmaWxlLgogKi8KRmlsZVJlYWRlci5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMucmVzdWx0ID0gbnVsbDsKCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09IEZpbGVSZWFkZXIuRE9ORSB8fCB0aGlzLnJlYWR5U3RhdGUgPT0gRmlsZVJlYWRlci5FTVBUWSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwoKICAgIC8vIElmIGFib3J0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25hYm9ydCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMub25hYm9ydChuZXcgUHJvZ3Jlc3NFdmVudCgnYWJvcnQnLCB7dGFyZ2V0OnRoaXN9KSk7CiAgICB9CiAgICAvLyBJZiBsb2FkIGVuZCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9ubG9hZGVuZCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMub25sb2FkZW5kKG5ldyBQcm9ncmVzc0V2ZW50KCdsb2FkZW5kJywge3RhcmdldDp0aGlzfSkpOwogICAgfQp9OwoKLyoqCiAqIFJlYWQgdGV4dCBmaWxlLgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICB7RmlsZX0gRmlsZSBvYmplY3QgY29udGFpbmluZyBmaWxlIHByb3BlcnRpZXMKICogQHBhcmFtIGVuY29kaW5nICAgICAgW09wdGlvbmFsXSAoc2VlIGh0dHA6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvY2hhcmFjdGVyLXNldHMpCiAqLwpGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNUZXh0ID0gZnVuY3Rpb24oZmlsZSwgZW5jb2RpbmcpIHsKICAgIC8vIEZpZ3VyZSBvdXQgcGF0aGluZwogICAgdGhpcy5maWxlTmFtZSA9ICcnOwogICAgaWYgKHR5cGVvZiBmaWxlLmZ1bGxQYXRoID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbGVOYW1lID0gZmlsZS5mdWxsUGF0aDsKICAgIH0KCiAgICAvLyBBbHJlYWR5IGxvYWRpbmcgc29tZXRoaW5nCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09IEZpbGVSZWFkZXIuTE9BRElORykgewogICAgICAgIHRocm93IG5ldyBGaWxlRXJyb3IoRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSKTsKICAgIH0KCiAgICAvLyBMT0FESU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkxPQURJTkc7CgogICAgLy8gSWYgbG9hZHN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25sb2Fkc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9ubG9hZHN0YXJ0KG5ldyBQcm9ncmVzc0V2ZW50KCJsb2Fkc3RhcnQiLCB7dGFyZ2V0OnRoaXN9KSk7CiAgICB9CgogICAgLy8gRGVmYXVsdCBlbmNvZGluZyBpcyBVVEYtOAogICAgdmFyIGVuYyA9IGVuY29kaW5nID8gZW5jb2RpbmcgOiAiVVRGLTgiOwoKICAgIHZhciBtZSA9IHRoaXM7CgogICAgLy8gUmVhZCBmaWxlCiAgICBleGVjKAogICAgICAgIC8vIFN1Y2Nlc3MgY2FsbGJhY2sKICAgICAgICBmdW5jdGlvbihyKSB7CiAgICAgICAgICAgIC8vIElmIERPTkUgKGNhbmNlbGxlZCksIHRoZW4gZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgKG1lLnJlYWR5U3RhdGUgPT09IEZpbGVSZWFkZXIuRE9ORSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTYXZlIHJlc3VsdAogICAgICAgICAgICBtZS5yZXN1bHQgPSByOwoKICAgICAgICAgICAgLy8gSWYgb25sb2FkIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbmxvYWQobmV3IFByb2dyZXNzRXZlbnQoImxvYWQiLCB7dGFyZ2V0Om1lfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWRlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWRlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZChuZXcgUHJvZ3Jlc3NFdmVudCgibG9hZGVuZCIsIHt0YXJnZXQ6bWV9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlUmVhZGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwoKICAgICAgICAgICAgLy8gbnVsbCByZXN1bHQKICAgICAgICAgICAgbWUucmVzdWx0ID0gbnVsbDsKCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKICAgICAgICAgICAgbWUuZXJyb3IgPSBuZXcgRmlsZUVycm9yKGUpOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IobmV3IFByb2dyZXNzRXZlbnQoImVycm9yIiwge3RhcmdldDptZX0pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgb25sb2FkZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbmxvYWRlbmQobmV3IFByb2dyZXNzRXZlbnQoImxvYWRlbmQiLCB7dGFyZ2V0Om1lfSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgIkZpbGUiLCAicmVhZEFzVGV4dCIsIFt0aGlzLmZpbGVOYW1lLCBlbmNdKTsKfTsKCgovKioKICogUmVhZCBmaWxlIGFuZCByZXR1cm4gZGF0YSBhcyBhIGJhc2U2NCBlbmNvZGVkIGRhdGEgdXJsLgogKiBBIGRhdGEgdXJsIGlzIG9mIHRoZSBmb3JtOgogKiAgICAgIGRhdGE6WzxtZWRpYXR5cGU+XVs7YmFzZTY0XSw8ZGF0YT4KICoKICogQHBhcmFtIGZpbGUgICAgICAgICAge0ZpbGV9IEZpbGUgb2JqZWN0IGNvbnRhaW5pbmcgZmlsZSBwcm9wZXJ0aWVzCiAqLwpGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNEYXRhVVJMID0gZnVuY3Rpb24oZmlsZSkgewogICAgdGhpcy5maWxlTmFtZSA9ICIiOwogICAgaWYgKHR5cGVvZiBmaWxlLmZ1bGxQYXRoID09PSAidW5kZWZpbmVkIikgewogICAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbGVOYW1lID0gZmlsZS5mdWxsUGF0aDsKICAgIH0KCiAgICAvLyBBbHJlYWR5IGxvYWRpbmcgc29tZXRoaW5nCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09IEZpbGVSZWFkZXIuTE9BRElORykgewogICAgICAgIHRocm93IG5ldyBGaWxlRXJyb3IoRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSKTsKICAgIH0KCiAgICAvLyBMT0FESU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkxPQURJTkc7CgogICAgLy8gSWYgbG9hZHN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25sb2Fkc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9ubG9hZHN0YXJ0KG5ldyBQcm9ncmVzc0V2ZW50KCJsb2Fkc3RhcnQiLCB7dGFyZ2V0OnRoaXN9KSk7CiAgICB9CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBSZWFkIGZpbGUKICAgIGV4ZWMoCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVJlYWRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERPTkUgc3RhdGUKICAgICAgICAgICAgbWUucmVhZHlTdGF0ZSA9IEZpbGVSZWFkZXIuRE9ORTsKCiAgICAgICAgICAgIC8vIFNhdmUgcmVzdWx0CiAgICAgICAgICAgIG1lLnJlc3VsdCA9IHI7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZChuZXcgUHJvZ3Jlc3NFdmVudCgibG9hZCIsIHt0YXJnZXQ6bWV9KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIG9ubG9hZGVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ubG9hZGVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25sb2FkZW5kKG5ldyBQcm9ncmVzc0V2ZW50KCJsb2FkZW5kIiwge3RhcmdldDptZX0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8gRXJyb3IgY2FsbGJhY2sKICAgICAgICBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIC8vIElmIERPTkUgKGNhbmNlbGxlZCksIHRoZW4gZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgKG1lLnJlYWR5U3RhdGUgPT09IEZpbGVSZWFkZXIuRE9ORSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkRPTkU7CgogICAgICAgICAgICBtZS5yZXN1bHQgPSBudWxsOwoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IG5ldyBGaWxlRXJyb3IoZSk7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25lcnJvcihuZXcgUHJvZ3Jlc3NFdmVudCgiZXJyb3IiLCB7dGFyZ2V0Om1lfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBvbmxvYWRlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWRlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZChuZXcgUHJvZ3Jlc3NFdmVudCgibG9hZGVuZCIsIHt0YXJnZXQ6bWV9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAiRmlsZSIsICJyZWFkQXNEYXRhVVJMIiwgW3RoaXMuZmlsZU5hbWVdKTsKfTsKCi8qKgogKiBSZWFkIGZpbGUgYW5kIHJldHVybiBkYXRhIGFzIGEgYmluYXJ5IGRhdGEuCiAqCiAqIEBwYXJhbSBmaWxlICAgICAgICAgIHtGaWxlfSBGaWxlIG9iamVjdCBjb250YWluaW5nIGZpbGUgcHJvcGVydGllcwogKi8KRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQmluYXJ5U3RyaW5nID0gZnVuY3Rpb24oZmlsZSkgewogICAgLy8gVE9ETyAtIENhbid0IHJldHVybiBiaW5hcnkgZGF0YSB0byBicm93c2VyLgogICAgY29uc29sZS5sb2coJ21ldGhvZCAicmVhZEFzQmluYXJ5U3RyaW5nIiBpcyBub3Qgc3VwcG9ydGVkIGF0IHRoaXMgdGltZS4nKTsKfTsKCi8qKgogKiBSZWFkIGZpbGUgYW5kIHJldHVybiBkYXRhIGFzIGEgYmluYXJ5IGRhdGEuCiAqCiAqIEBwYXJhbSBmaWxlICAgICAgICAgIHtGaWxlfSBGaWxlIG9iamVjdCBjb250YWluaW5nIGZpbGUgcHJvcGVydGllcwogKi8KRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQXJyYXlCdWZmZXIgPSBmdW5jdGlvbihmaWxlKSB7CiAgICAvLyBUT0RPIC0gQ2FuJ3QgcmV0dXJuIGJpbmFyeSBkYXRhIHRvIGJyb3dzZXIuCiAgICBjb25zb2xlLmxvZygnVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBhdCB0aGlzIHRpbWUuJyk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IEZpbGVSZWFkZXI7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vRmlsZVN5c3RlbS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0ZpbGVTeXN0ZW0iLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIERpcmVjdG9yeUVudHJ5ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnknKTsKCi8qKgogKiBBbiBpbnRlcmZhY2UgcmVwcmVzZW50aW5nIGEgZmlsZSBzeXN0ZW0KICoKICogQGNvbnN0cnVjdG9yCiAqIHtET01TdHJpbmd9IG5hbWUgdGhlIHVuaXF1ZSBuYW1lIG9mIHRoZSBmaWxlIHN5c3RlbSAocmVhZG9ubHkpCiAqIHtEaXJlY3RvcnlFbnRyeX0gcm9vdCBkaXJlY3Rvcnkgb2YgdGhlIGZpbGUgc3lzdGVtIChyZWFkb25seSkKICovCnZhciBGaWxlU3lzdGVtID0gZnVuY3Rpb24obmFtZSwgcm9vdCkgewogICAgdGhpcy5uYW1lID0gbmFtZSB8fCBudWxsOwogICAgaWYgKHJvb3QpIHsKICAgICAgICB0aGlzLnJvb3QgPSBuZXcgRGlyZWN0b3J5RW50cnkocm9vdC5uYW1lLCByb290LmZ1bGxQYXRoKTsKICAgIH0KfTsKCm1vZHVsZS5leHBvcnRzID0gRmlsZVN5c3RlbTsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vRmlsZVRyYW5zZmVyLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRmlsZVRyYW5zZmVyIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyksCiAgICBGaWxlVHJhbnNmZXJFcnJvciA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVUcmFuc2ZlckVycm9yJyk7CgovKioKICogRmlsZVRyYW5zZmVyIHVwbG9hZHMgYSBmaWxlIHRvIGEgcmVtb3RlIHNlcnZlci4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRmlsZVRyYW5zZmVyID0gZnVuY3Rpb24oKSB7fTsKCi8qKgoqIEdpdmVuIGFuIGFic29sdXRlIGZpbGUgcGF0aCwgdXBsb2FkcyBhIGZpbGUgb24gdGhlIGRldmljZSB0byBhIHJlbW90ZSBzZXJ2ZXIKKiB1c2luZyBhIG11bHRpcGFydCBIVFRQIHJlcXVlc3QuCiogQHBhcmFtIGZpbGVQYXRoIHtTdHJpbmd9ICAgICAgICAgICBGdWxsIHBhdGggb2YgdGhlIGZpbGUgb24gdGhlIGRldmljZQoqIEBwYXJhbSBzZXJ2ZXIge1N0cmluZ30gICAgICAgICAgICAgVVJMIG9mIHRoZSBzZXJ2ZXIgdG8gcmVjZWl2ZSB0aGUgZmlsZQoqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sgKEZ1bmN0aW9ufSAgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCB3aGVuIHVwbG9hZCBoYXMgY29tcGxldGVkCiogQHBhcmFtIGVycm9yQ2FsbGJhY2sge0Z1bmN0aW9ufSAgICBDYWxsYmFjayB0byBiZSBpbnZva2VkIHVwb24gZXJyb3IKKiBAcGFyYW0gb3B0aW9ucyB7RmlsZVVwbG9hZE9wdGlvbnN9IE9wdGlvbmFsIHBhcmFtZXRlcnMgc3VjaCBhcyBmaWxlIG5hbWUgYW5kIG1pbWV0eXBlCiogQHBhcmFtIHRydXN0QWxsSG9zdHMge0Jvb2xlYW59IE9wdGlvbmFsIHRydXN0IGFsbCBob3N0cyAoZS5nLiBmb3Igc2VsZi1zaWduZWQgY2VydHMpLCBkZWZhdWx0cyB0byBmYWxzZQoqLwpGaWxlVHJhbnNmZXIucHJvdG90eXBlLnVwbG9hZCA9IGZ1bmN0aW9uKGZpbGVQYXRoLCBzZXJ2ZXIsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucywgdHJ1c3RBbGxIb3N0cykgewogICAgLy8gc2FuaXR5IHBhcmFtZXRlciBjaGVja2luZwogICAgaWYgKCFmaWxlUGF0aCB8fCAhc2VydmVyKSB0aHJvdyBuZXcgRXJyb3IoIkZpbGVUcmFuc2Zlci51cGxvYWQgcmVxdWlyZXMgZmlsZVBhdGggYW5kIHNlcnZlciBVUkwgcGFyYW1ldGVycyBhdCB0aGUgbWluaW11bS4iKTsKICAgIC8vIGNoZWNrIGZvciBvcHRpb25zCiAgICB2YXIgZmlsZUtleSA9IG51bGw7CiAgICB2YXIgZmlsZU5hbWUgPSBudWxsOwogICAgdmFyIG1pbWVUeXBlID0gbnVsbDsKICAgIHZhciBwYXJhbXMgPSBudWxsOwogICAgdmFyIGNodW5rZWRNb2RlID0gdHJ1ZTsKICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgZmlsZUtleSA9IG9wdGlvbnMuZmlsZUtleTsKICAgICAgICBmaWxlTmFtZSA9IG9wdGlvbnMuZmlsZU5hbWU7CiAgICAgICAgbWltZVR5cGUgPSBvcHRpb25zLm1pbWVUeXBlOwogICAgICAgIGlmIChvcHRpb25zLmNodW5rZWRNb2RlICE9PSBudWxsIHx8IHR5cGVvZiBvcHRpb25zLmNodW5rZWRNb2RlICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGNodW5rZWRNb2RlID0gb3B0aW9ucy5jaHVua2VkTW9kZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMucGFyYW1zKSB7CiAgICAgICAgICAgIHBhcmFtcyA9IG9wdGlvbnMucGFyYW1zOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcGFyYW1zID0ge307CiAgICAgICAgfQogICAgfQoKICAgIHZhciBmYWlsID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBlcnJvciA9IG5ldyBGaWxlVHJhbnNmZXJFcnJvcihlLmNvZGUsIGUuc291cmNlLCBlLnRhcmdldCwgZS5odHRwX3N0YXR1cyk7CiAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7CiAgICB9OwoKICAgIGV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBmYWlsLCAnRmlsZVRyYW5zZmVyJywgJ3VwbG9hZCcsIFtmaWxlUGF0aCwgc2VydmVyLCBmaWxlS2V5LCBmaWxlTmFtZSwgbWltZVR5cGUsIHBhcmFtcywgdHJ1c3RBbGxIb3N0cywgY2h1bmtlZE1vZGVdKTsKfTsKCi8qKgogKiBEb3dubG9hZHMgYSBmaWxlIGZvcm0gYSBnaXZlbiBVUkwgYW5kIHNhdmVzIGl0IHRvIHRoZSBzcGVjaWZpZWQgZGlyZWN0b3J5LgogKiBAcGFyYW0gc291cmNlIHtTdHJpbmd9ICAgICAgICAgIFVSTCBvZiB0aGUgc2VydmVyIHRvIHJlY2VpdmUgdGhlIGZpbGUKICogQHBhcmFtIHRhcmdldCB7U3RyaW5nfSAgICAgICAgIEZ1bGwgcGF0aCBvZiB0aGUgZmlsZSBvbiB0aGUgZGV2aWNlCiAqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sgKEZ1bmN0aW9ufSAgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCB3aGVuIHVwbG9hZCBoYXMgY29tcGxldGVkCiAqIEBwYXJhbSBlcnJvckNhbGxiYWNrIHtGdW5jdGlvbn0gICAgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCB1cG9uIGVycm9yCiAqLwpGaWxlVHJhbnNmZXIucHJvdG90eXBlLmRvd25sb2FkID0gZnVuY3Rpb24oc291cmNlLCB0YXJnZXQsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgLy8gc2FuaXR5IHBhcmFtZXRlciBjaGVja2luZwogICAgaWYgKCFzb3VyY2UgfHwgIXRhcmdldCkgdGhyb3cgbmV3IEVycm9yKCJGaWxlVHJhbnNmZXIuZG93bmxvYWQgcmVxdWlyZXMgc291cmNlIFVSSSBhbmQgdGFyZ2V0IFVSSSBwYXJhbWV0ZXJzIGF0IHRoZSBtaW5pbXVtLiIpOwogICAgdmFyIHdpbiA9IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgIHZhciBlbnRyeSA9IG51bGw7CiAgICAgICAgaWYgKHJlc3VsdC5pc0RpcmVjdG9yeSkgewogICAgICAgICAgICBlbnRyeSA9IG5ldyAocmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnknKSkoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocmVzdWx0LmlzRmlsZSkgewogICAgICAgICAgICBlbnRyeSA9IG5ldyAocmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVudHJ5JykpKCk7CiAgICAgICAgfQogICAgICAgIGVudHJ5LmlzRGlyZWN0b3J5ID0gcmVzdWx0LmlzRGlyZWN0b3J5OwogICAgICAgIGVudHJ5LmlzRmlsZSA9IHJlc3VsdC5pc0ZpbGU7CiAgICAgICAgZW50cnkubmFtZSA9IHJlc3VsdC5uYW1lOwogICAgICAgIGVudHJ5LmZ1bGxQYXRoID0gcmVzdWx0LmZ1bGxQYXRoOwogICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhlbnRyeSk7CiAgICB9OwoKICAgIHZhciBmYWlsID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBlcnJvciA9IG5ldyBGaWxlVHJhbnNmZXJFcnJvcihlLmNvZGUsIGUuc291cmNlLCBlLnRhcmdldCwgZS5odHRwX3N0YXR1cyk7CiAgICAgICAgZXJyb3JDYWxsYmFjayhlcnJvcik7CiAgICB9OwoKICAgIGV4ZWMod2luLCBlcnJvckNhbGxiYWNrLCAnRmlsZVRyYW5zZmVyJywgJ2Rvd25sb2FkJywgW3NvdXJjZSwgdGFyZ2V0XSk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IEZpbGVUcmFuc2ZlcjsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vRmlsZVRyYW5zZmVyRXJyb3IuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9GaWxlVHJhbnNmZXJFcnJvciIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogRmlsZVRyYW5zZmVyRXJyb3IKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRmlsZVRyYW5zZmVyRXJyb3IgPSBmdW5jdGlvbihjb2RlLCBzb3VyY2UsIHRhcmdldCwgc3RhdHVzKSB7CiAgICB0aGlzLmNvZGUgPSBjb2RlIHx8IG51bGw7CiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZSB8fCBudWxsOwogICAgdGhpcy50YXJnZXQgPSB0YXJnZXQgfHwgbnVsbDsKICAgIHRoaXMuaHR0cF9zdGF0dXMgPSBzdGF0dXMgfHwgbnVsbDsKfTsKCkZpbGVUcmFuc2ZlckVycm9yLkZJTEVfTk9UX0ZPVU5EX0VSUiA9IDE7CkZpbGVUcmFuc2ZlckVycm9yLklOVkFMSURfVVJMX0VSUiA9IDI7CkZpbGVUcmFuc2ZlckVycm9yLkNPTk5FQ1RJT05fRVJSID0gMzsKCm1vZHVsZS5leHBvcnRzID0gRmlsZVRyYW5zZmVyRXJyb3I7Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0ZpbGVVcGxvYWRPcHRpb25zLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vRmlsZVVwbG9hZE9wdGlvbnMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIE9wdGlvbnMgdG8gY3VzdG9taXplIHRoZSBIVFRQIHJlcXVlc3QgdXNlZCB0byB1cGxvYWQgZmlsZXMuCiAqIEBjb25zdHJ1Y3RvcgogKiBAcGFyYW0gZmlsZUtleSB7U3RyaW5nfSAgIE5hbWUgb2YgZmlsZSByZXF1ZXN0IHBhcmFtZXRlci4KICogQHBhcmFtIGZpbGVOYW1lIHtTdHJpbmd9ICBGaWxlbmFtZSB0byBiZSB1c2VkIGJ5IHRoZSBzZXJ2ZXIuIERlZmF1bHRzIHRvIGltYWdlLmpwZy4KICogQHBhcmFtIG1pbWVUeXBlIHtTdHJpbmd9ICBNaW1ldHlwZSBvZiB0aGUgdXBsb2FkZWQgZmlsZS4gRGVmYXVsdHMgdG8gaW1hZ2UvanBlZy4KICogQHBhcmFtIHBhcmFtcyB7T2JqZWN0fSAgICBPYmplY3Qgd2l0aCBrZXk6IHZhbHVlIHBhcmFtcyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIuCiAqLwp2YXIgRmlsZVVwbG9hZE9wdGlvbnMgPSBmdW5jdGlvbihmaWxlS2V5LCBmaWxlTmFtZSwgbWltZVR5cGUsIHBhcmFtcykgewogICAgdGhpcy5maWxlS2V5ID0gZmlsZUtleSB8fCBudWxsOwogICAgdGhpcy5maWxlTmFtZSA9IGZpbGVOYW1lIHx8IG51bGw7CiAgICB0aGlzLm1pbWVUeXBlID0gbWltZVR5cGUgfHwgbnVsbDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zIHx8IG51bGw7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IEZpbGVVcGxvYWRPcHRpb25zOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0ZpbGVVcGxvYWRSZXN1bHQuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9GaWxlVXBsb2FkUmVzdWx0IiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBGaWxlVXBsb2FkUmVzdWx0CiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEZpbGVVcGxvYWRSZXN1bHQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuYnl0ZXNTZW50ID0gMDsKICAgIHRoaXMucmVzcG9uc2VDb2RlID0gbnVsbDsKICAgIHRoaXMucmVzcG9uc2UgPSBudWxsOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBGaWxlVXBsb2FkUmVzdWx0Owp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0ZpbGVXcml0ZXIuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9GaWxlV3JpdGVyIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyksCiAgICBGaWxlRXJyb3IgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9GaWxlRXJyb3InKSwKICAgIFByb2dyZXNzRXZlbnQgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9Qcm9ncmVzc0V2ZW50Jyk7CgovKioKICogVGhpcyBjbGFzcyB3cml0ZXMgdG8gdGhlIG1vYmlsZSBkZXZpY2UgZmlsZSBzeXN0ZW0uCiAqCiAqIEZvciBBbmRyb2lkOgogKiAgICAgIFRoZSByb290IGRpcmVjdG9yeSBpcyB0aGUgcm9vdCBvZiB0aGUgZmlsZSBzeXN0ZW0uCiAqICAgICAgVG8gd3JpdGUgdG8gdGhlIFNEIGNhcmQsIHRoZSBmaWxlIG5hbWUgaXMgInNkY2FyZC9teV9maWxlLnR4dCIKICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBmaWxlIHtGaWxlfSBGaWxlIG9iamVjdCBjb250YWluaW5nIGZpbGUgcHJvcGVydGllcwogKiBAcGFyYW0gYXBwZW5kIGlmIHRydWUgd3JpdGUgdG8gdGhlIGVuZCBvZiB0aGUgZmlsZSwgb3RoZXJ3aXNlIG92ZXJ3cml0ZSB0aGUgZmlsZQogKi8KdmFyIEZpbGVXcml0ZXIgPSBmdW5jdGlvbihmaWxlKSB7CiAgICB0aGlzLmZpbGVOYW1lID0gIiI7CiAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICBpZiAoZmlsZSkgewogICAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlLmZ1bGxQYXRoIHx8IGZpbGU7CiAgICAgICAgdGhpcy5sZW5ndGggPSBmaWxlLnNpemUgfHwgMDsKICAgIH0KICAgIC8vIGRlZmF1bHQgaXMgdG8gd3JpdGUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZQogICAgdGhpcy5wb3NpdGlvbiA9IDA7CgogICAgdGhpcy5yZWFkeVN0YXRlID0gMDsgLy8gRU1QVFkKCiAgICB0aGlzLnJlc3VsdCA9IG51bGw7CgogICAgLy8gRXJyb3IKICAgIHRoaXMuZXJyb3IgPSBudWxsOwoKICAgIC8vIEV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLm9ud3JpdGVzdGFydCA9IG51bGw7ICAgLy8gV2hlbiB3cml0aW5nIHN0YXJ0cwogICAgdGhpcy5vbnByb2dyZXNzID0gbnVsbDsgICAgIC8vIFdoaWxlIHdyaXRpbmcgdGhlIGZpbGUsIGFuZCByZXBvcnRpbmcgcGFydGlhbCBmaWxlIGRhdGEKICAgIHRoaXMub253cml0ZSA9IG51bGw7ICAgICAgICAvLyBXaGVuIHRoZSB3cml0ZSBoYXMgc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZC4KICAgIHRoaXMub253cml0ZWVuZCA9IG51bGw7ICAgICAvLyBXaGVuIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQgKGVpdGhlciBpbiBzdWNjZXNzIG9yIGZhaWx1cmUpLgogICAgdGhpcy5vbmFib3J0ID0gbnVsbDsgICAgICAgIC8vIFdoZW4gdGhlIHdyaXRlIGhhcyBiZWVuIGFib3J0ZWQuIEZvciBpbnN0YW5jZSwgYnkgaW52b2tpbmcgdGhlIGFib3J0KCkgbWV0aG9kLgogICAgdGhpcy5vbmVycm9yID0gbnVsbDsgICAgICAgIC8vIFdoZW4gdGhlIHdyaXRlIGhhcyBmYWlsZWQgKHNlZSBlcnJvcnMpLgp9OwoKLy8gU3RhdGVzCkZpbGVXcml0ZXIuSU5JVCA9IDA7CkZpbGVXcml0ZXIuV1JJVElORyA9IDE7CkZpbGVXcml0ZXIuRE9ORSA9IDI7CgovKioKICogQWJvcnQgd3JpdGluZyBmaWxlLgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgIC8vIGNoZWNrIGZvciBpbnZhbGlkIHN0YXRlCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUgfHwgdGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLklOSVQpIHsKICAgICAgICB0aHJvdyBuZXcgRmlsZUVycm9yKEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUik7CiAgICB9CgogICAgLy8gc2V0IGVycm9yCiAgICB0aGlzLmVycm9yID0gbmV3IEZpbGVFcnJvcihGaWxlRXJyb3IuQUJPUlRfRVJSKTsKCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgLy8gSWYgYWJvcnQgY2FsbGJhY2sKICAgIGlmICh0eXBlb2YgdGhpcy5vbmFib3J0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgdGhpcy5vbmFib3J0KG5ldyBQcm9ncmVzc0V2ZW50KCJhYm9ydCIsIHsidGFyZ2V0Ijp0aGlzfSkpOwogICAgfQoKICAgIC8vIElmIHdyaXRlIGVuZCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9ud3JpdGVlbmQobmV3IFByb2dyZXNzRXZlbnQoIndyaXRlZW5kIiwgeyJ0YXJnZXQiOnRoaXN9KSk7CiAgICB9Cn07CgovKioKICogV3JpdGVzIGRhdGEgdG8gdGhlIGZpbGUKICoKICogQHBhcmFtIHRleHQgdG8gYmUgd3JpdHRlbgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbih0ZXh0KSB7CiAgICAvLyBUaHJvdyBhbiBleGNlcHRpb24gaWYgd2UgYXJlIGFscmVhZHkgd3JpdGluZyBhIGZpbGUKICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuV1JJVElORykgewogICAgICAgIHRocm93IG5ldyBGaWxlRXJyb3IoRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSKTsKICAgIH0KCiAgICAvLyBXUklUSU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLldSSVRJTkc7CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBJZiBvbndyaXRlc3RhcnQgY2FsbGJhY2sKICAgIGlmICh0eXBlb2YgbWUub253cml0ZXN0YXJ0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgbWUub253cml0ZXN0YXJ0KG5ldyBQcm9ncmVzc0V2ZW50KCJ3cml0ZXN0YXJ0IiwgeyJ0YXJnZXQiOm1lfSkpOwogICAgfQoKICAgIC8vIFdyaXRlIGZpbGUKICAgIGV4ZWMoCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBvc2l0aW9uIGFsd2F5cyBpbmNyZWFzZXMgYnkgYnl0ZXMgd3JpdHRlbiBiZWNhdXNlIGZpbGUgd291bGQgYmUgZXh0ZW5kZWQKICAgICAgICAgICAgbWUucG9zaXRpb24gKz0gcjsKICAgICAgICAgICAgLy8gVGhlIGxlbmd0aCBvZiB0aGUgZmlsZSBpcyBub3cgd2hlcmUgd2UgYXJlIGRvbmUgd3JpdGluZy4KCiAgICAgICAgICAgIG1lLmxlbmd0aCA9IG1lLnBvc2l0aW9uOwoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUobmV3IFByb2dyZXNzRXZlbnQoIndyaXRlIiwgeyJ0YXJnZXQiOm1lfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBvbndyaXRlZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub253cml0ZWVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub253cml0ZWVuZChuZXcgUHJvZ3Jlc3NFdmVudCgid3JpdGVlbmQiLCB7InRhcmdldCI6bWV9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IG5ldyBGaWxlRXJyb3IoZSk7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25lcnJvcihuZXcgUHJvZ3Jlc3NFdmVudCgiZXJyb3IiLCB7InRhcmdldCI6bWV9KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIG9ud3JpdGVlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbndyaXRlZW5kKG5ldyBQcm9ncmVzc0V2ZW50KCJ3cml0ZWVuZCIsIHsidGFyZ2V0IjptZX0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0sICJGaWxlIiwgIndyaXRlIiwgW3RoaXMuZmlsZU5hbWUsIHRleHQsIHRoaXMucG9zaXRpb25dKTsKfTsKCi8qKgogKiBNb3ZlcyB0aGUgZmlsZSBwb2ludGVyIHRvIHRoZSBsb2NhdGlvbiBzcGVjaWZpZWQuCiAqCiAqIElmIHRoZSBvZmZzZXQgaXMgYSBuZWdhdGl2ZSBudW1iZXIgdGhlIHBvc2l0aW9uIG9mIHRoZSBmaWxlCiAqIHBvaW50ZXIgaXMgcmV3b3VuZC4gIElmIHRoZSBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIHRoZSBmaWxlCiAqIHNpemUgdGhlIHBvc2l0aW9uIGlzIHNldCB0byB0aGUgZW5kIG9mIHRoZSBmaWxlLgogKgogKiBAcGFyYW0gb2Zmc2V0IGlzIHRoZSBsb2NhdGlvbiB0byBtb3ZlIHRoZSBmaWxlIHBvaW50ZXIgdG8uCiAqLwpGaWxlV3JpdGVyLnByb3RvdHlwZS5zZWVrID0gZnVuY3Rpb24ob2Zmc2V0KSB7CiAgICAvLyBUaHJvdyBhbiBleGNlcHRpb24gaWYgd2UgYXJlIGFscmVhZHkgd3JpdGluZyBhIGZpbGUKICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuV1JJVElORykgewogICAgICAgIHRocm93IG5ldyBGaWxlRXJyb3IoRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSKTsKICAgIH0KCiAgICBpZiAoIW9mZnNldCAmJiBvZmZzZXQgIT09IDApIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gU2VlIGJhY2sgZnJvbSBlbmQgb2YgZmlsZS4KICAgIGlmIChvZmZzZXQgPCAwKSB7CiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IE1hdGgubWF4KG9mZnNldCArIHRoaXMubGVuZ3RoLCAwKTsKICAgIH0KICAgIC8vIE9mZnNldCBpcyBiaWdnZXIgdGhlbiBmaWxlIHNpemUgc28gc2V0IHBvc2l0aW9uCiAgICAvLyB0byB0aGUgZW5kIG9mIHRoZSBmaWxlLgogICAgZWxzZSBpZiAob2Zmc2V0ID4gdGhpcy5sZW5ndGgpIHsKICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy5sZW5ndGg7CiAgICB9CiAgICAvLyBPZmZzZXQgaXMgYmV0d2VlbiAwIGFuZCBmaWxlIHNpemUgc28gc2V0IHRoZSBwb3NpdGlvbgogICAgLy8gdG8gc3RhcnQgd3JpdGluZy4KICAgIGVsc2UgewogICAgICAgIHRoaXMucG9zaXRpb24gPSBvZmZzZXQ7CiAgICB9Cn07CgovKioKICogVHJ1bmNhdGVzIHRoZSBmaWxlIHRvIHRoZSBzaXplIHNwZWNpZmllZC4KICoKICogQHBhcmFtIHNpemUgdG8gY2hvcCB0aGUgZmlsZSBhdC4KICovCkZpbGVXcml0ZXIucHJvdG90eXBlLnRydW5jYXRlID0gZnVuY3Rpb24oc2l6ZSkgewogICAgLy8gVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHdlIGFyZSBhbHJlYWR5IHdyaXRpbmcgYSBmaWxlCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLldSSVRJTkcpIHsKICAgICAgICB0aHJvdyBuZXcgRmlsZUVycm9yKEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUik7CiAgICB9CgogICAgLy8gV1JJVElORyBzdGF0ZQogICAgdGhpcy5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5XUklUSU5HOwoKICAgIHZhciBtZSA9IHRoaXM7CgogICAgLy8gSWYgb253cml0ZXN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVzdGFydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIG1lLm9ud3JpdGVzdGFydChuZXcgUHJvZ3Jlc3NFdmVudCgid3JpdGVzdGFydCIsIHsidGFyZ2V0Ijp0aGlzfSkpOwogICAgfQoKICAgIC8vIFdyaXRlIGZpbGUKICAgIGV4ZWMoCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERPTkUgc3RhdGUKICAgICAgICAgICAgbWUucmVhZHlTdGF0ZSA9IEZpbGVXcml0ZXIuRE9ORTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbGVuZ3RoIG9mIHRoZSBmaWxlCiAgICAgICAgICAgIG1lLmxlbmd0aCA9IHI7CiAgICAgICAgICAgIG1lLnBvc2l0aW9uID0gTWF0aC5taW4obWUucG9zaXRpb24sIHIpOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUobmV3IFByb2dyZXNzRXZlbnQoIndyaXRlIiwgeyJ0YXJnZXQiOm1lfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBvbndyaXRlZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub253cml0ZWVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub253cml0ZWVuZChuZXcgUHJvZ3Jlc3NFdmVudCgid3JpdGVlbmQiLCB7InRhcmdldCI6bWV9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IG5ldyBGaWxlRXJyb3IoZSk7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25lcnJvcihuZXcgUHJvZ3Jlc3NFdmVudCgiZXJyb3IiLCB7InRhcmdldCI6bWV9KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIG9ud3JpdGVlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbndyaXRlZW5kKG5ldyBQcm9ncmVzc0V2ZW50KCJ3cml0ZWVuZCIsIHsidGFyZ2V0IjptZX0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0sICJGaWxlIiwgInRydW5jYXRlIiwgW3RoaXMuZmlsZU5hbWUsIHNpemVdKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gRmlsZVdyaXRlcjsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vRmxhZ3MuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9GbGFncyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogU3VwcGxpZXMgYXJndW1lbnRzIHRvIG1ldGhvZHMgdGhhdCBsb29rdXAgb3IgY3JlYXRlIGZpbGVzIGFuZCBkaXJlY3Rvcmllcy4KICoKICogQHBhcmFtIGNyZWF0ZQogKiAgICAgICAgICAgIHtib29sZWFufSBmaWxlIG9yIGRpcmVjdG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0CiAqIEBwYXJhbSBleGNsdXNpdmUKICogICAgICAgICAgICB7Ym9vbGVhbn0gdXNlZCB3aXRoIGNyZWF0ZTsgaWYgdHJ1ZSB0aGUgY29tbWFuZCB3aWxsIGZhaWwgaWYKICogICAgICAgICAgICB0YXJnZXQgcGF0aCBleGlzdHMKICovCmZ1bmN0aW9uIEZsYWdzKGNyZWF0ZSwgZXhjbHVzaXZlKSB7CiAgICB0aGlzLmNyZWF0ZSA9IGNyZWF0ZSB8fCBmYWxzZTsKICAgIHRoaXMuZXhjbHVzaXZlID0gZXhjbHVzaXZlIHx8IGZhbHNlOwp9Cgptb2R1bGUuZXhwb3J0cyA9IEZsYWdzOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL0xvY2FsRmlsZVN5c3RlbS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL0xvY2FsRmlsZVN5c3RlbSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpOwoKLyoqCiAqIFJlcHJlc2VudHMgYSBsb2NhbCBmaWxlIHN5c3RlbS4KICovCnZhciBMb2NhbEZpbGVTeXN0ZW0gPSBmdW5jdGlvbigpIHsKCn07CgpMb2NhbEZpbGVTeXN0ZW0uVEVNUE9SQVJZID0gMDsgLy90ZW1wb3JhcnksIHdpdGggbm8gZ3VhcmFudGVlIG9mIHBlcnNpc3RlbmNlCkxvY2FsRmlsZVN5c3RlbS5QRVJTSVNURU5UID0gMTsgLy9wZXJzaXN0ZW50Cgptb2R1bGUuZXhwb3J0cyA9IExvY2FsRmlsZVN5c3RlbTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9NZWRpYS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL01lZGlhIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciB1dGlscyA9IHJlcXVpcmUoJ2NvcmRvdmEvdXRpbHMnKSwKICAgIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKCnZhciBtZWRpYU9iamVjdHMgPSB7fTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byB0aGUgZGV2aWNlIG1lZGlhLCBpbnRlcmZhY2VzIHRvIGJvdGggc291bmQgYW5kIHZpZGVvCiAqCiAqIEBjb25zdHJ1Y3RvcgogKiBAcGFyYW0gc3JjICAgICAgICAgICAgICAgICAgIFRoZSBmaWxlIG5hbWUgb3IgdXJsIHRvIHBsYXkKICogQHBhcmFtIHN1Y2Nlc3NDYWxsYmFjayAgICAgICBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGZpbGUgaXMgZG9uZSBwbGF5aW5nIG9yIHJlY29yZGluZy4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCkKICogQHBhcmFtIGVycm9yQ2FsbGJhY2sgICAgICAgICBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIGlmIHRoZXJlIGlzIGFuIGVycm9yLgogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGludCBlcnJvckNvZGUpIC0gT1BUSU9OQUwKICogQHBhcmFtIHN0YXR1c0NhbGxiYWNrICAgICAgICBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gbWVkaWEgc3RhdHVzIGhhcyBjaGFuZ2VkLgogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDYWxsYmFjayhpbnQgc3RhdHVzQ29kZSkgLSBPUFRJT05BTAogKi8KdmFyIE1lZGlhID0gZnVuY3Rpb24oc3JjLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIHN0YXR1c0NhbGxiYWNrKSB7CgogICAgLy8gc3VjY2Vzc0NhbGxiYWNrIG9wdGlvbmFsCiAgICBpZiAoc3VjY2Vzc0NhbGxiYWNrICYmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJNZWRpYSBFcnJvcjogc3VjY2Vzc0NhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChlcnJvckNhbGxiYWNrICYmICh0eXBlb2YgZXJyb3JDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikpIHsKICAgICAgICBjb25zb2xlLmxvZygiTWVkaWEgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gc3RhdHVzQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChzdGF0dXNDYWxsYmFjayAmJiAodHlwZW9mIHN0YXR1c0NhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJNZWRpYSBFcnJvcjogc3RhdHVzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5pZCA9IHV0aWxzLmNyZWF0ZVVVSUQoKTsKICAgIG1lZGlhT2JqZWN0c1t0aGlzLmlkXSA9IHRoaXM7CiAgICB0aGlzLnNyYyA9IHNyYzsKICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrID0gc3VjY2Vzc0NhbGxiYWNrOwogICAgdGhpcy5lcnJvckNhbGxiYWNrID0gZXJyb3JDYWxsYmFjazsKICAgIHRoaXMuc3RhdHVzQ2FsbGJhY2sgPSBzdGF0dXNDYWxsYmFjazsKICAgIHRoaXMuX2R1cmF0aW9uID0gLTE7CiAgICB0aGlzLl9wb3NpdGlvbiA9IC0xOwogICAgZXhlYyhudWxsLCB0aGlzLmVycm9yQ2FsbGJhY2ssICJNZWRpYSIsICJjcmVhdGUiLCBbdGhpcy5pZCwgdGhpcy5zcmNdKTsKfTsKCi8vIE1lZGlhIG1lc3NhZ2VzCk1lZGlhLk1FRElBX1NUQVRFID0gMTsKTWVkaWEuTUVESUFfRFVSQVRJT04gPSAyOwpNZWRpYS5NRURJQV9QT1NJVElPTiA9IDM7Ck1lZGlhLk1FRElBX0VSUk9SID0gOTsKCi8vIE1lZGlhIHN0YXRlcwpNZWRpYS5NRURJQV9OT05FID0gMDsKTWVkaWEuTUVESUFfU1RBUlRJTkcgPSAxOwpNZWRpYS5NRURJQV9SVU5OSU5HID0gMjsKTWVkaWEuTUVESUFfUEFVU0VEID0gMzsKTWVkaWEuTUVESUFfU1RPUFBFRCA9IDQ7Ck1lZGlhLk1FRElBX01TRyA9IFsiTm9uZSIsICJTdGFydGluZyIsICJSdW5uaW5nIiwgIlBhdXNlZCIsICJTdG9wcGVkIl07CgovLyAic3RhdGljIiBmdW5jdGlvbiB0byByZXR1cm4gZXhpc3Rpbmcgb2Jqcy4KTWVkaWEuZ2V0ID0gZnVuY3Rpb24oaWQpIHsKICAgIHJldHVybiBtZWRpYU9iamVjdHNbaWRdOwp9OwoKLyoqCiAqIFN0YXJ0IG9yIHJlc3VtZSBwbGF5aW5nIGF1ZGlvIGZpbGUuCiAqLwpNZWRpYS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIGV4ZWMobnVsbCwgbnVsbCwgIk1lZGlhIiwgInN0YXJ0UGxheWluZ0F1ZGlvIiwgW3RoaXMuaWQsIHRoaXMuc3JjLCBvcHRpb25zXSk7Cn07CgovKioKICogU3RvcCBwbGF5aW5nIGF1ZGlvIGZpbGUuCiAqLwpNZWRpYS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG1lID0gdGhpczsKICAgIGV4ZWMoZnVuY3Rpb24oKSB7CiAgICAgICAgbWUuX3Bvc2l0aW9uID0gMDsKICAgICAgICBtZS5zdWNjZXNzQ2FsbGJhY2soKTsKICAgIH0sIHRoaXMuZXJyb3JDYWxsYmFjaywgIk1lZGlhIiwgInN0b3BQbGF5aW5nQXVkaW8iLCBbdGhpcy5pZF0pOwp9OwoKLyoqCiAqIFNlZWsgb3IganVtcCB0byBhIG5ldyB0aW1lIGluIHRoZSB0cmFjay4uCiAqLwpNZWRpYS5wcm90b3R5cGUuc2Vla1RvID0gZnVuY3Rpb24obWlsbGlzZWNvbmRzKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgZXhlYyhmdW5jdGlvbihwKSB7CiAgICAgICAgbWUuX3Bvc2l0aW9uID0gcDsKICAgIH0sIHRoaXMuZXJyb3JDYWxsYmFjaywgIk1lZGlhIiwgInNlZWtUb0F1ZGlvIiwgW3RoaXMuaWQsIG1pbGxpc2Vjb25kc10pOwp9OwoKLyoqCiAqIFBhdXNlIHBsYXlpbmcgYXVkaW8gZmlsZS4KICovCk1lZGlhLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgewogICAgZXhlYyhudWxsLCB0aGlzLmVycm9yQ2FsbGJhY2ssICJNZWRpYSIsICJwYXVzZVBsYXlpbmdBdWRpbyIsIFt0aGlzLmlkXSk7Cn07CgovKioKICogR2V0IGR1cmF0aW9uIG9mIGFuIGF1ZGlvIGZpbGUuCiAqIFRoZSBkdXJhdGlvbiBpcyBvbmx5IHNldCBmb3IgYXVkaW8gdGhhdCBpcyBwbGF5aW5nLCBwYXVzZWQgb3Igc3RvcHBlZC4KICoKICogQHJldHVybiAgICAgIGR1cmF0aW9uIG9yIC0xIGlmIG5vdCBrbm93bi4KICovCk1lZGlhLnByb3RvdHlwZS5nZXREdXJhdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuX2R1cmF0aW9uOwp9OwoKLyoqCiAqIEdldCBwb3NpdGlvbiBvZiBhdWRpby4KICovCk1lZGlhLnByb3RvdHlwZS5nZXRDdXJyZW50UG9zaXRpb24gPSBmdW5jdGlvbihzdWNjZXNzLCBmYWlsKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgZXhlYyhmdW5jdGlvbihwKSB7CiAgICAgICAgbWUuX3Bvc2l0aW9uID0gcDsKICAgICAgICBzdWNjZXNzKHApOwogICAgfSwgZmFpbCwgIk1lZGlhIiwgImdldEN1cnJlbnRQb3NpdGlvbkF1ZGlvIiwgW3RoaXMuaWRdKTsKfTsKCi8qKgogKiBTdGFydCByZWNvcmRpbmcgYXVkaW8gZmlsZS4KICovCk1lZGlhLnByb3RvdHlwZS5zdGFydFJlY29yZCA9IGZ1bmN0aW9uKCkgewogICAgZXhlYyh0aGlzLnN1Y2Nlc3NDYWxsYmFjaywgdGhpcy5lcnJvckNhbGxiYWNrLCAiTWVkaWEiLCAic3RhcnRSZWNvcmRpbmdBdWRpbyIsIFt0aGlzLmlkLCB0aGlzLnNyY10pOwp9OwoKLyoqCiAqIFN0b3AgcmVjb3JkaW5nIGF1ZGlvIGZpbGUuCiAqLwpNZWRpYS5wcm90b3R5cGUuc3RvcFJlY29yZCA9IGZ1bmN0aW9uKCkgewogICAgZXhlYyh0aGlzLnN1Y2Nlc3NDYWxsYmFjaywgdGhpcy5lcnJvckNhbGxiYWNrLCAiTWVkaWEiLCAic3RvcFJlY29yZGluZ0F1ZGlvIiwgW3RoaXMuaWRdKTsKfTsKCi8qKgogKiBSZWxlYXNlIHRoZSByZXNvdXJjZXMuCiAqLwpNZWRpYS5wcm90b3R5cGUucmVsZWFzZSA9IGZ1bmN0aW9uKCkgewogICAgZXhlYyhudWxsLCB0aGlzLmVycm9yQ2FsbGJhY2ssICJNZWRpYSIsICJyZWxlYXNlIiwgW3RoaXMuaWRdKTsKfTsKCi8qKgogKiBBZGp1c3QgdGhlIHZvbHVtZS4KICovCk1lZGlhLnByb3RvdHlwZS5zZXRWb2x1bWUgPSBmdW5jdGlvbih2b2x1bWUpIHsKICAgIGV4ZWMobnVsbCwgbnVsbCwgIk1lZGlhIiwgInNldFZvbHVtZSIsIFt0aGlzLmlkLCB2b2x1bWVdKTsKfTsKCi8qKgogKiBBdWRpbyBoYXMgc3RhdHVzIHVwZGF0ZS4KICogUFJJVkFURQogKgogKiBAcGFyYW0gaWQgICAgICAgICAgICBUaGUgbWVkaWEgb2JqZWN0IGlkIChzdHJpbmcpCiAqIEBwYXJhbSBzdGF0dXMgICAgICAgIFRoZSBzdGF0dXMgY29kZSAoaW50KQogKiBAcGFyYW0gbXNnICAgICAgICAgICBUaGUgc3RhdHVzIG1lc3NhZ2UgKHN0cmluZykKICovCk1lZGlhLm9uU3RhdHVzID0gZnVuY3Rpb24oaWQsIG1zZywgdmFsdWUpIHsKICAgIHZhciBtZWRpYSA9IG1lZGlhT2JqZWN0c1tpZF07CiAgICAvLyBJZiBzdGF0ZSB1cGRhdGUKICAgIGlmIChtc2cgPT09IE1lZGlhLk1FRElBX1NUQVRFKSB7CiAgICAgICAgaWYgKHZhbHVlID09PSBNZWRpYS5NRURJQV9TVE9QUEVEKSB7CiAgICAgICAgICAgIGlmIChtZWRpYS5zdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIG1lZGlhLnN1Y2Nlc3NDYWxsYmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChtZWRpYS5zdGF0dXNDYWxsYmFjaykgewogICAgICAgICAgICBtZWRpYS5zdGF0dXNDYWxsYmFjayh2YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAobXNnID09PSBNZWRpYS5NRURJQV9EVVJBVElPTikgewogICAgICAgIG1lZGlhLl9kdXJhdGlvbiA9IHZhbHVlOwogICAgfQogICAgZWxzZSBpZiAobXNnID09PSBNZWRpYS5NRURJQV9FUlJPUikgewogICAgICAgIGlmIChtZWRpYS5lcnJvckNhbGxiYWNrKSB7CiAgICAgICAgICAgIC8vIHZhbHVlIHNob3VsZCBiZSBhIE1lZGlhRXJyb3Igb2JqZWN0IHdoZW4gbXNnID09IE1FRElBX0VSUk9SCiAgICAgICAgICAgIG1lZGlhLmVycm9yQ2FsbGJhY2sodmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYgKG1zZyA9PT0gTWVkaWEuTUVESUFfUE9TSVRJT04pIHsKICAgICAgICBtZWRpYS5fcG9zaXRpb24gPSB2YWx1ZTsKICAgIH0KfTsKCm1vZHVsZS5leHBvcnRzID0gTWVkaWE7Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vTWVkaWFFcnJvci5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL01lZGlhRXJyb3IiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIFRoaXMgY2xhc3MgY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgYW55IE1lZGlhIGVycm9ycy4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgTWVkaWFFcnJvciA9IGZ1bmN0aW9uKGNvZGUsIG1zZykgewogICAgdGhpcy5jb2RlID0gKGNvZGUgIT09IHVuZGVmaW5lZCA/IGNvZGUgOiBudWxsKTsKICAgIHRoaXMubWVzc2FnZSA9IG1zZyB8fCAiIjsKfTsKCk1lZGlhRXJyb3IuTUVESUFfRVJSX05PTkVfQUNUSVZFICAgID0gMDsKTWVkaWFFcnJvci5NRURJQV9FUlJfQUJPUlRFRCAgICAgICAgPSAxOwpNZWRpYUVycm9yLk1FRElBX0VSUl9ORVRXT1JLICAgICAgICA9IDI7Ck1lZGlhRXJyb3IuTUVESUFfRVJSX0RFQ09ERSAgICAgICAgID0gMzsKTWVkaWFFcnJvci5NRURJQV9FUlJfTk9ORV9TVVBQT1JURUQgPSA0OwoKbW9kdWxlLmV4cG9ydHMgPSBNZWRpYUVycm9yOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL01lZGlhRmlsZS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL01lZGlhRmlsZSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgdXRpbHMgPSByZXF1aXJlKCdjb3Jkb3ZhL3V0aWxzJyksCiAgICBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyksCiAgICBGaWxlID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZScpLAogICAgQ2FwdHVyZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vQ2FwdHVyZUVycm9yJyk7Ci8qKgogKiBSZXByZXNlbnRzIGEgc2luZ2xlIGZpbGUuCiAqCiAqIG5hbWUge0RPTVN0cmluZ30gbmFtZSBvZiB0aGUgZmlsZSwgd2l0aG91dCBwYXRoIGluZm9ybWF0aW9uCiAqIGZ1bGxQYXRoIHtET01TdHJpbmd9IHRoZSBmdWxsIHBhdGggb2YgdGhlIGZpbGUsIGluY2x1ZGluZyB0aGUgbmFtZQogKiB0eXBlIHtET01TdHJpbmd9IG1pbWUgdHlwZQogKiBsYXN0TW9kaWZpZWREYXRlIHtEYXRlfSBsYXN0IG1vZGlmaWVkIGRhdGUKICogc2l6ZSB7TnVtYmVyfSBzaXplIG9mIHRoZSBmaWxlIGluIGJ5dGVzCiAqLwp2YXIgTWVkaWFGaWxlID0gZnVuY3Rpb24obmFtZSwgZnVsbFBhdGgsIHR5cGUsIGxhc3RNb2RpZmllZERhdGUsIHNpemUpewogICAgTWVkaWFGaWxlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9OwoKdXRpbHMuZXh0ZW5kKE1lZGlhRmlsZSwgRmlsZSk7CgovKioKICogUmVxdWVzdCBjYXB0dXJlIGZvcm1hdCBkYXRhIGZvciBhIHNwZWNpZmljIGZpbGUgYW5kIHR5cGUKICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NCCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ0IKICovCk1lZGlhRmlsZS5wcm90b3R5cGUuZ2V0Rm9ybWF0RGF0YSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgaWYgKHR5cGVvZiB0aGlzLmZ1bGxQYXRoID09PSAidW5kZWZpbmVkIiB8fCB0aGlzLmZ1bGxQYXRoID09PSBudWxsKSB7CiAgICAgICAgZXJyb3JDYWxsYmFjayhuZXcgQ2FwdHVyZUVycm9yKENhcHR1cmVFcnJvci5DQVBUVVJFX0lOVkFMSURfQVJHVU1FTlQpKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJDYXB0dXJlIiwgImdldEZvcm1hdERhdGEiLCBbdGhpcy5mdWxsUGF0aCwgdGhpcy50eXBlXSk7CiAgICB9Cn07CgovLyBUT0RPOiBjYW4gd2UgYXhlIHRoaXM/Ci8qKgogKiBDYXN0cyBhIFBsdWdpblJlc3VsdCBtZXNzYWdlIHByb3BlcnR5ICAoYXJyYXkgb2Ygb2JqZWN0cykgdG8gYW4gYXJyYXkgb2YgTWVkaWFGaWxlIG9iamVjdHMKICogKHVzZWQgaW4gT2JqZWN0aXZlLUMgYW5kIEFuZHJvaWQpCiAqCiAqIEBwYXJhbSB7UGx1Z2luUmVzdWx0fSBwbHVnaW5SZXN1bHQKICovCk1lZGlhRmlsZS5jYXN0ID0gZnVuY3Rpb24ocGx1Z2luUmVzdWx0KSB7CiAgICB2YXIgbWVkaWFGaWxlcyA9IFtdOwogICAgZm9yICh2YXIgaT0wOyBpPHBsdWdpblJlc3VsdC5tZXNzYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG1lZGlhRmlsZSA9IG5ldyBNZWRpYUZpbGUoKTsKICAgICAgICBtZWRpYUZpbGUubmFtZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlW2ldLm5hbWU7CiAgICAgICAgbWVkaWFGaWxlLmZ1bGxQYXRoID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2VbaV0uZnVsbFBhdGg7CiAgICAgICAgbWVkaWFGaWxlLnR5cGUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZVtpXS50eXBlOwogICAgICAgIG1lZGlhRmlsZS5sYXN0TW9kaWZpZWREYXRlID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2VbaV0ubGFzdE1vZGlmaWVkRGF0ZTsKICAgICAgICBtZWRpYUZpbGUuc2l6ZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlW2ldLnNpemU7CiAgICAgICAgbWVkaWFGaWxlcy5wdXNoKG1lZGlhRmlsZSk7CiAgICB9CiAgICBwbHVnaW5SZXN1bHQubWVzc2FnZSA9IG1lZGlhRmlsZXM7CiAgICByZXR1cm4gcGx1Z2luUmVzdWx0Owp9OwoKbW9kdWxlLmV4cG9ydHMgPSBNZWRpYUZpbGU7Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL01lZGlhRmlsZURhdGEuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9NZWRpYUZpbGVEYXRhIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBNZWRpYUZpbGVEYXRhIGVuY2Fwc3VsYXRlcyBmb3JtYXQgaW5mb3JtYXRpb24gb2YgYSBtZWRpYSBmaWxlLgogKgogKiBAcGFyYW0ge0RPTVN0cmluZ30gY29kZWNzCiAqIEBwYXJhbSB7bG9uZ30gYml0cmF0ZQogKiBAcGFyYW0ge2xvbmd9IGhlaWdodAogKiBAcGFyYW0ge2xvbmd9IHdpZHRoCiAqIEBwYXJhbSB7ZmxvYXR9IGR1cmF0aW9uCiAqLwp2YXIgTWVkaWFGaWxlRGF0YSA9IGZ1bmN0aW9uKGNvZGVjcywgYml0cmF0ZSwgaGVpZ2h0LCB3aWR0aCwgZHVyYXRpb24pewogICAgdGhpcy5jb2RlY3MgPSBjb2RlY3MgfHwgbnVsbDsKICAgIHRoaXMuYml0cmF0ZSA9IGJpdHJhdGUgfHwgMDsKICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0IHx8IDA7CiAgICB0aGlzLndpZHRoID0gd2lkdGggfHwgMDsKICAgIHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbiB8fCAwOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBNZWRpYUZpbGVEYXRhOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL01ldGFkYXRhLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vTWV0YWRhdGEiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLyoqCiAqIEluZm9ybWF0aW9uIGFib3V0IHRoZSBzdGF0ZSBvZiB0aGUgZmlsZSBvciBkaXJlY3RvcnkKICoKICoge0RhdGV9IG1vZGlmaWNhdGlvblRpbWUgKHJlYWRvbmx5KQogKi8KdmFyIE1ldGFkYXRhID0gZnVuY3Rpb24odGltZSkgewogICAgdGhpcy5tb2RpZmljYXRpb25UaW1lID0gKHR5cGVvZiB0aW1lICE9ICd1bmRlZmluZWQnP25ldyBEYXRlKHRpbWUpOm51bGwpOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBNZXRhZGF0YTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Qb3NpdGlvbi5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL1Bvc2l0aW9uIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBDb29yZGluYXRlcyA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0Nvb3JkaW5hdGVzJyk7Cgp2YXIgUG9zaXRpb24gPSBmdW5jdGlvbihjb29yZHMsIHRpbWVzdGFtcCkgewogICAgaWYgKGNvb3JkcykgewogICAgICAgIHRoaXMuY29vcmRzID0gbmV3IENvb3JkaW5hdGVzKGNvb3Jkcy5sYXRpdHVkZSwgY29vcmRzLmxvbmdpdHVkZSwgY29vcmRzLmFsdGl0dWRlLCBjb29yZHMuYWNjdXJhY3ksIGNvb3Jkcy5oZWFkaW5nLCBjb29yZHMudmVsb2NpdHksIGNvb3Jkcy5hbHRpdHVkZUFjY3VyYWN5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb29yZHMgPSBuZXcgQ29vcmRpbmF0ZXMoKTsKICAgIH0KICAgIHRoaXMudGltZXN0YW1wID0gKHRpbWVzdGFtcCAhPT0gdW5kZWZpbmVkKSA/IHRpbWVzdGFtcCA6IG5ldyBEYXRlKCk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IFBvc2l0aW9uOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9Qb3NpdGlvbkVycm9yLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vUG9zaXRpb25FcnJvciIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogUG9zaXRpb24gZXJyb3Igb2JqZWN0CiAqCiAqIEBjb25zdHJ1Y3RvcgogKiBAcGFyYW0gY29kZQogKiBAcGFyYW0gbWVzc2FnZQogKi8KdmFyIFBvc2l0aW9uRXJyb3IgPSBmdW5jdGlvbihjb2RlLCBtZXNzYWdlKSB7CiAgICB0aGlzLmNvZGUgPSBjb2RlIHx8IG51bGw7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8ICcnOwp9OwoKUG9zaXRpb25FcnJvci5QRVJNSVNTSU9OX0RFTklFRCA9IDE7ClBvc2l0aW9uRXJyb3IuUE9TSVRJT05fVU5BVkFJTEFCTEUgPSAyOwpQb3NpdGlvbkVycm9yLlRJTUVPVVQgPSAzOwoKbW9kdWxlLmV4cG9ydHMgPSBQb3NpdGlvbkVycm9yOwp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL1Byb2dyZXNzRXZlbnQuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9Qcm9ncmVzc0V2ZW50IiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8vIElmIFByb2dyZXNzRXZlbnQgZXhpc3RzIGluIGdsb2JhbCBjb250ZXh0LCB1c2UgaXQgYWxyZWFkeSwgb3RoZXJ3aXNlIHVzZSBvdXIgb3duIHBvbHlmaWxsCi8vIEZlYXR1cmUgdGVzdDogU2VlIGlmIHdlIGNhbiBpbnN0YW50aWF0ZSBhIG5hdGl2ZSBQcm9ncmVzc0V2ZW50OwovLyBpZiBzbywgdXNlIHRoYXQgYXBwcm9hY2gsCi8vIG90aGVyd2lzZSBmaWxsLWluIHdpdGggb3VyIG93biBpbXBsZW1lbnRhdGlvbi4KLy8KLy8gTk9URTogcmlnaHQgbm93IHdlIGFsd2F5cyBmaWxsIGluIHdpdGggb3VyIG93bi4gRG93biB0aGUgcm9hZCB3b3VsZCBiZSBuaWNlIGlmIHdlIGNhbiB1c2Ugd2hhdGV2ZXIgaXMgbmF0aXZlIGluIHRoZSB3ZWJ2aWV3Lgp2YXIgUHJvZ3Jlc3NFdmVudCA9IChmdW5jdGlvbigpIHsKICAgIC8qCiAgICB2YXIgY3JlYXRlRXZlbnQgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50cycpOwogICAgICAgIGV2ZW50LmluaXRFdmVudCgnUHJvZ3Jlc3NFdmVudCcsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50W2ldID0gZGF0YVtpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGF0YS50YXJnZXQpIHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IGNhbm5vdCBjYWxsIDxzb21lX2N1c3RvbV9vYmplY3Q+LmRpc3BhdGNoRXZlbnQKICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gZmlyc3QgZmlndXJlIG91dCBob3cgdG8gaW1wbGVtZW50IEV2ZW50VGFyZ2V0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV2ZW50OwogICAgfTsKICAgIHRyeSB7CiAgICAgICAgdmFyIGV2ID0gY3JlYXRlRXZlbnQoe3R5cGU6ImFib3J0Iix0YXJnZXQ6ZG9jdW1lbnR9KTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gUHJvZ3Jlc3NFdmVudCh0eXBlLCBkYXRhKSB7CiAgICAgICAgICAgIGRhdGEudHlwZSA9IHR5cGU7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVFdmVudChkYXRhKTsKICAgICAgICB9OwogICAgfSBjYXRjaChlKXsKICAgICovCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIFByb2dyZXNzRXZlbnQodHlwZSwgZGljdCkgewogICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICAgICAgICB0aGlzLmJ1YmJsZXMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jYW5jZWxCdWJibGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5jYW5jZWxhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubGVuZ3RoQ29tcHV0YWJsZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmxvYWRlZCA9IGRpY3QgJiYgZGljdC5sb2FkZWQgPyBkaWN0LmxvYWRlZCA6IDA7CiAgICAgICAgICAgIHRoaXMudG90YWwgPSBkaWN0ICYmIGRpY3QudG90YWwgPyBkaWN0LnRvdGFsIDogMDsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBkaWN0ICYmIGRpY3QudGFyZ2V0ID8gZGljdC50YXJnZXQgOiBudWxsOwogICAgICAgIH07CiAgICAvL30KfSkoKTsKCm1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NFdmVudDsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9hY2NlbGVyb21ldGVyLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vYWNjZWxlcm9tZXRlciIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewovKioKICogVGhpcyBjbGFzcyBwcm92aWRlcyBhY2Nlc3MgdG8gZGV2aWNlIGFjY2VsZXJvbWV0ZXIgZGF0YS4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgdXRpbHMgPSByZXF1aXJlKCJjb3Jkb3ZhL3V0aWxzIiksCiAgICBleGVjID0gcmVxdWlyZSgiY29yZG92YS9leGVjIiksCiAgICBBY2NlbGVyYXRpb24gPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9BY2NlbGVyYXRpb24nKTsKCi8vIElzIHRoZSBhY2NlbCBzZW5zb3IgcnVubmluZz8KdmFyIHJ1bm5pbmcgPSBmYWxzZTsKCi8vIEtlZXBzIHJlZmVyZW5jZSB0byB3YXRjaEFjY2VsZXJhdGlvbiBjYWxscy4KdmFyIHRpbWVycyA9IHt9OwoKLy8gQXJyYXkgb2YgbGlzdGVuZXJzOyB1c2VkIHRvIGtlZXAgdHJhY2sgb2Ygd2hlbiB3ZSBzaG91bGQgY2FsbCBzdGFydCBhbmQgc3RvcC4KdmFyIGxpc3RlbmVycyA9IFtdOwoKLy8gTGFzdCByZXR1cm5lZCBhY2NlbGVyYXRpb24gb2JqZWN0IGZyb20gbmF0aXZlCnZhciBhY2NlbCA9IG51bGw7CgovLyBUZWxscyBuYXRpdmUgdG8gc3RhcnQuCmZ1bmN0aW9uIHN0YXJ0KCkgewogICAgZXhlYyhmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIHRlbXBMaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuc2xpY2UoMCk7CiAgICAgICAgYWNjZWwgPSBuZXcgQWNjZWxlcmF0aW9uKGEueCwgYS55LCBhLnosIGEudGltZXN0YW1wKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRlbXBMaXN0ZW5lcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRlbXBMaXN0ZW5lcnNbaV0ud2luKGFjY2VsKTsKICAgICAgICB9CiAgICB9LCBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIHRlbXBMaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuc2xpY2UoMCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0ZW1wTGlzdGVuZXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0ZW1wTGlzdGVuZXJzW2ldLmZhaWwoZSk7CiAgICAgICAgfQogICAgfSwgIkFjY2VsZXJvbWV0ZXIiLCAic3RhcnQiLCBbXSk7CiAgICBydW5uaW5nID0gdHJ1ZTsKfQoKLy8gVGVsbHMgbmF0aXZlIHRvIHN0b3AuCmZ1bmN0aW9uIHN0b3AoKSB7CiAgICBleGVjKG51bGwsIG51bGwsICJBY2NlbGVyb21ldGVyIiwgInN0b3AiLCBbXSk7CiAgICBydW5uaW5nID0gZmFsc2U7Cn0KCi8vIEFkZHMgYSBjYWxsYmFjayBwYWlyIHRvIHRoZSBsaXN0ZW5lcnMgYXJyYXkKZnVuY3Rpb24gY3JlYXRlQ2FsbGJhY2tQYWlyKHdpbiwgZmFpbCkgewogICAgcmV0dXJuIHt3aW46d2luLCBmYWlsOmZhaWx9Owp9CgovLyBSZW1vdmVzIGEgd2luL2ZhaWwgbGlzdGVuZXIgcGFpciBmcm9tIHRoZSBsaXN0ZW5lcnMgYXJyYXkKZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXJzKGwpIHsKICAgIHZhciBpZHggPSBsaXN0ZW5lcnMuaW5kZXhPZihsKTsKICAgIGlmIChpZHggPiAtMSkgewogICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaWR4LCAxKTsKICAgICAgICBpZiAobGlzdGVuZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBzdG9wKCk7CiAgICAgICAgfQogICAgfQp9Cgp2YXIgYWNjZWxlcm9tZXRlciA9IHsKICAgIC8qKgogICAgICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgY3VycmVudCBhY2NlbGVyYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGFjY2VsZXJhdGlvbiBkYXRhIGlzIGF2YWlsYWJsZQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayAgICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZ2V0dGluZyB0aGUgYWNjZWxlcmF0aW9uIGRhdGEuIChPUFRJT05BTCkKICAgICAqIEBwYXJhbSB7QWNjZWxlcmF0aW9uT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgYWNjZWxlcm9tZXRlciBkYXRhIHN1Y2ggYXMgdGltZW91dC4gKE9QVElPTkFMKQogICAgICovCiAgICBnZXRDdXJyZW50QWNjZWxlcmF0aW9uOiBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICAvLyBzdWNjZXNzQ2FsbGJhY2sgcmVxdWlyZWQKICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aHJvdyAiZ2V0Q3VycmVudEFjY2VsZXJhdGlvbiBtdXN0IGJlIGNhbGxlZCB3aXRoIGF0IGxlYXN0IGEgc3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiBhcyBmaXJzdCBwYXJhbWV0ZXIuIjsKICAgICAgICB9CgogICAgICAgIHZhciBwOwogICAgICAgIHZhciB3aW4gPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVycyhwKTsKICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGEpOwogICAgICAgIH07CiAgICAgICAgdmFyIGZhaWwgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVycyhwKTsKICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlKTsKICAgICAgICB9OwoKICAgICAgICBwID0gY3JlYXRlQ2FsbGJhY2tQYWlyKHdpbiwgZmFpbCk7CiAgICAgICAgbGlzdGVuZXJzLnB1c2gocCk7CgogICAgICAgIGlmICghcnVubmluZykgewogICAgICAgICAgICBzdGFydCgpOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBhY2NlbGVyYXRpb24gcmVwZWF0ZWRseSBhdCBhIGdpdmVuIGludGVydmFsLgogICAgICoKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayAgICBUaGUgZnVuY3Rpb24gdG8gY2FsbCBlYWNoIHRpbWUgdGhlIGFjY2VsZXJhdGlvbiBkYXRhIGlzIGF2YWlsYWJsZQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayAgICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZ2V0dGluZyB0aGUgYWNjZWxlcmF0aW9uIGRhdGEuIChPUFRJT05BTCkKICAgICAqIEBwYXJhbSB7QWNjZWxlcmF0aW9uT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgYWNjZWxlcm9tZXRlciBkYXRhIHN1Y2ggYXMgdGltZW91dC4gKE9QVElPTkFMKQogICAgICogQHJldHVybiBTdHJpbmcgICAgICAgICAgICAgICAgICAgICAgIFRoZSB3YXRjaCBpZCB0aGF0IG11c3QgYmUgcGFzc2VkIHRvICNjbGVhcldhdGNoIHRvIHN0b3Agd2F0Y2hpbmcuCiAgICAgKi8KICAgIHdhdGNoQWNjZWxlcmF0aW9uOiBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICAvLyBEZWZhdWx0IGludGVydmFsICgxMCBzZWMpCiAgICAgICAgdmFyIGZyZXF1ZW5jeSA9IChvcHRpb25zICYmIG9wdGlvbnMuZnJlcXVlbmN5ICYmIHR5cGVvZiBvcHRpb25zLmZyZXF1ZW5jeSA9PSAnbnVtYmVyJykgPyBvcHRpb25zLmZyZXF1ZW5jeSA6IDEwMDAwOwoKICAgICAgICAvLyBzdWNjZXNzQ2FsbGJhY2sgcmVxdWlyZWQKICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aHJvdyAid2F0Y2hBY2NlbGVyYXRpb24gbXVzdCBiZSBjYWxsZWQgd2l0aCBhdCBsZWFzdCBhIHN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24gYXMgZmlyc3QgcGFyYW1ldGVyLiI7CiAgICAgICAgfQoKICAgICAgICAvLyBLZWVwIHJlZmVyZW5jZSB0byB3YXRjaCBpZCwgYW5kIHJlcG9ydCBhY2NlbCByZWFkaW5ncyBhcyBvZnRlbiBhcyBkZWZpbmVkIGluIGZyZXF1ZW5jeQogICAgICAgIHZhciBpZCA9IHV0aWxzLmNyZWF0ZVVVSUQoKTsKCiAgICAgICAgdmFyIHAgPSBjcmVhdGVDYWxsYmFja1BhaXIoZnVuY3Rpb24oKXt9LCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVycyhwKTsKICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhlKTsKICAgICAgICB9KTsKICAgICAgICBsaXN0ZW5lcnMucHVzaChwKTsKCiAgICAgICAgdGltZXJzW2lkXSA9IHsKICAgICAgICAgICAgdGltZXI6d2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGFjY2VsKSB7CiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGFjY2VsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgZnJlcXVlbmN5KSwKICAgICAgICAgICAgbGlzdGVuZXJzOnAKICAgICAgICB9OwoKICAgICAgICBpZiAocnVubmluZykgewogICAgICAgICAgICAvLyBJZiB3ZSdyZSBhbHJlYWR5IHJ1bm5pbmcgdGhlbiBpbW1lZGlhdGVseSBpbnZva2UgdGhlIHN1Y2Nlc3MgY2FsbGJhY2sKICAgICAgICAgICAgLy8gYnV0IG9ubHkgaWYgd2UgaGF2ZSByZXRyZWl2ZWQgYSB2YWx1ZSwgc2FtcGxlIGNvZGUgZG9lcyBub3QgY2hlY2sgZm9yIG51bGwgLi4uCiAgICAgICAgICAgIGlmKGFjY2VsKSB7CiAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soYWNjZWwpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpZDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDbGVhcnMgdGhlIHNwZWNpZmllZCBhY2NlbGVyb21ldGVyIHdhdGNoLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZCAgICAgICBUaGUgaWQgb2YgdGhlIHdhdGNoIHJldHVybmVkIGZyb20gI3dhdGNoQWNjZWxlcmF0aW9uLgogICAgICovCiAgICBjbGVhcldhdGNoOiBmdW5jdGlvbihpZCkgewogICAgICAgIC8vIFN0b3AgamF2YXNjcmlwdCB0aW1lciAmIHJlbW92ZSBmcm9tIHRpbWVyIGxpc3QKICAgICAgICBpZiAoaWQgJiYgdGltZXJzW2lkXSkgewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aW1lcnNbaWRdLnRpbWVyKTsKICAgICAgICAgICAgcmVtb3ZlTGlzdGVuZXJzKHRpbWVyc1tpZF0ubGlzdGVuZXJzKTsKICAgICAgICAgICAgZGVsZXRlIHRpbWVyc1tpZF07CiAgICAgICAgfQogICAgfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSBhY2NlbGVyb21ldGVyOwoKfSk7CgovLyBmaWxlOiBsaWIvYW5kcm9pZC9wbHVnaW4vYW5kcm9pZC9hcHAuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9hbmRyb2lkL2FwcCIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpOwoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgLyoqCiAgICogQ2xlYXIgdGhlIHJlc291cmNlIGNhY2hlLgogICAqLwogIGNsZWFyQ2FjaGU6ZnVuY3Rpb24oKSB7CiAgICBleGVjKG51bGwsIG51bGwsICJBcHAiLCAiY2xlYXJDYWNoZSIsIFtdKTsKICB9LAoKICAvKioKICAgKiBMb2FkIHRoZSB1cmwgaW50byB0aGUgd2VidmlldyBvciBpbnRvIG5ldyBicm93c2VyIGluc3RhbmNlLgogICAqCiAgICogQHBhcmFtIHVybCAgICAgICAgICAgVGhlIFVSTCB0byBsb2FkCiAgICogQHBhcmFtIHByb3BzICAgICAgICAgUHJvcGVydGllcyB0aGF0IGNhbiBiZSBwYXNzZWQgaW4gdG8gdGhlIGFjdGl2aXR5OgogICAqICAgICAgd2FpdDogaW50ICAgICAgICAgICAgICAgICAgICAgICAgICAgPT4gd2FpdCBtc2VjIGJlZm9yZSBsb2FkaW5nIFVSTAogICAqICAgICAgbG9hZGluZ0RpYWxvZzogIlRpdGxlLE1lc3NhZ2UiICAgICAgPT4gZGlzcGxheSBhIG5hdGl2ZSBsb2FkaW5nIGRpYWxvZwogICAqICAgICAgbG9hZFVybFRpbWVvdXRWYWx1ZTogaW50ICAgICAgICAgICAgPT4gdGltZSBpbiBtc2VjIHRvIHdhaXQgYmVmb3JlIHRyaWdnZXJpbmcgYSB0aW1lb3V0IGVycm9yCiAgICogICAgICBjbGVhckhpc3Rvcnk6IGJvb2xlYW4gICAgICAgICAgICAgID0+IGNsZWFyIHdlYnZpZXcgaGlzdG9yeSAoZGVmYXVsdD1mYWxzZSkKICAgKiAgICAgIG9wZW5FeHRlcm5hbDogYm9vbGVhbiAgICAgICAgICAgICAgPT4gb3BlbiBpbiBhIG5ldyBicm93c2VyIChkZWZhdWx0PWZhbHNlKQogICAqCiAgICogRXhhbXBsZToKICAgKiAgICAgIG5hdmlnYXRvci5hcHAubG9hZFVybCgiaHR0cDovL3NlcnZlci9teWFwcC9pbmRleC5odG1sIiwge3dhaXQ6MjAwMCwgbG9hZGluZ0RpYWxvZzoiV2FpdCxMb2FkaW5nIEFwcCIsIGxvYWRVcmxUaW1lb3V0VmFsdWU6IDYwMDAwfSk7CiAgICovCiAgbG9hZFVybDpmdW5jdGlvbih1cmwsIHByb3BzKSB7CiAgICBleGVjKG51bGwsIG51bGwsICJBcHAiLCAibG9hZFVybCIsIFt1cmwsIHByb3BzXSk7CiAgfSwKCiAgLyoqCiAgICogQ2FuY2VsIGxvYWRVcmwgdGhhdCBpcyB3YWl0aW5nIHRvIGJlIGxvYWRlZC4KICAgKi8KICBjYW5jZWxMb2FkVXJsOmZ1bmN0aW9uKCkgewogICAgZXhlYyhudWxsLCBudWxsLCAiQXBwIiwgImNhbmNlbExvYWRVcmwiLCBbXSk7CiAgfSwKCiAgLyoqCiAgICogQ2xlYXIgd2ViIGhpc3RvcnkgaW4gdGhpcyB3ZWIgdmlldy4KICAgKiBJbnN0ZWFkIG9mIEJBQ0sgYnV0dG9uIGxvYWRpbmcgdGhlIHByZXZpb3VzIHdlYiBwYWdlLCBpdCB3aWxsIGV4aXQgdGhlIGFwcC4KICAgKi8KICBjbGVhckhpc3Rvcnk6ZnVuY3Rpb24oKSB7CiAgICBleGVjKG51bGwsIG51bGwsICJBcHAiLCAiY2xlYXJIaXN0b3J5IiwgW10pOwogIH0sCgogIC8qKgogICAqIEdvIHRvIHByZXZpb3VzIHBhZ2UgZGlzcGxheWVkLgogICAqIFRoaXMgaXMgdGhlIHNhbWUgYXMgcHJlc3NpbmcgdGhlIGJhY2tidXR0b24gb24gQW5kcm9pZCBkZXZpY2UuCiAgICovCiAgYmFja0hpc3Rvcnk6ZnVuY3Rpb24oKSB7CiAgICBleGVjKG51bGwsIG51bGwsICJBcHAiLCAiYmFja0hpc3RvcnkiLCBbXSk7CiAgfSwKCiAgLyoqCiAgICogT3ZlcnJpZGUgdGhlIGRlZmF1bHQgYmVoYXZpb3Igb2YgdGhlIEFuZHJvaWQgYmFjayBidXR0b24uCiAgICogSWYgb3ZlcnJpZGRlbiwgd2hlbiB0aGUgYmFjayBidXR0b24gaXMgcHJlc3NlZCwgdGhlICJiYWNrS2V5RG93biIgSmF2YVNjcmlwdCBldmVudCB3aWxsIGJlIGZpcmVkLgogICAqCiAgICogTm90ZTogVGhlIHVzZXIgc2hvdWxkIG5vdCBoYXZlIHRvIGNhbGwgdGhpcyBtZXRob2QuICBJbnN0ZWFkLCB3aGVuIHRoZSB1c2VyCiAgICogICAgICAgcmVnaXN0ZXJzIGZvciB0aGUgImJhY2tidXR0b24iIGV2ZW50LCB0aGlzIGlzIGF1dG9tYXRpY2FsbHkgZG9uZS4KICAgKgogICAqIEBwYXJhbSBvdmVycmlkZSAgICAgICAgVD1vdmVycmlkZSwgRj1jYW5jZWwgb3ZlcnJpZGUKICAgKi8KICBvdmVycmlkZUJhY2tidXR0b246ZnVuY3Rpb24ob3ZlcnJpZGUpIHsKICAgIGV4ZWMobnVsbCwgbnVsbCwgIkFwcCIsICJvdmVycmlkZUJhY2tidXR0b24iLCBbb3ZlcnJpZGVdKTsKICB9LAoKICAvKioKICAgKiBFeGl0IGFuZCB0ZXJtaW5hdGUgdGhlIGFwcGxpY2F0aW9uLgogICAqLwogIGV4aXRBcHA6ZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZXhlYyhudWxsLCBudWxsLCAiQXBwIiwgImV4aXRBcHAiLCBbXSk7CiAgfQp9Owp9KTsKCi8vIGZpbGU6IGxpYi9hbmRyb2lkL3BsdWdpbi9hbmRyb2lkL2NhbGxiYWNrLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vYW5kcm9pZC9jYWxsYmFjayIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgcG9ydCA9IG51bGwsCiAgICB0b2tlbiA9IG51bGwsCiAgICBjb3Jkb3ZhID0gcmVxdWlyZSgnY29yZG92YScpLAogICAgcG9sbGluZyA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL2FuZHJvaWQvcG9sbGluZycpLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbigpIHsKICAgICAgLy8gRXhpdCBpZiBzaHV0dGluZyBkb3duIGFwcAogICAgICBpZiAoY29yZG92YS5zaHV0dGluZ0Rvd24pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gSWYgcG9sbGluZyBmbGFnIHdhcyBjaGFuZ2VkLCBzdGFydCB1c2luZyBwb2xsaW5nIGZyb20gbm93IG9uCiAgICAgIGlmIChjb3Jkb3ZhLlVzZVBvbGxpbmcpIHsKICAgICAgICAgIHBvbGxpbmcoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgIC8vIENhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gWE1MSHR0cFJlcXVlc3QgaXMgcmVhZHkKICAgICAgeG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXsKICAgICAgICAgIGlmKHhtbGh0dHAucmVhZHlTdGF0ZSA9PT0gNCl7CgogICAgICAgICAgICAgIC8vIEV4aXQgaWYgc2h1dHRpbmcgZG93biBhcHAKICAgICAgICAgICAgICBpZiAoY29yZG92YS5zaHV0dGluZ0Rvd24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gSWYgY2FsbGJhY2sgaGFzIEphdmFTY3JpcHQgc3RhdGVtZW50IHRvIGV4ZWN1dGUKICAgICAgICAgICAgICBpZiAoeG1saHR0cC5zdGF0dXMgPT09IDIwMCkgewoKICAgICAgICAgICAgICAgICAgLy8gTmVlZCB0byB1cmwgZGVjb2RlIHRoZSByZXNwb25zZQogICAgICAgICAgICAgICAgICB2YXIgbXNnID0gZGVjb2RlVVJJQ29tcG9uZW50KHhtbGh0dHAucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBldmFsKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlJ3JlIGdldHRpbmcgYW4gZXJyb3IgaGVyZSwgc2VlaW5nIHRoZSBtZXNzYWdlIHdpbGwgaGVscCBpbiBkZWJ1Z2dpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiSlNDYWxsYmFjazogTWVzc2FnZSBmcm9tIFNlcnZlcjogIiArIG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2sgRXJyb3I6ICIrZSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sIDEpOwogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNhbGxiYWNrLCAxKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIElmIGNhbGxiYWNrIHBpbmcgKHVzZWQgdG8ga2VlcCBYSFIgcmVxdWVzdCBmcm9tIHRpbWluZyBvdXQpCiAgICAgICAgICAgICAgZWxzZSBpZiAoeG1saHR0cC5zdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNhbGxiYWNrLCAxMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBJZiBzZWN1cml0eSBlcnJvcgogICAgICAgICAgICAgIGVsc2UgaWYgKHhtbGh0dHAuc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2sgRXJyb3I6IEludmFsaWQgdG9rZW4uICBTdG9wcGluZyBjYWxsYmFja3MuIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBJZiBzZXJ2ZXIgaXMgc3RvcHBpbmcKICAgICAgICAgICAgICBlbHNlIGlmICh4bWxodHRwLnN0YXR1cyA9PT0gNTAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrIFNlcnZlciBDbG9zZWQ6IFN0b3BwaW5nIGNhbGxiYWNrcy4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIElmIHJlcXVlc3Qgd2Fzbid0IEdFVAogICAgICAgICAgICAgIGVsc2UgaWYgKHhtbGh0dHAuc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2sgRXJyb3I6IEJhZCByZXF1ZXN0LiAgU3RvcHBpbmcgY2FsbGJhY2tzLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gSWYgZXJyb3IsIHJldmVydCB0byBwb2xsaW5nCiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrIEVycm9yOiBSZXF1ZXN0IGZhaWxlZC4iKTsKICAgICAgICAgICAgICAgICAgY29yZG92YS5Vc2VQb2xsaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgcG9sbGluZygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChwb3J0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3J0ID0gcHJvbXB0KCJnZXRQb3J0IiwgImdhcF9jYWxsYmFja1NlcnZlcjoiKTsKICAgICAgfQogICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgIHRva2VuID0gcHJvbXB0KCJnZXRUb2tlbiIsICJnYXBfY2FsbGJhY2tTZXJ2ZXI6Iik7CiAgICAgIH0KICAgICAgeG1saHR0cC5vcGVuKCJHRVQiLCAiaHR0cDovLzEyNy4wLjAuMToiK3BvcnQrIi8iK3Rva2VuICwgdHJ1ZSk7CiAgICAgIHhtbGh0dHAuc2VuZCgpOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBjYWxsYmFjazsKfSk7CgovLyBmaWxlOiBsaWIvYW5kcm9pZC9wbHVnaW4vYW5kcm9pZC9kZXZpY2UuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9hbmRyb2lkL2RldmljZSIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgY2hhbm5lbCA9IHJlcXVpcmUoJ2NvcmRvdmEvY2hhbm5lbCcpLAogICAgdXRpbHMgPSByZXF1aXJlKCdjb3Jkb3ZhL3V0aWxzJyksCiAgICBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyksCiAgICBhcHAgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9hbmRyb2lkL2FwcCcpOwoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAvKgogICAgICogREVQUkVDQVRFRAogICAgICogVGhpcyBpcyBvbmx5IGZvciBBbmRyb2lkLgogICAgICoKICAgICAqIFlvdSBtdXN0IGV4cGxpY2l0bHkgb3ZlcnJpZGUgdGhlIGJhY2sgYnV0dG9uLgogICAgICovCiAgICBvdmVycmlkZUJhY2tCdXR0b246ZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS5sb2coIkRldmljZS5vdmVycmlkZUJhY2tCdXR0b24oKSBpcyBkZXByZWNhdGVkLiAgVXNlIEFwcC5vdmVycmlkZUJhY2tidXR0b24odHJ1ZSkuIik7CiAgICAgICAgYXBwLm92ZXJyaWRlQmFja2J1dHRvbih0cnVlKTsKICAgIH0sCgogICAgLyoKICAgICAqIERFUFJFQ0FURUQKICAgICAqIFRoaXMgaXMgb25seSBmb3IgQW5kcm9pZC4KICAgICAqCiAgICAgKiBUaGlzIHJlc2V0cyB0aGUgYmFjayBidXR0b24gdG8gdGhlIGRlZmF1bHQgYmVoYXZpb3VyCiAgICAgKi8KICAgIHJlc2V0QmFja0J1dHRvbjpmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLmxvZygiRGV2aWNlLnJlc2V0QmFja0J1dHRvbigpIGlzIGRlcHJlY2F0ZWQuICBVc2UgQXBwLm92ZXJyaWRlQmFja2J1dHRvbihmYWxzZSkuIik7CiAgICAgICAgYXBwLm92ZXJyaWRlQmFja2J1dHRvbihmYWxzZSk7CiAgICB9LAoKICAgIC8qCiAgICAgKiBERVBSRUNBVEVECiAgICAgKiBUaGlzIGlzIG9ubHkgZm9yIEFuZHJvaWQuCiAgICAgKgogICAgICogVGhpcyB0ZXJtaW5hdGVzIHRoZSBhY3Rpdml0eSEKICAgICAqLwogICAgZXhpdEFwcDpmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLmxvZygiRGV2aWNlLmV4aXRBcHAoKSBpcyBkZXByZWNhdGVkLiAgVXNlIEFwcC5leGl0QXBwKCkuIik7CiAgICAgICAgYXBwLmV4aXRBcHAoKTsKICAgIH0KfTsKCn0pOwoKLy8gZmlsZTogbGliL2FuZHJvaWQvcGx1Z2luL2FuZHJvaWQvbm90aWZpY2F0aW9uLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vYW5kcm9pZC9ub3RpZmljYXRpb24iLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKCi8qKgogKiBQcm92aWRlcyBBbmRyb2lkIGVuaGFuY2VkIG5vdGlmaWNhdGlvbiBBUEkuCiAqLwptb2R1bGUuZXhwb3J0cyA9IHsKICAgIGFjdGl2aXR5U3RhcnQgOiBmdW5jdGlvbih0aXRsZSwgbWVzc2FnZSkgewogICAgICAgIC8vIElmIHRpdGxlIGFuZCBtZXNzYWdlIG5vdCBzcGVjaWZpZWQgdGhlbiBtaW1pYyBBbmRyb2lkIGJlaGF2aW9yIG9mCiAgICAgICAgLy8gdXNpbmcgZGVmYXVsdCBzdHJpbmdzLgogICAgICAgIGlmICh0eXBlb2YgdGl0bGUgPT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBtZXNzYWdlID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRpdGxlID0gIkJ1c3kiOwogICAgICAgICAgICBtZXNzYWdlID0gJ1BsZWFzZSB3YWl0Li4uJzsKICAgICAgICB9CgogICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgJ05vdGlmaWNhdGlvbicsICdhY3Rpdml0eVN0YXJ0JywgWyB0aXRsZSwgbWVzc2FnZSBdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDbG9zZSBhbiBhY3Rpdml0eSBkaWFsb2cKICAgICAqLwogICAgYWN0aXZpdHlTdG9wIDogZnVuY3Rpb24oKSB7CiAgICAgICAgZXhlYyhudWxsLCBudWxsLCAnTm90aWZpY2F0aW9uJywgJ2FjdGl2aXR5U3RvcCcsIFtdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgcHJvZ3Jlc3MgZGlhbG9nIHdpdGggcHJvZ3Jlc3MgYmFyIHRoYXQgZ29lcyBmcm9tIDAgdG8gMTAwLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfQogICAgICogICAgICAgICAgICB0aXRsZSBUaXRsZSBvZiB0aGUgcHJvZ3Jlc3MgZGlhbG9nLgogICAgICogQHBhcmFtIHtTdHJpbmd9CiAgICAgKiAgICAgICAgICAgIG1lc3NhZ2UgTWVzc2FnZSB0byBkaXNwbGF5IGluIHRoZSBkaWFsb2cuCiAgICAgKi8KICAgIHByb2dyZXNzU3RhcnQgOiBmdW5jdGlvbih0aXRsZSwgbWVzc2FnZSkgewogICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgJ05vdGlmaWNhdGlvbicsICdwcm9ncmVzc1N0YXJ0JywgWyB0aXRsZSwgbWVzc2FnZSBdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDbG9zZSB0aGUgcHJvZ3Jlc3MgZGlhbG9nLgogICAgICovCiAgICBwcm9ncmVzc1N0b3AgOiBmdW5jdGlvbigpIHsKICAgICAgICBleGVjKG51bGwsIG51bGwsICdOb3RpZmljYXRpb24nLCAncHJvZ3Jlc3NTdG9wJywgW10pOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldCB0aGUgcHJvZ3Jlc3MgZGlhbG9nIHZhbHVlLgogICAgICoKICAgICAqIEBwYXJhbSB7TnVtYmVyfQogICAgICogICAgICAgICAgICB2YWx1ZSAwLTEwMAogICAgICovCiAgICBwcm9ncmVzc1ZhbHVlIDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBleGVjKG51bGwsIG51bGwsICdOb3RpZmljYXRpb24nLCAncHJvZ3Jlc3NWYWx1ZScsIFsgdmFsdWUgXSk7CiAgICB9Cn07Cn0pOwoKLy8gZmlsZTogbGliL2FuZHJvaWQvcGx1Z2luL2FuZHJvaWQvcG9sbGluZy5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL2FuZHJvaWQvcG9sbGluZyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgY29yZG92YSA9IHJlcXVpcmUoJ2NvcmRvdmEnKSwKICAgIHBlcmlvZCA9IDUwLAogICAgcG9sbGluZyA9IGZ1bmN0aW9uKCkgewogICAgICAvLyBFeGl0IGlmIHNodXR0aW5nIGRvd24gYXBwCiAgICAgIGlmIChjb3Jkb3ZhLnNodXR0aW5nRG93bikgewogICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBJZiBwb2xsaW5nIGZsYWcgd2FzIGNoYW5nZWQsIHN0b3AgdXNpbmcgcG9sbGluZyBmcm9tIG5vdyBvbiBhbmQgc3dpdGNoIHRvIFhIUiBzZXJ2ZXIgLyBjYWxsYmFjawogICAgICBpZiAoIWNvcmRvdmEuVXNlUG9sbGluZykgewogICAgICAgICAgcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vYW5kcm9pZC9jYWxsYmFjaycpKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBtc2cgPSBwcm9tcHQoIiIsICJnYXBfcG9sbDoiKTsKICAgICAgaWYgKG1zZykgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICB2YXIgdCA9IGV2YWwoIiIrbXNnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2tQb2xsaW5nOiBNZXNzYWdlIGZyb20gU2VydmVyOiAiICsgbXNnKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2tQb2xsaW5nIEVycm9yOiAiK2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEpOwogICAgICAgICAgc2V0VGltZW91dChwb2xsaW5nLCAxKTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICAgIHNldFRpbWVvdXQocG9sbGluZywgcGVyaW9kKTsKICAgICAgfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSBwb2xsaW5nOwp9KTsKCi8vIGZpbGU6IGxpYi9hbmRyb2lkL3BsdWdpbi9hbmRyb2lkL3N0b3JhZ2UuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9hbmRyb2lkL3N0b3JhZ2UiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIHV0aWxzID0gcmVxdWlyZSgnY29yZG92YS91dGlscycpLAogICAgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgY2hhbm5lbCA9IHJlcXVpcmUoJ2NvcmRvdmEvY2hhbm5lbCcpOwoKdmFyIHF1ZXJ5UXVldWUgPSB7fTsKCi8qKgogKiBTUUwgcmVzdWx0IHNldCBvYmplY3QKICogUFJJVkFURSBNRVRIT0QKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRHJvaWREQl9Sb3dzID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnJlc3VsdFNldCA9IFtdOyAgICAvLyByZXN1bHRzIGFycmF5CiAgICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAvLyBudW1iZXIgb2Ygcm93cwp9OwoKLyoqCiAqIEdldCBpdGVtIGZyb20gU1FMIHJlc3VsdCBzZXQKICoKICogQHBhcmFtIHJvdyAgICAgICAgICAgVGhlIHJvdyBudW1iZXIgdG8gcmV0dXJuCiAqIEByZXR1cm4gICAgICAgICAgICAgIFRoZSByb3cgb2JqZWN0CiAqLwpEcm9pZERCX1Jvd3MucHJvdG90eXBlLml0ZW0gPSBmdW5jdGlvbihyb3cpIHsKICAgIHJldHVybiB0aGlzLnJlc3VsdFNldFtyb3ddOwp9OwoKLyoqCiAqIFNRTCByZXN1bHQgc2V0IHRoYXQgaXMgcmV0dXJuZWQgdG8gdXNlci4KICogUFJJVkFURSBNRVRIT0QKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRHJvaWREQl9SZXN1bHQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMucm93cyA9IG5ldyBEcm9pZERCX1Jvd3MoKTsKfTsKCi8qKgogKiBDYWxsYmFjayBmcm9tIG5hdGl2ZSBjb2RlIHdoZW4gcXVlcnkgaXMgY29tcGxldGUuCiAqIFBSSVZBVEUgTUVUSE9ECiAqCiAqIEBwYXJhbSBpZCAgIFF1ZXJ5IGlkCiAqLwpmdW5jdGlvbiBjb21wbGV0ZVF1ZXJ5KGlkLCBkYXRhKSB7CiAgICB2YXIgcXVlcnkgPSBxdWVyeVF1ZXVlW2lkXTsKICAgIGlmIChxdWVyeSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRlbGV0ZSBxdWVyeVF1ZXVlW2lkXTsKCiAgICAgICAgICAgIC8vIEdldCB0cmFuc2FjdGlvbgogICAgICAgICAgICB2YXIgdHggPSBxdWVyeS50eDsKCiAgICAgICAgICAgIC8vIElmIHRyYW5zYWN0aW9uIGhhc24ndCBmYWlsZWQKICAgICAgICAgICAgLy8gTm90ZTogV2UgaWdub3JlIGFsbCBxdWVyeSByZXN1bHRzIGlmIHByZXZpb3VzIHF1ZXJ5CiAgICAgICAgICAgIC8vICAgICAgIGluIHRoZSBzYW1lIHRyYW5zYWN0aW9uIGZhaWxlZC4KICAgICAgICAgICAgaWYgKHR4ICYmIHR4LnF1ZXJ5TGlzdFtpZF0pIHsKCiAgICAgICAgICAgICAgICAvLyBTYXZlIHF1ZXJ5IHJlc3VsdHMKICAgICAgICAgICAgICAgIHZhciByID0gbmV3IERyb2lkREJfUmVzdWx0KCk7CiAgICAgICAgICAgICAgICByLnJvd3MucmVzdWx0U2V0ID0gZGF0YTsKICAgICAgICAgICAgICAgIHIucm93cy5sZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBxdWVyeS5zdWNjZXNzQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkuc3VjY2Vzc0NhbGxiYWNrKHF1ZXJ5LnR4LCByKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJleGVjdXRlU3FsIGVycm9yIGNhbGxpbmcgdXNlciBzdWNjZXNzIGNhbGxiYWNrOiAiK2V4KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0eC5xdWVyeUNvbXBsZXRlKGlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImV4ZWN1dGVTcWwgZXJyb3I6ICIrZSk7CiAgICAgICAgfQogICAgfQp9CgovKioKICogQ2FsbGJhY2sgZnJvbSBuYXRpdmUgY29kZSB3aGVuIHF1ZXJ5IGZhaWxzCiAqIFBSSVZBVEUgTUVUSE9ECiAqCiAqIEBwYXJhbSByZWFzb24gICAgICAgICAgICBFcnJvciBtZXNzYWdlCiAqIEBwYXJhbSBpZCAgICAgICAgICAgICAgICBRdWVyeSBpZAogKi8KZnVuY3Rpb24gZmFpbFF1ZXJ5KHJlYXNvbiwgaWQpIHsKICAgIHZhciBxdWVyeSA9IHF1ZXJ5UXVldWVbaWRdOwogICAgaWYgKHF1ZXJ5KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5UXVldWVbaWRdOwoKICAgICAgICAgICAgLy8gR2V0IHRyYW5zYWN0aW9uCiAgICAgICAgICAgIHZhciB0eCA9IHF1ZXJ5LnR4OwoKICAgICAgICAgICAgLy8gSWYgdHJhbnNhY3Rpb24gaGFzbid0IGZhaWxlZAogICAgICAgICAgICAvLyBOb3RlOiBXZSBpZ25vcmUgYWxsIHF1ZXJ5IHJlc3VsdHMgaWYgcHJldmlvdXMgcXVlcnkKICAgICAgICAgICAgLy8gICAgICAgaW4gdGhlIHNhbWUgdHJhbnNhY3Rpb24gZmFpbGVkLgogICAgICAgICAgICBpZiAodHggJiYgdHgucXVlcnlMaXN0W2lkXSkgewogICAgICAgICAgICAgICAgdHgucXVlcnlMaXN0ID0ge307CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5LmVycm9yQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkuZXJyb3JDYWxsYmFjayhxdWVyeS50eCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJleGVjdXRlU3FsIGVycm9yIGNhbGxpbmcgdXNlciBlcnJvciBjYWxsYmFjazogIitleCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHgucXVlcnlGYWlsZWQoaWQsIHJlYXNvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiZXhlY3V0ZVNxbCBlcnJvcjogIitlKTsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBTUUwgcXVlcnkgb2JqZWN0CiAqIFBSSVZBVEUgTUVUSE9ECiAqCiAqIEBjb25zdHJ1Y3RvcgogKiBAcGFyYW0gdHggICAgICAgICAgICAgICAgVGhlIHRyYW5zYWN0aW9uIG9iamVjdCB0aGF0IHRoaXMgcXVlcnkgYmVsb25ncyB0bwogKi8KdmFyIERyb2lkREJfUXVlcnkgPSBmdW5jdGlvbih0eCkgewoKICAgIC8vIFNldCB0aGUgaWQgb2YgdGhlIHF1ZXJ5CiAgICB0aGlzLmlkID0gdXRpbHMuY3JlYXRlVVVJRCgpOwoKICAgIC8vIEFkZCB0aGlzIHF1ZXJ5IHRvIHRoZSBxdWV1ZQogICAgcXVlcnlRdWV1ZVt0aGlzLmlkXSA9IHRoaXM7CgogICAgLy8gSW5pdCByZXN1bHQKICAgIHRoaXMucmVzdWx0U2V0ID0gW107CgogICAgLy8gU2V0IHRyYW5zYWN0aW9uIHRoYXQgdGhpcyBxdWVyeSBiZWxvbmdzIHRvCiAgICB0aGlzLnR4ID0gdHg7CgogICAgLy8gQWRkIHRoaXMgcXVlcnkgdG8gdHJhbnNhY3Rpb24gbGlzdAogICAgdGhpcy50eC5xdWVyeUxpc3RbdGhpcy5pZF0gPSB0aGlzOwoKICAgIC8vIENhbGxiYWNrcwogICAgdGhpcy5zdWNjZXNzQ2FsbGJhY2sgPSBudWxsOwogICAgdGhpcy5lcnJvckNhbGxiYWNrID0gbnVsbDsKCn07CgovKioKICogVHJhbnNhY3Rpb24gb2JqZWN0CiAqIFBSSVZBVEUgTUVUSE9ECiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIERyb2lkREJfVHggPSBmdW5jdGlvbigpIHsKCiAgICAvLyBTZXQgdGhlIGlkIG9mIHRoZSB0cmFuc2FjdGlvbgogICAgdGhpcy5pZCA9IHV0aWxzLmNyZWF0ZVVVSUQoKTsKCiAgICAvLyBDYWxsYmFja3MKICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrID0gbnVsbDsKICAgIHRoaXMuZXJyb3JDYWxsYmFjayA9IG51bGw7CgogICAgLy8gUXVlcnkgbGlzdAogICAgdGhpcy5xdWVyeUxpc3QgPSB7fTsKfTsKCi8qKgogKiBNYXJrIHF1ZXJ5IGluIHRyYW5zYWN0aW9uIGFzIGNvbXBsZXRlLgogKiBJZiBhbGwgcXVlcmllcyBhcmUgY29tcGxldGUsIGNhbGwgdGhlIHVzZXIncyB0cmFuc2FjdGlvbiBzdWNjZXNzIGNhbGxiYWNrLgogKgogKiBAcGFyYW0gaWQgICAgICAgICAgICAgICAgUXVlcnkgaWQKICovCkRyb2lkREJfVHgucHJvdG90eXBlLnF1ZXJ5Q29tcGxldGUgPSBmdW5jdGlvbihpZCkgewogICAgZGVsZXRlIHRoaXMucXVlcnlMaXN0W2lkXTsKCiAgICAvLyBJZiBubyBtb3JlIG91dHN0YW5kaW5nIHF1ZXJpZXMsIHRoZW4gZmlyZSB0cmFuc2FjdGlvbiBzdWNjZXNzCiAgICBpZiAodGhpcy5zdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSBpbiB0aGlzLnF1ZXJ5TGlzdCkgewogICAgICAgICAgICBpZiAodGhpcy5xdWVyeUxpc3QuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1Y2Nlc3NDYWxsYmFjaygpOwogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJUcmFuc2FjdGlvbiBlcnJvciBjYWxsaW5nIHVzZXIgc3VjY2VzcyBjYWxsYmFjazogIiArIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIE1hcmsgcXVlcnkgaW4gdHJhbnNhY3Rpb24gYXMgZmFpbGVkLgogKgogKiBAcGFyYW0gaWQgICAgICAgICAgICAgICAgUXVlcnkgaWQKICogQHBhcmFtIHJlYXNvbiAgICAgICAgICAgIEVycm9yIG1lc3NhZ2UKICovCkRyb2lkREJfVHgucHJvdG90eXBlLnF1ZXJ5RmFpbGVkID0gZnVuY3Rpb24oaWQsIHJlYXNvbikgewoKICAgIC8vIFRoZSBzcWwgcXVlcmllcyBpbiB0aGlzIHRyYW5zYWN0aW9uIGhhdmUgYWxyZWFkeSBiZWVuIHJ1biwgc2luY2UKICAgIC8vIHdlIHJlYWxseSBkb24ndCBoYXZlIGEgcmVhbCB0cmFuc2FjdGlvbiBpbXBsZW1lbnRlZCBpbiBuYXRpdmUgY29kZS4KICAgIC8vIEhvd2V2ZXIsIHRoZSB1c2VyIGNhbGxiYWNrcyBmb3IgdGhlIHJlbWFpbmluZyBzcWwgcXVlcmllcyBpbiB0cmFuc2FjdGlvbgogICAgLy8gd2lsbCBub3QgYmUgY2FsbGVkLgogICAgdGhpcy5xdWVyeUxpc3QgPSB7fTsKCiAgICBpZiAodGhpcy5lcnJvckNhbGxiYWNrKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpcy5lcnJvckNhbGxiYWNrKHJlYXNvbik7CiAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJUcmFuc2FjdGlvbiBlcnJvciBjYWxsaW5nIHVzZXIgZXJyb3IgY2FsbGJhY2s6ICIgKyBlKTsKICAgICAgICB9CiAgICB9Cn07CgovKioKICogRXhlY3V0ZSBTUUwgc3RhdGVtZW50CiAqCiAqIEBwYXJhbSBzcWwgICAgICAgICAgICAgICAgICAgU1FMIHN0YXRlbWVudCB0byBleGVjdXRlCiAqIEBwYXJhbSBwYXJhbXMgICAgICAgICAgICAgICAgU3RhdGVtZW50IHBhcmFtZXRlcnMKICogQHBhcmFtIHN1Y2Nlc3NDYWxsYmFjayAgICAgICBTdWNjZXNzIGNhbGxiYWNrCiAqIEBwYXJhbSBlcnJvckNhbGxiYWNrICAgICAgICAgRXJyb3IgY2FsbGJhY2sKICovCkRyb2lkREJfVHgucHJvdG90eXBlLmV4ZWN1dGVTcWwgPSBmdW5jdGlvbihzcWwsIHBhcmFtcywgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CgogICAgLy8gSW5pdCBwYXJhbXMgYXJyYXkKICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHBhcmFtcyA9IFtdOwogICAgfQoKICAgIC8vIENyZWF0ZSBxdWVyeSBhbmQgYWRkIHRvIHF1ZXVlCiAgICB2YXIgcXVlcnkgPSBuZXcgRHJvaWREQl9RdWVyeSh0aGlzKTsKICAgIHF1ZXJ5UXVldWVbcXVlcnkuaWRdID0gcXVlcnk7CgogICAgLy8gU2F2ZSBjYWxsYmFja3MKICAgIHF1ZXJ5LnN1Y2Nlc3NDYWxsYmFjayA9IHN1Y2Nlc3NDYWxsYmFjazsKICAgIHF1ZXJ5LmVycm9yQ2FsbGJhY2sgPSBlcnJvckNhbGxiYWNrOwoKICAgIC8vIENhbGwgbmF0aXZlIGNvZGUKICAgIGV4ZWMobnVsbCwgbnVsbCwgIlN0b3JhZ2UiLCAiZXhlY3V0ZVNxbCIsIFtzcWwsIHBhcmFtcywgcXVlcnkuaWRdKTsKfTsKCnZhciBEYXRhYmFzZVNoZWxsID0gZnVuY3Rpb24oKSB7Cn07CgovKioKICogU3RhcnQgYSB0cmFuc2FjdGlvbi4KICogRG9lcyBub3Qgc3VwcG9ydCByb2xsYmFjayBpbiBldmVudCBvZiBmYWlsdXJlLgogKgogKiBAcGFyYW0gcHJvY2VzcyB7RnVuY3Rpb259ICAgICAgICAgICAgVGhlIHRyYW5zYWN0aW9uIGZ1bmN0aW9uCiAqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sge0Z1bmN0aW9ufQogKiBAcGFyYW0gZXJyb3JDYWxsYmFjayB7RnVuY3Rpb259CiAqLwpEYXRhYmFzZVNoZWxsLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKHByb2Nlc3MsIGVycm9yQ2FsbGJhY2ssIHN1Y2Nlc3NDYWxsYmFjaykgewogICAgdmFyIHR4ID0gbmV3IERyb2lkREJfVHgoKTsKICAgIHR4LnN1Y2Nlc3NDYWxsYmFjayA9IHN1Y2Nlc3NDYWxsYmFjazsKICAgIHR4LmVycm9yQ2FsbGJhY2sgPSBlcnJvckNhbGxiYWNrOwogICAgdHJ5IHsKICAgICAgICBwcm9jZXNzKHR4KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3I6ICIrZSk7CiAgICAgICAgaWYgKHR4LmVycm9yQ2FsbGJhY2spIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHR4LmVycm9yQ2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3IgY2FsbGluZyB1c2VyIGVycm9yIGNhbGxiYWNrOiAiK2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIE9wZW4gZGF0YWJhc2UKICoKICogQHBhcmFtIG5hbWUgICAgICAgICAgICAgIERhdGFiYXNlIG5hbWUKICogQHBhcmFtIHZlcnNpb24gICAgICAgICAgIERhdGFiYXNlIHZlcnNpb24KICogQHBhcmFtIGRpc3BsYXlfbmFtZSAgICAgIERhdGFiYXNlIGRpc3BsYXkgbmFtZQogKiBAcGFyYW0gc2l6ZSAgICAgICAgICAgICAgRGF0YWJhc2Ugc2l6ZSBpbiBieXRlcwogKiBAcmV0dXJuICAgICAgICAgICAgICAgICAgRGF0YWJhc2Ugb2JqZWN0CiAqLwp2YXIgRHJvaWREQl9vcGVuRGF0YWJhc2UgPSBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCBkaXNwbGF5X25hbWUsIHNpemUpIHsKICAgIGV4ZWMobnVsbCwgbnVsbCwgIlN0b3JhZ2UiLCAib3BlbkRhdGFiYXNlIiwgW25hbWUsIHZlcnNpb24sIGRpc3BsYXlfbmFtZSwgc2l6ZV0pOwogICAgdmFyIGRiID0gbmV3IERhdGFiYXNlU2hlbGwoKTsKICAgIHJldHVybiBkYjsKfTsKCi8qKgogKiBGb3IgYnJvd3NlcnMgd2l0aCBubyBsb2NhbFN0b3JhZ2Ugd2UgZW11bGF0ZSBpdCB3aXRoIFNRTGl0ZS4gRm9sbG93cyB0aGUgdzNjIGFwaS4KICogVE9ETzogRG8gc2ltaWxhciBmb3Igc2Vzc2lvblN0b3JhZ2UuCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEN1cGNha2VMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbigpIHsKICAgIGNoYW5uZWwud2FpdEZvckluaXRpYWxpemF0aW9uKCJjdXBjYWtlU3RvcmFnZSIpOwoKICAgIHRyeSB7CgogICAgICB0aGlzLmRiID0gb3BlbkRhdGFiYXNlKCdsb2NhbFN0b3JhZ2UnLCAnMS4wJywgJ2xvY2FsU3RvcmFnZScsIDI2MjE0NDApOwogICAgICB2YXIgc3RvcmFnZSA9IHt9OwogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIGZ1bmN0aW9uIHNldExlbmd0aCAobGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7CiAgICAgICAgbG9jYWxTdG9yYWdlLmxlbmd0aCA9IGxlbmd0aDsKICAgICAgfQogICAgICB0aGlzLmRiLnRyYW5zYWN0aW9uKAogICAgICAgIGZ1bmN0aW9uICh0cmFuc2FjdGlvbikgewogICAgICAgICAgICB2YXIgaTsKICAgICAgICAgIHRyYW5zYWN0aW9uLmV4ZWN1dGVTcWwoJ0NSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHN0b3JhZ2UgKGlkIE5WQVJDSEFSKDQwKSBQUklNQVJZIEtFWSwgYm9keSBOVkFSQ0hBUigyNTUpKScpOwogICAgICAgICAgdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnU0VMRUNUICogRlJPTSBzdG9yYWdlJywgW10sIGZ1bmN0aW9uKHR4LCByZXN1bHQpIHsKICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHJlc3VsdC5yb3dzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgc3RvcmFnZVtyZXN1bHQucm93cy5pdGVtKGkpLmlkXSA9ICByZXN1bHQucm93cy5pdGVtKGkpLmJvZHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0TGVuZ3RoKHJlc3VsdC5yb3dzLmxlbmd0aCk7CiAgICAgICAgICAgIGNoYW5uZWwuaW5pdGlhbGl6YXRpb25Db21wbGV0ZSgiY3VwY2FrZVN0b3JhZ2UiKTsKICAgICAgICAgIH0pOwoKICAgICAgICB9LAogICAgICAgIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIHV0aWxzLmFsZXJ0KGVyci5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICk7CiAgICAgIHRoaXMuc2V0SXRlbSA9IGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgaWYgKHR5cGVvZihzdG9yYWdlW2tleV0pPT0ndW5kZWZpbmVkJykgewogICAgICAgICAgdGhpcy5sZW5ndGgrKzsKICAgICAgICB9CiAgICAgICAgc3RvcmFnZVtrZXldID0gdmFsOwogICAgICAgIHRoaXMuZGIudHJhbnNhY3Rpb24oCiAgICAgICAgICBmdW5jdGlvbiAodHJhbnNhY3Rpb24pIHsKICAgICAgICAgICAgdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgc3RvcmFnZSAoaWQgTlZBUkNIQVIoNDApIFBSSU1BUlkgS0VZLCBib2R5IE5WQVJDSEFSKDI1NSkpJyk7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uLmV4ZWN1dGVTcWwoJ1JFUExBQ0UgSU5UTyBzdG9yYWdlIChpZCwgYm9keSkgdmFsdWVzKD8sPyknLCBba2V5LHZhbF0pOwogICAgICAgICAgfQogICAgICAgICk7CiAgICAgIH07CiAgICAgIHRoaXMuZ2V0SXRlbSA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHJldHVybiBzdG9yYWdlW2tleV07CiAgICAgIH07CiAgICAgIHRoaXMucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIGRlbGV0ZSBzdG9yYWdlW2tleV07CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICB0aGlzLmRiLnRyYW5zYWN0aW9uKAogICAgICAgICAgZnVuY3Rpb24gKHRyYW5zYWN0aW9uKSB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uLmV4ZWN1dGVTcWwoJ0NSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHN0b3JhZ2UgKGlkIE5WQVJDSEFSKDQwKSBQUklNQVJZIEtFWSwgYm9keSBOVkFSQ0hBUigyNTUpKScpOwogICAgICAgICAgICB0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdERUxFVEUgRlJPTSBzdG9yYWdlIHdoZXJlIGlkPT8nLCBba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgfTsKICAgICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHN0b3JhZ2UgPSB7fTsKICAgICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgICAgdGhpcy5kYi50cmFuc2FjdGlvbigKICAgICAgICAgIGZ1bmN0aW9uICh0cmFuc2FjdGlvbikgewogICAgICAgICAgICB0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzdG9yYWdlIChpZCBOVkFSQ0hBUig0MCkgUFJJTUFSWSBLRVksIGJvZHkgTlZBUkNIQVIoMjU1KSknKTsKICAgICAgICAgICAgdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnREVMRVRFIEZST00gc3RvcmFnZScsIFtdKTsKICAgICAgICAgIH0KICAgICAgICApOwogICAgICB9OwogICAgICB0aGlzLmtleSA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIGZvciAodmFyIGogaW4gc3RvcmFnZSkgewogICAgICAgICAgaWYgKGk9PWluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBqOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfTsKCiAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgIHV0aWxzLmFsZXJ0KCJEYXRhYmFzZSBlcnJvciAiK2UrIi4iKTsKICAgICAgICByZXR1cm47CiAgICB9Cn07Cgptb2R1bGUuZXhwb3J0cyA9IHsKICBvcGVuRGF0YWJhc2U6RHJvaWREQl9vcGVuRGF0YWJhc2UsCiAgQ3VwY2FrZUxvY2FsU3RvcmFnZTpDdXBjYWtlTG9jYWxTdG9yYWdlLAogIGZhaWxRdWVyeTpmYWlsUXVlcnksCiAgY29tcGxldGVRdWVyeTpjb21wbGV0ZVF1ZXJ5Cn07Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL2JhdHRlcnkuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9iYXR0ZXJ5IiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7Ci8qKgogKiBUaGlzIGNsYXNzIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50IGJhdHRlcnkgc3RhdHVzLgogKiBAY29uc3RydWN0b3IKICovCnZhciBjb3Jkb3ZhID0gcmVxdWlyZSgnY29yZG92YScpLAogICAgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpOwoKZnVuY3Rpb24gaGFuZGxlcnMoKSB7CiAgcmV0dXJuIGJhdHRlcnkuY2hhbm5lbHMuYmF0dGVyeXN0YXR1cy5udW1IYW5kbGVycyArCiAgICAgICAgIGJhdHRlcnkuY2hhbm5lbHMuYmF0dGVyeWxvdy5udW1IYW5kbGVycyArCiAgICAgICAgIGJhdHRlcnkuY2hhbm5lbHMuYmF0dGVyeWNyaXRpY2FsLm51bUhhbmRsZXJzOwp9Cgp2YXIgQmF0dGVyeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fbGV2ZWwgPSBudWxsOwogICAgdGhpcy5faXNQbHVnZ2VkID0gbnVsbDsKICAgIC8vIENyZWF0ZSBuZXcgZXZlbnQgaGFuZGxlcnMgb24gdGhlIHdpbmRvdyAocmV0dXJucyBhIGNoYW5uZWwgaW5zdGFuY2UpCiAgICB2YXIgc3Vic2NyaXB0aW9uRXZlbnRzID0gewogICAgICBvblN1YnNjcmliZTp0aGlzLm9uU3Vic2NyaWJlLAogICAgICBvblVuc3Vic2NyaWJlOnRoaXMub25VbnN1YnNjcmliZQogICAgfTsKICAgIHRoaXMuY2hhbm5lbHMgPSB7CiAgICAgIGJhdHRlcnlzdGF0dXM6Y29yZG92YS5hZGRXaW5kb3dFdmVudEhhbmRsZXIoImJhdHRlcnlzdGF0dXMiLCBzdWJzY3JpcHRpb25FdmVudHMpLAogICAgICBiYXR0ZXJ5bG93OmNvcmRvdmEuYWRkV2luZG93RXZlbnRIYW5kbGVyKCJiYXR0ZXJ5bG93Iiwgc3Vic2NyaXB0aW9uRXZlbnRzKSwKICAgICAgYmF0dGVyeWNyaXRpY2FsOmNvcmRvdmEuYWRkV2luZG93RXZlbnRIYW5kbGVyKCJiYXR0ZXJ5Y3JpdGljYWwiLCBzdWJzY3JpcHRpb25FdmVudHMpCiAgICB9Owp9OwovKioKICogRXZlbnQgaGFuZGxlcnMgZm9yIHdoZW4gY2FsbGJhY2tzIGdldCByZWdpc3RlcmVkIGZvciB0aGUgYmF0dGVyeS4KICogS2VlcCB0cmFjayBvZiBob3cgbWFueSBoYW5kbGVycyB3ZSBoYXZlIHNvIHdlIGNhbiBzdGFydCBhbmQgc3RvcCB0aGUgbmF0aXZlIGJhdHRlcnkgbGlzdGVuZXIKICogYXBwcm9wcmlhdGVseSAoYW5kIGhvcGVmdWxseSBzYXZlIG9uIGJhdHRlcnkgbGlmZSEpLgogKi8KQmF0dGVyeS5wcm90b3R5cGUub25TdWJzY3JpYmUgPSBmdW5jdGlvbigpIHsKICB2YXIgbWUgPSBiYXR0ZXJ5OwogIC8vIElmIHdlIGp1c3QgcmVnaXN0ZXJlZCB0aGUgZmlyc3QgaGFuZGxlciwgbWFrZSBzdXJlIG5hdGl2ZSBsaXN0ZW5lciBpcyBzdGFydGVkLgogIGlmIChoYW5kbGVycygpID09PSAxKSB7CiAgICBleGVjKG1lLl9zdGF0dXMsIG1lLl9lcnJvciwgIkJhdHRlcnkiLCAic3RhcnQiLCBbXSk7CiAgfQp9OwoKQmF0dGVyeS5wcm90b3R5cGUub25VbnN1YnNjcmliZSA9IGZ1bmN0aW9uKCkgewogIHZhciBtZSA9IGJhdHRlcnk7CgogIC8vIElmIHdlIGp1c3QgdW5yZWdpc3RlcmVkIHRoZSBsYXN0IGhhbmRsZXIsIG1ha2Ugc3VyZSBuYXRpdmUgbGlzdGVuZXIgaXMgc3RvcHBlZC4KICBpZiAoaGFuZGxlcnMoKSA9PT0gMCkgewogICAgICBleGVjKG51bGwsIG51bGwsICJCYXR0ZXJ5IiwgInN0b3AiLCBbXSk7CiAgfQp9OwoKLyoqCiAqIENhbGxiYWNrIGZvciBiYXR0ZXJ5IHN0YXR1cwogKgogKiBAcGFyYW0ge09iamVjdH0gaW5mbyAgICAgICAgICAgIGtleXM6IGxldmVsLCBpc1BsdWdnZWQKICovCkJhdHRlcnkucHJvdG90eXBlLl9zdGF0dXMgPSBmdW5jdGlvbihpbmZvKSB7CiAgICBpZiAoaW5mbykgewogICAgICAgIHZhciBtZSA9IGJhdHRlcnk7CiAgICB2YXIgbGV2ZWwgPSBpbmZvLmxldmVsOwogICAgICAgIGlmIChtZS5fbGV2ZWwgIT09IGxldmVsIHx8IG1lLl9pc1BsdWdnZWQgIT09IGluZm8uaXNQbHVnZ2VkKSB7CiAgICAgICAgICAgIC8vIEZpcmUgYmF0dGVyeXN0YXR1cyBldmVudAogICAgICAgICAgICBjb3Jkb3ZhLmZpcmVXaW5kb3dFdmVudCgiYmF0dGVyeXN0YXR1cyIsIGluZm8pOwoKICAgICAgICAgICAgLy8gRmlyZSBsb3cgYmF0dGVyeSBldmVudAogICAgICAgICAgICBpZiAobGV2ZWwgPT09IDIwIHx8IGxldmVsID09PSA1KSB7CiAgICAgICAgICAgICAgICBpZiAobGV2ZWwgPT09IDIwKSB7CiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5maXJlV2luZG93RXZlbnQoImJhdHRlcnlsb3ciLCBpbmZvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvcmRvdmEuZmlyZVdpbmRvd0V2ZW50KCJiYXR0ZXJ5Y3JpdGljYWwiLCBpbmZvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBtZS5fbGV2ZWwgPSBsZXZlbDsKICAgICAgICBtZS5faXNQbHVnZ2VkID0gaW5mby5pc1BsdWdnZWQ7CiAgICB9Cn07CgovKioKICogRXJyb3IgY2FsbGJhY2sgZm9yIGJhdHRlcnkgc3RhcnQKICovCkJhdHRlcnkucHJvdG90eXBlLl9lcnJvciA9IGZ1bmN0aW9uKGUpIHsKICAgIGNvbnNvbGUubG9nKCJFcnJvciBpbml0aWFsaXppbmcgQmF0dGVyeTogIiArIGUpOwp9OwoKdmFyIGJhdHRlcnkgPSBuZXcgQmF0dGVyeSgpOwoKbW9kdWxlLmV4cG9ydHMgPSBiYXR0ZXJ5Owp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL2NhcHR1cmUuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9jYXB0dXJlIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyksCiAgICBNZWRpYUZpbGUgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9NZWRpYUZpbGUnKTsKCi8qKgogKiBMYXVuY2hlcyBhIGNhcHR1cmUgb2YgZGlmZmVyZW50IHR5cGVzLgogKgogKiBAcGFyYW0gKERPTVN0cmluZ30gdHlwZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ0IKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDQgogKiBAcGFyYW0ge0NhcHR1cmVWaWRlb09wdGlvbnN9IG9wdGlvbnMKICovCmZ1bmN0aW9uIF9jYXB0dXJlKHR5cGUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewogICAgdmFyIHdpbiA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkgewogICAgICAgIHZhciBtZWRpYUZpbGVzID0gW107CiAgICAgICAgdmFyIGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBsdWdpblJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgbWVkaWFGaWxlID0gbmV3IE1lZGlhRmlsZSgpOwogICAgICAgICAgICBtZWRpYUZpbGUubmFtZSA9IHBsdWdpblJlc3VsdFtpXS5uYW1lOwogICAgICAgICAgICBtZWRpYUZpbGUuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHRbaV0uZnVsbFBhdGg7CiAgICAgICAgICAgIG1lZGlhRmlsZS50eXBlID0gcGx1Z2luUmVzdWx0W2ldLnR5cGU7CiAgICAgICAgICAgIG1lZGlhRmlsZS5sYXN0TW9kaWZpZWREYXRlID0gcGx1Z2luUmVzdWx0W2ldLmxhc3RNb2RpZmllZERhdGU7CiAgICAgICAgICAgIG1lZGlhRmlsZS5zaXplID0gcGx1Z2luUmVzdWx0W2ldLnNpemU7CiAgICAgICAgICAgIG1lZGlhRmlsZXMucHVzaChtZWRpYUZpbGUpOwogICAgICAgIH0KICAgICAgICBzdWNjZXNzQ2FsbGJhY2sobWVkaWFGaWxlcyk7CiAgICB9OwogICAgZXhlYyh3aW4sIGVycm9yQ2FsbGJhY2ssICJDYXB0dXJlIiwgdHlwZSwgW29wdGlvbnNdKTsKfQovKioKICogVGhlIENhcHR1cmUgaW50ZXJmYWNlIGV4cG9zZXMgYW4gaW50ZXJmYWNlIHRvIHRoZSBjYW1lcmEgYW5kIG1pY3JvcGhvbmUgb2YgdGhlIGhvc3RpbmcgZGV2aWNlLgogKi8KZnVuY3Rpb24gQ2FwdHVyZSgpIHsKICAgIHRoaXMuc3VwcG9ydGVkQXVkaW9Nb2RlcyA9IFtdOwogICAgdGhpcy5zdXBwb3J0ZWRJbWFnZU1vZGVzID0gW107CiAgICB0aGlzLnN1cHBvcnRlZFZpZGVvTW9kZXMgPSBbXTsKfQoKLyoqCiAqIExhdW5jaCBhdWRpbyByZWNvcmRlciBhcHBsaWNhdGlvbiBmb3IgcmVjb3JkaW5nIGF1ZGlvIGNsaXAocykuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDQgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNCCiAqIEBwYXJhbSB7Q2FwdHVyZUF1ZGlvT3B0aW9uc30gb3B0aW9ucwogKi8KQ2FwdHVyZS5wcm90b3R5cGUuY2FwdHVyZUF1ZGlvID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKXsKICAgIF9jYXB0dXJlKCJjYXB0dXJlQXVkaW8iLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpOwp9OwoKLyoqCiAqIExhdW5jaCBjYW1lcmEgYXBwbGljYXRpb24gZm9yIHRha2luZyBpbWFnZShzKS4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NCCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ0IKICogQHBhcmFtIHtDYXB0dXJlSW1hZ2VPcHRpb25zfSBvcHRpb25zCiAqLwpDYXB0dXJlLnByb3RvdHlwZS5jYXB0dXJlSW1hZ2UgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpewogICAgX2NhcHR1cmUoImNhcHR1cmVJbWFnZSIsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucyk7Cn07CgovKioKICogTGF1bmNoIGRldmljZSBjYW1lcmEgYXBwbGljYXRpb24gZm9yIHJlY29yZGluZyB2aWRlbyhzKS4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NCCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ0IKICogQHBhcmFtIHtDYXB0dXJlVmlkZW9PcHRpb25zfSBvcHRpb25zCiAqLwpDYXB0dXJlLnByb3RvdHlwZS5jYXB0dXJlVmlkZW8gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpewogICAgX2NhcHR1cmUoImNhcHR1cmVWaWRlbyIsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucyk7Cn07CgoKbW9kdWxlLmV4cG9ydHMgPSBuZXcgQ2FwdHVyZSgpOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9jb21wYXNzLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vY29tcGFzcyIsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpLAogICAgdXRpbHMgPSByZXF1aXJlKCdjb3Jkb3ZhL3V0aWxzJyksCiAgICBDb21wYXNzSGVhZGluZyA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0NvbXBhc3NIZWFkaW5nJyksCiAgICBDb21wYXNzRXJyb3IgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9Db21wYXNzRXJyb3InKSwKICAgIHRpbWVycyA9IHt9LAogICAgY29tcGFzcyA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBBc3luY2hyb25vdXNseSBhY3F1aXJlcyB0aGUgY3VycmVudCBoZWFkaW5nLgogICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBoZWFkaW5nCiAgICAgICAgICogZGF0YSBpcyBhdmFpbGFibGUKICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IKICAgICAgICAgKiBnZXR0aW5nIHRoZSBoZWFkaW5nIGRhdGEuCiAgICAgICAgICogQHBhcmFtIHtDb21wYXNzT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhIChub3QgdXNlZCkuCiAgICAgICAgICovCiAgICAgICAgZ2V0Q3VycmVudEhlYWRpbmc6ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBlcnJvckNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgd2luID0gZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICB2YXIgY2ggPSBuZXcgQ29tcGFzc0hlYWRpbmcocmVzdWx0Lm1hZ25ldGljSGVhZGluZywgcmVzdWx0LnRydWVIZWFkaW5nLCByZXN1bHQuaGVhZGluZ0FjY3VyYWN5LCByZXN1bHQudGltZXN0YW1wKTsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhjaCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBmYWlsID0gZnVuY3Rpb24oY29kZSkgewogICAgICAgICAgICAgICAgdmFyIGNlID0gbmV3IENvbXBhc3NFcnJvcihjb2RlKTsKICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soY2UpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gR2V0IGhlYWRpbmcKICAgICAgICAgICAgZXhlYyh3aW4sIGZhaWwsICJDb21wYXNzIiwgImdldEhlYWRpbmciLCBbb3B0aW9uc10pOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEFzeW5jaHJvbm91c2x5IGFjcXVpcmVzIHRoZSBoZWFkaW5nIHJlcGVhdGVkbHkgYXQgYSBnaXZlbiBpbnRlcnZhbC4KICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZWFjaCB0aW1lIHRoZSBoZWFkaW5nCiAgICAgICAgICogZGF0YSBpcyBhdmFpbGFibGUKICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IKICAgICAgICAgKiBnZXR0aW5nIHRoZSBoZWFkaW5nIGRhdGEuCiAgICAgICAgICogQHBhcmFtIHtIZWFkaW5nT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhCiAgICAgICAgICogc3VjaCBhcyB0aW1lb3V0IGFuZCB0aGUgZnJlcXVlbmN5IG9mIHRoZSB3YXRjaC4gRm9yIGlPUywgZmlsdGVyIHBhcmFtZXRlcgogICAgICAgICAqIHNwZWNpZmllcyB0byB3YXRjaCB2aWEgYSBkaXN0YW5jZSBmaWx0ZXIgcmF0aGVyIHRoYW4gdGltZS4KICAgICAgICAgKi8KICAgICAgICB3YXRjaEhlYWRpbmc6ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIERlZmF1bHQgaW50ZXJ2YWwgKDEwMCBtc2VjKQogICAgICAgICAgICB2YXIgZnJlcXVlbmN5ID0gKG9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmZyZXF1ZW5jeSAhPT0gdW5kZWZpbmVkKSA/IG9wdGlvbnMuZnJlcXVlbmN5IDogMTAwOwogICAgICAgICAgICB2YXIgZmlsdGVyID0gKG9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmZpbHRlciAhPT0gdW5kZWZpbmVkKSA/IG9wdGlvbnMuZmlsdGVyIDogMDsKCiAgICAgICAgICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgICAgICAgICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBlcnJvckNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaWQgPSB1dGlscy5jcmVhdGVVVUlEKCk7CiAgICAgICAgICAgIGlmIChmaWx0ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBpcyBhbiBpT1MgcmVxdWVzdCBmb3Igd2F0Y2ggYnkgZmlsdGVyLCBubyB0aW1lciBuZWVkZWQKICAgICAgICAgICAgICAgIHRpbWVyc1tpZF0gPSAiaU9TIjsKICAgICAgICAgICAgICAgIGNvbXBhc3MuZ2V0Q3VycmVudEhlYWRpbmcoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHdhdGNoIHRpbWVyIHRvIGdldCBoZWFkaW5ncwogICAgICAgICAgICAgICAgdGltZXJzW2lkXSA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBjb21wYXNzLmdldEN1cnJlbnRIZWFkaW5nKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjayk7CiAgICAgICAgICAgICAgICB9LCBmcmVxdWVuY3kpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXJzIHRoZSBzcGVjaWZpZWQgaGVhZGluZyB3YXRjaC4KICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gd2F0Y2hJZCBUaGUgSUQgb2YgdGhlIHdhdGNoIHJldHVybmVkIGZyb20gI3dhdGNoSGVhZGluZy4KICAgICAgICAgKi8KICAgICAgICBjbGVhcldhdGNoOmZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgIC8vIFN0b3AgamF2YXNjcmlwdCB0aW1lciAmIHJlbW92ZSBmcm9tIHRpbWVyIGxpc3QKICAgICAgICAgICAgaWYgKGlkICYmIHRpbWVyc1tpZF0pIHsKICAgICAgICAgICAgICAgIGlmICh0aW1lcnNbaWRdICE9ICJpT1MiKSB7CiAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyc1tpZF0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGlzIGlPUyB3YXRjaCBieSBmaWx0ZXIgc28gY2FsbCBpbnRvIGRldmljZSB0byBzdG9wCiAgICAgICAgICAgICAgICAgICAgZXhlYyhudWxsLCBudWxsLCAiQ29tcGFzcyIsICJzdG9wSGVhZGluZyIsIFtdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlbGV0ZSB0aW1lcnNbaWRdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCm1vZHVsZS5leHBvcnRzID0gY29tcGFzczsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9jb25zb2xlLXZpYS1sb2dnZXIuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9jb25zb2xlLXZpYS1sb2dnZXIiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCnZhciBsb2dnZXIgPSByZXF1aXJlKCJjb3Jkb3ZhL3BsdWdpbi9sb2dnZXIiKTsKdmFyIHV0aWxzICA9IHJlcXVpcmUoImNvcmRvdmEvdXRpbHMiKTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIG9iamVjdCB0aGF0IHdlJ3JlIGV4cG9ydGluZwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp2YXIgY29uc29sZSA9IG1vZHVsZS5leHBvcnRzOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gY29weSBvZiB0aGUgb3JpZ2luYWwgY29uc29sZSBvYmplY3QKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KdmFyIFdpbkNvbnNvbGUgPSB3aW5kb3cuY29uc29sZTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIHdoZXRoZXIgdG8gdXNlIHRoZSBsb2dnZXIKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KdmFyIFVzZUxvZ2dlciA9IGZhbHNlOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gVGltZXJzCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCnZhciBUaW1lcnMgPSB7fTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIHVzZWQgZm9yIHVuaW1wbGVtZW50ZWQgbWV0aG9kcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBub29wKCkge30KCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIHVzZWQgZm9yIHVuaW1wbGVtZW50ZWQgbWV0aG9kcwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLnVzZUxvZ2dlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIFVzZUxvZ2dlciA9ICEhdmFsdWU7CgogICAgaWYgKFVzZUxvZ2dlcikgewogICAgICAgIGlmIChsb2dnZXIudXNlQ29uc29sZSgpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY29uc29sZSBhbmQgbG9nZ2VyIGFyZSB0b28gaW50ZXJ0d2luZ2x5Iik7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBVc2VMb2dnZXI7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmxvZyA9IGZ1bmN0aW9uKCkgewogICAgaWYgKGxvZ2dlci51c2VDb25zb2xlKCkpIHJldHVybjsKICAgIGxvZ2dlci5sb2cuYXBwbHkobG9nZ2VyLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS5lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgaWYgKGxvZ2dlci51c2VDb25zb2xlKCkpIHJldHVybjsKICAgIGxvZ2dlci5lcnJvci5hcHBseShsb2dnZXIsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLndhcm4gPSBmdW5jdGlvbigpIHsKICAgIGlmIChsb2dnZXIudXNlQ29uc29sZSgpKSByZXR1cm47CiAgICBsb2dnZXIud2Fybi5hcHBseShsb2dnZXIsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmluZm8gPSBmdW5jdGlvbigpIHsKICAgIGlmIChsb2dnZXIudXNlQ29uc29sZSgpKSByZXR1cm47CiAgICBsb2dnZXIuaW5mby5hcHBseShsb2dnZXIsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmRlYnVnID0gZnVuY3Rpb24oKSB7CiAgICBpZiAobG9nZ2VyLnVzZUNvbnNvbGUoKSkgcmV0dXJuOwogICAgbG9nZ2VyLmRlYnVnLmFwcGx5KGxvZ2dlciwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnNvbGUuYXNzZXJ0ID0gZnVuY3Rpb24oZXhwcmVzc2lvbikgewogICAgaWYgKGV4cHJlc3Npb24pIHJldHVybjsKCiAgICB2YXIgbWVzc2FnZSA9IHV0aWxzLnZmb3JtYXQoYXJndW1lbnRzWzFdLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMikpOwogICAgY29uc29sZS5sb2coIkFTU0VSVDogIiArIG1lc3NhZ2UpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS5jbGVhciA9IGZ1bmN0aW9uKCkge307CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmRpciA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgY29uc29sZS5sb2coIiVvIiwgb2JqZWN0KTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnNvbGUuZGlyeG1sID0gZnVuY3Rpb24obm9kZSkgewogICAgY29uc29sZS5sb2cobm9kZS5pbm5lckhUTUwpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS50cmFjZSA9IG5vb3A7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmdyb3VwID0gY29uc29sZS5sb2c7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmdyb3VwQ29sbGFwc2VkID0gY29uc29sZS5sb2c7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmdyb3VwRW5kID0gbm9vcDsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnNvbGUudGltZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIFRpbWVyc1tuYW1lXSA9IG5ldyBEYXRlKCkudmFsdWVPZigpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS50aW1lRW5kID0gZnVuY3Rpb24obmFtZSkgewogICAgdmFyIHRpbWVTdGFydCA9IFRpbWVyc1tuYW1lXTsKICAgIGlmICghdGltZVN0YXJ0KSB7CiAgICAgICAgY29uc29sZS53YXJuKCJ1bmtub3duIHRpbWVyOiAiICsgbmFtZSk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciB0aW1lRWxhcHNlZCA9IG5ldyBEYXRlKCkudmFsdWVPZigpIC0gdGltZVN0YXJ0OwogICAgY29uc29sZS5sb2cobmFtZSArICI6ICIgKyB0aW1lRWxhcHNlZCArICJtcyIpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS50aW1lU3RhbXAgPSBub29wOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29uc29sZS5wcm9maWxlID0gbm9vcDsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnNvbGUucHJvZmlsZUVuZCA9IG5vb3A7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLmNvdW50ID0gbm9vcDsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnNvbGUuZXhjZXB0aW9uID0gY29uc29sZS5sb2c7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zb2xlLnRhYmxlID0gZnVuY3Rpb24oZGF0YSwgY29sdW1ucykgewogICAgY29uc29sZS5sb2coIiVvIiwgZGF0YSk7Cn07CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyByZXR1cm4gYSBuZXcgZnVuY3Rpb24gdGhhdCBjYWxscyBib3RoIGZ1bmN0aW9ucyBwYXNzZWQgYXMgYXJncwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiB3cmFwcGVyZWRPcmlnQ2FsbChvcmdGdW5jLCBuZXdGdW5jKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdHJ5IHsgb3JnRnVuYy5hcHBseShXaW5Db25zb2xlLCBhcmdzKTsgfSBjYXRjaCAoZSkge30KICAgICAgICB0cnkgeyBuZXdGdW5jLmFwcGx5KGNvbnNvbGUsICAgIGFyZ3MpOyB9IGNhdGNoIChlKSB7fQogICAgfTsKfQoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRm9yIGV2ZXJ5IGZ1bmN0aW9uIHRoYXQgZXhpc3RzIGluIHRoZSBvcmlnaW5hbCBjb25zb2xlIG9iamVjdCwgdGhhdAovLyBhbHNvIGV4aXN0cyBpbiB0aGUgbmV3IGNvbnNvbGUgb2JqZWN0LCB3cmFwIHRoZSBuZXcgY29uc29sZSBtZXRob2QKLy8gd2l0aCBvbmUgdGhhdCBjYWxscyBib3RoCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZvciAodmFyIGtleSBpbiBjb25zb2xlKSB7CiAgICBpZiAodHlwZW9mIFdpbkNvbnNvbGVba2V5XSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgY29uc29sZVtrZXldID0gd3JhcHBlcmVkT3JpZ0NhbGwoV2luQ29uc29sZVtrZXldLCBjb25zb2xlW2tleV0pOwogICAgfQp9Cgp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL2NvbnRhY3RzLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vY29udGFjdHMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIENvbnRhY3RFcnJvciA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0NvbnRhY3RFcnJvcicpLAogICAgdXRpbHMgPSByZXF1aXJlKCdjb3Jkb3ZhL3V0aWxzJyksCiAgICBDb250YWN0ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vQ29udGFjdCcpOwoKLyoqCiogUmVwcmVzZW50cyBhIGdyb3VwIG9mIENvbnRhY3RzLgoqIEBjb25zdHJ1Y3RvcgoqLwp2YXIgY29udGFjdHMgPSB7CiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgQ29udGFjdHMgbWF0Y2hpbmcgdGhlIHNlYXJjaCBjcml0ZXJpYS4KICAgICAqIEBwYXJhbSBmaWVsZHMgdGhhdCBzaG91bGQgYmUgc2VhcmNoZWQKICAgICAqIEBwYXJhbSBzdWNjZXNzQ0Igc3VjY2VzcyBjYWxsYmFjawogICAgICogQHBhcmFtIGVycm9yQ0IgZXJyb3IgY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7Q29udGFjdEZpbmRPcHRpb25zfSBvcHRpb25zIHRoYXQgY2FuIGJlIGFwcGxpZWQgdG8gY29udGFjdCBzZWFyY2hpbmcKICAgICAqIEByZXR1cm4gYXJyYXkgb2YgQ29udGFjdHMgbWF0Y2hpbmcgc2VhcmNoIGNyaXRlcmlhCiAgICAgKi8KICAgIGZpbmQ6ZnVuY3Rpb24oZmllbGRzLCBzdWNjZXNzQ0IsIGVycm9yQ0IsIG9wdGlvbnMpIHsKICAgICAgICBpZiAoIXN1Y2Nlc3NDQikgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJZb3UgbXVzdCBzcGVjaWZ5IGEgc3VjY2VzcyBjYWxsYmFjayBmb3IgdGhlIGZpbmQgY29tbWFuZC4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFmaWVsZHMgfHwgKHV0aWxzLmlzQXJyYXkoZmllbGRzKSAmJiBmaWVsZHMubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICBpZiAodHlwZW9mIGVycm9yQ0IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGVycm9yQ0IobmV3IENvbnRhY3RFcnJvcihDb250YWN0RXJyb3IuSU5WQUxJRF9BUkdVTUVOVF9FUlJPUikpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHdpbiA9IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgdmFyIGNzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJlc3VsdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjcy5wdXNoKGNvbnRhY3RzLmNyZWF0ZShyZXN1bHRbaV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN1Y2Nlc3NDQihjcyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGV4ZWMod2luLCBlcnJvckNCLCAiQ29udGFjdHMiLCAic2VhcmNoIiwgW2ZpZWxkcywgb3B0aW9uc10pOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYSBuZXcgY29udGFjdCwgYnV0IGl0IGRvZXMgbm90IHBlcnNpc3QgdGhlIGNvbnRhY3QKICAgICAqIHRvIGRldmljZSBzdG9yYWdlLiBUbyBwZXJzaXN0IHRoZSBjb250YWN0IHRvIGRldmljZSBzdG9yYWdlLCBpbnZva2UKICAgICAqIGNvbnRhY3Quc2F2ZSgpLgogICAgICogQHBhcmFtIHByb3BlcnRpZXMgYW4gb2JqZWN0IHdobydzIHByb3BlcnRpZXMgd2lsbCBiZSBleGFtaW5lZCB0byBjcmVhdGUgYSBuZXcgQ29udGFjdAogICAgICogQHJldHVybnMgbmV3IENvbnRhY3Qgb2JqZWN0CiAgICAgKi8KICAgIGNyZWF0ZTpmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIGNvbnRhY3QgPSBuZXcgQ29udGFjdCgpOwogICAgICAgIGZvciAoaSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGFjdFtpXSAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgY29udGFjdFtpXSA9IHByb3BlcnRpZXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbnRhY3Q7CiAgICB9Cn07Cgptb2R1bGUuZXhwb3J0cyA9IGNvbnRhY3RzOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9kZXZpY2UuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9kZXZpY2UiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGNoYW5uZWwgPSByZXF1aXJlKCdjb3Jkb3ZhL2NoYW5uZWwnKSwKICAgIHV0aWxzID0gcmVxdWlyZSgnY29yZG92YS91dGlscycpLAogICAgZXhlYyA9IHJlcXVpcmUoJ2NvcmRvdmEvZXhlYycpOwoKLy8gVGVsbCBjb3Jkb3ZhIGNoYW5uZWwgdG8gd2FpdCBvbiB0aGUgQ29yZG92YUluZm9SZWFkeSBldmVudApjaGFubmVsLndhaXRGb3JJbml0aWFsaXphdGlvbignb25Db3Jkb3ZhSW5mb1JlYWR5Jyk7CgovKioKICogVGhpcyByZXByZXNlbnRzIHRoZSBtb2JpbGUgZGV2aWNlLCBhbmQgcHJvdmlkZXMgcHJvcGVydGllcyBmb3IgaW5zcGVjdGluZyB0aGUgbW9kZWwsIHZlcnNpb24sIFVVSUQgb2YgdGhlCiAqIHBob25lLCBldGMuCiAqIEBjb25zdHJ1Y3RvcgogKi8KZnVuY3Rpb24gRGV2aWNlKCkgewogICAgdGhpcy5hdmFpbGFibGUgPSBmYWxzZTsKICAgIHRoaXMucGxhdGZvcm0gPSBudWxsOwogICAgdGhpcy52ZXJzaW9uID0gbnVsbDsKICAgIHRoaXMubmFtZSA9IG51bGw7CiAgICB0aGlzLnV1aWQgPSBudWxsOwogICAgdGhpcy5jb3Jkb3ZhID0gbnVsbDsKCiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIGNoYW5uZWwub25Db3Jkb3ZhUmVhZHkuc3Vic2NyaWJlT25jZShmdW5jdGlvbigpIHsKICAgICAgICBtZS5nZXRJbmZvKGZ1bmN0aW9uKGluZm8pIHsKICAgICAgICAgICAgbWUuYXZhaWxhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgbWUucGxhdGZvcm0gPSBpbmZvLnBsYXRmb3JtOwogICAgICAgICAgICBtZS52ZXJzaW9uID0gaW5mby52ZXJzaW9uOwogICAgICAgICAgICBtZS5uYW1lID0gaW5mby5uYW1lOwogICAgICAgICAgICBtZS51dWlkID0gaW5mby51dWlkOwogICAgICAgICAgICBtZS5jb3Jkb3ZhID0gaW5mby5jb3Jkb3ZhOwogICAgICAgICAgICBjaGFubmVsLm9uQ29yZG92YUluZm9SZWFkeS5maXJlKCk7CiAgICAgICAgfSxmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIG1lLmF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICB1dGlscy5hbGVydCgiW0VSUk9SXSBFcnJvciBpbml0aWFsaXppbmcgQ29yZG92YTogIiArIGUpOwogICAgICAgIH0pOwogICAgfSk7Cn0KCi8qKgogKiBHZXQgZGV2aWNlIGluZm8KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGhlYWRpbmcgZGF0YSBpcyBhdmFpbGFibGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIGdldHRpbmcgdGhlIGhlYWRpbmcgZGF0YS4gKE9QVElPTkFMKQogKi8KRGV2aWNlLnByb3RvdHlwZS5nZXRJbmZvID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CgogICAgLy8gc3VjY2Vzc0NhbGxiYWNrIHJlcXVpcmVkCiAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUubG9nKCJEZXZpY2UgRXJyb3I6IHN1Y2Nlc3NDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBlcnJvckNhbGxiYWNrIG9wdGlvbmFsCiAgICBpZiAoZXJyb3JDYWxsYmFjayAmJiAodHlwZW9mIGVycm9yQ2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgY29uc29sZS5sb2coIkRldmljZSBFcnJvcjogZXJyb3JDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBHZXQgaW5mbwogICAgZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJEZXZpY2UiLCAiZ2V0RGV2aWNlSW5mbyIsIFtdKTsKfTsKCm1vZHVsZS5leHBvcnRzID0gbmV3IERldmljZSgpOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9nZW9sb2NhdGlvbi5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL2dlb2xvY2F0aW9uIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciB1dGlscyA9IHJlcXVpcmUoJ2NvcmRvdmEvdXRpbHMnKSwKICAgIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIFBvc2l0aW9uRXJyb3IgPSByZXF1aXJlKCdjb3Jkb3ZhL3BsdWdpbi9Qb3NpdGlvbkVycm9yJyksCiAgICBQb3NpdGlvbiA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL1Bvc2l0aW9uJyk7Cgp2YXIgdGltZXJzID0ge307ICAgLy8gbGlzdCBvZiB0aW1lcnMgaW4gdXNlCgovLyBSZXR1cm5zIGRlZmF1bHQgcGFyYW1zLCBvdmVycmlkZXMgaWYgcHJvdmlkZWQgd2l0aCB2YWx1ZXMKZnVuY3Rpb24gcGFyc2VQYXJhbWV0ZXJzKG9wdGlvbnMpIHsKICAgIHZhciBvcHQgPSB7CiAgICAgICAgbWF4aW11bUFnZTogMCwKICAgICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IGZhbHNlLAogICAgICAgIHRpbWVvdXQ6IEluZmluaXR5CiAgICB9OwoKICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMubWF4aW11bUFnZSAhPT0gdW5kZWZpbmVkICYmICFpc05hTihvcHRpb25zLm1heGltdW1BZ2UpICYmIG9wdGlvbnMubWF4aW11bUFnZSA+IDApIHsKICAgICAgICAgICAgb3B0Lm1heGltdW1BZ2UgPSBvcHRpb25zLm1heGltdW1BZ2U7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmVuYWJsZUhpZ2hBY2N1cmFjeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG9wdC5lbmFibGVIaWdoQWNjdXJhY3kgPSBvcHRpb25zLmVuYWJsZUhpZ2hBY2N1cmFjeTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMudGltZW91dCAhPT0gdW5kZWZpbmVkICYmICFpc05hTihvcHRpb25zLnRpbWVvdXQpKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXQgPCAwKSB7CiAgICAgICAgICAgICAgICBvcHQudGltZW91dCA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcHQudGltZW91dCA9IG9wdGlvbnMudGltZW91dDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb3B0Owp9CgovLyBSZXR1cm5zIGEgdGltZW91dCBmYWlsdXJlLCBjbG9zZWQgb3ZlciBhIHNwZWNpZmllZCB0aW1lb3V0IHZhbHVlIGFuZCBlcnJvciBjYWxsYmFjay4KZnVuY3Rpb24gY3JlYXRlVGltZW91dChlcnJvckNhbGxiYWNrLCB0aW1lb3V0KSB7CiAgICB2YXIgdCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHQpOwogICAgICAgIHQgPSBudWxsOwogICAgICAgIGVycm9yQ2FsbGJhY2soewogICAgICAgICAgICBjb2RlOlBvc2l0aW9uRXJyb3IuVElNRU9VVCwKICAgICAgICAgICAgbWVzc2FnZToiUG9zaXRpb24gcmV0cmlldmFsIHRpbWVkIG91dC4iCiAgICAgICAgfSk7CiAgICB9LCB0aW1lb3V0KTsKICAgIHJldHVybiB0Owp9Cgp2YXIgZ2VvbG9jYXRpb24gPSB7CiAgICBsYXN0UG9zaXRpb246bnVsbCwgLy8gcmVmZXJlbmNlIHRvIGxhc3Qga25vd24gKGNhY2hlZCkgcG9zaXRpb24gcmV0dXJuZWQKICAgIC8qKgogICAqIEFzeW5jaHJvbm91c2x5IGFxdWlyZXMgdGhlIGN1cnJlbnQgcG9zaXRpb24uCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgcG9zaXRpb24gZGF0YSBpcyBhdmFpbGFibGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrICAgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBoZWFkaW5nIHBvc2l0aW9uLiAoT1BUSU9OQUwpCiAgICogQHBhcmFtIHtQb3NpdGlvbk9wdGlvbnN9IG9wdGlvbnMgICAgIFRoZSBvcHRpb25zIGZvciBnZXR0aW5nIHRoZSBwb3NpdGlvbiBkYXRhLiAoT1BUSU9OQUwpCiAgICovCiAgICBnZXRDdXJyZW50UG9zaXRpb246ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJnZXRDdXJyZW50UG9zaXRpb24gbXVzdCBiZSBjYWxsZWQgd2l0aCBhdCBsZWFzdCBvbmUgYXJndW1lbnQuIik7CiAgICAgICAgfQogICAgICAgIG9wdGlvbnMgPSBwYXJzZVBhcmFtZXRlcnMob3B0aW9ucyk7CgogICAgICAgIC8vIFRpbWVyIHZhciB0aGF0IHdpbGwgZmlyZSBhbiBlcnJvciBjYWxsYmFjayBpZiBubyBwb3NpdGlvbiBpcyByZXRyaWV2ZWQgZnJvbSBuYXRpdmUKICAgICAgICAvLyBiZWZvcmUgdGhlICJ0aW1lb3V0IiBwYXJhbSBwcm92aWRlZCBleHBpcmVzCiAgICAgICAgdmFyIHRpbWVvdXRUaW1lciA9IG51bGw7CgogICAgICAgIHZhciB3aW4gPSBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0VGltZXIpOwogICAgICAgICAgICBpZiAoIXRpbWVvdXRUaW1lcikgewogICAgICAgICAgICAgICAgLy8gVGltZW91dCBhbHJlYWR5IGhhcHBlbmVkLCBvciBuYXRpdmUgZmlyZWQgZXJyb3IgY2FsbGJhY2sgZm9yCiAgICAgICAgICAgICAgICAvLyB0aGlzIGdlbyByZXF1ZXN0LgogICAgICAgICAgICAgICAgLy8gRG9uJ3QgY29udGludWUgd2l0aCBzdWNjZXNzIGNhbGxiYWNrLgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwb3MgPSBuZXcgUG9zaXRpb24oCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6cC5sYXRpdHVkZSwKICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6cC5sb25naXR1ZGUsCiAgICAgICAgICAgICAgICAgICAgYWx0aXR1ZGU6cC5hbHRpdHVkZSwKICAgICAgICAgICAgICAgICAgICBhY2N1cmFjeTpwLmFjY3VyYWN5LAogICAgICAgICAgICAgICAgICAgIGhlYWRpbmc6cC5oZWFkaW5nLAogICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5OnAudmVsb2NpdHksCiAgICAgICAgICAgICAgICAgICAgYWx0aXR1ZGVBY2N1cmFjeTpwLmFsdGl0dWRlQWNjdXJhY3kKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAocC50aW1lc3RhbXAgPT09IHVuZGVmaW5lZCA/IG5ldyBEYXRlKCkgOiAoKHAudGltZXN0YW1wIGluc3RhbmNlb2YgRGF0ZSkgPyBwLnRpbWVzdGFtcCA6IG5ldyBEYXRlKHAudGltZXN0YW1wKSkpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGdlb2xvY2F0aW9uLmxhc3RQb3NpdGlvbiA9IHBvczsKICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHBvcyk7CiAgICAgICAgfTsKICAgICAgICB2YXIgZmFpbCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRUaW1lcik7CiAgICAgICAgICAgIHRpbWVvdXRUaW1lciA9IG51bGw7CiAgICAgICAgICAgIHZhciBlcnIgPSBuZXcgUG9zaXRpb25FcnJvcihlLmNvZGUsIGUubWVzc2FnZSk7CiAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLyBDaGVjayBvdXIgY2FjaGVkIHBvc2l0aW9uLCBpZiBpdHMgdGltZXN0YW1wIGRpZmZlcmVuY2Ugd2l0aCBjdXJyZW50IHRpbWUgaXMgbGVzcyB0aGFuIHRoZSBtYXhpbXVtQWdlLCB0aGVuIGp1c3QKICAgICAgICAvLyBmaXJlIHRoZSBzdWNjZXNzIGNhbGxiYWNrIHdpdGggdGhlIGNhY2hlZCBwb3NpdGlvbi4KICAgICAgICBpZiAoZ2VvbG9jYXRpb24ubGFzdFBvc2l0aW9uICYmIG9wdGlvbnMubWF4aW11bUFnZSAmJiAoKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLSBnZW9sb2NhdGlvbi5sYXN0UG9zaXRpb24udGltZXN0YW1wLmdldFRpbWUoKSkgPD0gb3B0aW9ucy5tYXhpbXVtQWdlKSkgewogICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soZ2VvbG9jYXRpb24ubGFzdFBvc2l0aW9uKTsKICAgICAgICAvLyBJZiB0aGUgY2FjaGVkIHBvc2l0aW9uIGNoZWNrIGZhaWxlZCBhbmQgdGhlIHRpbWVvdXQgd2FzIHNldCB0byAwLCBlcnJvciBvdXQgd2l0aCBhIFRJTUVPVVQgZXJyb3Igb2JqZWN0LgogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy50aW1lb3V0ID09PSAwKSB7CiAgICAgICAgICAgIGZhaWwoewogICAgICAgICAgICAgICAgY29kZTpQb3NpdGlvbkVycm9yLlRJTUVPVVQsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiJ0aW1lb3V0IHZhbHVlIGluIFBvc2l0aW9uT3B0aW9ucyBzZXQgdG8gMCBhbmQgbm8gY2FjaGVkIFBvc2l0aW9uIG9iamVjdCBhdmFpbGFibGUsIG9yIGNhY2hlZCBQb3NpdGlvbiBvYmplY3QncyBhZ2UgZXhjZWVkJ3MgcHJvdmlkZWQgUG9zaXRpb25PcHRpb25zJyBtYXhpbXVtQWdlIHBhcmFtZXRlci4iCiAgICAgICAgICAgIH0pOwogICAgICAgIC8vIE90aGVyd2lzZSB3ZSBoYXZlIHRvIGNhbGwgaW50byBuYXRpdmUgdG8gcmV0cmlldmUgYSBwb3NpdGlvbi4KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0ICE9PSBJbmZpbml0eSkgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRpbWVvdXQgdmFsdWUgd2FzIG5vdCBzZXQgdG8gSW5maW5pdHkgKGRlZmF1bHQpLCB0aGVuCiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgYSB0aW1lb3V0IGZ1bmN0aW9uIHRoYXQgd2lsbCBmaXJlIHRoZSBlcnJvciBjYWxsYmFjawogICAgICAgICAgICAgICAgLy8gaWYgbm8gc3VjY2Vzc2Z1bCBwb3NpdGlvbiB3YXMgcmV0cmlldmVkIGJlZm9yZSB0aW1lb3V0IGV4cGlyZWQuCiAgICAgICAgICAgICAgICB0aW1lb3V0VGltZXIgPSBjcmVhdGVUaW1lb3V0KGZhaWwsIG9wdGlvbnMudGltZW91dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGhlcmUgc28gdGhlIGNoZWNrIGluIHRoZSB3aW4gZnVuY3Rpb24gZG9lc24ndCBtZXNzIHN0dWZmIHVwCiAgICAgICAgICAgICAgICAvLyBtYXkgc2VlbSB3ZWlyZCBidXQgdGhpcyBndWFyYW50ZWVzIHRpbWVvdXRUaW1lciBpcwogICAgICAgICAgICAgICAgLy8gYWx3YXlzIHRydXRoeSBiZWZvcmUgd2UgY2FsbCBpbnRvIG5hdGl2ZQogICAgICAgICAgICAgICAgdGltZW91dFRpbWVyID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBleGVjKHdpbiwgZmFpbCwgIkdlb2xvY2F0aW9uIiwgImdldExvY2F0aW9uIiwgW29wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5LCBvcHRpb25zLm1heGltdW1BZ2VdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRpbWVvdXRUaW1lcjsKICAgIH0sCiAgICAvKioKICAgICAqIEFzeW5jaHJvbm91c2x5IHdhdGNoZXMgdGhlIGdlb2xvY2F0aW9uIGZvciBjaGFuZ2VzIHRvIGdlb2xvY2F0aW9uLiAgV2hlbiBhIGNoYW5nZSBvY2N1cnMsCiAgICAgKiB0aGUgc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgbG9jYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIGVhY2ggdGltZSB0aGUgbG9jYXRpb24gZGF0YSBpcyBhdmFpbGFibGUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgICAgICBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIGdldHRpbmcgdGhlIGxvY2F0aW9uIGRhdGEuIChPUFRJT05BTCkKICAgICAqIEBwYXJhbSB7UG9zaXRpb25PcHRpb25zfSBvcHRpb25zICAgICBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgbG9jYXRpb24gZGF0YSBzdWNoIGFzIGZyZXF1ZW5jeS4gKE9QVElPTkFMKQogICAgICogQHJldHVybiBTdHJpbmcgICAgICAgICAgICAgICAgICAgICAgIFRoZSB3YXRjaCBpZCB0aGF0IG11c3QgYmUgcGFzc2VkIHRvICNjbGVhcldhdGNoIHRvIHN0b3Agd2F0Y2hpbmcuCiAgICAgKi8KICAgIHdhdGNoUG9zaXRpb246ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ3YXRjaFBvc2l0aW9uIG11c3QgYmUgY2FsbGVkIHdpdGggYXQgbGVhc3Qgb25lIGFyZ3VtZW50LiIpOwogICAgICAgIH0KICAgICAgICBvcHRpb25zID0gcGFyc2VQYXJhbWV0ZXJzKG9wdGlvbnMpOwoKICAgICAgICB2YXIgaWQgPSB1dGlscy5jcmVhdGVVVUlEKCk7CgogICAgICAgIC8vIFRlbGwgZGV2aWNlIHRvIGdldCBhIHBvc2l0aW9uIEFTQVAsIGFuZCBhbHNvIHJldHJpZXZlIGEgcmVmZXJlbmNlIHRvIHRoZSB0aW1lb3V0IHRpbWVyIGdlbmVyYXRlZCBpbiBnZXRDdXJyZW50UG9zaXRpb24KICAgICAgICB0aW1lcnNbaWRdID0gZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucyk7CgogICAgICAgIHZhciBmYWlsID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJzW2lkXSk7CiAgICAgICAgICAgIHZhciBlcnIgPSBuZXcgUG9zaXRpb25FcnJvcihlLmNvZGUsIGUubWVzc2FnZSk7CiAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgd2luID0gZnVuY3Rpb24ocCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJzW2lkXSk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXQgIT09IEluZmluaXR5KSB7CiAgICAgICAgICAgICAgICB0aW1lcnNbaWRdID0gY3JlYXRlVGltZW91dChmYWlsLCBvcHRpb25zLnRpbWVvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwb3MgPSBuZXcgUG9zaXRpb24oCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6cC5sYXRpdHVkZSwKICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6cC5sb25naXR1ZGUsCiAgICAgICAgICAgICAgICAgICAgYWx0aXR1ZGU6cC5hbHRpdHVkZSwKICAgICAgICAgICAgICAgICAgICBhY2N1cmFjeTpwLmFjY3VyYWN5LAogICAgICAgICAgICAgICAgICAgIGhlYWRpbmc6cC5oZWFkaW5nLAogICAgICAgICAgICAgICAgICAgIHZlbG9jaXR5OnAudmVsb2NpdHksCiAgICAgICAgICAgICAgICAgICAgYWx0aXR1ZGVBY2N1cmFjeTpwLmFsdGl0dWRlQWNjdXJhY3kKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAocC50aW1lc3RhbXAgPT09IHVuZGVmaW5lZCA/IG5ldyBEYXRlKCkgOiAoKHAudGltZXN0YW1wIGluc3RhbmNlb2YgRGF0ZSkgPyBwLnRpbWVzdGFtcCA6IG5ldyBEYXRlKHAudGltZXN0YW1wKSkpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGdlb2xvY2F0aW9uLmxhc3RQb3NpdGlvbiA9IHBvczsKICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHBvcyk7CiAgICAgICAgfTsKCiAgICAgICAgZXhlYyh3aW4sIGZhaWwsICJHZW9sb2NhdGlvbiIsICJhZGRXYXRjaCIsIFtpZCwgb3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3ldKTsKCiAgICAgICAgcmV0dXJuIGlkOwogICAgfSwKICAgIC8qKgogICAgICogQ2xlYXJzIHRoZSBzcGVjaWZpZWQgaGVhZGluZyB3YXRjaC4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgICAgICAgVGhlIElEIG9mIHRoZSB3YXRjaCByZXR1cm5lZCBmcm9tICN3YXRjaFBvc2l0aW9uCiAgICAgKi8KICAgIGNsZWFyV2F0Y2g6ZnVuY3Rpb24oaWQpIHsKICAgICAgICBpZiAoaWQgJiYgdGltZXJzW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcnNbaWRdKTsKICAgICAgICAgICAgZGVsZXRlIHRpbWVyc1tpZF07CiAgICAgICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgIkdlb2xvY2F0aW9uIiwgImNsZWFyV2F0Y2giLCBbaWRdKTsKICAgICAgICB9CiAgICB9Cn07Cgptb2R1bGUuZXhwb3J0cyA9IGdlb2xvY2F0aW9uOwoKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9sb2dnZXIuanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9sb2dnZXIiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gVGhlIGxvZ2dlciBtb2R1bGUgZXhwb3J0cyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMvZnVuY3Rpb25zOgovLwovLyBMT0cgICAgICAgICAgICAgICAgICAgICAgICAgIC0gY29uc3RhbnQgZm9yIHRoZSBsZXZlbCBMT0cKLy8gRVJST1IgICAgICAgICAgICAgICAgICAgICAgICAtIGNvbnN0YW50IGZvciB0aGUgbGV2ZWwgRVJST1IKLy8gV0FSTiAgICAgICAgICAgICAgICAgICAgICAgICAtIGNvbnN0YW50IGZvciB0aGUgbGV2ZWwgV0FSTgovLyBJTkZPICAgICAgICAgICAgICAgICAgICAgICAgIC0gY29uc3RhbnQgZm9yIHRoZSBsZXZlbCBJTkZPCi8vIERFQlVHICAgICAgICAgICAgICAgICAgICAgICAgLSBjb25zdGFudCBmb3IgdGhlIGxldmVsIERFQlVHCi8vIGxvZ0xldmVsKCkgICAgICAgICAgICAgICAgICAgLSByZXR1cm5zIGN1cnJlbnQgbG9nIGxldmVsCi8vIGxvZ0xldmVsKHZhbHVlKSAgICAgICAgICAgICAgLSBzZXRzIGFuZCByZXR1cm5zIGEgbmV3IGxvZyBsZXZlbAovLyB1c2VDb25zb2xlKCkgICAgICAgICAgICAgICAgIC0gcmV0dXJucyB3aGV0aGVyIGxvZ2dlciBpcyB1c2luZyBjb25zb2xlCi8vIHVzZUNvbnNvbGUodmFsdWUpICAgICAgICAgICAgLSBzZXRzIGFuZCByZXR1cm5zIHdoZXRoZXIgbG9nZ2VyIGlzIHVzaW5nIGNvbnNvbGUKLy8gbG9nKG1lc3NhZ2UsLi4uKSAgICAgICAgICAgICAtIGxvZ3MgYSBtZXNzYWdlIGF0IGxldmVsIExPRwovLyBlcnJvcihtZXNzYWdlLC4uLikgICAgICAgICAgIC0gbG9ncyBhIG1lc3NhZ2UgYXQgbGV2ZWwgRVJST1IKLy8gd2FybihtZXNzYWdlLC4uLikgICAgICAgICAgICAtIGxvZ3MgYSBtZXNzYWdlIGF0IGxldmVsIFdBUk4KLy8gaW5mbyhtZXNzYWdlLC4uLikgICAgICAgICAgICAtIGxvZ3MgYSBtZXNzYWdlIGF0IGxldmVsIElORk8KLy8gZGVidWcobWVzc2FnZSwuLi4pICAgICAgICAgICAtIGxvZ3MgYSBtZXNzYWdlIGF0IGxldmVsIERFQlVHCi8vIGxvZ0xldmVsKGxldmVsLG1lc3NhZ2UsLi4uKSAgLSBsb2dzIGEgbWVzc2FnZSBzcGVjaWZpZWQgbGV2ZWwKLy8KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCnZhciBsb2dnZXIgPSBleHBvcnRzOwoKdmFyIGV4ZWMgICAgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKdmFyIHV0aWxzICAgPSByZXF1aXJlKCdjb3Jkb3ZhL3V0aWxzJyk7Cgp2YXIgVXNlQ29uc29sZSAgID0gdHJ1ZTsKdmFyIFF1ZXVlZCAgICAgICA9IFtdOwp2YXIgRGV2aWNlUmVhZHkgID0gZmFsc2U7CnZhciBDdXJyZW50TGV2ZWw7CgovKioKICogTG9nZ2luZyBsZXZlbHMKICovCgp2YXIgTGV2ZWxzID0gWwogICAgIkxPRyIsCiAgICAiRVJST1IiLAogICAgIldBUk4iLAogICAgIklORk8iLAogICAgIkRFQlVHIgpdOwoKLyoKICogYWRkIHRoZSBsb2dnaW5nIGxldmVscyB0byB0aGUgbG9nZ2VyIG9iamVjdCBhbmQKICogdG8gYSBzZXBhcmF0ZSBsZXZlbHNNYXAgb2JqZWN0IGZvciB0ZXN0aW5nCiAqLwoKdmFyIExldmVsc01hcCA9IHt9Owpmb3IgKHZhciBpPTA7IGk8TGV2ZWxzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgbGV2ZWwgPSBMZXZlbHNbaV07CiAgICBMZXZlbHNNYXBbbGV2ZWxdID0gaTsKICAgIGxvZ2dlcltsZXZlbF0gICAgPSBsZXZlbDsKfQoKQ3VycmVudExldmVsID0gTGV2ZWxzTWFwLldBUk47CgovKioKICogR2V0dGVyL1NldHRlciBmb3IgdGhlIGxvZ2dpbmcgbGV2ZWwKICoKICogUmV0dXJucyB0aGUgY3VycmVudCBsb2dnaW5nIGxldmVsLgogKgogKiBXaGVuIGEgdmFsdWUgaXMgcGFzc2VkLCBzZXRzIHRoZSBsb2dnaW5nIGxldmVsIHRvIHRoYXQgdmFsdWUuCiAqIFRoZSB2YWx1ZXMgc2hvdWxkIGJlIG9uZSBvZiB0aGUgZm9sbG93aW5nIGNvbnN0YW50czoKICogICAgbG9nZ2VyLkxPRwogKiAgICBsb2dnZXIuRVJST1IKICogICAgbG9nZ2VyLldBUk4KICogICAgbG9nZ2VyLklORk8KICogICAgbG9nZ2VyLkRFQlVHCiAqCiAqIFRoZSB2YWx1ZSB1c2VkIGRldGVybWluZXMgd2hpY2ggbWVzc2FnZXMgZ2V0IHByaW50ZWQuICBUaGUgbG9nZ2luZwogKiB2YWx1ZXMgYWJvdmUgYXJlIGluIG9yZGVyLCBhbmQgb25seSBtZXNzYWdlcyBsb2dnZWQgYXQgdGhlIGxvZ2dpbmcKICogbGV2ZWwgb3IgYWJvdmUgd2lsbCBhY3R1YWxseSBiZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIuICBFZywgdGhlCiAqIGRlZmF1bHQgbGV2ZWwgaXMgV0FSTiwgc28gb25seSBtZXNzYWdlcyBsb2dnZWQgd2l0aCBMT0csIEVSUk9SLCBvcgogKiBXQVJOIHdpbGwgYmUgZGlzcGxheWVkOyBJTkZPIGFuZCBERUJVRyBtZXNzYWdlcyB3aWxsIGJlIGlnbm9yZWQuCiAqLwpsb2dnZXIubGV2ZWwgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgaWYgKExldmVsc01hcFt2YWx1ZV0gPT09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGxvZ2dpbmcgbGV2ZWw6ICIgKyB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIEN1cnJlbnRMZXZlbCA9IExldmVsc01hcFt2YWx1ZV07CiAgICB9CgogICAgcmV0dXJuIExldmVsc1tDdXJyZW50TGV2ZWxdOwp9OwoKLyoqCiAqIEdldHRlci9TZXR0ZXIgZm9yIHRoZSB1c2VDb25zb2xlIGZ1bmN0aW9uYWxpdHkKICoKICogV2hlbiB1c2VDb25zb2xlIGlzIHRydWUsIHRoZSBsb2dnZXIgd2lsbCBsb2cgdmlhIHRoZQogKiBicm93c2VyICdjb25zb2xlJyBvYmplY3QuICBPdGhlcndpc2UsIGl0IHdpbGwgdXNlIHRoZQogKiBuYXRpdmUgTG9nZ2VyIHBsdWdpbi4KICovCmxvZ2dlci51c2VDb25zb2xlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkgVXNlQ29uc29sZSA9ICEhdmFsdWU7CgogICAgaWYgKFVzZUNvbnNvbGUpIHsKICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJnbG9iYWwgY29uc29sZSBvYmplY3QgaXMgbm90IGRlZmluZWQiKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29uc29sZS5sb2cgIT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImdsb2JhbCBjb25zb2xlIG9iamVjdCBkb2VzIG5vdCBoYXZlIGEgbG9nIGZ1bmN0aW9uIik7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUudXNlTG9nZ2VyID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgaWYgKGNvbnNvbGUudXNlTG9nZ2VyKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY29uc29sZSBhbmQgbG9nZ2VyIGFyZSB0b28gaW50ZXJ0d2luZ2x5Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIFVzZUNvbnNvbGU7Cn07CgovKioKICogTG9ncyBhIG1lc3NhZ2UgYXQgdGhlIExPRyBsZXZlbC4KICoKICogUGFyYW1ldGVycyBwYXNzZWQgYWZ0ZXIgbWVzc2FnZSBhcmUgdXNlZCBhcHBsaWVkIHRvCiAqIHRoZSBtZXNzYWdlIHdpdGggdXRpbHMuZm9ybWF0KCkKICovCmxvZ2dlci5sb2cgICA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHsgbG9nV2l0aEFyZ3MoIkxPRyIsICAgYXJndW1lbnRzKTsgfTsKCi8qKgogKiBMb2dzIGEgbWVzc2FnZSBhdCB0aGUgRVJST1IgbGV2ZWwuCiAqCiAqIFBhcmFtZXRlcnMgcGFzc2VkIGFmdGVyIG1lc3NhZ2UgYXJlIHVzZWQgYXBwbGllZCB0bwogKiB0aGUgbWVzc2FnZSB3aXRoIHV0aWxzLmZvcm1hdCgpCiAqLwpsb2dnZXIuZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7IGxvZ1dpdGhBcmdzKCJFUlJPUiIsIGFyZ3VtZW50cyk7IH07CgovKioKICogTG9ncyBhIG1lc3NhZ2UgYXQgdGhlIFdBUk4gbGV2ZWwuCiAqCiAqIFBhcmFtZXRlcnMgcGFzc2VkIGFmdGVyIG1lc3NhZ2UgYXJlIHVzZWQgYXBwbGllZCB0bwogKiB0aGUgbWVzc2FnZSB3aXRoIHV0aWxzLmZvcm1hdCgpCiAqLwpsb2dnZXIud2FybiAgPSBmdW5jdGlvbihtZXNzYWdlKSB7IGxvZ1dpdGhBcmdzKCJXQVJOIiwgIGFyZ3VtZW50cyk7IH07CgovKioKICogTG9ncyBhIG1lc3NhZ2UgYXQgdGhlIElORk8gbGV2ZWwuCiAqCiAqIFBhcmFtZXRlcnMgcGFzc2VkIGFmdGVyIG1lc3NhZ2UgYXJlIHVzZWQgYXBwbGllZCB0bwogKiB0aGUgbWVzc2FnZSB3aXRoIHV0aWxzLmZvcm1hdCgpCiAqLwpsb2dnZXIuaW5mbyAgPSBmdW5jdGlvbihtZXNzYWdlKSB7IGxvZ1dpdGhBcmdzKCJJTkZPIiwgIGFyZ3VtZW50cyk7IH07CgovKioKICogTG9ncyBhIG1lc3NhZ2UgYXQgdGhlIERFQlVHIGxldmVsLgogKgogKiBQYXJhbWV0ZXJzIHBhc3NlZCBhZnRlciBtZXNzYWdlIGFyZSB1c2VkIGFwcGxpZWQgdG8KICogdGhlIG1lc3NhZ2Ugd2l0aCB1dGlscy5mb3JtYXQoKQogKi8KbG9nZ2VyLmRlYnVnID0gZnVuY3Rpb24obWVzc2FnZSkgeyBsb2dXaXRoQXJncygiREVCVUciLCBhcmd1bWVudHMpOyB9OwoKLy8gbG9nIGF0IHRoZSBzcGVjaWZpZWQgbGV2ZWwgd2l0aCBhcmdzCmZ1bmN0aW9uIGxvZ1dpdGhBcmdzKGxldmVsLCBhcmdzKSB7CiAgICBhcmdzID0gW2xldmVsXS5jb25jYXQoW10uc2xpY2UuY2FsbChhcmdzKSk7CiAgICBsb2dnZXIubG9nTGV2ZWwuYXBwbHkobG9nZ2VyLCBhcmdzKTsKfQoKLyoqCiAqIExvZ3MgYSBtZXNzYWdlIGF0IHRoZSBzcGVjaWZpZWQgbGV2ZWwuCiAqCiAqIFBhcmFtZXRlcnMgcGFzc2VkIGFmdGVyIG1lc3NhZ2UgYXJlIHVzZWQgYXBwbGllZCB0bwogKiB0aGUgbWVzc2FnZSB3aXRoIHV0aWxzLmZvcm1hdCgpCiAqLwpsb2dnZXIubG9nTGV2ZWwgPSBmdW5jdGlvbihsZXZlbCwgbWVzc2FnZSAvKiAsIC4uLiAqLykgewogICAgLy8gZm9ybWF0IHRoZSBtZXNzYWdlIHdpdGggdGhlIHBhcmFtZXRlcnMKICAgIHZhciBmb3JtYXRBcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgbWVzc2FnZSAgICA9IHV0aWxzLnZmb3JtYXQobWVzc2FnZSwgZm9ybWF0QXJncyk7CgogICAgaWYgKExldmVsc01hcFtsZXZlbF0gPT09IG51bGwpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbG9nZ2luZyBsZXZlbDogIiArIGxldmVsKTsKICAgIH0KCiAgICBpZiAoTGV2ZWxzTWFwW2xldmVsXSA+IEN1cnJlbnRMZXZlbCkgcmV0dXJuOwoKICAgIC8vIHF1ZXVlIHRoZSBtZXNzYWdlIGlmIG5vdCB5ZXQgYXQgZGV2aWNlcmVhZHkKICAgIGlmICghRGV2aWNlUmVhZHkgJiYgIVVzZUNvbnNvbGUpIHsKICAgICAgICBRdWV1ZWQucHVzaChbbGV2ZWwsIG1lc3NhZ2VdKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gaWYgbm90IHVzaW5nIHRoZSBjb25zb2xlLCB1c2UgdGhlIG5hdGl2ZSBsb2dnZXIKICAgIGlmICghVXNlQ29uc29sZSkgewogICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgIkxvZ2dlciIsICJsb2dMZXZlbCIsIFtsZXZlbCwgbWVzc2FnZV0pOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBtYWtlIHN1cmUgY29uc29sZSBpcyBub3QgdXNpbmcgbG9nZ2VyCiAgICBpZiAoY29uc29sZS5fX3VzaW5nQ29yZG92YUxvZ2dlcikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiY29uc29sZSBhbmQgbG9nZ2VyIGFyZSB0b28gaW50ZXJ0d2luZ2x5Iik7CiAgICB9CgogICAgLy8gbG9nIHRvIHRoZSBjb25zb2xlCiAgICBzd2l0Y2ggKGxldmVsKSB7CiAgICAgICAgY2FzZSBsb2dnZXIuTE9HOiAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpOyBicmVhazsKICAgICAgICBjYXNlIGxvZ2dlci5FUlJPUjogY29uc29sZS5sb2coIkVSUk9SOiAiICsgbWVzc2FnZSk7IGJyZWFrOwogICAgICAgIGNhc2UgbG9nZ2VyLldBUk46ICBjb25zb2xlLmxvZygiV0FSTjogIiAgKyBtZXNzYWdlKTsgYnJlYWs7CiAgICAgICAgY2FzZSBsb2dnZXIuSU5GTzogIGNvbnNvbGUubG9nKCJJTkZPOiAiICArIG1lc3NhZ2UpOyBicmVhazsKICAgICAgICBjYXNlIGxvZ2dlci5ERUJVRzogY29uc29sZS5sb2coIkRFQlVHOiAiICsgbWVzc2FnZSk7IGJyZWFrOwogICAgfQp9OwoKLy8gd2hlbiBkZXZpY2VyZWFkeSBmaXJlcywgbG9nIHF1ZXVlZCBtZXNzYWdlcwpsb2dnZXIuX19vbkRldmljZVJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoRGV2aWNlUmVhZHkpIHJldHVybjsKCiAgICBEZXZpY2VSZWFkeSA9IHRydWU7CgogICAgZm9yICh2YXIgaT0wOyBpPFF1ZXVlZC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBtZXNzYWdlQXJncyA9IFF1ZXVlZFtpXTsKICAgICAgICBsb2dnZXIubG9nTGV2ZWwobWVzc2FnZUFyZ3NbMF0sIG1lc3NhZ2VBcmdzWzFdKTsKICAgIH0KCiAgICBRdWV1ZWQgPSBudWxsOwp9OwoKLy8gYWRkIGEgZGV2aWNlcmVhZHkgZXZlbnQgdG8gbG9nIHF1ZXVlZCBtZXNzYWdlcwpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJkZXZpY2VyZWFkeSIsIGxvZ2dlci5fX29uRGV2aWNlUmVhZHksIGZhbHNlKTsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vbmV0d29yay5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL25ldHdvcmsiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKSwKICAgIGNvcmRvdmEgPSByZXF1aXJlKCdjb3Jkb3ZhJyksCiAgICBjaGFubmVsID0gcmVxdWlyZSgnY29yZG92YS9jaGFubmVsJyk7Cgp2YXIgTmV0d29ya0Nvbm5lY3Rpb24gPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnR5cGUgPSBudWxsOwogICAgdGhpcy5fZmlyc3RSdW4gPSB0cnVlOwogICAgdGhpcy5fdGltZXIgPSBudWxsOwogICAgdGhpcy50aW1lb3V0ID0gNTAwOwoKICAgIHZhciBtZSA9IHRoaXM7CgogICAgY2hhbm5lbC5vbkNvcmRvdmFSZWFkeS5zdWJzY3JpYmVPbmNlKGZ1bmN0aW9uKCkgewogICAgICAgIG1lLmdldEluZm8oZnVuY3Rpb24gKGluZm8pIHsKICAgICAgICAgICAgbWUudHlwZSA9IGluZm87CiAgICAgICAgICAgIGlmIChpbmZvID09PSAibm9uZSIpIHsKICAgICAgICAgICAgICAgIC8vIHNldCBhIHRpbWVyIGlmIHN0aWxsIG9mZmxpbmUgYXQgdGhlIGVuZCBvZiB0aW1lciBzZW5kIHRoZSBvZmZsaW5lIGV2ZW50CiAgICAgICAgICAgICAgICBtZS5fdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5maXJlRG9jdW1lbnRFdmVudCgib2ZmbGluZSIpOwogICAgICAgICAgICAgICAgICAgIG1lLl90aW1lciA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSwgbWUudGltZW91dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIGN1cnJlbnQgb2ZmbGluZSBldmVudCBwZW5kaW5nIGNsZWFyIGl0CiAgICAgICAgICAgICAgICBpZiAobWUuX3RpbWVyICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1lLl90aW1lcik7CiAgICAgICAgICAgICAgICAgICAgbWUuX3RpbWVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvcmRvdmEuZmlyZURvY3VtZW50RXZlbnQoIm9ubGluZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzaG91bGQgb25seSBmaXJlIHRoaXMgb25jZQogICAgICAgICAgICBpZiAobWUuX2ZpcnN0UnVuKSB7CiAgICAgICAgICAgICAgICBtZS5fZmlyc3RSdW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNoYW5uZWwub25Db3Jkb3ZhQ29ubmVjdGlvblJlYWR5LmZpcmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgLy8gSWYgd2UgY2FuJ3QgZ2V0IHRoZSBuZXR3b3JrIGluZm8gd2Ugc2hvdWxkIHN0aWxsIHRlbGwgQ29yZG92YQogICAgICAgICAgICAvLyB0byBmaXJlIHRoZSBkZXZpY2VyZWFkeSBldmVudC4KICAgICAgICAgICAgaWYgKG1lLl9maXJzdFJ1bikgewogICAgICAgICAgICAgICAgbWUuX2ZpcnN0UnVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICBjaGFubmVsLm9uQ29yZG92YUNvbm5lY3Rpb25SZWFkeS5maXJlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc29sZS5sb2coIkVycm9yIGluaXRpYWxpemluZyBOZXR3b3JrIENvbm5lY3Rpb246ICIgKyBlKTsKICAgICAgICB9KTsKICAgIH0pOwp9OwoKLyoqCiAqIEdldCBjb25uZWN0aW9uIGluZm8KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIENvbm5lY3Rpb24gZGF0YSBpcyBhdmFpbGFibGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIGdldHRpbmcgdGhlIENvbm5lY3Rpb24gZGF0YS4gKE9QVElPTkFMKQogKi8KTmV0d29ya0Nvbm5lY3Rpb24ucHJvdG90eXBlLmdldEluZm8gPSBmdW5jdGlvbiAoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICAvLyBHZXQgaW5mbwogICAgZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJOZXR3b3JrU3RhdHVzIiwgImdldENvbm5lY3Rpb25JbmZvIiwgW10pOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBuZXcgTmV0d29ya0Nvbm5lY3Rpb24oKTsKfSk7CgovLyBmaWxlOiBsaWIvY29tbW9uL3BsdWdpbi9ub3RpZmljYXRpb24uanMKZGVmaW5lKCJjb3Jkb3ZhL3BsdWdpbi9ub3RpZmljYXRpb24iLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKCi8qKgogKiBQcm92aWRlcyBhY2Nlc3MgdG8gbm90aWZpY2F0aW9ucyBvbiB0aGUgZGV2aWNlLgogKi8KCm1vZHVsZS5leHBvcnRzID0gewoKICAgIC8qKgogICAgICogT3BlbiBhIG5hdGl2ZSBhbGVydCBkaWFsb2csIHdpdGggYSBjdXN0b21pemFibGUgdGl0bGUgYW5kIGJ1dHRvbiB0ZXh0LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlICAgICAgICAgICAgICBNZXNzYWdlIHRvIHByaW50IGluIHRoZSBib2R5IG9mIHRoZSBhbGVydAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29tcGxldGVDYWxsYmFjayAgIFRoZSBjYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIHVzZXIgY2xpY2tzIG9uIGEgYnV0dG9uLgogICAgICogQHBhcmFtIHtTdHJpbmd9IHRpdGxlICAgICAgICAgICAgICAgIFRpdGxlIG9mIHRoZSBhbGVydCBkaWFsb2cgKGRlZmF1bHQ6IEFsZXJ0KQogICAgICogQHBhcmFtIHtTdHJpbmd9IGJ1dHRvbkxhYmVsICAgICAgICAgIExhYmVsIG9mIHRoZSBjbG9zZSBidXR0b24gKGRlZmF1bHQ6IE9LKQogICAgICovCiAgICBhbGVydDogZnVuY3Rpb24obWVzc2FnZSwgY29tcGxldGVDYWxsYmFjaywgdGl0bGUsIGJ1dHRvbkxhYmVsKSB7CiAgICAgICAgdmFyIF90aXRsZSA9ICh0aXRsZSB8fCAiQWxlcnQiKTsKICAgICAgICB2YXIgX2J1dHRvbkxhYmVsID0gKGJ1dHRvbkxhYmVsIHx8ICJPSyIpOwogICAgICAgIGV4ZWMoY29tcGxldGVDYWxsYmFjaywgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJhbGVydCIsIFttZXNzYWdlLCBfdGl0bGUsIF9idXR0b25MYWJlbF0pOwogICAgfSwKCiAgICAvKioKICAgICAqIE9wZW4gYSBuYXRpdmUgY29uZmlybSBkaWFsb2csIHdpdGggYSBjdXN0b21pemFibGUgdGl0bGUgYW5kIGJ1dHRvbiB0ZXh0LgogICAgICogVGhlIHJlc3VsdCB0aGF0IHRoZSB1c2VyIHNlbGVjdHMgaXMgcmV0dXJuZWQgdG8gdGhlIHJlc3VsdCBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSAgICAgICAgICAgICAgTWVzc2FnZSB0byBwcmludCBpbiB0aGUgYm9keSBvZiB0aGUgYWxlcnQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdENhbGxiYWNrICAgICBUaGUgY2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB1c2VyIGNsaWNrcyBvbiBhIGJ1dHRvbi4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0aXRsZSAgICAgICAgICAgICAgICBUaXRsZSBvZiB0aGUgYWxlcnQgZGlhbG9nIChkZWZhdWx0OiBDb25maXJtKQogICAgICogQHBhcmFtIHtTdHJpbmd9IGJ1dHRvbkxhYmVscyAgICAgICAgIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIHRoZSBsYWJlbHMgb2YgdGhlIGJ1dHRvbnMgKGRlZmF1bHQ6ICdPSyxDYW5jZWwnKQogICAgICovCiAgICBjb25maXJtOiBmdW5jdGlvbihtZXNzYWdlLCByZXN1bHRDYWxsYmFjaywgdGl0bGUsIGJ1dHRvbkxhYmVscykgewogICAgICAgIHZhciBfdGl0bGUgPSAodGl0bGUgfHwgIkNvbmZpcm0iKTsKICAgICAgICB2YXIgX2J1dHRvbkxhYmVscyA9IChidXR0b25MYWJlbHMgfHwgIk9LLENhbmNlbCIpOwogICAgICAgIGV4ZWMocmVzdWx0Q2FsbGJhY2ssIG51bGwsICJOb3RpZmljYXRpb24iLCAiY29uZmlybSIsIFttZXNzYWdlLCBfdGl0bGUsIF9idXR0b25MYWJlbHNdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDYXVzZXMgdGhlIGRldmljZSB0byB2aWJyYXRlLgogICAgICoKICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gbWlsbHMgICAgICAgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gdmlicmF0ZSBmb3IuCiAgICAgKi8KICAgIHZpYnJhdGU6IGZ1bmN0aW9uKG1pbGxzKSB7CiAgICAgICAgZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgInZpYnJhdGUiLCBbbWlsbHNdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDYXVzZXMgdGhlIGRldmljZSB0byBiZWVwLgogICAgICogT24gQW5kcm9pZCwgdGhlIGRlZmF1bHQgbm90aWZpY2F0aW9uIHJpbmd0b25lIGlzIHBsYXllZCAiY291bnQiIHRpbWVzLgogICAgICoKICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gY291bnQgICAgICAgVGhlIG51bWJlciBvZiBiZWVwcy4KICAgICAqLwogICAgYmVlcDogZnVuY3Rpb24oY291bnQpIHsKICAgICAgICBleGVjKG51bGwsIG51bGwsICJOb3RpZmljYXRpb24iLCAiYmVlcCIsIFtjb3VudF0pOwogICAgfQp9Owp9KTsKCi8vIGZpbGU6IGxpYi9jb21tb24vcGx1Z2luL3JlcXVlc3RGaWxlU3lzdGVtLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vcmVxdWVzdEZpbGVTeXN0ZW0iLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIEZpbGVFcnJvciA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFcnJvcicpLAogICAgRmlsZVN5c3RlbSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVTeXN0ZW0nKSwKICAgIGV4ZWMgPSByZXF1aXJlKCdjb3Jkb3ZhL2V4ZWMnKTsKCi8qKgogKiBSZXF1ZXN0IGEgZmlsZSBzeXN0ZW0gaW4gd2hpY2ggdG8gc3RvcmUgYXBwbGljYXRpb24gZGF0YS4KICogQHBhcmFtIHR5cGUgIGxvY2FsIGZpbGUgc3lzdGVtIHR5cGUKICogQHBhcmFtIHNpemUgIGluZGljYXRlcyBob3cgbXVjaCBzdG9yYWdlIHNwYWNlLCBpbiBieXRlcywgdGhlIGFwcGxpY2F0aW9uIGV4cGVjdHMgdG8gbmVlZAogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrICBpbnZva2VkIHdpdGggYSBGaWxlU3lzdGVtIG9iamVjdAogKiBAcGFyYW0gZXJyb3JDYWxsYmFjayAgaW52b2tlZCBpZiBlcnJvciBvY2N1cnMgcmV0cmlldmluZyBmaWxlIHN5c3RlbQogKi8KdmFyIHJlcXVlc3RGaWxlU3lzdGVtID0gZnVuY3Rpb24odHlwZSwgc2l6ZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICB2YXIgZmFpbCA9IGZ1bmN0aW9uKGNvZGUpIHsKICAgICAgICBpZiAodHlwZW9mIGVycm9yQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhuZXcgRmlsZUVycm9yKGNvZGUpKTsKICAgICAgICB9CiAgICB9OwoKICAgIGlmICh0eXBlIDwgMCB8fCB0eXBlID4gMykgewogICAgICAgIGZhaWwoRmlsZUVycm9yLlNZTlRBWF9FUlIpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBpZiBzdWNjZXNzZnVsLCByZXR1cm4gYSBGaWxlU3lzdGVtIG9iamVjdAogICAgICAgIHZhciBzdWNjZXNzID0gZnVuY3Rpb24oZmlsZV9zeXN0ZW0pIHsKICAgICAgICAgICAgaWYgKGZpbGVfc3lzdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgIC8vIGdyYWIgdGhlIG5hbWUgYW5kIHJvb3QgZnJvbSB0aGUgZmlsZSBzeXN0ZW0gb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBGaWxlU3lzdGVtKGZpbGVfc3lzdGVtLm5hbWUsIGZpbGVfc3lzdGVtLnJvb3QpOwogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhyZXN1bHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gbm8gRmlsZVN5c3RlbSBvYmplY3QgcmV0dXJuZWQKICAgICAgICAgICAgICAgIGZhaWwoRmlsZUVycm9yLk5PVF9GT1VORF9FUlIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBleGVjKHN1Y2Nlc3MsIGZhaWwsICJGaWxlIiwgInJlcXVlc3RGaWxlU3lzdGVtIiwgW3R5cGUsIHNpemVdKTsKICAgIH0KfTsKCm1vZHVsZS5leHBvcnRzID0gcmVxdWVzdEZpbGVTeXN0ZW07Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vcmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSSS5qcwpkZWZpbmUoImNvcmRvdmEvcGx1Z2luL3Jlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkkiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIERpcmVjdG9yeUVudHJ5ID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRGlyZWN0b3J5RW50cnknKSwKICAgIEZpbGVFbnRyeSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGx1Z2luL0ZpbGVFbnRyeScpLAogICAgRmlsZUVycm9yID0gcmVxdWlyZSgnY29yZG92YS9wbHVnaW4vRmlsZUVycm9yJyksCiAgICBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyk7CgovKioKICogTG9vayB1cCBmaWxlIHN5c3RlbSBFbnRyeSByZWZlcnJlZCB0byBieSBsb2NhbCBVUkkuCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSB1cmkgIFVSSSByZWZlcnJpbmcgdG8gYSBsb2NhbCBmaWxlIG9yIGRpcmVjdG9yeQogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrICBpbnZva2VkIHdpdGggRW50cnkgb2JqZWN0IGNvcnJlc3BvbmRpbmcgdG8gVVJJCiAqIEBwYXJhbSBlcnJvckNhbGxiYWNrICAgIGludm9rZWQgaWYgZXJyb3Igb2NjdXJzIHJldHJpZXZpbmcgZmlsZSBzeXN0ZW0gZW50cnkKICovCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odXJpLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIC8vIGVycm9yIGNhbGxiYWNrCiAgICB2YXIgZmFpbCA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlcnJvckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2sobmV3IEZpbGVFcnJvcihlcnJvcikpOwogICAgICAgIH0KICAgIH07CiAgICAvLyBzYW5pdHkgY2hlY2sgZm9yICdub3Q6dmFsaWQ6ZmlsZW5hbWUnCiAgICBpZighdXJpIHx8IHVyaS5zcGxpdCgiOiIpLmxlbmd0aCA+IDIpIHsKICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZmFpbChGaWxlRXJyb3IuRU5DT0RJTkdfRVJSKTsKICAgICAgICB9LDApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIC8vIGlmIHN1Y2Nlc3NmdWwsIHJldHVybiBlaXRoZXIgYSBmaWxlIG9yIGRpcmVjdG9yeSBlbnRyeQogICAgdmFyIHN1Y2Nlc3MgPSBmdW5jdGlvbihlbnRyeSkgewogICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgaWYgKGVudHJ5KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYXBwcm9wcmlhdGUgRW50cnkgb2JqZWN0CiAgICAgICAgICAgICAgICByZXN1bHQgPSAoZW50cnkuaXNEaXJlY3RvcnkpID8gbmV3IERpcmVjdG9yeUVudHJ5KGVudHJ5Lm5hbWUsIGVudHJ5LmZ1bGxQYXRoKSA6IG5ldyBGaWxlRW50cnkoZW50cnkubmFtZSwgZW50cnkuZnVsbFBhdGgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2socmVzdWx0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGludm9raW5nIGNhbGxiYWNrOiAnICsgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIG5vIEVudHJ5IG9iamVjdCByZXR1cm5lZAogICAgICAgICAgICBmYWlsKEZpbGVFcnJvci5OT1RfRk9VTkRfRVJSKTsKICAgICAgICB9CiAgICB9OwoKICAgIGV4ZWMoc3VjY2VzcywgZmFpbCwgIkZpbGUiLCAicmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSSSIsIFt1cmldKTsKfTsKCn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi9wbHVnaW4vc3BsYXNoc2NyZWVuLmpzCmRlZmluZSgiY29yZG92YS9wbHVnaW4vc3BsYXNoc2NyZWVuIiwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBleGVjID0gcmVxdWlyZSgnY29yZG92YS9leGVjJyk7Cgp2YXIgc3BsYXNoc2NyZWVuID0gewogICAgc2hvdzpmdW5jdGlvbigpIHsKICAgICAgICBleGVjKG51bGwsIG51bGwsICJTcGxhc2hTY3JlZW4iLCAic2hvdyIsIFtdKTsKICAgIH0sCiAgICBoaWRlOmZ1bmN0aW9uKCkgewogICAgICAgIGV4ZWMobnVsbCwgbnVsbCwgIlNwbGFzaFNjcmVlbiIsICJoaWRlIiwgW10pOwogICAgfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSBzcGxhc2hzY3JlZW47Cn0pOwoKLy8gZmlsZTogbGliL2NvbW1vbi91dGlscy5qcwpkZWZpbmUoImNvcmRvdmEvdXRpbHMiLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKdmFyIHV0aWxzID0gZXhwb3J0czsKCi8qKgogKiBSZXR1cm5zIGFuIGluZGljYXRpb24gb2Ygd2hldGhlciB0aGUgYXJndW1lbnQgaXMgYW4gYXJyYXkgb3Igbm90CiAqLwp1dGlscy5pc0FycmF5ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSA9PSAnW29iamVjdCBBcnJheV0nOwp9OwoKLyoqCiAqIFJldHVybnMgYW4gaW5kaWNhdGlvbiBvZiB3aGV0aGVyIHRoZSBhcmd1bWVudCBpcyBhIERhdGUgb3Igbm90CiAqLwp1dGlscy5pc0RhdGUgPSBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGQpID09ICdbb2JqZWN0IERhdGVdJzsKfTsKCi8qKgogKiBEb2VzIGEgZGVlcCBjbG9uZSBvZiB0aGUgb2JqZWN0LgogKi8KdXRpbHMuY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmKCFvYmogfHwgdHlwZW9mIG9iaiA9PSAnZnVuY3Rpb24nIHx8IHV0aWxzLmlzRGF0ZShvYmopIHx8IHR5cGVvZiBvYmogIT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIHZhciByZXRWYWwsIGk7CgogICAgaWYodXRpbHMuaXNBcnJheShvYmopKXsKICAgICAgICByZXRWYWwgPSBbXTsKICAgICAgICBmb3IoaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyArK2kpewogICAgICAgICAgICByZXRWYWwucHVzaCh1dGlscy5jbG9uZShvYmpbaV0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldFZhbDsKICAgIH0KCiAgICByZXRWYWwgPSB7fTsKICAgIGZvcihpIGluIG9iail7CiAgICAgICAgaWYoIShpIGluIHJldFZhbCkgfHwgcmV0VmFsW2ldICE9IG9ialtpXSkgewogICAgICAgICAgICByZXRWYWxbaV0gPSB1dGlscy5jbG9uZShvYmpbaV0pOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXRWYWw7Cn07CgovKioKICogUmV0dXJucyBhIHdyYXBwZXJlZCB2ZXJzaW9uIG9mIHRoZSBmdW5jdGlvbgogKi8KdXRpbHMuY2xvc2UgPSBmdW5jdGlvbihjb250ZXh0LCBmdW5jLCBwYXJhbXMpIHsKICAgIGlmICh0eXBlb2YgcGFyYW1zID09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgcGFyYW1zKTsKICAgICAgICB9OwogICAgfQp9OwoKLyoqCiAqIENyZWF0ZSBhIFVVSUQKICovCnV0aWxzLmNyZWF0ZVVVSUQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBVVUlEY3JlYXRlUGFydCg0KSArICctJyArCiAgICAgICAgVVVJRGNyZWF0ZVBhcnQoMikgKyAnLScgKwogICAgICAgIFVVSURjcmVhdGVQYXJ0KDIpICsgJy0nICsKICAgICAgICBVVUlEY3JlYXRlUGFydCgyKSArICctJyArCiAgICAgICAgVVVJRGNyZWF0ZVBhcnQoNik7Cn07CgovKioKICogRXh0ZW5kcyBhIGNoaWxkIG9iamVjdCBmcm9tIGEgcGFyZW50IG9iamVjdCB1c2luZyBjbGFzc2ljYWwgaW5oZXJpdGFuY2UKICogcGF0dGVybi4KICovCnV0aWxzLmV4dGVuZCA9IChmdW5jdGlvbigpIHsKICAgIC8vIHByb3h5IHVzZWQgdG8gZXN0YWJsaXNoIHByb3RvdHlwZSBjaGFpbgogICAgdmFyIEYgPSBmdW5jdGlvbigpIHt9OwogICAgLy8gZXh0ZW5kIENoaWxkIGZyb20gUGFyZW50CiAgICByZXR1cm4gZnVuY3Rpb24oQ2hpbGQsIFBhcmVudCkgewogICAgICAgIEYucHJvdG90eXBlID0gUGFyZW50LnByb3RvdHlwZTsKICAgICAgICBDaGlsZC5wcm90b3R5cGUgPSBuZXcgRigpOwogICAgICAgIENoaWxkLl9fc3VwZXJfXyA9IFBhcmVudC5wcm90b3R5cGU7CiAgICAgICAgQ2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hpbGQ7CiAgICB9Owp9KCkpOwoKLyoqCiAqIEFsZXJ0cyBhIG1lc3NhZ2UgaW4gYW55IGF2YWlsYWJsZSB3YXk6IGFsZXJ0IG9yIGNvbnNvbGUubG9nLgogKi8KdXRpbHMuYWxlcnQgPSBmdW5jdGlvbihtc2cpIHsKICAgIGlmIChhbGVydCkgewogICAgICAgIGFsZXJ0KG1zZyk7CiAgICB9IGVsc2UgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHsKICAgICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgfQp9OwoKLyoqCiAqIEZvcm1hdHMgYSBzdHJpbmcgYW5kIGFyZ3VtZW50cyBmb2xsb3dpbmcgaXQgYWxhIHNwcmludGYoKQogKgogKiBzZWUgdXRpbHMudmZvcm1hdCgpIGZvciBtb3JlIGluZm9ybWF0aW9uCiAqLwp1dGlscy5mb3JtYXQgPSBmdW5jdGlvbihmb3JtYXRTdHJpbmcgLyogLC4uLiAqLykgewogICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICByZXR1cm4gdXRpbHMudmZvcm1hdChmb3JtYXRTdHJpbmcsIGFyZ3MpOwp9OwoKLyoqCiAqIEZvcm1hdHMgYSBzdHJpbmcgYW5kIGFyZ3VtZW50cyBmb2xsb3dpbmcgaXQgYWxhIHZzcHJpbnRmKCkKICoKICogZm9ybWF0IGNoYXJzOgogKiAgICVqIC0gZm9ybWF0IGFyZyBhcyBKU09OCiAqICAgJW8gLSBmb3JtYXQgYXJnIGFzIEpTT04KICogICAlYyAtIGZvcm1hdCBhcmcgYXMgJycKICogICAlJSAtIHJlcGxhY2Ugd2l0aCAnJScKICogYW55IG90aGVyIGNoYXIgZm9sbG93aW5nICUgd2lsbCBmb3JtYXQgaXQncwogKiBhcmcgdmlhIHRvU3RyaW5nKCkuCiAqCiAqIGZvciByYXRpb25hbGUsIHNlZSBGaXJlQnVnJ3MgQ29uc29sZSBBUEk6CiAqICAgIGh0dHA6Ly9nZXRmaXJlYnVnLmNvbS93aWtpL2luZGV4LnBocC9Db25zb2xlX0FQSQogKi8KdXRpbHMudmZvcm1hdCA9IGZ1bmN0aW9uKGZvcm1hdFN0cmluZywgYXJncykgewogICAgaWYgKGZvcm1hdFN0cmluZyA9PT0gbnVsbCB8fCBmb3JtYXRTdHJpbmcgPT09IHVuZGVmaW5lZCkgcmV0dXJuICIiOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgcmV0dXJuIGZvcm1hdFN0cmluZy50b1N0cmluZygpOwogICAgaWYgKHR5cGVvZiBmb3JtYXRTdHJpbmcgIT0gInN0cmluZyIpIHJldHVybiBmb3JtYXRTdHJpbmcudG9TdHJpbmcoKTsKCiAgICB2YXIgcGF0dGVybiA9IC8oLio/KSUoLikoLiopLzsKICAgIHZhciByZXN0ICAgID0gZm9ybWF0U3RyaW5nOwogICAgdmFyIHJlc3VsdCAgPSBbXTsKCiAgICB3aGlsZSAoYXJncy5sZW5ndGgpIHsKICAgICAgICB2YXIgYXJnICAgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgdmFyIG1hdGNoID0gcGF0dGVybi5leGVjKHJlc3QpOwoKICAgICAgICBpZiAoIW1hdGNoKSBicmVhazsKCiAgICAgICAgcmVzdCA9IG1hdGNoWzNdOwoKICAgICAgICByZXN1bHQucHVzaChtYXRjaFsxXSk7CgogICAgICAgIGlmIChtYXRjaFsyXSA9PSAnJScpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goJyUnKTsKICAgICAgICAgICAgYXJncy51bnNoaWZ0KGFyZyk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0LnB1c2goZm9ybWF0dGVkKGFyZywgbWF0Y2hbMl0pKTsKICAgIH0KCiAgICByZXN1bHQucHVzaChyZXN0KTsKCiAgICByZXR1cm4gcmVzdWx0LmpvaW4oJycpOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gVVVJRGNyZWF0ZVBhcnQobGVuZ3RoKSB7CiAgICB2YXIgdXVpZHBhcnQgPSAiIjsKICAgIGZvciAodmFyIGk9MDsgaTxsZW5ndGg7IGkrKykgewogICAgICAgIHZhciB1dWlkY2hhciA9IHBhcnNlSW50KChNYXRoLnJhbmRvbSgpICogMjU2KSwgMTApLnRvU3RyaW5nKDE2KTsKICAgICAgICBpZiAodXVpZGNoYXIubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgdXVpZGNoYXIgPSAiMCIgKyB1dWlkY2hhcjsKICAgICAgICB9CiAgICAgICAgdXVpZHBhcnQgKz0gdXVpZGNoYXI7CiAgICB9CiAgICByZXR1cm4gdXVpZHBhcnQ7Cn0KCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGZvcm1hdHRlZChvYmplY3QsIGZvcm1hdENoYXIpIHsKCiAgICB0cnkgewogICAgICAgIHN3aXRjaChmb3JtYXRDaGFyKSB7CiAgICAgICAgICAgIGNhc2UgJ2onOgogICAgICAgICAgICBjYXNlICdvJzogcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iamVjdCk7CiAgICAgICAgICAgIGNhc2UgJ2MnOiByZXR1cm4gJyc7CiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gImVycm9yIEpTT04uc3RyaW5naWZ5KClpbmcgYXJndW1lbnQ6ICIgKyBlOwogICAgfQoKICAgIGlmICgob2JqZWN0ID09PSBudWxsKSB8fCAob2JqZWN0ID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpOwogICAgfQoKICAgIHJldHVybiBvYmplY3QudG9TdHJpbmcoKTsKfQoKfSk7CgoKd2luZG93LmNvcmRvdmEgPSByZXF1aXJlKCdjb3Jkb3ZhJyk7CgovLyBmaWxlOiBsaWIvc2NyaXB0cy9ib290c3RyYXAuanMKKGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgICB2YXIgY2hhbm5lbCA9IHJlcXVpcmUoImNvcmRvdmEvY2hhbm5lbCIpLAogICAgICAgIF9zZWxmID0gewogICAgICAgICAgICBib290OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIENyZWF0ZSBhbGwgY29yZG92YSBvYmplY3RzIG9uY2UgcGFnZSBoYXMgZnVsbHkgbG9hZGVkIGFuZCBuYXRpdmUgc2lkZSBpcyByZWFkeS4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgY2hhbm5lbC5qb2luKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBidWlsZGVyID0gcmVxdWlyZSgnY29yZG92YS9idWlsZGVyJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2UgPSByZXF1aXJlKCdjb3Jkb3ZhL2NvbW1vbicpLAogICAgICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IHJlcXVpcmUoJ2NvcmRvdmEvcGxhdGZvcm0nKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gRHJvcCB0aGUgY29tbW9uIGdsb2JhbHMgaW50byB0aGUgd2luZG93IG9iamVjdCwgYnV0IGJlIG5pY2UgYW5kIGRvbid0IG92ZXJ3cml0ZSBhbnl0aGluZy4KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmJ1aWxkKGJhc2Uub2JqZWN0cykuaW50b0J1dERvbnRDbG9iYmVyKHdpbmRvdyk7CgogICAgICAgICAgICAgICAgICAgIC8vIERyb3AgdGhlIHBsYXRmb3JtLXNwZWNpZmljIGdsb2JhbHMgaW50byB0aGUgd2luZG93IG9iamVjdAogICAgICAgICAgICAgICAgICAgIC8vIGFuZCBjbG9iYmVyIGFueSBleGlzdGluZyBvYmplY3QuCiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5idWlsZChwbGF0Zm9ybS5vYmplY3RzKS5pbnRvQW5kQ2xvYmJlcih3aW5kb3cpOwoKICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZSB0aGUgcGxhdGZvcm0tc3BlY2lmaWMgb3ZlcnJpZGVzL2VuaGFuY2VtZW50cyBpbnRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHdpbmRvdyBvYmplY3QuCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF0Zm9ybS5tZXJnZXMgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYnVpbGQocGxhdGZvcm0ubWVyZ2VzKS5pbnRvQW5kTWVyZ2Uod2luZG93KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENhbGwgdGhlIHBsYXRmb3JtLXNwZWNpZmljIGluaXRpYWxpemF0aW9uCiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0uaW5pdGlhbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBGaXJlIGV2ZW50IHRvIG5vdGlmeSB0aGF0IGFsbCBvYmplY3RzIGFyZSBjcmVhdGVkCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbC5vbkNvcmRvdmFSZWFkeS5maXJlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIEZpcmUgb25EZXZpY2VSZWFkeSBldmVudCBvbmNlIGFsbCBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4gYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gY29yZG92YSBpbmZvIGhhcyBiZWVuIHJlY2VpdmVkIGZyb20gbmF0aXZlIHNpZGUuCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbC5qb2luKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlKCdjb3Jkb3ZhJykuZmlyZURvY3VtZW50RXZlbnQoJ2RldmljZXJlYWR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSwgY2hhbm5lbC5kZXZpY2VSZWFkeUNoYW5uZWxzQXJyYXkpOwoKICAgICAgICAgICAgICAgIH0sIFsgY2hhbm5lbC5vbkRPTUNvbnRlbnRMb2FkZWQsIGNoYW5uZWwub25OYXRpdmVSZWFkeSBdKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgLy8gYm9vdCB1cCBvbmNlIG5hdGl2ZSBzaWRlIGlzIHJlYWR5CiAgICBjaGFubmVsLm9uTmF0aXZlUmVhZHkuc3Vic2NyaWJlT25jZShfc2VsZi5ib290KTsKCiAgICAvLyBfbmF0aXZlUmVhZHkgaXMgZ2xvYmFsIHZhcmlhYmxlIHRoYXQgdGhlIG5hdGl2ZSBzaWRlIGNhbiBzZXQKICAgIC8vIHRvIHNpZ25pZnkgdGhhdCB0aGUgbmF0aXZlIGNvZGUgaXMgcmVhZHkuIEl0IGlzIGEgZ2xvYmFsIHNpbmNlCiAgICAvLyBpdCBtYXkgYmUgY2FsbGVkIGJlZm9yZSBhbnkgY29yZG92YSBKUyBpcyByZWFkeS4KICAgIGlmICh3aW5kb3cuX25hdGl2ZVJlYWR5KSB7CiAgICAgICAgY2hhbm5lbC5vbk5hdGl2ZVJlYWR5LmZpcmUoKTsKICAgIH0KCn0od2luZG93KSk7CgoKfSkoKTs=", "content_type": "application/javascript"}, "test/jasmine/index.html": {"data": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9ZWRnZSxjaHJvbWU9MSI+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiPgoKICA8dGl0bGU+QmFja2JvbmUgQm9pbGVycGxhdGUgSmFzbWluZSBUZXN0IFN1aXRlPC90aXRsZT4KCiAgPCEtLSBKYXNtaW5lIHN0eWxlcyAtLT4KICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9InZlbmRvci9qYXNtaW5lLmNzcyI+CjwvaGVhZD4KCjxib2R5PgogIDwhLS0gVGVzdGluZyBsaWJzIC0tPgogIDxzY3JpcHQgc3JjPSJ2ZW5kb3IvamFzbWluZS5qcyI+PC9zY3JpcHQ+CiAgPHNjcmlwdCBzcmM9InZlbmRvci9qYXNtaW5lLWh0bWwuanMiPjwvc2NyaXB0PgoKICA8IS0tIEFwcGxpY2F0aW9uIGxpYnMgLS0+CiAgPHNjcmlwdCBzcmM9Ii4uLy4uL2Fzc2V0cy9qcy9saWJzL2pxdWVyeS5qcyI+PC9zY3JpcHQ+CiAgPHNjcmlwdCBzcmM9Ii4uLy4uL2Fzc2V0cy9qcy9saWJzL3VuZGVyc2NvcmUuanMiPjwvc2NyaXB0PgogIDxzY3JpcHQgc3JjPSIuLi8uLi9hc3NldHMvanMvbGlicy9iYWNrYm9uZS5qcyI+PC9zY3JpcHQ+CiAgCiAgPCEtLSBMb2FkIGFwcGxpY2F0aW9uIC0tPgogIDxzY3JpcHQgZGF0YS1tYWluPSIuLi8uLi9hcHAvY29uZmlnIgogICAgc3JjPSIuLi8uLi9hc3NldHMvanMvbGlicy9yZXF1aXJlLmpzIj48L3NjcmlwdD4KCiAgPCEtLSBEZWNsYXJlIHlvdXIgc3BlYyBmaWxlcyB0byBiZSBydW4gaGVyZSAtLT4KICA8c2NyaXB0PgogICAgLy8gRW5zdXJlIHlvdSBwb2ludCB0byB3aGVyZSB5b3VyIHNwZWMgZm9sZGVyIGlzLCBiYXNlIGRpcmVjdG9yeSBpcyBhcHAvLAogICAgLy8gd2hpY2ggaXMgd2h5IC4uL3Rlc3QgaXMgbmVjZXNzYXJ5CiAgICByZXF1aXJlKHsgcGF0aHM6IHsgc3BlYzogIi4uL3Rlc3QvamFzbWluZS9zcGVjIiB9IH0sIFsKCiAgICAgIC8vIExvYWQgdGhlIGV4YW1wbGUgc3BlYywgcmVwbGFjZSB0aGlzIGFuZCBhZGQgeW91ciBvd24gc3BlYwogICAgICAic3BlYy9leGFtcGxlIgoKICAgIF0sIGZ1bmN0aW9uKCkgewogICAgICAvLyBTZXQgdXAgdGhlIGphc21pbmUgcmVwb3J0ZXJzIG9uY2UgZWFjaCBzcGVjIGhhcyBiZWVuIGxvYWRlZAogICAgICBqYXNtaW5lLmdldEVudigpLmFkZFJlcG9ydGVyKG5ldyBqYXNtaW5lLlRyaXZpYWxSZXBvcnRlcigpKTsKICAgICAgamFzbWluZS5nZXRFbnYoKS5leGVjdXRlKCk7CiAgICB9KTsKICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==", "content_type": "text/html"}}, "file": "watch( '.html$') {|match_data|\n  `couchapp push dev` unless match_data[0] =~ /\\.sw.$/\n}\nwatch( '.js$') {|match_data|\n  `couchapp push dev` unless match_data[0] =~ /\\.sw.$/\n}\nwatch( '.*\\.json$') {|match_data|\n  `couchapp push dev` unless match_data[0] =~ /\\.sw.$/\n}\nwatch( '.*\\.css$') {|match_data|\n  `couchapp push dev` unless match_data[0] =~ /\\.sw.$/\n}\nwatch( '(.*\\.coffee$)' ) {|match_data|\n  puts match_data[0]\n  result = `coffee --bare --compile #{match_data[0]} 2>&1`\n  error = false\n  result.each{|line|\n    if line.match(/In /)  then\n      error = true\n      puts line\n#      `mplayer -really-quiet \"/usr/share/evolution/2.30/sounds/default_alarm.wav\"`\n#      `notify-send \"#{line}\" -i /usr/share/icons/Humanity/status/128/dialog-warning.svg &`\n    end\n  }\n  if not error\n    puts \"Success!\"\n#    `make combined`\n    `couchapp push dev`\n  end\n}", "language": "javascript", "views": {"byItemSorted": {"map": "function(doc) {\n  if (doc.formId === \"item\") {\n    emit([doc.lastModified], doc);\n  }\n};"}, "byCollection": {"map": "function(doc) {\n  if (doc.collection) {\n\t  emit(doc.collection, doc);\n  }\n}"}}, "README": "## Generated by CouchApp\n\nCouchApps are web applications which can be served directly from [CouchDB](http://couchdb.apache.org). This gives them the nice property of replicating just like any other data stored in CouchDB. They are also simple to write as they can use the built-in jQuery libraries and plugins that ship with CouchDB.\n\n[More info about CouchApps here.](http://couchapp.org)\n\n## Deploying this app\n\nAssuming you just cloned this app from git, and you have changed into the app directory in your terminal, you want to push it to your CouchDB with the CouchApp command line tool, like this:\n\n    couchapp push . http://name:password@hostname:5984/mydatabase\n\nIf you don't have a password on your CouchDB (admin party) you can do it like this (but it's a bad, idea, set a password):\n\n    couchapp push . http://hostname:5984/mydatabase\n\nIf you get sick of typing the URL, you should setup a `.couchapprc` file in the root of your directory. Remember not to check this into version control as it will have passwords in it.\n\nThe `.couchapprc` file should have contents like this:\n\n    {\n      \"env\" : {\n        \"public\" : {\n          \"db\" : \"http://name:pass@mycouch.couchone.com/mydatabase\"\n        },\n        \"default\" : {\n          \"db\" : \"http://name:pass@localhost:5984/mydatabase\"\n        }\n      }\n    }\n\nNow that you have the `.couchapprc` file set up, you can push your app to the CouchDB as simply as:\n\n    couchapp push\n\nThis pushes to the `default` as specified. To push to the `public` you'd run:\n\n    couchapp push public\n\nOf course you can continue to add more deployment targets as you see fit, and give them whatever names you like.\n\nOther useful info\n-----------------\n\nIt's a pain to run 'couchapp push' everytime you make a change. Mike wrote a little [watchr](http://rubygems.org/gems/watchr) script that watches for changes to any relevant files and then automatically pushes them into your couch. To get it you need to install rubygems and watchr:\n\n    apt-get install rubygems\n    gem install watchr\n    \nTo run it, just \n\n\twatchr file.watchr", "_id": "_design/couchabb", "couchapp": {"manifest": ["couchapp.json", "file.watchr", "language", "README.md", "views/", "views/byCollection/", "views/byCollection/map.js", "views/byItemSorted/", "views/byItemSorted/map.js"], "signatures": {"test/qunit/index.html": "c4cb7ed76306960cbedf7ebcc2dbef77", "assets/css/style.css": "60e50f3092163c547b8492dbedc37949", "test/jasmine/vendor/jasmine-html.js": "42f01b8b707c08688b674e24b6468691", "app/modules/item.js": "1e7f2ce54e07bbc04bca0d7683b473fb", "assets/js/plugins/text.js": "b32b7d40ae64e551068f618a8b0b4cb6", "app/config.js": "b778e655fbed76d1a76f4b836423bd91", "app/templates/todomvc.html": "f108c2056a890d66d1363430f89a781b", "assets/js/libs/backbone-full.js": "e9f62de436c1c7e751b187dcd672d810", "test/jasmine/vendor/jasmine.js": "13679aa81688216e85c59e80cec1f087", "grunt.js": "1838a7d52afd8fa7ca09474604c0fcc3", "assets/img/backbone.png": "39533ea5bc6b7836b4dfc910154489f2", "favicon.ico": "6e23fd7b2e8105ccdbbcafe31c2bafdd", "app/templates/stats.html": "fa92dd04fcda65bc22862f35f43b7974", "assets/js/libs/almond.js": "3bd7933372f11d686b32d4022eadb6bb", "test/jasmine/vendor/jasmine.css": "c49709e9712cc01b60362d0bb5bab8a4", "assets/js/libs/backbone.js": "a959af924d21c7b788fe197caf03fc40", "app/namespace.js": "f11a748c6c75cba9ee1fa4f56193e25c", "app/modules/example.js": "c6c0f939e5a5cf19edf060a65cb2a71f", "assets/js/libs/jquery.js": "273e017fd0bef143258516bdee173a1e", "assets/css/todos.css": "2de0a33e64bed96a8787c37efda3ba69", "test/qunit/vendor/qunit.css": "7d50545791ad767f21581e23cf8b89b4", "app/main.js": "0d55473eb0cdf4fefb5ff9313efc3953", "test/qunit/tests/example.js": "e82d0cdf3c1c464173d0c599e77f9806", "assets/js/plugins/backbone-localstorage.js": "97c31c30c0be27426e59492aeadbe6ab", "assets/js/libs/syncpoint-utils.js": "dc46e909a7a818071c1ac1dd6be6a8dc", "assets/js/libs/jquery.couch.js": "1ed75a8aca42bf3d437535bb51618f99", "app/templates/example.html": "c99625bcaf807146c27aa91a27a4ad6b", "app/modules/todo.js": "adf96265a218b602b11061cc3a310d1b", "app/templates/todos.html": "c1814dc095c3b817e70165daf095e07c", "assets/js/libs/require.js": "5d8ec2c595f444741f9ff284639b05f2", "assets/js/plugins/use.js": "323e93b5244a4d84865b0b8ba42fecd3", "readme.md": "e2fb3cfb9bd59e312508fe9758704569", "assets/js/libs/underscore.js": "4eb64db36175fefa3e36b9e57606512c", "assets/css/index.css": "1fa33d7faa0214a53b43c247d2461cb9", "test/jasmine/spec/example.js": "5c75a52ebb391e2ac2dad9ff46913c01", "index.html": "3f6bf9557c1ad8b633b40776e8b78295", "test/jasmine/vendor/MIT.LICENSE": "ee4bc64f30f3e9d1aed570562d8713e7", "assets/js/libs/backbone-couchdb.js": "8564a176d1555f4692f4f6dde073c13c", "test/jasmine/vendor/jasmine_favicon.png": "a165833061487789d9d008cc57571c25", "assets/css/destroy.png": "a4023351c1c0ad044d39139bca216cf9", "test/qunit/vendor/qunit.js": "e1e6023d3111b009393951e2433837b6", "assets/js/plugins/localstorage.js": "8429caa4bf756718afa7cd4aa842a3e5", "assets/js/libs/cordova-2.0.0.js": "5c8aaa2ba56d706f6c0ebf38f3b48ea6", "test/jasmine/index.html": "143ca8560675ded3974172535e6ca18d"}, "name": "Name of your CouchApp", "objects": {}, "description": "CouchApp"}}
